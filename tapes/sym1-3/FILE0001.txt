./  ADD  SSI=32960720,NAME=IEAVNP07
         TITLE 'IEAVNP07, INITIALIZATION FOR DIDOCS DCMS               *00001000
                       '                                                00002000
IEAVNP07 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IEAVNP07  73.297'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         LA    @05,@DATA                                           0001 00014000
         USING @DATA,@05                                           0001 00015000
         ST    @13,@SA00001+4                                      0001 00016000
         LA    @14,@SA00001                                        0001 00017000
         ST    @14,8(,@13)                                         0001 00018000
         LR    @13,@14                                             0001 00019000
*                                                                       00020000
** REFS ARE GENERATED FOR NVT FIELDS THAT CONTAIN ADDRESSES OF          00021000
** NIP SERVICE ROUTINES, SO IEAPMNIP MACRO CALLS TO THESE ROUTINES      00022000
** WILL ASSEMBLE PROPERLY.                                              00023000
         EJECT                                                          00024000
*   UCMBASPT=CVTCUCB;               /* SET UP UCM BASE POINTER       */ 00025000
         L     @10,CVTCUCB(,CVTPTR)                                0108 00026000
         ST    @10,UCMBASPT                                        0108 00027000
*   TCBPTR=NVTMSTCB;                /* ADDR OF MS TCB                */ 00028000
         L     TCBPTR,NVTMSTCB(,RNVT)                              0109 00029000
*   DO UCMDVEPT=UCMVEA TO UCMVEL BY UCMVEZ;/* LOOP THROUGH           */ 00030000
         L     @10,UCMVEA(,@10)                                    0110 00031000
         B     @DE00110                                            0110 00032000
@DL00110 DS    0H                                                  0111 00033000
*                                   /* UCM DEVICE ENTRIES TESTING    */ 00034000
*                                   /* FOR GRAPHICS CONSOLES         */ 00035000
*     IF UCMDISPC¬='1'B THEN        /* TEST FOR GRAPHICS CONSOLE     */ 00036000
         TM    UCMDISPC(@10),B'00100000'                           0111 00037000
         BNO   @RT00111                                            0111 00038000
*       GO TO NP7PDNXT;             /* NOT GRAPHICS, SKIP THIS       */ 00039000
*                                   /* DEVICE ENTRY                  */ 00040000
*     UCBPTR=UCMUCB;                /* PICK UP ADDRESS OF UCB        */ 00041000
         L     UCBPTR,UCMUCB(,@10)                                 0113 00042000
*     IF UCBPTR=0 THEN              /* CAN NOT USE A UCB ADDRESS     */ 00043000
         LTR   UCBPTR,UCBPTR                                       0114 00044000
         BZ    @RT00114                                            0114 00045000
*       GO TO NP7PDNXT;             /* IF IT IS ZERO                 */ 00046000
*     NP7DCMNU=UCBNAME;             /* CONSTRUCT NAME OF DCM BY      */ 00047000
         MVC   NP7DCMNU(3),UCBNAME(UCBPTR)                         0116 00048000
*                                   /* APPENDING THE DEVICE          */ 00049000
*                                   /* ADDRESS TO 'DCM'              */ 00050000
*     RESPECIFY                                                    0117 00051000
*      (RENTRY,                                                    0117 00052000
*       RNAME,                                                     0117 00053000
*       RQADR)RESTRICTED;                                          0117 00054000
*     RENTRY=CVTQCDSR;              /* PICK UP ADDRESS OF ROUTINE    */ 00055000
         L     RENTRY,CVTQCDSR(,CVTPTR)                            0118 00056000
*                                   /* TO SEARCH THE ACTIVE LPA      */ 00057000
*                                   /* QUEUE                         */ 00058000
*     RNAME=ADDR(NP7DCMN);          /* ADDRESS OF MODULE NAME TO     */ 00059000
         LA    RNAME,NP7DCMN                                       0119 00060000
*                                   /* SEARCH FOR                    */ 00061000
*     RQADR=CVTQLPAQ;               /* ADDR OF QUEUE TO              */ 00062000
         L     RQADR,CVTQLPAQ(,CVTPTR)                             0120 00063000
*                                   /* BE SEARCHED                   */ 00064000
*                                                                  0121 00065000
*     /***************************************************************/ 00066000
*     /*                                                             */ 00067000
*     /* CALL IEAQCDSR TO SEARCH THE ACTIVE LINK PACK AREA A FOUND   */ 00068000
*     /* CONDITION WILL CAUSE RETURN TO NSI A NOT FOUND CONDITION    */ 00069000
*     /* WILL CAUSE A RETURN TO FOUR PAST NSI                        */ 00070000
*     /*                                                             */ 00071000
*     /***************************************************************/ 00072000
*                                                                  0121 00073000
*     GENERATE                      /* DEFINE CALL AND BR TAB        */ 00074000
*         REFS(RQADR,RNAME,RENTRY,TCBPTR)SETS(RPARM0,RPARM,CDENTPTR,    00075000
*         REXIT,RENTRY)FLOWS(NP7LPACQ);                            0121 00076000
         BALR  REXIT,RENTRY            /* IEAQCDSR                   */ 00077000
         B     NP7LPACQ                /* CODE 0 CDE FOUND           */ 00078000
*NP7LPNAC:                          /* NOT ON ACTIVE Q               */ 00079000
*     RENTRY=CVTLPDSR;              /* ADDR OF LPDE SEARCH           */ 00080000
NP7LPNAC L     RENTRY,CVTLPDSR(,CVTPTR)                            0122 00081000
*                                   /* ROUTINE                       */ 00082000
*                                                                  0123 00083000
*     /***************************************************************/ 00084000
*     /*                                                             */ 00085000
*     /* CALL IEAVVMSR TO SEARCH THE LINK PACK AREA A FOUND CONDITION*/ 00086000
*     /* WILL CAUSE RETURN TO NSI A NOT FOUND CONDITION WILL CAUSE   */ 00087000
*     /* RETURN TO FOUR PAST NSI                                     */ 00088000
*     /*                                                             */ 00089000
*     /***************************************************************/ 00090000
*                                                                  0123 00091000
*     GENERATE                      /* DEFINE CALL AND BR TAB        */ 00092000
*         REFS(NP7DCMN,RCVT,RENTRY)SETS(RPARM0,RPARM,DCMTSPTR,RQADDR,   00093000
*         RNAME,REXIT)FLOWS(NP7LPDIR);                             0123 00094000
         LM    RPARM0,RPARM,NP7DCMN    /* NAME IN PARM REGS          */ 00095000
         BALR  REXIT,RENTRY            /* IEAVVMSR                   */ 00096000
         B     NP7LPDIR                /* CODE 0 LPDE FOUND          */ 00097000
*     RESPECIFY                                                    0124 00098000
*      (RENTRY,                                                    0124 00099000
*       RNAME,                                                     0124 00100000
*       RQADR)UNRESTRICTED;                                        0124 00101000
*NP7LPNFN:                          /* LPDE NOT FOUND                */ 00102000
*     RPARM=0;                      /* SET RETURN PARM               */ 00103000
NP7LPNFN SR    RPARM,RPARM                                         0125 00104000
*     GO TO NP7PDCHK;                                              0126 00105000
         B     NP7PDCHK                                            0126 00106000
*NP7LPACQ:                          /* CDE ON ACTIVE Q               */ 00107000
*     RPARM=CDENTPT;                /* ENTRY PT ADDR                 */ 00108000
NP7LPACQ L     RPARM,CDENTPT(,CDENTPTR)                            0127 00109000
*     GO TO NP7PDCHK;                                              0128 00110000
         B     NP7PDCHK                                            0128 00111000
*NP7LPDIR:                          /* CDE IN LPA DIRECTORY          */ 00112000
*     LPDEPTR=RPARM0;               /* BASE FOR LPDE MB        Y02958*/ 00113000
NP7LPDIR LR    LPDEPTR,RPARM0                                      0129 00114000
*     RPARM=LPDENTP;                /* ENTRY PT ADDR MB        Y02958*/ 00115000
         L     RPARM,LPDENTP(,LPDEPTR)                             0130 00116000
*NP7PDCHK:                                                         0131 00117000
*     IF RPARM¬=0 THEN              /* TEST FOR DCM NOT FOUND        */ 00118000
NP7PDCHK LTR   RPARM,RPARM                                         0131 00119000
         BZ    @RF00131                                            0131 00120000
*       DO;                         /* DCM FOUND IN LPA              */ 00121000
*         RESPECIFY                                                0133 00122000
*           DCMTSPTR RESTRICTED;                                   0133 00123000
*         DCMTSPTR=UCMXB;           /* PICK UP ADDRESS OF            */ 00124000
         L     @10,UCMDVEPT                                        0134 00125000
         L     DCMTSPTR,UCMXB(,@10)                                0134 00126000
*                                   /* RESIDENT DCM                  */ 00127000
*         DCMADTRN=RPARM;           /* PUT ADDRESS OF PAGEABLE       */ 00128000
         ST    RPARM,DCMADTRN(,DCMTSPTR)                           0135 00129000
*                                   /* DCM INTO RESIDENT DCM         */ 00130000
*         RESPECIFY                                                0136 00131000
*           DCMTSPTR UNRESTRICTED;                                 0136 00132000
*       END;                                                       0137 00133000
*     ELSE                          /* DCM NOT FOUND IN LPA          */ 00134000
*       DO;                                                        0138 00135000
         B     @RC00131                                            0138 00136000
@RF00131 DS    0H                                                  0139 00137000
*         UCBPTR=UCMUCB;            /* SET UCB BASE                  */ 00138000
         L     @15,UCMDVEPT                                        0139 00139000
         L     UCBPTR,UCMUCB(,@15)                                 0139 00140000
*         UCBSYSR='0'B;             /* MARK CONSOLE INACTIVE         */ 00141000
         NI    UCBSYSR(UCBPTR),B'11111101'                         0140 00142000
*         MSG1P1=NP7DCMN;           /* PUT MODULE NAME INTO MSG      */ 00143000
         MVC   MSG1P1(8),NP7DCMN                                   0141 00144000
*         MSG1P2=UCBNAME;           /* PUT DEVICE ADDR INTO MSG      */ 00145000
         MVC   MSG1P2(3),UCBNAME(UCBPTR)                           0142 00146000
*                                   /* ISSUE MESSAGE IEA363I         */ 00147000
*         GENERATE REFS(RNVT,NVTWTO,MSG363I,MSG1P1,MSG1P2)SETS(RPARM,   00148000
*             REXIT,RENTRY)(IEAPMNIP TYPE=WTO,PARAM=MSG363I);/* GET     00149000
*                                      NIP WTO                       */ 00150000
         IEAPMNIP TYPE=WTO,PARAM=MSG363I                                00151000
*         IF UCMDISPA='1'B THEN     /* IS THIS THE MASTER CONSOLE    */ 00152000
         L     @10,UCMDVEPT                                        0144 00153000
         TM    UCMDISPA(@10),B'10000000'                           0144 00154000
         BNO   @RF00144                                            0144 00155000
*           DO;                     /* YES, CANNOT PROCEED           */ 00156000
*             NVTFLWSC=WSC3B;       /* PUT WAIT STATE CODE IN NVT    */ 00157000
         MVI   NVTFLWSC(RNVT),X'3B'                                0146 00158000
*                                   /* ISSUE WAIT STATE CODE '3B'    */ 00159000
*             GENERATE REFS(RNVT,NVTSWAIT,NVTFLWSC)SETS(REXIT,RENTRY)   00160000
*                 (IEAPMNIP TYPE=SWAIT);/* CALL NIP SWAIT            */ 00161000
         IEAPMNIP TYPE=SWAIT                                            00162000
*           END;                                                   0148 00163000
*       END;                                                       0149 00164000
@RF00144 DS    0H                                                  0150 00165000
*NP7PDNXT:                          /* END OF UCM DEVICE ENTRY       */ 00166000
*                                   /* SCAN LOOP                     */ 00167000
*   END;                            /* PROCESS NEXT ENTRY            */ 00168000
@RC00131 DS    0H                                                  0150 00169000
NP7PDNXT L     @10,UCMDVEPT                                        0150 00170000
         L     @15,UCMBASPT                                        0150 00171000
         A     @10,UCMVEZ(,@15)                                    0150 00172000
@DE00110 ST    @10,UCMDVEPT                                        0150 00173000
         L     @15,UCMBASPT                                        0150 00174000
         C     @10,UCMVEL(,@15)                                    0150 00175000
         BNH   @DL00110                                            0150 00176000
*NP7PDXIT:                          /* END PAGABLE DCM ROUTINE       */ 00177000
*   RETURN;                         /* RETURN TO MAINLINE            */ 00178000
@EL00001 L     @13,4(,@13)                                         0151 00179000
@EF00001 DS    0H                                                  0151 00180000
@ER00001 LM    @14,@12,12(@13)                                     0151 00181000
         BR    @14                                                 0151 00182000
*   END IEAVNP07                    /* END OF MODULE                 */ 00183000
*                                                                  0152 00184000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00185000
*/*%INCLUDE SYSLIB  (IHACDE  )                                       */ 00186000
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 00187000
*/*%INCLUDE SYSLIB  (IEERDCM )                                       */ 00188000
*/*%INCLUDE SYSLIB  (IHALPDE )                                       */ 00189000
*/*%INCLUDE SYSLIB  (IHANVT  )                                       */ 00190000
*/*%INCLUDE SYSLIB  (IKJTCB  )                                       */ 00191000
*/*%INCLUDE SYSLIB  (IEFUCBOB)                                       */ 00192000
*/*%INCLUDE SYSLIB  (IEECUCM )                                       */ 00193000
*                                                                  0152 00194000
*       ;                                                          0152 00195000
         B     @EL00001                                            0152 00196000
@DATA    DS    0H                                                       00197000
         DS    0F                                                       00198000
@SA00001 DS    18F                                                      00199000
         DS    0F                                                       00200000
         DS    0D                                                       00201000
SACBPTR  DS    A                                                        00202000
UCMBASPT DS    A                                                        00203000
UCMDVEPT DS    A                                                        00204000
RQADDR   DS    F                                                        00205000
NP7DCMN  DC    CL8'DCM     '                                            00206000
         ORG   NP7DCMN                                                  00207000
@NM00084 DS    CL3                                                      00208000
NP7DCMNU DS    CL3                                                      00209000
@NM00085 DS    CL2                                                      00210000
         ORG   NP7DCMN+8                                                00211000
IEAVNP07 CSECT                                                          00212000
*********************************************************************** 00213000
*                                                                     * 00214000
*        MESSAGE FOR WTO                                              * 00215000
*                                                                     * 00216000
*********************************************************************** 00217000
MSG363I  DS    0H                      WTO                              00218000
         IEAPMNIP   TYPE=HEADER,MSGST=MSG363I,MSGEND=MSG1E              00219000
         DC    C'IEA363I '             MESSAGE TEXT                     00220000
MSG1P1   DC    CL8' '                  MODULE NAME                      00221000
         DC    C' NOT FOUND IN LPA'    MESSAGE TEXT                     00222000
MSG1P3   DC    C'; CONSOLE '           MESSAGE TEXT                     00223000
MSG1P2   DC    CL3' '                  DEVICE ADDRESS                   00224000
         DC    C' UNUSABLE'            MESSAGE TEXT                     00225000
MSG1E    EQU   *                                                        00226000
IEAVNP07 CSECT                                                          00227000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00228000
@01      EQU   01                                                       00229000
@02      EQU   02                                                       00230000
@03      EQU   03                                                       00231000
@04      EQU   04                                                       00232000
@05      EQU   05                                                       00233000
@06      EQU   06                                                       00234000
@07      EQU   07                                                       00235000
@08      EQU   08                                                       00236000
@09      EQU   09                                                       00237000
@10      EQU   10                                                       00238000
@11      EQU   11                                                       00239000
@12      EQU   12                                                       00240000
@13      EQU   13                                                       00241000
@14      EQU   14                                                       00242000
@15      EQU   15                                                       00243000
RBASE1   EQU   @12                                                      00244000
RBASE2   EQU   @05                                                      00245000
RPARM0   EQU   @00                                                      00246000
RPARM    EQU   @01                                                      00247000
CVTPTR   EQU   @03                                                      00248000
TCBPTR   EQU   @04                                                      00249000
DCMTSPTR EQU   @07                                                      00250000
RQADR    EQU   @08                                                      00251000
RNAME    EQU   @09                                                      00252000
UCBPTR   EQU   @11                                                      00253000
CDENTPTR EQU   @11                                                      00254000
LPDEPTR  EQU   @11                                                      00255000
RNVT     EQU   @02                                                      00256000
RCVT     EQU   @03                                                      00257000
REXIT    EQU   @14                                                      00258000
RENTRY   EQU   @15                                                      00259000
UCMEXTPT EQU   @01                                                      00260000
UCMMCSPT EQU   @01                                                      00261000
UCMEILPT EQU   @01                                                      00262000
UCMUEWPT EQU   @01                                                      00263000
RCODE    EQU   @15                                                      00264000
R7       EQU   @07                                                      00265000
CDENTRY  EQU   0                                                        00266000
CDENTPT  EQU   CDENTRY+16                                               00267000
CDATTR   EQU   CDENTRY+28                                               00268000
CDATTR2  EQU   CDENTRY+29                                               00269000
CVTMAP   EQU   0                                                        00270000
CVTDAR   EQU   CVTMAP+72                                                00271000
CVTFLGS1 EQU   CVTDAR                                                   00272000
CVTCUCB  EQU   CVTMAP+100                                               00273000
CVTDCB   EQU   CVTMAP+116                                               00274000
CVTOPTA  EQU   CVTMAP+182                                               00275000
CVTOPTB  EQU   CVTMAP+183                                               00276000
CVTQCDSR EQU   CVTMAP+184                                               00277000
CVTQLPAQ EQU   CVTMAP+188                                               00278000
CVTGTF   EQU   CVTMAP+236                                               00279000
CVTGTFST EQU   CVTGTF                                                   00280000
CVTGTFS  EQU   CVTGTFST                                                 00281000
CVTSTATE EQU   CVTGTFST                                                 00282000
CVTTMODE EQU   CVTGTFST                                                 00283000
CVTFORM  EQU   CVTGTFST                                                 00284000
CVTUSR   EQU   CVTGTFST                                                 00285000
CVTAQAVT EQU   CVTMAP+240                                               00286000
CVTTCMFG EQU   CVTAQAVT                                                 00287000
CVTVOLM2 EQU   CVTMAP+244                                               00288000
CVTTATA  EQU   CVTVOLM2                                                 00289000
CVTTSKS  EQU   CVTTATA                                                  00290000
CVTVOLF2 EQU   CVTTSKS                                                  00291000
CVTTAT   EQU   CVTTATA+1                                                00292000
CVTATER  EQU   CVTMAP+248                                               00293000
CVTEXT1  EQU   CVTMAP+252                                               00294000
CVTPURG  EQU   CVTMAP+260                                               00295000
CVTQMSG  EQU   CVTMAP+268                                               00296000
CVTDMSR  EQU   CVTMAP+272                                               00297000
CVTAPF   EQU   CVTMAP+324                                               00298000
CVTEXT2  EQU   CVTMAP+328                                               00299000
CVTHJES  EQU   CVTMAP+332                                               00300000
CVTPGSIA EQU   CVTMAP+348                                               00301000
CVTA1F1  EQU   CVTMAP+356                                               00302000
CVTSYSK  EQU   CVTMAP+357                                               00303000
CVTVOLM1 EQU   CVTMAP+380                                               00304000
CVTVOLF1 EQU   CVTVOLM1                                                 00305000
CVTATMCT EQU   CVTMAP+388                                               00306000
CVTXTNT1 EQU   0                                                        00307000
CVTXTNT2 EQU   0                                                        00308000
CVTDSSV  EQU   CVTXTNT2                                                 00309000
CVTRSV90 EQU   CVTXTNT2+5                                               00310000
CVTQID   EQU   CVTXTNT2+24                                              00311000
CVTRV400 EQU   CVTXTNT2+52                                              00312000
CVTRV409 EQU   CVTXTNT2+53                                              00313000
CVTATCVT EQU   CVTXTNT2+64                                              00314000
CVTRV429 EQU   CVTXTNT2+84                                              00315000
CVTRV438 EQU   CVTXTNT2+85                                              00316000
CVTRV457 EQU   CVTXTNT2+112                                             00317000
CVTRV466 EQU   CVTXTNT2+113                                             00318000
CVTFIX   EQU   0                                                        00319000
CVTRELNO EQU   CVTFIX+252                                               00320000
DCMTSRT  EQU   0                                                        00321000
DCMADTRN EQU   DCMTSRT                                                  00322000
DCMRFLGS EQU   DCMTSRT+5                                                00323000
@NM00012 EQU   DCMTSRT+14                                               00324000
DCMDEVTY EQU   DCMTSRT+15                                               00325000
DCMR2FLG EQU   DCMTSRT+44                                               00326000
DCMR3FLG EQU   DCMTSRT+45                                               00327000
DCMPACB  EQU   DCMTSRT+60                                               00328000
DCMACB   EQU   0                                                        00329000
DCMASACB EQU   DCMACB+5                                                 00330000
DCMACLR  EQU   DCMACB+9                                                 00331000
DCMAFLG1 EQU   DCMACLR+17                                               00332000
DCMAFLG2 EQU   DCMACLR+18                                               00333000
DCMATFLG EQU   DCMACLR+19                                               00334000
DCMADFLG EQU   DCMATFLG                                                 00335000
DCMATRCK EQU   DCMATFLG+1                                               00336000
LPDE     EQU   0                                                        00337000
LPDENTP  EQU   LPDE+16                                                  00338000
LPDEATTR EQU   LPDE+28                                                  00339000
LPDEATT2 EQU   LPDE+29                                                  00340000
LPDEMJNM EQU   LPDE+32                                                  00341000
NVT      EQU   0                                                        00342000
NVTNPATR EQU   NVT+54                                                   00343000
NVTNPREN EQU   NVTNPATR                                                 00344000
NVTFLLB  EQU   NVT+55                                                   00345000
NVTMSTCB EQU   NVT+56                                                   00346000
NVTABSAV EQU   NVT+140                                                  00347000
NVTFLCN  EQU   NVT+211                                                  00348000
NVTWTPSW EQU   NVT+224                                                  00349000
NVTWPSW2 EQU   NVTWTPSW+4                                               00350000
NVTFLWSC EQU   NVTWPSW2+3                                               00351000
NVTLOAD  EQU   NVT+232                                                  00352000
NVTSENSE EQU   NVT+236                                                  00353000
NVTSWAIT EQU   NVT+240                                                  00354000
NVTTIME  EQU   NVT+244                                                  00355000
NVTUCBFN EQU   NVT+248                                                  00356000
NVTWTO   EQU   NVT+252                                                  00357000
NVTWTOR  EQU   NVT+256                                                  00358000
NVTWTOR2 EQU   NVT+260                                                  00359000
NVTOPEN  EQU   NVT+264                                                  00360000
NVTMOUNT EQU   NVT+268                                                  00361000
NVTVIRT  EQU   NVT+276                                                  00362000
NVTREAL  EQU   NVT+280                                                  00363000
NVTSCHED EQU   NVT+284                                                  00364000
NVTOPIO  EQU   NVT+288                                                  00365000
NVTXCTL  EQU   NVT+428                                                  00366000
NVTLOCAT EQU   NVT+436                                                  00367000
NVTFLPO  EQU   NVT+528                                                  00368000
TCBFIX   EQU   0                                                        00369000
TCBFRS   EQU   TCBFIX                                                   00370000
TCB      EQU   0                                                        00371000
TCBPIE   EQU   TCB+4                                                    00372000
TCBPMASK EQU   TCBPIE                                                   00373000
TCBCMP   EQU   TCB+16                                                   00374000
TCBCMPF  EQU   TCBCMP                                                   00375000
TCBCPP   EQU   TCBCMPF                                                  00376000
TCBSTCC  EQU   TCBCMPF                                                  00377000
TCBCDBL  EQU   TCBCMPF                                                  00378000
TCBCWTO  EQU   TCBCMPF                                                  00379000
TCBCIND  EQU   TCBCMPF                                                  00380000
TCBCMSG  EQU   TCBCMPF                                                  00381000
TCBTRN   EQU   TCB+20                                                   00382000
TCBABF   EQU   TCBTRN                                                   00383000
TCBMSS   EQU   TCB+24                                                   00384000
TCBPKF   EQU   TCB+28                                                   00385000
TCBFLGS  EQU   TCB+29                                                   00386000
TCBFLGS1 EQU   TCBFLGS                                                  00387000
TCBFLGS2 EQU   TCBFLGS+1                                                00388000
TCBFLGS3 EQU   TCBFLGS+2                                                00389000
TCBFLGS4 EQU   TCBFLGS+3                                                00390000
TCBFLGS5 EQU   TCBFLGS+4                                                00391000
TCBABWF  EQU   TCBFLGS5                                                 00392000
TCBJPQ   EQU   TCB+44                                                   00393000
TCBPURGE EQU   TCBJPQ                                                   00394000
TCBGRS   EQU   TCB+48                                                   00395000
TCBFSA   EQU   TCB+112                                                  00396000
TCBTME   EQU   TCB+120                                                  00397000
TCBJSTCB EQU   TCB+124                                                  00398000
TCBTSFLG EQU   TCB+148                                                  00399000
TCBTSTSK EQU   TCBTSFLG                                                 00400000
TCBSTAB  EQU   TCB+160                                                  00401000
TCBNSTAE EQU   TCBSTAB                                                  00402000
TCBTCT   EQU   TCB+164                                                  00403000
TCBTCTGF EQU   TCBTCT                                                   00404000
TCBSCNDY EQU   TCB+172                                                  00405000
TCBNDSP  EQU   TCBSCNDY                                                 00406000
TCBNDSP1 EQU   TCBNDSP+1                                                00407000
TCBNDSP2 EQU   TCBNDSP+2                                                00408000
TCBNDSP3 EQU   TCBNDSP+3                                                00409000
TCBJSCB  EQU   TCB+180                                                  00410000
TCBRECDE EQU   TCBJSCB                                                  00411000
TCBEXT1  EQU   TCB+196                                                  00412000
TCBBITS  EQU   TCB+200                                                  00413000
TCBNDSP4 EQU   TCBBITS                                                  00414000
TCBNDSP5 EQU   TCBBITS+1                                                00415000
TCBFLGS6 EQU   TCBBITS+2                                                00416000
TCBFLGS7 EQU   TCBBITS+3                                                00417000
TCBDAR   EQU   TCB+204                                                  00418000
TCBDARC  EQU   TCBDAR                                                   00419000
TCBEXT2  EQU   TCB+208                                                  00420000
TCBFOE   EQU   TCB+244                                                  00421000
TCBESTAE EQU   TCB+264                                                  00422000
TCBESTRM EQU   TCBESTAE+1                                               00423000
TCBFBYT1 EQU   TCB+276                                                  00424000
TCBFBYT2 EQU   TCB+277                                                  00425000
TCBRV124 EQU   TCB+278                                                  00426000
TCBRV133 EQU   TCB+279                                                  00427000
TCBXTNT2 EQU   0                                                        00428000
TCBGTF   EQU   TCBXTNT2                                                 00429000
TCBTFLG  EQU   TCBGTF                                                   00430000
TCBRV146 EQU   TCBXTNT2+28                                              00431000
TCBRV155 EQU   TCBXTNT2+29                                              00432000
TCBRV164 EQU   TCBXTNT2+30                                              00433000
TCBRV173 EQU   TCBXTNT2+31                                              00434000
UCB      EQU   0                                                        00435000
UCBOB    EQU   0                                                        00436000
UCBJBNR  EQU   UCBOB                                                    00437000
UCBFL5   EQU   UCBOB+1                                                  00438000
UCBAF    EQU   UCBFL5                                                   00439000
UCBSTAT  EQU   UCBOB+3                                                  00440000
UCBSYSR  EQU   UCBSTAT                                                  00441000
UCBCHAN  EQU   UCBOB+4                                                  00442000
UCBSFLS  EQU   UCBOB+6                                                  00443000
UCBFLA   EQU   UCBSFLS                                                  00444000
UCBFL1   EQU   UCBFLA                                                   00445000
UCBBSY   EQU   UCBFL1                                                   00446000
UCBNRY   EQU   UCBFL1                                                   00447000
UCBPST   EQU   UCBFL1                                                   00448000
UCBCUB   EQU   UCBFL1                                                   00449000
UCBFLB   EQU   UCBSFLS+1                                                00450000
UCBCHM   EQU   UCBOB+8                                                  00451000
UCBCHM1  EQU   UCBCHM                                                   00452000
UCBPTH0  EQU   UCBCHM1                                                  00453000
UCBPTH1  EQU   UCBCHM1                                                  00454000
UCBWGT   EQU   UCBOB+12                                                 00455000
UCBNAME  EQU   UCBOB+13                                                 00456000
UCBTYP   EQU   UCBOB+16                                                 00457000
UCBTBYT1 EQU   UCBTYP                                                   00458000
UCB1FEA5 EQU   UCBTBYT1                                                 00459000
UCB1FEA6 EQU   UCBTBYT1                                                 00460000
UCBTBYT2 EQU   UCBTYP+1                                                 00461000
UCB2OPT2 EQU   UCBTBYT2                                                 00462000
UCBDUDN1 EQU   UCB2OPT2                                                 00463000
UCB2OPT3 EQU   UCBTBYT2                                                 00464000
UCBDUDN2 EQU   UCB2OPT3                                                 00465000
UCB2OPT4 EQU   UCBTBYT2                                                 00466000
UCB2OPT6 EQU   UCBTBYT2                                                 00467000
UCB2OPT7 EQU   UCBTBYT2                                                 00468000
UCBTBYT3 EQU   UCBTYP+2                                                 00469000
UCBDVCLS EQU   UCBTBYT3                                                 00470000
UCBTBYT4 EQU   UCBTYP+3                                                 00471000
UCBEXTPT EQU   UCBOB+20                                                 00472000
UCBFLC   EQU   UCBEXTPT                                                 00473000
UCBDEV   EQU   UCBOB+24                                                 00474000
UCBCMEXT EQU   0                                                        00475000
UCBATI   EQU   UCBCMEXT+3                                               00476000
@NM00080 EQU   UCBATI                                                   00477000
UCBFLP1  EQU   UCBCMEXT+5                                               00478000
UCBMT    EQU   0                                                        00479000
UCBOCR   EQU   0                                                        00480000
UCBUCS   EQU   0                                                        00481000
UCBUCSOP EQU   UCBUCS+4                                                 00482000
UCBFCBOP EQU   UCBUCS+5                                                 00483000
UCM2EXT  EQU   0                                                        00484000
UCM2STA  EQU   UCM2EXT+8                                                00485000
UCM2SFLG EQU   UCM2STA                                                  00486000
UCMPRFX  EQU   0                                                        00487000
UCMSAVE0 EQU   UCMPRFX+4                                                00488000
UCMSFLGS EQU   UCMPRFX+84                                               00489000
UCMSFLG1 EQU   UCMSFLGS                                                 00490000
UCMSFLG2 EQU   UCMSFLGS+1                                               00491000
UCMXSA   EQU   UCMPRFX+104                                              00492000
UCMSDS1  EQU   UCMPRFX+156                                              00493000
UCM      EQU   0                                                        00494000
UCMDECB  EQU   UCM+12                                                   00495000
UCMRPYI  EQU   UCM+32                                                   00496000
UCMPXB   EQU   UCM+68                                                   00497000
UCMMODE  EQU   UCMPXB                                                   00498000
UCMVDATA EQU   UCM+72                                                   00499000
UCMVEA   EQU   UCMVDATA                                                 00500000
UCMVEZ   EQU   UCMVDATA+4                                               00501000
UCMVEL   EQU   UCMVDATA+8                                               00502000
UCMRSV42 EQU   UCM+300                                                  00503000
UCMRSV51 EQU   UCM+301                                                  00504000
UCMEIL   EQU   0                                                        00505000
UCMRECBA EQU   UCMEIL+24                                                00506000
UCMEXIT  EQU   0                                                        00507000
UCMLIST  EQU   0                                                        00508000
UCMUCB   EQU   UCMLIST+12                                               00509000
UCMSTS   EQU   UCMLIST+24                                               00510000
UCMATR   EQU   UCMLIST+25                                               00511000
UCMXA    EQU   UCMLIST+26                                               00512000
UCMXB    EQU   UCMLIST+28                                               00513000
UCMAUTH  EQU   UCMLIST+40                                               00514000
UCMAUTHA EQU   UCMAUTH                                                  00515000
UCMDISP  EQU   UCMLIST+42                                               00516000
UCMDISP1 EQU   UCMDISP                                                  00517000
UCMDISPA EQU   UCMDISP1                                                 00518000
UCMDISPC EQU   UCMDISP1                                                 00519000
UCMDISP2 EQU   UCMDISP+1                                                00520000
UCMMSG   EQU   UCMLIST+60                                               00521000
UCMMSG1  EQU   UCMMSG                                                   00522000
UCMDEVC  EQU   UCMLIST+63                                               00523000
UCMRCT   EQU   UCMLIST+68                                               00524000
UCMSDS5  EQU   UCMRCT                                                   00525000
DCMREND  EQU   0                                                        00526000
UCBBGN   EQU   0                                                        00527000
UCMPRFXP EQU   0                                                        00528000
UCM2PTR  EQU   0                                                        00529000
CVTS01   EQU   CVTPGSIA                                                 00530000
CVTLPDSR EQU   CVTS01+4                                                 00531000
CVTLPDIA EQU   CVTS01+12                                                00532000
CVTDIRST EQU   CVTLPDIA                                                 00533000
CVTSLIDA EQU   CVTS01+24                                                00534000
CVTCTLFG EQU   CVTS01+50                                                00535000
CVTRV210 EQU   CVTS01+424                                               00536000
CVTRV219 EQU   CVTS01+425                                               00537000
CVTRV228 EQU   CVTS01+426                                               00538000
CVTRV237 EQU   CVTS01+427                                               00539000
CVTMFRTR EQU   CVTS01+452                                               00540000
CVTRV262 EQU   CVTS01+468                                               00541000
CVTRV271 EQU   CVTS01+469                                               00542000
CVTRV280 EQU   CVTS01+470                                               00543000
CVTRV289 EQU   CVTS01+471                                               00544000
CVTGSDA  EQU   CVTS01+600                                               00545000
UCBOBS01 EQU   UCBDEV                                                   00546000
UCBSTAB  EQU   UCBOBS01+10                                              00547000
UCBBSVL  EQU   UCBSTAB                                                  00548000
UCBPRSRS EQU   UCBSTAB                                                  00549000
UCBDMCT  EQU   UCBOBS01+11                                              00550000
UCBFL4   EQU   UCBOBS01+13                                              00551000
UCBOBS02 EQU   UCBDEV                                                   00552000
UCBTFL1  EQU   UCBOBS02+19                                              00553000
UCBXTN   EQU   UCBOBS02+20                                              00554000
UCBVOPT  EQU   UCBXTN                                                   00555000
UCBOBS03 EQU   UCBDEV                                                   00556000
UCBXTADR EQU   UCBOBS03                                                 00557000
UCBOBS04 EQU   UCBDEV                                                   00558000
UCBBTA   EQU   UCBOBS04+12                                              00559000
UCBOBS06 EQU   UCBDEV                                                   00560000
UCBAOF   EQU   UCBOBS06                                                 00561000
UCBAOF1  EQU   UCBAOF                                                   00562000
UCBAOF2  EQU   UCBAOF+1                                                 00563000
@NM00079 EQU   UCBOBS06+3                                               00564000
UCBIRB   EQU   UCBOBS06+4                                               00565000
UCBGRAF  EQU   UCBIRB                                                   00566000
UCBLDNCA EQU   UCBOBS06+8                                               00567000
UCBRDYQ  EQU   UCBLDNCA                                                 00568000
UCBIRLN  EQU   UCBRDYQ                                                  00569000
UCBLDNCB EQU   UCBRDYQ+1                                                00570000
UCBCTLNK EQU   UCBOBS06+12                                              00571000
UCBOBS07 EQU   UCBDEV                                                   00572000
UCBOBS08 EQU   UCBDEV                                                   00573000
UCMIECBA EQU   UCMRECBA+4                                               00574000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00575000
UCMIECBP EQU   UCMIECBA+1                                               00576000
UCMIECBF EQU   UCMIECBA                                                 00577000
UCBRV042 EQU   UCBOBS08+5                                               00578000
UCBCTCF1 EQU   UCBOBS08+4                                               00579000
UCBCTCAD EQU   UCBOBS08                                                 00580000
UCBICNCB EQU   UCBOBS07+4                                               00581000
UCBRV040 EQU   UCBOBS07                                                 00582000
UCBCTLNA EQU   UCBCTLNK+1                                               00583000
UCBRLN   EQU   UCBCTLNK                                                 00584000
UCBRDYQA EQU   UCBLDNCB                                                 00585000
UCBINRLN EQU   UCBIRLN                                                  00586000
UCBIRBA  EQU   UCBIRB+1                                                 00587000
UCBRV039 EQU   UCBGRAF                                                  00588000
UCBDWNR  EQU   UCBGRAF                                                  00589000
UCBRPND  EQU   UCBGRAF                                                  00590000
UCBUPM   EQU   UCBGRAF                                                  00591000
UCBBTAM  EQU   UCBGRAF                                                  00592000
UCBDRNO  EQU   UCBGRAF                                                  00593000
UCBDRO   EQU   UCBGRAF                                                  00594000
UCBOIP   EQU   UCBGRAF                                                  00595000
UCBATRCD EQU   @NM00079                                                 00596000
UCBSKPFG EQU   @NM00079                                                 00597000
UCBRIPND EQU   @NM00079                                                 00598000
UCBRTIAC EQU   @NM00079                                                 00599000
UCBRSV79 EQU   @NM00079                                                 00600000
UCBRSV78 EQU   @NM00079                                                 00601000
UCBRSV77 EQU   @NM00079                                                 00602000
UCBOLTEP EQU   @NM00079                                                 00603000
UCBATNCT EQU   UCBOBS06+2                                               00604000
UCBRSV76 EQU   UCBAOF2                                                  00605000
UCBRSV75 EQU   UCBAOF2                                                  00606000
UCBRSV74 EQU   UCBAOF2                                                  00607000
UCBRSV73 EQU   UCBAOF2                                                  00608000
UCBRSV72 EQU   UCBAOF2                                                  00609000
UCBRSV71 EQU   UCBAOF2                                                  00610000
UCBRSV70 EQU   UCBAOF2                                                  00611000
UCBRSV69 EQU   UCBAOF2                                                  00612000
UCBRSV68 EQU   UCBAOF1                                                  00613000
UCBRSV67 EQU   UCBAOF1                                                  00614000
UCBRSV66 EQU   UCBAOF1                                                  00615000
UCBRSV65 EQU   UCBAOF1                                                  00616000
UCBRSV64 EQU   UCBAOF1                                                  00617000
UCBOFNL  EQU   UCBAOF1                                                  00618000
UCBOFSP  EQU   UCBAOF1                                                  00619000
UCBOFMCR EQU   UCBAOF1                                                  00620000
UCBBTB   EQU   UCBBTA+1                                                 00621000
UCBDI    EQU   UCBBTA                                                   00622000
UCBSTART EQU   UCBOBS04+8                                               00623000
UCBTEB   EQU   UCBOBS04+4                                               00624000
UCBGCB   EQU   UCBOBS04+3                                               00625000
UCBOPEN  EQU   UCBOBS04+2                                               00626000
UCBRES1C EQU   UCBOBS04                                                 00627000
UCBXTNB  EQU   UCBXTN+1                                                 00628000
UCBRSV22 EQU   UCBVOPT                                                  00629000
UCBRSV21 EQU   UCBVOPT                                                  00630000
UCBRSV20 EQU   UCBVOPT                                                  00631000
UCBESVE  EQU   UCBVOPT                                                  00632000
UCBERPC  EQU   UCBVOPT                                                  00633000
UCBESVC  EQU   UCBVOPT                                                  00634000
UCBEVA   EQU   UCBVOPT                                                  00635000
UCBESV   EQU   UCBVOPT                                                  00636000
UCBRV009 EQU   UCBTFL1                                                  00637000
UCBRV008 EQU   UCBTFL1                                                  00638000
UCBRV007 EQU   UCBTFL1                                                  00639000
UCBRV006 EQU   UCBTFL1                                                  00640000
UCBRV005 EQU   UCBTFL1                                                  00641000
UCBRV038 EQU   UCBTFL1                                                  00642000
UCBNSLTP EQU   UCBTFL1                                                  00643000
UCBNLTP  EQU   UCBTFL1                                                  00644000
UCBRES1B EQU   UCBOBS02+18                                              00645000
UCBFSER  EQU   UCBOBS02+12                                              00646000
@NM00078 EQU   UCBOBS02+4                                               00647000
UCBFSEQ  EQU   UCBOBS02+2                                               00648000
UCBFSCT  EQU   UCBOBS02                                                 00649000
UCBNEXP  EQU   UCBOBS01+20                                              00650000
UCBBASE  EQU   UCBOBS01+16                                              00651000
UCBRES1A EQU   UCBOBS01+15                                              00652000
UCBUSER  EQU   UCBOBS01+14                                              00653000
UCBFL47  EQU   UCBFL4                                                   00654000
UCBFL46  EQU   UCBFL4                                                   00655000
UCBFL45  EQU   UCBFL4                                                   00656000
UCBFL44  EQU   UCBFL4                                                   00657000
UCBDSS   EQU   UCBFL4                                                   00658000
UCBRV028 EQU   UCBFL4                                                   00659000
UCBWDAV  EQU   UCBFL4                                                   00660000
UCBDAVV  EQU   UCBFL4                                                   00661000
UCBSQC   EQU   UCBOBS01+12                                              00662000
UCBDATP  EQU   UCBOBS01+12                                              00663000
UCBDMC   EQU   UCBDMCT                                                  00664000
UCBMOUNT EQU   UCBDMCT                                                  00665000
UCBBNUL  EQU   UCBSTAB                                                  00666000
UCBSHAR  EQU   UCBSTAB                                                  00667000
UCBBSTR  EQU   UCBSTAB                                                  00668000
UCBBPUB  EQU   UCBSTAB                                                  00669000
UCBBPRV  EQU   UCBSTAB                                                  00670000
UCBBALB  EQU   UCBPRSRS                                                 00671000
UCBPGFL  EQU   UCBSTAB                                                  00672000
UCBDVSHR EQU   UCBBSVL                                                  00673000
UCBVOLI  EQU   UCBOBS01+4                                               00674000
UCBVTOC  EQU   UCBOBS01                                                 00675000
CVTTPIO  EQU   CVTS01+608                                               00676000
CVTADV   EQU   CVTS01+604                                               00677000
CVTGSDAB EQU   CVTGSDA                                                  00678000
CVTQV3   EQU   CVTS01+596                                               00679000
CVTQV2   EQU   CVTS01+592                                               00680000
CVTQV1   EQU   CVTS01+588                                               00681000
CVTRPT   EQU   CVTS01+584                                               00682000
CVTSSRB  EQU   CVTS01+580                                               00683000
CVTCSDRL EQU   CVTS01+576                                               00684000
CVTEXP1  EQU   CVTS01+572                                               00685000
CVTRMPMT EQU   CVTS01+568                                               00686000
CVTRMPTT EQU   CVTS01+564                                               00687000
CVTVPSA  EQU   CVTS01+560                                               00688000
CVTVSTOP EQU   CVTS01+556                                               00689000
CVTGTFR8 EQU   CVTS01+552                                               00690000
CVTQUIT  EQU   CVTS01+548                                               00691000
CVTVACR  EQU   CVTS01+544                                               00692000
CVTWTCB  EQU   CVTS01+540                                               00693000
CVTSTPRS EQU   CVTS01+536                                               00694000
CVT0PT02 EQU   CVTS01+532                                               00695000
CVTDARCM EQU   CVTS01+528                                               00696000
CVTIRECM EQU   CVTS01+524                                               00697000
CVTJRECM EQU   CVTS01+520                                               00698000
CVTVEMS0 EQU   CVTS01+516                                               00699000
CVTSPFRR EQU   CVTS01+512                                               00700000
CVTRLSTG EQU   CVTS01+508                                               00701000
CVT0TC0A EQU   CVTS01+504                                               00702000
CVTGMBR  EQU   CVTS01+500                                               00703000
CVTLFRM  EQU   CVTS01+496                                               00704000
CVTRMBR  EQU   CVTS01+492                                               00705000
CVTVIOP  EQU   CVTS01+488                                               00706000
CVTRV307 EQU   CVTS01+486                                               00707000
CVTRV306 EQU   CVTS01+484                                               00708000
CVTRV305 EQU   CVTS01+482                                               00709000
CVTRV304 EQU   CVTS01+480                                               00710000
CVTRV303 EQU   CVTS01+478                                               00711000
CVTRV302 EQU   CVTS01+476                                               00712000
CVTRV301 EQU   CVTS01+475                                               00713000
CVTRV300 EQU   CVTS01+474                                               00714000
CVTRV299 EQU   CVTS01+473                                               00715000
CVTRV298 EQU   CVTS01+472                                               00716000
CVTRV297 EQU   CVTRV289                                                 00717000
CVTRV296 EQU   CVTRV289                                                 00718000
CVTRV295 EQU   CVTRV289                                                 00719000
CVTRV294 EQU   CVTRV289                                                 00720000
CVTRV293 EQU   CVTRV289                                                 00721000
CVTRV292 EQU   CVTRV289                                                 00722000
CVTRV291 EQU   CVTRV289                                                 00723000
CVTRV290 EQU   CVTRV289                                                 00724000
CVTRV288 EQU   CVTRV280                                                 00725000
CVTRV287 EQU   CVTRV280                                                 00726000
CVTRV286 EQU   CVTRV280                                                 00727000
CVTRV285 EQU   CVTRV280                                                 00728000
CVTRV284 EQU   CVTRV280                                                 00729000
CVTRV283 EQU   CVTRV280                                                 00730000
CVTRV282 EQU   CVTRV280                                                 00731000
CVTRV281 EQU   CVTRV280                                                 00732000
CVTRV279 EQU   CVTRV271                                                 00733000
CVTRV278 EQU   CVTRV271                                                 00734000
CVTRV277 EQU   CVTRV271                                                 00735000
CVTRV276 EQU   CVTRV271                                                 00736000
CVTRV275 EQU   CVTRV271                                                 00737000
CVTRV274 EQU   CVTRV271                                                 00738000
CVTRV273 EQU   CVTRV271                                                 00739000
CVTRV272 EQU   CVTRV271                                                 00740000
CVTRV270 EQU   CVTRV262                                                 00741000
CVTRV269 EQU   CVTRV262                                                 00742000
CVTRV268 EQU   CVTRV262                                                 00743000
CVTRV267 EQU   CVTRV262                                                 00744000
CVTRV266 EQU   CVTRV262                                                 00745000
CVTRV265 EQU   CVTRV262                                                 00746000
CVTRV264 EQU   CVTRV262                                                 00747000
CVTRV263 EQU   CVTRV262                                                 00748000
CVTVFP   EQU   CVTS01+464                                               00749000
CVTVSI   EQU   CVTS01+460                                               00750000
CVTVPSIB EQU   CVTS01+456                                               00751000
CVTMFACT EQU   CVTMFRTR                                                 00752000
CVTMFCTL EQU   CVTS01+448                                               00753000
CVTPVBP  EQU   CVTS01+444                                               00754000
CVTPWI   EQU   CVTS01+440                                               00755000
CVTRV254 EQU   CVTS01+438                                               00756000
CVTRV253 EQU   CVTS01+436                                               00757000
CVTRV252 EQU   CVTS01+434                                               00758000
CVTRV251 EQU   CVTS01+433                                               00759000
CVTRV250 EQU   CVTS01+432                                               00760000
CVTRV249 EQU   CVTS01+431                                               00761000
CVTRV248 EQU   CVTS01+430                                               00762000
CVTRV247 EQU   CVTS01+429                                               00763000
CVTRV246 EQU   CVTS01+428                                               00764000
CVTRV245 EQU   CVTRV237                                                 00765000
CVTRV244 EQU   CVTRV237                                                 00766000
CVTRV243 EQU   CVTRV237                                                 00767000
CVTRV242 EQU   CVTRV237                                                 00768000
CVTRV241 EQU   CVTRV237                                                 00769000
CVTRV240 EQU   CVTRV237                                                 00770000
CVTRV239 EQU   CVTRV237                                                 00771000
CVTRV238 EQU   CVTRV237                                                 00772000
CVTRV236 EQU   CVTRV228                                                 00773000
CVTRV235 EQU   CVTRV228                                                 00774000
CVTRV234 EQU   CVTRV228                                                 00775000
CVTRV233 EQU   CVTRV228                                                 00776000
CVTRV232 EQU   CVTRV228                                                 00777000
CVTRV231 EQU   CVTRV228                                                 00778000
CVTRV230 EQU   CVTRV228                                                 00779000
CVTRV229 EQU   CVTRV228                                                 00780000
CVTRV227 EQU   CVTRV219                                                 00781000
CVTRV226 EQU   CVTRV219                                                 00782000
CVTRV225 EQU   CVTRV219                                                 00783000
CVTRV224 EQU   CVTRV219                                                 00784000
CVTRV223 EQU   CVTRV219                                                 00785000
CVTRV222 EQU   CVTRV219                                                 00786000
CVTRV221 EQU   CVTRV219                                                 00787000
CVTRV220 EQU   CVTRV219                                                 00788000
CVTRV218 EQU   CVTRV210                                                 00789000
CVTRV217 EQU   CVTRV210                                                 00790000
CVTRV216 EQU   CVTRV210                                                 00791000
CVTRV215 EQU   CVTRV210                                                 00792000
CVTRV214 EQU   CVTRV210                                                 00793000
CVTRV213 EQU   CVTRV210                                                 00794000
CVTRV212 EQU   CVTRV210                                                 00795000
CVTRV211 EQU   CVTRV210                                                 00796000
CVTLCCAT EQU   CVTS01+420                                               00797000
CVTPCCAT EQU   CVTS01+416                                               00798000
CVTIPCRP EQU   CVTS01+412                                               00799000
CVTIPCRI EQU   CVTS01+408                                               00800000
CVTIPCDS EQU   CVTS01+404                                               00801000
CVTAIDVT EQU   CVTS01+400                                               00802000
CVTSSAP  EQU   CVTS01+396                                               00803000
CVTEHCIR EQU   CVTS01+392                                               00804000
CVTEHDEF EQU   CVTS01+388                                               00805000
CVTDAIR  EQU   CVTS01+384                                               00806000
CVTPERFM EQU   CVTS01+380                                               00807000
CVT044R2 EQU   CVTS01+376                                               00808000
CVTFETCH EQU   CVTS01+372                                               00809000
CVTRSTWD EQU   CVTS01+368                                               00810000
CVTSPOST EQU   CVTS01+364                                               00811000
CVTIOBP  EQU   CVTS01+360                                               00812000
CVTASMVT EQU   CVTS01+356                                               00813000
CVTRECRQ EQU   CVTS01+352                                               00814000
CVTWSAC  EQU   CVTS01+348                                               00815000
CVTWSAG  EQU   CVTS01+344                                               00816000
CVTWSAL  EQU   CVTS01+340                                               00817000
CVTSPSA  EQU   CVTS01+336                                               00818000
CVTGLMN  EQU   CVTS01+332                                               00819000
CVTVEAC0 EQU   CVTS01+328                                               00820000
CVT062R1 EQU   CVTS01+324                                               00821000
CVTRPOST EQU   CVTS01+320                                               00822000
CVTDQIQE EQU   CVTS01+316                                               00823000
CVTCSD   EQU   CVTS01+312                                               00824000
CVTLKRMA EQU   CVTS01+308                                               00825000
CVTRSPIE EQU   CVTS01+304                                               00826000
CVTRENQ  EQU   CVTS01+300                                               00827000
CVTLQCB  EQU   CVTS01+296                                               00828000
CVTFQCB  EQU   CVTS01+292                                               00829000
CVTQCS01 EQU   CVTS01+288                                               00830000
CVTAPFT  EQU   CVTS01+284                                               00831000
CVTPARRL EQU   CVTS01+280                                               00832000
CVTVWAIT EQU   CVTS01+276                                               00833000
CVTGSPL  EQU   CVTS01+272                                               00834000
CVTLSMQ  EQU   CVTS01+268                                               00835000
CVTGSMQ  EQU   CVTS01+264                                               00836000
CVTEXPRO EQU   CVTS01+260                                               00837000
CVTOPCTP EQU   CVTS01+256                                               00838000
CVTSIC   EQU   CVTS01+252                                               00839000
CVTTPIOS EQU   CVTS01+248                                               00840000
CVTRTMS  EQU   CVTS01+244                                               00841000
CVTSDBF  EQU   CVTS01+240                                               00842000
CVTSCBP  EQU   CVTS01+236                                               00843000
CVTSDMP  EQU   CVTS01+232                                               00844000
CVTSV60  EQU   CVTS01+228                                               00845000
CVTRTMCT EQU   CVTS01+224                                               00846000
CVTASCBL EQU   CVTS01+220                                               00847000
CVTASCBH EQU   CVTS01+216                                               00848000
CVTGDA   EQU   CVTS01+212                                               00849000
CVTASVT  EQU   CVTS01+208                                               00850000
CVTVVMDI EQU   CVTS01+204                                               00851000
CVTAQTOP EQU   CVTS01+200                                               00852000
CVTIOSCS EQU   CVTS01+196                                               00853000
CVTSDRM  EQU   CVTS01+192                                               00854000
CVTOPTE  EQU   CVTS01+188                                               00855000
CVTSTXU  EQU   CVTS01+184                                               00856000
CVTQUIS  EQU   CVTS01+180                                               00857000
CVTPARS  EQU   CVTS01+176                                               00858000
CVTS1EE  EQU   CVTS01+172                                               00859000
CVTFRAS  EQU   CVTS01+168                                               00860000
CVTQSAS  EQU   CVTS01+164                                               00861000
CVTCRAS  EQU   CVTS01+160                                               00862000
CVTCRMN  EQU   CVTS01+156                                               00863000
CVTDELCP EQU   CVTS01+152                                               00864000
CVTFRECL EQU   CVTS01+148                                               00865000
CVTGETCL EQU   CVTS01+144                                               00866000
CVTBLDCP EQU   CVTS01+140                                               00867000
CVTAUTHL EQU   CVTS01+136                                               00868000
CVTSCAN  EQU   CVTS01+132                                               00869000
CVTRV144 EQU   CVTS01+130                                               00870000
CVTMAXMP EQU   CVTS01+128                                               00871000
CVTSTCK  EQU   CVTS01+124                                               00872000
CVTRV139 EQU   CVTS01+123                                               00873000
CVTDSSAC EQU   CVTS01+122                                               00874000
CVTRV513 EQU   CVTS01+121                                               00875000
CVTIOSPL EQU   CVTS01+120                                               00876000
CVTPTGT  EQU   CVTS01+116                                               00877000
CVTCSPIE EQU   CVTS01+112                                               00878000
CVTSMFEX EQU   CVTS01+108                                               00879000
CVTOLT0A EQU   CVTS01+104                                               00880000
CVTSRBRT EQU   CVTS01+100                                               00881000
CVTPUTL  EQU   CVTS01+96                                                00882000
CVTSYSWT EQU   CVTS01+92                                                00883000
CVTRV327 EQU   CVTS01+88                                                00884000
CVTRV326 EQU   CVTS01+84                                                00885000
CVTRV325 EQU   CVTS01+80                                                00886000
CVTRV324 EQU   CVTS01+76                                                00887000
CVT0VL01 EQU   CVTS01+72                                                00888000
CVTSHRVM EQU   CVTS01+68                                                00889000
CVTRV332 EQU   CVTS01+64                                                00890000
CVTTAS   EQU   CVTS01+60                                                00891000
CVTRSCN  EQU   CVTS01+56                                                00892000
CVTTRAC2 EQU   CVTS01+54                                                00893000
CVTTRACE EQU   CVTS01+52                                                00894000
CVTAPG   EQU   CVTS01+51                                                00895000
CVTSDTRC EQU   CVTCTLFG                                                 00896000
CVTGTRCE EQU   CVTCTLFG                                                 00897000
CVTNOMP  EQU   CVTCTLFG                                                 00898000
CVTRSV79 EQU   CVTCTLFG                                                 00899000
CVTDSTAT EQU   CVTCTLFG                                                 00900000
CVTRSV78 EQU   CVTCTLFG                                                 00901000
CVTRV333 EQU   CVTCTLFG                                                 00902000
CVTRV323 EQU   CVTCTLFG                                                 00903000
CVTSPVLK EQU   CVTS01+49                                                00904000
CVTRSV77 EQU   CVTS01+48                                                00905000
CVTRV331 EQU   CVTS01+44                                                00906000
CVTRV330 EQU   CVTS01+40                                                00907000
CVTRV329 EQU   CVTS01+36                                                00908000
CVTRV328 EQU   CVTS01+32                                                00909000
CVTRV322 EQU   CVTS01+28                                                00910000
CVTSLID  EQU   CVTSLIDA+1                                               00911000
CVTSYLK  EQU   CVTSLIDA                                                 00912000
CVTRV321 EQU   CVTS01+20                                                00913000
CVTRV320 EQU   CVTS01+16                                                00914000
CVTLPDIR EQU   CVTLPDIA+1                                               00915000
CVTRSV69 EQU   CVTDIRST                                                 00916000
CVTRSV68 EQU   CVTDIRST                                                 00917000
CVTRSV67 EQU   CVTDIRST                                                 00918000
CVTRSV66 EQU   CVTDIRST                                                 00919000
CVTRSV65 EQU   CVTDIRST                                                 00920000
CVTRSV64 EQU   CVTDIRST                                                 00921000
CVTRSV63 EQU   CVTDIRST                                                 00922000
CVTDICOM EQU   CVTDIRST                                                 00923000
CVTPVTP  EQU   CVTS01+8                                                 00924000
CVTGETL  EQU   CVTS01                                                   00925000
UCMRCTA  EQU   UCMRCT+1                                                 00926000
UCMRSV31 EQU   UCMSDS5                                                  00927000
UCMSDS5G EQU   UCMSDS5                                                  00928000
UCMSDS5F EQU   UCMSDS5                                                  00929000
UCMRSV30 EQU   UCMSDS5                                                  00930000
UCMRSV29 EQU   UCMSDS5                                                  00931000
UCMSDS5C EQU   UCMSDS5                                                  00932000
UCMSDS5B EQU   UCMSDS5                                                  00933000
UCMSDS5A EQU   UCMSDS5                                                  00934000
UCMMLAST EQU   UCMLIST+64                                               00935000
UCMVHRSN EQU   UCMDEVC                                                  00936000
UCMDEVG  EQU   UCMDEVC                                                  00937000
UCMDEVF  EQU   UCMDEVC                                                  00938000
UCMDEVE  EQU   UCMDEVC                                                  00939000
UCMDEVD  EQU   UCMDEVC                                                  00940000
UCMDEVCC EQU   UCMDEVC                                                  00941000
UCMDEVB  EQU   UCMDEVC                                                  00942000
UCMDEVA  EQU   UCMDEVC                                                  00943000
UCMXOR   EQU   UCMLIST+62                                               00944000
UCMMSG2  EQU   UCMMSG+1                                                 00945000
UCMRSV27 EQU   UCMMSG1                                                  00946000
UCMRSV26 EQU   UCMMSG1                                                  00947000
UCMMSGF  EQU   UCMMSG1                                                  00948000
UCMMSGE  EQU   UCMMSG1                                                  00949000
UCMMSGD  EQU   UCMMSG1                                                  00950000
UCMMSGC  EQU   UCMMSG1                                                  00951000
UCMMSGB  EQU   UCMMSG1                                                  00952000
UCMMSGA  EQU   UCMMSG1                                                  00953000
UCMCOMPC EQU   UCMLIST+56                                               00954000
UCMWLAST EQU   UCMLIST+52                                               00955000
UCMOAOEN EQU   UCMLIST+48                                               00956000
UCMALTEN EQU   UCMLIST+44                                               00957000
UCMRV007 EQU   UCMDISP2                                                 00958000
UCMRV006 EQU   UCMDISP2                                                 00959000
UCMRV005 EQU   UCMDISP2                                                 00960000
UCMRV004 EQU   UCMDISP2                                                 00961000
UCMRV003 EQU   UCMDISP2                                                 00962000
UCMRV002 EQU   UCMDISP2                                                 00963000
UCMDISPJ EQU   UCMDISP2                                                 00964000
UCMDISPI EQU   UCMDISP2                                                 00965000
UCMDISPH EQU   UCMDISP1                                                 00966000
UCMDISPG EQU   UCMDISP1                                                 00967000
UCMDISPF EQU   UCMDISP1                                                 00968000
UCMDISPE EQU   UCMDISP1                                                 00969000
UCMDISPD EQU   UCMDISP1                                                 00970000
UCMDISPB EQU   UCMDISP1                                                 00971000
UCMAUTHB EQU   UCMAUTH+1                                                00972000
UCMRSV23 EQU   UCMAUTHA                                                 00973000
UCMRSV22 EQU   UCMAUTHA                                                 00974000
UCMRSV21 EQU   UCMAUTHA                                                 00975000
UCMRSV20 EQU   UCMAUTHA                                                 00976000
UCMRSV19 EQU   UCMAUTHA                                                 00977000
UCMAUTH3 EQU   UCMAUTHA                                                 00978000
UCMAUTH2 EQU   UCMAUTHA                                                 00979000
UCMAUTH1 EQU   UCMAUTHA                                                 00980000
UCMOUTQ  EQU   UCMLIST+36                                               00981000
UCMRSV18 EQU   UCMLIST+34                                               00982000
UCMRTCD  EQU   UCMLIST+32                                               00983000
@NM00083 EQU   UCMXA+1                                                  00984000
UCMID    EQU   UCMXA                                                    00985000
UCMRSV17 EQU   UCMATR                                                   00986000
UCMRSV16 EQU   UCMATR                                                   00987000
UCMAT04  EQU   UCMATR                                                   00988000
UCMLF    EQU   UCMATR                                                   00989000
UCMUF    EQU   UCMATR                                                   00990000
UCMXF    EQU   UCMATR                                                   00991000
UCMIF    EQU   UCMATR                                                   00992000
UCMOF    EQU   UCMATR                                                   00993000
UCMTC    EQU   UCMSTS                                                   00994000
UCMTD    EQU   UCMSTS                                                   00995000
UCMTB    EQU   UCMSTS                                                   00996000
UCMTA    EQU   UCMSTS                                                   00997000
UCMCF    EQU   UCMSTS                                                   00998000
UCMBF    EQU   UCMSTS                                                   00999000
UCMPF    EQU   UCMSTS                                                   01000000
UCMAF    EQU   UCMSTS                                                   01001000
UCMNAME  EQU   UCMLIST+16                                               01002000
UCMDCB   EQU   UCMLIST+8                                                01003000
UCMSBR   EQU   UCMLIST+4                                                01004000
UCMECB   EQU   UCMLIST                                                  01005000
UCMTPSAV EQU   UCMEXIT+208                                              01006000
UCMXTSAV EQU   UCMEXIT+136                                              01007000
UCMDESCD EQU   UCMEXIT+132                                              01008000
UCMROUTC EQU   UCMEXIT+128                                              01009000
UCMMSTXT EQU   UCMEXIT                                                  01010000
UCMDECBA EQU   UCMEIL+20                                                01011000
UCMOECBA EQU   UCMEIL+16                                                01012000
UCMAECBA EQU   UCMEIL+12                                                01013000
UCMXECBA EQU   UCMEIL+8                                                 01014000
UCMNIPTR EQU   UCMEIL+4                                                 01015000
UCMRSV15 EQU   UCMEIL+3                                                 01016000
UCMRTCT  EQU   UCMEIL+2                                                 01017000
UCMRPYL  EQU   UCMEIL+1                                                 01018000
@NM00082 EQU   UCMEIL                                                   01019000
UCMRSV60 EQU   UCM+302                                                  01020000
UCMRSV59 EQU   UCMRSV51                                                 01021000
UCMRSV58 EQU   UCMRSV51                                                 01022000
UCMRSV57 EQU   UCMRSV51                                                 01023000
UCMRSV56 EQU   UCMRSV51                                                 01024000
UCMRSV55 EQU   UCMRSV51                                                 01025000
UCMRSV54 EQU   UCMRSV51                                                 01026000
UCMRSV53 EQU   UCMRSV51                                                 01027000
UCMRSV52 EQU   UCMRSV51                                                 01028000
UCMRSV50 EQU   UCMRSV42                                                 01029000
UCMRSV49 EQU   UCMRSV42                                                 01030000
UCMRSV48 EQU   UCMRSV42                                                 01031000
UCMRSV47 EQU   UCMRSV42                                                 01032000
UCMRSV46 EQU   UCMRSV42                                                 01033000
UCMRSV45 EQU   UCMRSV42                                                 01034000
UCMRSV44 EQU   UCMRSV42                                                 01035000
UCMRSV43 EQU   UCMRSV42                                                 01036000
UCMRSV41 EQU   UCM+296                                                  01037000
UCMWAKUP EQU   UCM+292                                                  01038000
UCMFRRAD EQU   UCM+288                                                  01039000
UCMSWCH  EQU   UCM+284                                                  01040000
UCMASCB  EQU   UCM+280                                                  01041000
UCMWQECP EQU   UCM+276                                                  01042000
UCMORECP EQU   UCM+272                                                  01043000
UCMOECBT EQU   UCM+268                                                  01044000
UCMOECBH EQU   UCM+264                                                  01045000
UCMWECBT EQU   UCM+260                                                  01046000
UCMWECBH EQU   UCM+256                                                  01047000
UCMMBEND EQU   UCM+252                                                  01048000
UCMCTID  EQU   UCM+250                                                  01049000
UCMRSV61 EQU   UCM+248                                                  01050000
UCMRP2AD EQU   UCM+244                                                  01051000
UCMCRAAD EQU   UCM+240                                                  01052000
UCMWQLM1 EQU   UCM+238                                                  01053000
UCMRV001 EQU   UCM+237                                                  01054000
UCMRQLM1 EQU   UCM+236                                                  01055000
UCMMBPTR EQU   UCM+232                                                  01056000
UCMMQNXT EQU   UCM+228                                                  01057000
UCMMQEND EQU   UCM+224                                                  01058000
UCMMQPTR EQU   UCM+220                                                  01059000
UCMTRECB EQU   UCM+216                                                  01060000
UCMMNECB EQU   UCM+212                                                  01061000
UCMMNTR  EQU   UCM+208                                                  01062000
UCMR9SV  EQU   UCM+204                                                  01063000
UCMSAVE4 EQU   UCM+140                                                  01064000
UCMSAVE3 EQU   UCM+84                                                   01065000
UCMINCR  EQU   UCM+71                                                   01066000
UCMMODEL EQU   UCM+70                                                   01067000
UCMCORE  EQU   UCM+69                                                   01068000
UCMFIX   EQU   UCMMODE                                                  01069000
UCMMCS   EQU   UCMMODE                                                  01070000
UCMOGCE  EQU   UCMMODE                                                  01071000
UCMAMFA  EQU   UCMMODE                                                  01072000
UCMRSV14 EQU   UCMMODE                                                  01073000
UCMTPUTA EQU   UCMMODE                                                  01074000
UCMNOCON EQU   UCMMODE                                                  01075000
UCMRSV11 EQU   UCMMODE                                                  01076000
UCMPXA   EQU   UCM+64                                                   01077000
UCMWQEND EQU   UCM+60                                                   01078000
UCMWQNR  EQU   UCM+58                                                   01079000
UCMRQNR  EQU   UCM+56                                                   01080000
UCMWQECB EQU   UCM+52                                                   01081000
UCMRQECB EQU   UCM+48                                                   01082000
UCMWQLM  EQU   UCM+46                                                   01083000
UCMRQLM  EQU   UCM+45                                                   01084000
@NM00081 EQU   UCMRPYI                                                  01085000
UCMRPYQ  EQU   UCM+28                                                   01086000
UCMWTOQ  EQU   UCM+24                                                   01087000
UCMLSTP  EQU   UCM+20                                                   01088000
UCMARECB EQU   UCM+16                                                   01089000
UCMLECB  EQU   UCMDECB                                                  01090000
UCMOECB  EQU   UCM+8                                                    01091000
UCMAECB  EQU   UCM+4                                                    01092000
UCMXECB  EQU   UCM                                                      01093000
UCMGMCNT EQU   UCMPRFX+158                                              01094000
UCMSDS2  EQU   UCMPRFX+157                                              01095000
UCMRSV09 EQU   UCMSDS1                                                  01096000
UCMRSV08 EQU   UCMSDS1                                                  01097000
UCMRSV07 EQU   UCMSDS1                                                  01098000
UCMRSV06 EQU   UCMSDS1                                                  01099000
UCMRSV05 EQU   UCMSDS1                                                  01100000
UCMRSV04 EQU   UCMSDS1                                                  01101000
UCMSDS1B EQU   UCMSDS1                                                  01102000
UCMSDS1A EQU   UCMSDS1                                                  01103000
UCMDTINT EQU   UCMPRFX+152                                              01104000
UCMLOGAD EQU   UCMPRFX+148                                              01105000
UCMNPECB EQU   UCMPRFX+144                                              01106000
UCMTPPTR EQU   UCMPRFX+140                                              01107000
UCMDOMRT EQU   UCMPRFX+136                                              01108000
UCMRUTCK EQU   UCMPRFX+132                                              01109000
UCMQRTN  EQU   UCMPRFX+128                                              01110000
UCM6WD   EQU   UCMXSA+20                                                01111000
UCM5WD   EQU   UCMXSA+16                                                01112000
UCM4WD   EQU   UCMXSA+12                                                01113000
UCM3WD   EQU   UCMXSA+8                                                 01114000
UCM2WD   EQU   UCMXSA+4                                                 01115000
UCM1WD   EQU   UCMXSA                                                   01116000
UCMRSV03 EQU   UCMPRFX+102                                              01117000
UCMHRDRT EQU   UCMPRFX+100                                              01118000
UCMUEXIT EQU   UCMPRFX+97                                               01119000
UCMXCT   EQU   UCMPRFX+96                                               01120000
UCMHCUCM EQU   UCMPRFX+92                                               01121000
UCMCMID  EQU   UCMPRFX+88                                               01122000
UCMOWTOR EQU   UCMPRFX+86                                               01123000
UCMRSV02 EQU   UCMSFLG2                                                 01124000
UCMSYSO  EQU   UCMSFLG2                                                 01125000
UCMSYSN  EQU   UCMSFLG2                                                 01126000
UCMSYSM  EQU   UCMSFLG2                                                 01127000
UCMSYSL  EQU   UCMSFLG2                                                 01128000
UCMSYSK  EQU   UCMSFLG2                                                 01129000
UCMSYSJ  EQU   UCMSFLG2                                                 01130000
UCMSYSI  EQU   UCMSFLG2                                                 01131000
UCMRSV35 EQU   UCMSFLG1                                                 01132000
UCMSYSG  EQU   UCMSFLG1                                                 01133000
UCMSYSF  EQU   UCMSFLG1                                                 01134000
UCMSYSE  EQU   UCMSFLG1                                                 01135000
UCMSYSD  EQU   UCMSFLG1                                                 01136000
UCMSYSC  EQU   UCMSFLG1                                                 01137000
UCMSYSB  EQU   UCMSFLG1                                                 01138000
UCMRSV01 EQU   UCMSFLG1                                                 01139000
UCMWTOX  EQU   UCMPRFX+80                                               01140000
UCMDOME  EQU   UCMPRFX+76                                               01141000
UCMSVR0  EQU   UCMSAVE0+68                                              01142000
UCMSVQ0  EQU   UCMSAVE0+64                                              01143000
UCMSVP0  EQU   UCMSAVE0+60                                              01144000
UCMSVO0  EQU   UCMSAVE0+56                                              01145000
UCMSVN0  EQU   UCMSAVE0+52                                              01146000
UCMSVM0  EQU   UCMSAVE0+48                                              01147000
UCMSVL0  EQU   UCMSAVE0+44                                              01148000
UCMSVK0  EQU   UCMSAVE0+40                                              01149000
UCMSVJ0  EQU   UCMSAVE0+36                                              01150000
UCMSVI0  EQU   UCMSAVE0+32                                              01151000
UCMSVH0  EQU   UCMSAVE0+28                                              01152000
UCMSVG0  EQU   UCMSAVE0+24                                              01153000
UCMSVF0  EQU   UCMSAVE0+20                                              01154000
UCMSVE0  EQU   UCMSAVE0+16                                              01155000
UCMSVD0  EQU   UCMSAVE0+12                                              01156000
UCMSVC0  EQU   UCMSAVE0+8                                               01157000
UCMSVB0  EQU   UCMSAVE0+4                                               01158000
UCMSVA0  EQU   UCMSAVE0                                                 01159000
UCMMCENT EQU   UCMPRFX                                                  01160000
UCM2PAD  EQU   UCM2EXT+12                                               01161000
UCM2STAA EQU   UCM2STA+1                                                01162000
UCM2SCNT EQU   UCM2SFLG                                                 01163000
UCMRSV34 EQU   UCM2SFLG                                                 01164000
UCMRSV33 EQU   UCM2SFLG                                                 01165000
UCMRSV32 EQU   UCM2SFLG                                                 01166000
UCM2DSTR EQU   UCM2SFLG                                                 01167000
UCM2DTAK EQU   UCM2SFLG                                                 01168000
UCM2SENT EQU   UCM2SFLG                                                 01169000
UCM2SDWA EQU   UCM2SFLG                                                 01170000
UCM2PST  EQU   UCM2EXT+4                                                01171000
UCM2RID  EQU   UCM2EXT+2                                                01172000
UCM2WID  EQU   UCM2EXT                                                  01173000
UCBERADR EQU   UCBUCS+12                                                01174000
UCBFCBID EQU   UCBUCS+8                                                 01175000
UCBERCNT EQU   UCBUCS+7                                                 01176000
UCBRSV51 EQU   UCBUCS+6                                                 01177000
UCBRSV50 EQU   UCBFCBOP                                                 01178000
UCBRSV49 EQU   UCBFCBOP                                                 01179000
UCBRSV48 EQU   UCBFCBOP                                                 01180000
UCBRSV47 EQU   UCBFCBOP                                                 01181000
UCBRSV46 EQU   UCBFCBOP                                                 01182000
UCBRSV45 EQU   UCBFCBOP                                                 01183000
UCBRSV44 EQU   UCBFCBOP                                                 01184000
UCBFCBO1 EQU   UCBFCBOP                                                 01185000
UCBUCSPE EQU   UCBUCSOP                                                 01186000
UCBRSV43 EQU   UCBUCSOP                                                 01187000
UCBRSV42 EQU   UCBUCSOP                                                 01188000
UCBRSV41 EQU   UCBUCSOP                                                 01189000
UCBRSV40 EQU   UCBUCSOP                                                 01190000
UCBRSV39 EQU   UCBUCSOP                                                 01191000
UCBUCSO2 EQU   UCBUCSOP                                                 01192000
UCBUCSO1 EQU   UCBUCSOP                                                 01193000
UCBUCSID EQU   UCBUCS                                                   01194000
UCBRDATA EQU   UCBOCR+4                                                 01195000
UCBFRID  EQU   UCBOCR                                                   01196000
UCBCLN   EQU   UCBMT+14                                                 01197000
UCBERG   EQU   UCBMT+12                                                 01198000
UCBMS    EQU   UCBMT+11                                                 01199000
UCBNB    EQU   UCBMT+10                                                 01200000
UCBPW    EQU   UCBMT+9                                                  01201000
UCBPR    EQU   UCBMT+8                                                  01202000
UCBSIO   EQU   UCBMT+6                                                  01203000
UCBTW    EQU   UCBMT+5                                                  01204000
UCBTR    EQU   UCBMT+4                                                  01205000
UCBTWT   EQU   UCBMT+3                                                  01206000
UCBTRT   EQU   UCBMT+2                                                  01207000
UCBCTD   EQU   UCBMT                                                    01208000
UCBASID  EQU   UCBCMEXT+14                                              01209000
UCBMFCNT EQU   UCBCMEXT+12                                              01210000
UCBPMSK  EQU   UCBCMEXT+10                                              01211000
UCBCCWOF EQU   UCBCMEXT+8                                               01212000
UCBRV041 EQU   UCBCMEXT+6                                               01213000
UCBRV036 EQU   UCBFLP1                                                  01214000
UCBRV035 EQU   UCBFLP1                                                  01215000
UCBRV034 EQU   UCBFLP1                                                  01216000
UCBRV033 EQU   UCBFLP1                                                  01217000
UCBRV032 EQU   UCBFLP1                                                  01218000
UCBRV031 EQU   UCBFLP1                                                  01219000
UCBRV030 EQU   UCBFLP1                                                  01220000
UCBNSRCH EQU   UCBFLP1                                                  01221000
UCBSNSCT EQU   UCBCMEXT+4                                               01222000
UCBHPDV  EQU   @NM00080                                                 01223000
UCBHALI  EQU   @NM00080                                                 01224000
UCBRSV09 EQU   @NM00080                                                 01225000
UCBRSV08 EQU   @NM00080                                                 01226000
UCBRSV07 EQU   @NM00080                                                 01227000
UCBRSV06 EQU   @NM00080                                                 01228000
UCBRSV05 EQU   @NM00080                                                 01229000
UCBRSV04 EQU   @NM00080                                                 01230000
UCBDTI   EQU   UCBCMEXT+2                                               01231000
UCBSTI   EQU   UCBCMEXT+1                                               01232000
UCBETI   EQU   UCBCMEXT                                                 01233000
UCBEXTP  EQU   UCBEXTPT+1                                               01234000
UCBDDRSW EQU   UCBFLC                                                   01235000
UCBTICBT EQU   UCBFLC                                                   01236000
UCBIVRR  EQU   UCBFLC                                                   01237000
UCBIVRS  EQU   UCBFLC                                                   01238000
UCBITF   EQU   UCBFLC                                                   01239000
UCBUDE   EQU   UCBFLC                                                   01240000
UCBWAA   EQU   UCBFLC                                                   01241000
UCBATTP  EQU   UCBFLC                                                   01242000
UCBUNTYP EQU   UCBTBYT4                                                 01243000
UCBRSV11 EQU   UCBDVCLS                                                 01244000
UCBRSV10 EQU   UCBDVCLS                                                 01245000
UCB3CHAR EQU   UCBDVCLS                                                 01246000
UCB3UREC EQU   UCBDVCLS                                                 01247000
UCB3DISP EQU   UCBDVCLS                                                 01248000
UCB3DACC EQU   UCBDVCLS                                                 01249000
UCB3COMM EQU   UCBDVCLS                                                 01250000
UCB3TAPE EQU   UCBDVCLS                                                 01251000
UCBDVPWR EQU   UCB2OPT7                                                 01252000
UCBVLPWR EQU   UCB2OPT6                                                 01253000
UCB2OPT5 EQU   UCBTBYT2                                                 01254000
UCBRWTAU EQU   UCB2OPT4                                                 01255000
UCBRPS   EQU   UCBDUDN2                                                 01256000
UCBRR    EQU   UCBDUDN1                                                 01257000
UCB2OPT1 EQU   UCBTBYT2                                                 01258000
UCB2OPT0 EQU   UCBTBYT2                                                 01259000
UCB1FEA7 EQU   UCBTBYT1                                                 01260000
UCBD6250 EQU   UCB1FEA6                                                 01261000
UCBD1600 EQU   UCB1FEA5                                                 01262000
UCB1FEA4 EQU   UCBTBYT1                                                 01263000
UCB1FEA3 EQU   UCBTBYT1                                                 01264000
UCB1FEA2 EQU   UCBTBYT1                                                 01265000
UCB1FEA1 EQU   UCBTBYT1                                                 01266000
UCB1FEA0 EQU   UCBTBYT1                                                 01267000
UCBRV029 EQU   UCBWGT                                                   01268000
UCBVHRSN EQU   UCBWGT                                                   01269000
UCBVORSN EQU   UCBWGT                                                   01270000
UCBMTPXP EQU   UCBWGT                                                   01271000
UCBREW   EQU   UCBWGT                                                   01272000
UCBPUB   EQU   UCBWGT                                                   01273000
UCBOUT   EQU   UCBWGT                                                   01274000
UCBIN    EQU   UCBWGT                                                   01275000
UCBCPU   EQU   UCBOB+11                                                 01276000
UCBLCI   EQU   UCBOB+10                                                 01277000
UCBCNT   EQU   UCBOB+9                                                  01278000
UCBRV017 EQU   UCBCHM1                                                  01279000
UCBRV016 EQU   UCBCHM1                                                  01280000
UCBRV015 EQU   UCBCHM1                                                  01281000
UCBRV014 EQU   UCBCHM1                                                  01282000
UCBSPB   EQU   UCBPTH1                                                  01283000
UCBPPB   EQU   UCBPTH1                                                  01284000
UCBSPA   EQU   UCBPTH0                                                  01285000
UCBPPA   EQU   UCBPTH0                                                  01286000
UCBFLB7  EQU   UCBFLB                                                   01287000
UCBFLB6  EQU   UCBFLB                                                   01288000
UCBFLB5  EQU   UCBFLB                                                   01289000
UCBFLB4  EQU   UCBFLB                                                   01290000
UCBRESVH EQU   UCBFLB                                                   01291000
UCBSPST  EQU   UCBFLB                                                   01292000
UCBASNS  EQU   UCBFLB                                                   01293000
UCBIORST EQU   UCBFLB                                                   01294000
UCBQISCE EQU   UCBFL1                                                   01295000
UCBACTV  EQU   UCBFL1                                                   01296000
UCBSAP   EQU   UCBFL1                                                   01297000
UCBNOTRC EQU   UCBCUB                                                   01298000
UCBPSNS  EQU   UCBFL1                                                   01299000
UCBUSING EQU   UCBPST                                                   01300000
UCBNOTRD EQU   UCBNRY                                                   01301000
UCBBUSYD EQU   UCBBSY                                                   01302000
UCBUA    EQU   UCBCHAN+1                                                01303000
UCBCHA   EQU   UCBCHAN                                                  01304000
UCBDADI  EQU   UCBSTAT                                                  01305000
UCBPRES  EQU   UCBSTAT                                                  01306000
UCBALOC  EQU   UCBSTAT                                                  01307000
UCBUNLD  EQU   UCBSTAT                                                  01308000
UCBRESV  EQU   UCBSTAT                                                  01309000
UCBCHGS  EQU   UCBSTAT                                                  01310000
UCBONLI  EQU   UCBSTAT                                                  01311000
UCBID    EQU   UCBOB+2                                                  01312000
UCBALTPH EQU   UCBFL5                                                   01313000
UCBALTCU EQU   UCBFL5                                                   01314000
UCBNALOC EQU   UCBFL5                                                   01315000
UCBENVRD EQU   UCBFL5                                                   01316000
UCBVSDR  EQU   UCBFL5                                                   01317000
UCBSASK  EQU   UCBFL5                                                   01318000
UCBAMV   EQU   UCBAF                                                    01319000
UCBDCC   EQU   UCBFL5                                                   01320000
UCBMONT  EQU   UCBJBNR                                                  01321000
UCBRV011 EQU   UCBJBNR                                                  01322000
UCBRSV02 EQU   UCBJBNR                                                  01323000
UCBRSV01 EQU   UCBJBNR                                                  01324000
UCBRV003 EQU   UCBJBNR                                                  01325000
UCBRV002 EQU   UCBJBNR                                                  01326000
UCBRV001 EQU   UCBJBNR                                                  01327000
UCBVRDEV EQU   UCBJBNR                                                  01328000
UCBCMSEG EQU   UCBOB                                                    01329000
UCBPFXND EQU   UCB+512                                                  01330000
UCBIOQ   EQU   UCB+508                                                  01331000
UCBLOCK  EQU   UCB+504                                                  01332000
UCBPXST  EQU   UCB+504                                                  01333000
@NM00077 EQU   UCB                                                      01334000
@NM00076 EQU   TCBXTNT2+32                                              01335000
TCBRV181 EQU   TCBRV173                                                 01336000
TCBRV180 EQU   TCBRV173                                                 01337000
TCBRV179 EQU   TCBRV173                                                 01338000
TCBRV178 EQU   TCBRV173                                                 01339000
TCBRV177 EQU   TCBRV173                                                 01340000
TCBRV176 EQU   TCBRV173                                                 01341000
TCBRV175 EQU   TCBRV173                                                 01342000
TCBRV174 EQU   TCBRV173                                                 01343000
TCBRV172 EQU   TCBRV164                                                 01344000
TCBRV171 EQU   TCBRV164                                                 01345000
TCBRV170 EQU   TCBRV164                                                 01346000
TCBRV169 EQU   TCBRV164                                                 01347000
TCBRV168 EQU   TCBRV164                                                 01348000
TCBRV167 EQU   TCBRV164                                                 01349000
TCBRV166 EQU   TCBRV164                                                 01350000
TCBRV165 EQU   TCBRV164                                                 01351000
TCBRV163 EQU   TCBRV155                                                 01352000
TCBRV162 EQU   TCBRV155                                                 01353000
TCBRV161 EQU   TCBRV155                                                 01354000
TCBRV160 EQU   TCBRV155                                                 01355000
TCBRV159 EQU   TCBRV155                                                 01356000
TCBRV158 EQU   TCBRV155                                                 01357000
TCBRV157 EQU   TCBRV155                                                 01358000
TCBRV156 EQU   TCBRV155                                                 01359000
TCBRV154 EQU   TCBRV146                                                 01360000
TCBRV153 EQU   TCBRV146                                                 01361000
TCBRV152 EQU   TCBRV146                                                 01362000
TCBRV151 EQU   TCBRV146                                                 01363000
TCBRV150 EQU   TCBRV146                                                 01364000
TCBRV149 EQU   TCBRV146                                                 01365000
TCBRV148 EQU   TCBRV146                                                 01366000
TCBRV147 EQU   TCBRV146                                                 01367000
TCBRV145 EQU   TCBXTNT2+26                                              01368000
TCBRV144 EQU   TCBXTNT2+24                                              01369000
TCBRV143 EQU   TCBXTNT2+20                                              01370000
TCBRV142 EQU   TCBXTNT2+16                                              01371000
TCBRSV49 EQU   TCBXTNT2+12                                              01372000
TCBRSV48 EQU   TCBXTNT2+8                                               01373000
TCBRCMP  EQU   TCBXTNT2+5                                               01374000
TCBRSVAB EQU   TCBXTNT2+4                                               01375000
TCBGTFA  EQU   TCBGTF+1                                                 01376000
TCBRSV47 EQU   TCBTFLG                                                  01377000
TCBRSV46 EQU   TCBTFLG                                                  01378000
TCBRSV45 EQU   TCBTFLG                                                  01379000
TCBRSV44 EQU   TCBTFLG                                                  01380000
TCBRSV43 EQU   TCBTFLG                                                  01381000
TCBDSPIT EQU   TCBTFLG                                                  01382000
TCBERRTN EQU   TCBTFLG                                                  01383000
TCBASYNC EQU   TCBTFLG                                                  01384000
@NM00075 EQU   TCB+296                                                  01385000
TCBRV185 EQU   TCB+292                                                  01386000
TCBSWASA EQU   TCB+288                                                  01387000
TCBDBTB  EQU   TCB+284                                                  01388000
TCBRPT   EQU   TCB+280                                                  01389000
TCBRV141 EQU   TCBRV133                                                 01390000
TCBRV140 EQU   TCBRV133                                                 01391000
TCBRV139 EQU   TCBRV133                                                 01392000
TCBRV138 EQU   TCBRV133                                                 01393000
TCBRV137 EQU   TCBRV133                                                 01394000
TCBRV136 EQU   TCBRV133                                                 01395000
TCBRV135 EQU   TCBRV133                                                 01396000
TCBRV134 EQU   TCBRV133                                                 01397000
TCBRV132 EQU   TCBRV124                                                 01398000
TCBRV131 EQU   TCBRV124                                                 01399000
TCBRV130 EQU   TCBRV124                                                 01400000
TCBRV129 EQU   TCBRV124                                                 01401000
TCBRV128 EQU   TCBRV124                                                 01402000
TCBRV127 EQU   TCBRV124                                                 01403000
TCBRV126 EQU   TCBRV124                                                 01404000
TCBRV125 EQU   TCBRV124                                                 01405000
TCBRV123 EQU   TCBFBYT2                                                 01406000
TCBRV122 EQU   TCBFBYT2                                                 01407000
TCBECBNV EQU   TCBFBYT2                                                 01408000
TCBSSSYN EQU   TCBFBYT2                                                 01409000
TCBFPRAP EQU   TCBFBYT2                                                 01410000
TCBFDW   EQU   TCBFBYT2                                                 01411000
TCBFMW   EQU   TCBFBYT2                                                 01412000
TCBCNCB  EQU   TCBFBYT2                                                 01413000
TCBLLH   EQU   TCBFBYT1                                                 01414000
TCBRV113 EQU   TCBFBYT1                                                 01415000
TCBEOT   EQU   TCBFBYT1                                                 01416000
TCBRTM2  EQU   TCBFBYT1                                                 01417000
TCBPGNLY EQU   TCBFBYT1                                                 01418000
TCBNDIOS EQU   TCBFBYT1                                                 01419000
TCBACTIV EQU   TCBFBYT1                                                 01420000
TCBEOTFM EQU   TCBFBYT1                                                 01421000
TCBAFFN  EQU   TCB+274                                                  01422000
TCBCCPVI EQU   TCB+272                                                  01423000
TCBUKYSP EQU   TCB+268                                                  01424000
TCBMODE  EQU   TCBESTAE+3                                               01425000
TCBERTYP EQU   TCBESTAE+2                                               01426000
TCBRV314 EQU   TCBESTRM                                                 01427000
TCBRV313 EQU   TCBESTRM                                                 01428000
TCBRV312 EQU   TCBESTRM                                                 01429000
TCBRV311 EQU   TCBESTRM                                                 01430000
TCBRV310 EQU   TCBESTRM                                                 01431000
TCBRV309 EQU   TCBESTRM                                                 01432000
TCBRV308 EQU   TCBESTRM                                                 01433000
TCBETERM EQU   TCBESTRM                                                 01434000
TCBSCBKY EQU   TCBESTAE                                                 01435000
TCBRTM12 EQU   TCB+260                                                  01436000
TCBTCBID EQU   TCB+256                                                  01437000
TCBRSV96 EQU   TCB+252                                                  01438000
TCBSWA   EQU   TCB+248                                                  01439000
TCBFOEA  EQU   TCBFOE+1                                                 01440000
TCBRSV42 EQU   TCBFOE                                                   01441000
TCBRV306 EQU   TCB+240                                                  01442000
TCBRSV41 EQU   TCB+239                                                  01443000
TCBTID   EQU   TCB+238                                                  01444000
TCBRSVAA EQU   TCB+237                                                  01445000
TCBABCUR EQU   TCB+236                                                  01446000
TCBTMSAV EQU   TCB+232                                                  01447000
TCBIOTIM EQU   TCB+228                                                  01448000
TCBRTWA  EQU   TCB+224                                                  01449000
TCBBACK  EQU   TCB+220                                                  01450000
TCBTIRB  EQU   TCB+216                                                  01451000
TCBAECB  EQU   TCB+212                                                  01452000
TCBEXT2A EQU   TCBEXT2+1                                                01453000
TCBRSV39 EQU   TCBEXT2                                                  01454000
TCBSTMCT EQU   TCB+207                                                  01455000
TCBSYSCT EQU   TCB+206                                                  01456000
TCBRSV37 EQU   TCB+205                                                  01457000
TCBEXSVC EQU   TCBDAR                                                   01458000
TCBRSV36 EQU   TCBDAR                                                   01459000
TCBDARWT EQU   TCBDAR                                                   01460000
TCBDARO  EQU   TCBDAR                                                   01461000
TCBDARMC EQU   TCBDARC                                                  01462000
TCBDARD  EQU   TCBDAR                                                   01463000
TCBDARS  EQU   TCBDAR                                                   01464000
TCBDARP  EQU   TCBDAR                                                   01465000
TCBGTOFM EQU   TCBFLGS7                                                 01466000
TCBADMP  EQU   TCBFLGS7                                                 01467000
TCBRSTSK EQU   TCBFLGS7                                                 01468000
TCBRSV35 EQU   TCBFLGS7                                                 01469000
TCBSTACK EQU   TCBFLGS7                                                 01470000
TCBRSV34 EQU   TCBFLGS7                                                 01471000
TCBRSV33 EQU   TCBFLGS7                                                 01472000
TCBGPECB EQU   TCBFLGS7                                                 01473000
TCBNTJS  EQU   TCBFLGS6                                                 01474000
TCBAPG   EQU   TCBFLGS6                                                 01475000
TCBMIGR  EQU   TCBFLGS6                                                 01476000
TCBRV303 EQU   TCBFLGS6                                                 01477000
TCBSPVLK EQU   TCBFLGS6                                                 01478000
TCBCPU   EQU   TCBFLGS6                                                 01479000
TCBPIE17 EQU   TCBFLGS6                                                 01480000
TCBRV    EQU   TCBFLGS6                                                 01481000
TCBRSV79 EQU   TCBNDSP5                                                 01482000
TCBRSV78 EQU   TCBNDSP5                                                 01483000
TCBRSV77 EQU   TCBNDSP5                                                 01484000
TCBRSV76 EQU   TCBNDSP5                                                 01485000
TCBRSV75 EQU   TCBNDSP5                                                 01486000
TCBRSV74 EQU   TCBNDSP5                                                 01487000
TCBRSV95 EQU   TCBNDSP5                                                 01488000
TCBRSV94 EQU   TCBNDSP5                                                 01489000
TCBRSV93 EQU   TCBNDSP4                                                 01490000
TCBRSV92 EQU   TCBNDSP4                                                 01491000
TCBRSV91 EQU   TCBNDSP4                                                 01492000
TCBRSV90 EQU   TCBNDSP4                                                 01493000
TCBRSV89 EQU   TCBNDSP4                                                 01494000
TCBRSV88 EQU   TCBNDSP4                                                 01495000
TCBRSV87 EQU   TCBNDSP4                                                 01496000
TCBRSV86 EQU   TCBNDSP4                                                 01497000
TCBEXT1A EQU   TCBEXT1+1                                                01498000
TCBRSV32 EQU   TCBEXT1                                                  01499000
TCBRSV30 EQU   TCB+192                                                  01500000
TCBIOBRC EQU   TCB+188                                                  01501000
TCBDDWTC EQU   TCB+186                                                  01502000
TCBDDEXC EQU   TCB+184                                                  01503000
TCBJSCBB EQU   TCBJSCB+1                                                01504000
@NM00074 EQU   TCBRECDE                                                 01505000
TCBREC   EQU   TCBRECDE                                                 01506000
TCBMDIDS EQU   TCB+176                                                  01507000
TCBNDINT EQU   TCBNDSP3                                                 01508000
TCBRSV27 EQU   TCBNDSP3                                                 01509000
TCBRSV26 EQU   TCBNDSP3                                                 01510000
TCBRSV25 EQU   TCBNDSP3                                                 01511000
TCBRSV24 EQU   TCBNDSP3                                                 01512000
TCBSRBND EQU   TCBNDSP3                                                 01513000
TCBRV302 EQU   TCBNDSP3                                                 01514000
TCBLJSND EQU   TCBNDSP3                                                 01515000
TCBABE   EQU   TCBNDSP2                                                 01516000
TCBDSS   EQU   TCBNDSP2                                                 01517000
TCBOWAIT EQU   TCBNDSP2                                                 01518000
TCBIWAIT EQU   TCBNDSP2                                                 01519000
TCBNDTS  EQU   TCBNDSP2                                                 01520000
TCBNDSVC EQU   TCBNDSP2                                                 01521000
TCBSTPP  EQU   TCBNDSP2                                                 01522000
TCBABD   EQU   TCBNDSP2                                                 01523000
TCBRSV22 EQU   TCBNDSP1                                                 01524000
TCBPIEND EQU   TCBNDSP1                                                 01525000
TCBTPSP  EQU   TCBNDSP1                                                 01526000
TCBDDRND EQU   TCBNDSP1                                                 01527000
TCBRSPND EQU   TCBNDSP1                                                 01528000
TCBRSTND EQU   TCBNDSP1                                                 01529000
TCBDARPN EQU   TCBNDSP1                                                 01530000
TCBDARTN EQU   TCBNDSP1                                                 01531000
TCBNDSP0 EQU   TCBNDSP                                                  01532000
TCBUSER  EQU   TCB+168                                                  01533000
TCBTCTB  EQU   TCBTCT+1                                                 01534000
TCBRSV9C EQU   TCBTCTGF                                                 01535000
TCBRSV9B EQU   TCBTCTGF                                                 01536000
TCBRSV9A EQU   TCBTCTGF                                                 01537000
TCBRSV99 EQU   TCBTCTGF                                                 01538000
TCBRSV98 EQU   TCBTCTGF                                                 01539000
TCBRSV97 EQU   TCBTCTGF                                                 01540000
TCBRSV20 EQU   TCBTCTGF                                                 01541000
TCBSMFGF EQU   TCBTCTGF                                                 01542000
TCBSTABB EQU   TCBSTAB+1                                                01543000
TCBSTCUR EQU   TCBNSTAE                                                 01544000
TCBRV301 EQU   TCBNSTAE                                                 01545000
TCBSYNCH EQU   TCBNSTAE                                                 01546000
TCBHALT  EQU   TCBNSTAE                                                 01547000
TCBPPSUP EQU   TCBNSTAE                                                 01548000
TCB33E   EQU   TCBNSTAE                                                 01549000
TCBQUIES EQU   TCBNSTAE                                                 01550000
TCBSTABE EQU   TCBNSTAE                                                 01551000
TCBAQE   EQU   TCB+156                                                  01552000
TCBPQE   EQU   TCB+152                                                  01553000
TCBTSDP  EQU   TCB+151                                                  01554000
TCBTSLP  EQU   TCB+150                                                  01555000
TCBSTPCT EQU   TCB+149                                                  01556000
TCBCPUBN EQU   TCBTSFLG                                                 01557000
TCBDYDSP EQU   TCBTSFLG                                                 01558000
TCBRSV18 EQU   TCBTSFLG                                                 01559000
TCBRSV17 EQU   TCBTSFLG                                                 01560000
TCBTIOTG EQU   TCBTSFLG                                                 01561000
TCBATT   EQU   TCBTSFLG                                                 01562000
TCBSTPPR EQU   TCBTSFLG                                                 01563000
TCBRV300 EQU   TCBTSTSK                                                 01564000
TCBECB   EQU   TCB+144                                                  01565000
TCBIQE   EQU   TCB+140                                                  01566000
TCBLTC   EQU   TCB+136                                                  01567000
TCBOTC   EQU   TCB+132                                                  01568000
TCBNTC   EQU   TCB+128                                                  01569000
TCBJSTCA EQU   TCBJSTCB+1                                               01570000
TCBRSV16 EQU   TCBJSTCB                                                 01571000
TCBTQET  EQU   TCBTME                                                   01572000
TCBTCB   EQU   TCB+116                                                  01573000
TCBFSAB  EQU   TCBFSA+1                                                 01574000
TCBQEL   EQU   TCBFSA                                                   01575000
TCBGRS15 EQU   TCBGRS+60                                                01576000
TCBGRS14 EQU   TCBGRS+56                                                01577000
TCBGRS13 EQU   TCBGRS+52                                                01578000
TCBGRS12 EQU   TCBGRS+48                                                01579000
TCBGRS11 EQU   TCBGRS+44                                                01580000
TCBGRS10 EQU   TCBGRS+40                                                01581000
TCBGRS9  EQU   TCBGRS+36                                                01582000
TCBGRS8  EQU   TCBGRS+32                                                01583000
TCBGRS7  EQU   TCBGRS+28                                                01584000
TCBGRS6  EQU   TCBGRS+24                                                01585000
TCBGRS5  EQU   TCBGRS+20                                                01586000
TCBGRS4  EQU   TCBGRS+16                                                01587000
TCBGRS3  EQU   TCBGRS+12                                                01588000
TCBGRS2  EQU   TCBGRS+8                                                 01589000
TCBGRS1  EQU   TCBGRS+4                                                 01590000
TCBGRS0  EQU   TCBGRS                                                   01591000
TCBJPQB  EQU   TCBJPQ+1                                                 01592000
TCBRSV15 EQU   TCBPURGE                                                 01593000
TCBRSV14 EQU   TCBPURGE                                                 01594000
TCBRSV13 EQU   TCBPURGE                                                 01595000
TCBRSV12 EQU   TCBPURGE                                                 01596000
TCBRSV11 EQU   TCBPURGE                                                 01597000
TCBRSV10 EQU   TCBPURGE                                                 01598000
TCBRSV09 EQU   TCBPURGE                                                 01599000
TCBJPQF  EQU   TCBPURGE                                                 01600000
TCBJLB   EQU   TCB+40                                                   01601000
TCBLLS   EQU   TCB+36                                                   01602000
TCBDSP   EQU   TCB+35                                                   01603000
TCBLMP   EQU   TCB+34                                                   01604000
TCBPNDSP EQU   TCBFLGS5                                                 01605000
TCBFCD1  EQU   TCBFLGS5                                                 01606000
TCBSTP   EQU   TCBFLGS5                                                 01607000
TCBSYS   EQU   TCBFLGS5                                                 01608000
TCBANDSP EQU   TCBFLGS5                                                 01609000
TCBPAGE  EQU   TCBFLGS5                                                 01610000
TCBUXNDF EQU   TCBABWF                                                  01611000
TCBFC    EQU   TCBFLGS5                                                 01612000
TCBONDSP EQU   TCBFLGS4                                                 01613000
TCBMPCND EQU   TCBFLGS4                                                 01614000
TCBMPCVQ EQU   TCBFLGS4                                                 01615000
TCBUXNDV EQU   TCBFLGS4                                                 01616000
TCBHNDSP EQU   TCBFLGS4                                                 01617000
TCBRQENA EQU   TCBFLGS4                                                 01618000
TCBSER   EQU   TCBFLGS4                                                 01619000
TCBNDUMP EQU   TCBFLGS4                                                 01620000
TCBDWSTA EQU   TCBFLGS3                                                 01621000
TCBRSV08 EQU   TCBFLGS3                                                 01622000
TCBRSV07 EQU   TCBFLGS3                                                 01623000
TCBRSV06 EQU   TCBFLGS3                                                 01624000
TCBABGM  EQU   TCBFLGS3                                                 01625000
TCBABTRM EQU   TCBFLGS3                                                 01626000
TCBADINP EQU   TCBFLGS3                                                 01627000
TCBFSM   EQU   TCBFLGS3                                                 01628000
TCBFTS   EQU   TCBFLGS2                                                 01629000
TCBFETXR EQU   TCBFLGS2                                                 01630000
TCBFDSOP EQU   TCBFLGS2                                                 01631000
TCBFJMC  EQU   TCBFLGS2                                                 01632000
TCBFSMC  EQU   TCBFLGS2                                                 01633000
TCBFABOP EQU   TCBFLGS2                                                 01634000
TCBFSTI  EQU   TCBFLGS2                                                 01635000
TCBFOINP EQU   TCBFLGS2                                                 01636000
TCBFX    EQU   TCBFLGS1                                                 01637000
TCBFS    EQU   TCBFLGS1                                                 01638000
TCBFT    EQU   TCBFLGS1                                                 01639000
TCBPDUMP EQU   TCBFLGS1                                                 01640000
TCBRSV04 EQU   TCBFLGS1                                                 01641000
TCBFERA  EQU   TCBFLGS1                                                 01642000
TCBFE    EQU   TCBFLGS1                                                 01643000
TCBFA    EQU   TCBFLGS1                                                 01644000
TCBZERO  EQU   TCBPKF                                                   01645000
TCBFLAG  EQU   TCBPKF                                                   01646000
TCBMSSB  EQU   TCBMSS+1                                                 01647000
TCBRSV03 EQU   TCBMSS                                                   01648000
TCBTRNB  EQU   TCBTRN+1                                                 01649000
TCBRSV02 EQU   TCBABF                                                   01650000
TCBOLTEP EQU   TCBABF                                                   01651000
TCBTCP   EQU   TCBABF                                                   01652000
TCBTCPP  EQU   TCBABF                                                   01653000
TCBRSV01 EQU   TCBABF                                                   01654000
TCBGRPH  EQU   TCBABF                                                   01655000
TCBNOCHK EQU   TCBABF                                                   01656000
TCBMOD91 EQU   TCBABF                                                   01657000
TCBCMPC  EQU   TCBCMP+1                                                 01658000
TCBRV318 EQU   TCBCMSG                                                  01659000
TCBRV317 EQU   TCBCIND                                                  01660000
TCBRV316 EQU   TCBCWTO                                                  01661000
TCBCASID EQU   TCBCDBL                                                  01662000
TCBNOCC  EQU   TCBSTCC                                                  01663000
TCBDMPO  EQU   TCBCPP                                                   01664000
TCBCSTEP EQU   TCBCMPF                                                  01665000
TCBCREQ  EQU   TCBCMPF                                                  01666000
TCBTIO   EQU   TCB+12                                                   01667000
TCBDEB   EQU   TCB+8                                                    01668000
TCBPIEA  EQU   TCBPIE+1                                                 01669000
TCBPM    EQU   TCBPMASK                                                 01670000
@NM00073 EQU   TCBPMASK                                                 01671000
TCBRBP   EQU   TCB                                                      01672000
TCBFRS6  EQU   TCBFRS+24                                                01673000
TCBFRS4  EQU   TCBFRS+16                                                01674000
TCBFRS2  EQU   TCBFRS+8                                                 01675000
TCBFRS0  EQU   TCBFRS                                                   01676000
NVTRMSG  EQU   NVT+540                                                  01677000
NVTRLOCK EQU   NVT+536                                                  01678000
NVTRCODE EQU   NVT+532                                                  01679000
@NM00072 EQU   NVT+529                                                  01680000
@NM00071 EQU   NVTFLPO                                                  01681000
NVTFLWS  EQU   NVTFLPO                                                  01682000
NVTFLQS  EQU   NVTFLPO                                                  01683000
@NM00070 EQU   NVTFLPO                                                  01684000
NVTSYSP  EQU   NVTFLPO                                                  01685000
NVTFLLST EQU   NVTFLPO                                                  01686000
NVTAPQE  EQU   NVT+524                                                  01687000
NVTFBQE2 EQU   NVT+520                                                  01688000
NVTFBQE1 EQU   NVT+516                                                  01689000
@NM00069 EQU   NVT+512                                                  01690000
NVTREALR EQU   NVT+508                                                  01691000
NVTFASVT EQU   NVT+504                                                  01692000
NVTLPALG EQU   NVT+496                                                  01693000
NVTVRLNG EQU   NVT+492                                                  01694000
NVTVRREG EQU   NVT+488                                                  01695000
NVTLVIRT EQU   NVT+484                                                  01696000
NVTDIRA  EQU   NVT+480                                                  01697000
NVTLPAND EQU   NVT+476                                                  01698000
NVTRMSS  EQU   NVT+472                                                  01699000
NVTRPQE  EQU   NVT+468                                                  01700000
NVTRLLE  EQU   NVT+464                                                  01701000
NVTRJPQ  EQU   NVT+460                                                  01702000
NVTVMSS  EQU   NVT+456                                                  01703000
NVTVPQE  EQU   NVT+452                                                  01704000
NVTVLLE  EQU   NVT+448                                                  01705000
NVTVJPQ  EQU   NVT+444                                                  01706000
NVTLSEC  EQU   NVTLOCAT+4                                               01707000
NVTLFST  EQU   NVTLOCAT                                                 01708000
NVTXSEC  EQU   NVTXCTL+4                                                01709000
NVTXFST  EQU   NVTXCTL                                                  01710000
@NM00068 EQU   NVT+425                                                  01711000
NVTLPACT EQU   NVT+424                                                  01712000
NVTCSLPG EQU   NVT+420                                                  01713000
NVTCSIOB EQU   NVT+416                                                  01714000
NVTCSLNM EQU   NVT+412                                                  01715000
NVTCSLIB EQU   NVT+408                                                  01716000
NVTBLDL  EQU   NVT+404                                                  01717000
NVTVRBLD EQU   NVT+400                                                  01718000
@NM00067 EQU   NVT+392                                                  01719000
NVTVRTCB EQU   NVT+388                                                  01720000
NVTVVTCB EQU   NVT+384                                                  01721000
NVTSPUCB EQU   NVT+382                                                  01722000
NVTQSCNT EQU   NVT+380                                                  01723000
NVTQSBUF EQU   NVT+376                                                  01724000
NVTPTAB  EQU   NVT+372                                                  01725000
NVTPAREA EQU   NVT+368                                                  01726000
NVTRPAGE EQU   NVT+364                                                  01727000
@NM00066 EQU   NVT+363                                                  01728000
NVTABWS1 EQU   NVT+362                                                  01729000
NVTABCD1 EQU   NVT+360                                                  01730000
@NM00065 EQU   NVT+358                                                  01731000
NVTCPUAD EQU   NVT+356                                                  01732000
NVTTOD   EQU   NVT+352                                                  01733000
NVTSPE   EQU   NVT+344                                                  01734000
NVTMBEND EQU   NVT+340                                                  01735000
NVTMBUF  EQU   NVT+336                                                  01736000
NVTDCBSN EQU   NVT+332                                                  01737000
NVTDCBOC EQU   NVT+328                                                  01738000
NVTDCBIC EQU   NVT+324                                                  01739000
@NM00064 EQU   NVT+308                                                  01740000
NVTNMBLD EQU   NVT+304                                                  01741000
NVTNIPM  EQU   NVT+292                                                  01742000
NVTPRMPT EQU   NVT+272                                                  01743000
NVTIX    EQU   NVTFLWSC                                                 01744000
NVTFLWS1 EQU   NVTWPSW2+2                                               01745000
NVTIDPSW EQU   NVTWPSW2                                                 01746000
NVTWPSW1 EQU   NVTWTPSW                                                 01747000
NVTMCPSW EQU   NVT+216                                                  01748000
@NM00063 EQU   NVT+212                                                  01749000
@NM00062 EQU   NVTFLCN                                                  01750000
NVTFLRAC EQU   NVTFLCN                                                  01751000
NVTFLNCK EQU   NVTFLCN                                                  01752000
NVTFLNHC EQU   NVTFLCN                                                  01753000
NVTFLASM EQU   NVTFLCN                                                  01754000
NVTMP    EQU   NVTFLCN                                                  01755000
NVTFLIOC EQU   NVTFLCN                                                  01756000
NVTFLAC  EQU   NVTFLCN                                                  01757000
NVTFLSG  EQU   NVT+210                                                  01758000
NVTTRACE EQU   NVT+208                                                  01759000
NVTNXPTR EQU   NVT+204                                                  01760000
NVTNXSIZ EQU   NVT+202                                                  01761000
@NM00061 EQU   NVT+200                                                  01762000
NVTSGPSA EQU   NVT+196                                                  01763000
NVTN0MSG EQU   NVT+192                                                  01764000
NVTVVPG1 EQU   NVT+188                                                  01765000
NVTNBFND EQU   NVT+184                                                  01766000
NVTNUCND EQU   NVT+180                                                  01767000
NVTSTMAP EQU   NVT+176                                                  01768000
NVTRTMSA EQU   NVT+172                                                  01769000
NVTMFASA EQU   NVT+168                                                  01770000
NVTLSPQE EQU   NVT+164                                                  01771000
NVTALSQA EQU   NVT+160                                                  01772000
NVTPQSAV EQU   NVT+156                                                  01773000
NVTSVC60 EQU   NVT+148                                                  01774000
NVTABSEC EQU   NVTABSAV+4                                               01775000
NVTABFST EQU   NVTABSAV                                                 01776000
NVTNVSQA EQU   NVT+138                                                  01777000
NVTRSVMN EQU   NVT+136                                                  01778000
NVTNBMIN EQU   NVT+134                                                  01779000
NVTRGNAV EQU   NVT+132                                                  01780000
NVTLSQNO EQU   NVT+130                                                  01781000
NVTSQANO EQU   NVT+128                                                  01782000
NVTLSQAS EQU   NVT+124                                                  01783000
NVTLNGFX EQU   NVT+120                                                  01784000
@NM00060 EQU   NVT+112                                                  01785000
NVTASMAD EQU   NVT+108                                                  01786000
NVTNVRSZ EQU   NVT+104                                                  01787000
NVTMFA   EQU   NVT+100                                                  01788000
NVTDSSNG EQU   NVT+96                                                   01789000
NVTMSLNK EQU   NVT+92                                                   01790000
NVTVVMDI EQU   NVT+88                                                   01791000
NVTIGCER EQU   NVT+84                                                   01792000
NVTVBLDL EQU   NVT+80                                                   01793000
NVTSVCTB EQU   NVT+76                                                   01794000
NVTASTCB EQU   NVT+72                                                   01795000
NVTAASCB EQU   NVT+68                                                   01796000
NVTMASCB EQU   NVT+64                                                   01797000
NVTCMTCB EQU   NVT+60                                                   01798000
@NM00059 EQU   NVTFLLB                                                  01799000
NVTFLSLB EQU   NVTFLLB                                                  01800000
@NM00058 EQU   NVTNPATR                                                 01801000
NVTNPREU EQU   NVTNPREN                                                 01802000
@NM00057 EQU   NVTNPREN                                                 01803000
NVTNPSFX EQU   NVT+53                                                   01804000
@NM00056 EQU   NVT+50                                                   01805000
NVTNPSUF EQU   NVT                                                      01806000
LPDEXTAD EQU   LPDEMJNM+4                                               01807000
LPDEXTLN EQU   LPDEMJNM                                                 01808000
LPDEATT3 EQU   LPDE+30                                                  01809000
LPDEAUTH EQU   LPDEATT2                                                 01810000
LPDESYSL EQU   LPDEATT2                                                 01811000
@NM00055 EQU   LPDEATT2                                                 01812000
@NM00054 EQU   LPDEATT2                                                 01813000
LPDERLC  EQU   LPDEATT2                                                 01814000
LPDEXLE  EQU   LPDEATT2                                                 01815000
@NM00053 EQU   LPDEATT2                                                 01816000
LPDENLR  EQU   LPDEATTR                                                 01817000
@NM00052 EQU   LPDEATTR                                                 01818000
LPDEMIN  EQU   LPDEATTR                                                 01819000
@NM00051 EQU   LPDEATTR                                                 01820000
LPDESER  EQU   LPDEATTR                                                 01821000
LPDEREN  EQU   LPDEATTR                                                 01822000
@NM00050 EQU   LPDEATTR                                                 01823000
LPDENIP  EQU   LPDEATTR                                                 01824000
@NM00049 EQU   LPDE+26                                                  01825000
LPDEUSE  EQU   LPDE+24                                                  01826000
LPDEXLP  EQU   LPDE+20                                                  01827000
LPDENAME EQU   LPDE+8                                                   01828000
LPDERBP  EQU   LPDE+4                                                   01829000
LPDECHN  EQU   LPDE                                                     01830000
DCMACBND EQU   DCMACB+40                                                01831000
DCMAPAD  EQU   DCMACLR+27                                               01832000
DCMATECB EQU   DCMACLR+23                                               01833000
DCMAUTME EQU   DCMATFLG+2                                               01834000
@NM00048 EQU   DCMATRCK                                                 01835000
@NM00047 EQU   DCMATRCK                                                 01836000
DCMATTSL EQU   DCMATRCK                                                 01837000
DCMATTS  EQU   DCMATRCK                                                 01838000
@NM00046 EQU   DCMATRCK                                                 01839000
@NM00045 EQU   DCMATRCK                                                 01840000
DCMATJBL EQU   DCMATRCK                                                 01841000
DCMATJOB EQU   DCMATRCK                                                 01842000
@NM00044 EQU   DCMADFLG                                                 01843000
@NM00043 EQU   DCMADFLG                                                 01844000
@NM00042 EQU   DCMADFLG                                                 01845000
@NM00041 EQU   DCMADFLG                                                 01846000
@NM00040 EQU   DCMADFLG                                                 01847000
DCMACSIB EQU   DCMADFLG                                                 01848000
DCMAHOLD EQU   DCMADFLG                                                 01849000
DCMADD   EQU   DCMADFLG                                                 01850000
@NM00039 EQU   DCMAFLG2                                                 01851000
@NM00038 EQU   DCMAFLG2                                                 01852000
@NM00037 EQU   DCMAFLG2                                                 01853000
@NM00036 EQU   DCMAFLG2                                                 01854000
DCMAMJFR EQU   DCMAFLG2                                                 01855000
DCMARCON EQU   DCMAFLG2                                                 01856000
DCMAWCON EQU   DCMAFLG2                                                 01857000
DCMALMIN EQU   DCMAFLG2                                                 01858000
@NM00035 EQU   DCMAFLG1                                                 01859000
@NM00034 EQU   DCMAFLG1                                                 01860000
DCMABL   EQU   DCMAFLG1                                                 01861000
DCMAFULL EQU   DCMAFLG1                                                 01862000
DCMAFRPR EQU   DCMAFLG1                                                 01863000
DCMADEND EQU   DCMAFLG1                                                 01864000
DCMADISP EQU   DCMAFLG1                                                 01865000
@NM00033 EQU   DCMAFLG1                                                 01866000
DCMAMT   EQU   DCMACLR+15                                               01867000
DCMATIME EQU   DCMACLR+11                                               01868000
DCMAMIN  EQU   DCMACLR+7                                                01869000
DCMAMJWQ EQU   DCMACLR+3                                                01870000
DCMAFR   EQU   DCMACLR+1                                                01871000
DCMAROW  EQU   DCMACLR                                                  01872000
DCMATOP  EQU   DCMACB+8                                                 01873000
DCMALN   EQU   DCMACB+6                                                 01874000
DCMAGM   EQU   DCMASACB                                                 01875000
DCMAUSE  EQU   DCMASACB                                                 01876000
DCMAID   EQU   DCMACB+4                                                 01877000
DCMACBNX EQU   DCMACB                                                   01878000
DCMPLNPR EQU   DCMPACB+2                                                01879000
DCMPLN   EQU   DCMPACB                                                  01880000
DCMMSGSV EQU   DCMTSRT+56                                               01881000
@NM00032 EQU   DCMTSRT+52                                               01882000
DCMRQDEL EQU   DCMTSRT+48                                               01883000
@NM00031 EQU   DCMTSRT+46                                               01884000
@NM00030 EQU   DCMR3FLG                                                 01885000
@NM00029 EQU   DCMR3FLG                                                 01886000
DCMRXHMT EQU   DCMR3FLG                                                 01887000
DCMR3PKA EQU   DCMR3FLG                                                 01888000
DCMRXSCN EQU   DCMR3FLG                                                 01889000
DCMCLPR  EQU   DCMR3FLG                                                 01890000
DCMKVIP  EQU   DCMR3FLG                                                 01891000
DCMSTSWT EQU   DCMR3FLG                                                 01892000
@NM00028 EQU   DCMR2FLG                                                 01893000
DCMRXTIM EQU   DCMR2FLG                                                 01894000
@NM00027 EQU   DCMR2FLG                                                 01895000
DCMRXDEL EQU   DCMR2FLG                                                 01896000
DCMRXRLL EQU   DCMR2FLG                                                 01897000
DCMRXTMR EQU   DCMR2FLG                                                 01898000
DCMRXUNV EQU   DCMR2FLG                                                 01899000
DCMRXSFL EQU   DCMR2FLG                                                 01900000
DCMTMCTR EQU   DCMTSRT+42                                               01901000
DCMINTVL EQU   DCMTSRT+40                                               01902000
DCMADPFK EQU   DCMTSRT+36                                               01903000
DCMSUBAD EQU   DCMTSRT+32                                               01904000
DCMDOMKY EQU   DCMTSRT+30                                               01905000
DCMRMSAL EQU   DCMTSRT+28                                               01906000
DCMWLAST EQU   DCMTSRT+24                                               01907000
DCMADRMS EQU   DCMTSRT+21                                               01908000
DCMRMS   EQU   DCMTSRT+20                                               01909000
DCMADSDS EQU   DCMTSRT+16                                               01910000
@NM00026 EQU   DCMDEVTY                                                 01911000
@NM00025 EQU   DCMDEVTY                                                 01912000
@NM00024 EQU   DCMDEVTY                                                 01913000
@NM00023 EQU   DCMDEVTY                                                 01914000
@NM00022 EQU   DCMDEVTY                                                 01915000
@NM00021 EQU   DCMDEVTY                                                 01916000
DCMTY50  EQU   DCMDEVTY                                                 01917000
DCMTY60  EQU   DCMDEVTY                                                 01918000
@NM00020 EQU   @NM00012                                                 01919000
@NM00019 EQU   @NM00012                                                 01920000
@NM00018 EQU   @NM00012                                                 01921000
@NM00017 EQU   @NM00012                                                 01922000
@NM00016 EQU   @NM00012                                                 01923000
@NM00015 EQU   @NM00012                                                 01924000
@NM00014 EQU   @NM00012                                                 01925000
@NM00013 EQU   @NM00012                                                 01926000
DCMTOPDS EQU   DCMTSRT+13                                               01927000
DCMTOPAR EQU   DCMTSRT+12                                               01928000
DCMADKP  EQU   DCMTSRT+8                                                01929000
DCMLEN   EQU   DCMTSRT+6                                                01930000
@NM00011 EQU   DCMRFLGS                                                 01931000
@NM00010 EQU   DCMRFLGS                                                 01932000
@NM00009 EQU   DCMRFLGS                                                 01933000
DCMNIPP  EQU   DCMRFLGS                                                 01934000
DCMDOM   EQU   DCMRFLGS                                                 01935000
@NM00008 EQU   DCMRFLGS                                                 01936000
@NM00007 EQU   DCMRFLGS                                                 01937000
@NM00006 EQU   DCMRFLGS                                                 01938000
@NM00005 EQU   DCMTSRT+4                                                01939000
CVTLEVL  EQU   CVTRELNO+2                                               01940000
CVTNUMB  EQU   CVTRELNO                                                 01941000
CVTMDL   EQU   CVTFIX+250                                               01942000
@NM00004 EQU   CVTFIX+248                                               01943000
@NM00003 EQU   CVTFIX                                                   01944000
CVTRV482 EQU   CVTXTNT2+128                                             01945000
CVTRV481 EQU   CVTXTNT2+124                                             01946000
CVTRV480 EQU   CVTXTNT2+120                                             01947000
CVTRV479 EQU   CVTXTNT2+118                                             01948000
CVTRV478 EQU   CVTXTNT2+117                                             01949000
CVTRV477 EQU   CVTXTNT2+116                                             01950000
CVTRV476 EQU   CVTXTNT2+115                                             01951000
CVTRV475 EQU   CVTXTNT2+114                                             01952000
CVTRV474 EQU   CVTRV466                                                 01953000
CVTRV473 EQU   CVTRV466                                                 01954000
CVTRV472 EQU   CVTRV466                                                 01955000
CVTRV471 EQU   CVTRV466                                                 01956000
CVTRV470 EQU   CVTRV466                                                 01957000
CVTRV469 EQU   CVTRV466                                                 01958000
CVTRV468 EQU   CVTRV466                                                 01959000
CVTRV467 EQU   CVTRV466                                                 01960000
CVTRV465 EQU   CVTRV457                                                 01961000
CVTRV464 EQU   CVTRV457                                                 01962000
CVTRV463 EQU   CVTRV457                                                 01963000
CVTRV462 EQU   CVTRV457                                                 01964000
CVTRV461 EQU   CVTRV457                                                 01965000
CVTRV460 EQU   CVTRV457                                                 01966000
CVTRV459 EQU   CVTRV457                                                 01967000
CVTRV458 EQU   CVTRV457                                                 01968000
CVTRV456 EQU   CVTXTNT2+108                                             01969000
CVTRV455 EQU   CVTXTNT2+104                                             01970000
CVTRV454 EQU   CVTXTNT2+100                                             01971000
CVTRV453 EQU   CVTXTNT2+96                                              01972000
CVTRV452 EQU   CVTXTNT2+94                                              01973000
CVTRV451 EQU   CVTXTNT2+92                                              01974000
CVTRV450 EQU   CVTXTNT2+90                                              01975000
CVTRV449 EQU   CVTXTNT2+88                                              01976000
CVTRV448 EQU   CVTXTNT2+87                                              01977000
CVTRV447 EQU   CVTXTNT2+86                                              01978000
CVTRV446 EQU   CVTRV438                                                 01979000
CVTRV445 EQU   CVTRV438                                                 01980000
CVTRV444 EQU   CVTRV438                                                 01981000
CVTRV443 EQU   CVTRV438                                                 01982000
CVTRV442 EQU   CVTRV438                                                 01983000
CVTRV441 EQU   CVTRV438                                                 01984000
CVTRV440 EQU   CVTRV438                                                 01985000
CVTRV439 EQU   CVTRV438                                                 01986000
CVTRV437 EQU   CVTRV429                                                 01987000
CVTRV436 EQU   CVTRV429                                                 01988000
CVTRV435 EQU   CVTRV429                                                 01989000
CVTRV434 EQU   CVTRV429                                                 01990000
CVTRV433 EQU   CVTRV429                                                 01991000
CVTRV432 EQU   CVTRV429                                                 01992000
CVTRV431 EQU   CVTRV429                                                 01993000
CVTRV430 EQU   CVTRV429                                                 01994000
CVTRV428 EQU   CVTXTNT2+80                                              01995000
CVTRV427 EQU   CVTXTNT2+76                                              01996000
CVTRV426 EQU   CVTXTNT2+72                                              01997000
CVTRV425 EQU   CVTXTNT2+68                                              01998000
CVTATACT EQU   CVTATCVT                                                 01999000
CVTRV423 EQU   CVTXTNT2+62                                              02000000
CVTRV422 EQU   CVTXTNT2+60                                              02001000
CVTRV421 EQU   CVTXTNT2+58                                              02002000
CVTRV420 EQU   CVTXTNT2+56                                              02003000
CVTRV419 EQU   CVTXTNT2+55                                              02004000
CVTRV418 EQU   CVTXTNT2+54                                              02005000
CVTRV417 EQU   CVTRV409                                                 02006000
CVTRV416 EQU   CVTRV409                                                 02007000
CVTRV415 EQU   CVTRV409                                                 02008000
CVTRV414 EQU   CVTRV409                                                 02009000
CVTRV413 EQU   CVTRV409                                                 02010000
CVTRV412 EQU   CVTRV409                                                 02011000
CVTRV411 EQU   CVTRV409                                                 02012000
CVTRV410 EQU   CVTRV409                                                 02013000
CVTRV408 EQU   CVTRV400                                                 02014000
CVTRV407 EQU   CVTRV400                                                 02015000
CVTRV406 EQU   CVTRV400                                                 02016000
CVTRV405 EQU   CVTRV400                                                 02017000
CVTRV404 EQU   CVTRV400                                                 02018000
CVTRV403 EQU   CVTRV400                                                 02019000
CVTRV402 EQU   CVTRV400                                                 02020000
CVTRV401 EQU   CVTRV400                                                 02021000
CVTRSVA1 EQU   CVTXTNT2+48                                              02022000
CVTRSVA0 EQU   CVTXTNT2+44                                              02023000
CVTRSV99 EQU   CVTXTNT2+40                                              02024000
CVTRSV98 EQU   CVTXTNT2+36                                              02025000
CVTRSV97 EQU   CVTXTNT2+34                                              02026000
CVTRSV96 EQU   CVTXTNT2+32                                              02027000
CVTOLTEP EQU   CVTXTNT2+28                                              02028000
CVTQIDA  EQU   CVTQID+1                                                 02029000
CVTRSV95 EQU   CVTQID                                                   02030000
CVTRSV94 EQU   CVTXTNT2+20                                              02031000
CVTRSV93 EQU   CVTXTNT2+16                                              02032000
CVTRSV92 EQU   CVTXTNT2+12                                              02033000
CVTDEBVR EQU   CVTXTNT2+8                                               02034000
CVTRSV91 EQU   CVTXTNT2+6                                               02035000
CVTRSV9H EQU   CVTRSV90                                                 02036000
CVTRSV9G EQU   CVTRSV90                                                 02037000
CVTRSV9F EQU   CVTRSV90                                                 02038000
CVTRSV9E EQU   CVTRSV90                                                 02039000
CVTRSV9D EQU   CVTRSV90                                                 02040000
CVTRSV9C EQU   CVTRSV90                                                 02041000
CVTRSV9B EQU   CVTRSV90                                                 02042000
CVTRSV9A EQU   CVTRSV90                                                 02043000
CVTNUCLS EQU   CVTXTNT2+4                                               02044000
CVTDSSVA EQU   CVTDSSV+1                                                02045000
CVTRSV89 EQU   CVTDSSV                                                  02046000
CVTRSV88 EQU   CVTXTNT1+8                                               02047000
CVTRSV87 EQU   CVTXTNT1+4                                               02048000
CVTFACHN EQU   CVTXTNT1                                                 02049000
CVTRV488 EQU   CVTMAP+412                                               02050000
CVTRV487 EQU   CVTMAP+408                                               02051000
CVTRV486 EQU   CVTMAP+404                                               02052000
CVTRV485 EQU   CVTMAP+400                                               02053000
CVTRV484 EQU   CVTMAP+396                                               02054000
CVTAUTH  EQU   CVTMAP+392                                               02055000
CVTATMCA EQU   CVTATMCT+1                                               02056000
CVTATMST EQU   CVTATMCT                                                 02057000
CVTRSV61 EQU   CVTMAP+384                                               02058000
CVTVOLT1 EQU   CVTVOLM1+1                                               02059000
CVTVOLI1 EQU   CVTVOLF1                                                 02060000
CVTSTOA  EQU   CVTMAP+376                                               02061000
CVTRSV58 EQU   CVTMAP+374                                               02062000
CVTRSV57 EQU   CVTMAP+372                                               02063000
CVTDDCE  EQU   CVTMAP+368                                               02064000
CVTPNWFR EQU   CVTMAP+364                                               02065000
CVTSMF   EQU   CVTMAP+360                                               02066000
CVTSULK  EQU   CVTMAP+358                                               02067000
CVTSLKO  EQU   CVTSYSK                                                  02068000
CVTSLKP  EQU   CVTSYSK                                                  02069000
CVTSLKQ  EQU   CVTSYSK                                                  02070000
CVTSLKR  EQU   CVTSYSK                                                  02071000
CVTRSV56 EQU   CVTSYSK                                                  02072000
CVTRSV55 EQU   CVTSYSK                                                  02073000
CVTRSV54 EQU   CVTSYSK                                                  02074000
CVTRSV53 EQU   CVTSYSK                                                  02075000
CVTRSV52 EQU   CVTA1F1                                                  02076000
CVTRSV51 EQU   CVTA1F1                                                  02077000
CVTRSV50 EQU   CVTA1F1                                                  02078000
CVTRSV49 EQU   CVTA1F1                                                  02079000
CVTRSV48 EQU   CVTA1F1                                                  02080000
CVTRSV47 EQU   CVTA1F1                                                  02081000
CVTSRSW  EQU   CVTA1F1                                                  02082000
CVTPFSW  EQU   CVTA1F1                                                  02083000
CVTPCVT  EQU   CVTMAP+352                                               02084000
CVTRSV46 EQU   CVTMAP+344                                               02085000
CVTRSV45 EQU   CVTMAP+340                                               02086000
CVTRSV44 EQU   CVTMAP+338                                               02087000
CVTRSV43 EQU   CVTMAP+336                                               02088000
CVTHJESA EQU   CVTHJES+1                                                02089000
CVTRSV42 EQU   CVTHJES                                                  02090000
CVTEXT2A EQU   CVTEXT2+1                                                02091000
CVTRSV41 EQU   CVTEXT2                                                  02092000
CVTAPFA  EQU   CVTAPF+1                                                 02093000
CVTRSV40 EQU   CVTAPF                                                   02094000
CVTINTLA EQU   CVTMAP+320                                               02095000
CVTERPV  EQU   CVTMAP+316                                               02096000
CVTEORM  EQU   CVTMAP+312                                               02097000
CVTMCHPR EQU   CVTMAP+308                                               02098000
CVTTZ    EQU   CVTMAP+304                                               02099000
CVTJEPS  EQU   CVTMAP+300                                               02100000
CVTJESCT EQU   CVTMAP+296                                               02101000
CVTMODE  EQU   CVTMAP+292                                               02102000
CVTPTRV  EQU   CVTMAP+288                                               02103000
CVTREAL  EQU   CVTMAP+284                                               02104000
CVTRSV39 EQU   CVTMAP+280                                               02105000
CVTRSV38 EQU   CVTMAP+276                                               02106000
CVTDMSRA EQU   CVTDMSR+1                                                02107000
CVTRSV37 EQU   CVTDMSR                                                  02108000
CVTQMSGA EQU   CVTQMSG+1                                                02109000
CVTRSV36 EQU   CVTQMSG                                                  02110000
CVTAMFF  EQU   CVTMAP+264                                               02111000
CVTPURGA EQU   CVTPURG+1                                                02112000
CVTRSV35 EQU   CVTPURG                                                  02113000
CVTCBSP  EQU   CVTMAP+256                                               02114000
CVTATERA EQU   CVTATER+1                                                02115000
CVTSYST  EQU   CVTATER                                                  02116000
CVTVOLT2 EQU   CVTTAT                                                   02117000
CVTVOLI2 EQU   CVTVOLF2                                                 02118000
CVTAQAVB EQU   CVTAQAVT+1                                               02119000
CVTRSV34 EQU   CVTTCMFG                                                 02120000
CVTRSV33 EQU   CVTTCMFG                                                 02121000
CVTRSV32 EQU   CVTTCMFG                                                 02122000
CVTRSV31 EQU   CVTTCMFG                                                 02123000
CVTRSV30 EQU   CVTTCMFG                                                 02124000
CVTRSV29 EQU   CVTTCMFG                                                 02125000
CVTRSV28 EQU   CVTTCMFG                                                 02126000
CVTTCRDY EQU   CVTTCMFG                                                 02127000
CVTGTFA  EQU   CVTGTF+1                                                 02128000
CVTRSV27 EQU   CVTGTFST                                                 02129000
CVTRNIO  EQU   CVTGTFST                                                 02130000
CVTRV319 EQU   CVTUSR                                                   02131000
CVTRV318 EQU   CVTFORM                                                  02132000
CVTRV317 EQU   CVTTMODE                                                 02133000
CVTRV316 EQU   CVTSTATE                                                 02134000
CVTRV315 EQU   CVTGTFS                                                  02135000
CVTGTFAV EQU   CVTGTFS                                                  02136000
CVT0SCR1 EQU   CVTMAP+232                                               02137000
CVTRV515 EQU   CVTMAP+228                                               02138000
CVTRMS   EQU   CVTMAP+224                                               02139000
CVTPATCH EQU   CVTMAP+220                                               02140000
CVTTSCE  EQU   CVTMAP+216                                               02141000
CVTLNKSC EQU   CVTMAP+214                                               02142000
CVTQABST EQU   CVTMAP+212                                               02143000
CVTMDLDS EQU   CVTMAP+208                                               02144000
CVTUSER  EQU   CVTMAP+204                                               02145000
CVTABEND EQU   CVTMAP+200                                               02146000
CVTSMCA  EQU   CVTMAP+196                                               02147000
CVTRSV18 EQU   CVTMAP+192                                               02148000
CVTRSV17 EQU   CVTOPTB                                                  02149000
CVTRSV16 EQU   CVTOPTB                                                  02150000
CVTFP    EQU   CVTOPTB                                                  02151000
CVTAPTHR EQU   CVTOPTB                                                  02152000
CVTNLOG  EQU   CVTOPTB                                                  02153000
CVTTOD   EQU   CVTOPTB                                                  02154000
CVTCTIMS EQU   CVTOPTB                                                  02155000
CVTPROT  EQU   CVTOPTB                                                  02156000
CVTXPFP  EQU   CVTOPTA                                                  02157000
CVTASCII EQU   CVTOPTA                                                  02158000
CVTRSV13 EQU   CVTOPTA                                                  02159000
CVTRSV12 EQU   CVTOPTA                                                  02160000
CVTNIP   EQU   CVTOPTA                                                  02161000
CVTDDR   EQU   CVTOPTA                                                  02162000
CVTAPR   EQU   CVTOPTA                                                  02163000
CVTCCH   EQU   CVTOPTA                                                  02164000
CVTSNCTR EQU   CVTMAP+180                                               02165000
CVTQMWR  EQU   CVTMAP+176                                               02166000
CVTQOCR  EQU   CVTMAP+172                                               02167000
CVT1EF00 EQU   CVTMAP+168                                               02168000
CVTMZ00  EQU   CVTMAP+164                                               02169000
CVTHEAD  EQU   CVTMAP+160                                               02170000
CVTRSV11 EQU   CVTMAP+156                                               02171000
CVT0PT01 EQU   CVTMAP+152                                               02172000
CVTMSER  EQU   CVTMAP+148                                               02173000
CVTIERLC EQU   CVTMAP+144                                               02174000
CVTILCH  EQU   CVTMAP+140                                               02175000
CVT0DS   EQU   CVTMAP+136                                               02176000
CVTFBOSV EQU   CVTMAP+132                                               02177000
CVTNUCB  EQU   CVTMAP+128                                               02178000
CVTIXAVL EQU   CVTMAP+124                                               02179000
CVTIOQET EQU   CVTMAP+120                                               02180000
CVTDCBA  EQU   CVTMAP+117                                               02181000
CVTMVS2  EQU   CVTDCB                                                   02182000
CVT6DAT  EQU   CVTDCB                                                   02183000
CVT4MPS  EQU   CVTDCB                                                   02184000
CVTRSV09 EQU   CVTDCB                                                   02185000
CVT4MS1  EQU   CVTDCB                                                   02186000
CVT2SPS  EQU   CVTDCB                                                   02187000
CVT1SSS  EQU   CVTDCB                                                   02188000
CVTRSV08 EQU   CVTDCB                                                   02189000
CVTSTB   EQU   CVTMAP+112                                               02190000
CVTQTD00 EQU   CVTMAP+108                                               02191000
CVTQTE00 EQU   CVTMAP+104                                               02192000
CVTSJQ   EQU   CVTMAP+96                                                02193000
CVTPBLDL EQU   CVTMAP+92                                                02194000
CVTTPC   EQU   CVTMAP+88                                                02195000
CVTSVDCB EQU   CVTMAP+84                                                02196000
CVTBRET  EQU   CVTMAP+82                                                02197000
CVTEXIT  EQU   CVTMAP+80                                                02198000
CVT0FN00 EQU   CVTMAP+76                                                02199000
CVTDARA  EQU   CVTDAR+1                                                 02200000
CVTRSV07 EQU   CVTFLGS1                                                 02201000
CVTRSV06 EQU   CVTFLGS1                                                 02202000
CVTRSV05 EQU   CVTFLGS1                                                 02203000
CVTRSV04 EQU   CVTFLGS1                                                 02204000
CVTRSV03 EQU   CVTFLGS1                                                 02205000
CVTRSV02 EQU   CVTFLGS1                                                 02206000
CVTRSV01 EQU   CVTFLGS1                                                 02207000
CVTDMPLK EQU   CVTFLGS1                                                 02208000
CVTXITP  EQU   CVTMAP+68                                                02209000
CVTZDTAB EQU   CVTMAP+64                                                02210000
CVTMSLT  EQU   CVTMAP+60                                                02211000
CVTDATE  EQU   CVTMAP+56                                                02212000
CVTBTERM EQU   CVTMAP+52                                                02213000
CVTSYSAD EQU   CVTMAP+48                                                02214000
CVTXTLER EQU   CVTMAP+44                                                02215000
CVTILK2  EQU   CVTMAP+40                                                02216000
CVTILK1  EQU   CVTMAP+36                                                02217000
CVTPRLTV EQU   CVTMAP+32                                                02218000
CVTPCNVT EQU   CVTMAP+28                                                02219000
CVT0VL00 EQU   CVTMAP+24                                                02220000
CVTXAPG  EQU   CVTMAP+20                                                02221000
CVTBUF   EQU   CVTMAP+16                                                02222000
CVTJOB   EQU   CVTMAP+12                                                02223000
CVTLINK  EQU   CVTMAP+8                                                 02224000
CVT0EF00 EQU   CVTMAP+4                                                 02225000
CVTTCBP  EQU   CVTMAP                                                   02226000
CVT      EQU   CVTMAP                                                   02227000
CDATTR3  EQU   CDENTRY+30                                               02228000
CDAUTH   EQU   CDATTR2                                                  02229000
CDSYSLIB EQU   CDATTR2                                                  02230000
CDOLY    EQU   CDATTR2                                                  02231000
@NM00002 EQU   CDATTR2                                                  02232000
CDRLC    EQU   CDATTR2                                                  02233000
CDXLE    EQU   CDATTR2                                                  02234000
CDREL    EQU   CDATTR2                                                  02235000
CDSPZ    EQU   CDATTR2                                                  02236000
CDNLR    EQU   CDATTR                                                   02237000
CDJPA    EQU   CDATTR                                                   02238000
CDMIN    EQU   CDATTR                                                   02239000
CDNFN    EQU   CDATTR                                                   02240000
CDSER    EQU   CDATTR                                                   02241000
CDREN    EQU   CDATTR                                                   02242000
CDNIC    EQU   CDATTR                                                   02243000
CDNIP    EQU   CDATTR                                                   02244000
@NM00001 EQU   CDENTRY+26                                               02245000
CDUSE    EQU   CDENTRY+24                                               02246000
CDXLMJP  EQU   CDENTRY+20                                               02247000
CDNAME   EQU   CDENTRY+8                                                02248000
CDRRBP   EQU   CDENTRY+4                                                02249000
CDCHAIN  EQU   CDENTRY                                                  02250000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      02251000
@RT00111 EQU   NP7PDNXT                                                 02252000
@RT00114 EQU   NP7PDNXT                                                 02253000
NP7PDXIT EQU   @EL00001                                                 02254000
@ENDDATA EQU   *                                                        02255000
         END   IEAVNP07,(C'PL/S-II',0502,73297)                         02256000
./  ADD  SSI=32960724,NAME=IEECVETA
         TITLE 'IEECVETA OPTIONS'                                       00050002
IEECVETA CSECT                                                          00100002
**********************************************************************  00500002
*                                                                       00550002
*  STATUS    CHANGE LEVEL 0                                             00600002
*                                                                       00650002
*  FUNCTION    TO EVALUATE THE OPTIONS SELECTED BY THE USER OF A        00700002
*            DEVICE, AND DETERMINE WHETHER THEY ARE LEGITIMATE.  IF SO, 00750002
*            INDICATORS ARE PASSED TO ALL OTHER ROUTINES AS TO WHAT THE 00800002
*            OPTIONS ARE.  IF AN ILLEGAL OPTION OR COMBINATION OF       00850002
*            OPTIONS IS ENCOUNTERED, INDICATORS ARE PASSED FOR THE      00900002
*            PRINTING OF THE APPROPRIATE ERROR MESSAGE.  THIS ROUTINE   00950002
*            ALSO, AT THE USER'S REQUEST, ARRANGES TO HAVE THE PRESENT  01000002
*            STATUS OF ALL OPTIONS DISPLAYED.                           01050002
*                                                                       01100002
*  ENTRY POINT    CONTROL IS PASSED ONLY THROUGH THE CSECT LABEL,       01150002
*               IEECVETA.  THE FIRST EXECUTABLE INSTRUCTION IS LABELED  01200002
*               START.                                                  01250002
*                                                                       01300002
*  INPUT    ALL OPERANDS OF ANY K S COMMAND ENTERED ON THE DEVICE BY A  01350002
*         USER.  THESE ARE RECEIVED IN EBCDIC IN THE FORMAT IN WHICH    01400002
*         THEY APPEAR ON THE SCREEN WHEN ENTERED.                       01450002
*                                                                       01500002
*  OUTPUT    THE CURRENT VALUES OF ALL OPTIONS ARE KEPT UP IN THE DCM.  01550002
*          WHEN REQUESTED, ALL OF THE OPTIONS AND THEIR VALUES ARE      01600002
*          TRANSFERRED INTO A BUFFER AREA, FROM WHICH THEY WILL BE      01650002
*          DISPLAYED.                                                   01700002
*                                                                       01750002
* EXTERNAL REFERENCES NONE                                              01800002
*                                                                       01850002
*  EXITS - NORMAL  IEECVETK TIMER INTERPRETER:  IF THE DISPLAY HAS JUST 01900002
*                  GONE INTO OR OUT OF ROLL MODE; OR, IF THE VALUE OF   01950002
*                  RTME HAS JUST BEEN CHANGED; OR, IF ALL THE ABOVE AND 02000002
*                  THE WARNING MESSAGE IS TO BE DISPLAYED               02050002
*                  IEECVETD MESSAGE MODULE 1:  IF A WARNING MESSAGE IS  02100002
*                  TO BE DISPLAYED                                      02150002
*                  IEECVETH OR P OR R DEVICE-DEPENDENT IO:  IF NONE OF  02200002
*                  THE ABOVE CONDITIONS EXIST                           02250002
*       - ERROR    IEECVETD MESSAGE MODULE 1                            02300002
*                  IEECVETK TIMER/INTERPRETER ROUTINE                   02350002
*                                                                       02400002
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         02450002
*                   RESIDENT DISPLAY CONTROL MODULE (CONTAINED   S21002 02500002
*                   IN DSECT)                                    S21002 02550002
*                                                                       02600002
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      02650002
*                                                                       02700002
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      02750002
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       02800002
*              CHARACTER SET.                                           02850002
*                                                                       02900002
**********************************************************************  02950002
         EJECT                                                          03000002
*/*IEECVETA: CHART */                                                   03050002
*/*IEECVETA: E OPTIONS RTN */                                           03100002
*/*START: P ESTABLISH ADDRESSABILITY */                                 03150002
*/* P BASE THE RDCM, TDCM, UCM */                                       03200002
*/* P POINT TO THE COMMAND IN THE DCM */                                03250002
*/* D (NO,,YES,OREF) IS SECOND CHARACTER A BLANK ? */                   03300002
*/* D (NO,,YES,OREF) IS OPERAND 'S,REF' ? */                            03350002
*/*NEXT: D (NO,,YES,OUT) IS OPERAND BLANK ? */                          03400002
*/* D (NO,,YES,OCON) IS OPERAND ',CON=' ? */                            03450002
*/* D (NO,,YES,ODEL) IS OPERAND ',DEL=' ? */                            03500002
*/* D (NO,,YES,OSEG) IS OPERAND ',SEG=' ? */                            03550002
*/* D (NO,,YES,ORNUM) IS OPERAND ',RNUM=' ? */                          03600002
*/* D (NO,,YES,ORTME) IS OPERAND ',RTME=' ? */                          03650002
*/* P POINT EXIT TO INVALID OPERAND */                                  03700002
*/*INVALOP: P INDICATE INVALID OPERAND AND POINT TO IT */               03750002
*/*ERRIND: P INDICATE EXIT TO MESSAGE MODULE */                         03800002
*/* P (,INSRT) POINT TO CURSOR POSITION */                              03850002
*/*OUT: P INDICATE BLANK ENTRY AREA AND INSTR LINE */                   03900002
*/* P WRITE ENTRY AREA */                                               03950002
*/* P (,INSRT) INDICATE PUT CURSOR IN POS 1 OF ENTRY AREA */            04000002
*/*OREF: P BLANK THE ENTRY AREA */                                      04050002
*/* P INDICATE THIS IS AN OPTIONS MESSAGE */                            04100002
*/* S UNDO RTN:CONVERT SEG VALUE TO EBCDIC */                           04150002
*/* S UNDO RTN:CONVERT RNUM VALUE TO EBCDIC */                          04200002
*/* S UNDO RTN:CONVERT RTME VALUE TO EBCDIC */                          04250002
*/* P PUT ALL INFO IN ENTRY AREA FOR S,REF */                           04300002
*/*PUT: P INDICATE WRITE ENTRY AREA */                                  04350002
*/* P SET EXIT TO MESSAGE MODULE */                                     04400002
*/* P SET INSERT CURSOR IN LINE 1 POS 9 */                              04450002
*/*INSRT: P INDICATE WRITE INSTR LINE AND INSERT CURSOR */              04500002
*/* D (NO,,YES,WHERE) NO HARDCOPY BIT ON ? */                           04550002
*/* D (NO,,YES,WHERE) DEL = R ? */                                      04600002
*/* D (NO,,YES,MORE) DEL = Y ? */                                       04650002
*/*THERE: P INDICATE WRITE WARNING LINE */                              04700002
*/* P INDICATE BLANK 2ND HALF WARNING LINE */                           04750002
*/*WHERE: D (NO,,YES,TI) GO TO TIMER INTERPRET RTN ? */                 04800002
*/* D (NO,,YES,MM) EXIT TO MESSAGE MODULE ? */                          04850002
*/* P (,XCTL) SET EXIT TO I/O RTN */                                    04900002
*/*MORE: D (NO,THERE,YES,) CON = N ? */                                 04950002
*/* P SET EXIT TO MESSAGE MODULE */                                     05000002
*/* P (,WHERE) DISPLAY WARNING CON=N,DEL=Y MESSAGE */                   05050002
*/*TI: P (,XCTL) SET EXIT TO TIMER INTER RTN */                         05100002
*/*MM: P RESET EXIT TO MSG MOD BIT */                                   05150002
*/* P PUT MSG MOD NAME IN XCTL LIST */                                  05200002
*/*XCTL: R EXIT TO PROPER MODULE */                                     05250002
*/*OCON: D (NO,NCON,YES,) CON = Y IN COMMAND ? */                       05300002
*/* P (,MCON) INDICATE THAT FACT IN DCM */                              05350002
*/*NCON: D (NO,INVALOP,YES,) CON = N IN COMMAND ? */                    05400002
*/* D (NO,,YES,ERRHARD) IS NO HARD COPY BIT ON ? */                     05450002
*/* P INDICATE CON = N IN DCM */                                        05500002
*/*MCON: P (,NEXT) PUT CON VALUE (Y OR N) IN DCM */                     05550002
*/*ODEL: D (NO,NDEL,YES,) DEL = Y IN COMMAND ? */                       05600002
*/* D (NO,,YES,ERRHARD) IS NO HARD COPY FLAG SET ? */                   05650002
*/* P (,YN) INDICATE DEL = Y IN DCM */                                  05700002
*/*NDEL: D (NO,RDEL,YES,) DEL = N IN COMMAND */                         05750002
*/* P RESET DEL = Y FLAG */                                             05800002
*/*YN: D (NO,SAME,YES,) DEL MODE = R/RD ? */                            05850002
*/* P SET EXIT TO TIMER INT RTN */                                      05900002
*/*SAME: P INDICATE BLANK LEFT HALF WARN LINE AND WRITE SAME */         05950002
*/* P TURN OFF ROLL MODE AND MSG FLAGS */                               06000002
*/*MDEL: P (,NEXT) SET DEL OPTION TO CORRECT STATE */                   06050002
*/*RDEL: D (NO,INVALOP,YES,) DEL = R IN COMMAND */                      06100002
*/* P INDICATE THAT IN THE DCM */                                       06150002
*/* D (NO,,YES,ERRHARD) NO HARD COPY FLAG SET ? */                      06200002
*/* P SET EXIT TO TIMER INTER RTN */                                    06250002
*/*NOCH: D (NO,NOCH0,YES,) IS UNVIEWABLE MSG ON SCREEN ? */             06300002
*/* P INDICATE REMOVE MESSAGE */                                        06350002
*/*NOCH0: D (NO,NOTFUL,YES,) IS SCREEN FULL ? */                        06400002
*/* P TURN OFF FLAG */                                                  06450002
*/*NOCH1: P INDICATE REMOVE MSG WAITING MSG */                          06500002
*/*NOTFUL: D (NO,MDEL,YES,) HAS D BEEN SPECIFIED ? */                   06550002
*/* P (,NEXT) INDICATE SO IN DCM */                                     06600002
*/*ERRHARD: P (,ERRIND) INDICATE PUT OUT NO HARD COPY MSG */            06650002
*/*OSEG: S NUM RTN: CONVERT SEG VALUE TO BINARY */                      06700002
*/* D (NO,,YES,INVALOP) DOES NEW SEG EXCEED MAX ? */                    06750002
*/* D (NO,,YES,OFF) NEW SEG = 0 ? */                                    06800002
*/* P (,IN) INDICATE THAT IN DCM */                                     06850002
*/*OFF: P INDICATE THAT IN DCM */                                       06900002
*/*IN: P (,NEXT) PUT SEG VALUE IN DCM */                                06950002
*/*ORNUM: S NUM RTN:CONVERT RNUM VALUE TO BINARY */                     07000002
*/* D (NO,,YES,INVALOP) DOES RNUM EXCEED MAX ? */                       07050002
*/* D (NO,,YES,INVALOP) IS RNUM = 0 ? */                                07100002
*/* P (,NEXT) HOLD NEW VALUE */                                         07150002
*/*ORTME: S NUM RTN:CONVERT RTME VALUE TO BINARY */                     07200002
*/* D (NO,,YES,INVALOP) IS RTME = 0 ? */                                07250002
*/* P (,NEXT) HOLD NEW VALUE IN DCM */                                  07300002
*/*NUM: E NUMBER CONVERT RTN */                                         07350002
*/* P FIND END OF NUMBER */                                             07400002
*/* D (NO,,YES,INVALOP) NUMBER LESS THAT 0 ? */                         07450002
*/* P CONVERT NUMBER TO BINARY */                                       07500002
*/* R BR 14 */                                                          07550002
*/*UNDO: E NUMBER UNCONVERT RTN */                                      07600002
*/* P CONVERT NUMBER TO EBCDIC */                                       07650002
*/* R BR 14 */                                                          07700002
*/*IEECVETA: END */                                                     07750002
         EJECT                                                          07800002
START    LR    BASERA,RF           ESTABLISH ADDRESSIBILITY             07850002
         USING START,BASERA                                             07900002
         B     BEGIN               BRANCH AROUND PATCH AREA             07910002
ICATCH   DC    CL72'IEECVETA'      EYECATCHER AND FIELD MAINTENANCE     07920002
BEGIN    EQU   *                   END OF PATCH AREA                    07930002
         LR    CXSARB,R1           ESTABLISH CXSA ADDRESS               07950002
         USING CXSA,CXSARB                                              08000002
         L     UCMERC,CSAUCM       ESTABLISH UCM ADDRESS                08100002
         USING UCMLIST,UCMERC                                           08150002
         L     RRDCM,UCMXB         ESTABLISH RDCM                S21003 08200002
         USING DCMTSRT,RRDCM          ESTABLISH ADDRESSABILITY          08250002
         L     DCMR9,Z(RRDCM)      ESTABLISH TDCM                S21003 08300002
         USING DCMSTRT,DCMR9                                            08350002
         L     UCMR7,CSACTLM       ESTABLISH UCM BASE REG               08400002
         USING UCM,UCMR7           ESTABLISH UCM BASE                   08450002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      08460002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    08470002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      08480002
         L     ENTR2,DCMAENTR      ADDRESS OF DCMENTRY                  08500002
         L     OPR3,DCMADOPN       ADDR OF OPERAND IN DCMENTRY          08550002
*     THIS ROUTINE WILL TEST WHICH OPTION HAS BEEN SPECIFIED            08600002
         CLI   I(OPR3),BLANK       IS SECOND CHAR BLANK                 08650002
         BE    OREF                IF SO, DEFAULT = S,REF               08700002
         CLC   I(V,OPR3),CREF      IS OPERAND S,REF                     08750002
         BE    OREF                YES                                  08800002
         LA    OPR3,I(OPR3)                                             08850002
         LA    RF,NUM              RTN TO WHICH NUMERICAL OPS BALR      08900002
NEXT     EQU   *                                                        08950002
         CLI   Z(OPR3),BLANK       IS OPERAND BLANK                     09000002
         BE    OUT                 IF SO, GO TO EXIT RTN                09050002
         LA    R1,V(OPR3)          THIS POINTS R1 TO A POSSIBLE INVALID 09100002
*     VALUE OF CON OR DEL.  FOR OTHER OPS, ANOTHER ADDR WILL GO IN R1.  09150002
         CLC   Z(V,OPR3),CCON      IS OPERAND ,CON=                     09200002
         BE    OCON                YES                                  09250002
         CLC   Z(V,OPR3),CDEL      IS OPERAND ,DEL=                     09300002
         BE    ODEL                YES                                  09350002
         CLC   Z(V,OPR3),CSEG      IS OPERAND ,SEG=                     09400002
         BE    OSEG                YES                                  09450002
         CLC   Z(VI,OPR3),CRNUM    IS OPERAND ,RNUM=                    09500002
         BE    ORNUM               YES                                  09550002
         CLC   Z(VI,OPR3),CRTME    IS OPERAND ,RTME=                    09600002
         BE    ORTME               YES                                  09650002
         LA    R1,I(OPR3)          NOW POINT R1 TO INVALID OP           09700002
*     UPON BRANCH HERE, R1 ALWAYS POINTS TO INVALID OPERAND             09750002
INVALOP  EQU   *                                                        09800002
         ST    R1,DCMDSAV          MOVE IN ADDR OF INVALID OP           09850002
         OI    DCMCMSG2,DCMINVOP   INVALID OP MSG BIT                   09900002
ERRIND   EQU   *                                                        09950002
         OI    DCMTIMES,DCMOTTMM   OPT OR TI SHOULD EXIT TO MM          10000002
         BCTR  ENTR2,R0            SUBTRACT ONE TO GET POSITION         10050002
         SR    R1,ENTR2            POS OF OP IN ENTRY AREA              10100002
         CH    R1,DCMLGNTH         OP ON SECOND LINE                    10150002
         BL    ONE                 NO                                   10200002
         MVI   DCMCULNO,II         LINE TWO                             10250002
         SH    R1,DCMLGNTH                                              10300002
         STC   R1,DCMPOSCU         STORE CURSOR POSITION                10350002
         B     INSRT               INSERT CURSOR                        10400002
ONE      MVI   DCMCULNO,I          LINE ONE                             10450002
         STC   R1,DCMPOSCU         STORE CURSOR POSITION                10500002
         B     INSRT               INSERT CURSOR                        10550002
OUT      EQU   *                                                        10600002
         OI    DCMIOCM2,BLENTINS   BLANK ENTRY AREA AND INST LINE BITS  10650002
         OI    DCMIOCM1,DCMWRENT   WRITE ENTRY AREA BIT                 10700002
         MVI   DCMCULNO,I          LINE ONE                             10750002
         MVI   DCMPOSCU,I            AND POS ONE FOR CURSOR             10800002
         B     INSRT               INSERT CURSOR                        10850002
OREF     EQU   *                                                        10900002
         MVI   Z(ENTR2),BLANK                                           10950002
         MVC   I(CXXV,ENTR2),Z(ENTR2)  BLANK ENTRY AREA                 11000002
         OI    DCMCMSG1,DCMCHOPT   OPTIONS MSG BIT                      11050002
         MVC   Z(XL,ENTR2),SCOMMAND   MOVE SKELETON LINE         S21002 11100002
         MVC   VIII(II,ENTR2),DCMDEL    VALUE OF DEL                    11150002
         MVC   XXII(I,ENTR2),DCMCON     VALUE OF CON                    11200002
         XR    R6,R6                                                    11250002
         LA    RF,UNDO                                                  11300002
         IC    R6,DCMSEG                     BINARY VALUE OF SEG        11350002
         BALR  RE,RF                         TO CONVERT TO EBCDIC       11400002
         MVC   XV(II,ENTR2),DCMPACK+II       VALUE OF SEG               11450002
         IC    R6,DCMRNUM                    BINARY VALUE OF RNUM       11500002
         BALR  RE,RF                         TO CONVERT TO EBCDIC       11550002
         MVC   XXIX(II,ENTR2),DCMPACK+II   VALUE OF RNUM         S21002 11600002
         LH    R6,DCMRTME                    BINARY VALUE OF RTME       11650002
         BALR  RE,RF                         TO CONVERT TO EBCDIC       11700002
         MVC   XXXVII(III,ENTR2),DCMPACK+I   VALUE OF RTME       S21002 11750002
         CLI   IX(ENTR2),BLANK     IS VALUE OF DEL ONE CHAR             11800002
         BNE   PUT                 IF NOT, CONTINUE                     11850002
         MVC   IX(XXXVII,ENTR2),X(ENTR2)     ELSE, MOVE OVER RIGHT PART 11900002
PUT      EQU   *                                                        11950002
         OI    DCMIOCM1,DCMWRENT   WRITE ENTRY AREA BIT                 12000002
         OI    DCMTIMES,DCMOTTMM   OPT OR TI SHOULD EXIT TO MM          12050002
         MVI   DCMCULNO,I          LINE ONE                             12100002
         MVI   DCMPOSCU,IX           AND POS NINE FOR CURSOR            12150002
INSRT    EQU   *                                                        12200002
         OI    DCMIOCM1,WRININSC   WRITE INST LINE AND INSERT CURSOR    12250002
         CLI   DCMDEL,CHARR        Q. DEL=R                             12400002
         BE    WHERE               YES,DEPART                           12450002
         CLI   DCMDEL,CHARY        Q. DEL=Y                             12500002
         BE    MORE                YES, TEST FOR CON=N                  12550002
THERE    EQU   *                                                        12600002
         OI    DCMIOCM1,DCMWRWRN   NO, INDICATE WRITE WARNING LINE      12650002
         OI    DCMIOCM2,DCMBLWRL   AND BLANK LEFT HALF OF WARNING LINE  12700002
WHERE    EQU   *                                                        12750002
         TM    DCMTIMES,DCMOPTTI   OPT TO TI BIT SET                    12800002
         BO    TI                  IF SO, EXIT TO TI RTN                12850002
         TM    DCMTIMES,DCMOTTMM   SHOULD RTN EXIT TO MSG MOD           12900002
         BO    MM                  IF SO, GO DO IT                      12950002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              13000002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 13010002
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         13050002
MORE     EQU   *                                                        13100002
         CLI   DCMCON,CHARN        Q. CON=N                             13150002
         BNE   THERE               NO, GO BLANK WARNING LINE            13200002
         OI    DCMTIMES,DCMOTTMM   YES, OPTIONS OR TIMER/INTERPRETER    13250002
*                                    SHOULD EXIT TO MESSAGE MODULE      13300002
         OI    DCMCMSG1,DCMWRCDL   MOVE IN WARNING CON=N,DEL=Y MESSAGE  13350002
         B     WHERE               DEPART                               13400002
TI       EQU   *                                                        13450002
         L     XFBRANCH,DCMNTIMR   LOAD TIMER INTERPRETER ADDRESS       13500002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 13510002
         BR    XFBRANCH            EXIT TO IEECVETK                     13550002
MM       EQU   *                                                        13600002
         NI    DCMTIMES,OFFOTTMM   TURN OFF EXIT TO MM BIT              13650002
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               13700002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 13710002
         BR    XFBRANCH            EXIT TO IEECVETD                     13750002
OCON     EQU   *                                                        14000002
         CLI   V(OPR3),CHARY       CON=Y                                14050002
         BNE   NCON                NO                                   14100002
         OI    DCMOPTST,DCMOPTVR   CON BIT                              14150002
         B     MCON                MOVE IN Y                            14200002
NCON     EQU   *                                                        14250002
         CLI   V(OPR3),CHARN       CON=N                                14300002
         BNE   INVALOP             IT HAD BETTER BE                     14350002
         NI    DCMOPTST,OFFOPTVR   CON BIT OFF                          14500002
MCON     EQU   *                                                        14550002
         MVC   DCMCON(I),V(OPR3)   MOVE VALUE IN                        14600002
         LA    OPR3,VI(OPR3)       UPDATE OP PTR                        14650002
         B     NEXT                HERE WE GO AGAIN                     14700002
ODEL     EQU   *                                                        14750002
         CLI   V(OPR3),CHARY       DEL=Y                                14800002
         BNE   NDEL                NO                                   14850002
         OI    DCMOPTST,DCMOPTAD   DEL BIT                              15000002
         B     YN                  FOR YES OR NO                        15050002
NDEL     EQU   *                                                        15100002
         CLI   V(OPR3),CHARN       DEL=N                                15150002
         BNE   RDEL                NO                                   15200002
         NI    DCMOPTST,OFFOPTAD   DEL BIT OFF                          15250002
YN       EQU   *                                                        15300002
         CLI   DCMDEL,CHARR        IS MODE NOW R OR RD                  15350002
         BNE   SAME                IF NOT, OK                           15400002
         OI    DCMTIMES,DCMOPTTI   ELSE, TURN ON OPT TO TI BIT          15450002
SAME     EQU   *                                                        15500002
         OI    DCMIOCM2,DCMBLWRL   BLANK LEFT HALF WARN LINE BIT        15550002
         OI    DCMIOCM1,DCMWRWRN   INDICATE WRITE WARNING LINE          15600002
         NI    DCMOPTST,OFFOPRLL   ROLL BIT OFF                         15650002
         NI    DCMCMSG3,OFFCMRLL   ROLL MODE MSG BIT OFF                15700002
         NI    DCMR2FLG,N255-DCMRXUNV  TURN OFF BIT IF ON        S21002 15750002
MDEL     EQU   *                                                        15800002
         MVC   DCMDEL(I),V(OPR3)   MOVE IN CHAR                         15850002
         MVI   DCMDEL+I,BLANK      MOVE IN BLANK                        15900002
         LA    OPR3,VI(OPR3)       UPDATE OP PTR                        15950002
         B     NEXT                AND AGAIN                            16000002
RDEL     EQU   *                                                        16050002
         CLI   V(OPR3),CHARR       DEL=R                                16100002
         BNE   INVALOP             NOT ANYTHING                         16150002
         OI    DCMOPTST,DCMOPRLL   ROLL BIT                             16200002
         OI    DCMTIMES,DCMOPTTI   ELSE, TURN ON OPT TO TI BIT          16350002
         TM    DCMR2FLG,DCMRXSFL   Q. IS SCREEN FULL                    16550002
         BNO   NOTFUL              NO, LEAVE WARNING LINE AS IS         16600002
         OI    DCMIOCM2,DCMBLWRR   INDICATE REMOVE MSG WAITING MSG      16750002
NOTFUL   EQU   *                                                        16800002
         NI    DCMOPTST,OFFOPTAD   DEL BIT OFF                          16850002
         OI    DCMTIMES,DCMOTTMM   OPT OR TI SHOULD EXIT TO MM          16900002
         OI    DCMCMSG3,DCMCMRLL   ROLL MODE MSG BIT                    16950002
         CLI   VI(OPR3),CHARD      HAS D BEEN SPECIFIED                 17000002
         BNE   MDEL                IF NOT, MOVE IN CHAR                 17050002
         MVC   DCMDEL(II),V(OPR3)       IF SO, DO MORE HERE             17100002
         LA    OPR3,VII(OPR3)      UPDATE PTR                           17150002
         B     NEXT                AND GO BACK                          17200002
OSEG     EQU   *                                                        17400002
         LA    OPR3,V(OPR3)        POINT TO VALUE                       17450002
         BALR  RE,RF               TO HANDLE VALUE                      17500002
         CH    R6,DCMMSGAL         DOES VALUE EXCEED MAX                17550002
         BH    INVALOP             YES                                  17600002
         LTR   R6,R6               SEG=0                                17650002
         BZ    OFF                 IF SO, SET BIT OFF                   17700002
         OI    DCMOPTST,DCMOPTSG   ELSE, TURN BIT ON                    17750002
         B     IN                  INSERT VALUE                         17800002
OFF      NI    DCMOPTST,OFFOPTSG   TURN BIT OFF                         17850002
IN       STC   R6,DCMSEG           STORE VALUE IN                       17900002
         B     NEXT                FIND NEXT OPERAND                    17950002
ORNUM    EQU   *                                                        18000002
         LA    OPR3,VI(OPR3)       POINT TO VALUE                       18050002
         BALR  RE,RF               TO HANDLE VALUE                      18100002
         CH    R6,DCMMSGAL         DOES VALUE EXCEED MAX                18150002
         BH    INVALOP             YES                                  18200002
         LTR   R6,R6               RNUM=0                               18250002
         BZ    INVALOP             IS NOT ALLOWED, SO DEPART            18300002
         STC   R6,DCMRNUM          STORE VALUE IN                       18350002
         B     NEXT                FIND NEXT OPERAND                    18400002
ORTME    EQU   *                                                        18450002
         LA    OPR3,VI(OPR3)       POINT TO VALUE                       18500002
         BALR  RE,RF               TO HANDLE VALUE                      18550002
         LTR   R6,R6               RTME=0                               18600002
         BZ    INVALOP             IS NOT ALLOWED, SO DEPART            18650002
         STH   R6,DCMRTME          STORE VALUE IN                       18700002
         OI    DCMTIMES,DCMOPTTI   TURN ON OPT TO TI BIT                18750002
         B     NEXT                FIND NEXT OPERAND                    18800002
NUM      EQU   *                                                        18850002
         LR    R1,OPR3             POINT TO OP IN CASE IT IS INVALID    18900002
         MVC   DCMCVBIN(III),Z(OPR3)    MOVE IN UP TO THREE DIGITS      18950002
         XC    DCMPACK(IV),DCMPACK      ZERO OUT CONVERSION WORD        19000002
NDIG     EQU   *                                                        19050002
         CLI   Z(OPR3),COMMA                                            19100002
         BE    DO                  IF COMMA HERE                        19150002
         CLI   Z(OPR3),BLANK                                            19200002
         BE    DO                  IF BLANK HERE                        19250002
         CLI   Z(OPR3),HF0                                              19300002
         BL    INVALOP             IF LESS THAN 0                       19350002
         MVC   DCMPACK+I(V),DCMPACK+II       MOVE ONE DIGIT OVER        19400002
         LA    OPR3,I(OPR3)        UPDATE OP PTR                        19450002
         B     NDIG                GO BACK FOR NEXT DIGIT               19500002
DO       EQU   *                                                        19550002
         CR    OPR3,R1             Q. WAS THERE A NUMBER FOLLOWING OPER 19600002
         BE    INVALOP             NO, INVALID OPERAND                  19650002
         SR    OPR3,R1             GET NUM DIGITS IN OPR3               19700002
         CH    OPR3,HW4            IS IT LESS THAN FOUR                 19750002
         BNL   INVALOP             IF NOT, INVALID OP                   19800002
         AR    OPR3,R1             ELSE, RESTORE OPR3                   19850002
         PACK  DCMCVBIN(IV),DCMPACK(IV)      EBCDIC                     19900002
         XC    DCMPACK(IV),DCMPACK           TO                         19950002
         CVB   R6,DCMPACK                    BINARY                     20000002
         BR    RE                            RETURN                     20050002
UNDO     EQU   *                                                        20100002
         CVD   R6,DCMPACK                    BINARY                     20150002
         UNPK  DCMPACK(IV),DCMCVBIN(IV)      TO                         20200002
         OI    DCMPACK+III,HF0               EBCDIC                     20250002
         BR    RE                            RETURN                     20300002
         EJECT                                                          20350002
**********************************************************************  20400002
*                                                                       20450002
*        CONSTANTS                                                      20500002
*                                                                       20550002
**********************************************************************  20600002
         SPACE 1                                                        20650002
HW4      DC    H'4'                VALUE                                20700002
SCOMMAND DC    C'K S'              K S COMMAND                          20750002
CDEL     DC    C',DEL=  '          DEL OPERAND                          20800002
CSEG     DC    C',SEG=  '          SEG OPERAND                          20850002
CCON     DC    C',CON= '           CON OPERAND                          20900002
CRNUM    DC    C',RNUM=  '         RNUM OPERAND                         20950002
CRTME    DC    C',RTME='           RTME OPERAND                         21000002
CREF     DC    C',REF '            REF OPERAND                          21050002
         SPACE 3                                                        21200002
**********************************************************************  21250002
*                                                                       21300002
*        REGISTER EQUATE STATEMENTS                                     21350002
*                                                                       21400002
**********************************************************************  21450002
         SPACE 1                                                        21500002
R0       EQU   0                   REGISTER 0                           21560002
R1       EQU   1                   REGISTER 1                           21570002
ENTR2    EQU   2                   ADDRESS OF DCMENTRY                  21580002
OPR3     EQU   3                   OPERAND PTR REG                      21590002
RRDCM    EQU   5                   R DCM BASE REGISTER                  21590402
R6       EQU   6                   REGISTER 6                           21590802
UCMR7    EQU   7                   UCM BASE REG                         21591202
UCMPR8   EQU   8                   UCM PREFIX BASE REG                  21591602
DCMR9    EQU   9                   DCM BASE REG                         21591702
BASERA   EQU   10                  MODULE BASE REG                      21592002
CXSARB   EQU   11                  CXSA BASE REG                        21600002
UCMERC   EQU   12                  UCM ENTRY BASE REG                   21800002
RE       EQU   14                  REGISTER 14                          22150002
RF       EQU   15                  REGISTER 15                          22200002
X1PARM   EQU   1                                                        22202002
XFBRANCH EQU   15                                                       22210002
         EJECT                                                          22250002
**********************************************************************  22300002
*                                                                       22350002
*        EQUATE STATEMENTS                                              22400002
*                                                                       22450002
**********************************************************************  22500002
         SPACE 1                                                        22550002
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            22560002
ID2      EQU   C'A'                2ND CHARACTER OF CSECT ID            22570002
BLANK    EQU   X'40'               CHARACTER BLANK                      22600002
CHARD    EQU   C'D'                CHARACTER                            22650002
CHARN    EQU   C'N'                CHARACTER                            22700002
CHARR    EQU   C'R'                CHARACTER                            22750002
CHARY    EQU   C'Y'                CHARACTER                            22800002
COMMA    EQU   C','                CHARACTER                            22850002
HF0      EQU   X'F0'               FOR EBCDIC DIGIT                     22900002
Z        EQU   0                   NUMBER                               22950002
I        EQU   1                   NUMBER                               23000002
II       EQU   2                   NUMBER                               23050002
III      EQU   3                   NUMBER                               23100002
IV       EQU   4                   NUMBER                               23150002
V        EQU   5                   NUMBER                               23200002
VI       EQU   6                   NUMBER                               23250002
VII      EQU   7                   NUMBER                               23300002
VIII     EQU   8                   NUMBER                               23350002
IX       EQU   9                   NUMBER                               23400002
X        EQU   10                  NUMBER                               23450002
XV       EQU   15                  NUMBER                               23500002
XXII     EQU   22                  NUMBER                               23550002
XXIX     EQU   29                  NUMBER                         21002 23650002
XXXVII   EQU   37                  NUMBER                               23750002
XL       EQU   40                  NUMBER                         21002 23800002
CXXV     EQU   125                 NUMBER                               23900002
N255     EQU   255                 MASK TO TURN BITS OFF         S21002 23950002
         EJECT                                                          24000002
**********************************************************************  24050002
*                                                                       24100002
*        DSECTS                                                         24150002
*                                                                       24200002
**********************************************************************  24250002
         IEERDCM                                                        24300002
         EJECT                                                          24350002
         IEETDCM                                                        24360002
         EJECT                                                          24400002
         IEECUCM  FORMAT=NEW                                            24500002
         EJECT                                                          24550002
         IHACTM  CXSA                                                   24650002
*   EXTRA EQUATES FOR BIT SETTINGS                                      24700002
BLENTINS EQU   DCMBLENT+DCMINSSH   TO TURN TWO BITS ON                  24750002
OFFBLWRL EQU   255-DCMBLWRL        TO TURN BIT OFF                      24850002
OFFCMRLL EQU   255-DCMCMRLL        TO TURN BIT OFF                      24900002
OFFOPRLL EQU   255-DCMOPRLL        TO TURN BIT OFF                      24950002
OFFOPTAD EQU   255-DCMOPTAD        TO TURN BIT OFF                      25000002
OFFOPTSG EQU   255-DCMOPTSG        TO TURN BIT OFF                      25050002
OFFOPTVR EQU   255-DCMOPTVR        TO TURN BIT OFF                      25100002
OFFOTTMM EQU   255-DCMOTTMM        TO TURN BIT OFF                      25150002
WRININSC EQU   DCMWRINS+DCMINSC    TO TURN TWO BITS ON                  25200002
         EJECT                                                          25250002
         END                                                            25400002
./  ADD  SSI=81250529,NAME=IEECVETC
IEECVETC CSECT                                                          00100000
*A185600,185700,191700,191600,191800,197100-197420,210020     MH Y02173 00200000
*C140500,184000,185500                                        MH Y02173 00300000
*D183000,181000,181500,180500,182000,182500                   MH Y02173 00400000
*A107100-107500                                              MC SA52527 00500000
*A 195100-195520                                              JE YM6718 00600000
         TITLE 'IEECVETC          ASYNCHRONOUS ERROR'                   00700000
*********************************************************************** 00800000
*                                                                     * 00900000
* STATUS CHANGE LEVEL=0                                               * 01000000
*                                                                     * 01300000
* APARS FIXED  OZ14126                                                * 01600000
*                                                                     * 01601000
* FUNCTION     THIS ROUTINE INITIALIZES THE DCM ON A RE-OPEN CONDITION* 01602000
*              HANDLES ASYNCHRONOUS ERRORS, AND PERFORMS CONSOLE      * 01603000
*              SWITCHING AFTER A PERMANENT SYNCHRONOUS ERROR.         * 01604000
*              FOR AN ASYNCHRONOUS ERROR THE SENSE FIELD IN THE UCB   * 01605000
*                 IS TESTED. EQUIPMENT CHECKS HAVE NO LIMIT ON THE    * 01606000
*                 NUMBER OF RETRIES TO BE PERFORMED. OTHER ERRORS     * 01700000
*                 WILL BE RETRIED ONCE. WHEN AN ASYNCHRONOUS ERROR    * 01800000
*                 OCCURS INDICATORS  WILL BE SET TO BLANK THE SCREEN  * 01900000
*                 AND TO DISPLAY AN APPROPRIATE ERROR MESSAGE.        * 02000000
*              IF THE TIMER IS WORKING, AN EXIT WILL BE MADE TO TIMER/* 02100000
*                 INTERPRETER ROUTINE TO SET THE TIMER FOR 30 SECONDS * 02200000
*                 WHEN THE TIMER ELAPSES(IF NO INTERVENING CANCEL HAS * 02300000
*                 BEEN PERFORMED), A CANCEL WILL BE PERFORMED, REMOV- * 02400000
*                 ING THE ASSYNCHRONOUS ERROR MESSAGE.  CONTROL WILL  * 02500000
*                 BE RETURNED TO THE ASSYNCHRONOUS ERROR ROUTINE      * 02600000
*                 TO RESTORE THE FIELDS TO ORIGINAL STATUS BEFORE     * 02700000
*                 ASSYNCHRONOUS ERROR OCCURRED.                       * 02800000
*                                                                     * 02900000
*ENTRY POINT   IEECVETC                                               * 03000000
*                                                                     * 03100000
*INPUT         REGISTER 1 POINTS TO CXSA                              * 03200000
*                                                                     * 03300000
*OUTPUT        NONE                                                   * 03400000
*                                                                     * 03500000
*EXTERNAL REFERENCES  NONE                                            * 03600000
*                                                                     * 03700000
*EXITS - NORMAL  IEECVETH OR P OR R DEVICE DEPENDENT IO               * 03800000
*                IEAVSWCH CONSOLE SWITCH ROUTINE                      * 03900000
*                IEECVFTG CLEAN UP ROUTINE FOR DIDOCS                 * 04000000
*       - ERROR  IEECVETD MESSAGE MODULE 1                            * 04100000
*                IEECVETK TIMER/INTERPRETER ROUTINE                   * 04200000
*                                                                     * 04300000
*TABLES/WORK AREAS DISPLAY CONTROL MODULE (DCM)                       * 04400000
*                   SCREEN AREA CONTROL BLOCK TABLE (SACB)            * 04500000
*                                                                     * 04600000
*ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                     * 04700000
*                                                                     * 04800000
*NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A     * 04900000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL     * 05000000
*              CHARACTER SET.                                         * 05100000
*                                                                     * 05200000
********************************************************************* * 05300000
         EJECT                                                          11700000
***                                                                     11800000
***      REGISTERS                                                      11900000
***                                                                     12000000
XF       EQU   15                  WORK REG                             12100000
X1PARM   EQU   1                                                        12200000
XFBRANCH EQU   15                                                       12300000
XERTRN   EQU   14                  WORK REG                             12400000
XD       EQU   13                  WORK REG                             12500000
XC       EQU   12                  PROGRAM BASE REG                     12600000
XB       EQU   11                  CXSA BASE REG                        12700000
XA       EQU   10                  UCMENTRY BASE REG                    12800000
X9       EQU   9                   DCM TRANSIENT BASE REG        S21002 12900000
X8       EQU   8                   UCM BASE REG                         13000000
X7       EQU   7                   WORK REG                             13100000
X6       EQU   6                   WORK REG                             13200000
X5       EQU   5                   WORK REG                             13300000
X4       EQU   4                   DCM RESIDENT BASE REG         S21002 13400000
X3       EQU   3                   WORK REG                             13500000
X2       EQU   2                   WORK REG                             13600000
X1       EQU   1                   WORK REG                             13700000
X0       EQU   0                   WORK REG                             13800000
         EJECT                                                          13900000
         BALR  XC,N0               ESTABLISH BASE REGISTER              14000000
         USING *,XC                ESTABISH ADDRESSIBILITY              14100000
         B     BEGIN               BRANCH AROUND PATCH AREA             14200000
ICATCH   DC    C'IEECVETC'         EYECATCHER AND FIELD MAINTENANCE     14300000
         DC    CL8'&SYSDATE',CL56' '                                    14400000
BEGIN    EQU   *                                                        14500000
         LR    XB,X1                                                    14600000
         USING CXSA,XB              ESTABLISH CXSA BASE REG             14700000
         L     XA,CSAUCM                                                14800000
         USING UCMLIST,XA                                               14900000
         L     X4,UCMXB            ADDRESS OF RESIDENT DCM        21002 15000000
         USING DCMTSRT,X4          ADDRESSIBILITY OF RESIDENT DCM       15100000
         L     X9,DCMADTRN         ADDRESS OF TRANSIENT DCM      S21002 15200000
         USING DCMSTRT,X9                                               15300000
         L     X8,CSACTLM          GET UCM POINTER                      15400000
         USING UCM,X8              DECLARE UCM BASE                     15500000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      15600000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    15700000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      15800000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           15900000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         16000000
***                                                                     16100000
***   DETERMINE REASON FOR ENTRY                                        16200000
***                                                                     16300000
         TM    DCMCOM2,DCMAE       IS THIS ENTRY FROM CLEAN UP RTS21002 16400000
         BO    CLEANEN             BRANCH YES                           16500000
         TM    DCMCS,DCMCSO        Q. REOPEN REQUEST                    16600000
         BNO   ERROR               NO, THEN MUST BE ERROR               16700000
REOPEN   EQU   *                   YES,INIT DCM AND REWRITE SCREEN      16800000
         CLI   DCMIONDX,NDX2250        DEVICE A 2250                    16900000
         BNE   NOCHANGE                NO A CONTINUR                    17000000
         L     X7,UCMUCB               YES GET UCB                      17100000
         TM    N16(X7),MOD3            IS 2250 A MOD 3                  17200000
         BNO   NOCHANGE            NO-SKIP BUFFER UPDATE                17300000
         L     X6,N36(X7)              POINT TO BUFFER TABLE            17400000
         LA    X6,N0(X6)           CLEAR HI ORDER BYTE                  17500000
         LTR   X6,X6                   VALID ADDRESS                    17600000
         BZ    NOCHANGE            NO-SKIP UPDATE                       17700000
         SR    X5,X5                   CLEAR REG                        17800000
         IC    X5,N36(X7)              GET ID                           17900000
         MH    X5,EIGHT                EIGHT                            18000000
         AR    X5,X6                   GET DISPLACEMENY                 18100000
         LH    X7,N2(X5)               GET BUFFER DISPLACEMENT          18200000
         SH    X7,FORTY                CORRECT GARBAGE                  18300000
         MH    X7,T256                 GET ACTUAL BEGINNING OF BUFER    18400000
         L     X5,DCMBUFAD         POINT TO START OF BUF AD TAB         18500000
         LA    X2,N6               LOOP CONTROL REG              S21002 18600000
         LH    X1,N0(X5)           GET INITIAL VALUE FROM TABLE  S21002 18700000
LOOP4    EQU   *                                                 S21002 18800000
         LH    X6,N0(X5)           LOAD BUFFER ADDRESS           S21002 18900000
         SR    X6,X1               SUBT INITIAL VALUE FROM EACH  S21002 19000000
         AR    X6,X7               GET NEXT ADDRESS              S21002 19100000
         STH   X6,N0(X5)           UPDATE NEXT ADDRESS           S21002 19200000
         LA    X5,N2(X5)           INCREMENT ADDRESS BY TWO      S21002 19300000
         BCT   X2,LOOP4            BRANCH IF NOT ZERO            S21002 19400000
         L     X6,DCMAWARN POINT TO WARNING LINE                        19500000
         STH   X7,N76(X6)              UPDATE GTRU                      19600000
***                                                                     19700000
***   THIS  ROUTINE WILL REINIT THE DCM                                 19800000
***                                                                     19900000
NOCHANGE EQU   *                                                        20000000
         MVI   DCMINPUT,BLANK      BLANK INPUT AREA SO IT CAN BE USED   20100000
         MVC   DCMINPUT+N1(N125),DCMINPUT    TO BLANK SCREEN IMAGE BUFR 20200000
         LH    X6,DCMCORLN         GET LENGTH OF ONE LINE     MB  M2070 20300000
         LH    X5,DCMLGNTH         PUT LENGTH FOR MOVE IN REG MB  M2070 20400000
         BCTR  X5,N0                AND DECREMENT BY ONE                20500000
         L     X2,DCMASCRN         GET ADDR 1ST LINE IN SCREEN IMAG BUF 20600000
         LH    X7,DCMMSGAL         NUMBER OF MESSAGE AREA LINES         20700000
         MH    X7,DCMCORLN         TIMES WIDTH OF EACH LINE             20800000
         AR    X7,X2               PLUS START ADDRESS OF MSGS           20900000
         ST    X7,DCMWTBUF         SET END ADDRESS FOR MSG AREA         21000000
         ST X7,DCMWTINT            SAVE WTBUF INITIAL VALUE             21100000
         SR    X7,X6               DECREMENT BY ONE LINE      MB  M2070 21200000
LOOP     EQU   *                                                        21300000
         EX    X5,BLANKLNE         EXECUTE INTO MOVE INSTRUC            21400000
         BXLE  X2,X6,LOOP          LOOP UNTIL BUFFER IS BLANK           21500000
***                                                                     21600000
***      BLANK DELETE REQUEST BUFFER                                    21700000
***                                                                     21800000
         MVC   DCMRQDEL(N8),DCMINPUT                                    21900000
***                                                                     22000000
***      INITIALIZE OPTIONS                                             22100000
***                                                                     22200000
         MVI   DCMDEL,CHARY        SET DEL EQUAL TO YES          S21002 22300000
         MVI   DCMDEL+N1,BLANK     SET TRAILING BLANK            S21002 22400000
         MVC   DCMSEG(N1),DCMSEGDF SET SEG EQUAL TO DEFAULT VALUE       22500000
         MVI   DCMCON,CHARY        SET CON EQUAL TO YES                 22600000
         MVI   DCMOPTST,CHARE0     BITS INDICATING STATUS               22700000
         TM    DCMR3FLG,DCMKVIP    IS THIS A K V CDR PROCESSING  S21002 22800000
         BO    ZEROSCT1            BRANCH YES DON'T INIT OPITION S21002 22900000
         MVC   DCMRNUM(N3),DCMRNUMD  INITIALIZE OPTIONS          S21002 23000000
ZEROSCT1 EQU   *                                                 S21002 23100000
         SR    X2,X2               CLEAR REGISTER            MC SA52527 23200000
         IC    X2,DCMRNUM          GET CURRENT ROLL NUMB     MC SA52527 23300000
         CH    X2,DCMMSGAL         LARGER THAN SCREEN        MC SA52527 23400000
         BNH   OFFKV               NO, CONTINUE              MC SA52527 23500000
         LH    X2,DCMMSGAL         YES, CHANGE ROLL NUMB     MC SA52527 23600000
         STC   X2,DCMRNUM          TO MAX SCREEN SIZE        MC SA52527 23700000
OFFKV    NI    DCMR3FLG,N255-DCMKVIP TURN OFF K V FLAG       MC SA52527 23800000
***                                                                     23900000
***      ZERO SCREEN CONTROL TABLE ENTRIES                              24000000
***                                                                     24100000
         SR    X5,X5               ZERO MOVE-FROM LENGTH      MB YM4086 24200000
         L     X2,DCMDOMPK         START OF CONTROL TABLES    MB YM4086 24300000
         LH    X3,DCMLEN           TOTAL DCM LENGTH           MB YM4086 24400000
         AR    X3,X9               END OF DCM                 MB YM4086 24500000
         SR    X3,X2               LENGTH OF CONTROL TABLES   MB YM4086 24600000
         MVCL  X2,X4               USE UCM AS DUMMY ADDRESS   MB YM4086 24700000
         LH    X7,DCMMSGAL         NUMBER OF SCT ENTRIES      MB YM4086 24800000
         MH    X7,DCMSCTCN         TIMES SIZE OF EACH         MB YM4086 24900000
         A     X7,DCMAMTAB         START ADDRESS PLUS LENGTH  MB YM4086 25000000
         MVI   N0(X7),DCMMSGST     PUT STOPPER AFTER SCT TABLE          25100000
         SH    X7,DCMSCTCN         BACK UP TO LAST TABLE ENTRY          25200000
         ST    X7,DCMADDRL         SAVE LAST SCT ENTRY POINTER          25300000
         LH    X7,DCMMSGAL         NUMBER OF ENTRIES                    25400000
         A     X7,DCMADSEC         POINT PAST LAST SSCT ENTRY           25500000
         MVI   N0(X7),DCMSECST     SET STOPPER AFTER LAST               25600000
***      ZERO  COMMUNICATIONS BYTES                                     25700000
***                                                                     25800000
         MVI   DCMDSTAT,N0         ZERO SCREEN STATUS BYTE              25900000
         NI    DCMIOUNQ,N255-DCMIO226-DCMRPCUR-DCMFRSCN-DCMRDARM        26000000
         NI    UCMDEVC,N255-UCMDEVA   TURN OFF SCREEN         MG  M2504 26100000
         NI    DCMR2FLG,N255-DCMRXSFL   FULL FLAGS IN DCMS    MG  M2504 26200000
         XC    DCMIOCM1(N14),DCMIOCM1   ZERO OTHER COMMUNICATIONS BYTES 26300000
***                                                                     26400000
***      REINITIALIZE INSTRUC LINE                                      26500000
***                                                                     26600000
REINIT   EQU   *                                                        26700000
         OI    DCMIOCM2,DCMINSSH   SET BIT- INITIALIZE INSTRUC LINE     26800000
         L     X1,DCMADPFK         GET POINTER TO PFK LIST       S21003 26900000
         LTR   X1,X1               SEE IF TO LIGHT ANY PFKS      S21003 27000000
         BZ    SKIP                BRANCH NO-GO CONTINUE         S21003 27100000
         OI    DCMIOCM3,DCMLTPFK   YES-INDICATE SO FOR I/O ROUT  S21003 27200000
***                                                                     27300000
***      TURN  ON BITS TO INDICATE WHAT SHOULD BE WRITTEN BY I/O RTN    27400000
***                                                                     27500000
SKIP     EQU   *                                                 S21003 27600000
         XC    DCMIRCTR(N2),DCMIRCTR CLEAR INT REQ COUNT         A36163 27700000
         OI    DCMIOCM3,DCMOPRMI   INDICATE PERFORM RMI, INSURE KB      27800000
*                                  KEYBOARD IS UNLOCKED                 27900000
         NI    DCMCS,N255-DCMCSO   TURN OFF REOPEN BIT                  28000000
         MVI   DCMCULNO,N1         SET UP CURSOR POSITION- LINE 1 OF    28100000
         MVI   DCMPOSCU,N1          ENTRY AREA, POSITION ZERO           28200000
***                                                                     28300000
***      SET BITS TO INDICATE WRITE ENTIRE SCREEN AND INSERT CURSOR     28400000
***                                                                     28500000
NONIP    EQU   *                                                        28600000
         OI    DCMIOCM1,WRITEALL   INDICATE PERFRM WRITES OF SCREEN     28700000
         OI    DCMIOCM2,DCMBLENT+DCMBLWRL+DCMBLWRR BLANK ENTRY AREA     28800000
IOEXIT   EQU   *                                                        28900000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              29000000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 29100000
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         29200000
ERROR    EQU   *                                                        29300000
         TM    DCMTIMES,DCMTASYN   Q. RETURN AFTER ASYNC ERROR          29400000
         BO    TURNOFF             YES, GO INITIALIZE SWITCHED          29500000
         TM    UCMSTS,UCMAF        ATTENTION PENDING           @ZA14126 29530000
         BO    LABEL1              YES, BYPASS ECB ERROR CHECK @ZA14126 29560000
LABEL    TM    UCMECB,ERRINC       Q. A PERMANENT SYNCHRONOUS ERROR     29600000
         BO    PERMSYNC            YES, GO SWITCH CONSOLES              29700000
LABEL1   L     X3,UCMUCB           NO, GET POINTER TO UCB      @ZA14126 29800000
         USING UCBOB,X3            UCB ADDRESSABILITY         MB YM5671 29900000
         NI    UCMSTS,N255-UCMAF   TURN OFF ATTENTION FLAG              30000000
***                                                                     30100000
***   TEST FOR TYPE OF ASYNCHRONOUS ERROR                               30200000
***                                                                     30300000
         TM    UCMDISP,UCMDISPD    IS CONSOLE OUTPUT ONLY     MH  M2095 30400000
         BO    PERMSYNC             YES, DON'T RETRY          MH  M2095 30500000
         TM    UCBSNS,DCHK         A DATA CHECK               MB YM5671 30600000
         BO    ERRDATA             YES                                  30700000
         TM    UCBSNS,ECHK         EQUIP CHECK OR COMBINATION MB YM5671 30800000
         BO    CONDERR                OF EQUIP CHK AND INVAL BUF ADDR)  30900000
         TM    UCBSNS,INBUFADR     INVALID BUFFER ADDR CHECK  MB YM5671 31000000
         BO    ERRINVB             YES                                  31100000
         TM    UCBSNS,BUFADRPT     BUFFER ADDR PARITY CHECK   MB YM5671 31200000
         BNO   PERMSYNC            NO, GO SWITCH CONSOLES               31300000
ERRBAPC  EQU   *                                                        31400000
         TM    DCMASYNC,DCMASBA    Q. IS THIS 2ND BUFFER ADR PAR CHK    31500000
         BO    PERMSYNC            YES, PERMANENT ERROR        @ZA14126 31600000
         OI    DCMASYNC,DCMASBA    NO, TURN OF RETRY INDICATOR          31700000
RETWRIT  EQU   *                                                        31800000
         OI    DCMIOCM2,DCMERASE+DCMWRASY  PERFORM ERASE AND WRITE MSG  31900000
         OI    DCMR3FLG,DCMRXSCN   INDICATE AN ASYNC ERROR HAS OCCURRED 32000000
         OI    DCMCMSG2,DCMASYRT   INCIDATE MOVE IN ASYNC ERROR MSG     32100000
MSG2EXIT EQU   *                                                        32200000
         MVI   UCBSNS,N0           ZERO SENSE INFO IN IOB     MB YM5671 32300000
*********************** DELETE 1 LINE OF CODE **************** @ZA14126 32400000
         OI    UCMDEVC,UCMDEVA       INDICATE SCREEN FULL SO THAT ENTRY 32500000
         OI    DCMR2FLG,DCMRXSFL   SCREEN FULL IN RDCM        ME S21003 32600000
         OI    DCMDSTAT,DCMDSAUT+DCMDSINR  WILL NOT BE MADE             32700000
         OI    DCMR2FLG,DCMRXSFL     FOR DISPLAYING MESSAGES WHILE      32800000
*                                    ASYNC ERROR MSG ON SCREEN          32900000
         OI    DCMTIMES,DCMOTTMM+DCMOPTTI+DCMTASYN  INDICATE CHECK FOR  33000000
*                                  CHANGE IN TIMER INTERVAL AND EXIT    33100000
*                                  TO MESSAGE MODULE 2                  33200000
         OI    DCMCOM2,DCMAE       SET IND FOR CLEAN UP RTN      S21002 33300000
         L     XFBRANCH,DCMNCLN    LOAD CLEANUP ADDRESS                 33400000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 33500000
         BR    XFBRANCH            EXIT TO IEECVFTG                     33600000
***                                                                     33700000
***    CONTINUATION AFTER EXIT AND RETURN FROM CLEAN UP ROUTINE  S21002 33800000
***                                                                     33900000
CLEANEN  EQU   *                                                        34000000
         NI    DCMCOM2,N255-DCMAE  TURN OFF CLEAN UP IND         S21002 34100000
         MVC   DCMDSAV+N15(N2),DCMDEL   SAVE STATUS OF OPTIONS          34200000
         MVC   DCMDSAV+N17(N2),DCMRTME                                  34300000
         MVC   DCMDSAV+N19(N1),DCMOPTST                                 34400000
***                                                              S21002 34500000
***      ZERO SECONDARY SCREEN CONTROL TABLE ENTRIES             S21002 34600000
***                                                              S21002 34700000
         L     X3,DCMADSEC         GET ADDR OF FIRST SSCT ENTRY  S21002 34800000
         LH    X2,DCMMSGAL         GET NUMBER OF MESSAGES               34900000
SSCLOOP  EQU   *                                                        35000000
         MVI   N0(X3),N0           ZERO SSCT ENTRY               S21002 35100000
         LA    X3,N1(X3)           INCREMENT TO NEXT SSCT ENTRY  S21002 35200000
         BCT   X2,SSCLOOP          LOOP UNTIL, DOM IDS ARE BLANK        35300000
***                                                                     35400000
***      ZERO  COMMUNICATIONS BYTES                                     35500000
***                                                                     35600000
TIMCONT  EQU   *                                                 S21002 35700000
         MVI   DCMDEL,CHARR        SET DEL EQUAL TO ROLL MODE    S21002 35800000
         MVI   DCMDEL+N1,BLANK     SET TRAILING BLANK            S21002 35900000
         OI    DCMOPTST,DCMOPRLL   BE SET                               36000000
         MVC   DCMRTME(N2),H30     SET INTERVAL TO 30 SCEONDS           36100000
TIMEXIT  EQU   *                                                        36200000
         L     XFBRANCH,DCMNTIMR   LOAD TIMER INTERPRETER ADDRESS       36300000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 36400000
         BR    XFBRANCH            EXIT TO IEECVETK                     36500000
ERRINVB  EQU   *                                                        36600000
         TM    DCMASYNC,DCMASIN    Q. HAS THIS ERROR BEEN RETRIED       36700000
         BO    PERMSYNC            YES, PERMANENT ERROR        @ZA14126 36800000
         OI    DCMASYNC,DCMASIN    NO, INDICATE ERROR RETRY             36900000
         B     RETWRIT             GO WRITE ERROR MSG TO SCREEN         37000000
CONDERR  EQU   *                                                        37100000
         OI    DCMIOCM2,DCMERASE+DCMWRASY  PERFORM ERASE AND WRITE MSG  37200000
         OI    DCMR3FLG,DCMRXSCN   INDICATE ASYNC ERROR ON SCREEN       37300000
         OI    DCMCMSG2,DCMASYCD   INDICATE MOVE IN COND ASYNC ERROR MG 37400000
         B     MSG2EXIT            EXIT                                 37500000
ERRDATA  EQU   *                                                        37600000
         CLI   DCMIONDX,NDX2250         Q. IS DEVICE A 2250    @ZA14126 37700000
         BNO   DATAERR                  NO                              37800000
         CLC   UCBSNS+N2,DCMDSAV+N8 ERROR AT SAME BYTE AS FOR MB YM5671 37900000
*                                       PREVIOUS ENTRY                  38000000
         BNE   SAVEADDR                 NO, RETRY                       38100000
DATAERR  TM    DCMASYNC,DCMASDA    Q. HAS THIS ERROR BEEN RETRIED ONCE  38200000
         BZ    SETFLAG            NO, SET ERROR RETRY         MH Y02173 38300000
         B     PERMSYNC           YES, PERM ERROR,SWITCH CNSLS @ZA14126 38350000
*********************************************************************** 38800000
**************** FOUR  LINES OF CODE DELETED HERE ************ @ZA14126 38900000
*********************************************************************** 39500000
SAVEADDR MVC   DCMDSAV+N8(N2),UCBSNS+N2 SAVE BUFFER ADDRESS   MB YM5671 39600000
SETFLAG  OI    DCMASYNC,DCMASDA    NO, INDICATE ERROR RETRY   MH Y02173 39700000
         B     RETWRIT             GO WRITE ERROR MSG TO SCRN MH Y02173 39800000
PERMSYNC EQU   *              PERFORM CONSOLE SWITCH                    39900000
         OI    DCMR3FLG,DCMCLPR    INDICATE CLOSE IN PROGRESS MF  M0736 40000000
         OI    DCMCOM2,DCMERPF     INDICATE ERASE PERFORMED   MF  M0736 40100000
*                                  SO PROCESSOR WILL NOT TRY  MF  M0736 40200000
*                                  TO DO I/O TO A DEVICE WITH MF  M0736 40300000
*                                  AN I/O ERROR               MF  M0736 40400000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCKS SUBROUTINE  YM6335 40500000
         LR    X1,XB               SET INPUT PARM             MB YM6335 40600000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS              MB YM6335 40700000
         NI    DCMMCSST,N255-DCMDUSE DIDOCS NO LONGER IN CONTROL        40800000
         MVI   UCMECB,N0           ZERO ECB                             40900000
         ICM   X5,15,CSANPTR       PTR TO RECOVERY AREA       JE YM6718 41000000
         BZ    NOESTAE             NOT THERE, BYPASS NSI      JE YM6718 41100000
         MVC   PARMRTAD-PARMLIST(8,X5),CSANAME RESTORE RETRY & REGSAV   41200000
*                                                             JE YM6718 41300000
NOESTAE  DS    0H                                             JE YM6718 41400000
         MVI   CSACODE,CSASWTCH    INDICATE CONSOLE SWITCH    JE YM6718 41500000
         MVC   CSANAME(8),CONSWTCH MODULE NAME                JE YM6718 41600000
         L     XERTRN,CSAXA        RESET RETURN REG           MB YM6335 41700000
         L     XFBRANCH,UCMSWCH    ADDRESS CONSOLE SWITCH ROUTINE       41800000
         L     X1PARM,DCMCXSVE     ADDRESS CXSA IN REG 1                41900000
         BR    XFBRANCH            EXIT TO CONSOLE SWITCH               42000000
TURNOFF  EQU   *                                                        42100000
         L     X3,UCMUCB           LOAD UCB ADDRESS           MH Y02173 42200000
         TM    UCBSNS,ASYERR       ANY BAD SENSE DATA         MB YM5671 42300000
         BNZ   LABEL                YES, MAY BE PERM          MH Y02173 42400000
         NI    DCMASYNC,X'FF'-DCMASDA-DCMASIN-DCMASBA         MH Y02173 42500000
*              TURN OFF ALL RETRY FLAGS                       MH Y02173 42600000
         NI    DCMR2FLG,N255-DCMRXSFL   TURN OFF                        42700000
         NI    UCMDEVC,N255-UCMDEVA      SCREEN FULL BITS               42800000
         NI    DCMR2FLG,N255-DCMRXSFL SCREEN FULL IN R DCM    ME S21003 42900000
         NI    DCMTIMES,N255-DCMTASYN    TURN OFF BIT                   43000000
         NI    DCMR2FLG,N255-DCMRXRLL-DCMRXTMR    TURN OFF BITS         43100000
         NI    DCMR3FLG,N255-DCMRXSCN  TURN OFF ASYNC CANCEL BIT        43200000
         MVC   DCMDEL(N2),DCMDSAV+N15  INITIALIZE OPTIONS TO            43300000
         MVC   DCMRTME(N2),DCMDSAV+N17   WHAT THEY HAD BEEN BEFORE THE  43400000
         MVC   DCMOPTST(N1),DCMDSAV+N19   ASYNCHRONOUS ERROR OCCURRED   43500000
         OI    DCMTIMES,DCMOPTTI                                        43600000
         B     TIMEXIT             EXIT TO TIMER/INTERPRETER RTN        43700000
ZEROSCT  XC    N0(N0,X2),N0(X2)    ZERO TABLE ENTRY OF SCT       S21002 43800000
BLANKLNE MVC   N0(N0,X2),DCMINPUT  INSTRUC TO BLANK LINES               43900000
         EJECT                                                          44000000
CONSWRTN DC    C'XL'               NAME OF CONSOLE SWITCH RTN    S21002 44100000
T256     DC    H'256'              NUMBER CONSTANT                      44200000
FORTY    DC    H'40'               NUMBER CONSTANT                      44300000
EIGHT    DC    H'8'                NUMBER EIGHT                         44400000
H30      DC    H'30'               CONSTANT F  THIRTY                   44500000
CONSWTCH DC    CL8'IGC0407B'       NAME OF CONSOLE SWITCH     JE YM6718 44600000
         EJECT                                                          44700000
***                                                                     44800000
***      EQUATES                                                        44900000
***                                                                     45000000
ASYERR   EQU   X'1B'               BAD SENSE DATA             MH Y02173 45100000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            45200000
ID2      EQU   C'C'                2ND CHARACTER OF CSECT ID            45300000
BLANK    EQU   C' '                BLANK CHARACTER                      45400000
UCBINTER EQU   X'10'               UCB INTERCEPT FLAG                   45500000
NDX2250  EQU   X'08'               DCM I/O ROUTINE INDEX FOR 2250       45600000
ERRINC   EQU   X'40'               ERROR CONDITION                      45700000
INBUFADR EQU   X'02'               INVALID BUFFER ADDRESS               45800000
BUFADRPT EQU   X'01'               BUFFER ADDRESS PARITY CHECK          45900000
IOBCSW   EQU   8                   EQUATE                               46000000
CSWUCK   EQU   X'02'               EQUATE                               46100000
DOMLEN   EQU   8                   DOM ENTRY LENGTH                     46200000
N0       EQU   0         NUMBER                                         46300000
N1       EQU   1         NUMBER                                         46400000
N2       EQU   2         NUMBER                                         46500000
N3       EQU   3         NUMBER                                         46600000
N4       EQU   4         NUMBER                                         46700000
N6       EQU   6         NUMBER                                         46800000
N8       EQU   8         NUMBER                                         46900000
N14      EQU   14                  NUMBER CONSTANT                      47000000
N17      EQU   17                  NUMBER CONSTANT                      47100000
N22      EQU   22                  NUMBER CONSTANT                      47200000
N24      EQU   24                  NUMBER CONSTANT                      47300000
N125     EQU   125                 NUMBER CONSTANT                      47400000
N255     EQU   255                 BYTE SIZE                            47500000
CHARY    EQU   C'Y'                CHARACTER Y                          47600000
CHARE0   EQU   X'E0'               HEX E0                               47700000
ECHK     EQU   X'10'               EQUIPMENT CHECK                      47800000
DCHK     EQU   X'08'               DATA CHECK                           47900000
MOD3     EQU   X'33'               MOD 3 CODE                           48000000
N15      EQU   15                  NUMBER CONSTANT                      48100000
N16      EQU   16                  NUMBER CONSTANT                      48200000
N19      EQU   19                  NUMBER CONSTANT                      48300000
N36      EQU   36                  NUMBER CONSTANT                      48400000
N76      EQU   76                  NUMBER CONSTANT                      48500000
WRITEALL EQU   X'77'               INDICATE TO WRITE FULL SCREEN        48600000
CHARR    EQU   C'R'                CHARACTER R FOR ROLL          S21002 48700000
         EJECT                                                          48800000
         IHACTM FTPT                                          JE YM6718 48900000
         EJECT                                                          49000000
         IEERDCM                                                        49100000
         EJECT                                                          49200000
         IEETDCM                                                        49300000
         EJECT                                                          49400000
         IEECUCM  FORMAT=NEW                                            49500000
         EJECT                                                          49600000
         IHACTM  CXSA                                                   49700000
         EJECT                                                          49800000
ETCUCB   DSECT                                                          49900000
         IEFUCBOB                                                       50000000
         END                                                            50100000
./  ADD  SSI=32960718,NAME=IEECVETD
         TITLE 'IEECVETD MESSAGE 1'                                     00050002
IEECVETD CSECT                                                          00100002
* C 84500-85800                                              MC SA52530 00150002
*/*IEECVETD: CHART */                                                   01350002
*/*HEADER                                                               01400002
*/*      CHART 5D IEECVETD - MESSAGE MOD 1 */                           01450002
         EJECT                                                          01500002
*********************************************************************** 01550002
*                                                                       01600002
* STATUS       CHANGE LEVEL 0                                           01650002
*                                                                       01700002
* FUNCTION     TO PLACE ERROR MESSAGES OR INFORMATIONAL MESSAGES        01750002
*              INTO THE WARNING LINE OR THE INSTRUCTION LINE.           01800002
*    IF IT IS AN OUTPUT ONLY CONSOLE, TO PLACE THE MESSAGE IN    S21003 01850002
*    THE WARNING LINE.                                           S21003 01900002
*                                                                       01950002
* ENTRY POINT  IEECVETD                                                 02000002
*                                                                       02050002
* INPUT        BIT SETTINGS IN DCMCMSG1 OR DCMCMSG2 TO INDICATE WHICH   02100002
*              MESSAGE MUST BE MOVED INTO THE DCM.                      02150002
*                                                                       02200002
* OUTPUT       INDICATIONS TO THE I/O RTN OF WHAT TO WRITE.             02250002
*                                                                       02300002
* EXTERNAL REFERENCES NONE                                              02350002
*                                                                       02400002
* EXITS - NORMAL IEECVETH OR P OR R DEVICE-DEPENDENT IO                 02450002
*        IEECVET1 - PROCESSOR 1 - IF IN HOLD MODE                       02500002
*        IEECVET3 - DISPLAY 2 - IF IN ROLL MODE AND UNV. MSG NEEDED     02550002
*       - ERROR  NONE                                                   02600002
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         02650002
*                                                                       02700002
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      02750002
*                                                                       02800002
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      02850002
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       02900002
*              CHARACTER SET.                                           02950002
*********************************************************************** 03000002
         EJECT                                                          03050002
*********************************************************************** 03100002
*                                                                       03150002
*  REGISTER EQUATES                                                     03200002
*                                                                       03250002
XO       EQU   0         REGISTER 0                                     03300002
X1       EQU   1         REGISTER 1                                     03350002
X2       EQU   2         REGISTER 2                                     03400002
X3       EQU   3         REGISTER 3                                     03450002
XWORK1   EQU   4         WORK REGISTER                                  03500002
XWORK    EQU   5         WORK REG                                       03550002
X6       EQU   6         REGISTER 6                                     03600002
X7       EQU   7         UCM BASE REG                                   03650002
X8       EQU   8         REGISTER 8                                     03700002
X9       EQU   9         DCM BASE REG                                   03750002
XA       EQU   10        PROGRAM BASE REG                               03800002
XB       EQU   11        CXSA BASE REG                                  03850002
XC       EQU   12        UCM ENTRY BASE REG                             03900002
XD       EQU   13        USED TO SAVE REGISTER 14                       03950002
XE       EQU   14        REGISTER 14                                    04000002
XF       EQU   15        REGISTER 15                                    04050002
RRDCM    EQU   15        R DCM BASE REGISTER                            04100002
X1PARM   EQU   1                                                        04100402
X8UCME   EQU   8                                                        04102002
XFBRANCH EQU   15                                                       04110002
*********************************************************************** 04150002
         EJECT                                                          04200002
*********************************************************************** 04250002
*                                                                       04300002
*        EQUATES                                                        04350002
*                                                                       04400002
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            04410002
ID2      EQU   C'D'                2ND CHARACTER OF CSECT ID            04420002
CHARY    EQU   C'Y'                CHARACTER Y                          04450002
N0       EQU   0                   NUMBER                               04500002
N1       EQU   1                   NUMBER                               04550002
N2       EQU   2                   NUMBER                               04600002
N4       EQU   4                   NUMBER                               04700002
N6       EQU   6                   NUMBER                               04800002
N13      EQU   13                  NUMBER                               05000002
N14      EQU   14                  NUMBER                               05050002
N22      EQU   22                  FIELD INCREMENT               S21002 05100002
N26      EQU   26                  NUMBER                               05150002
N27      EQU   27                  NUMBER                               05200002
N31      EQU   31                  NUMBER                               05250002
N32      EQU   32                  NUMBER                               05300002
N33      EQU   33                  NUMBER                               05350002
N36      EQU   36                  NUMBER                               05400002
N15      EQU   15                  NUMBER                               05500002
N59      EQU   59                  NUMBER                               05550002
N255     EQU   255                 NUMBER                               05750002
BLANK    EQU   C' '                BLANK CHARACTER                      05800002
N54      EQU   54                  NUMBER                               05850002
R        EQU   C'R'                                              S21002 05900002
*********************************************************************** 05950002
         EJECT                                                          06000002
*/*E IEECVETD */                                                        06050002
*                                                                       06100002
* ESTABLISH BASES                                                       06150002
*                                                                       06200002
*/*%A001: P (,%A002) ESTABLISH ADDRESSABILITY */                        06250002
         BALR  XA,N0     ESTABLISH PROGRAM ADDRESSIBILITY               06300002
         USING *,XA                                                     06350002
         B     BEGIN               BRANCH AROUND PATCH AREA             06360002
ICATCH   DC    CL72'IEECVETD'      EYECATCHER AND FIELD MAINTENANCE     06370002
BEGIN    EQU   *                   END OF PATCH AREA                    06380002
         LR    XB,X1               ESTABLISH CXSA ADDRESS               06400002
         USING CXSA,XB                                                  06450002
         LR    XD,XE               SAVE RETURN REGISTER                 06500002
         L     XC,CSAUCM           ESTABLISH UCM ADDRESS                06550002
         USING UCMLIST,XC                                               06600002
         L     RRDCM,UCMXB         GET POINTER TO DCM                   06650002
         USING DCMTSRT,RRDCM       ESTABLISH ADDRESSABILITY             06700002
         L     X9,N0(RRDCM)        LOAD PT TO TDCM               S21003 06750002
         USING DCMSTRT,X9          ESTABLISH DCM BASE REGISTER          06800002
         L     X7,CSACTLM          GET POINTER TO UCM                   06850002
         USING UCM,X7              ESTABLISH UCM BASE REGISTER          06900002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06910002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    06920002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      06930002
         L     X2,DCMAWARN         GET ADDR OF WARNING LINE             06950002
         L     X3,DCMAINS          GET ADDR OF INSTRUCTION LINE         07000002
         LA    X6,IOEXIT           LOAD RETURN REG WITH IO EXIT ADDR    07050002
*/*%A002: D (YES,%A003,NO,NOTOUT) OUTPUT ONLY CONSOLE */                07100002
         TM    UCMDISP,UCMDISPF+UCMDISPG Q. OUTPUT ONLY CONSOLE  S21003 07150002
         BZ    NOTOUT              NO--                          S21003 07200002
*/*%A003: P (,NOTOUT) INSTRUCTION LINE PT = WARNING LINE */             07250002
         LR    X3,X2               YES-SET INSTR. LINE PT=WARN.  S21003 07300002
NOTOUT   EQU   *                                                 S21003 07350002
         SPACE 2                                                        07400002
*  TEST FOR TYPE OF MESSAGE TO BE MOVED INTO WARNING OR INSTRUC LINE    07450002
*                                                                       07500002
*/*NOTOUT: D (YES,DELREQ,NO,%A005) DELETION REQUESTED MSG */            07700002
         TM    DCMCMSG2,DCMDLREQ   Q. MOVE IN DELETION REQUESTED MSG    07750002
         BO    DELREQ              YES                                  07800002
*/*%A005: D (YES,CHGOPT,NO,%A006) CHANGE OPTIONS MSG */                 07850002
         TM    DCMCMSG1,DCMCHOPT   Q. MOVE IN CHANGE OPTIONS MSG        07900002
         BO    CHGOPT              YES                                  07950002
*/*%A006: D (YES,INVOP,NO,LONGTST) INVALID OP MSG */                    08000002
         TM    DCMCMSG2,DCMINVOP   Q. MOVE IN INVALID OP MSG            08050002
         BO    INVOP               YES                                  08100002
LONGTST  EQU   *                                                        08150002
*/*LONGTST: P (,%A007) PRIME REG 6 WITH IOEXIT ADDR */                  08200002
         LA    X6,IOEXIT           LOAD RETURN REG WITH EXIT ADDR       08250002
*/*%A007: D (YES,UNVIEW,NO,%A010) UNVIEWABLE MSG */          MC SA52530 08450002
         TM    DCMCMSG1,DCMUNMSG   Q. MOVE IN UNVIEWABLE MSG MC SA52530 08500002
         BO    UNVIEW              YES                       MC SA52530 08550002
*/*%A009: D (YES,WARNCON,NO,%A009) CON=N,DEL=Y WARNING */    MC SA52530 08560002
         TM    DCMCMSG1,DCMWRCDL   Q. MOVE IN CON=N, DEL=Y   MC SA52530 08570002
         BO    WARNCON             YES                       MC SA52530 08580002
*/*%A010: D (YES,RQINC,NO,%A011) REQUEST INCONS MSG */                  08600002
         TM    DCMCMSG2,DCMRQINC   Q. MOVE IN REQUEST INCONS MSG.       08650002
         BO    RQINC               YES                                  08700002
*/*%A011: D (YES,ILLCURS,NO,%A012) ILLEGAL CURSOR OP MSG */             08750002
         TM    DCMCMSG2,DCMMSGCR   Q. MOVE IN ILLEGAL CURSOR OP MSG     08800002
         BO    ILLCURS             YES                                  08850002
*/*%A012: D (YES,MODEM,NO,%A013) ROLL MODE MSG */                       08900002
         TM    DCMCMSG3,DCMCMRLL    Q. MOVE IN ROLL MODE MSG            08950002
         BO    MODEM               YES                                  09000002
*/*%A013: R RETURN VIA REG 6 */                                         09200002
         BR    X6                  EXIT TO I/O RTN               S21002 09250002
         SPACE 2                                                        09300002
UNVIEW   EQU   *                                                        09350002
         L     XE,UCMXB            POINT TO RDCM              MD  M1687 09450002
         USING DCMTSRT,XE          BASE RDCM                            09500002
         OI    DCMR2FLG,DCMRXUNV   SET UNV MSG IN RDCM        MD  M1687 09550002
*/*UNVIEW: D (YES,%A014,NO,NOROLL) IN ROLL MODE */                      09600002
         CLI   DCMDEL,R            ARE WE IN ROLL MODE           S21002 09650002
         BNE   NOROLL              NO - WRITE UNVIEWABLE MSG     S21002 09700002
*/*%A014: P (,%A015) INDIC. SET TIMER AND SET ON FLAGS IN RDCM */       09750002
         OI    DCMR2FLG,DCMRXTMR   SET TIMER FLAG IN RDCM     MD  M1687 09800002
*/*%A015: P (,XCTL) MOVE DISPLAY 2 NAME INTO CXSA */                    09850002
         L     XFBRANCH,DCMNDSP2   LOAD DISPLAY 2 ADDRESS               09900002
*                                  FOR EXIT TO IEECVET3                 09910002
         B     XCTL                GO TO SET TIMER ON            S21002 09950002
NOROLL   EQU   *                                                 S21002 10000002
*/*NOROLL: S (,%A016) BLNKRHT: BLANK RIGHT HALF WARNING LINE */         10050002
         BAL   XE,BLNKRHT          GO BLANK RIGHT OF WARN LINE          10100002
*/*%A016: P (,WARNEXIT) MOVE UNVIEWABLE MSG AND INDIC. IT IS WRITTEN TO 10150002
*/* SCREEN */                                                           10200002
         LH    XWORK,DCMLGNTH      GET LENGTH OF A LINE                 10250002
         LH    XWORK1,H26          GET LENGTH OF WARNING MSG            10300002
         SR    XWORK,XWORK1        GET DIFFERENCE                       10350002
         BCTR  XWORK,N0            DECRE BY 1                           10400002
         AR    XWORK,X2            INCRE TO CORRECT DISP IN WARN LINE   10450002
         MVC   N0(N26,XWORK),UNVEWMSG  MOVE IN UNVIEWABLE MSG           10500002
         OI    DCMR2FLG,DCMRXUNV INDIC.UNVIEW MSG WRITTEN TO SCRNS21002 10550002
*/*WARNEXIT: P (,IOEXIT) INDICATE WARNING FLAG */                       10600002
WARNEXIT EQU   *                                                        10650002
         OI    DCMIOCM1,DCMWRWRN                                        10700002
IOEXIT   EQU   *                                                        10750002
*/*IOEXIT: D (YES,TURNOFF,NO,%A017) UNVIEWABLE MSG MOVED */             10800002
         TM    DCMCMSG1,DCMUNMSG+DCMCHOPT UNVIEWABLE OR CHANGE OPTIONS  10850002
         BNZ   TURNOFF             YES, DO NOT SOUND ALARM              10900002
*/*%A017: D (YES,TURNOFF,NO,%A17) DELETE REQ. IN LINE */                10950002
         TM    DCMCMSG2,DCMDLREQ   Q  IS DELETE REQUESTED IN LINE       11000002
         BO    TURNOFF             YES, DO NOT SOUND ALARM              11050002
*/*%A17: P (,TURNOFF) TURN ON SOUND ALARM BIT */                        11100002
         OI    DCMIOCM1,DCMSOUND   TURN ON SOUND ALARM BIT              11150002
TURNOFF  EQU   *                                                        11200002
*/*TURNOFF: P (,XCTL) MOVE I/O NEME INTO CXSA */                        11250002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              11300002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     11310002
XCTL     EQU   *                                                        11350002
*/*XCTL: P (,%A018) TURN OFF MESSAGE INDICATORS */                      11400002
         NI    DCMCMSG1,N255-DCMUNMSG-DCMSTEX-DCMCHOPT-DCMELONG-DCMWRCD*11450002
               L-DCMDELNT          TURN OFF MESSAGE BITS                11500002
         MVI   DCMCMSG2,N0         ZERO MESSAGE INDICATORS              11550002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 11600002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             11650002
BLNKRHT  EQU   *                                                        11850002
*/*E BLNKRHT */                                                         11900002
*/*%A019: P (,%A020) BLANK RIGHT HALF OF WARNING LINE */                11950002
         LH    XWORK,DCMLGNTH      GET LENGTH OF LINE                   12000002
         SRL   XWORK,N1            DIVIDE BY TWO              MH  M2070 12010002
         LR    XWORK1,X2           GET ADDR OF WARNING LINE   MH  M2070 12020002
         AR    XWORK1,XWORK        ADD HALF LINE              MH  M2070 12030002
         MVI   N0(XWORK1),BLANK    BLANK FIRST CHARACTER                12300002
         BCTR  XWORK,N0            REDUCE FOR ONE JUST BLANKEDMH  M2070 12310002
         BCTR  XWORK,N0               AND AGAIN FOR EXECUTE   MH  M2070 12320002
         EX    XWORK,BLWARN        BLANK WARN LINE                      12350002
*/*%A020: P (,%A021) TURN OFF BLANKING BIT */                           12400002
         NI    DCMIOCM2,N255-DCMBLWRR   TURN OFF BLANKING BIT           12450002
*/*%A021: R RETURN TO CALLER */                                         12500002
         BR    XE                  RETURN                               12550002
BLLFT    EQU   *                                                        12600002
*/*E BLLFT */                                                           12650002
*/*%B01: P (,%A022) BLANK LEFT HALF OF WARNING LINE */                  12700002
         MVI   N0(X2),BLANK        BLANK WARNING LINE                   12750002
         MVC   N1(N36,X2),N0(X2)   PROPAGATE BLANKS                     12800002
         NI    DCMIOCM2,N255-DCMBLWRL   TURN OFF BLANKING BIT           12850002
*/*%A022: R RETURN TO CALLER */                                         12900002
         BR    XE                  RETURN                               12950002
BLINST   EQU   *                                                        13000002
*/*E BLINST */                                                          13050002
*/*%A023: P (,%A024) BLANK INSTRUCTION LINE */                          13100002
         LR    XWORK1,X3           GET ADDR OF INSTRUC LINE             13150002
         LH    XWORK,DCMLGNTH      GET LENGTH OF LINE                   13200002
         BCTR  XWORK,N0            SUBTRACT                             13250002
         BCTR  XWORK,N0              TWO FROM LENGTH FOR MOVE           13300002
         MVI   N0(XWORK1),BLANK    BLANK FIRST CHARACTER                13350002
         EX    XWORK,BLWARN        EXECUTE INTO MOVE                    13400002
*/*%A024: R RETURN TO CALLER */                                         13450002
         BR    XE                  RETURN                               13500002
CHGOPT   EQU   *                                                        14800002
*/*CHGOPT: P (,%A029) INDIC. 2260 CURSOR TO BE ADVANCED */              14850002
         OI    DCMIOUNQ,DCMRPCUR   INDICATE 2260 CURSOR TO BE ADVANCED  14900002
*/*%A029: S (,%A030) BLINST: BLANK INSTRUCTION LINE */                  14950002
         BAL   XE,BLINST                BLANK INSTRUCTION LINE          15000002
*/*%A030: P (,CHGREG6) MOVE 'CHG OPTIONS' MSG */                        15050002
         MVC   N0(N33,X3),CHGOPMSG MOVE IN ERROR MESSAGE                15100002
CHGREG6  EQU   *                                                        15150002
*/*CHGREG6: P (,INSTWRIT) PRIME REG 6 WITH 'LONGTST' EXIT ADDR */       15200002
         LA    X6,LONGTST          GET EXIT ADDRESS                     15250002
INSTWRIT EQU   *                                                        15300002
*/*INSTWRIT: P (,%A031) INDIC. WRITE INSTRUCTION LINE */                15350002
         OI    DCMIOCM1,DCMWRINS        INDICATE WRITE INSTRUC LINE     15400002
*/*%A031: D (YES,%A032,NO,EXIT) DEVICE A LIGHT PEN DEVICE */            15450002
         TM    DCMIOUNQ,DCMW2250   Q. IS DEVICE A LIGHT PEN DEVICE      15500002
         BNO   EXIT                NO, EXIT                             15550002
*/*%A032: P (,EXIT) MOVE *ENTER*CANCEL* & SET FLAGS ON */               15600002
         MVC   N59(N15,X3),ENCN    MOVE ENTER-CANCEL MESSAGE INTO LINE  15650002
         NI    DCMIOUNQ,N255-DCMINNOR   TURN OFF NORMAL LINE BIT        15700002
         OI    DCMIOUNQ,DCMINERR   INDICATE ERROR MSG IN INST LINE      15750002
EXIT     EQU   *                                                        15800002
*/*EXIT: R BRANCH VIA REG 6 */                                          15850002
         BR    X6                  EXIT EITHER TO I/O RTN OR TO         15900002
*                                      CHECK FOR OTHER MESSAGES TO WRIT 15950002
WARNCON  EQU   *                                                        16000002
*/*WARNCON: S (,%A033) BLLFT: BLANK WARNING LINE */                     16050002
         BAL   XE,BLLFT            GO BLANK WARN LINE                   16100002
*/*%A033: P (,WARNEXIT) MOVE 'WARNING - CON=Y,DEL=Y' MSG */             16150002
         MVC   N0(N27,X2),WARNCMSG MOVE IN ERROR MESSAGE                16200002
         B     WARNEXIT            EXIT TO I/O RTN                      16250002
DELREQ   EQU   *                                                        16300002
*/*DELREQ: P (,%A035) INDIC. 2260 CURSOR TO BE REPOSITIONED */          16350002
         OI    DCMIOUNQ,DCMRPCUR   INDICATE TO 2260 TO REPOSITION CURSO 16400002
*/*%A035: S (,%A036) BLINST: BLANK INSTRUCTION LINE */                  16450002
         BAL   XE,BLINST           GO BLANK INSTRUC LINE                16500002
*/*%A036: P (,CHGREG6) MOVE 'DELETION REQUESTED' MSG */                 16550002
         MVC   N0(N26,X3),DELRQMSG MOVE IN ERROR MESSAGE                16600002
         B     CHGREG6             GO SET X6 TO LONGTST          S21002 16650002
RQINC    EQU   *                                                        16700002
*/*RQINC: S (,%A037) BLINST: BLANK INSTRUCTION LINE */                  16750002
         BAL   XE,BLINST           GO BLANK INSTRUC LINE                16800002
*/*%A037: P (,%A0375) MOVE 'K REQ. INCONS.' MSG */                      16850002
         MVC   N0(N31,X3),RQINCMSG MOVE IN ERROR MESSAGE                16900002
*/*%A0375: D (YES,%A0376,NO,INSTWRIT) ADD 'STATUS ALREADY EXISTS' */    16950002
         TM    DCMCMSG1,DCMSTEX    Q. ADD STATUS EXISTS       MF  M1680 17000002
         BNO   INSTWRIT            NO, EXIT TO I/O RTN        MF  M1680 17050002
*/*%A0376: P (,INSTWRIT) ADD 'STATUS ALREADY EXISTS' */                 17100002
         MVC   N31(N22,X3),STATMSG ADD STATUS EXISTS MSG         S21002 17150002
         B     INSTWRIT            EXIT TO I/O RTN                      17200002
ILLCURS  EQU   *                                                        17250002
*/*ILLCURS: S (,%A038) BLINST: BLANK INSTRUCTION LINE */                17300002
         BAL   XE,BLINST           BLANK INSTRUC LINE                   17350002
*/*%A038: P (,INSTWRIT) MOVE 'ILLEGAL CURSOR OP.' MSG */                17400002
         MVC   N0(N54,X3),ILLCRMSG MOVE IN ERROR MESSAGE                17450002
         B     INSTWRIT            EXIT TO I/O RTN                      17500002
INVOP    EQU   *                                                        17550002
*/*INVOP: S (,%A039) BLINST: BLANK INSTRUCTION LINE */                  17600002
         BAL   XE,BLINST           BLANK INSTRUC LINE                   17650002
*/*%A039: P (,%A040) MOVE 'K INVALID OPERAND' MSG */                    17700002
         MVC   N0(N27,X3),INVOPMSG MOVE IN ERROR MESSAGE         S21002 17750002
         L     XWORK,DCMDSAV       GET ADDR OF BAD OPERAND              17800002
*/*%A040: P (,CHGREG6) MOVE BAD OPERAND NEXT TO IT */                   17850002
         MVC   N26(N6,X3),N0(XWORK) MOVE INVALID OPERAND INTO LINE      17900002
         B     CHGREG6             GO SET X6 TO LONGTST          S21002 17950002
MODEM    EQU   *                                                        18000002
*/*MODEM: P (,%A041) TURN OFF MSG INDICATOR */                          18050002
         NI    DCMCMSG3,N255-DCMCMRLL  TURN OFF MSG INDICATOR           18100002
*/*%A041: S (,%A042) BLLFT: BLANK LEFT HALF OF WARNING LINE */          18150002
         BAL   XE,BLLFT            BLANK                                18200002
*/*%A042: P (,WARNEXIT) MOVE 'MODE=' MSG AND R OR RD ALSO */            18250002
         MVC   N0(N13,X2),MODERMSG MOVE IN ERROR MESSAGE                18300002
         MVC   N14(N2,X2),DCMDEL   MOVE IN R OR RD                      18350002
         B     WARNEXIT            EXIT TO I/O RTN                      18400002
PROCEXIT EQU   *                                                        18450002
*/*PROCEXIT: P (,XCTL) MOVE PROCESSOR 1 NAME INTO CXSA */               18500002
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  18500402
         B     XCTL                TURN OFF INDICATORS                  18502002
         EJECT                                                          18650002
**********************************************************************  19150002
BLWARN   MVC   N1(N0,XWORK1),N0(XWORK1)   USED FOR BLANKING             19200002
**********************************************************************  19250002
         SPACE 2                                                        19300002
ENCN     DC    C'*ENTER**CANCEL*'  15 CHARACTERS                 S21002 19350002
NOHRDMSG DC    C'IEEI55I NO HARD COPY-CON=Y,DEL=N' 32 CHARACTERS S21002 19400002
UNVEWMSG DC    C'IEE160I UNVIEWABLE MESSAGE'          26 CHAR           19450002
CHGOPMSG DC    C'IEE150I CHANGE OPTIONS IF DESIRED'   33 CHAR           19500002
WARNCMSG DC    C'IEE161I WARNING-CON=N,DEL=Y'         27 CHAR           19550002
DELRQMSG DC    C'IEE157I DELETION REQUESTED' 26 CHARACTERS              19600002
RQINCMSG DC    C'IEE158I K  REQUEST INCONSISTENT' 31 CHARACTERS  S21002 19650002
STATMSG  DC    C'-STATUS ALREADY EXISTS'       22 CHARS          S21002 19700002
ILLCRMSG DC    C'IEE154I ILLEGAL CURSOR OPERATION - CURSOR REPOSITIONEDX19750002
               '                                      53 CHAR           19800002
INVOPMSG DC    C'IEE156I K INVALID OPERAND-'  27 CHARS           S21002 19850002
MODERMSG DC    C'IEE163I MODE='                       13 CHAR           19900002
**********************************************************************  19950002
*                                                                       20000002
*        CONSTANTS                                                      20050002
*                                                                       20100002
CHARNH   DC    C'N '               CHARACTER N                          20150002
H38      DC    H'38'               CONSTANT OF 38                       20200002
H37      DC    H'37'               CONSTANT OF 37                       20250002
H26      DC    H'26'               CONSTANT                             20300002
         EJECT                                                          20750002
         IEERDCM                                                        20800002
         EJECT                                                          20900002
         IEETDCM                                                        20950002
         EJECT                                                          21050002
         IEECUCM  FORMAT=NEW                                            21150002
         EJECT                                                          21160002
         IHACTM  CXSA                                                   21250002
*/*IEECVETD: END */                                                     21300002
         END                                                            21350002
./  ADD  SSI=31380735,NAME=IEECVETE
IEECVETE CSECT                                                          00050002
         TITLE 'IEECVETE IGC5E07B MESSAGE 2'                            00550002
**********************************************************************  00600002
*                                                                       00650002
* STATUS       CHANGE LEVEL 0                                           00700002
*                                                                       00750002
*FUNCTION      TO PLACE ERROR MESSAGES INTO THE INSTRUCTION LINE OR     00800002
*              PLACE THE ASSYNCHRONOUS ERROR MESSAGE INTO THE ENTRY     00850002
*              AREA.                                                    00900002
*                                                                       00950002
*ENTRY POINT   IEECVETE                                                 01000002
*                                                                       01050002
*INPUT         BIT SETTINGS IN DCMCMSG1 OR DCMCMSG2 OR DCMCMSG3 TO      01100002
*              INDICATE WHICH MESSAGE MUST BE MOVED INTO THE DCM.       01150002
*                                                                       01200002
*OUTPUT        INDICATIONS TO THE I/O ROUTINE OF WHAT TO WRITE          01250002
*                                                                       01300002
* EXTERNAL REFERENCES NONE                                              01350002
*                                                                       01400002
*EXITS - NORMAL  IEECVETH OR P OR R DEVICE-DEPENDENT IO                 01450002
*       - ERROR  NONE                                                   01500002
*                                                                       01550002
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         01600002
*                                                                       01650002
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      01700002
*                                                                       01750002
*    CHANGES TO THIS MODULE HAVE BEEN MADE TO SUPPORT:                  01800002
*         STATUS DISPLAY SUPPORT, LINE ITEM S21002, AND                 01850002
*         OS/DIDOCS-ANR, LINE ITEM S21003.                              01900002
*                                                                       01950002
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      02000002
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       02050002
*              CHARACTER SET.                                           02100002
*                                                                       02150002
**********************************************************************  02200002
         EJECT                                                          02250002
*/*IEECVETE: CHART */                                                   02300002
*/*IEECVETE: E MESSAGE MOD 2 */                                         02350002
*/* P ESTABLISH ADDRESSABILITY */                                       02400002
*/* D (NO,NOTOUT,YES,) OUTPUT ONLY CONSOLE ? */                         02450002
*/* P (,TESTQ) SET UP TO PUT ALL MSGS IN WARNING LINE */                02500002
*/*NOTOUT: P SET TO PUT MSGS IN INSTRUCTION LINE */                     02550002
*/*TESTQ: D (NO,,YES,DELMOVE) DELETE REQ INCONSIST MSG ? */             02600002
*/* D (NO,,YES,LPMOVE) ILLEGAL L/P OPERATION MSG ? */                   02650002
*/* D (NO,,YES,RAMOVE) RETRYABLE ASYNC ERR MSG ? */                     02700002
*/* D (NO,,YES,CAMOVE) CONDITIONAL ASYNC ERR MSG ? */                   02750002
*/* D (NO,,YES,LONGENT) COMMAND TOO LONG MSG ? */                       02800002
*/* D (NO,,YES,REJECT) COMMAND REJECTED MSG ? */                        02850002
*/*IOEXIT: D (NO,,YES,NOSOUND) COMMAND REJECTED MSG ? */                02900002
*/* P INDICATE SOUND ALARM */                                           02950002
*/*NOSOUND: P SET EXIT TO PROPER I/O ROUTINE */                         03000002
*/*XCTL: R XCTL TO NEXT LOAD */                                         03050002
*/*DELMOVE: S BLINST RTN:GO BLANK INSTRUCTION LINE */                   03100002
*/* P PUT ERROR MSG IN INSTRUCTION LINE */                              03150002
*/* D (NO,DT2,YES,) NO DELETABLE MESSAGES ? */                          03200002
*/* P COMPLETE MESSAGE */                                               03250002
*/*TURNOFF: P TURN OFF ALL MESSAGE FLAGS */                             03300002
*/*INSTWRIT: P INDICATE WRITE INSTRUCTION LINE */                       03350002
*/* D (NO,IOEXIT,YES,) DOES DEVICE HAVE A LITE PEN ? */                 03400002
*/* P PUT ENTER - CANCEL MSG IN INSTR LINE */                           03450002
*/* P (,IOEXIT) INDICATE ERROR MSG IN INSTR LINE */                     03500002
*/*DT2: D (NO,DT3,YES,) INVALID DELETE RANGE ? */                       03550002
*/* P (,TURNOFF) PUT REST OF MESSAGE IN LINE */                         03600002
*/*DT3: D (NO,DT4,YES,) SEG = 0 ? */                                    03650002
*/* P (,TURNOFF) MOVE IN MESSAGE */                                     03700002
*/*DT4: D (NO,DT5,YES,) DISPLAY NOT ON SCREEN ? */                      03750002
*/* P (,TURNOFF) MOVE IN MESSAGE */                                     03800002
*/*DT5: P (,TURNOFF) MOVE IN REST OF MESSAGE */                         03850002
*/*LPMOVE: S BLINST RTN: BLANK INSTRUCTION LINE */                      03900002
*/* P (,INSTWRIT) PUT MESSAGE IN INSTRUCTION LINE */                    03950002
*/*RAMOVE: S BLENTRTN RTN: GO BLANK ENTRY AREA */                       04000002
*/* P PUT ERROR MSG IN LINE */                                          04050002
*/* D (NO,,YES,IOEXIT) OUTPUT ONLY CONSOLE ? */                         04100002
*/* P (,IOEXIT) SET UP TO WRITE BOTH LINES OF ENTRY AREA */             04150002
*/*CAMOVE: S BLENTRTN RTN: GO BLANK THE ENTRY AREA */                   04200002
*/* P MOVE IN ERROR MESSAGE */                                          04250002
*/* D (NO,,YES,IOEXIT) OUTPUT ONLY CONSOLE ? */                         04300002
*/* P (,IOEXIT) PUT MSG IN SECOND LINE OF ENTRY AREA */                 04350002
*/*REJECT: S BLINST RTN:BLANK INSTRUCTION LINE */                       04400002
*/* P (,INSTWRIT) PUT COMMND REJECT MSG IN INSTR LINE */                04450002
*/*BLENTRTN: E BLENTRTN RTN */                                          04500002
*/* P BLANK ENTRY AREA IN DCM */                                        04550002
*/* R BR 14 */                                                          04600002
*/*BLINST: E BLINST RTN */                                              04650002
*/* P BLANK THE INSTRUCTION LINE IN DCM */                              04700002
*/* R BR 14 */                                                          04750002
*/*LONGENT: S BLINST RTN:BLANK INSTRUCTION LINE */                      04800002
*/* P PUT ERROR MESSAGE IN LINE */                                      04850002
*/* P FIND WHERE TO INSERT CURSOR AND HOLD LOCATION */                  04900002
*/* P (,INSTWRIT) INDICATE INSERT CURSOR */                             04950002
*/*IEECVETE: END */                                                     05000002
         EJECT                                                          05050002
**********************************************************************  05100002
*  REGISTERS                                                            05150002
*                                                                       05200002
**********************************************************************  05250002
X0       EQU   0              WORK REG                                  05300002
X1       EQU   1              WORK REG                                  05350002
X2       EQU   2              ADDR OF INSTRUC LINE                      05400002
X3       EQU   3              ADDR OF ENTRY AREA                        05450002
X4       EQU   4              LENGTH REG                                05500002
XWORK    EQU   5              WORK REG                                  05550002
XWORK1   EQU   4                   WORK REG                      S21002 05600002
X6       EQU   6              WORK REG                                  05650002
X7       EQU   7              UCM BASE REGISTER                         05700002
X8       EQU   8              WORK REG                                  05750002
X9       EQU   9              DCMBASE REGISTER                          05800002
XA       EQU   10             PROGRAM BASE REGISTER                     05850002
XB       EQU   11             CXSA BASE REGISTER                        05900002
XC       EQU   12             UCM ENTRY BASE REGISTER                   05950002
XD       EQU   13             WORK REG                                  06000002
XE       EQU   14             USED FOR BRANCHING                        06050002
XF       EQU   15             WORK REG                                  06100002
X1PARM   EQU   1                                                        06102002
X8UCME   EQU   8                                                        06110002
XFBRANCH EQU   15                                                       06120002
*                                                                       06150002
*  EQUATES                                                              06200002
*                                                                       06250002
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            06260002
ID2      EQU   C'E'                2ND CHARACTER OF CSECT ID            06270002
BLANK    EQU   C' '                BLANK CHARACTER                      06300002
N0       EQU   0                   NUMBER                               06350002
N1       EQU   1                   NUMBER                               06400002
N2       EQU   2                   NUMBER                               06450002
N4       EQU   4                   NUMBER                               06550002
N7       EQU   7                   NUMBER                               06700002
N13      EQU   13                  NUMBER                               06850002
N15      EQU   15                  NUMBER                               06900002
N21      EQU   21                  NUMBER                               06950002
N34      EQU   34                  NUMBER                               07000002
N36      EQU   36                  NUMBER                        S21002 07100002
N41      EQU   41                  NUMBER                               07110002
N48      EQU   48                  DISPLACEMENT NUMBER           S21002 07150002
N50      EQU   50                  NUMBER                               07200002
N52      EQU   52                  NUMBER                               07250002
N59      EQU   59                  NUMBER                               07350002
N62      EQU   62                  NUMBER                               07400002
N65      EQU   65                  NUMBER                               07450002
N255     EQU   255                 NUMBER                               07550002
**********************************************************************  07600002
         EJECT                                                          07650002
**********************************************************************  07700002
*                                                                       07750002
* ESTABLISH BASES                                                       07800002
*                                                                       07850002
**********************************************************************  07900002
         BALR  XA,N0               ESTABLISH                            07950002
         USING *,XA                  PROGRAM ADDRESSIBILITY             08000002
         LR    XB,X1               ESTABLISH                            08050002
         USING CXSA,XB             CXSA ADDRESS                         08100002
         L     XC,CSAUCM           ESTABLISH                            08200002
         USING UCMLIST,XC            UCM ADDRESS                        08250002
         L     X9,UCMXB            ESTABLISH                            08300002
         L     X9,N0(X9)           LOAD TDCM POINTER             S21003 08350002
         USING DCMSTRT,X9         DCM ADDRESS                           08400002
         L     X7,CSACTLM          GET POINTER TO UCM                   08450002
         USING UCM,X7              ESTABLISH UCM ADDRESSIBILITY         08500002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      08510002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    08520002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      08530002
*    IF THE CONSOLE IS AN OUTPUT ONLY CONSOLE, THEN              S21003 08550002
*    ALL MESSAGES WILL BE WRITTEN IN THE WARNING LINE.           S21003 08600002
         TM    UCMDISP,UCMDISPF+UCMDISPG Q. OUTPUT ONLY CONSOLE  S21003 08650002
         BZ    NOTOUT              NO--                          S21003 08700002
         L     X2,DCMAWARN         YES-LOAD WARNING LINE PT      S21003 08750002
         B     TESTQ               SKIP                          S21003 08800002
NOTOUT   EQU   *                                                 S21003 08850002
         L     X2,DCMAINS          GET ADDRESS OF INSTRUCTION LINE      08900002
TESTQ    EQU   *                                                 S21003 08950002
* TEST FOR ERROR MESSAGE TO BE MOVED IN                                 09000002
*                                                                       09050002
         TM    DCMCMSG2,DCMDELRI   Q. DELETE REQUEST INCONSISTENT       09100002
         BO    DELMOVE             YES                                  09150002
         TM    DCMCMSG2,DCMCILLP   Q. ILLEGAL LIGHT PEN OPERATION       09200002
         BO    LPMOVE              YES                                  09250002
         TM    DCMCMSG2,DCMASYRT   Q. RETRYABLE ASYNC ERROR             09300002
         BO    RAMOVE              YES                                  09350002
         TM    DCMCMSG2,DCMASYCD   Q. CONDITIONAL ASYNC ERROR           09400002
         BO    CAMOVE              YES                                  09450002
         TM    DCMCMSG1,DCMELONG   Q.MOVE IN ENTRY TOO LONG MSG  S21002 09500002
         BO    LONGENT             YES-                          S21002 09550002
         TM    DCMCMSG3,DCMDTBSY   Q. MOVE IN COMMAND REJECTED MSG      09600002
         BO    REJECT              YES                                  09650002
IOEXIT   EQU   *                                                        09700002
         TM    DCMCMSG3,DCMDTBSY   COMMAND REJECTED MSG                 09750002
         BO    NOSOUND             IF SO, DO NOT SOUND ALARM            09800002
         OI    DCMIOCM1,DCMSOUND   ELSE, INDICATE SOUND ALARM           09850002
NOSOUND  EQU   *                                                        09900002
         L     XFBRANCH,DCMIORTN   LAOD IO ROUTINE ADDRESS              09950002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 09960002
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         10000002
DELMOVE  EQU   *                                                        10300002
         BAL   XE,BLINST           GO BLANK INSTRUCTION LINE            10350002
         NI    DCMCMSG2,N255-DCMDELRI   TURN OFF BIT                    10400002
         MVC   N0(N36,X2),DELRQINC  MOVE IN ERROR MESSAGE        S21002 10450002
         TM    DCMCMSG3,DCMCDLR1   Q. NO DELETABLE MESSAGES             10500002
         BNO   DT2                 NO, CONTINUE TESTING                 10550002
         MVC   N36(N21,X2),DLRNODEL YES,MOVE IN REST OF ERROR MSG 21002 10600002
TURNOFF  EQU   *                                                        10650002
         MVI   DCMCMSG3,N0         TURN OFF BITS                        10700002
INSTWRIT EQU   *                                                        10750002
         OI    DCMIOCM1,DCMWRINS   INDICATE WRITE INSTRUC LINE          10800002
         TM    DCMIOUNQ,DCMW2250   Q. IS DEVICE A LIGHT PEN DEVICE      10850002
         BNO   IOEXIT              NO, EXIT TO I/O RTN                  10900002
         MVC   N59(N15,X2),ENCN   MOVE ENTER-CANCEL MSG INTO LINE       10950002
         NI    DCMIOUNQ,N255-DCMINNOR   TURN OFF NORMAL LINE BIT        11000002
         OI    DCMIOUNQ,DCMINERR   INDICATE ERROR MSG IN INST LINE      11050002
         B     IOEXIT              EXIT TO I/O ROUTINE                  11100002
DT2      EQU   *                                                        11150002
         TM    DCMCMSG3,DCMCDLR2   Q. INVALID RANGE                     11200002
         BNO   DT3                 NO                                   11250002
         MVC   N36(N13,X2),DLRINVRG MOVE IN REST OF MSG          S21002 11300002
         B     TURNOFF             GO EXIT                              11350002
DT3      EQU   *                                                        11400002
         TM    DCMCMSG3,DCMCDLR3   Q. SEG=0                             11450002
         BNO   DT4                 NO                                   11500002
         MVC   N36(N7,X2),DLRSEG0  MOVE IN MESSAGE               S21002 11550002
         B     TURNOFF             EXIT                                 11600002
DT4      EQU   *                                                        11650002
         TM    DCMCMSG3,DCMCDLR4   Q. DISPLAY NOT ON SCREEN             11700002
         BNO   DT5                 NO                                   11750002
         MVC   N36(N21,X2),DLRNOTON YES,MOVE IN REST OF MESSAGE  S21002 11800002
         B     TURNOFF             EXIT                                 11850002
DT5      EQU   *                   INVALID OPERAND FOR DELETE REQ       11900002
         MVC   N36(N15,X2),DLRINVOP MOVE IN REST OF MSG          S21002 11950002
         B     TURNOFF             EXIT                                 12000002
LPMOVE   EQU   *                                                        12050002
         NI    DCMCMSG2,N255-DCMCILLP   TURN OFF BIT                    12100002
         BAL   XE,BLINST           BLANK INSTRUC LINE                   12150002
         MVC   N0(N41,X2),ILLGHTPN MOVE IN MESSAGE            MH  M2070 12210002
         B     INSTWRIT            GO TO WRITE INSTRUC LIBE             12250002
RAMOVE   EQU   *                                                        12300002
         BAL   XE,BLENTRTN         GO TO BLANK ENTRY AREA               12350002
         NI    DCMCMSG2,N255-DCMASYRT   TURN OFF BIT                    12400002
         MVC   N0(N62,X3),RETASYN  MOVE IN ERROR MSG                    12450002
*    IF CONSOLE IS OUTPUT ONLY, THEN WRTIE ONLY ONE LINE OF MSG. S21003 12500002
         TM    UCMDISP,UCMDISPF+UCMDISPG Q. OUTPUT ONLY CONSOLE  S21003 12550002
         BO    OUTONLY             WRITE ONLY ONE LINE           S21003 12600002
         AH    X3,DCMCORLN         INCREMENT TO LINE 2 OF ENTRY  S21003 12650002
         MVC   N0(N50,X3),RETASYN2 MOVE IN 2ND LINE                     12700002
OUTONLY  EQU   *                                                 S21003 12750002
         B     IOEXIT              EXIT                                 12800002
CAMOVE   EQU   *                                                        12850002
         BAL   XE,BLENTRTN         GO TO BLANK ENTRY AREA               12900002
         MVC   N0(N65,X3),CONDASYN MOVE IN ERROR MSG                    12950002
*    IF CONSOLE IS OUTPUT ONLY, THEN WRTIE ONLY ONE LINE OF MSG. S21003 13000002
         TM    UCMDISP,UCMDISPF+UCMDISPG Q. OUTPUT ONLY CONSOLE  S21003 13050002
         BO    OUTONLY             WRITE ONLY ONE LINE           S21003 13100002
         AH    X3,DCMCORLN         INCREMENT TO LINE 2 OF ENTRY  S21003 13150002
         MVC   N0(N52,X3),CONDASY2 MOVE IN ERROR MSG                    13200002
         NI    DCMCMSG2,N255-DCMASYCD   TURN OFF BIT                    13250002
         B     IOEXIT              EXIT TO I/O ROUTINE                  13300002
REJECT   EQU   *                                                        13350002
         BAL   XE,BLINST           BLANK INSTRUCTION LINE               13400002
         MVC   N0(N34,X2),REJCTMSG      MOVE IN COMMAND REJECTED MSG    13450002
         B     INSTWRIT            GO TO WRITE INSTRUCTION LINE         13500002
BLENTRTN EQU   *         THIS ROUTINE BLANKS THE ENTRY AREA             13550002
         L     X3,DCMAENTR         GET ADDR OF ENTRY AREA               13600002
         MVI   N0(X3),BLANK        BLANK FIRST CHARACTER                13650002
         LH    X4,DCMLGNTH         GET LENGTH OF ONE LINE               13700002
         SLL   X4,N1               MULTIPLY BY 2                        13750002
         BCTR  X4,N0               SUBTRACT                             13800002
         BCTR  X4,N0                     TWO                            13850002
         EX    X4,BLENT            EXECUTE INTO MOVE INSTRUCTION        13900002
         BR    XE                  RETURN                               13950002
BLINST   EQU   *              THIS RTN BLANKS THE INSTRUCTION LINE      14000002
         LH    XWORK,DCMLGNTH      GET LENGTH OF A LINE                 14050002
         BCTR  XWORK,N0            DECREMENT                            14100002
         BCTR  XWORK,N0             BY TWO                              14150002
         MVI   N0(X2),BLANK        BLANK FIRST CHAR OF INSTRUC LINE     14200002
         EX    XWORK,BLI           PROPAGATE BLANKS                     14250002
         BR    XE                  RETURN                               14300002
LONGENT  EQU   *                                                 S21002 14350002
         BAL   XE,BLINST           BLANK INSTRUCTION LINE        S21002 14400002
         MVC   N0(N48,X2),LONGEMSG MOVE IN ERROR MSG             S21002 14450002
*    COMPUTE WHERE CURSOR SHOULD BE INSERTED FOR ENTRY TOO LONG  S21002 14500002
         LH    XWORK,DCMLGNTH      GET LENGTH OF A LINE          S21002 14550002
         LH    XWORK1,H127         GET POSITION                  S21002 14600002
         SR    XWORK1,XWORK        FOR INSERTING CURSOR          S21002 14650002
         MVI   DCMCULNO,N2         INDICATE LINE 2 OF ENTRY AREA S21002 14700002
         STC   XWORK1,DCMPOSCU     INDICATE POSITION             S21002 14750002
         OI    DCMIOCM1,DCMINSC    INDICATE INSERT CURSOR        S21002 14800002
         B     INSTWRIT                                          S21002 14850002
         EJECT                                                          14900002
**********************************************************************  14950002
*      EXECUTED INSTRUCTIONS:                                           15000002
*                                                                       15050002
BLI      MVC   N1(N0,X2),N0(X2)    INSTRC FOR BLANKING INSTRUCTION LINE 15100002
BLENT    MVC   N1(N0,X3),N0(X3)    INSTRUC FOR BLANKING ENTRY AREA      15150002
**********************************************************************  15200002
H127     DC    H'127'              CONSTANT                      S21002 15250002
DELRQINC DC    C'IEE151I DELETE REQUEST INCONSISTENT-' 36 CHARS  S21002 15300002
DLRNODEL DC    C'NO DELETABLE MESSAGES'      21 CHAR                    15350002
DLRINVRG DC    C'INVALID RANGE'              13 CHAR                    15400002
DLRSEG0  DC    C'SEG = 0'                    7  CHAR                    15450002
DLRNOTON DC    C'DISPLAY NOT ON SCREEN'      21 CHAR                    15500002
DLRINVOP DC    C'INVALID OPERAND'            15 CHAR                    15550002
CONDASYN DC    C'IEE171I CONDITIONAL ERROR. RECENT ACTION MAY NEED TO BX15600002
               E REPEATED.'                  65 CHAR                    15650002
CONDASY2 DC    C'IEE171I PRESS CANCEL TO CONTINUE, OR SWITCH CONSOLES'  15700002
*                                            52 CHAR                    15750002
RETASYN  DC    C'IEE170I RETRYABLE ERROR. RECENT ACTION MAY NEED TO BE X15800002
               REPEATED'                     62 CHAR                    15850002
RETASYN2 DC    C'IEE170I PRESS THE CANCEL KEY TO RESTORE THE SCREEN' 50 15900002
ILLGHTPN DC    C'IEE164I ILLEGAL LIGHT PEN - CURSOR DETECT'  41 CHAR    15960002
*                                                             MH  M2070 15970002
REJCTMSG DC    C'IEE342I K D,F REJECTED - TASK BUSY'  34 CHARACTERS     16000002
ENCN     DC    C'*ENTER**CANCEL*' 15 CHARS                       S21002 16050002
LONGEMSG DC    C'IEE153I ERROR- ENTRY GREATER THAN 126 CHARACTERS' 48 C 16100002
         EJECT                                                          16150002
*********************************************************************** 16200002
*                                                                     * 16250002
*                             PATCH AREA                              * 16300002
*                                                                     * 16350002
*********************************************************************** 16400002
         SPACE 2                                                        16450002
PATCH    DC    CL72'***PATCH AREA -- IGC5E07B***'                S21002 16500002
         EJECT                                                          16550002
         IEETDCM                                                        16600002
         EJECT                                                          16700002
         IEECUCM  FORMAT=NEW                                            16800002
         EJECT                                                          16850002
         IHACTM  CXSA                                                   16950002
         END                                                            17000002
./  ADD  SSI=70750040,NAME=IEECVETF
IEECVETF CSECT                                                          00100000
         TITLE 'IEECVETF LIGHT PEN-CURSOR'                              00200000
*C 114500,119000,124000                                      ME  YM3894 00300000
*A 060600                                                    ME  YM3894 00400000
*********************************************************************** 00500000
*                                                                     * 00600000
* STATUS       CHANGE LEVEL 0                                           00700000
*                                                                       00730000
* APARS FIXED --- ZA17699                                               00760000
*                                                                     * 00800000
* FUNCTION                                                            * 00900000
*    ANALYZE LIGHT PEN OR CURSOR INTERRUPTS AND DECIDE WHETHER IT IS A* 01000000
*    VALID DETECT.                                                    * 01100000
*                                                                     * 01200000
* ENTRY POINT  IEECVETF (CSECT NAME)                                    01300000
*                                                                     * 01400000
* INPUT        RELATIVE LINE AND CHARACTER (LINE1 = 0 , CHARACTER1 =0)* 01500000
*              POSITION OF LIGHT PEN OR CURSOR ON SCREEN AT TIME OF   * 01600000
*              INTERRUPT IN FIRST 2 BYTES OF DCMDSAV                  * 01700000
*                                                                     * 01800000
* OUTPUT       DCM ADDRESS OF LINE AND CHARACTER WHERE DETECT TOOK    * 01900000
*              PLACE, SCT ADDRESS OF LINE WHERE DETECT TOOK PLACE     * 02000000
*                                                                     * 02100000
* EXTERNAL REFERENCES NONE                                              02200000
*                                                                       02300000
* EXITS - NORMAL IEECVET8 DELETE 3                                      02400000
*                IEECVET9 DELETE 4                                      02500000
*                IEECVET4 COMMAND                                       02600000
*                IEECVETD MESSAGE MODULE 1                              02700000
*                IEECVETE MESSAGE MODULE 2                              02800000
*                IEECVETH OR P OR R OR U DEVICE-DEPENDENT IO     S21002 02900000
*                IEECVFTA  PFK RTN 1                             S21002 03000000
*       - ERROR  NONE                                                   03100000
*                                                                       03200000
* TABLES/WORK AREAS                                                   * 03300000
*    UCM, WQE, CXSA, BASE UCM, RDCM, TDCM                             * 03400000
*                                                                       03500000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      03600000
*                                                                       03700000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      03800000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       03900000
*              CHARACTER SET.                                           04000000
*                                                                       04100000
*********************************************************************** 04200000
         EJECT                                                          04300000
*********************************************************************** 04400000
**                                                                   ** 04500000
*                   REG  EQUATES                                      * 04600000
**                                                                   ** 04700000
*********************************************************************** 04800000
REG1     EQU   1                   PARMREG                              04900000
REG02    EQU   2                   REG 2                         S21002 05000000
REG3     EQU   3                   PTR TO DCM ENTRY AREA         S21002 05100000
REG4     EQU   4                   RDCM BASE REG                 S21002 05200000
POINT    EQU   6                   WORK                                 05300000
LINE     EQU   8                   WORK                                 05400000
WORK     EQU   9                   WORK                                 05500000
UCMBASE  EQU   10                  UCMLIST BASE                         05600000
BASE     EQU   11                  PROG BASE                            05700000
CXSABASE EQU   12                  XSA BASE                             05800000
DCMBASE  EQU   13                  DMC BASE                             05900000
RETURN   EQU   14                  RETURN REG                           06000000
XCTLREG  EQU   15                  XCTL REG                             06100000
X1PARM   EQU   1                                                        06200000
X8UCME   EQU   8                                                        06300000
XFBRANCH EQU   15                                                       06400000
         EJECT                                                          06500000
*****************************************************************       06600000
**                                                                   ** 06700000
*                        EQUATES                                      * 06800000
**                                                                   ** 06900000
*****************************************************************       07000000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            07100000
ID2      EQU   C'F'                2ND CHARACTER OF CSECT ID            07200000
N0       EQU   0                   NUMBER                               07300000
N1       EQU   1                   NUMBER                               07400000
N2       EQU   2                   NUMBER                               07500000
N3       EQU   3                   NUMBER                               07600000
N4       EQU   4                   NUMBER                               07700000
N5       EQU   5                   NUMBER                               07800000
N6       EQU   6                   NUMBER                               07900000
N7       EQU   7                   NUMBER                               08000000
N8       EQU   8                   NUMBER                               08100000
NA       EQU   10                  CONSTANT                      S21002 08200000
N12      EQU   12                  FIELD INCREMENT               S21002 08300000
N14      EQU   14                  CONSTANT                      S21002 08400000
N15      EQU   15                  NUMBER                               08500000
N16      EQU   16                  NUMBER                               08600000
N24      EQU   24                  NUMBER                               08700000
N27      EQU   27                  NUMBER                               08800000
N32      EQU   32                  NUMBER                               08900000
N38      EQU   38                  NUMBER                               09000000
N54      EQU   54                  FIELD INCREMENR               S21002 09200000
N59      EQU   59                  NUMBER                               09300000
N60      EQU   60                  NUMBER                      @ZA17699 09350000
N64      EQU   64                  NUMBER                    ME  YM3894 09400000
N65      EQU   65                  NUMBER                               09500000
N67      EQU   67                  CHAR POSITION OF ERASE OPTION S21002 09600000
N126     EQU   126                 FIELD INCREMENT               S21002 09700000
P        EQU   C'P'                CHARACTER P                          09800000
N        EQU   C'N'                CHARACTER N                          09900000
R        EQU   C'R'                CHARACTER R                          10000000
BLANK    EQU   C' '                BLANK                                10100000
CF0      EQU   C'0'                CONSTANT                             10200000
DCMFULL  EQU   54                  USED TO TURN MULTIPLE BITS ON        10300000
Z        EQU   C'Z'                INLINE MSG AREA MLWTO ID      S21002 10400000
*********************************************************************** 10500000
         EJECT                                                          10600000
*********************************************************************** 10700000
**                                                                   ** 10800000
*              INITIALIZE PROGRAM                                     * 10900000
**                                                                   ** 11000000
*********************************************************************** 11100000
         BALR  BASE,N0             DECLARE                              11200000
         USING *,BASE                     BASE                          11300000
         B     ICATCH              BRANCH AROUND EYECATCHER      S21003 11400000
         DC    C'   MODULE IGC5F07B, FICHE IEECVETF  ' EYECATCHERS21003 11500000
ZAPAREA  DC    12C'ZAP'   AND RESERVED FOR FIELD MODIFICATIONS   S21003 11600000
ICATCH   LR    CXSABASE,REG1       GET XSA ADDRESS               S21003 11700000
         USING CXSA,CXSABASE       DECLARE XSA                          11800000
         L     UCMBASE,CSAUCM      GET UCM ENTRY POINTER                11900000
         USING UCMLIST,UCMBASE     DECLARE UCMLIST                      12000000
         L     DCMBASE,UCMXB       GET DCM POINTER                      12100000
         LR    REG4,DCMBASE        LOAD RDCM BASE REG            S21003 12200000
         USING DCMTSRT,REG4           ADDRESSABILITY                    12300000
         L     DCMBASE,N0(DCMBASE) LOAD TDCM PT                  S21003 12400000
         USING DCMSTRT,DCMBASE    DECLARE DCM                           12500000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      12600000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    12700000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      12800000
         MVI   DCMUTILT,N0         CLEAR UTILITY BYTE                   12900000
         EJECT                                                          13000000
*    THIS RTN WILL CHK IF DETECT OCCURED IN OUT OF LINE DISPLAY  S21002 13100000
*                                                                S21002 13200000
         SR    WORK,WORK           CLEAR REG                     S21002 13300000
         IC    WORK,DCMDSAV        GET LINE NO. OF DETECT        S21002 13400000
* NEXT TEST MAKES SURE DETECT OCCURRED IN MSG AREA FOR DISP TST  S21002 13500000
         SR    LINE,LINE           CLEAR REG                     S21002 13600000
         LH    LINE,DCMRMSAL       LOAD NO. OF LINES ON SCREEN   S21002 13700000
         CR    WORK,LINE   COMP. DETECTED LINE NO. TO MAX. SIZE  S21002 13800000
         BH    CURSFIND            DETECT NOT IN MESSAGE AREA    S21002 13900000
         A     WORK,DCMADSEC       ADD  SSCT ADDR                S21002 14000000
         TM    N0(WORK),DCMSECCL   YES-IS IT A CONTROL LINE      S21002 14100000
         BO    OUTCTRL             YES- GO INSPECT IT            S21002 14200000
         TM    N0(WORK),DCMSECLL+DCMSECDL+DCMSECBL+DCMSECDD      S21002 14300000
         BNZ   ERROR               YES-                          S21002 14400000
         B     CURSFIND            NO--GO SEE WHERE DETECTED     S21002 14500000
GETSACB  EQU   *                                                 S21002 14600000
*    THIS RTN SEARCHES THE SACB TO FIND ONE THAT MATCHES THE TOP S21002 14700000
*    ROW LINE NUMBER OF THE SCREEN AREA NOW WORKING WITH         S21002 14800000
*                                                                S21002 14900000
         L     POINT,DCMADSDS      LOAD FIRST SACB PT            S21002 15000000
         USING DCMACB,POINT                                      S21002 15100000
*    NOTE: CHANGING LINE NUMBER MAY BE ONLY TEMPORARY            S21002 15200000
         SR    WORK,WORK           CLEAR REG                     S21002 15300000
         IC    WORK,DCMDSAV        LOAD LINE NUMBER              S21002 15400000
         LA    WORK,N1(WORK)       BUMP NO. BY 1                 S21002 15500000
         STC   WORK,DCMDSAV       TEMPORARY RESTORE              S21002 15600000
COMPLINE EQU   *                                                 S21002 15700000
         LTR   POINT,POINT         TEST FOR ZERO                 S21002 15800000
         BZ    ERROR                                             S21002 15900000
         CLC   DCMATOP(N1),DCMDSAV     TOP ROW LINE NO. OF AREA  S21002 16000000
*                                  DOES IT MATCH THE WORK AREA   S21002 16100000
         BNE   NEXTSACB           NO--GO PICK UP PT TO NEXT SACB S21002 16200000
         BCTR  WORK,N0              DECREMENT NUMBER BY 1        S21002 16300000
         STC   WORK,DCMDSAV        RESTORE NO. TO ORIGINAL VALUE S21002 16400000
         BR    RETURN              YES-RETURN TO CALLER          S21002 16500000
NEXTSACB EQU   *                                                 S21002 16600000
         L     POINT,N0(POINT)   SET PT TO NEXT SCREEN AREA CTRL S21002 16700000
         B     COMPLINE            BLOCK AND GO LOOP             S21002 16800000
         EJECT                                                          16900000
*****************************************************************       17000000
*    THE DETECT OCCURED ON AN OUT-OF-LINE DISPLAY                S21002 17100000
*    THIS RTN CHKS FOR OUT-OF-LINE DISPLAY LINE CONTROL OPTIONS  S21002 17200000
*                                                                S21002 17300000
*****************************************************************       17400000
OUTCTRL  EQU   *                                                 S21002 17500000
         BAL   RETURN,GETSACB      GO FIND SACB                  S21002 17600000
         TM    DCMASACB,DCMAUSE    IS SACB IN USE                S21002 17700000
         BNO   ERROR               NO--                          S21002 17800000
         TM    DCMAFLG1,DCMADISP   IS A DISPLAY IN AREA          S21002 17900000
         BNO   ERROR               NO--                          S21002 18000000
         L     REG3,DCMAENTR       POINT TO ENTRY AREA           S21002 18100000
         CLI   DCMDSAV+N1,N67      DETECT ON *  OPTION           S21002 18200000
         BH    ERROR               ERROR- DETECTED ON AREA ID    S21002 18300000
         TM    DCMADFLG,DCMAHOLD+DCMADD Q. DYN DISP IN HOLD MODE S21002 18400000
         BO    DYNAMIC             YES-                          S21002 18500000
         TM    DCMADFLG,DCMADD     Q. IS IT A DYNAMIC DISPLAY    S21002 18600000
         BO    STOPMON2            YES-                          S21002 18700000
STATIC   EQU   *                   NO--CHK IF *F OR *E DETECTED  S21002 18800000
*                                                                S21002 18900000
*    SAMPLE STATIC DISPLAY OPTIONS POSITIONING:        *F    *E  S21002 19000000
         CLI   DCMDSAV+N1,N64      CHK IF *E                 ME  YM3894 19100000
         BNL   ERASEIT             YES-GO TO ERASE OPTION        S21002 19200000
         CLI   DCMDSAV+N1,N54      CHK IF *F                     S21002 19300000
         BNL   FOWARDIT            YES-GO MOVE IN PAGING COMMAND S21002 19400000
         B     ERROR               NO--ERROR--NEITHER OPTION     S21002 19500000
*                                                                S21002 19600000
*    IF DYNAMIC IN UPDATE MODE                          *F    *U S21002 19700000
*                                                                S21002 19800000
DYNAMIC  EQU   *                                                 S21002 19900000
         CLI   DCMDSAV+N1,N64      DETECT ON *U              ME  YM3894 20000000
         BNL   UPDATEIT              --MUST BE *U OPTION         S21002 20100000
         CLI   DCMDSAV+N1,N54      DETECT ON *F                  S21002 20200000
         BNL   FOWARDIT            NO--MUST BE *F OPTION         S21002 20300000
         B     ERROR               NO--NONE OF ABOVE--ERROR      S21002 20400000
*                                                                S21002 20500000
*    SAMPLE OF DYNAMIC DISPLAY OPTIONS POSITIONING:              S21002 20600000
*    IF DYNAMIC IN HOLD MODE                           *PM    *H S21002 20700000
*                                                                S21002 20800000
STOPMON2 EQU   *                                                 S21002 20900000
         CLI   DCMDSAV+N1,N64                                ME  YM3894 21000000
         BNL   HOLDIT              YES-*H OPTION                 S21002 21100000
         CLI   DCMDSAV+N1,N54      DETECT ON *PM                 S21002 21200000
         BL    ERROR               NEITHER OPTION                S21002 21300000
         LA    REG02,PTA         SET PT TO STOP TRACK COMMAND           21400000
         B     ENTCOMND                                          S21002 21500000
*                                                                S21002 21600000
UPDATEIT EQU   *                                                 S21002 21700000
         LA    REG02,KDU           SET PT TO UPDATE COMMAND      S21002 21800000
         B     ENTCOMND                                          S21002 21900000
*                                                                S21002 22000000
HOLDIT   EQU   *                                                 S21002 22100000
         LA    REG02,KDH           SET PT TO HOLD COMMAND        S21002 22200000
         B     ENTCOMND                                          S21002 22300000
*                                                                S21002 22400000
ERASEIT  EQU   *                                                 S21002 22500000
         LA    REG02,KED2          SET PT TO ERASE COMMAND       S21002 22600000
         B     ENTCOMND                                          S21002 22700000
*                                                                S21002 22800000
FOWARDIT EQU   *                                                 S21002 22900000
         LA    REG02,KDF2         SET PT TO FORWARD PAGE COMMAND S21002 23000000
*                                                                S21002 23100000
*    THIS RTN PUTS THE COMMAND POINTED TO BY POINT IN ENTRY AREA S21002 23200000
*    AND XCTLS TO THE COMMAND MODULE                             S21002 23300000
*                                                                S21002 23400000
ENTCOMND EQU   *                                                 S21002 23500000
         MVI   N0(REG3),BLANK      BLANK OUT 1ST 127 CHARACTERS  S21002 23600000
         MVC   N1(N126,REG3),N0(REG3)    OF ENTRY AREA           S21002 23700000
         MVC   N0(NA,REG3),N0(REG02) MOVE COMMAND IN ENTRY AREA  S21002 23800000
         MVC   N8(N1,REG3),DCMAID   MOVE AREA ID INTO COMMAND    S21002 23900000
         DROP  POINT                                             S21002 24000000
         B     COMMAND                                           S21002 24100000
         EJECT                                                          24200000
*****************************************************************       24300000
*    NOT OUT OF LINE: CHECK WHERE CURSOR IS                      S21002 24400000
CURSFIND EQU   *                                                        24500000
         SR    WORK,WORK           CLEAR REG                            24600000
         IC    WORK,DCMDSAV        GET LINE NUMBER OF DETECT            24700000
         MH    WORK,DCMCORLN       GET DISPLACEMENT INTO DCM     S21003 24800000
         L     LINE,DCMASCRN       GET FIRST LINE POINTER               24900000
         AR    LINE,WORK           LINE POINTS TO DCM LINE OF DETECT    25000000
         L     WORK,DCMLSCRN       POINT TO LAST LINE         MH        25100000
         CR    LINE,WORK           DETECT IN MESSAGE AREA     MH        25200000
         BNH   MSGDET               YES, HANDLE               MH        25300000
         L     WORK,DCMAINS        POINT TO INSTRUCTION LINE            25400000
         CR    LINE,WORK           DETECT IN INSTRUCTION LINE           25500000
         BE    INSLDET             YES HANDLE                           25600000
         BL    PFKEXIT             LOW, GO TO PFK1            MH        25700000
**                                                                   ** 25800000
*              ERROR CHECK DETECT                                     * 25900000
**                                                                   ** 26000000
ERROR    EQU   *                                              MH        26100000
         CLI   DCMIONDX,DEV2260    DEVICE A 2260              MH        26200000
         BNE   PENERROR            NO MUST BE LP - CURSOR ERR MH        26300000
         OI    DCMCMSG2,DCMMSGCR   INDICATE BAD CURSOR OP     MH        26400000
         OI    DCMIOCM1,DCMFULL    INDICATE WRITE FULL SCREEN           26500000
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               26600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 26700000
         BR    XFBRANCH            EXIT TO IEECVETD                     26800000
ENTDCT   EQU   *                                                        26900000
         CLI   DCMIONDX,DEV3277        IS THIS A 3277         MH S21003 27000000
         BE    ENT3277                  YES, SPECIAL CASE     MH S21003 27100000
         OI    DCMIOCM2,DCMIOCRD   PERFORM READ                         27200000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              27300000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 27400000
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         27500000
************ START OF DEVICE DEPENDANT CODE ****************  MH S21003 27600000
ENT3277  OI    DCMCOM1,DCMIOPRD        INDICATE READ          MH S21003 27700000
*                                         HAS BEEN PERFORMED  MH S21003 27800000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  27900000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 28000000
         BR    XFBRANCH            EXIT TO IEECVET1                     28100000
************ END OF DEVICE DEPENDENT CODE ******************  MH S21003 28200000
         EJECT                                                          28300000
**********************************************************************  28400000
**                                                                   ** 28500000
*              INSTRUCTION LINE DETECT                                * 28600000
**                                                                   ** 28700000
INSLDET  EQU   *                                                        28800000
         TM    DCMIOUNQ,DCMINNOR   INS LINE NORMAL                      28900000
         BO    NORMAL              YES   HANDLE                         29000000
         TM    DCMIOUNQ,DCMINERR   ERROR MSG IN INS LINE                29100000
         BO    ERRORIN             YES HANDLE                           29200000
         B     ERROR               NONE OF ABOVE ERROR                  29300000
NORMAL   EQU   *                                                        29400000
         CLI   DCMDSAV+N1,N38      DETECT OUTSIDE OF D C,K    MH  M2070 29500000
         BNL   ERROR               YES ERROR                            29600000
         CLI   DCMDSAV+1,N7        DETECT BELOW ENTER                   29700000
         BL    ERROR               YES ERROR                            29800000
         CLI   DCMDSAV+N1,N27      DETECT IN D C,K            MH  M2070 29900000
         BH    GODCK               YES GO TO D C,K RTN                  30000000
         CLI   DCMDSAV+N1,N16      DETECT IN CANCEL           MH  M2070 30100000
         BH    CANDETCT            YES HANDLE CANCEL                    30200000
         B     ENTDCT              NONE OF ABOVE MUST BE ENTER          30300000
ERRORIN  EQU   *                                                        30400000
         CLI   DCMDSAV+N1,N59      VALID DETECT                         30500000
         BL    ERROR               NO ERROR                             30600000
         CLI   DCMDSAV+N1,N65      DETECT IN CANCEL                     30700000
         BH    CANDETCT            YES HANDLE                           30800000
         B     ENTDCT              NO MUST BE ENTER                     30900000
GODCK    EQU   *                                                        31000000
         L     WORK,DCMAENTR       POINT TO ENTRY AREA                  31100000
         MVI   N0(WORK),BLANK      BLANK OUT 1ST 127 CHARACTERS  S21002 31200000
         MVC   N1(N126,WORK),N0(WORK)    OF ENTRY AREA           S21002 31300000
         MVC   N0(N5,WORK),DCK     MOVE DCK INTO ENTRY AREA             31400000
         B     COMMAND             SET UP TO GO TO COMMAND RTN   S21002 31500000
         EJECT                                                          31600000
CANDETCT EQU   *                                                        31700000
*    THIS CANCEL IS THE RESULT OF OPERATOR PRESSING CANCEL KEY   S21002 31800000
*    IT IS NOT AN OPTION TYPE OF CANCEL                          S21002 31900000
         OI    DCMCOM1,DCMCANCL    DETECTED ON CANCEL                   32000000
COMMAND  EQU   *                                                 S21002 32100000
         L     XFBRANCH,DCMNCMD1   LAOD COMMAND ROUTINE ADDRESS         32200000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 32300000
         BR    XFBRANCH            EXIT TO IEECVET4                     32400000
         SPACE 3                                                        32500000
PENERROR EQU   *                                                        32600000
         OI    DCMCMSG2,DCMCILLP   IND BAD L/P - CURSOR DET   MH  M2070 32700000
         L     XFBRANCH,DCMNMSG2   LOAD MESSAGE 2 ADDRESS               32800000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 32900000
         BR    XFBRANCH            EXIT TO IEECVETE                     33000000
PFKEXIT  OI    DCMIOCM3,DCMRDPFK  INDICATE PFK LINE HAS BEEN READS21003 33100000
         L     XFBRANCH,DCMNPFK1   LOAD PFK 1 ADDRESS                   33200000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 33300000
         BR    XFBRANCH            EXIT TO IEECVFTA                     33400000
         EJECT                                                          33500000
**********************************************************************  33600000
**                                                                   ** 33700000
*              MESSAGE AREA DETECT                                    * 33800000
**                                                                   ** 33900000
**********************************************************************  34000000
MSGDET   EQU   *                                                 S21002 34100000
         SR    POINT,POINT         CLEAR REG                     S21002 34200000
         IC    POINT,DCMDSAV        GET LINE NUMBER OF DETECT    S21002 34300000
         MH    POINT,DCMSCTCN       GET DISPLACEMENT INTO SCT    S21002 34400000
         A     POINT,DCMAMTAB       GET FIRST LINE POINTER       S21002 34500000
         TM    N1(POINT),DCMMSGCL  IS THIS CONTROL LINE OF MLWTO S21002 34600000
         BNO   NOMLWTO             NO--                          S21002 34700000
         CLI   DCMDSAV+N1,N67      DETECT ON *C OPTION           S21002 34800000
         BH    ERROR               ERROR- DETECTED ON AREA ID    S21002 34900000
*  THIS RTN WILL VERIFY LP DETECT ON *C OPTION OF IN-LINE MLWTO  S21002 35000000
         CLI   DCMDSAV+N1,N65      DETECT ON *C OPTION           S21002 35100000
         BL    NOMLWTO             NO--HANDLE AS ORDINARY DELETE S21002 35200000
*                                  YES-MOVE MLWTO CANCEL COMMAND S21002 35300000
LINEDETC EQU   *                                                 S21002 35400000
         SR    WORK,WORK           CLEAR REG                     S21002 35500000
         IC    WORK,DCMDSAV        LOAD LINE NO. OF DETECT       S21002 35600000
         MH    WORK,DCMCORLN       GET DISPLACEMENT INTO DCM     S21003 35700000
         A     WORK,DCMASCRN       ADD-PT TO FIRST LINE          S21002 35800000
         LA    WORK,N60(WORK)    WORK POINTS TO LINE DETECTED  @ZA17699 35900000
         LA    LINE,N60            SET UP LOOP CONTROL REG     @ZA17699 36000000
FINDIT   EQU   *                                                 S21002 36100000
         CLI   N0(WORK),BLANK      IS AREA ID FOUND IN CTRL LINE S21002 36200000
         BNE   MOVEID              YES-GO GET IT                 S21002 36300000
         BCTR  WORK,N0             DECR. POINTER                 S21002 36400000
         BCT   LINE,FINDIT         NO--DECREMENT PT AND LOOP     S21002 36500000
MOVEID   EQU   *                                                 S21002 36600000
         SH    WORK,TWO            MOVE PT TO START OF ID        S21002 36700000
         LR    LINE,WORK           SWITCH REGS                   S21002 36800000
         L     WORK,DCMAENTR       LOAD ENTRY ADDR               S21002 36900000
         MVI   N0(WORK),BLANK      BLANK OUT 1ST 127 CHARACTERS  S21002 37000000
         MVC   N1(N126,WORK),N0(WORK)    OF ENTRY AREA           S21002 37100000
         MVC   N0(N14,WORK),KCD    MOVE CANCEL INTO ENTRY AREA   S21002 37200000
         MVC   N6(N3,WORK),N0(LINE) MOVE INTO MSG AREA ID        S21002 37300000
         MVI   N12(WORK),Z    MOVE AREA ID INTO COMMAND          S21002 37400000
         B     COMMAND                                           S21002 37500000
*                                                                S21002 37600000
NOMLWTO  EQU   *                                                 S21002 37700000
         TM    N0(POINT),DCMMSGIN  IS THERE A MESSAGE IN THE LINE       37800000
         BNO   ERROR               NO ERROR                             37900000
         TM    N1(POINT),DCMMSGAC     ACTION MESSAGE                    38000000
         BNO   DELEXIT             NO GO TO DELETE                      38100000
         OI    DCMUTILT,DCMUTILA   TURN ON WTOR BIT                     38200000
         CLI   DCMDSAV+N1,N3       IS DETECT UNDER ASTERISK             38300000
         BE    DELEXIT             YES DELETE                           38400000
         TM    N0(POINT),DCMMSGRD  IS IT MARKED FOR DELETION            38500000
         BO    DEL4EXIT            YES MUST BE VERIFICATION             38600000
         B     ERROR               NO ERROR                             38700000
DELEXIT  EQU   *                                                        38800000
         CLI   DCMRQDEL,BLANK      DELETE REQUEST PENDING               38900000
         BE    SKIP                NO DONT VERIFY                       39000000
         SR    WORK,WORK           CLEAR REG                            39100000
         IC    WORK,DCMDSAV        GET LINE POINTER                     39200000
         LA    WORK,N1(WORK)       UP BY ONE                            39300000
         TM    N0(POINT),DCMMSGCN  IS MESSAGE LINE CONTINUED            39400000
         BNO   NOTCONT             NO DONT UP POINTER                   39500000
         LA    WORK,N1(WORK)       UP TO NEXT LINE                      39600000
NOTCONT  EQU   *                                                        39700000
         CVD   WORK,DCMPACK        UNPACK IT                            39800000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2) UNPACK TO EBCDIC         39900000
         OI    DCMCVBIN+N3,CF0     CONVERT SIGN TO EBCDIC               40000000
         CLI   DCMCVBIN+N2,CF0     IS FIRST NUMBER ZERO                 40100000
         BNE   NUMOK               NO DONY SHIFT IT                     40200000
         MVC   DCMCVBIN+N2(N1),DCMCVBIN+N3 MOVE NUMBER ONE LEFT         40300000
         MVI   DCMCVBIN+N3,BLANK   BLANK LAST POSITION                  40400000
NUMOK    EQU   *                                                        40500000
         TM    DCMUTILT,DCMUTILA    WAS DETECT ON A WTOR                40600000
         BO    WTORCOMP            YES HANDLE                           40700000
         MVC   DCMCVBIN(N2),ONECOMMA MOVE IN DELETE PREFIX              40800000
         CLC   DCMRQDEL+N2(N4),DCMCVBIN VERIFY DELETE REQUEST           40900000
         BE    DEL4EXIT            YES EXIT                             41000000
         B     SKIP                NO REGULAR DELETE                    41100000
WTORCOMP EQU   *                                                        41200000
         CLC   DCMRQDEL+N2(N2),DCMCVBIN+N2 VERIF DELETE REQUEST         41300000
         BE    DEL4EXIT                 YES EXUT                        41400000
SKIP     EQU   *                                                        41500000
         ST    LINE,DCMDSAV+N4     SAVE LINE ADDRESS                    41600000
         ST    POINT,DCMDSAV+N8    SAVE SCT ADDRESS                     41700000
         OI    DCMCOM1,DCMCOMRD    PERFORM DELETE                       41800000
         CLI   DCMCON,N            IS CON EQ N                          41900000
         BNE   DONTURN             NO DONT TURN O BIT                   42000000
         OI    DCMCOM1,DCMLPENT    INDICATE LIGHT PEN ENTER             42100000
DONTURN  EQU   *                                                        42200000
         L     XFBRANCH,DCMNDEL3   LOAD DELETE 3 ADDRESS                42300000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 42400000
         BR    XFBRANCH            EXIT TO IEECVET8                     42500000
DEL4EXIT EQU   *                                                        42600000
         L     XFBRANCH,DCMNDEL4   LOAD DELETE 4 ADDRESS                42700000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 42800000
         BR    XFBRANCH            EXIT TO IEECVET9                     42900000
         EJECT                                                          43000000
*********************************************************************** 43100000
TWO      DC    H'2'                CONSTANT                      S21003 43200000
ONECOMMA DC    C'1,'               CONSTANT                      S21003 43300000
DCK      DC    C'D C,K'            COMPARE FOR DCK DETECT               43400000
KCD      DC    C'K C,D,   ,L=  '   CANCEL COMMAND                S21002 43500000
PTA      DC    C'PT  A,L=  '       STOP TRACK COMMAND         MB Y02958 43600000
KDU      DC    C'K D,U,L=  '       UPDATE COMMAND                S21002 43700000
KDH      DC    C'K D,H,L=  '       HOLD COMMAND                  S21002 43800000
KED2     DC    C'K E,D,L=  '       ERASE COMMAND                 S21002 43900000
KDF2     DC    C'K D,F,L=  '       FORWARD PAGE COMMAND          S21002 44000000
         SPACE 2                                                        44100000
DEV2260  EQU   X'0C'               I/O ROUTINE INDEX FOR 2260           44200000
DEV3277  EQU   X'10'               I/O ROUTINE INDEX FOR 3277           44300000
*********************************************************************** 44400000
         EJECT                                                          44500000
*********************************************************************** 44600000
         IHACTM  CXSA                                                   44700000
         EJECT                                                          44800000
         IEERDCM                                                        44900000
         EJECT                                                          45000000
         IEETDCM                                                        45100000
         EJECT                                                          45200000
         IEECUCM  FORMAT=NEW                                            45300000
         END                                                            53000000
./  ADD  SSI=72930304,NAME=IEECVETG
IEECVETG CSECT                                                          00200000
* C (PJEXITC) APPROX. 250000  OPEN STATUS NOT SET              @ZA25731 00250003
* /* START OF SPECIFICATIONS ****                                       00400000
*02*  PROCESSOR = ASSEMBLER;                                            00600000
**** END OF SPECIFICATIONS ***/                                         00800000
         TITLE 'IEECVETG                OPEN-CLOSE'                     01000000
* STATUS       CHANGE LEVEL 1                                           01200000
*                                                                       01400000
*     APARS FIXED -- ZA02303,ZA02347,ZA16376,ZA25731                    01600003
*                                                                       01800000
* FUNCTION     THIS MODULE OPENS, AND LATER CLOSES, A UNIT DESIGNATED   02000000
*              AS A CONSOLE SUPPORT UNIT.                               02200000
*                                                                       02400000
* ENTRY POINT                                                    S21003 02600000
*     IEECVETG FOR ALL FUNTIONS.                                 S21003 02800000
*                                                                       03000000
* INPUT        R1 POINTS TO 40 BYTE SCRATCH PAD AREA(SVRB EXTENSION)    03200000
*              MAPPED BY MACRO =IEECVMUG CXSA=.                         03400000
*                                                                       03600000
* OUTPUT       FOR OPEN...  SUPPLIES OPENED DCB.                        03800000
*              FOR CLOSE..  CLOSES DCB AND FREES THE CORE.              04000000
*                                                                       04200000
* EXTERNAL REFERENCES NONE                                              04400000
*                                                                       04600000
* EXITS-NORMAL IEECVET1 PROCESSOR  AFTER OPEN                           04800000
*              IEECVETK TIMER-INTERPRETER  BEFORE CLOSE, IF DEL=R       05000000
*              IEECMDSV MCS DEVICE SERVICE  AFTER CLOSE                 05200000
*              IEECVFTG CLEANUP                                  S21003 05400000
*      -ERROR  NONE                                                     05600000
*                                                                       05800000
* TABLES/WORK AREAS  DISPLAY CONTROL MODULE (CONTAINED IN DSECT)        06000000
*                                                                       06200000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      06400000
*                                                                       06600000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      06800000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       07000000
*              CHARACTER SET.                                           07200000
*                                                                       07400000
*                                                                       07600000
*                                                                       07800000
R0       EQU   0        LOCAL SAVE REGISTER.                            08000000
R1       EQU   1        INTERFACE REGISTER.                             08200000
RXS      EQU   2        EXTENDED SVRB AREA PTR.                         08400000
RTB      EQU   3        SCRATCH.                                        08600000
RTC      EQU   4        SCRATCH.                                        08800000
RUCM     EQU   5                  UCM BASE REG                   S21003 09000000
RXI      EQU   6        INDEXING                                 S21003 09200000
RXE      EQU   7        INDEXING.                                       09400000
RP       EQU   8        OPEN CONTROL BLOCK BASE /UCM,EIL.               09600000
RI       EQU   9        ODD INDEXER.                                    09800000
RD       EQU   10       DATA CONTROL BLOCKS BASE.                       10000000
RU       EQU   11       UCM ENTRY BASE.                                 10200000
RBASE    EQU   12       PROGRAM BASE.                                   10400000
RDBASE   EQU   13       RES DCM BASE DURING CLOSE                S21003 10600000
RR       EQU   14       RETURN PT.                                      10800000
RPL      EQU   15       XCTL PARAMETER LIST PTR.                        11000000
X1PARM   EQU   1                                                        11200000
XFBRANCH EQU   15                                                       11400000
XERTRN   EQU   14                                                       11600000
         BALR  RBASE,N0                ESTABLISH PROG BASE REGISTER     11800000
         USING *,RBASE                                                  12000000
         B     BEGIN               BRANCH AROUND EYECATCHER             12200000
         DC    CL8'IEECVETG'       MODULE NAME                          12400000
         DC    XL2'4309'           JULIAN DATE LAST CHANGE  JE @ZA02303 12600000
         DC    CL8'&SYSDATE'        DATE LAST ASSEMBLY                  12800000
         DC    S(*)                                                     13000000
         DC    CL56' '             PATCH AREA                           13200000
BEGIN    EQU   *                                                        13400000
         LR    RXS,R1                                            S21003 13600000
         USING CXSA,RXS                                                 13800000
         L     RU,CSAUCM               UCM ENTRY PTR.                   14000000
         USING UCMLIST,RU                                               14200000
         L     RUCM,CSACTLM       UCM ADDRESS                    S21003 14400000
         USING UCM,RUCM                                          S21003 14600000
         L     RP,UCMXB                                                 14800000
         USING DCMTSRT,RP                                               15000000
         L     RP,DCMADTRN                                              15200000
         DROP  RP                                                       15400000
         USING DCMSTRT,RP                                               15600000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      15800000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    16000000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      16200000
         L     XFBRANCH,CSAXB      GETLOCK ADDRESS                      16400000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         16600000
         NI    UCMATR,N255-UCMAT04  TURN OFF STATUS CHANGE BIT          16800000
         SR    RTC,RTC                 CLEAR.                           17000000
         IC    RTC,CSACODE             ENTRY CODE.                      17200000
         MVI   CSACODE,N0                                               17400000
         B     *+N4(RTC)                FUNCTION SELECTION              17600000
         B     PJOPEN              0 - TO OPEN.               JE YM6718 17800000
         B     PJCLOSE             4 - TO CLOSE               JE YM6718 18000000
         B     OPENRCVY            8 - TO OPEN RECOVERY       JE YM6718 18200000
         B     PJEXITC             12 - TO CLOSE RECOVERY     JE YM6718 18400000
         EJECT                                                          18600000
*              CLOSE DEVICE                                             18800000
PJCLOSE  DS    0H                                             JE YM6718 19000000
         L     RI,UCMDCB                                                19200000
         LTR   RI,RI                                                    19400000
         BZ    PJEXITC                 NEVER WAS OPENED.                19600000
         CLI   DCMDEL,R            CONSOLE IN ROLL MODE                 19800000
         BNE   NOROLL              NO SKIP EXIT                         20000000
         OI    DCMTIMES,DCMOPTTI+CLOSERET TI RESET TIMER AND RETURN CLO 20200000
         L     XFBRANCH,DCMNTIMR   LOAD TIMER INTERPRETER ADDRESS       20400000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 20600000
         BR    XFBRANCH            EXIT TO IEECVETK                     20800000
NOROLL   EQU   *                                                        21000000
         USING IHADCB,RI                                                21200000
         MVI   DMX4,DMX4C          INDICATE END OF REMOTE PARM LIST     21400000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          21600000
         LR    X1PARM,RXS          CXSA ADDRESS IN REG 1                21800000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS FOR SVC'S              22000000
         LA    R1,DMX4                                                  22200000
         CLOSE   ((RI)),MF=(E,(1))                                      22400000
         SPACE                                                          22600000
*                                      PREPARE REMOTE LIST.             22800000
*                                      NO MORE DCB.                     23000000
         LR    R1,RI                                                    23200000
      FREEMAIN R,SP=255,LV=DMCORE,A=(1)                                 23400000
         DROP  RI                                                       23600000
PJEXITC  EQU   *                                                        23800000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           24000000
         LR    X1PARM,RXS          PASS CXSA ADDRESS IN REG 1           24200000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS TO RESET UCM            24400000
         XC    UCMECB,UCMECB           CLEAR ECB.                       24600000
         XC    UCMDCB,UCMDCB           CLEAR DCB PTR.                   24800000
         NI    UCMSTS,N255-UCMBF-UCMCF-UCMAF-UCMTA    NOT BUSY @ZA25731 25000003
*                                  CLOSED, NO ATTN, NOT OPEN   @ZA25731 25050003
         NI    UCMDEVC,N255-UCMDEVA-UCMDEVD    INDICATE SCREEN NOT FULL 25200000
*                                  AND NO DOM PENDING                   25400000
         L     RDBASE,UCMXB        RES DCM                  JE @ZA02303 25600000
         USING DCMTSRT,RDBASE                               JE @ZA02303 25800000
         NI    DCMRFLGS,N255-DCMDOM TURN OFF DOM DONE       JE @ZA02303 26000000
         DROP  RDBASE                                       JE @ZA02303 26200000
         SPACE                                                          26400000
         L     RTC,UCMUCB              GET TO ASSOCIATED UCB        MCS 26600000
         USING UCBOB,RTC                                                26800000
         TM    UCBSTAT,UCBCHGS                                          27000000
         BZ    DEVSTAT                                                  27200000
         NIL   UCBSTAT,N255-UCBONLI-UCBCHGS-UCBALOC-UCBSYSR-UCBDADI,REF*27400000
               =UCBOB                                                   27600000
         B     CONTINUE                                                 27800000
DEVSTAT  NIL   UCBSTAT,N255-UCBALOC-UCBSYSR-UCBDADI,REF=UCBOB           28000000
CONTINUE NI    UCMATR,N255-UCMAT04-UCMUF                                28200000
         L     RTC,UCBEXTPT        BASE FOR COMMON EXTENSION  MB YM4087 28400000
         USING UCBCMEXT,RTC        ADDRESSABILITY             MB YM4087 28600000
         MVC   UCBATI(N1),DCMATI   RESTORE ATTENTION INDEX    MB YM4087 28800000
         L     RTC,UCMUCB          BASE FOR UCB               MB YM4087 29000000
         USING UCBOB,RTC           ADDRESSABILITY TO UCB      MB YM4087 29200000
         XC    UCBSNS,UCBSNS       CLEAR SENSE INDICATORS     MB YM5671 29400000
         CLI   N19(RTC),TYP2250    IS DEVICE A 2250                     29600000
         BNE   THATSIT             NO WERE FINISHED                     29800000
         CLI   N16(RTC),MOD3       IS 2250 A MOD3                       30000000
         BNE   THATSIT             NO EXIT                              30200000
         SR    RI,RI                   CLEAR REG                        30400000
         L     RTB,DCMAWARN            GET WARNING LINE ADDRESS         30600000
         STH   RI,N76(RTB)             UPDATE BUFFER ADDRESS            30800000
         L     RTB,DCMBUFAD        POINT TO BUFFER ADDRESS TABLE        31000000
         LH    RXE,N0(RTB)         GET MOD 3 BUFFER ADDRESS             31200000
         LA    RTB,N10(RTB)       POINT TO LAST TABLE ENTRY      S21003 31400000
BUFFLOOP LH    RI,N0(RTB)         GET MOD 3 ADDRESS              S21003 31600000
         SR    RI,RXE             SUBTRACT TO RESET ADDRESS      S21003 31800000
         STH   RI,N0(RTB)         UPDATE ADDRESS                 S21003 32000000
         BCTR  RTB,N0             REDUCE POINTER                 S21003 32200000
         BCTR  RTB,N0                BY TWO                      S21003 32400000
         C     RTB,DCMBUFAD       IS THIS FIRST ENTRY            S21003 32600000
         BNL   BUFFLOOP            NO, UPDATE NEXT ENTRY         S21003 32800000
*                                  YES, CONTINUE                 S21003 33000000
         SPACE 2                                                 S21003 33200000
THATSIT  EQU   *                                                 S21003 33400000
         NI    UCMATR,N255-UCMUF        TURN OFF ACTIVE FLAG        MCS 33600000
         L     XFBRANCH,DCMNCLN    LOAD CLEANUP ADDRESS                 33800000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 34000000
         BR    XFBRANCH            EXIT TO IEECVFTG                     34200000
         DROP  RP                                                       34400000
         EJECT                                                          34600000
*                                                                       34800000
*                       OPEN 1052 FOR EXCP.                             35000000
*                                                                       35200000
PJOPEN   EQU   *                                                        35400000
         L     RTC,UCMUCB          GET UCB ADDRESS                      35600000
         TM    SRTESTAT,CONSL IS DEVICE IN ALLOCATION       JE @ZA02347 35800000
         BNO   GETOUT              RETURN DIRECTLY          JE @ZA02347 36000000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          36200000
         LR    X1PARM,RXS          CXSA ADDRESS IN REG 1                36400000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS FOR SVC'S              36600000
       GETMAIN R,SP=255,LV=DMCORE                                       36800000
         LR    RD,R1                                                    37000000
         MVC   N0(DMCORE,RD),DMDCB                                      37200000
         USING IHADCB,RD                                                37400000
*                                      RELOCATE POINTERS.               37600000
         ST    RD,UCMDCB               PT UCM AT BLOCKS.      JE YM6718 37800000
         SR    RXI,RXI                                                  38000000
         LA    RXE,DMIOB                                                38200000
         MVI   DMCREAD,N0            *** GRAPHICS BYTE                  38400000
         ST    RXE,DCBIOBAD                                             38600000
         ST    RD,DMIDCB                                                38800000
         LA    RXE,DMCNOP                                               39000000
         STCM  RXE,M7,DMCTRA+N1                                         39200000
         EJECT                                                          39400000
         GETMAIN R,SP=255,LV=PNCORE                                     39600000
         LR    RP,R1                   BASE OPEN BLOCKS.                39800000
         USING PNOPEND,RP                                               40000000
         XC    PNOPEND(PNCORE),PNOPEND                                  40200000
         SR    R1,R1               CLEAR FOR IC INSTRUCTION             40400000
         IC    R1,UCMID            GET CONSOLE I.D. IN BINARY           40600000
         CVD   R1,PNWORKD          CONVERT TO PACKED DECIMAL            40800000
         UNPK  PNWORKD(N5),PNWORKH4(N3)                                 41000000
         MVC   DCBDDNAM(L'BASENAM),BASENAM CONSTANT PART OF DDNAME      41200000
         MVC   DCBDDNAM+L'BASENAM(N3),PNWORKD REST OF NAME              41400000
         MVC   JFCBDSNM(L'PNDSN),PNDSN                                  41600000
         MVC   JFCBDSNM+8(36),JFCBDSNM+7                                41800000
         OI    JFCBTSDM,JFCTTR+JFCNWRIT+JFCNDSCB+JFCNDCB+JFCPAT         42000000
         LA    RTB,JFCB                                                 42200000
         STCM  RTB,M7,PNXLST+N1                                         42400000
         OI    PNXLST,LASTNTRY+EXITJFCB                                 42600000
         LA    RTB,PNXLST                                               42800000
         STCM  RTB,M7,DCBEXLST+N1                                       43000000
         OI    PNJEF,LASTNTRY      END OF OPEN-J LIST         MB YM3194 43200000
         EJECT                                                          43400000
         OPEN  ((RD),INOUT),TYPE=J,MF=(E,PNJEF)                         43600000
         LR    R1,RP                        OPEN BLOCKS PTR.            43800000
         FREEMAIN R,SP=255,LV=PNCORE,A=(1)                              44000000
         DROP  RP                                                       44200000
OPNRECV  DS    0H                                             JE YM6718 44400000
         XC    DCBEXLST+N1(N3),DCBEXLST+N1                              44600000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           44800000
         LR    X1PARM,RXS          PASS CXSA ADDRESS IN REG 1           45000000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS TO RESET UCM            45200000
         L     RDBASE,UCMXB        RES DCM                              45400000
         USING DCMTSRT,RDBASE                                           45600000
         L     RDBASE,DCMADTRN     PAGEABLE DCM                         45800000
         DROP  RDBASE                                                   46000000
         USING DCMSTRT,RDBASE                                           46200000
         L     RTC,UCBEXTPT        UCB COMMON EXTENSION       MB YM4087 46400000
         USING UCBCMEXT,RTC        ADDRESSABILITY             MB YM4087 46600000
         MVC   DCMATI(N1),UCBATI   SAVE ATTENTION INDEX       MB YM4087 46800000
         MVI   UCBATI,X04          COMM TASK ATTN HANDLER     MB YM4087 47000000
         L     RTC,UCMUCB          RESET UCB BASE             MB YM4087 47200000
         USING UCBOB,RTC           AND ADDRESSABILITY         MB YM4087 47400000
         XC    UCBSNS,UCBSNS       CLEAR SENSE INDICATORS     MB YM5671 47600000
         MVI   DCBIFLGS,N0           USE STD ERP                  MCS   47800000
         OI    UCMATR,UCMUF            TURN ON ACTIVE BIT           MCS 48000000
         NI    UCMSTS,N255-UCMTA   TURN OFF OPEN PENDING                48200000
         SR    XFBRANCH,XFBRANCH   CLEAR REG                            48400000
         IC    XFBRANCH,DCMIONDX   GET IO ROUTINE CODE                  48600000
         L     XFBRANCH,IOTAB(XFBRANCH) ADDRESS IO ROUTINE              48800000
         ST    XFBRANCH,DCMIORTN   PUT IT IN DCM                        49000000
         MVC   DCMNPRZ(TABLEN),TABLE MOVE IN ADCON TABLE                49200000
         L     RP,DCMADCHP         GET CHANNEL PROGRAM ADDRESS   S21003 49400000
         ST    RP,DMICPA           POINT IOB AT CHANNEL PROGRAM         49600000
         ST    RU,DMIECBP              PT IOB AT ECB.                   49800000
*                            PT WAIT AT ECB THRU EIL.                   50000000
         SPACE                                                          50200000
*                      TWO LINES                               @ZA16376 50400000
*                                  DELETED HERE                @ZA16376 50600000
         SPACE                                                          50800000
         LR    RPL,RUCM            PTR TO MCS PREFIX TO UCM IS @ZA16376 51000000
         SH    RPL,FOUR            FOUR BYTES BEFORE THE UCM            51200000
         L     RPL,N0(RPL)             GET PTR TO PREFIX                51400000
         USING UCMPRFX,RPL                                              51600000
         TM    UCMSFLG2,UCMSYSL        IS AUTO SWITCH REQUESTING OPEN   51800000
         DROP  RPL                                                      52000000
         BNO   NONROUTR                NO, RETURN TO RPOC MODULE        52200000
         TM    DCBOFLGS,DCBOFOPN   DID DCB OPEN               JE YM6718 52400000
         BO    NONROUTR            YES, CONTINUE              JE YM6718 52600000
EXIT2    LR    X1PARM,RXS          PASS CXSA ADDRESS IN REG 1 MB YM4087 52800000
         L     XFBRANCH,CSAXC      FREELOCK ADDRESS           MB YM4087 53000000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS TO SWITCH    MB YM4087 53200000
         ICM   RTC,15,CSANPTR      GET RECOVERY AREA          JE YM6718 53400000
         BZ    NOESTAE1            NOT THERE, BYPASS NSI      JE YM6718 53600000
         MVC   PARMRTAD-PARMLIST(8,RTC),CSANAME RESTORE       JE YM6718 53800000
NOESTAE1 DS    0H                                             JE YM6718 54000000
         MVI   CSACODE,CSASWTCH    SET CONSOLE SWITCH         JE YM6718 54200000
         MVC   CSANAME+N3(N2),PMXTRNL  ADJUST CSA NAME                  54400000
         L     XFBRANCH,UCMSWCH    GET CONSOLE SWITCH ENTRY ADDR        54600000
EXIT     EQU   *                                              MB YM4087 54800000
         L     XERTRN,CSAXA        PROVIDE RETURN ADDRESS               55000000
         LR    X1PARM,RXS          ALSO, CXSA ADDRESS                   55200000
         NI    DCMMCSST,X'FF'-DCMDUSE DIDOCS NOT IN CONTROL             55400000
         BR    XFBRANCH            EXIT TO CONSOLE SWITCH               55600000
NONROUTR EQU   *                                                        55800000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  56000000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 56200000
         BR    XFBRANCH            EXIT TO IEECVET1                     56400000
GETOUT   LR    RDBASE,RP           SET DCM BASE               MB YM4087 56600000
         ICM   RTC,15,CSANPTR      GET RECOVERY AREA          JE YM6718 56800000
         BZ    NOESTAE2            NOT THERE, BYPASS NSI      JE YM6718 57000000
         MVC   PARMRTAD-PARMLIST(8,RTC),CSANAME RESTORE       JE YM6718 57200000
NOESTAE2 DS    0H                                             JE YM6718 57400000
         L     XFBRANCH,CSAXC      FREELOCK ADDRESS           MB YM4087 57600000
         B     EXIT                RELEASE LOCKS AND LEAVE    MB YM4087 57800000
*                                                                       58000000
OPENRCVY DS    0H                                             JE YM6718 58200000
         ICM   RD,15,UCMDCB        GET DCB FROM UCM           JE YM6718 58400000
         BZ    EXIT2               NEVER THERE, GET OUT       JE YM6718 58600000
         B     OPNRECV             THERE, GO RECOVER          JE YM6718 58800000
*                                                                       59000000
*        EQUATES                                                        59200000
*                                                                       59400000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            59600000
ID2      EQU   C'G'                2ND CHARACTER OF CSECT ID            59800000
M7       EQU   7                   STORE CHARACTER MASK                 60000000
X04      EQU   X'04'               04 F/R ATTENTION TABLE               60200000
X80      EQU   X'80'               UCB STATUS BIT                       60400000
XF0      EQU   X'F0'                                                    60600000
CONSL    EQU   X'02'               UCB STATUS BIT           JE @ZA02347 60800000
MOD3     EQU   X'33'               MOD 3 MASK                           61000000
P        EQU   C'P'                CONSTANT                             61200000
R        EQU   C'R'                ROLL MODE INDICATOR                  61400000
C6       EQU   C'6'               PROC 0 NAME CHARACTER          S21003 61600000
CLOSERET EQU   2                   TIMER INT RETURN TO CLOSE            61800000
OPENBIT  EQU   X'10'                   INDIC. OPEN FOR AUTO SWITCH      62000000
N0       EQU   0                        NUMBER                          62200000
N1       EQU   1                        NUMBER                          62400000
N2       EQU   2                   NUMBER                               62600000
N3       EQU   3                        NUMBER                          62800000
N4       EQU   4                        NUMBER                          63000000
N5       EQU   5                                                        63200000
N6       EQU   6                                                        63400000
N8       EQU   8                        NUMBER                          63600000
N9       EQU   9                        NUMBER                          63800000
N10      EQU   10                  NUMBER                               64000000
N11      EQU   11                  FIELD INCREMENT                      64200000
N12      EQU   12                       NUMBER                          64400000
N16      EQU   16                  CONSTANT                             64600000
N19      EQU   19                                                       64800000
N22      EQU   22                  UCB SENSE DISPLACEMENT     MH Y02173 65000000
N23      EQU   23                  UCB DISPLACEMENT           ME S21003 65200000
N44      EQU   44                       NUMBER                          65400000
N76      EQU   76                      NUMBER                           65600000
N176     EQU   176                      NUMBER                          65800000
N255     EQU   255                      NUMBER                          66000000
TYP2250  EQU   2                                                        66200000
LASTNTRY EQU   X'80'                    END OF LIST BIT                 66400000
EXITJFCB EQU   X'07'               JFCB EXIT LIST FLAGS                 66600000
RECOVBIT EQU   X'0C'                    LOCAL ERROR RECOVERY            66800000
TERMBIT  EQU   X'80'                    TERMINAL FLAG CLOSE             67000000
REWRSTOP EQU   X'FF'                    REWRITE STOP                    67200000
CVTPTR   EQU   16                      LOCATION OF CVT POINTER          67400000
CVTTCBP  EQU   0                       ADDR OF A DOUBLE WORD, THE FIRST 67600000
*                            CONTAINING THE NEXT-TO BE- DISPATCHED TCB  67800000
*                            ADDR, THE SECOND CONTAINING THE CURRENT    68000000
*                            TCB ADDR                                   68200000
FOUR     DC    H'4'                    NUMBER                           68400000
         DS    0F                                                       68600000
IOTAB    EQU   *-4                                                      68800000
         DC    V(IEECVETH)         3066 ROUTINE, IOTAB+4                69000000
         DC    V(IEECVETP)         2250 ROUTINE, IOTAB+8                69200000
         DC    V(IEECVETR)         2260 ROUTINE, IOTAB+12               69400000
         DC    V(IEECVETU)         3277 ROUTINE, IOTAB+16               69600000
TABLE    EQU   *                   ADCON TABLE                          69800000
         DC    V(IEECVFT1)                                              70000000
         DC    V(IEECVET1)                                              70200000
         DC    V(IEECVET2)                                              70400000
         DC    V(IEECVET3)                                              70600000
         DC    V(IEECVFT2)                                              70800000
         DC    V(IEECVET4)                                              71000000
         DC    V(IEECVET6)                                              71200000
         DC    V(IEECVET7)                                              71400000
         DC    V(IEECVET8)                                              71600000
         DC    V(IEECVET9)                                              71800000
         DC    V(IEECVETA)                                              72000000
         DC    V(IEECVFTA)                                              72200000
         DC    V(IEECVFTB)                                              72400000
         DC    V(IEECVETC)                                              72600000
         DC    V(IEECVETD)                                              72800000
         DC    V(IEECVETE)                                              73000000
         DC    V(IEECVFTD)                                              73200000
         DC    V(IEECVETF)                                              73400000
         DC    V(IEECVETG)                                              73600000
         DC    V(IEECVFTG)                                              73800000
         DC    V(IEECVETJ)                                              74000000
         DC    V(IEECVETK)                                              74200000
         DC    V(IEECVFTL)                                              74400000
         DC    V(IEECVFTM)                                              74600000
         DC    V(IEECVFTN)                                              74800000
         DC    V(IEECVFTO)                                              75000000
         DC    V(IEECVFTP)                                              75200000
         DC    V(IEECVFTQ)                                              75400000
         DC    V(IEECVFTT)                                              75600000
TABLEN   EQU   *-TABLE                                                  75800000
BASENAM  DC    C'IEAVM'            CONSTANT PART OF CONSOLE DDNAME      76000000
PMXTRNL  DC    CL2'04'             EXTERNAL PROCESSOR NAME.             76200000
PNDSN    DC    C'CONSOLE '         DSNAME FOR JFCB                      76400000
         DS    0D                  ALIGN TO DOUBLE WORD                 76600000
         TITLE 'PN  DATA CONTROL BLOCKS'                                76800000
         IEEUCDX                                                        77000000
         TITLE 'PJ OPEN-JFCB'                                           77200000
*                       DEFINITION OF DYNAMIC CORE FOR CONSOLE OPEN,    77400000
PNOPEND  DSECT                                                          77600000
JFCB     DS    0D                                                       77800000
         IEFJFCBN ,                                                     78000000
*                            OPENJ E-FORM SLOT.                         78200000
PNJEF    DC    X'80'              LAST ENTRY.                           78400000
         DC    AL3(0)             DCB PTR.                              78600000
         SPACE                                                          78800000
*                            OPENJ JFCB EXLST PTR.                      79000000
PNXLST   DC    X'87'              LAST ENTRY AND JFCB 07 CODE.          79200000
         DC    AL3(0)                   JFCB PTR. DCBEXLST PTS HERE.    79400000
PNWORKD  DC    D'0'                DOUBLE WORD FOR CVD                  79600000
         ORG   PNWORKD+6                                                79800000
PNWORKH4 DC    H'0'                LAST HALFWORD                        80000000
PNWORKX  DC    X'0'                EXTRA BYTE FOR UNPK                  80200000
PNCORE   EQU   *-PNOPEND            DYNAMIC CORE REQIREMENT.            80400000
         EJECT                                                          80600000
         IHACTM FTPT                                          JE YM6718 80800000
         TITLE 'IEECVETG    OPEN/CLOSE   UCB'                           81000000
UCBD     DSECT                                                          81200000
         IEFUCBOB                                                       81400000
         TITLE 'IEECVETG    OPEN/CLOSE   CXSA'                          81600000
         IHACTM  CXSA                                                   81800000
         TITLE 'IEECVETG    OPEN/CLOSE   RESIDENT DCM'                  82000000
         IEERDCM                                                        82200000
         TITLE 'IEECVETG    OPEN/CLOSE   PAGEABLE DCM'                  82400000
         IEETDCM                                                        82600000
         TITLE 'PJ UCM'                                                 82800000
         IEECUCM  FORMAT=NEW                                            83000000
         END                                                            83200000
./  ADD  SSI=41200996,NAME=IEECVETH
IEECVETH CSECT                                                          00050000
*C192460                                                      MH YM2592 00050403
*A191700                                                      MH Y01563 00052003
*C 193405                                                    ME SA52709 00060018
*A057100-057200                                              MC SA51393 00100000
         TITLE 'IEECVETH IGC5H07B MODEL 168 CONSOLE IO'                 00500003
*                                                                     * 00550000
* STATUS       CHANGE LEVEL=0                                         * 00600000
*                                                                     * 00650000
* FUNCTION     ANALYZE COMMUNICATIONS BYTES AND PERFORM REQUESTED     * 00700000
*              I/O. RETURN INDICATION THAT I/O IS IN PROGRESS         * 00750000
*                                                                     * 00800000
* INPUT        BITS SET IN DISPLAY CONTROL MODULE                     * 00850000
*                                                                     * 00900000
* OUTPUT       I/O OPERATION PERFORMED                                * 00950000
*                                                                     * 01000000
* EXTERNAL REFERENCES NONE                                              01050000
*                                                                       01100000
* EXITS - NORMAL IEECVET1 PROCESSOR ROUTINE, AFTER IO IS INITIATED      01150000
*                IEECVETF LIGHT PEN-CURSOR                              01200000
*       - ERROR  NONE                                                   01250000
*                                                                       01300000
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         01350000
*                                                                       01400000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      01450000
*                                                                       01500000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      01550000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       01600000
*              CHARACTER SET.                                           01650000
*                                                                     * 01700000
         EJECT                                                          01750000
**                                                                   ** 01800000
*              INITIALIZE PROGRAM                                     * 01850000
**                                                                   ** 01900000
         BALR  PBASE,N0            SET UP                               01950000
         USING *,PBASE             ADDRESSABILITY                       02000000
         B     ICATCH              BRANCH AROUND EYECATCHER      S21003 02050000
         DC    C'   MODULE IGC5H07B, FICHE IEECVETH  ' EYECATCHERS21003 02100000
ZAPAREA  DC    12C'ZAP'     AND RESERVED FOR FIELD MODIFICATIONS S21003 02150000
ICATCH   LR    PXSA,PARM           SAVE CXSA ADDRESS             S21003 02200000
         USING CXSA,PXSA           DECLARE CXSA ADDRESS                 02250000
         L     UCMENTRY,CSAUCM     GET UCM ENTRY ADDRESS                02350000
         USING UCMLIST,UCMENTRY    DECLARE UCMENTRY BASE                02400000
         L     RDCMBASE,UCMXB      GET DCM POINTER               S21003 02450000
         USING DCMTSRT,RDCMBASE                                         02500000
         L     DCMBASE,DCMADTRN    LOAD T DCM BASE               S21003 02550000
         USING DCMSTRT,DCMBASE       DECLARE DCM BASE                   02600000
         L     UCMBASE,CSACTLM     GET UCM POINTER                      02650000
         USING UCM,UCMBASE         DECLARE UCM BASE                     02700000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      02750000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    02760000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      02770000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          02780000
         LR    X1PARM,PXSA         PASS CXSA ADDRESS IN REG 1           02790000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        02792000
         L     X8,DCMADCHP         POINT TO CHANNEL PROGRAM             02800000
         XC    N0(N104,X8),N0(X8)  CLEAR CHANNEL PROGRAM AREA           02850000
         EJECT                                                          02900000
**                                                                   ** 02950000
*                   TEST REASON FOR MODULE ENTRY                      * 03000000
**                                                                   ** 03050000
         TM    DCMR3FLG,DCMSTSWT   IS STATUS SWITCH BIT ON       S21003 03100000
         BNO   RMI                  NO, TEST NEXT FUNCTION       S21003 03150000
         NI    DCMR3FLG,X'FF'-DCMSTSWT   YES, TURN IT OFF        S21003 03200000
         L     XFBRANCH,DCMNCLN    LOAD CLEANUP ROUTINE ADDRESS         03250000
         B     EXIT2               EXIT TO IEECVFTG                     03350000
         SPACE 3                                                 S21003 03400000
RMI      TM    DCMIOCM1,DCMDORMI   ENTRY FOR RMI                 S21003 03450000
         BO    PERFRMI             YES PERFORM RMI                      03500000
         B     OUTPTMSG            NO WRITE MUST BE DONE                03550000
         EJECT                                                          03600000
**                                                                   ** 03650000
*                     EXIT PROCEEDURE                                 * 03700000
**                                                                   ** 03750000
EXIT     EQU   *                                                        03800000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  03810000
*                                  FOR EXIT TO IEECVET1                 03820000
         MVI   DCMIOCM1,N0         ZERO IO BYTE 1                       03850000
         MVC   DCMIOCM1+N1(N2),DCMIOCM1 ZERO IO BYTES 2 AND 3           03900000
EXIT2    EQU   *                                                        03950000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 04000000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             04050000
         EJECT                                                          04150000
**                                                                   ** 04200000
*                   SET UP FOR RMI, RMI, INSERT CURS,SET BUF,READ     * 04250000
**                                                                   ** 04300000
PERFRMI  EQU   *                                                        04350000
         NI    DCMIOCM1,N255-DCMDORMI TURN OFF BIT TO INDICATE RMI      04400000
         OI    DCMCOM1,DCMCOMRM    INDICATE RMI HAS BEEN PERFORMED      04450000
         LA    WORK,DCMDSAV        POINT TO RMI READ AREA               04500000
         ST    WORK,DCMCHPGM       PUT ADDRESS IN CHANNEL PROGRAM       04550000
         MVI   DCMCHPGM,RMICODE    PUT RMI CODE INTO CHANNEL PROG       04600000
         MVI   DCMCHPGM+N4,CHAIN   CHAIN THIS CCW                       04650000
         MVI   DCMCHPGM+N7,N3      PUT BYTE COUNT IN                    04700000
         LA    WORK,DCMBAENT       GET INSERT CURSOR ADDRESS            04750000
         ST    WORK,DCMCHPGM+N8    PUT IT INTO CCW CHAIN                04800000
         MVI   DCMCHPGM+N8,INSERT  PUT INSERT CURSOR COMMAND CODE INCCW 04850000
         MVI   DCMCHPGM+N12,CHAIN  CHAIN CCWS                           04900000
         MVI   DCMCHPGM+N15,N2     PUT BYTE COUNT IN                    04950000
         ST    WORK,DCMCHPGM+N16   PUT ENTRY AREA BUF ADDR INTO SET BUF 05000000
         MVI   DCMCHPGM+N16,SETBUF PUT SET BUF CODE INTO CCW            05050000
         MVI   DCMCHPGM+N20,CHAIN  CHAIN CCWS                           05100000
         MVI   DCMCHPGM+N23,N2     PUT BYTE COUNT IN                    05150000
         LA    WORK,DCMENTRY       POINT TO ENTRY AREA                  05200000
         ST    WORK,DCMCHPGM+N24   SAVE IT IN READ CCW                  05250000
         MVI   DCMCHPGM+N24,READ   PUT READ CODE INTO CCW               05300000
         MVI   DCMCHPGM+N28,STOP   PUT END OF CHAIN INTO CCW            05350000
         MVI   DCMCHPGM+N31,READLGNH PUT LENGTH OF READ INTO CCW        05400000
         B     EXCP                EXECUTE CHANNEL PROGRAM              05450000
         EJECT                                                          05500000
**                                                                   ** 05550000
*              SET UP TO EXECUTE CHANNEL PROGRAM                      * 05600000
**                                                                   ** 05650000
EXCP1    EQU   *                                                        05700000
         C     CPGMREG,DCMADCHP    HAVE CCW'S BEEN BUILT     MC SA51393 05710000
         BE    EXIT                NO, BRANCH TO EXIT        MC SA51393 05720000
         SH    CPGMREG,EIGHT                                            05750000
         MVI   N4(CPGMREG),STOP    STOP CCW DHAIN                       05800000
EXCP     EQU   *                                                        05850000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBR       JE YM8371 05860003
         LR    X1PARM,PXSA         PASS CXSA ADDRESS IN REG 1 JE YM8371 05870003
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS              JE YM8371  05880003
         XC    UCMECB,UCMECB         CLEAR ECB                          05950003
         OI    UCMSTS,UCMBF        TURN ON  BUSY BIT                    05960003
         L     WORK,UCMDCB         GET DCB ADDRESS                      06000000
         L     WORK,N28(WORK)      GET IOB ADDRESS                      06050000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBR      JE YM8371 06100003
         LR    X1PARM,PXSA         PASS CXSA ADDRESS IN REG 1 JE YM8371 06150003
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS              JE YM8371 06160003
         EXCP  (WORK)              INITIATE IO                          06200000
         B     EXIT                EXIT FROM RTN                        06250000
         EJECT                                                          06300000
**                                                                   ** 06350000
*                        OUTPUT MESSAGES - TEST FOR TYPE              * 06400000
**                                                                   ** 06450000
OUTPTMSG EQU   *                                                        06500000
         TM    DCMIOCM2,DCMERASE   ERASE SCREEN                         06550000
         BO    DOERASE             YES EXIT                             06600000
         TM    DCMIOCM2,DCMWINFD   WRITE INFORMATIONAL DISPLAY          06650000
         BO    WRITEID             YES WRITE INFO DISP                  06700000
FULLWRIT EQU   *                                                        06750000
         TM    DCMIOCM1,DCMWRMSG   WRITE FULL MSG AREA                  06800000
         BO    WRITEFUL            YES DO IT                            06850000
         TM    DCMIOCM1,DCMWRPAR   WRITE PARTIAL MSG AREA               06900000
         BO    WRITEPAR            YES BUILD CCWS                       06950000
RITEREST EQU   *                                                        07000000
         TM    DCMCMSG1,DCMMSGWT   MESSAGE WAITING                      07050000
         BO    WRTMSGWT            YES WRITE IT TO WARNING LINE         07100000
BLNKINST EQU   *                                                        07150000
         TM    DCMIOCM2,DCMINSSH   BLANK INSTRUCTION LINE               07200000
         BO    BLINS               YES BLANK IT                         07250000
WRINS    EQU   *                                                        07300000
         TM    DCMIOCM1,DCMWRINS   WRITE INSTRUCTION LINE               07350000
         BO    INSLWRIT            YES WRITE IT                         07400000
WRENT    EQU   *                                                        07450000
         TM    DCMIOCM1,DCMWRENT   WRITE ENTRY AREA                     07500000
         BO    ENTRWRIT            YES WRITE IT                         07550000
WRITWARN EQU   *                                                        07600000
         TM    DCMIOCM1,DCMWRWRN   WRITE WARNING LINE                   07650000
         BO    WARNWRIT            DO IT                                07700000
INSERTC  EQU   *                                                        07750000
         TM    DCMIOCM1,DCMINSC    INSERT CURSOR                        07800000
         BO    BUILDINS            YES BUILD CCWS                       07850000
SOUNDALM EQU   *                                                        07900000
         TM    DCMIOCM1,DCMSOUND   SOUND ALARM                          07950000
         BO    BUILDSND            YES BUILD CCWS                       08000000
TESTBLNK EQU   *                                                        08050000
         TM    DCMIOCM2,DCMBLENT   BLANK ENTRY AREA                     08100000
         BO    ENTRYBNK            YES DO IT                            08150000
LEFTWARN EQU   *                                                        08200000
         TM    DCMIOCM2,DCMBLWRL   BLANK LEFT HALF WARNING LINE         08250000
         BO    BLANKLFT            YES DO IT                            08300000
RITEWARN EQU   *                                                        08350000
         TM    DCMIOCM2,DCMBLWRR   BLANK RIGHT HALF WARNING LINE        08400000
         BO    BLNKRIGT            YES DO IT                            08450000
         B     EXCP1               INITIATE I/O                         08500000
         EJECT                                                          08550000
**                                                                   ** 08600000
*                   BUILD ERASE DISPLAY CCW                           * 08650000
**                                                                   ** 08700000
DOERASE  EQU   *                                                     ** 08750000
         MVI   N0(X8),ERASE        MOVE ERASE COMMAND CODE IN           08800000
         MVI   N4(X8),STOP         MOVE IN STOP BIT                     08850000
         MVI   N7(X8),N2           MOVE IN BYTE COUNT                   08900000
         NI    DCMIOCM2,N255-DCMERASE TURN OFF ERASE BIT                08950000
         TM    DCMIOCM2,DCMWRASY   WRITE ASYN ERROR MESSAGE             09000000
         BNO   EXCP                NO DO IO                             09050000
         MVI   N4(X8),CHAIN        CHAIN ERASE TO WRITE                 09100000
         SR    WORK,WORK           ZERO REG                             09150000
         STH   WORK,DCMBADLN       CLEAR BUFFER ADDRESS POINTER         09200000
         MVI   DCMBADLN,X14        STORE LINE POINTER                   09250000
         LA    X8,N8(X8)             UP CHANNEL PGM POINTER             09300000
         LA    POINT,DCMBADLN      PRIME PARAMETER REG                  09350000
         BAL   RETURN,BUILDSET     BUILD SET BUFFER CCW                 09400000
         L     HOLD,DCMAENTR       POINT TO ENTRY AREA                  09450000
         LH    WORK,DCMCORLN       LENGTH OF ONE LINE            S21003 09500000
         SLL   WORK,N1             DOUBLE IT                            09550000
         BAL   RETURN,BUILDWRT     BUILD WRITE CCW                      09600000
         NI    DCMIOCM1,N255-DCMWRASY   TURN OFF ASYN ERROR BIT         09650000
         NI    DCMIOCM2,N255-DCMBLENT  TURN OFF BLANK ENTRY AREA BIT    09700000
         LA    WORK,DCMBADLN       POINT TO ADDRESS INSERT CURSOR       09750000
         ST    WORK,N0(X8)         SAVE IT IN CHANNEL PROGRAM           09800000
         MVI   N0(X8),INSERT       PUT INSERT CURSOR CC IN              09850000
         MVI   N4(X8),CHAIN        CHAIN CCWS                           09900000
         MVI   N7(X8),N2           TWO BYTES TRANSFERRED                09950000
         LA    X8,N8(X8)           UP CCW POINTER                       10000000
         B     BUILDSND            BUILD SOUND ALARM CCW                10050000
         EJECT                                                          10100000
**                                                                   ** 10150000
*              THIS CODING WRITES THE INFORMATIONAL DISPLAY           * 10200000
WRITEID  EQU   *                                                        10250000
         SR    WORK,WORK           CLEAR WORK REG                       10300000
         STH   WORK,DCMBADLN       CLEAR BUFFER ADDRESS AREA            10350000
         IC    WORK,DCMLINEN       GET LINE NUMBER TO WRITE FROM        10400000
         BCTR  WORK,N0             DECREMENT BY ONE                     10450000
         STC   WORK,DCMBADLN       HOLD IT IN BUFFER ADDRESS AREA       10500000
         LA    POINT,DCMBADLN      POINT TO BUFFER ADDRESS AREA         10550000
         BAL   RETURN,BUILDSET     BUILD SET BUFFER CCW                 10600000
         LH    WORK,DCMBYTCT       GET LENGTH OF WRITE                  10650000
         LA    HOLD,DCMINSTR       GET START OF WRITE                   10700000
         BAL   RETURN,BUILDWRT     BUILD WRITE CCW                      10750000
         NI    DCMIOCM2,N255-DCMWINFD TURN OFF INFO DISP BITS           10800000
         B     FULLWRIT            SEE IF MORE IO TO DO                 10850000
         EJECT                                                          10900000
**                                                                   ** 10950000
*              WRITE FULL OR PARTIAL MESSAGE AREA                     * 11000000
**                                                                   ** 11050000
WRITEFUL EQU   *                                                        11100000
         NI    DCMIOCM1,N255-DCMWRMSG TURN OFF FULL WRITE BIT           11150000
         CLC   DCMWTBUF(N4),DCMASCRN   WILL LENGTH BE ZERO    MG A48089 11160000
         BE    RITEREST            YES, SEE WHAT ELSE TO DO   MG A48089 11170000
         LA    POINT,DCMBAM1       GET POINTER TO SCREEN IMAGE BUFFER   11200000
         BAL   RETURN,BUILDSET     BUILD SET BUFFER CCW                 11250000
         L     WORK,DCMWTBUF       POINT TO START OF INFO DISP IF ANY   11300000
         L     HOLD,DCMASCRN       POINT TO START OF MESSAGE AREA       11350000
         SR    WORK,HOLD           GET WRITE LENGTH                     11400000
         BAL   RETURN,BUILDWRT     BUILD WRITE CCWS                     11450000
         B     RITEREST            SEE IF ANYTHING ELSE TO BR WRITTEN   11500000
WRITEPAR EQU   *                                                        11550000
         NI    DCMIOCM1,N255-DCMWRPAR TURN OFF PARTIAL WRITE FLAG       11600000
         SR    WORK,WORK           CLEAR WORK REG                       11650000
         STH   WORK,DCMBADLN       CLEAR BUFFER ADDRESS REG             11700000
         IC    WORK,DCMLINEN       GET LINE NO                          11750000
         BCTR  WORK,N0             DECREMENT BY ONE                     11800000
         STC   WORK,DCMBADLN       SAVE IT IN BUFFER ADDR WORD          11850000
         LA    POINT,DCMBADLN      GET POINTER IN REG                   11900000
         BAL   RETURN,BUILDSET     GO BUILD SET BUFFER CCW              11950000
         L     HOLD,DCMASCRN       POINT TO START OF MSG AREA           12000000
         MH    WORK,DCMCORLN       GET INDEX                     S21003 12050000
         AR    HOLD,WORK           POINT TO LINE TO WRITE FROM          12100000
         LH    WORK,DCMBYTCT       GET WRITE LENGTH                     12150000
         BAL   RETURN,BUILDWRT     BUILD WRITE CCW                      12200000
         B     RITEREST            SEE IF ANYTHING ELSE TO BR WRITTEN   12250000
         EJECT                                                          12300000
**                                                                   ** 12350000
*                   WRITE WARNING LINE                                * 12400000
**                                                                   ** 12450000
WARNWRIT EQU   *                                                        12500000
         NI    DCMIOCM1,N255-DCMWRWRN TURN OFF BIT                      12550000
         LA    POINT,DCMBAWRN      WARNING LINE BUFFER ADDRESS          12600000
         BAL   RETURN,BUILDSET     BUILD SET BUFFER CCW                 12650000
         LA    HOLD,DCMWARN        WARNING LINE                         12700000
         LH    WORK,DCMCORLN       LENGTH-1 LINE                 S21003 12750000
         BAL   RETURN,BUILDWRT     BUILD WRITE CCW                      12800000
         B     INSERTC             SEE IF INSERT CURSOR                 12850000
         EJECT                                                          12900000
**                                                                   ** 12950000
*                  BUILD WRITE INSTRUCTION LINE CCW'S                 * 13000000
**                                                                   ** 13050000
INSLWRIT EQU   *                                                        13100000
         NI    DCMIOCM1,N255-DCMWRINS TURN OFF INS LINE WRITE BIT       13150000
         LA    POINT,DCMBAINS      POINT TO BUFFER ADDRESS INS LINE     13200000
         BAL   RETURN,BUILDSET     BUILD SET BUF CCW                    13250000
         LA    HOLD,DCMBLNK1       POINT TO BLANK LINE                  13300000
         LH    WORK,DCMCORLN       GET LENGTH OF ONE LINE        S21003 13350000
         SLL   WORK,N1             DOUBLE LENGTH                        13400000
         BAL   RETURN,BUILDWRT     BUILD WRITE SCREEN CCW               13450000
         B     WRENT               SEE IF ENTRY AREA IS TO BE WRITTEN   13500000
         EJECT                                                          13550000
**                                                                   ** 13600000
*                   BUILD WRITE ENTRY AREA CCW                        * 13650000
**                                                                   ** 13700000
ENTRWRIT EQU   *                                                        13750000
         NI    DCMIOCM1,N255-DCMWRENT TURN OFF WRITE ENTRY AREA BIT     13800000
         LA    POINT,DCMBAENT      POINT TO ENTRY AREA BUFFER ADDRESS   13850000
         BAL   RETURN,BUILDSET     BUILD                                13900000
         LA    HOLD,DCMENTRY       ADDRESS OF ENTRY AREA                13950000
         LH    WORK,DCMCORLN       GET LENGTH OF ONE LINE        S21003 14000000
         SLL   WORK,N1             DOUBLE LENGTH                        14050000
         BAL   RETURN,BUILDWRT     BUILD WRITE CCW                      14100000
         B     WRITWARN            SEE IF WRITE WARNING LINE            14150000
         EJECT                                                          14200000
**                                                                   ** 14250000
*                   INSERT CURSOR                                     * 14300000
**                                                                   ** 14350000
BUILDINS EQU   *                                                        14400000
         NI    DCMIOCM1,N255-DCMINSC  TURN OFF BIT                      14450000
         SR    WORK,WORK           CLEAR WORK REG                       14500000
         IC    WORK,DCMCULNO       GET LINE NUMBER                      14550000
         BCTR  WORK,N0             DECREMENT IT BY ONE                  14600000
         IC    HOLD,DCMBAENT       GET ENTRY AREA BUFFER ADDRESS        14650000
         AR    HOLD,WORK           GET RIGHT LINE                       14700000
         STC   HOLD,DCMBAINC       HOLD IN BUFFER                       14750000
         IC    WORK,DCMPOSCU       GET CHARACTER POSITION               14800000
         BCTR  WORK,N0             DECREMENT BY ONE                     14850000
         STC   WORK,DCMBAINC+N1    HOLD IN BUFFER                       14900000
         LA    POINT,DCMBAINC      GET ADDRESS OF BUFFER ADDRESS        14950000
         ST    POINT,N0(CPGMREG)   HOLD IN CCW                          15000000
         MVI   N0(CPGMREG),INSERT  PUT OP CODE IN                       15050000
         MVI   N4(CPGMREG),CHAIN   CHAIN CCWS                           15100000
         MVI   N7(CPGMREG),N2      DATA BYTES                           15150000
         LA    CPGMREG,N8(CPGMREG) KICK UP CHAN PROG PTR                15200000
         B     SOUNDALM            GO SOUND ALARM MAYBE                 15250000
         EJECT                                                          15300000
**                                                                   ** 15350000
*                   SOUND ALARM                                       * 15400000
**                                                                   ** 15450000
BUILDSND EQU   *                                                        15500000
         NI    DCMIOCM1,N255-DCMSOUND  TURN OFF BIT                     15550000
         MVI   N0(CPGMREG),SOUND   PUT OP CODE INTO CCW                 15600000
         MVI   N4(CPGMREG),STOP    STOP CHAIN SOUND ALARM MUST BE LAST  15650000
*        IN CHAIN                                                       15700000
         MVI   N7(CPGMREG),N2      DATA BYTES                           15750000
         LA    X8,N8(X8)           KICK UP CHANNEL PROGRAM POINTER      15800000
         B     TESTBLNK            SEE IF ANY THING IS TO BE BLANKED    15850000
         EJECT                                                          15900000
**                                                                   ** 15950000
*                   BUILD SET BUFFER CCW                              * 16000000
**                                                                   ** 16050000
BUILDSET EQU   *                                                        16100000
         ST    POINT,N0(CPGMREG)   PUT BUFF ADD POINTER INTO CCW        16150000
         MVI   N0(CPGMREG),SETBUF  PUT COMMAND CODE INTO CCW            16200000
         MVI   N4(CPGMREG),CHAIN   CHAIN CCWS                           16250000
         MVI   N7(CPGMREG),N2      PUT BYTE COUNT IN                    16300000
         LA    CPGMREG,N8(CPGMREG) UPDATE CCW COUNTER                   16350000
         BR    RETURN              RETURN TO CALLER                     16400000
         EJECT                                                          16450000
**                                                                   ** 16500000
*                   WRITE CCW BUILD SUBROUTINE                        * 16550000
**                                                                   ** 16600000
BUILDWRT EQU   *                                                        16650000
         ST    HOLD,N0(CPGMREG)    SAVE WRITE FROM ADDRESS              16700000
         MVI   N0(CPGMREG),WRITE   PUT OP CODE IN CCW                   16750000
         MVI   N4(CPGMREG),CHAIN   CHAIN CCWS                           16800000
         STH   WORK,N6(CPGMREG)    PUT BYTE COUNT IN                    16850000
         LA    CPGMREG,N8(CPGMREG) KICK CCW COUNTER                     16900000
         BR    RETURN              RETURN                               16950000
         EJECT                                                          17000000
**                                                                   ** 17050000
*         THE FOLLOWING CODE INITIALIZES AND SHIFTS THE INS LINE      * 17100000
**                                                                   ** 17150000
WRTMSGWT EQU   *                                                        17200000
         NI    DCMCMSG1,N255-DCMMSGWT  TURN OFF BIT MSG WAITING         17250000
         MVI   DCMWARN+N40,BLANK   PUT BLANK IN SECOND HALF OF WARNING  17300000
         MVC   DCMWARN+N41(N39),DCMWARN+N40 PROPAGATE IT                17350000
         NI    DCMIOCM2,N255-DCMBLWRR TURN OFF BLANK WARNING LINE BIT   17400000
         MVC   DCMWARN+N57(N23),WAITMSG MOVE IN MESSAGE WAITING MSG     17450000
         OI    DCMIOCM1,DCMWRWRN+DCMSOUND   WARNING AND ALARM MG  M1072 17510000
         B     BLNKINST            CHECK FOR MORE WORK                  17550000
         EJECT                                                          17600000
**                                                                   ** 17650000
*              BLANK ENTRY AREA                                       * 17700000
**                                                                   ** 17750000
ENTRYBNK EQU   *                                                        17800000
         NI    DCMIOCM2,N255-DCMBLENT TURN OFF BIT                      17850000
         MVI   DCMENTRY,BLANK      PUT BLANK IN ENTRY AREA              17900000
         MVC   DCMENTRY+N1(N159),DCMENTRY  PROPAGATE IT                 17950000
         B     LEFTWARN                                                 18000000
BLINS    EQU   *                                                        18050000
         MVI   DCMINSTR,BLANK      PUT BLANK IN INSTRUVTION LINE        18100000
         MVC   DCMINSTR+N1(N79),DCMINSTR PROPAGATE IT                   18150000
         NI    DCMIOCM2,N255-DCMINSSH  TURN OFF BLANK INS BIT           18200000
         OI    DCMIOCM1,DCMWRINS   TURN ON WRITE INS LINE BIT           18250000
         B     WRINS               GO BUILD WRITE INS LINE CCWS         18300000
         EJECT                                                          18350000
**                                                                   ** 18400000
*              BLANK WARNING LINE LEFT SIDE                           * 18450000
**                                                                   ** 18500000
BLANKLFT EQU   *                                                        18550000
         NI    DCMIOCM2,N255-DCMBLWRL TURN OFF BIT                      18600000
         MVI   DCMWARN,BLANK       PUT BLANK IN WARNING LINE            18650000
         MVC   DCMWARN+N1(N39),DCMWARN PROPAGATE IT                     18700000
         B     RITEWARN                                                 18750000
         EJECT                                                          18800000
**                                                                   ** 18850000
*              BLANK WARNING LINE RIGHT SIDE                          * 18900000
**                                                                   ** 18950000
BLNKRIGT EQU   *                                                        19000000
         NI    DCMIOCM2,N255-DCMBLWRR TURN OFF BIT                      19050000
         MVI   DCMWARN+N40,BLANK   PUT BLANK INTO RIGHT SIDE WARN LINE  19100000
         MVC   DCMWARN+N41(N39),DCMWARN+N40 PROPAGATE IT                19150000
         NI    DCMR2FLG,N255-DCMRXUNV  TURN OFF UNVIEWABLE    MG  M1072 19160000
         NI    DCMCOM3,X'FF'-DCMOLUNV   MSG DISPLAYED FLAG    MH Y01563 19170003
         B     EXCP1               DO IO                                19200000
         EJECT                                                          19210000
**                                                                   ** 19220000
*                        REGISTER EQUATES                             * 19230000
**                                                                   ** 19240000
X1PARM   EQU   1                                                        19240400
XFBRANCH EQU   15                                                       19240800
XERTRN   EQU   14                                                       19241200
ZERO     EQU   0                   UNUSED                               19242000
PARM     EQU   1                   HOLDS XSA ADDRESS                    19244000
RDCMBASE EQU   4                   RESIDENT DCM BASE REG      MH YM2592 19246003
X2       EQU   2                   REG EQUATE                           19248000
X3       EQU   3                   REG EQUATE                           19248400
FIND     EQU   4                   SCRATCH PAD                          19248800
HOLD     EQU   5                   SCRATCH PAD                          19249200
POINT    EQU   6                   SCRATCH PAD                          19249600
WORK     EQU   7                   SCRATCH PAD                          19249700
X8       EQU   8                   REG EQUATE                           19249800
CPGMREG  EQU   8                   POINTS TO CHANNEL PROGRAM            19249900
UCMBASE  EQU   9                   UCM BASE                             19266600
DCMBASE  EQU   10                  DCM BASE                             19276600
PBASE    EQU   11                  BASE                                 19278600
PXSA     EQU   12                  CXSA ADDRESS                         19280600
UCMENTRY EQU   13                  UCMENTRY BASE                        19282600
RETURN   EQU   14                  RETURN REG                           19283000
XCTLREG  EQU   15                  XCTL PARM REG                        19283100
         EJECT                                                          19283200
**                                                                   ** 19288800
*              MISC  EQUATES                                          * 19290800
**                                                                   ** 19292800
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            19292903
ID2      EQU   C'H'                2ND CHARACTER OF CSECT ID            19293003
N0       EQU   0                   NUMBER                               19293200
N1       EQU   1                   NUMBER                               19293600
N2       EQU   2                   NUMBER                               19294000
N3       EQU   3                   NUMBER                               19294100
N4       EQU   4                   NUMBER                               19294200
N6       EQU   6                   NUMBER                               19294300
N7       EQU   7                   NUMBER                               19308200
N8       EQU   8                   NUMBER                               19318200
N15      EQU   15                  NUMBER                               19320200
N16      EQU   16                  NUMBER                               19320600
N12      EQU   12                  NUMBER                               19321000
N20      EQU   20                  NUMBER                               19321400
N23      EQU   23                  NUMBER                               19321800
N24      EQU   24                  NUMBER                               19321900
N27      EQU   27                  NUMBER                               19322000
N28      EQU   28                  NUMBER                               19322100
N31      EQU   31                  NUMBER                               19326700
N39      EQU   39                  NUMBER                               19328700
N40      EQU   40                  NUMBER                               19330700
N41      EQU   41                  NUMBER                               19331100
N57      EQU   57                  NUMBER                               19331200
N79      EQU   79                  NUMBER                               19331300
N104     EQU   104                 NUMBER                               19331400
N159     EQU   159                 NUMBER                               19336000
N255     EQU   255                 NUMBER                               19338000
STOP     EQU   X'20'               END OF CCW CHAIN                     19340000
CHAIN    EQU   X'60'               CHAIN CCWS                           19340400
READLGNH EQU   160                READ LENGTH FOR ENTRY AREA ME SA52709 19340518
BLANK    EQU   C' '                BLANK                                19340618
X14      EQU   14                  NUMBER                               19340700
         EJECT                                                          19352500
**                                                                   ** 19362500
*                   COMMAND CODE EQUATES                              * 19364500
**                                                                   ** 19368400
RMICODE  EQU   X'0E'               RMI CODE                             19370400
SETBUF   EQU   X'27'               SET BUFFER ADDRESS                   19372400
READ     EQU   X'06'               READ                                 19376300
SOUND    EQU   X'0B'               SOUND ALARM                          19378300
INSERT   EQU   X'0F'               INSERT CURSOR                        19380300
WRITE    EQU   X'01'               WRITE                                19384200
ERASE    EQU   X'07'               ERASE                                19386200
         SPACE 4                                                        19398500
EIGHT    DC    H'8'                CONSTANT                             19408800
WAITMSG  DC    C'IEE159E MESSAGE WAITING'   MESSAGE                     19419100
         EJECT                                                          19429400
         IHACTM  CXSA                                                   19450000
         EJECT                                                          19500000
         IEECUCM  FORMAT=NEW                                            19600000
         EJECT                                                          19650000
         IEERDCM                                                        19700000
         EJECT                                                   S21003 19800000
DCMSTRT  DSECT                                                          19850000
         IEECDCM DEVICE=A                                               19900000
         END                                                            23800000
./  ADD  SSI=63230278,NAME=IEECVETJ
* /* START OF SPECIFICATIONS ****************************************** 00100000
*                                                                       00200000
*01*  MODULE-NAME = IEECVETJ                                            00300000
*                                                                       00400000
*01*  DESCRIPTIVE-NAME = ROLL MODE ROUTINE                              00500000
*                                                                       00600000
*01*  COPYRIGHT = NONE                                                  00700000
*                                                                       00800000
*01*  STATUS = CHANGE LEVEL 1 FOR VS2 RELEASE 2                         00900000
*                                                                       00930000
*     APARS FIXED = OZ14058                                             00960000
*                                                                       01000000
*01*  FUNCTION = TO ROLL MESSAGES OFF THE SCREEN BASED ON A TIME        01100000
*     INTERVAL, RTME, AND A NUMBER OF LINES TO BE ROLLED, RNUM. ALSO,   01200000
*     TO CALCULATE THE APPROPRIATE POSITION AND VALUE OF QNUM, THE      01300000
*     NUMBER OF MESSAGE LINES WAITING TO ROLL ONTO THE SCREEN WHEN EACH 01400000
*     ROLL COMPLETES.                                                   01500000
*                                                                       01600000
*01*  NOTES = LOCAL AND CROSS-MEMORY LOCKS ARE RELEASED ON ENTRY VIA    01700000
*     THE FREELOCK SUBROUTINE ADDRESSED IN THE CXSA (CSAXC).            01800000
*                                                                       01900000
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              02000000
*                                                                       02100000
*02*    DEPENDENCIES = NONE                                             02200000
*                                                                       02300000
*02*    RESTRICTIONS = NONE                                             02400000
*                                                                       02500000
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES                     02600000
*                                                                       02700000
*02*    PATCH-LABEL = ICATCH A DC STATEMENT                             02800000
*                                                                       02900000
*01*  MODULE-TYPE = MODULE                                              03000000
*                                                                       03100000
*02*    PROCESSOR = ASSEMF-370R                                         03200000
*                                                                       03300000
*02*    MODULE-SIZE = X'496' BYTES                                      03400000
*                                                                       03500000
*02*    ATTRIBUTES = REENTERABLE                                        03600000
*                                                                       03700000
*01*  ENTRY-POINT = IEECVETJ                                            03800000
*                                                                       03900000
*02*    PURPOSE = ALL FUNCTIONS                                         04000000
*                                                                       04100000
*02*    LINKAGE = BALR                                                  04200000
*                                                                       04300000
*02*    INPUT = REGISTER 1 ADDRESSES THE CXSA AND DCMRNUM INDICATES THE 04400000
*       MAXIMUM NUMBER OF LINES TO ROLL.                                04500000
*                                                                       04600000
*02*    OUTPUT = REGISTER 1 ADDRESSES THE CXSA, MESSAGES ARE MOVED IN   04700000
*       THE PAGEABLE DCM, AND QNUM IS ADJUSTED AND POSITIONED           04800000
*                                                                       04900000
*02*    EXIT-NORMAL = IEECVET2 - DISPLAY ROUTINE 1                      05000000
*       TO DISPLAY ANY WAITING LINES IF SCREEN MESSAGES WERE MOVED UP   05100000
*       TO MAKE ROOM FOR MORE.                                          05200000
*                                                                       05300000
*02*    EXIT-NORMAL = IEECVETH, P, R, OR U - I/O ROUTINE                05400000
*       TO WRITE THE SCREEN MESSAGE AREA IF ONLY THE QNUM UPDATE WAS    05500000
*       DONE, AND TO WRITE THE MESSAGE WAITING WARNING LINE IF NO ROLL  05600000
*       WAS POSSIBLE AND THERE ARE MESSAGES WAITING TO BE SEEN.         05700000
*                                                                       05800000
*02*    EXIT-ERROR = NONE                                               05900000
*                                                                       06000000
*01*  EXTERNAL-REFERENCES = NONE                                        06100000
*                                                                       06200000
*02*    ROUTINES = FREELOCK SUBROUTINE - DEFINED IN IEECVET1, AND       06300000
*       ADDRESSED BY WORD CSAXC OF THE CXSA ON ENTRY.                   06400000
*                                                                       06500000
*02*    DATA-SETS = NONE                                                06600000
*                                                                       06700000
*02*    DATA-AREA = NONE                                                06800000
*                                                                       06900000
*02*    CONTROL-BLOCKS = CXSA,UCM,WQE,CQE,RDCM,TDCM                     07000000
*                                                                       07100000
*01*  TABLES = NONE                                                     07200000
*                                                                       07300000
*01*  MACROS = EXECUTABLE - NONE                                        07400000
*     MAPPING - IHAWQE  WQE DSECT                                       07500000
*               IHACTM  CXSA DSECT                                      07600000
*               IHACTM  CQE DSECT                                       07700000
*               IEECUCM UCM DSECT                                       07800000
*               IEERDCM RESIDENT DCM DSECT                              07900000
*               IEETDCM PAGEABLE DCM DSECT                              08000000
*                                                                       08100000
*01*  CHANGE-ACTIVITY = MODULE REWRITTEN COMPLETELY FOR VS2 RELEASE 2.  08200000
*     SUPPORT CODE Y02958.                                              08300000
*                                                                       08400000
**** END OF SPECIFICATIONS *******************************************/ 08500000
         TITLE 'IEECVETJ ROLL MODE'                                     08600000
IEECVETJ CSECT                                                          09100000
         EJECT                                                          09200000
*********************************************************************** 09300000
*        REGISTER EQUATES                                             * 09400000
*********************************************************************** 09500000
R0RNUM   EQU   0                   RNUM VALUE FOR THIS CONSOLE          09600000
R1UCME   EQU   1                   UCM ENTRY BASE REGISTER              09700000
R2QPTR   EQU   2                        QUEUE ENTRY POINTER             09800000
R2WORK   EQU   2                   WORK REGISTER                        09900000
R3PTRA   EQU   3                   POINTS TO SCT BEYOND LAST VISABLE    10000000
R4SCTPTR EQU   4                   POINTS TO CURRENT WORKING SCT        10100000
R5MSGPTR EQU   5                   POINTS TO CURRENT WORKING MESSAGE    10200000
R6PTRB   EQU   6                   POINTS TO LAST MESSAGE TO MOVE UP    10300000
R7LINECT EQU   7                        COUNTER FOR LINES HANDLED       10400000
R7WORK   EQU   7                   WORK REGISTER                        10500000
R8DEL    EQU   8                   COUNTER OF LINES REMOVED             10600000
R9QNUM   EQU   9                   COUNTER FOR MESSAGES NOT DISPLAYED   10700000
RAMAJOR  EQU   10                       WQE POINTER (MAJOR FOR MLWTO)   10800000
RASCT    EQU   10                       SCT ENTRY POINTER               10900000
RAWORK   EQU   10                  WORK REGISTER                        11000000
RBMINOR  EQU   11                       MINOR WQE POINTER               11100000
RBWORK   EQU   11                  WORK REGISTER                        11200000
RCPROG   EQU   12                  PROGRAM BASE REGISTER                11300000
RDTDCM   EQU   13                  TDCM BASE REGISTER                   11400000
RERTN    EQU   14                  RETURN REGISTER                      11500000
RFCODE   EQU   15                  RETURN CODE FROM SUBROUTINE          11600000
RFWORK   EQU   15                  WORK REGISTER                        11700000
XFBRANCH EQU   15                                                       11800000
XERTRN   EQU   14                                                       11900000
X1PARM   EQU   1                                                        12000000
         EJECT                                                          12100000
*********************************************************************** 12400000
*        PROGRAM INITIALIZATION                                       * 12500000
*********************************************************************** 12600000
         BALR  RCPROG,N0            LOAD PROGRAM BASE REGISTER          12700000
         USING *,RCPROG             ESTABLISH ADDRESSABILITY            12800000
         B     PATCHEND             BRANCH AROUND PATCH AREA            12900000
ICATCH   DC    C'IEECVETJ'          EYE CATCHER                         13000000
         DC    CL8'&SYSDATE',CL56' ' FOR FIELD MAINTENANCE              13100000
PATCHEND EQU   *                                                        13200000
         LR    R2WORK,R1UCME        LOAD CXSA ADDRESS                   13300000
         USING CXSA,R2WORK          ESTABLISH CXSA ADDRESSABILITY       13400000
         L     XFBRANCH,CSAXB       ADDRESS GETLOCK SUBROUTINE          13500000
         BALR  XERTRN,XFBRANCH      OBTAIN LOCKS                        13600000
         L     R1UCME,CSAUCM        LOAD UCMENTRY ADDRESS               14000000
         USING UCMLIST,R1UCME       ESTABLISH ADDRESSABILITY            14100000
         DROP  R2WORK               NO LONGER NEED CXSA BASE            14200000
         L     RAWORK,UCMXB         LOAD R-DCM ADDRESS                  14300000
         USING DCMTSRT,RAWORK       ESTABLISH ADDRESSABILITY            14400000
         NI    DCMR2FLG,X'FF'-DCMRXRLL HONOR READY TO ROLL              14500000
         L     RDTDCM,DCMADTRN      LOAD T-DCM ADDRESS                  14600000
         USING DCMSTRT,RDTDCM       ESTABLISH ADDRESSABILITY            14700000
         DROP  RAWORK               NO LONGER NEED R-DCM                14800000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      14900000
         MVI   DCMTREN1,ID1         PUT CSECT ID INTO                   15000000
         MVI   DCMTREN2,ID2         NEW TRACE ENTRY                     15100000
         SR    R8DEL,R8DEL          ZERO DELETED LINES COUNTER          15200000
         MVI   DCMUTILT,N0          ZERO OUT UTILITY BYTE               15300000
         XC    DCMDSAV(N20),DCMDSAV ZERO OUT WORK AREA                  15400000
         SR    R0RNUM,R0RNUM            ZERO REGISTER                   15500000
         IC    R0RNUM,DCMRNUM           LOAD RNUM FOR LATER COMPARE     15600000
         SR    R9QNUM,R9QNUM            ZERO REG., USED FOR QNUM COUNT  15700000
         EJECT                                                          15800000
*********************************************************************** 15900000
*        PTRA MADE TO POINT TO SCT JUST BEYOND LAST VISABLE MESSAGE   * 16000000
*        PTRB MADE TO POINT TO LAST DCM MESSAGE FOR MOVE SUBROUTINE   * 16100000
*        MESSAGE QUEUE INDEXED INTO TO ACCOUNT FOR BLANK SCREEN LINES * 16200000
*********************************************************************** 16300000
         CLC   DCMWTBUF(N4),DCMASCRN    STATUS DISPLAY ON FIRST LINE    16600000
         BE    MSGWAIT              YES, NO ROLL POSSIBLE               16700000
         CLC   DCMWTBUF(N4),DCMLSCRN    ANY DISPLAYS ON SCREEN          17100000
         BNL   NOSD                 NO, SET FOR NONE                    17200000
         L     R3PTRA,DCMWTBUF      POINT TO FIRST LINE OF DISPLAY      17700000
         S     R3PTRA,DCMASCRN          SUBTRACT FIRST MESSAGE LINE     17800000
         SR    R2WORK,R2WORK            ZERO DIVIDEND REGISTER          17900000
         LH    RAWORK,DCMCORLN          LOAD LENGTH OF A DISPLAY LINE   18000000
         DR    R2WORK,RAWORK            COMPUTE LINE COUNT              18100000
         LH    R2WORK,DCMSCTCN          LOAD LENGTH OF AN SCT ENTRY     18200000
         MR    R2WORK,R2WORK            COMPUTE SCT DISPLACEMENT        18300000
         A     R3PTRA,DCMAMTAB          POINT TO 1ST. DISPLAY SCT       18400000
BLPROC   L     R4SCTPTR,DCMAMTAB    POINT TO 1ST. MSG. SCT              18800000
         L     R5MSGPTR,DCMASCRN    POINT TO 1ST. MSG. LINE             18900000
         LR    R6PTRB,R4SCTPTR      SAVE PTR FOR MOVE SUBRTN  JE YM8354 19000000
ENDTEST  TM    N0(R4SCTPTR),DCMMSGST    END OF SCT ENTRIES              19400000
         BO    ADJUST               YES, GO TO NEXT FUNCTION            19500000
         TM    N0(R4SCTPTR),DCMMSGIN    LINE CONTAINS MESSAGE           19900000
         BZ    HIDDEN               NO, SEE IF LINE IS VISABLE          20000000
         LR    R6PTRB,R4SCTPTR      SAVE POINTER FOR MOVE SUBRTN        20400000
QBLANK   MVI   N0(R5MSGPTR),BLANK   BLANK FIRST CHAR OF OLD QNUM        20800000
         MVI   N1(R5MSGPTR),BLANK   BLANK SECOND CHAR OF OLD QNUM       20900000
         AH    R4SCTPTR,DCMSCTCN    BUMP POINTER TO NEXT SCT            21300000
         AH    R5MSGPTR,DCMCORLN    BUMP POINTER TO NEXT MESSAGE        21400000
         B     ENDTEST              LOOP TO CONTINUE PROCESSING         21500000
HIDDEN   CR    R4SCTPTR,R3PTRA      THIS LINE UNDER A DISPLAY           21900000
         BNL   ADJUST               YES, GO TO NEXT FUNCTION            22000000
         BAL   RERTN,SEARCH         GO TO SEARCH SUBROUTINE             22400000
         LTR   RFCODE,RFCODE        TEST RETURN CODE                    22800000
         BNZ   QBLANK               MSG WAITING, CONTINUE PROC.         22900000
         B     QNUMPROC             NO MESSAGES, GO TO CLEANUP          23000000
NOSD     L     R3PTRA,DCMADDRL      POINT TO LAST SCT ENTRY             23400000
         AH    R3PTRA,DCMSCTCN      POINT TO ONE BEYOND LAST ENTRY      23500000
         B     BLPROC               GO TO CHECK BLANK LINES             23600000
ADJUST   LH    RBWORK,DCMSCTCN      LOAD SCT ENTRY LENGTH               24000000
         MR    RAWORK,R9QNUM        TIMES NUMBER VISABLE BLANKS         24100000
         SR    R3PTRA,RBWORK        FLOAT PTRA UP FOR EACH BLANK        24200000
         EJECT                                                          24300000
*********************************************************************** 24400000
*        MESSAGES ROLLED UP AND VACATED LINES BLANKED                 * 24500000
*        INTERVENTION REQUIRED COUNTER REDUCED IF APPROPRIATE         * 24600000
*********************************************************************** 24700000
SCAN     L     R4SCTPTR,DCMAMTAB    POINT TO FIRST SCT ENTRY            24900000
TESTEND  TM    N0(R4SCTPTR),DCMMSGST    END OF SCT ENTRIES              25300000
         BO    QNUMPROC             YES, GO TO NEXT FUNCTION            25400000
         CR    R4SCTPTR,R3PTRA      IS/WAS LINE UNDER A DISPLAY         25800000
         BNL   QNUMPROC             YES, GO TO NEXT FUNCTION            25900000
         CR    R8DEL,R0RNUM         RNUM REACHED OR EXCEEDED            26300000
         BL    TESTMODE             NO, CHECK MODE=RD                   26400000
         TM    N1(R4SCTPTR),DCMMSGCT IS THIS A CONTINUATION LINE        26800000
         BO    SCANSRCH             YES, ANY LINES LEFT                 26900000
         B     QNUMPROC             NO, GO TO NEXT FUNCTION             27000000
TESTMODE CLI   DCMDEL+N1,ROLDEL     IS MODE EQ ROLL DELETABLE           27400000
         BNE   LONGMSG              GO SEE IF CONTINUED                 27500000
         TM    N1(R4SCTPTR),DCMMSGAC  IS THIS AN ACTION MESSAGE         27900000
         BZ    LONGMSG              NO, GO SEE IF CONTINUED             28000000
         AH    R4SCTPTR,DCMSCTCN    BUMP POINTER TO NEXT SCT            28400000
         B     TESTEND              LOOP TO CONTINUE PROCESSING         28500000
LONGMSG  TM    N0(R4SCTPTR),DCMMSGCN IS THIS MESSAGE CONTINUED          28900000
         BO    SEEALL               YES, SEE IF ALL VISABLE             29000000
SCANSRCH BAL   RERTN,SEARCH         GO TO SEARCH SUBROUTINE             29400000
         LTR   RFCODE,RFCODE        TEST RETURN CODE                    29800000
         BNZ   TESTIR               MSG. WAITING, CHECK I.R. COUNT      29900000
CONTLINE TM    N1(R4SCTPTR),DCMMSGCT    IS THIS A CONTINUATION LINE     30400000
         BZ    QNUMPROC             NO, GO TO NEXT FUNCTION             30500000
TESTIR   DS    0H                                                       30900000
MOVEUP   BAL   RERTN,MOVER          GO TO MOVER SUBROUTINE              31300000
         B     TESTEND              LOOP TO CONTINUE PROCESSING         31400000
SEEALL   LR    R2WORK,R4SCTPTR      LOAD CURRENT SCT POINTER            31800000
LOOP     AH    R2WORK,DCMSCTCN      BUMP TO NEXT SCT ENTRY              31900000
         CR    R2WORK,R3PTRA        IS THIS LINE UNDER A DISPLAY        32000000
         BNL   QNUMPROC             YES, GO TO NEXT FUNCTION            32100000
         TM    N0(R2WORK),DCMMSGCN  IS LINE CONTINUED                   32200000
         BZ    SCANSRCH             NO, ALL IS VISABLE                  32300000
         B     LOOP                 LOOP TO CONTINUE SCAN               32400000
         EJECT                                                          32500000
*********************************************************************** 32600000
*        QNUM COMPUTED AND PUT ON PROPER DISPLAY MESSAGE LINE         * 32700000
*        EXIT IS DETERMINED BASED ON CONDITIONS DETERMINED            * 32800000
*********************************************************************** 32900000
QNUMPROC SR    R9QNUM,R9QNUM        ZERO QNUM COUNTER                   33100000
COUNTNUM BAL   RERTN,SEARCH         GO TO SEARCH SUBROUTINE             33500000
         LTR   RFCODE,RFCODE        TEST RETURN CODE                    33900000
         BNZ   COUNTNUM             MORE MESSAGES, LOOP BACK            34000000
         CH    R9QNUM,MAXNUM        MORE THAN 99 MESSAGES ON QUEUE      34300000
         BH    BIGQ                 YES, QUEUE IS OVERLOADED            34400000
         CVD   R9QNUM,DCMPACK       CONVERT QNUM TO DECIMAL             34800000
         UNPK  DCMPACK(N4),DCMCVBIN(N4) UNPACK RESULT                   34900000
         OI    DCMPACK+N3,ZONE      SET ZONE OF RESULT                  35000000
CONVERT  S     R3PTRA,DCMAMTAB      GET SCT DISPLACEMENT OF PTRA        35400000
         SR    R2WORK,R2WORK        ZERO DIVIDEND REGISTER              35500000
         LH    RAWORK,DCMSCTCN      LOAD LENGTH OF SCT ENTRY            35600000
         DR    R2WORK,RAWORK        COMPUTE NUMBER OF SCT ENTRY         35700000
         LH    R2WORK,DCMCORLN          LOAD LENGTH OF DISPLAY LINE     35800000
         MR    R2WORK,R2WORK            GET MESSAGE LINE DISPLACEMENT   35900000
         A     R3PTRA,DCMASCRN          ADD POINTER TO 1ST. MESSAGE     36000000
         LTR   R8DEL,R8DEL          HAVE ANY MESSAGES BEEN ROLLED       36400000
         BZ    NOROLL               NO, JUST STORE UPDATED QNUM         36500000
         MVC   N0(N2,R3PTRA),DCMPACK+N2 MOVE QNUM TO PROPER LINE        36900000
         OI    DCMIOCM2,DCMBLWRR    BLANK RIGHT HALF OF WNG LINE        37300000
         OI    DCMIOCM1,DCMWRWRN+DCMWRMSG  WRITE WARNING LINE AND FULL *37400000
                                    MESSAGE AREA                        37500000
         L     RAWORK,UCMXB         ADDRESS RESIDENT DCM                37600000
         USING DCMTSRT,RAWORK       ESTABLISH ADDRESSABILITY            37700000
         NI    DCMR2FLG,X'FF'-DCMRXSFL TURN OFF SCREEN FULL             37800000
         NI    UCMDEVC,X'FF'-UCMDEVA ALSO UCM SCREEN FULL               37900000
         L     X1PARM,DCMCXSVE      PASS CXSA ADDRESS                   38000000
         L     XFBRANCH,DCMNDSP1    LOAD DISPLAY 1 ADDRESS              38100000
         B     EXIT                 EXIT TO IEECVET2                    38200000
BIGQ     MVI   DCMPACK+N2,BIGA      STORE MAX QNUM                      38600000
         MVI   DCMPACK+N3,BIGA      INTO AREA FOR MOVE ONTO SCREEN      38700000
         B     CONVERT              BRANCH TO SEE IF ANY ROLLED         38800000
NOROLL   SH    R3PTRA,DCMCORLN      NONE ROLLED, REDUCE POINTER         39200000
         MVC   N0(N2,R3PTRA),DCMPACK+N2 STORE UPDATED QNUM IN LINE      39300000
ANYQNUM  LTR   R9QNUM,R9QNUM        IS QNUM NOW ZERO                    39700000
         BZ    IOEXIT               YES, NO MESSAGES WAITING            39800000
         OI    DCMCMSG1,DCMMSGWT    INDICATE MESSAGE WAITING            40200000
         OI    DCMIOCM1,DCMWRMSG    WRITE FULL MESSAGE AREA             40300000
*********************************************************************** 40500000
IOEXIT   EQU   *                                                        40600000
         L     XFBRANCH,DCMIORTN    INIT FOR I/O ROUTINE EXIT           40700000
EXIT     L     X1PARM,DCMCXSVE      RESTORE CXSA ADDRESS                41100000
         BR    XFBRANCH             EXIT TO PROPER DIDOCS MODULE        41500000
MSGWAIT  SR    R9QNUM,R9QNUM        ZERO QNUM COUNTER                   41900000
         BAL   RERTN,SEARCH         GO TO SEARCH SUBROUTINE             42000000
         B     ANYQNUM              GO SEE IF MSG WAITING REQUIRED      42100000
         EJECT                                                          42200000
*********************************************************************** 42300000
*        SEARCH SUBROUTINE                                            * 42400000
*********************************************************************** 42500000
SEARCH   EQU   *                    SEARCH QUEUE & BEHIND DISPLAY       42700000
         L     R2QPTR,DCMDSAV+N8    PTR TO OUTPUT QUEUE                 43000000
         USING CQE,R2QPTR          CQE ADDRESSABILITY                   43100000
         LM    RAMAJOR,RBMINOR,DCMDSAV  MAJ & MIN PTRS                  43200000
         TM    DCMUTILT,DCMUTILB    TEST PHASE SWITCH                   43600000
         BO    SCHB                 GO TO PHASE B                       43700000
SCHA     TM    DCMUTILT,DCMUTILA    IS THIS FIRST PASS                  44100000
         BO    SCHLAST              NO, TEST SCT LIMIT                  44200000
         OI    DCMUTILT,DCMUTILA    FIRST PASS DONE                     44600000
         L     RBWORK,DCMWTBUF      POINT TO DISPLAY                    44700000
         C     RBWORK,DCMWTINT      DOES A DISPLAY EXIST                44800000
         BE    SCHINITB             NO, PROCEED TO PHASE B              44900000
         SR    RASCT,RASCT          YES, DETERMINE SCREEN SIZE          45300000
         S     RBWORK,DCMASCRN      FROM TOP TO DISPLAY                 45400000
         LH    RFWORK,DCMCORLN      BUFFER SIZE OF EACH LINE            45500000
         DR    RASCT,RFWORK         QUOTIENT DETERMINES LINE #          45600000
         LR    RASCT,RBWORK         OF FIRST DISPLAY LINE               45700000
         MH    RASCT,DCMSCTCN       MULT BY SCT ENTRY LENGTH            45800000
         A     RASCT,DCMAMTAB       ADD TO START OF SCT                 45900000
SCHMSGIN TM    N0(RASCT),DCMMSGIN   IS A MSG IN LINE                    46300000
         BNO   SCHINITB             NO, GO TO PHASE B                   46400000
         AH    RASCT,DCMSCTCN       YES, POINT TO NEXT SCT              46800000
SCHRCYES LA    R9QNUM,N1(R9QNUM)    INCREMENT QNUM                      47200000
         LA    RFCODE,N4            SET RETURN CODE = YES               47600000
SCHRET   ST    R2QPTR,DCMDSAV+N8    SAVE REGISTERS                      48000000
         STM RAMAJOR,RBMINOR,DCMDSAV      FOR NEXT PASS                 48100000
         BR    RERTN                RETURN TO CALLER                    48500000
SCHLAST  C     RASCT,DCMADDRL       HAVE WE PASSED LAST SCT             48900000
         BNH   SCHMSGIN             NO, CHECK FOR MESSAGE               49000000
SCHINITB SR    RAMAJOR,RAMAJOR      CLEAR MAJOR AND                     49400000
         SR    RBMINOR,RBMINOR      MINOR PTRS                          49500000
         OI    DCMUTILT,DCMUTILB    PHASE B SWITCH                      49600000
         SR    R7LINECT,R7LINECT    ZERO LINE COUNTER                   49700000
         TM    UCMSTS,UCMTC         IS IN-LINE MLWTO PENDING            50100000
         BO    SCHMLWRK             YES, HANDLE                         50200000
         L     R2QPTR,UCMOUTQ       LOAD OUTPUT QUEUE PTR               50600000
SCHB     LTR   R2QPTR,R2QPTR        IS QUEUE EMPTY                      51000000
         BZ    SCHRCNO              YES, NO MORE LINES                  51100000
         LTR   R7LINECT,R7LINECT    IS LINE CTR ZERO                    51500000
         BNZ   SCHORWQE             NO, HANDLE                          51600000
         LTR   RAMAJOR,RAMAJOR      IS MAJOR WQE PTR ZERO               52000000
         BNZ   SCHMINZR             NO, MLWTO - CHECK MINOR             52100000
SCHACTST TM    CQEFLAG,CQEENTR      IS THIS ENTRY ACTIVE                52500000
         BO    SCHGETWQ             YES, CHECK IT OUT                   52600000
SCHNXTWQ SR    RAMAJOR,RAMAJOR      CLEAR WQE                           53000000
         SR    RBMINOR,RBMINOR      POINTERS                            53100000
         TM    CQEFLAG,CQEEOB       IS THIS END OF BLOCK                53500000
         BO    SCHNXTBK             YES, GET NEXT ONE                   53600000
         TM    CQEFLAG,CQEEOQ       WAS THIS LAST ENTRY                 54000000
         BO    SCHRCNO              YES, NO MORE LINES                  54100000
         LA    R2QPTR,N4(R2QPTR)    POINT TO NEXT ENTRY                 54500000
         B     SCHACTST             GO CHECK OUT NEXT ENTRY             54600000
SCHNXTBK L     R2QPTR,CQEWQE        POINT TO NEXT BLOCK                 55000000
         LA    R2QPTR,N0(R2QPTR)    CLEAR FLAGS                         55100000
         B     SCHACTST             GO CHECK NEXT ENTRY                 55200000
SCHRCNO  SR    RFCODE,RFCODE        SET RETURN CODE = NO                55600000
         SR    R2QPTR,R2QPTR        NO MORE LINES LEFT                  55700000
         B     SCHRET               RETURN TO CALLER                    55800000
SCHGETWQ L     RAMAJOR,CQEWQE       POINT TO WQE                        56200000
         LA    RAMAJOR,N0(RAMAJOR)  CLEAR FLAGS                         56300000
SCHTSTML TM    CQEFLAG,CQEMAJOR     IS THIS AN MLWTO                    56700000
         BO    SCHINTST             YES, TEST FOR INLINE                56800000
         USING WQE,RAMAJOR                                              57200000
         L     R7LINECT,WQENBR      WQE TEXT LENGTH                     57300000
         TM    UCMDISP2,UCMDISPI TIME STAMP REQD             JE @YM8452 57400000
         BZ    TSTDISPJ            NO, TEST NEXT             JE @YM8452 57500000
         LA    R7LINECT,19(0,R7LINECT) ADJUST LENGTH         JE @YM8452 57600000
         B     SCHORWQE            CONTINUE                  JE @YM8452 57700000
TSTDISPJ TM    UCMDISP2,UCMDISPJ   JOB ID REQD               JE @YM8452 57800000
         BZ    SCHORWQE            NO, CONTINUE              JE @YM8452 57900000
         LA    R7LINECT,10(0,R7LINECT) ADJUST LENGTH         JE @YM8452 58000000
SCHORWQE SH    R7LINECT,DCMAXLGN    SUBTRACT 1 LINE LENGTH              58400000
         BNP   SCHLSTLN             MORE LINES NOT NEEDED               58500000
         LA    R7LINECT,N2(R7LINECT)  INCLUDE 2 EXTRA BLANKS FOR        58900000
*                                   EACH CONTINUATION LINE IN           59000000
*                                   REMAINING TEXT COUNT                59100000
         B     SCHRCYES             INDICATE LINE FOUND                 59200000
SCHLSTLN SR    R7LINECT,R7LINECT    CLEAR LINE COUNTER                  59600000
         SR    RAMAJOR,RAMAJOR      CLEAR MAJOR POINTER                 60000000
         TM    CQEFLAG,CQEEOQ       WAS THIS LAST QUEUE ENTRY           60400000
         BNO   SCHENDBK             NO, CONTINUE                        60500000
         SR    R2QPTR,R2QPTR        YES, ZERO POINTER                   60900000
         B     SCHRCYES             INDICATE LINE FOUND                 61000000
SCHENDBK TM    CQEFLAG,CQEEOB       IS THIS END OF BLOCK      @ZA14058  61400000
         BO    SCHNXTBL             YES, GET NEXT                       61500000
         LA    R2QPTR,N4(R2QPTR)    NO, POINT TO NEXT CQE               61900000
         B     SCHRCYES             INDICATE LINE FOUND                 62000000
SCHNXTBL L     R2QPTR,CQEWQE        POINT TO NEXT BLOCK                 62400000
         LA    R2QPTR,N0(R2QPTR)    CLEAR FLAGS                         62500000
         B     SCHRCYES             INDICATE LINE FOUND                 62600000
SCHMLWRK L     R2QPTR,UCMWLAST      POINT TO MAJOR'S CQE                63000000
         L     RAMAJOR,CQEWQE       POINT TO MAJOR                      63100000
         L     RBMINOR,UCMMLAST     POINT TO MINOR                      63500000
         LTR   RBMINOR,RBMINOR      IS MINOR PTR ZERO                   63900000
         BZ    SCHMAJCK             YES, CHECK MAJOR                    64000000
         TM    UCMSDS5,UCMSDS5F IS MLAST THE NEXT TO OUTPUT   JE YM8408 64100000
         BO    SCHTXTZR            YES, GO CHECK TEXT LENGTH  JE YM8408 64200000
         L     RBMINOR,WMJMMIN     NO, IS MLAST STILL VALID ON MINOR   *64300000
                                   CHAIN                      JE YM8408 64400000
SCHCMIN  C     RBMINOR,UCMMLAST    FOUND YET                  JE YM8408 64500000
         BE    SCHMINZR            YES, USE WHAT IT POINTS TO JE YM8408 64600000
         DROP  RAMAJOR                                        JE YM8408 64700000
         USING WQE,RBMINOR                                    JE YM8408 64800000
         ICM   RBMINOR,7,WMNMNX1   GET MINOR                  JE YM8408 64900000
         BNZ   SCHCMIN             GO CHECK THIS ONE          JE YM8408 65000000
         B     SCHMAJCK             CHECK TEXT LENGTH         JE YM8408 65100000
SCHMINZR LTR   RBMINOR,RBMINOR      IS MINOR PTR ZERO                   65500000
         BZ    SCHMAJCK             YES, CHECK MAJOR                    65600000
         L     RFWORK,N0(RBMINOR)   LOAD FORWARD PTR                    66000000
         LA    RFWORK,N0(RFWORK)    CLEAR USE COUNT                     66100000
         LTR   RFWORK,RFWORK        IS FORWARD PTR ZERO                 66200000
         BZ    SCHMINEN             YES, CHECK END LINE                 66300000
         LR    RBMINOR,RFWORK       POINT TO NEXT MINOR                 66700000
         B     SCHTXTZR             CHECK FOR TEXT LENGTH               66800000
SCHMINEN TM    WMNMLT1,WMNMLT1D     IS THIS AN END LINE                 67200000
         BO    SCHNXTWQ             YES, OK TO GET NEXT WQE             67300000
         B     SCHRCNO              NO, UNENDED MLWTO                   67400000
         DROP  RBMINOR                                                  67800000
         USING WQE,RAMAJOR                                              67900000
SCHMAJCK TM    WMJMMLW,WMJMMLWH     IS A NULL MINOR ATTACHED            68000000
         BO    SCHMAJEN             YES, TEST MAJOR FOR END             68100000
         L     RBMINOR,WMJMMIN      NO, POINT TO MINOR                  68500000
         DROP  RAMAJOR                                                  68900000
         USING WQE,RBMINOR                                              69000000
SCHTXTZR CLI   WMNMTL1,ZERO         IS MINOR TEXT LENGTH ZERO           69100000
         BE    SCHNXTWQ             YES, GET NEXT WQE                   69200000
         B     SCHRCYES             NO, INDICATE LINE FOUND             69300000
         DROP  RBMINOR                                                  69700000
         USING WQE,RAMAJOR                                              69800000
SCHMAJEN TM    WMJMLTYP,WMJMLTYD    IS MAJOR AN END LINE                69900000
         BO    SCHNXTWQ             YES, GET NEXT WQE                   70000000
         B     SCHRCNO              NO, UNENDED MLWTO                   70100000
SCHINTST TM    WMJMDEC,CODE8        IS                                  70500000
         BNO   SCHRCYES             MESSAGE                             70600000
         TM    WMJMDEC+1,CODE9      TO GO                               70700000
         BNO   SCHRCYES             IN                                  70800000
         CLI   WMJMAREA,AREAZ       LINE                                70900000
         BE    SCHRCYES             YES, INDICATE LINE FOUND            71000000
         B     SCHNXTWQ             NO, GET NEXT WQE                    71100000
         EJECT                                                          71200000
*********************************************************************** 71300000
*        MOVER SUBROUTINE               MESSAGE MOVE                  * 71400000
*********************************************************************** 71500000
MOVER    SR    RAWORK,RAWORK            ZERO DIVIDEND REGISTER          71800000
         LR    RBWORK,R4SCTPTR          PUT CURRENT SCT PTR IN REG      71900000
         S     RBWORK,DCMAMTAB          COMPUTE DISP. OF CURRENT SCT    72000000
         LH    R2WORK,DCMSCTCN          LOAD LENGTH OF SCT ENTRY        72100000
         DR    RAWORK,R2WORK            COMPUTE NUMBER OF CURRENT SCT   72200000
         LH    RAWORK,DCMCORLN          LOAD LENGTH OF A MESSAGE LINE   72400000
         MR    RAWORK,RAWORK            COMPUTE NUMBER OF CURRENT LINE  72500000
         A     RBWORK,DCMASCRN          ADD START OF MESSAGES           72600000
         LR    RFWORK,RBWORK            SAVE CURRENT MESSAGE POINTER    72700000
         LR    RBWORK,R6PTRB            PUT LAST MSG SCT PTR IN REG     72900000
         SR    RBWORK,R4SCTPTR          SUBTRACT CURRENT SCT POINTER    73000000
         DR    RAWORK,R2WORK            COMPUTE COUNT FOR BCT LOOP      73100000
         LTR   R2WORK,RBWORK            LOAD BCT COUNT FOR MSG MOVE     73200000
         BNP   MOVRTRN             NOT POSITIVE, GET OUT      JE YM8354 73300000
         LR    RAWORK,RFWORK            INIT MOVE 'TO' POINTER          73500000
         LR    RBWORK,RAWORK            PUT 'TO' POINTER IN REGISTER    73600000
         AH    RBWORK,DCMCORLN          INIT MOVE 'FROM' POINTER        73800000
         LH    RFWORK,DCMLGNTH          LOAD MOVE LENGTH                74000000
         BCTR  RFWORK,N0                REDUCE FOR EXECUTE              74100000
MOVELOOP EX    RFWORK,MOVEITUP          MOVE UP ONE MESSAGE LINE        74300000
         AH    RAWORK,DCMCORLN          INCREMENT 'TO' POINTER          74500000
         AH    RBWORK,DCMCORLN          INCREMENT 'FROM' POINTER        74600000
         BCT   R2WORK,MOVELOOP          TEST FOR LAST, CONTINUE         74800000
         BCTR  RFWORK,N0                DECREMENT FOR BLANK EXECUTE     75000000
         MVI   N0(RAWORK),BLANK         BLANK FIRST CHAR VACATED LINE   75100000
         EX    RFWORK,BLANKIT           BLANK REST OF VACATED LINE      75200000
         EJECT                                                          75300000
*********************************************************************** 75500000
*        MOVER SUBROUTINE CONT.         DOM ELEMENT MOVE              * 75600000
*********************************************************************** 75700000
         SR    RAWORK,RAWORK            ZERO DIVIDEND REGISTER          75800000
         LR    RBWORK,R4SCTPTR          PUT CURRENT SCT PTR IN REG      75900000
         S     RBWORK,DCMAMTAB          COMPUTE DISP. OF CURRENT SCT    76000000
         LH    R2WORK,DCMSCTCN          LOAD LENGTH OF SCT ENTRY        76100000
         DR    RAWORK,R2WORK            COMPUTE NUMBER OF CURRENT SCT   76200000
         LH    RAWORK,DOMLEN            LOAD LENGTH OF A DOM ENTRY      76300000
         MR    RAWORK,RAWORK            COMPUTE NUMBER OF CURRENT DOM   76400000
         A     RBWORK,DCMDOMPK          ADD START OF DOM ELEMENTS       76500000
         LR    RFWORK,RBWORK            SAVE CURRENT DOM POINTER        76600000
         LR    RBWORK,R6PTRB            PUT LAST MSG SCT PTR IN REG     76700000
         SR    RBWORK,R4SCTPTR          SUBTRACT CURRENT SCT POINTER    76800000
         DR    RAWORK,R2WORK            COMPUTE CURRENT-LAST COUNT      76900000
         LH    RAWORK,DOMLEN            LOAD LENGTH OF DOM ENTRY        77000000
         MR    RAWORK,RAWORK            COMPUTE DOM MOVE LENGTH         77100000
         LR    RAWORK,RFWORK            INIT 'TO' POINTER               77200000
         LR    RFWORK,RBWORK            SAVE DOM MOVE LENGTH            77300000
         BCTR  RFWORK,N0                REDUCE FOR EXECUTE MOVE         77400000
DOMOVE   EQU   *         LOOP UNTIL ALL DOM ELEMENTS ARE MOVED          77600000
         LA    RBWORK,LENDOM(RAWORK) INIT 'FROM' ADDR         MB YM4391 77700000
         CH    RFWORK,H256         OVER 256 TO MOVE           MB YM4391 77800000
         BL    EXMOVE              255 MOVES 256 BYTES        MB YM4391 77900000
         MVC   N0(N256,RAWORK),N0(RBWORK) MOVE 256            MB YM4391 78000000
         SH    RFWORK,H256         DROP COUNT BY 256          MB YM4391 78100000
         LA    RAWORK,N256(RAWORK) BUMP 'TO' ADDRESS          MB YM4391 78200000
         B     DOMOVE              CONTINUE MOVE              MB YM4391 78300000
EXMOVE   EQU   *                                              MB YM4391 78400000
         EX    RFWORK,MOVEITUP          MOVE UP DOM ENTRIES   MB YM4391 78500000
         LA    RAWORK,N1(RAWORK,RFWORK) LOCATE LAST ENTRY     MB YM4391 78700000
         LH    RFWORK,DOMLEN            LOAD DOM ENTRY LENGTH IN REG    78800000
         BCTR  RFWORK,N0                REDUCE FOR EXECUTE NULLING      78900000
         EX    RFWORK,NULLIT            NULL VACATED DOM ENTRY          79000000
         EJECT                                                          79100000
*********************************************************************** 79300000
*        MOVER SUBROUTINE CONT.         SCT ELEMENT MOVE              * 79400000
*********************************************************************** 79500000
         LR    RBWORK,R6PTRB            PUT LAST MSG SCT PTR IN REG     79600000
         SR    RBWORK,R4SCTPTR          SUBTRACT CURRENT SCT POINTER    79700000
         LR    RFWORK,RBWORK            SAVE SCT MOVE LENGTH            79800000
         BCTR  RFWORK,N0                REDUCE FOR EXECUTE MOVE         79900000
         LR    RAWORK,R4SCTPTR          INIT 'TO' POINTER               80000000
         LR    RBWORK,RAWORK            LOAD 'TO' POINTER IN REGISTER   80100000
         AR    RBWORK,R2WORK            INIT 'FROM' POINTER             80200000
         EX    RFWORK,MOVEITUP          MOVE UP SCT ENTRIES             80400000
         AR    RAWORK,RFWORK            ADD MOVE LENGTH TO 'FROM' PTR   80600000
         LA    RAWORK,N1(RAWORK)        RESTORE FULL LENGHT             80700000
         LR    RFWORK,R2WORK            LOAD SCT ENTRY LENGTH IN REG    80800000
         BCTR  RFWORK,N0                REDUCE FOR EXECUTE NULLING      80900000
         EX    RFWORK,NULLIT            NULL VACATED SCT ENTRY          81000000
         LA    R8DEL,N1(R8DEL)          BUMPER MSG REMOVED COUNTER      81200000
         SH    R3PTRA,DCMSCTCN          FLOAT QNUM DISPLAY LINE UP      81400000
         TM    DCMUTILT,DCMUTILB    PHASE B OF SEARCH                   81600000
         BOR   RERTN                YES, RETURN TO CALLER               81700000
         L     RFWORK,DCMDSAV       GET SEARCH'S SCT POINTER            81900000
         SH    RFWORK,DCMSCTCN      BACK UP ONE ENTRY                   82000000
         ST    RFWORK,DCMDSAV       SAVE IT FOR SEARCH                  82100000
MOVRTRN  BR    RERTN                    RETURN TO MAIN LINE PROCESSING  82300000
         EJECT                                                          82400000
*********************************************************************** 82500000
*        PROGRAM EQUATES                                              * 82600000
*********************************************************************** 82700000
ID1      EQU   C'E'                 1ST CHARACTER OF CSECT ID           82800000
ID2      EQU   C'J'                 2ND CHARACTER OF CSECT ID           82900000
N0       EQU   0                   DISPLACEMENT VALUE                   83000000
N1       EQU   1                   DISPLACEMENT VALUE                   83100000
N2       EQU   2                   DISPLACEMENT VALUE                   83200000
N3       EQU   3                   DISPLACEMENT VALUE                   83300000
N4       EQU   4                   DISPLACEMENT VALUE                   83400000
N8       EQU   8                   DISPLACEMENT VALUE                   83500000
N20      EQU   20                  LENGTH VALUE                         83600000
N256     EQU   256                 MAXIMUM MVC LENGTH         MB YM4391 83700000
LENDOM   EQU   8                   DOM ENTRY LENGTH           MB YM4391 83800000
AREAZ    EQU   C'Z'                     IN-LINE DISPLAY AREA            83900000
BIGA     EQU   C'A'                MAX VALUE FOR QNUM DISPLAY           84000000
BLANK    EQU   C' '                BLANK CHARACTER                      84100000
CODE8    EQU   X'01'                    DESCRIPTOR CODE 8               84200000
CODE9    EQU   X'80'                    DESCRIPTOR CODE 9               84300000
ROLDEL   EQU   C'D'                CHARACTER TO TEST FOR ROLL DELETE    84400000
ZERO     EQU   X'00'                    NULL VALUE                      84500000
ZONE     EQU   X'F0'               ZONE MASK FOR QNUM VALUE             84600000
         SPACE 5                                                        84700000
*********************************************************************** 84800000
*        PROGRAM CONSTANTS AND EXECUTED INSTRUCTIONS                  * 84900000
*********************************************************************** 85000000
DOMLEN   DC    H'8'                     LENGTH OF DOM ELEMENT ENTRY     85100000
MAXNUM   DC    H'99'                    MAXIMUM VALUE OF QNUM DISPLAY   85200000
H256     DC    H'256'              COMPARE AND SUBTRACT       MB YM4391 85300000
         SPACE 4                                                        85400000
BLANKIT  MVC   N1(N0,RAWORK),N0(RAWORK) TO BLANK VACATED MESSAGE LINES  85500000
MOVEITUP MVC   N0(N0,RAWORK),N0(RBWORK) TO MOVE UP ONE ENTITY           85600000
NULLIT   XC    N0(N0,RAWORK),N0(RAWORK) TO NULL VACATED SCT OR DOM      85700000
         EJECT                                                          85800000
*********************************************************************** 85900000
*        ALL DSECTS FOLLOW THIS POINT                                 * 86000000
*********************************************************************** 86100000
         IHACTM   CXSA                                                  86200000
         EJECT                                                          86300000
         IHACTM CQE                                                     86400000
         EJECT                                                          86500000
         IEECUCM  FORMAT=NEW                                            86600000
         EJECT                                                          86700000
         IEERDCM                                                        86800000
         EJECT                                                          86900000
         IEETDCM                                                        87000000
         EJECT                                                          87100000
         IHAWQE  DSECT=YES                                              87200000
         EJECT                                                          87300000
         END                                                            87400000
./  ADD  SSI=53380142,NAME=IEECVETK
IEECVETK CSECT                                                          00050002
         TITLE 'IEECVETK IGC5K07B TIMER-INTERPRETER'                    00150002
*********************************************************************** 00200002
*                                                                       00250002
*  STATUS    CHANGE LEVEL 1 VS2 RELEASE 2                               00300023
*                                                                       00310023
*   APARS FIXED ZA02835                                                 00320023
*                                                                       00350002
*  FUNCTION    THE PURPOSE OF THIS ROUTINE IS TO RESOLVE THE DIFFERENT  00400002
*            TIME INTERVALS AT WHICH ROLL MAY HAVE BEEN CHOSEN FOR THE  00450002
*            DIFFERENT DISPLAY CONSOLES.  THIS ROUTINE THUS GAINS       00500002
*            CONTROL FROM THE OPTIONS ROUTINE TO DETERMINE THE PROPER   00550002
*            TIME INTERVAL.  THIS ROUTINE ALSO GAINS CONTROL WHENEVER   00600002
*            THE TIMER HAS ELAPSED, TO FIND OUT AND INDICATE TO THE     00650002
*            PROCESSOR WHICH, IF ANY, OF THE DISPLAYS ARE READY TO BE   00700002
*            ROLLED.                                                    00750002
*                                                                       00800002
*  ENTRY POINT    CONTROL IS PASSED ONLY THROUGH THE CSECT LABEL,       00850002
*               IEECVETK.  THE FIRST EXECUTABLE INSTRUCTION IS LABELED  00900002
*               START.                                                  00950002
*                                                                       01000002
*  INPUT    THE VALUES IN TWO HALF-WORDS IN EACH DCM.                   01050002
*                                                                       01100002
*  OUTPUT    THE ABOVE VALUES, PLUS AN ADDITIONAL ONE IN THE BASE DCM.  01150002
*                                                                       01200002
* EXTERNAL REFERENCES NONE                                              01250002
*                                                                       01300002
*  EXITS - NORMAL  IEECVETH OR P OR R DEVICE-DEPENDENT IO               01350002
*                  IEECVET1 PROCESSOR ROUTINE                           01400002
*                  IEECVET2 DISPLAY 1                                   01450002
*                  IEECVETD MESSAGE 1                                   01500002
*                  IEECVETE MESSAGE 2                                   01550002
*                  IEECVETG OPEN-CLOSE                                  01600002
*                  THE PARTICULAR EXIT THIS ROUTINE MAKES, GENERALLY    01650002
*                  DEPENDS UPON BITS PREVIOUSLY SET BY OTHER ROUTINES.  01700002
*       - ERROR    NONE                                                 01750002
*                                                                       01800002
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         01850002
*                                                                       01900002
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      01950002
*                                                                       02000002
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      02050002
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       02100002
*              CHARACTER SET.                                           02150002
*                                                                       02200002
*********************************************************************** 02250002
         EJECT                                                          02300002
*********************************************************************** 02350002
*        REGISTER EQUATES                                             * 02400002
*********************************************************************** 02450002
XFBRANCH EQU   15                  BRANCH EXIT ADDRESS                  02500002
XERTRN   EQU   14                  BALR RETURN ADDRESS                  02550002
XFQUOTEN EQU   15                  ODD WORK REG FOR DIVIDEND            02600002
XEREMAIN EQU   14                  EVEN WORK REG FOR DIVIDEND           02650002
XDBDCM   EQU   13                  BASE DCM BASE REGISTER               02700002
XCPBASE  EQU   12                  PROGRAM BASE REGISTER                02750002
XBTDCM   EQU   11                  PAGEABLE DCM BASE REGISTER           02800002
XARDCM   EQU   10                  RESIDENT DCM BASE REGISTER           02850002
X9UCM    EQU   9                   UCM BASE REGISTER                    02900002
X8UCME   EQU   8                   UCM ENTRY BASE                       02950002
X7UCMLST EQU   7                   LAST UCM ENTRY FOR BXLE              03000002
X6UCMESZ EQU   6                   UCM ENTRY LENGTH FOR BXLE            03050002
X5ZERO   EQU   0                   FOR SETTING FIELDS TO ZERO           03100002
X4WORK   EQU   4                   TEMPORARY WORK REGISTER              03150002
X3LGCD   EQU   3                   LATEST G.C.D                         03200002
X2NGCD   EQU   2                   NEW G.C.D                            03250002
X1PARM   EQU   1                   CXSA ADDRESS                         03300002
         EJECT                                                          03550002
*********************************************************************** 03600002
*        PROGRAM INITIALIZATION                                       * 03650002
*********************************************************************** 03700002
         BALR  XCPBASE,N0          LOAD PROGRAM BASE REGISTER           03750002
         USING *,XCPBASE           ESTABLISH PROG ADDRESSABILITY        03800002
         USING UCMLIST,X8UCME      ESTABLISH UCMENTRY ADDRESSABILITY    03850002
         USING CXSA,X1PARM         ESTABLISH CXSA ADDRESSABILITY        03900002
         USING UCM,X9UCM           ESTABLISH UCM ADDRESSABILITY         03950002
         USING DCMTSRT,XARDCM      ESTABLISH R DCM ADDRESSABILITY       04000002
         USING DCMSTRT,XBTDCM      ESTABLISH DCM ADDRESS                04050002
         B     BEGIN               BYPASS PATCH AREA        JE @ZA02835 04060023
ICATCH   DC    CL8'IEECVETK'       MODULE NAME              JE @ZA02835 04070023
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY       JE @ZA02835 04080023
         DC    XL2'5056'           JULIAN DATE LAST CHANGE  JE @ZA02835 04090023
         DC    S(*)                                         JE @ZA02835 04092023
         DC    CL52'ZAPS'          PATCH AREA               JE @ZA02835 04094023
BEGIN    DS    0H                                           JE @ZA02835 04096023
         L     X8UCME,CSAUCM       UCM ENTRY BASE                       04100002
         L     X9UCM,CSACTLM       ADDRESS UCM BASE                     04110002
         L     XARDCM,UCMXB        RESIDENT DCM BASE                    04150002
         L     XBTDCM,DCMADTRN     PAGEABLE DCM BASE                    04200002
         L     XDBDCM,DCMSUBAD     ADDRESS IEECSUB                      04250002
         USING SUB,XDBDCM          TEMPORARY BASE FOR SUB CTL BLOCK     04300002
         L     XDBDCM,SUBPBASE     ADDRESS BASE DCM                     04350002
         USING DCMSTMR,XDBDCM      ESTABLISH BASE DCM ADDRESSABILITY    04400002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      04500002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    04550002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      04600002
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          04610002
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        04630002
         SR    X5ZERO,X5ZERO       REG OF ZEROS                         04650002
         LH    X2NGCD,DCMIVGCD     NEW GCD EQUALS OLD GCD               04700002
         TM    DCMTIMES,DCMOPTTI   ENTRY FROM OPTIONS ROUTINE           04850002
         BZ    ROUND               NO, DO NOT COMPUTE NEW GCD           04900002
         OI    DCMIND,DCMENTOP     IND THAT ENTRY FROM OPTIONS RTN      04950002
         TM    DCMTIMES,DCMOCTTI   IS DEVICE TO BE CLOSED               05000002
         BZ    NEW                 NO  BRANCH                           05050002
         MVI   DCMDEL,CHARY        CANCEL ROLL MODE                     05100002
         MVI   CSACODE,CSACLOSE    RESET CLOSE CODE                     05150002
NEW      SR    X3LGCD,X3LGCD       ZERO OUT LGCD REGISTER               05200002
         CLI   DCMDEL,CHARR        IS MODE NOW R OR RD                  05250002
         BE    IN                  YES, GO MOVE IN INTERVAL             05300002
         ST    X5ZERO,DCMINTVL     ZERO OUT COUNTERS                    05350002
         B     ROUND               BRANCH                               05400002
IN       MVC   DCMINTVL(N2),DCMRTME     MOVE IN INTVL OF THIS DCM       05450002
         EJECT                                                          05500002
*********************************************************************** 05550002
*        LOOP FOR SEARCHING OF DCMS                                   * 05600002
*********************************************************************** 05650002
ROUND    L     X8UCME,UCMVEA       ADDRESS FIRST UCM ENTRY              05700002
         LM    X6UCMESZ,X7UCMLST,UCMVEZ INCREMENT AND LIMIT BXLE REGS   05710002
         ST    XARDCM,DCMSVDCM     SAVE CURRENT DCM POINTER             05750002
LOOP1    TM    UCMATR,UCMUF        IS DEVICE ACTIVE                     05850002
         BZ    BX1                 NO, GET NEXT                         05900002
         TM    UCMDISP,UCMDISPC    IS THIS A GRAPHICS CONSOLE           05950002
         BZ    BX1                 NO GET NEXT ONE                      06000002
         L     XARDCM,UCMXB        GET RDCM ADDRESS                     06050023
         L     XBTDCM,DCMADTRN     GET TDCM ADDRESS         JE @ZA02835 06100023
         CLI   DCMDEL,CHARR        CONSOLE IN ROLL MODE     JE @ZA02835 06110023
         BNE   BX1                 NO, DON'T BOTHER WITH IT JE @ZA02835 06120023
         CH    X5ZERO,DCMINTVL    IS INTERVAL ZERO                      06150002
         BE    BX1                 YES, GET NEXT                        06200002
         TM    DCMIND,DCMSWCH      FIRST PASS THRU BXLE LOOP            06250002
         BO    SET                 NO, IGNORE NEXT TEST                 06300002
         TM    DCMIND,DCMENTOP     ENTRY FROM OPTIONS ROUTINE           06350002
         BZ    SET                 NO, BRANCH                           06400002
         B     MATH                YES, BRANCH                          06450002
BX1      BXLE  X8UCME,X6UCMESZ,LOOP1   GO GET NEXT ONE                  06500002
         L     XARDCM,DCMSVDCM     RESTORE CURRENT R DCM POINTER        06550002
         L     XBTDCM,DCMADTRN     RESTORE CURRENT T DCM POINTER        06600002
         TM    DCMIND,DCMSWCH      FIRST PASS THRU BXLE LOOP            06650002
         BO    NOTOP               NO, IGNORE NEXT TEST                 06700002
         TM    DCMIND,DCMENTOP     ENTRY FROM OPTIONS ROUTINE           06750002
         BZ    NOTOP               NO, BRANCH                           06800002
         OI    DCMIND,DCMSWCH      SET ON FIRST PASS FLAG               06850002
         EJECT                                                          06900002
*********************************************************************** 06950002
*        PROCESSING AFTER FIRST EXIT FROM LOOP                        * 07000002
*********************************************************************** 07050002
OPTIONS  LR    X2NGCD,X3LGCD       SAVE NEW GCD                         07100002
         TM    DCMTIMES,DCMTIMER   TIMER ELAPSED BIT ON                 07150002
         BO    ROUND               YES, BRANCH                          07200002
         TM    DCMIND,DCMTMRST     STIMER RUNNING BIT ON                07250002
         BZ    FULL                NO, LOOK FOR FULL SCREENS            07300002
         L     X4WORK,UCMPXA       POINT TO COMM TASK TCB     MH Y02137 07350002
         L     X4WORK,N120(X4WORK) GET TQE POINTER                      07550002
         LTR   X4WORK,X4WORK       VALID ADDRESS              MH Y02137 07560002
         BZ    FULL                 NO, RESTART TIMER         MH Y02137 07570002
         TM    N0(X4WORK),ONQUE    IS ELEMENT ON QUEUE                  07600002
         BO    FULL                NO, STIMER NOT ACTIVE                07650002
         STH   X2NGCD,DCMNEXTT     STORE GCD FOR NEXT STIMER            07700002
         OI    DCMINTI,DCMTMRCH    INDICATE INTERVAL CHANGE             07750002
         B     EXIT                DEPART                               07800002
FULL     STH   X5ZERO,DCMIVGCD     SET GCD TO ZERO                      07850002
         B     ROUND               SEE IF ANY SCREEN IS FULL            07900002
*                                                                       07950002
*        OPTIONS ENTRY PROCESSING                                       08000002
MATH     LH    XFQUOTEN,DCMINTVL   EXAMINE THIS DCMS INTERVAL           08050002
         LTR   X3LGCD,X3LGCD       IS THIS THE FIRST SO FAR             08100002
         BNZ   COMP                NO, COMPARE LAST 2 FOUND             08150002
         ST    X8UCME,DCMUAD       THIS IS ONLY ONE SO FAR              08200002
         LR    X3LGCD,XFQUOTEN     ITS INTERVAL IS THE LATEST GCD       08250002
         B     BX1                 LOOK FOR ANOTHER                     08300002
COMP     CR    X3LGCD,XFQUOTEN     LATEST EQUAL THIS INTERVAL           08350002
         BE    BX1                 YES, NO CHANGE POSSIBLE              08400002
         BL    DIV                 LATEST IS SMALLER, READY TO GO       08450002
         ST    X8UCME,DCMUAD       SMALLEST INTERVAL SO FAR             08500002
         LR    XEREMAIN,XFQUOTEN   START REG SWAP                       08510002
DIVAGAIN LR    XFQUOTEN,X3LGCD     LARGER NUMBER IS DIVIDEND            08550002
         LR    X3LGCD,XEREMAIN     SMALLER IS DIVISOR                   08600002
DIV      SR    XEREMAIN,XEREMAIN   CLEAR EVEN REGISTER                  08650002
         DR    XEREMAIN,X3LGCD     DIVIDE TO GET REMAINDER              08700002
         LTR   XEREMAIN,XEREMAIN   ANY REMAINDER                        08750002
         BZ    BX1                 NO, LAST REMAINDER IS LGCD           08800002
         B     DIVAGAIN            YES, SEE IF IT IS THE LAST           08850002
         EJECT                                                          09500002
*********************************************************************** 09550002
*        PROCESSING AFTER SECOND EXIT FROM LOOP                       * 09600002
*********************************************************************** 09650002
NOTOP    TM    DCMINTI,DCMTMRCH    HAS INTERVAL CHANGED                 09700002
         BZ    STME                NO, BRANCH                           09750002
         LH    X2NGCD,DCMNEXTT     PICK UP NEW TIME                     09800002
         NI    DCMINTI,N255-DCMTMRCH    SET OFF INDICATOR               09850002
STME     STH   X2NGCD,DCMIVGCD     STORE NEW GCD                        09900002
         MH    X2NGCD,HWC          CONVERT TO UNITS OF 0.01 SECONDS     09950002
         ST    X2NGCD,DCMSTMR      STORE FOR STIMER MACRO               10000002
         TM    DCMINTI,DCM1FULL    ARE ANY SCREENS FULL                 10050002
         BZ    EXIT                NO, DEPART                           10100002
         TM    DCMINTI,DCMDYRL     HAS AN STIMER BIT BEEN SET           10150002
         BO    EXIT                YES, DEPART                          10200002
         OI    DCMIND,DCMTMRST     SET ON STIMER RUNNING BIT            10250002
         STIMER  REAL,DCMSTART,BINTVL=DCMSTMR                           10350002
         B     EXIT                DEPART                               10400002
         SPACE 2                                                        10450002
*                                                                       10500002
*        PROCESSING SECOND SCANNING OF LOOP                             10550002
*                                                                       10600002
SET      TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL                       10650002
         BO    UPD                 YES, UPDATE COUNTER                  10700002
         CLI   DCMTOPDS,N0         IS DISPLAY ON SCREEN                 10750002
         BE    ZAP                 NO, ZERO OUT COUNTER                 10800002
         TM    DCMR2FLG,DCMRXUNV   IS UNVIEWABLE MSG DISPLAYED          10850002
         BO    UPD                 YES, UPDATE COUNTER                  10900002
ZAP      STH   X5ZERO,DCMTMCTR     ZERO OUT TIME COUNTER                10950002
         B     BX1                 RETURN TO LOOP                       11000002
UPD      OI    DCMINTI,DCM1FULL    SET ON ONE FULL SCREEN BIT           11050002
         LH    X4WORK,DCMIVGCD     GET CURRENT GCD                      11100002
         AH    X4WORK,DCMTMCTR     ADD IT TO TIME COUNTER               11150002
         CH    X4WORK,DCMINTVL     DOES TOTAL EQUAL INTERVAL            11200002
         BNL   GO                  YES, TRY TO POST                     11250002
         STH   X4WORK,DCMTMCTR     STORE UPDATED COUNTER VALUE          11300002
         B     BX1                 RETURN TO LOOP                       11350002
GO       TM    DCMINTI,DCMDYRL     STIMER BIT ON IN ANY DCM YET         11400002
         BO    ZER                 YES, CONTINUE                        11450002
         OI    DCMINTI,DCMDYRL     SET ON ONE READY TO ROLL             11500002
         OI    DCMR2FLG,DCMRXTMR   SET STIMER BIT ON IN DCM             11550002
ZER      OI    DCMR2FLG,DCMRXRLL   TURN ROLL BIT ON                     11600002
         STH   X5ZERO,DCMTMCTR     ZERO OUT TIME COUNTER                11700002
         C     XARDCM,DCMSVDCM     IS THIS DCM IN CONTROL               11750002
         BE    BX1                 YES, RETURN TO LOOP                  11800002
         TM    DCMR2FLG,DCMRXDEL   IS DELETION PENDING                  11850002
         BO    BX1                 YES, RETURN TO LOOP                  11900002
         TM    UCMSTS,UCMBF        BUSY BIT ON                          11950002
         BO    BX1                 YES, RETURN TO LOOP                  12000002
         CLI   UCMECB,X80          IS DEVICE WAITING                    12050002
         BE    POST                YES, POST IT                         12100002
         CLI   UCMECB,X00          IS DEVICE READY                      12150002
         BNE   BX1                 NO, RETURN TO LOOP                   12200002
POST     POST  UCMECB,255          POST UCME WITH CODE 255              12250002
         B     BX1                 RETURN TO LOOP                       12450002
         EJECT                                                          12500002
*********************************************************************** 14350002
*        DETERMINE WHERE TO GO AND TRANSFER CONTROL VIA BR 15         * 14400002
*********************************************************************** 14450002
EXIT     NI    DCMINTI,N255-DCM1FULL-DCMDYRL SET OFF FLAGS              14500002
         NI    DCMIND,N255-DCMSWCH-DCMENTOP  SET OFF FLAGS              14550002
         L     XFBRANCH,DCMNPROC   LOAD THE ADDRESS OF PROC 1           14560002
         TM    DCMTIMES,DCMOPTTI   ENTRY FROM OPTIONS ROUTINE           14600002
         BZ    XCTL                NO, EXIT TO IEECVET1                 14650002
         TM    DCMTIMES,DCMOCTTI   IS DEVICE TO BE CLOSED               14700002
         BO    SHUT                YES, ARRANGE FOR IT                  14750002
         TM    DCMOPTST,DCMOPRLL   IS ROLL MODE IN EFFECT               14800002
         BO    LABEL               YES, BRANCH                          14850002
         TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL                       14900002
         BZ    LABEL               NO, BRANCH                           14950002
         NI    DCMIOCM2,N255-DCMBLWRR   NOT WRITE RIGHT HALF WARNING    15000002
         OI    DCMCMSG1,DCMMSGWT   TURN ON MESSAGE WAITING BIT          15050002
LABEL    TM    DCMTIMES,DCMOTTMM   MSG MOD BIT SET                      15100002
         BZ    IO                  NO, EXIT TO I/O ROUTINE              15150002
         TM    DCMCMSG2,DCMASYRT+DCMASYCD    ASY ERROR CONDITION        15200002
         BM    MSG2                GO TO MSG MOD TWO                    15250002
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               15300002
         B     XCTL                EXIT TO IEECVETD                     15350002
MSG2     L     XFBRANCH,DCMNMSG2   LOAD MESSAGE 2 ADDRESS               15400002
         B     XCTL                EXIT TO IEECVETE                     15450002
SHUT     L     XFBRANCH,DCMNOPCL   LOAD OPEN/CLOSE ADDRESS              15500002
         B     XCTL                EXIT TO IEECVETG                     15550002
IO       L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              15600002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     15610002
XCTL     NI    DCMTIMES,N255-DCMTIMER-DCMOPTTI-DCMOTTMM-DCMOCTTI-DCMRMT*15650002
               TI                  SET OFF ALL TIMER FLAGS              15700002
         NI    DCMR2FLG,N255-DCMRXTIM   SET OFF TIMER ELAPSED FLAG      15750002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 15800002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             15850002
         EJECT                                                          15950002
*********************************************************************** 16000002
*        PROGRAM EQUATES AND CONSTANTS                                * 16050002
*********************************************************************** 16100002
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            16110002
ID2      EQU   C'K'                2ND CHARACTER OF CSECT ID            16120002
N0       EQU   0                   NUMBER                               16150002
N1       EQU   1                   NUMBER                               16200002
N2       EQU   2                   NUMBER                               16250002
N3       EQU   3                   NUMBER                               16300002
N4       EQU   4                   NUMBER                               16350002
N16      EQU   16                  CVT POINTER ADDRESS           S21003 16450002
N120     EQU   120                 DISPLACEMENT OF TCBTME        S21003 16500002
N255     EQU   255                 NUMBER                               16550002
X00      EQU   X'00'               NUMBER                               16600002
X80      EQU   X'80'               NUMBER                               16650002
BLANK    EQU   C' '                NUMBER                               16700002
CHARA    EQU   C'A'                NUMBER                               16750002
CHARR    EQU   C'R'                NUMBER                               16800002
CHARY    EQU   C'Y'                NUMBER                               16850002
HF0      EQU   X'F0'               NUMBER                               16900002
ONQUE    EQU   X'80'               TIMER ELEMENT NOT ON QUEUE    S21003 16950002
         SPACE 4                                                        17000002
HWC      DC    H'100'              VALUE                                17150002
*********************************************************************** 17550002
*        FLOW CHART STATEMENTS                                        * 17600002
*********************************************************************** 17650002
*/*IEECVETK: CHART */                                                   17700002
*/*%A: E (,%B) ENTRY POINT */                                           17750002
*/*%B: P (,%C) PROGRAM INITIALIZATION */                                17800002
*/*%C: D (YES,FINISH,NO,%D) ENTRY FROM ROLL ROUTINE */                  17850002
*/*%D: D (YES,%E,NO,ROUND) ENTRY FROM OPTIONS ROUTINE */                17900002
*/*%E: D (YES,%F,NO,NEW) IS DEVICE TO BE CLOSED */                      17950002
*/*%F: P (,NEW) CANCEL ROLL MODE */                                     18000002
*/*NEW: D (YES,IN,NO,%G) IS MODE NOW R OR RD */                         18050002
*/*%G: P (,ROUND) ZERO OUT COUNTERS */                                  18100002
*/*IN: P (,ROUND) MOVE IN INTERVAL OF THIS DCM */                       18150002
*/*ROUND: P (,LOOP1) INIT FOR SCAN */                                   18200002
*/*LOOP1: D (YES,%H,NO,BX1) IS DEVICE ACTIVE AND GRAPHIC */             18250002
*/*%H: D (YES,BX1,NO,%I) IS INTERVAL ZERO */                            18300002
*/*%I: D (YES,%J,NO,SET) FIRST PASS THRU LOOP */                        18350002
*/*%J: D (YES,MATH,NO,SET) ENTRY FROM OPTIONS ROUTINE */                18400002
*/*BX1: D (MORE,LOOP1,DONE,%K) EXECUTE BXLE */                          18450002
*/*%K: D (YES,%L,NO,NOTOP) FIRST PASS THRU LOOP */                      18500002
*/*%L: D (YES,OPTIONS,NO,NOTOP) ENTRY FROM OPTIONS ROUTINE */           18550002
*/*OPTIONS: D (YES,ROUND,NO,%M) TIMER ELAPSED FLAG ON */                18600002
*/*%M: D (YES,%N,NO,FULL) TIMER RUNNING FLAG ON */                      18650002
*/*%N: P (,EXIT) SAVE GCD FOR NEXT TIMER */                             18700002
*/*FULL: P (,ROUND) SET GCD TO ZERO */                                  18750002
*/*MATH: D (YES,%O,NO,COMP) THIS VALUE GT INTERVAL */                   18800002
*/*%O: P (,COMP) LOAD GREATER INTERVAL */                               18850002
*/*COMP: D (YES,BX1,NO,%P) LATEST GCD EQ INTERVAL */                    18900002
*/*%P: D (YES,%Q,NO,FIG) IS LATEST GCD ZERO */                          18950002
*/*%Q: P (,BX1) MOVE IN THIS INTERVAL */                                19000002
*/*FIG: P (,BX1) COMPUTE AND SAVE NEW GCD */                            19050002
*/*NOTOP: D (YES,%R,NO,STME) HAS INTERVAL CHANGED */                    19100002
*/*%R: P (,STME) PICK UP NEW TIME */                                    19150002
*/*STME: D (YES,%S,NO,EXIT) ARE ANY SCREENS FULL */                     19200002
*/*%S: D (YES,EXIT,NO,%T) HAS STIMER FLAG BEEN SET */                   19250002
*/*%T: P (,EXIT) ISSUE TIMER MACRO */                                   19300002
*/*SET: D (YES,UPD,NO,%U) IS SCREEN FULL */                             19350002
*/*%U: D (YES,%V,NO,ZAP) IS DISPLAY ON SCREEN */                        19400002
*/*%V: D (YES,UPD,NO,ZAP) IS UNVIEW. MSG. DISP. */                      19450002
*/*ZAP: P (,BX1) ZERO OUT TIME COUNTER */                               19500002
*/*UPD: D (YES,GO,NO,BX1) DOES TOTAL EQ INTERVAL */                     19550002
*/*GO: D (YES,%W,NO,NOTDCM) IS THIS DCM IN CORE */                      19600002
*/*%W: P (,NOTDCM) IND THAT DCM IS IN CORE */                           19650002
*/*NOTDCM: D (YES,NOTCORE,NO,%X) STIMER ON IN ANY DCM YET */            19700002
*/*%X: P (,NOTCORE) SET ON DCM TIMER FLAGS */                           19750002
*/*NOTCORE: D (YES,%Y,NO,BX1) ATTEMPT TO POST */                        19800002
*/*%Y: D (YES,POST,NO,BX1) IS POST POSSIBLE */                          19850002
*/*POST: P (,BX1) POST CONSOLE FOR ROLL */                              19900002
*/*FINISH: P (,ZIP) COMPUTE AND MOVE WQE COUNT TO DCM */                19950002
*/*ZIP: D (YES,IO,NO,%Z) WARNING MESSAGE REQUIRED */                    20000002
*/*%Z: P (,XCTL) SET OFF FULL SCREEN FLAG */                            20050002
*/*EXIT: D (YES,%AA,NO,XCTL) ENTRY FROM OPTIONS ROUTINE */              20100002
*/*%AA: D (YES,SHUT,NO,%BB) IS DEVICE TO BE CLOSED */                   20150002
*/*%BB: D (YES,LABEL,NO,%CC) IS ROLL MODE IN EFFECT */                  20200002
*/*%CC: D (YES,%DD,NO,LABEL) IS SCREEN FULL */                          20250002
*/*%DD: P (,LABEL) SET ON MESSAGE WAITING FLAG */                       20300002
*/*LABEL: D (YES,%EE,NO,IO) MSG MODULE FLAG SET */                      20350002
*/*%EE: D (YES,MSG2,NO,%FF) ASY. ERROR CONDITION */                     20400002
*/*%FF: P (,XCTL) INIT FOR MSG ONE EXIT */                              20450002
*/*MSG2: P (,XCTL) INIT FOR MSG TWO EXIT */                             20500002
*/*SHUT: P (,XCTL) INIT FOR OPEN/CLOSE EXIT */                          20550002
*/*IO: P (,XCTL) INIT FOR I/O MODULE EXIT */                            20600002
*/*XCTL: R XCTL TO PROPER DIDOCS MODULE */                              20650002
*/*IEECVETK: END */                                                     20700002
         EJECT                                                          20750002
*********************************************************************** 20800002
*        PROGRAM DSECTS                                               * 20850002
*********************************************************************** 20900002
         IHACTM  CXSA                                                   21000002
         EJECT                                                          21050002
         IHAPSA                                                         21060000
         EJECT                                                          21100000
         CVT    DSECT=YES                                               21102000
         EJECT                                                          21110000
         IEECUCM  FORMAT=NEW                                            21150002
         EJECT                                                          21160002
         IEERDCM                                                        21200002
         EJECT                                                          21300002
         IEETDCM                                                        21350002
         EJECT                                                          21450002
SUB      DSECT                                                          21500002
         IEECSUB  Y,Y,N,N,Y,Y                                           21550002
         END                                                            21600002
./  ADD  SSI=41200998,NAME=IEECVETP
         TITLE 'IEECVETP IGC5P07B 2250 IO 1'                            00050000
IEECVETP CSECT                                                          00100000
*/*IEECVETP: CHART */                                                   00150000
*/* HEADER                                                              00200000
*/*    CHART SA      IEECVETP     IGC5P07B                    DIDOCS    00250000
*/* 2250 I/O ROUTINE 1                               PAGE #          */ 00300000
*/* E IEECVETP */                                                       00350000
  SPACE   2                                                             00400000
* /* START OF SPECIFICATIONS ****                                       00450000
*02* PROCESSOR = ASSEMBLER;                                             00500000
**** END OF SPECIFICATIONS ***/                                         00550000
         EJECT                                                          00600000
* STATUS                                                                00650000
*    CHANGE LEVEL 1                                                     00700000
*    COMPLETELY REVISED FOR RELEASE 21, LINE ITEM S21003.               00750000
*                                                                       00800000
* FUNCTION                                                              00850000
*    THIS IS A DEVICE DEPENDENT ROUTINE TO PERMORM THE REQUESTED I/O IN 00900000
*    PROPER SCREEN FORMAT.                                              00950000
*                                                                       01000000
* ENTRY POINTS                                                          01050000
*         IEECVETP FOR ALL FUNCTIONS                                    01100000
*                                                                       01150000
* OPERATION                                                             01200000
*    THE COMMUNICATION BYTES IN THE DCM ARE CHECKED AGAINST             01250000
*    PRE-ESTABLISHED BIT SETTINGS TO DETERMINE WHICH TYPE/FORMAT OF     01300000
*    I/O IS TO BE PERFORMED. EACH POSSIBLE REQUEST IS CHECKED AND, IF   01350000
*    APPLICABLE, THE APPROPRIATE CCWS ARE BUILT UNTIL ALL OF THE        01400000
*    DESIRED I/O REQUESTS ARE SET UP IN THE CHANNEL PROGRAM. THEY MAY   01450000
*    BE TO: DO AN RMI, WRITE THE 'MESSAGE WAITING' MESSAGE, SOUND THE   01500000
*    CONSOLE ALARM, WRITE THE WARNING LINE, WRITE THE FULL MESSAGE AREA 01550000
*    AREA, WRITE THE PARTIAL MESSAGE AREA, WRITE THE INSTRUCTION LINE,  01600000
*    WRITE THE ENTRY AREA OR INSERT THE CURSOR. THEN THE I/O IS         01650000
*    INITIATED VIA AN EXCP AND CONTROL IS RETURNED TO PROCESSOR 1       01700000
*    (IEECVET1) IF THERE IS NO MORE WORK TO BE DONE, OTHERWISE          01750000
*    CONTROL IS PASSED TO 2250 I/O ROUTINE 2 (IEECVETQ).                01800000
*                                                                       01850000
* INPUT                                                                 01900000
*    THE INDICATION OF THE DESIRED I/O IS RECEIVED IN I/O               01950000
*    COMMUNICATION BYTES 1, 2 AND 3 AND MESSAGE COMMUNICATION           02000000
*    BYTE 1 IN THE DISPLAY CONTROL MODULE.                              02050000
*                                                                       02100000
* OUTPUT                                                                02150000
*                                                                       02200000
*    WRITING OF WHAT IS REQUESTED BY THE OTHER MODULES.                 02250000
* EXTERNAL REFERENCES                                                   02300000
*         MACROS USED: EXCP, XCTL                                       02350000
*                                                                       02400000
* EXITS, NORMAL                                                         02450000
*         IEECVET1 PROCESSOR 1 IF NO MORE WORK TO BE DONE.              02500000
*         IEECVETF LIGHT PEN CURSOR ROUTINE ON A LIGHT PEN DETECT.      02550000
*         IEECVETQ 2250 I/O ROUTINE 2 IF MORE WORK TO BE DONE.          02600000
*                                                                       02650000
* EXITS, ERROR                                                          02700000
*         NONE.                                                         02750000
         EJECT                                                          02800000
*                                                                       02850000
* TABLES/WORK AREAS                                                     02900000
*    DISPLAY CONTROL MODULE (CONTAINED IN DSECT AT END OF LISTING).     02950000
*                                                                       03000000
* ATTRIBUTES                                                            03050000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               03100000
*                                                                       03150000
* CHARACTER CODE DEPENDENCY                                             03200000
*    NONE.                                                              03250000
*                                                                       03300000
* NOTES                                                                 03350000
*    THE FOLLOWING FLAG BITS ARE USED:                                  03400000
*       THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF   03450000
*       OR JUST TESTED BY THIS MODULE.                                  03500000
*                                                                       03550000
*         NAME         ACTION                 FUNCTION                  03600000
*                                                                       03650000
*        DCMCMSG1                                                       03700000
*         DCMMSGWT   OFF/TEST      WRITE WAIT MESSAGE                   03750000
*        DCMCOM1                                                        03800000
*         DCMCOMRM      ON         RMI HAS BEEN PERFORMED               03850000
*        DCMIOUNQ                                                       03900000
*         DCMRDARM      ON         READ HAS BEEN PERFORMED              03950000
*        DCMIOCM1                                                       04000000
*         DCMDORMI   OFF/TEST      DO AN RMI                            04050000
*         DCMSOUND  ON/OFF/TEST    SOUND ALARM                          04100000
*         DCMWRWRN  ON/OFF/TEST    WRITE WARNING LINE                   04150000
*         DCMWRMSG   OFF/TEST      WRITE FULL MESSAGE AREA              04200000
*         DCMWRPAR   OFF/TEST      WRITE PARTIAL MESSAGE AREA           04250000
*         DCMWRINS   OFF/TEST      WRITE INSTRUCTION LINE               04300000
*         DCMINSC    OFF/TEST      INSERT CURSOR                        04350000
*         DCMWRENT   OFF/TEST      WRITE ENTRY AREA                     04400000
*        DCMIOCM2                                                       04450000
*         DCMBLWRR     OFF         BLANK WARNING LINE                   04500000
*        DCMIOCM3                                                       04550000
*         DCMOPRMI   OFF/TEST      RMI TO RESTORE KEYBOARD              04600000
*        DCMR3FLG                                                       04650000
*         DCMSTSWT   OFF/TEST      STATUS SWITCH REQUIRED               04700000
*********************************************************************** 04750000
         EJECT                                                          04800000
**************** REGISTER EQUATES *****************                     04850000
X1PARM   EQU   1                                                        04860000
XFBRANCH EQU   15                                                       04870000
XERTRN   EQU   14                                                       04920000
XPARM    EQU   1                   PARAMETER REGISTER                   04950000
XWORK4   EQU   1                   WORK REGISTER                        05000000
XDCMBASR EQU   2                   RESIDENT DCM BASE REG                05050000
XWORK1   EQU   3                   WORK REGISTER                        05100000
XWORK2   EQU   4                   WORK REGISTER                        05150000
XNULLEND EQU   4                   END FOR NULLING                      05200000
XPOINT   EQU   4                   WORK REGISTER                        05250000
XKEEP    EQU   5                   WORK REGISTER                        05300000
XWORK3   EQU   6                   WORK REGISTER                        05350000
XDCM2NDB EQU   7                   BASE FOR 2ND HALF OF DCM             05400000
XCHPGM   EQU   8                   POINTER TO CHANNEL PROGRAM AREA      05450000
X8       EQU   8                   WORK REGISTER                        05500000
XDCMBASE EQU   10                  DCM BASE REGISTER                    05550000
XBASE    EQU   11                  PROGRAM BASE REGISTER                05600000
XCXSA    EQU   12                  CXSA BASE REGISTER                   05650000
XUCMENT  EQU   13                  UCMENTRY BASE REGISTER               05700000
XRTRN    EQU   14                  RETURN REGISTER                      05750000
XXCTL    EQU   15                  XCTL REGISTER                        05800000
         EJECT                                                          05850000
START    BALR  XBASE,N0            SET UP                               05900000
         USING *,XBASE             ADDRESSABILITY                       05950000
         B     ICATCH              BRANCH AROUND EYECATCHER             06000000
         DC    C'   MODULE IGC5P07B, FICHE IEECVETP  ' EYECATCHER AND   06050000
ZAPAREA  DC    12C'ZAP'            RESERVED FOR FIELD MODIFICATION      06100000
ICATCH   LR    XCXSA,XPARM         SAVE CXSA ADDRESS                    06150000
         USING CXSA,XCXSA          DECLARE CXSA ADDRESS                 06200000
         L     XUCMENT,CSAUCM      GET UCM ENTRY ADDRESS                06300000
         USING UCMLIST,XUCMENT     DECLARE UCMENTRY BASE                06350000
         L     XDCMBASR,UCMXB      GET DCM POINTER                      06400000
         USING DCMTSRT,XDCMBASR                                         06450000
         L     XDCMBASE,DCMADTRN   TRANSIENT DCM LINKAGE                06500000
         USING DCMSTRT,XDCMBASE      DECLARE DCM BASE                   06550000
         L     XDCM2NDB,DCMLSCRN   GET 2ND HALF BASE                    06600000
         USING DCMMLAST,XDCM2NDB   DECLARE BASE                         06650000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06660000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    06670000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      06680000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          06690000
         LR    X1PARM,XCXSA        PASS CXSA ADDRESS IN REG 1           06692000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        06694000
         SPACE 5                                                        06700000
*/* P (,%STATSW)               CLEAR CHANNEL PROGRAM AREA */            06750000
************************************************************            06800000
         MVI   DCMCHPGM,N0         ZERO CHANNEL PROG AREA               06850000
         MVC   DCMCHPGM+N1(N111),DCMCHPGM   ZERO CHANNEL PROG. AREA     06900000
         L     X8,DCMADCHP         POINT TO CHANNEL PROGRAM             07000000
         SPACE 5                                                        07050000
*/*%STATSW: D (NO,RMIKBD,YES,CLN)   IS STATUS SWITCH BIT ON? */         07100000
************************************************************            07150000
         TM    DCMR3FLG,DCMSTSWT   IS STATUS SWITCH BIT ON              07200000
         BNO   RMIKBD               NO, TEST NEXT FUNCTION              07250000
         NI    DCMR3FLG,X'FF'-DCMSTSWT   YES, TURN IT OFF               07300000
         SPACE 5                                                        07350000
*/*CLN: R CLEANUP MODULE (IEECVFTG) */                                  07400000
************************************************************            07450000
         L     XFBRANCH,DCMNCLN        LOAD CLEANUP ROUTINE ADDRESS     07500000
         L     X1PARM,DCMCXSVE         RESTORE CXSA ADDRESS             07550000
         BR    XFBRANCH                EXIT TO IEECVFTG                 07600000
         SPACE 5                                                        07650000
*/*RMIKBD: D (NO,WAITWRT,YES,RMIKEYBD)   ENTRY TO UNLOCK KEYBOARD? */   07700000
************************************************************            07750000
RMIKBD   EQU   *                                                        07800000
         TM    DCMIOCM3,DCMOPRMI   SEE IF RMI                           07850000
         BO    RMIKEYBD             YES, GO DO IT                       07900000
         SPACE 5                                                        07950000
*/*WAITWRT: D (NO,BYTE1,YES,WRITWAIT) ENTRY TO WRITE 'MESSAGES WAITING' 08000000
*/*?*/                                                                  08050000
************************************************************            08100000
WAITWRT  EQU   *                                                        08150000
         TM    DCMCMSG1,DCMMSGWT   SEE IF WRITE WAIT MSG                08200000
         BO    WRITWAIT             YES-GO DO IT                        08250000
TSTBYTE1 EQU   *                                                        08300000
         TM    DCMIOCM1,ANYBIT     ANY WORK FOR THIS MODULE             08350000
         BC    ANYBT,BYTE1          YES - DO IT                         08400000
         SPACE 5                                                        08450000
*/*TSTBYTE2: D (NO,STREGEN,YES,IORTN2) ANY WORK FOR 2250 I/O 2? */      08500000
************************************************************            08550000
TSTBYTE2 EQU   *                                                        08600000
         TM    DCMIOCM2,ANYBIT     ANY WORK FOR MODULE 2A               08650000
         BC    ANYBT,IORTN2A        YES - DO IT                         08700000
TSTBYTE3 EQU   *                                                        08750000
         TM    DCMIOCM3,ANYBIT     ANY WORK FOR MODULE 2B               08800000
         BC    ANYBT,IORTN2B        YES - DO IT                         08850000
         B     STREGEN             GO TO RESTORE SCREEN                 08900000
         SPACE 5                                                        08950000
*/*BYTE1: D (NO,ALRMSND,YES,LGTPEN)       ENTRY FOR RMI? */             09000000
************************************************************            09050000
BYTE1    EQU   *                                                        09100000
         TM    DCMIOCM1,DCMDORMI   ENTRY FOR RMI                        09150000
         BO    LGTPEN               YES-SEE IF LIGHT PEN DETECT         09200000
         EJECT                                                          09250000
*/*ALRMSND: D (NO,WARNWRIT,YES,SOUNDALM)    ENTRY TO SOUND ALARM? */    09300000
************************************************************            09350000
ALRMSND  EQU   *                                                        09400000
         TM    DCMIOCM1,DCMSOUND   SOUND ALARM                          09450000
         BO    SOUNDALM             YES-GO DO IT                        09500000
         SPACE 5                                                        09550000
*/*WARNWRIT: D (NO,FULLWRT,YES,WRITWARN) ENTRY TO WRITE WARNING LINE?   09600000
*/**/                                                                   09650000
************************************************************            09700000
WARNWRIT EQU   *                                                        09750000
         TM    DCMIOCM1,DCMWRWRN   WRITE WARNING LINE                   09800000
         BO    WRITWARN             YES-GO WRITE IT                     09850000
         SPACE 5                                                        09900000
*/*FULLWRT: D (NO,PARTWRT,YES,FULLMSG) ENTRY TO WRITE FULL MESSAGE AREA 09950000
*/*?*/                                                                  10000000
************************************************************            10050000
FULLWRT  EQU   *                                                        10100000
         TM    DCMIOCM1,DCMWRMSG   WRITE FULL MESSAGE AREA              10150000
         BO    FULLMSG              YES-GO WRITE FULL                   10200000
         SPACE 5                                                        10250000
*/*PARTWRT: D (NO,INSTWRT,YES,PARTMSG) ENTRY TO WRITE PARTIAL MESSAGE   10300000
*/*AREA? */                                                             10350000
************************************************************            10400000
PARTWRT  EQU   *                                                        10450000
         TM    DCMIOCM1,DCMWRPAR   WRITE PARTIAL MESSAGE AREA           10500000
         BO    PARTMSG              YES-GO WRITE PARTIAL                10550000
         EJECT                                                          10600000
*/*INSTWRT: D (NO,ENTRYWRT,YES,WRITEINS) ENTRY TO WRITE INSTRUCTION     10650000
*/*LINE? */                                                             10700000
************************************************************            10750000
INSTWRT  EQU   *                                                        10800000
         TM    DCMIOCM1,DCMWRINS   WRITE INSTR LINE                     10850000
         BO    WRITEINS             YES-GO WRITE IT                     10900000
         SPACE 5                                                        10950000
*/*ENTRYWRT: D (NO,CURSORIN,YES,WRITENT) INSERT CURSOR OR WRITE ENTRY   11000000
*/*AREA? */                                                             11050000
************************************************************            11100000
ENTRYWRT EQU   *                                                        11150000
         TM    DCMIOCM1,DCMINSC    INSERT CURSOR                        11200000
         BO    WRITENT              YES-WRITE ENTRY AREA TO GET 1 CURS  11250000
         TM    DCMIOCM1,DCMWRENT   WRITE ENTRY AREA                     11300000
         BO    WRITENT              YES-GO WRITE IT                     11350000
         SPACE 5                                                        11400000
*/*CURSORIN: D (NO,TSTBYTE2,YES,INCURSOR) ENTRY FOR INSERT CURSOR? */   11450000
************************************************************            11500000
CURSORIN EQU   *                                                        11550000
         TM    DCMIOCM1,DCMINSC    INSERT CURSOR                        11600000
         BO    INCURSOR             YES GO DO IT                        11650000
         B     TSTBYTE2            GO TEST NEXT FUNCTION                11700000
         SPACE 5                                                        11750000
*/*IORTN2: R   2250 I/O ROUTINE 2 (IEECVETQ) */                         11800000
************************************************************            11850000
IORTN2A  EQU   *                                                        11900000
IORTN2B  EQU   *                                                        11950000
         ST    XCHPGM,DCMDSAV      SAVE PTR TO CHANNEL PROGRAM FOR IO2  12000000
         L     XFBRANCH,VCONIO2        LOAD SECOND LOAD ADDRESS         12050000
         L     X1PARM,DCMCXSVE         RESTORE CXSA ADDRESS             12100000
         BR    XFBRANCH                EXIT TO IEECVETQ                 12110000
         EJECT                                                          12150000
*/*WRITWAIT: P (,BYTE1) MOVE MSG IN. INDICATE WRITE WARN AND SOUND      12200000
*/*ALARM */                                                             12250000
************************************************************            12300000
WRITWAIT EQU   *                                                        12350000
         MVI   DCMWARN+N37,BLANK   MOVE BLANK IN                        12400000
         MVC   DCMWARN+N38(N35),DCMWARN+N37 PROPAGATE IT                12450000
         MVC   DCMWARN+N51(N23),WAITMSG MOVE IN WAIT MSG                12500000
         NI    DCMCMSG1,N255-DCMMSGWT TURN BIT OFF                      12550000
         NI    DCMIOCM2,X'FF'-DCMBLWRR DON'T ERASE WARNING LINE         12600000
         OI    DCMIOCM1,DCMSOUND+DCMWRWRN   WRITE LINE AND SOUND ALARM  12650000
         B     TSTBYTE1                GO TEST NEXT FUNCTION            12700000
         SPACE 5                                                        12750000
*/*LGTPEN: D (NO,RMIKEYBD,YES,XYCOOR)      LIGHT PEN DETECT? */         12800000
************************************************************            12850000
LGTPEN   EQU   *                                                        12900000
         NI    DCMIOCM1,N255-DCMDORMI TURN OFF BIT TO INDICATE RMI      12950000
         L     XWORK1,UCMUCB                                            13000000
         USING UCBOB,XWORK1        UCB ADDRESSABILITY         MB YM5671 13010000
         TM    UCBSNS+N1,LPDET                                MB YM5671 13050000
         BO    XYCOOR              YES-GET X,Y COORDINATES              13100000
         OI    DCMIOUNQ,DCMRDARM   INDICATE READ MUST BE PERFORMED      13150000
         OI    DCMCOM1,DCMCOMRM    INDICATE RMI HAS BEEN PERFORMED      13200000
         SPACE 5                                                        13250000
*/*RMIKEYBD: P (,WAITWRT)     BUILD RMI CCW */                          13300000
************************************************************            13350000
RMIKEYBD EQU   *                                                        13400000
         LA    XWORK1,DCMDSAV      GET ADDRESS OF RMI READ AREA         13450000
         ST    XWORK1,DCMCHPGM     PUT RMI ADDR IN CHANNEL PGM          13500000
         MVI   DCMCHPGM,RMICODE    PUT RMI CODE IN  CHANNEL PROGRAM     13550000
         MVI   DCMCHPGM+N7,N3      PUT BYTE COUNT IN                    13600000
         MVI   DCMCHPGM+N4,CHAIN   CHAIN CCW                            13650000
         NI    DCMIOCM3,N255-DCMOPRMI TURN OFF BIT TO UNLOCK KEYBOARD   13700000
         LA    XCHPGM,N8(XCHPGM)   UPDATE CCW PTR                       13750000
         B     WAITWRT             GO TO TEST NEXT FUNCTION             13800000
         EJECT                                                          13850000
*/*XYCOOR: P (,%LPCURSX) GET X,Y COORDINATES & SAVE LINE & CHARACTER    13900000
*/*POSITION */                                                          13950000
*/*%LPCURSX: R    L/P CURSOR  (IEECVETF) */                             14000000
************************************************************            14050000
XYCOOR   EQU   *                                                        14100000
         LH    XWORK2,UCBSNS+N2    XY DATA FOR LP DETECT      MB YM5671 14150000
         SH    XWORK2,DCMWARN+N76  GET START OF BUFFER                  14200000
         SLA   XWORK2,N19          ISOLATE ADDRESS                      14250000
         SRDA  XWORK2,N51          GET BEFINNING OF BUFFER              14300000
         SH    XKEEP,H10           ALLOW FOR GRAPHIC ORDERS             14350000
         D     XWORK2,F74          DIVIDE BY LINE LENGTH                14400000
         STC   XWORK2,DCMDSAV+N1   SAVE CHAR POS IN LINE                14450000
         STC   XKEEP,DCMDSAV       SAVE LINE NUMBER                     14500000
         MVI   UCBSNS+N1,N0        ZERO LP INDICATOR IN UCB   MB YM5671 14550000
         L     XFBRANCH,DCMNLPCR   LOAD LIGHT-PEN/CURSOR ADDRESS        14600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 14650000
         BR    XFBRANCH            EXIT TO IEECVETF                     14660000
         SPACE 5                                                        14700000
*/*SOUNDALM: P (,WARNWRIT) BUILD SOUND ALARM CCW */                     14750000
************************************************************            14800000
SOUNDALM EQU   *                                                        14850000
         NI    DCMIOCM1,N255-DCMSOUND                                   14900000
         MVI   N0(XCHPGM),SOUND    PUT OP CODE INTO CCW                 14950000
         MVI   N4(XCHPGM),CHAIN    CHAIN CCWS                           15000000
         MVI   N7(XCHPGM),N2       DATA BYTES                           15050000
         LA    XCHPGM,N8(XCHPGM)   UPDATE CCW ADDR                      15100000
         B     WARNWRIT            SEE IF WRITE WARNING LINE            15150000
         EJECT                                                          15200000
*/*WRITWARN: P (,FULLWRT) BUILD WRITE WARNING LINE CCWS */              15250000
************************************************************            15300000
WRITWARN EQU   *                                                        15350000
         NI    DCMIOCM1,N255-DCMWRWRN TURN OFF WARNING LINE BIT         15400000
         LA    XPOINT,DCMBAWRN     WARNING LINE BUFFER ADDRESS          15450000
         BAL   XRTRN,BUILDSET      BUILD SET BUFFER CCW                 15500000
         LA    XKEEP,DCMWARN       WARNING LINE                         15550000
         LH    XWORK1,H78          LENGTH OF WRITE                      15600000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      15650000
         B     FULLWRT             GO TEST NEXT FUNCTION                15700000
         EJECT                                                          15750000
*/*FULLMSG: P (,NULLMSG) BUILD WRITE FULL SCREEN CCWS */                15800000
************************************************************            15850000
FULLMSG  EQU   *                                                        15900000
         NI    DCMIOCM1,N255-DCMWRMSG-DCMWRPAR TURN BITS OFF            15950000
         LA    XPOINT,DCMBASRT     GET PTR TO SCREEN IMAGE BUFFER       16000000
         BAL   XRTRN,BUILDSET      BUILD SET BUFFER CCW                 16050000
         L     XWORK1,DCMWTBUF     END OF BUFFER                        16100000
         LA    XKEEP,DCMSRT        BEGINNING ORDERS                     16150000
         SR    XWORK1,XKEEP                                             16200000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCWS                     16250000
         BAL   XRTRN,NULLMSG       GO TO INSERT NULLS                   16300000
         B     INSTWRT             GO TEST NEXT FUNCTION                16350000
         SPACE 5                                                        16400000
*/*NULLMSG: P (,INSTWRT) NULL EACH LINE BEYOND TEXT */                  16450000
************************************************************            16500000
NULLMSG  EQU   *                                                        16550000
         LH    XKEEP,DCMMSGAL      TOTAL MSGS                           16600000
         L     XWORK4,DCMLSCRN     LAST MSG LINE                        16650000
         AH    XWORK4,DCMCORLN     END OF MSGS                          16700000
         BCTR  XWORK4,N0           LAST CHACTER OF MSGS                 16750000
         LR    XWORK1,XWORK4                                            16800000
         LH    XNULLEND,NULLNG     NUMBER OF CHARACTERS TO NULL         16850000
LOOP     EQU   *                                                        16900000
         CLI   N0(XWORK4),NEWLINE  IS LAST CHAR N/L                     16950000
         BE    NEXTCHAR             YES, CHECK FOR BLANKS               17000000
         CLI   N0(XWORK4),BLANK    IS CHAR BLANK                        17050000
         BNE   NEXTLINE             NO, LINE FULL OF DATA               17100000
         MVI   N0(XWORK4),NEWLINE   YES, REPLACE WITH N/L CHAR          17150000
NEXTCHAR BCTR  XWORK4,N0           LOOK AT NEXT CHAR                    17200000
         CLI   N0(XWORK4),BLANK    IS IT BLANK                          17250000
         BNE   NEXTLINE             NO, DATA HAS BEEN REACHED           17300000
         MVI   N0(XWORK4),NULL      YES, REPLACE IT WITH NULL           17350000
         BCT   XNULLEND,NEXTCHAR   END OF CHAR SEARCH TO NULL           17400000
NEXTLINE EQU   *                                                        17450000
         LH    XNULLEND,NULLNG     REINIT NULLING LENGTH                17500000
         SH    XWORK1,DCMCORLN     LOOK AT NEXT LINE                    17550000
         LR    XWORK4,XWORK1       INITIALIZE CHAR POINTER              17600000
         BCT   XKEEP,LOOP          CHECK FOR END OF LINES               17650000
         BR    XRTRN                YES, RETURN TO CALLER               17700000
         EJECT                                                          17750000
*/*PARTMSG: P (,INSTWRT) BUILD WRITE PARTIAL CCWS */                    17800000
************************************************************            17850000
PARTMSG  EQU   *                                                        17900000
         NI    DCMIOCM1,N255-DCMWRPAR TURN OFF BIT                      17950000
         SR    XWORK1,XWORK1       CLEAR WORK1 REG                      18000000
         LH    XPOINT,DCMBAM1      GET START OF MSG AREA                18050000
         IC    XWORK1,DCMLINEN     GET LINE NO                          18100000
         BCTR  XWORK1,N0           DECREMENT BY 1                       18150000
         MH    XWORK1,DCMCORLN     GET INDEX                            18200000
         LR    XWORK3,XWORK1       SAVE LENGTH                          18250000
         AR    XWORK1,XPOINT       ADD BEGINNING ADDR TO GET ID ADDR    18300000
         STH   XWORK1,DCMBADLN     HOLD IN BUFFER ADDR AREA             18350000
         LA    XPOINT,DCMBADLN     POINT TO BUFFER ADDR AREA            18400000
         BAL   XRTRN,BUILDSET      BUILD SET BUF CCW                    18450000
         L     XKEEP,DCMASCRN      POINT TO START OF MESSAGE AREA       18500000
         AR    XKEEP,XWORK3        POINT TO LINE TO WRITE FROM          18550000
         LH    XWORK1,DCMBYTCT     GET WRITE LENGTH                     18600000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      18650000
         BAL   XRTRN,NULLMSG       GO TO INSERT NULLS                   18700000
         B     INSTWRT             GO TEST NEXT FUNCTION                18750000
         SPACE 5                                                        18800000
*/*WRITEINS: P (,ENTRYWRT) BUILD WRITE INSTRUCTION LINE CCWS */         18850000
************************************************************            18900000
WRITEINS EQU   *                                                        18950000
         NI    DCMIOCM1,N255-DCMWRINS TURN OFF INS LINE WRITE BIT       19000000
         LA    XPOINT,DCMBAINS     POINT TO BUFFER ADDRESS INS LINE     19050000
         BAL   XRTRN,BUILDSET      BUILD SET BUF CCW                    19100000
         L     XKEEP,DCMAINS       GET ADDR TO WRITE FROM               19150000
         LH    XWORK1,H74          GET WRITE LENGTH                     19200000
         AH    XWORK1,TWO          ADD LENGTH OF GRAPHIC ORDER          19250000
         BAL   XRTRN,BUILDWRT      BUILD WRITE SCREEN CCW               19300000
         B     ENTRYWRT            SEE IF ENTRY AREA IS TO BE WRITTEN   19350000
         EJECT                                                          19400000
*/*WRITENT: P (,CURSORIN) BUILD WRITE ENTRY AREA CCWS */                19450000
************************************************************            19500000
WRITENT  EQU   *                                                        19550000
         NI    DCMIOCM1,N255-DCMWRENT TURN OFF WRITE ENTRY AREA BIT     19600000
         LA    XPOINT,DCMBAENT     POINT TO ENTRY AREA BUFFER ADDRESS   19650000
         BAL   XRTRN,BUILDSET      BUILD                                19700000
         LA    XKEEP,DCMENTRY      ADDRESS OF ENTRY AREA                19750000
         LH    XWORK1,DCMCORLN     GET LENGTH OF ONE LINE               19800000
         SLL   XWORK1,N1           DOUBLE LENGTH                        19850000
         AH    XWORK1,TWO          ADD LENGTH OF GRAPHIC ORDER          19900000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      19950000
         B     CURSORIN            SEE IF INSERT CURSOR                 20000000
         EJECT                                                          20050000
*/*INCURSOR: P (,TSTBYTE2) BUILD INSERT CURSOR CCWS */                  20100000
************************************************************            20150000
INCURSOR EQU   *                                                        20200000
         NI    DCMIOCM1,N255-DCMINSC TURN OFF BIT                       20250000
         SR    XWORK1,XWORK1       CLEAR WORK REG                       20300000
         IC    XWORK1,DCMCULNO     GET LINE NUMBER                      20350000
         BCTR  XWORK1,N0           DECREMENT IT BY ONE                  20400000
         MH    XWORK1,DCMCORLN                                          20450000
         LH    XKEEP,DCMBAENT      GET ENTRY AREA BUFFER ADDR           20500000
         AR    XKEEP,XWORK1        GET CORRECT ENTRY AREA LINE          20550000
         IC    XWORK1,DCMPOSCU     GET CHARACTER POSITION               20600000
         BCTR  XWORK1,N0           DECREMENT BY ONE                     20650000
         AR    XKEEP,XWORK1        GET ADDRESS TO INS CURSOR            20700000
         STH   XKEEP,DCMBAINC                                           20750000
         LA    XPOINT,DCMBAINC     GET PTR FOR INSERT CURSOR            20800000
         BAL   XRTRN,BUILDSET      BUILD SET BUFFER CCW                 20850000
         MVI   N0(XCHPGM),INSERT   PUT OP CODE IN                       20900000
         BAL   XRTRN,INCCW         BUILD CCW                            20950000
         B     TSTBYTE2            GO TEST NEXT FUNCTION                21000000
         SPACE 5                                                        21050000
BUILDSET EQU   *                                                        21100000
         ST    XPOINT,N0(XCHPGM)   PUT BUF ADD PTR INTO CCW             21150000
         MVI   N0(XCHPGM),SETBUF   PUT COMMAND CODE INTO CCW            21200000
INCCW    EQU   *                                                        21250000
         MVI   N4(XCHPGM),CHAIN    CHAIN CCW'S                          21300000
         MVI   N7(XCHPGM),N2       PUT BYTE COUNT IN                    21350000
         LA    XCHPGM,N8(XCHPGM)   UPDATE CCW POINTER                   21400000
         BR    XRTRN               RETURN TO CALLER                     21450000
BUILDWRT EQU   *                                                        21500000
         ST    XKEEP,N0(XCHPGM)    SAVE WRITE FROM ADDRESS              21550000
         MVI   N0(XCHPGM),WRITE    PUT OP CODE IN CCW                   21600000
         MVI   N4(XCHPGM),CHAIN    CHAIN CCW'S                          21650000
         STH   XWORK1,N6(XCHPGM)   PUT BYTE COUNT IN                    21700000
         LA    XCHPGM,N8(XCHPGM)   UPDATE CCW POINTER                   21750000
         BR    XRTRN               RETURN                               21800000
         EJECT                                                          21850000
*/*STREGEN: P (,ENEXCP) BUILD START REGEN CCW */                        21900000
************************************************************            21950000
STREGEN  EQU   *                                                        22000000
         LA    XWORK1,DCMBASRT     GET START OF REGEN                   22050000
         ST    XWORK1,N0(XCHPGM)   PUT ADDRESS IN CCW                   22100000
         MVI   N0(XCHPGM),STARTREG MOVE OP CODE IN                      22150000
         MVI   N4(XCHPGM),CHAIN    PUT CHAIN CCW                        22200000
         MVI   N7(XCHPGM),N2       MOVE BYTE COUNT IN                   22250000
         LA    XCHPGM,N8(XCHPGM)   UPDATE CCW POINTER                   22300000
         B     ENEXCP              GO TO STOP CCW AND EXIT              22350000
         SPACE 5                                                        22400000
*/*ENEXCP: P (,EXCP) REMOVE CHAIN FLAG FROM LAST CCW */                 22450000
************************************************************            22500000
ENEXCP   EQU   *                                                        22550000
         SH    XCHPGM,EIGHT        UPDATE CCW POINTER                   22600000
         MVI   N4(XCHPGM),STOP     STOP CCW CHAIN                       22650000
         SPACE 5                                                        22700000
*/*EXCP: I (,%PRCEXIT)  EXCP */                                         22750000
************************************************************            22800000
EXCP     EQU   *                                                        22850000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBR       JE YM8371 22860003
         LR    X1PARM,XCXSA        PASS CXSA ADDRESS IN REG 1 JE YM8371 22870003
         BALR  XERTRN,XFBRANCH     OBTAIN  LOCKS              JE YM8371 22880003
         XC    UCMECB,UCMECB       CLEAR ECB                            22950003
         OI    UCMSTS,UCMBF        TURN ON BUSY BIT                     22960003
         L     XWORK1,UCMDCB       GET DCB ADDRESS                      23000000
         L     XWORK1,N28(XWORK1)  GET IOB ADDRESS                      23050000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBR      JE YM8371 23060003
         LR    X1PARM,XCXSA        PASS CXSA ADDRESS IN REG 1 JE YM8371 23070003
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS              JE YM8371 23080003
         EXCP  (XWORK1)            INITIATE I/O                         23100000
         SPACE 5                                                        23200000
*/*%PRCEXIT: R  PROCESSOR 1 (IEECVET1) */                               23250000
************************************************************            23300000
EXIT     EQU   *                                                        23350000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  23400000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 23450000
         BR    XFBRANCH            EXIT TO IEECVET1                     23500000
         EJECT                                                          23600000
*     CONSTANTS                                                         23650000
VCONIO2  DC    V(IEECVETQ)         SECOND LOAD ADDRESS                  23660000
EIGHT    DC    H'8'                COUNT FOR UPDATE CCW PTR             23700000
F74      DC    F'74'               LENGTH OF ONE LINE                   23750000
H10      DC    H'10'               MINIMUM SHIFT LENGTH                 23800000
H74      DC    H'74'               LENGTH FOR INSTR WRITE               23850000
H78      DC    H'78'               LENGTH OF WARNING LINE WRITE         23900000
NULLNG   DC    H'69'               NULLING LENGTH                       23950000
TWO      DC    H'2'                INDEX FACTOR FOR COUNTS              24000000
WAITMSG  DC    C'IEE159E MESSAGE WAITING' MSGS WAITING WARNING          24050000
*        EQUATES                                                        24100000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            24110000
ID2      EQU   C'P'                2ND CHARACTER OF CSECT ID            24120000
ANYBIT   EQU   X'FF'               MASK TO TEST ALL BITS                24150000
ANYBT    EQU   7                   BRANCH IF ANY BIT ON                 24200000
BLANK    EQU   X'40'               BLANK                                24250000
CHAIN    EQU   X'60'               CHAIN CCW CODE                       24300000
INSERT   EQU   X'0F'               INSERT CURSOR                        24350000
LPDET    EQU   X'A0'               BIT FOR LP DETECT                    24400000
NEWLINE  EQU   X'15'                                                    24450000
NULL     EQU   X'00'               NULL CHARACTER                       24500000
N0       EQU   0                   NUMBER                               24550000
N1       EQU   1                   NUMBER                               24600000
N2       EQU   2                   NUMBER                               24650000
N3       EQU   3                   NUMBER                               24700000
N4       EQU   4                   NUMBER                               24750000
N6       EQU   6                   NUMBER                               24800000
N7       EQU   7                   NUMBER                               24850000
N8       EQU   8                   NUMBER                               24900000
N19      EQU   19                  NUMBER                               24950000
N23      EQU   23                  NUMBER                               25000000
N24      EQU   24                  NUMBER                               25050000
N28      EQU   28                  NUMBER                               25100000
N35      EQU   35                  NUMBER                               25150000
N37      EQU   37                  NUMBER                               25200000
N38      EQU   38                  NUMBER                               25250000
N51      EQU   51                  NUMBER                               25300000
N76      EQU   76                  NUMBER                               25350000
N111     EQU   111                 LENGTH OF CCW AREA MINUS ONE         25400000
N255     EQU   255                 NUMBER                               25450000
RMICODE  EQU   X'0E'               RMI CODE                             25500000
SETBUF   EQU   X'07'               STOP REGEN CODE                      25550000
SOUND    EQU   X'0B'               SOUND ALARM                          25600000
STARTREG EQU   X'27'               START REGEN CODE                     25650000
STOP     EQU   X'20'               STOP CCW CODE                        25700000
WRITE    EQU   X'01'               WRITE                                25750000
         SPACE 5                                                        25800000
*/*IEECVETP: END */                                                     25850000
         SPACE 2                                                        25900000
         TITLE 'IEECVETP   IGC5P07B    2250 I/O 1   RESIDENT DISPLAY CO*25950000
               NTROL MODULE'                                            26000000
         IEERDCM                                                        26050000
         TITLE 'IEECVETP   IGC5P07B    2250 I/O 1   PAGEABLE DISPLAY C *26150000
               ONTROL MODULE'                                           26200000
DCMSTRT  DSECT                                                          26250000
         IEECDCM  DEVICE=B                                              26300000
         TITLE 'IEECVETP   IGC5P07B    2250 I/O 1      CXSA'            26350000
         IHACTM  CXSA                                                   26450000
         TITLE 'IEECVETP   IGC5P07B    2250 I/O 1      UCB'             26460000
ETPUCB   DSECT                                                          26470000
         IEFUCBOB                                                       26480000
         TITLE 'IEECVETP   IGC5P07B    2250 I/O 1      UNIT CONTROL MOD*26500000
               ULE'                                                     26550000
         IEECUCM  FORMAT=NEW                                            26650000
         END                                                            26700000
./  ADD  SSI=41200999,NAME=IEECVETQ
         TITLE 'IEECVETQ IGC5Q07B 2250 IO 2'                            00050000
IEECVETQ CSECT                                                          00100000
*A194100,194200                                               MH Y01566 00100403
*A086100,086200                                               MH Y01563 00102003
*C 271500                                                    ME SA52709 00110018
         EJECT                                                          00150000
*/*IEECVETQ: CHART */                                                   00200000
*/* HEADER                                                              00250000
*/*       CHART TA     IEECVETQ     IGC5Q07B          DIDOCS 2250 I/    00300000
*/*O ROUTINE 2                                          PAGE #      */  00350000
*/* E IEECVETQ */                                                       00400000
         SPACE 2                                                        00450000
* /* START OF SPECIFICATIONS ****                                       00500000
*02* PROCESSOR = ASSEMBLER ;                                            00550000
**** END OF SPECIFICATIONS ***/                                         00600000
         EJECT                                                          00650000
* STATUS                                                                00700000
*    CHANGE LEVEL 1                                                     00750000
*    COMPLETE REVISION FOR RELEASE 21, LINE ITEM S21003.                00800000
* FUNCTION                                                              00850000
*    THIS IS A DEVICE DEPENDENT ROUTINE TO PERMORM THE REQUESTED I/O IN 00900000
*    PROPER SCREEN FORMAT.                                              00950000
*                                                                       01000000
* ENTRY POINTS                                                          01050000
*         IEECVETQ FOR ALL FUNCTIONS                                    01100000
*                                                                       01150000
* OPERATION                                                             01200000
*    THE COMMUNICATION BYTES IN THE DCM ARE CHECKED AGAINST             01250000
*    PRE-ESTABLISHED BIT SETTINGS TO DETERMINE WHICH TYPE/FORMAT OF     01300000
*    I/O IS TO BE PERFORMED. EACH POSSIBLE REQUEST IS CHECKED AND, IF   01350000
*    APPLICABLE, THE APPROPRIATE CCWS ARE BUILT UNTIL ALL OF THE        01400000
*    DESIRED I/O REQUESTS ARE SET UP IN THE CHANNEL PROGRAM. THEY MAY   01450000
*    BE TO: BLANK THE ENTRY AREA, BLANK THE WARNING LINE, INITIALIZE    01500000
*    THE INSTRUCTION LINE, READ THE ENTRY AREA, WRITE THE               01550000
*    INFORMATIONAL DISPLAY, ERASE THE SCREEN, WRITE THE ASYNCHRONOUS    01600000
*    ERROR MESSAGE, WRITE THE PFK LINE OR LIGHT THE PFKS. I/O IS THEN   01650000
*    INITIATED VIA AN EXCP AND CONTROL IS RETURNED TO PROCESSOR 1       01700000
*    (IEECVET1).                                                        01750000
*                                                                       01800000
* INPUT                                                                 01850000
*    THE INDICATION OF THE DESIRED I/O IS RECEIVED IN I/O               01900000
*    COMMUNICATION BYTES 2 AND 3 IN THE DISPLAY CONTROL MODULE.         01950000
*                                                                       02000000
* OUTPUT                                                                02050000
*    WRITING OF WHAT IS REQUESTED BY THE OTHER MODULES.                 02100000
*                                                                       02150000
* EXTERNAL REFERENCES                                                   02200000
*         NONE.                                                         02250000
*                                                                       02300000
* EXITS, NORMAL                                                         02350000
*         IEECVET1 PROCESSOR 1 WHEN WORK IS COMPLETE.                   02400000
*                                                                       02450000
* EXITS, ERROR                                                          02500000
*         NONE.                                                         02550000
*                                                                       02600000
* TABLES/WORK AREAS                                                     02650000
*    DISPLAY CONTROL MODULE (CONTAINED IN DSECT AT END OF LISTING).     02700000
*                                                                       02750000
* ATTRIBUTES                                                            02800000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               02850000
*                                                                       02900000
* CHARACTER CODE DEPENDENCY                                             02950000
*    NONE.                                                              03000000
*                                                                       03050000
* NOTES                                                                 03100000
*    THE FOLLOWING FLAG BITS ARE USED:                                  03150000
*       THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF   03200000
*       OR JUST TESTED BY THIS MODULE.                                  03250000
*                                                                       03300000
*         NAME         ACTION                 FUNCTION                  03350000
*                                                                       03400000
*        DCMCOM1                                                        03450000
*         DCMIOPRD      ON         READ HAS BEEN PERFORMED              03500000
*        DCMIOCM2                                                       03550000
*         DCMBLENT   OFF/TEST      BLANK ENTRY AREA                     03600000
*         DCMBLWRL   OFF/TEST      BLANK LEFT HALF WARNING LINE         03650000
*         DCMBLWRR   OFF/TEST      BLANK RIGHT HALF WARNING LINE        03700000
*         DCMINSSH   OFF/TEST      INITIALIZE INSTRUCTION LINE          03750000
*         DCMWINFD   OFF/TEST      WRITE INFORMATION DISPLAY            03800000
*         DCMERASE   OFF/TEST      ERASE SCREEN                         03850000
*         DCMIOCRD   OFF/TEST      READ ENTRY AREA                      03900000
*         DCMWRASY   OFF/TEST      WRITE ASYNCHRONOUS ERROR MESSAGE     03950000
*        DCMIOCM3                                                       04000000
*         DCMWRPFK   OFF/TEST      ALTER PFK LINE                       04050000
*         DCMLTPFK   OFF/TEST      LIGHT ALLOCATED PFKS                 04100000
*         DCMACPFK   OFF/TEST      EXTINGUISH PFKS                      04150000
*         DCMSSRG    OFF/TEST      SUPPRESS REGENERATION                04200000
*        DCMIOUNQ                                                       04250000
*         DCMINERR    OFF          ERROR INSTRUCTION LINE               04300000
*         DCMINNOR     ON          NORMAL INSTRUCTION LINE              04350000
*********************************************************************** 04400000
  EJECT                                                                 04450000
*             REGISTER EQUATES                                          04500000
*********************************************************************** 04550000
X1PARM   EQU   1                                                        04560000
XFBRANCH EQU   15                                                       04570000
XPARM    EQU   1                   PARAMETER REGISTER                   04600000
XWORK4   EQU   1                   WORK REGISTER                        04650000
XMULT    EQU   2                   WORK REGISTER                        04700000
X2       EQU   2                   WORK REGISTER                        04750000
XWORK1   EQU   3                   WORK REGISTER                        04800000
XWORK2   EQU   4                   WORK REGISTER                        04850000
XPOINT   EQU   4                   WORK REGISTER                        04900000
XKEEP    EQU   5                   WORK REGISTER                        04950000
XPFK     EQU   6                   UCB POINTER                          05000000
XDCM2NDB EQU   7                   BASE FOR 2ND HALF OF DCM             05050000
XCHPGM   EQU   8                   POINTER TO CHANNEL PROGRAM AREA      05100000
X8       EQU   8                   WORK REGISTER                        05150000
PFKPTR   EQU   9                   POINTER TO PFK AREA                  05200000
XDCMBASE EQU   10                  DCM BASE REGISTER                    05250000
XBASE    EQU   11                  PROGRAM BASE REGISTER                05300000
XCXSA    EQU   12                  CXSA BASE REGISTER                   05350000
XUCMENT  EQU   13                  UCMENTRY BASE REGISTER               05400000
XRTRN    EQU   14                  WORK REGISTER                        05450000
XRESBASE EQU   15                  RESIDENT DCM BASE                    05500000
         EJECT                                                          05550000
START    BALR  XBASE,N0            SET UP                               05600000
         USING *,XBASE             ADDRESSABILITY                       05650000
         B     ICATCH              BRANCH AROUND EYECATCHER             05700000
         DC    C'   MODULE IGC5Q07B, FICHE IEECVETQ  ' EYECATCHER AND   05750000
ZAPAREA  DC    12C'ZAP'  RESERVED FOR FIELD MODIFICATION                05800000
ICATCH   LR    XCXSA,XPARM         SAVE CXSA BASE                       05850000
         USING CXSA,XCXSA          DECLARE CXSA ADDRESS                 05900000
         L     XUCMENT,CSAUCM      GET UCM ENTRY ADDRESS                06000000
         USING UCMLIST,XUCMENT     DECLARE UCMENTRY BASE                06050000
         L     XRESBASE,UCMXB      GET DCM POINTER                      06100000
         USING DCMTSRT,XRESBASE                                         06150000
         L     PFKPTR,DCMADPFK     POINT TO PFK AREA                    06200000
         L     XDCMBASE,DCMADTRN   GET BASE FOR TRANSIENT DCM           06250000
         USING DCMSTRT,XDCMBASE      DECLARE DCM BASE                   06300000
         L     XDCM2NDB,DCMLSCRN   GET DCM ENTRY POINTER                06350000
         USING DCMMLAST,XDCM2NDB   DECLARE BASE                         06400000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06450000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    06460000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      06470000
         L     X8,DCMDSAV          POINT TO CHANNEL PROGRAM             06500000
         EJECT                                                          06550000
*/*ENTBLNK: D (NO,LEFTWARN,YES,BLNKENT)  ENTRY TO BLANK ENTRY AREA? */  06600000
***********************************************************             06650000
ENTBLNK  EQU   *                                                        06700000
         TM    DCMIOCM2,DCMBLENT   BLANK ENTRY AREA                     06750000
         BNO   LEFTWARN            NO, SEE IF BLANK LEFT HALF WARN LINE 06800000
         SPACE 5                                                        06850000
*/*BLNKENT: P (,LEFTWARN) BLANK ENTRY AREA IN DCM */                    06900000
***********************************************************             06950000
BLNKENT  EQU   *                                                        07000000
         NI    DCMIOCM2,N255-DCMBLENT TURN OFF BIT                      07050000
         MVI   DCMENTRY,BLANK      PUT BLANK IN ENTRY AREA              07100000
         MVC   DCMENTRY+N1(N147),DCMENTRY PROPAGATE IT                  07150000
         SPACE 5                                                        07200000
*/*LEFTWARN: D (NO,RGHTWARN,YES,WARNLEFT) ENTRY TO BLANK LEFT WARNING   07250000
*/*LINE? */                                                             07300000
***********************************************************             07350000
LEFTWARN EQU   *                                                        07400000
         TM    DCMIOCM2,DCMBLWRL   BLANK LEFT HALF WARNING LINE         07450000
         BNO   RGHTWARN             NO, SEE IF TO BLANK RIGHT SIDE      07500000
         SPACE 5                                                        07550000
*/*WARNLEFT: P (,RGHTWARN) BLANK LEFT HALF OF WARNING LINE IN DCM */    07600000
***********************************************************             07650000
WARNLEFT EQU   *                                                        07700000
         NI    DCMIOCM2,N255-DCMBLWRL TURN OFF BIT                      07750000
         MVI   DCMWARN,BLANK       PUT BLANK IN WARNING LINE            07800000
         MVC   DCMWARN+N1(N36),DCMWARN PROPAGATE IT                     07850000
         SPACE 5                                                        07900000
*/*RGHTWARN: D (NO,INSTINIT,YES,WARNRGHT) ENTRY TO BLANK RIGHT WARNING  07950000
*/*LINE? */                                                             08000000
***********************************************************             08050000
RGHTWARN EQU   *                                                        08100000
         TM    DCMIOCM2,DCMBLWRR   BLANK RIGHT HALF WARNING LINE        08150000
         BNO   INSTINIT             NO, GO TEST FOR NEXT FUNCTION       08200000
         SPACE 5                                                        08250000
*/*WARNRGHT: P (,INSTINIT) BLANK RIGHT HALF OF WARNING LINE IN DCM */   08300000
***********************************************************             08350000
WARNRGHT EQU   *                                                        08400000
         NI    DCMIOCM2,N255-DCMBLWRR TURN OFF BIT                      08450000
         MVI   DCMWARN+N37,NULL    PUT NULL IN RIGHT SIDE WARNING LINE  08500000
         MVC   DCMWARN+N38(N35),DCMWARN+N37 PROPAGATE IT                08550000
         MVI   DCMWARN+N73,NEWLINE MOVE IN NEWLINE CHARACTER            08600000
         NI    DCMR2FLG,X'FF'-DCMRXUNV  INDICATE 'UNVIEW      MH Y01563 08610003
         NI    DCMCOM3,X'FF'-DCMOLUNV   MSG' NOT ON SCREEN    MH Y01563 08620003
         SPACE 5                                                        08650000
*/*INSTINIT: D (NO,INFOWRIT,YES,INITINST) ENTRY TO INIT.                08700000
*/*INST. LINE? */                                                       08750000
***********************************************************             08800000
INSTINIT EQU   *                                                        08850000
         TM    DCMIOCM2,DCMINSSH   INITIALIZE INSTRUCTION LINE          08900000
         BNO   INFOWRIT             NO, GO TEST FOR NEXT FUNCTION       08950000
         SPACE 5                                                        09000000
*/*INITINST: P (,INFOWRIT) MOVE INSTRUCTION LINE TEXT TO INSTRUCTION    09050000
*/*LINE IN DCM */                                                       09100000
***********************************************************             09150000
INITINST EQU   *                                                        09200000
         NI    DCMIOCM2,N255-DCMINSSH TURN OFF BIT                      09250000
         MVI   DCMINSTR,BLANK      BLANK INSTRUCTION LINE               09300000
         MVC   DCMINSTR+N1(N73),DCMINSTR PROPAGATE                      09350000
         MVC   DCMINSTR(N35),INSLMESG MOVE IN MSG                       09400000
         NI    DCMIOUNQ,N255-DCMINERR                                   09450000
         OI    DCMIOUNQ,DCMINNOR                                        09500000
         SPACE 5                                                        09550000
*/*INFOWRIT: D (NO,ASYWRIT,YES,WRITINFO) ENTRY TO WRITE INFO DISPLAY?   09600000
*/**/                                                                   09650000
***********************************************************             09700000
INFOWRIT EQU   *                                                        09750000
         TM    DCMIOCM2,DCMWINFD   SEE IF WRITE INFO DISPLAY            09800000
         BNO   ASYWRIT              NO, GO TEST FOR NEXT FUNCTION       09850000
         EJECT                                                          09900000
*/*WRITINFO: P (,ASYWRIT) BUILD WRITE CCWS FOR UP TO THREE LINES */     09950000
***********************************************************             10000000
WRITINFO EQU   *                                                        10050000
         SR    XWORK1,XWORK1       CLEAR WORK REG                       10100000
         LH    XWORK2,DCMCORLN     GET LENGTH OF LINE                   10150000
         IC    XWORK1,DCMLINEN     MULT BY LINE NUMBER                  10200000
         BCTR  XWORK1,N0           DECREMENT LINE NUMBER                10250000
         MR    XMULT,XWORK2        AND                                  10300000
         AH    XWORK1,DCMBAM1      GET ID ADDRESS                       10350000
         STH   XWORK1,DCMBADLN     HOLD IN BUFFER ADDR AREA             10400000
         LA    XPOINT,DCMBADLN     POINT TO BUFFER ADDR AREA            10450000
         BAL   XRTRN,BUILDSET      BUILDSET BUFFER CCW                  10500000
         LH    XWORK1,DCMBYTCT     GET LENGTH TO WRITE                  10550000
         LH    XWORK2,DCMCORLN     GET LENGTH OF LINE                   10600000
         LA    XKEEP,DCMINSTR      POINT TO INSTRUCTION LINE            10650000
         CR    XWORK1,XWORK2       IS LENGTH OVER ONE LINE              10700000
         BNH   BUILD                NO, BUILD ONE CCW                   10750000
*                                   YES, BUILD TWO CCWS                 10800000
TWOLINE  LR    XWORK1,XWORK2       GET LENGTH OF LINE                   10850000
         BAL   XRTRN,BUILDWRT      BUILD INSTRUCTION LINE CCW           10900000
         LH    XWORK1,DCMBYTCT     GET TOTAL LENGTH TO WRITE            10950000
         SR    XWORK1,XWORK2       SUBTRACT LENGTH JUST WRITTEN         11000000
         LA    XKEEP,DCMENTRY      POINT TO ENTRY AREA LINES            11050000
BUILD    BAL   XRTRN,BUILDWRT      BUILD CCW                            11100000
         NI    DCMIOCM2,N255-DCMWINFD TURN OFF BIT                      11150000
         LA    XWORK2,DCMINSTR     POINT TO START OF INST LINE          11200000
         BAL   XRTRN,LOOP2         GO TO INSERT NULLS                   11250000
ENTRY1   LA    XWORK2,DCMENTRY     POINT TO START OF ENTRY AREA         11300000
         BAL   XRTRN,LOOP2         GO TO INSERT NULLS                   11350000
ENTRY2   LA    XRTRN,ASYWRIT       POINT TO TEST OF NEXT FUNCTION       11400000
         LA    XWORK2,DCMENTR2     POINT TO SECOND LINE OF ENTRY        11450000
LOOP2    AH    XWORK2,DCMLGNTH     POINT TO LAST CHAR IN LINE + 1       11500000
         BCTR  XWORK2,N0           POINT TO LAST CHAR IN LINE           11550000
         CLI   N0(XWORK2),BLANK    IS THIS A BLANK                      11600000
         BNE   LONGLINE             NO, TEXT FILLS LINE OR NEW LINE     11650000
*                                      CHARACTER IS STILL INTACT        11700000
         MVI   N0(XWORK2),NEWLINE   YES, INSERT NEW LINE CHARACTER      11750000
LONGLINE LA    XWORK4,NULLNG       SET LIMIT COUNT OF CHARS TO NULL     11800000
NEXTCHAR BCTR  XWORK2,N0           POINT TO NEXT TO LAST CHAR           11850000
         CLI   N0(XWORK2),BLANK    IS THIS CHARACTER BLANK              11900000
* NOTE  IT IS ASSUMED THAT IF THE LAST CHARACTER WAS A NONBLANK         11950000
*       VIEWABLE CHARACTER THE NEXT TO LAST CHARACTER IS ALSO           12000000
*       A NONBLANK CHARACTER.                                           12050000
         BNE   DATAFND              NO, MUST BE VIEWABLE DATA           12100000
         MVI   N0(XWORK2),NULL      YES, REPLACE WITH NULL              12150000
         BCT   XWORK4,NEXTCHAR     LOOP UNTIL LINE FINISHED             12200000
DATAFND  BR    XRTRN               GO TO NEXT LINE OR FUNCTION          12250000
         SPACE 5                                                        12300000
*/*ASYWRIT: D (NO,ERASEPFM,YES,WRITASY) ENTRY TO WRITE ASYN ERROR       12350000
*/*MESSAGE? */                                                          12400000
***********************************************************             12450000
ASYWRIT  EQU   *                                                        12500000
         TM    DCMIOCM2,DCMWRASY   SEE IF WRITE ASYN ERROR              12550000
         BNO   ERASEPFM             NO, CHECK NEXT FUNCTION             12600000
         SPACE 5                                                        12650000
*/*WRITASY: P (,STREGEN) BUILD CCWS TO REFRESH DEVICE BUFFER  */        12700000
***********************************************************             12750000
WRITASY  EQU   *                                                        12800000
         LA    XWORK1,DCMDSAV      GET ADDRESS OF RMI READ AREA         12850000
         ST    XWORK1,N0(XCHPGM)   PUT RMI ADDR IN CHANNEL PGM          12900000
         MVI   N0(XCHPGM),RMICODE  PUT RMI CODE IN CHANNEL PROGRAM      12950000
         MVI   N7(XCHPGM),N3       PUT BYTE COUNT IN                    13000000
         BAL   XRTRN,FINCCW        FINISH CCW                           13050000
         LA    XWORK1,ERRMSGL      GET LINE NUMBER                      13100000
         MH    XWORK1,DCMCORLN     GET INDEX                            13150000
         AH    XWORK1,DCMBAM1      GET START OF MSG AREA                13200000
         STH   XWORK1,DCMBADLN     HOLD IN ADDR AREA                    13250000
         LA    XPOINT,DCMBADLN     POINT TO BUFFER ADDR AREA            13300000
         LR    XWORK4,XPOINT       SAVE PTR TO BUFFER ADDR AREA         13350000
         BAL   XRTRN,BUILDSET      STOP CCW                             13400000
         LA    XKEEP,DCMERR        POINT TO START ORDER PROGRAM         13450000
         LA    XWORK1,N10          PUT BYTE COUNT IN                    13500000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      13550000
         L     XKEEP,DCMAENTR      POINT TO START OF MSG                13600000
         LH    XWORK1,DCMCORLN     GET LENGTH OF LINE                   13650000
         SLL   XWORK1,N1           DOUBLE IT                            13700000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      13750000
         LA    XKEEP,DCMWARN+N74   GET GTRU ADDR                        13800000
         LA    XWORK1,N2           PUT BYTE COUNT IN                    13850000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      13900000
         LA    XKEEP,DCMBADLN      GET START BUFFER ADDR FOR GTRU       13950000
         LA    XWORK1,N2           PUT BYTE COUNT IN                    14000000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      14050000
         STH   XWORK4,DCMBADLN     STORE GTRU ADDR                      14100000
         LA    XWORK1,DCMBADLN     GET GTRU ADDRESS                     14150000
         NI    DCMIOCM2,N255-DCMWRASY-DCMERASE TURN BITS OFF            14200000
         B     ASYREGEN            GO TO START REGENERATION             14250000
         EJECT                                                          14300000
*/*ERASEPFM: D (NO,STREAD,YES,PFMERASE) ENTRY TO ERASE SCREEN? */       14350000
***********************************************************             14400000
ERASEPFM EQU   *                                                        14450000
         TM    DCMIOCM2,DCMERASE   SEE IF ERASE                         14500000
         BNO   STREAD               NO, CHECK NEXT FUNCTION             14550000
         SPACE 5                                                        14600000
*/*PFMERASE: P (,PFKEXT) BUILD STOP REGEN CCW & SUP REGEN */            14650000
***********************************************************             14700000
PFMERASE EQU   *                                                        14750000
         MVI   N0(XCHPGM),SETBUF   MOVE STOP COMMAND IN                 14800000
         BAL   XRTRN,B2CCW         GO BUILD CCW                         14850000
         NI    DCMIOCM2,N255-DCMERASE TURN OFF ERASE BIT                14900000
         OI    DCMIOCM3,DCMSSRG    SUPPRESS START REGEN                 14950000
         B     PFKEXT              CHECK PFKS                           15000000
         SPACE 5                                                        15050000
*/*STREAD: D (NO,PFKWRIT,YES,CURNREAD) ENTRY TO READ ENTRY AREA? */     15100000
***********************************************************             15150000
STREAD   EQU   *                                                        15200000
         TM    DCMIOCM2,DCMIOCRD   ENTRY FOR READ                       15250000
         BNO   PFKWRIT              NO, CHECK NEXT FUNCTION             15300000
         SPACE 5                                                        15350000
*/*CURNREAD: P (,STREGEN) BUILD CCWS TO READ ENTRY AREA INTO DCM */     15400000
***********************************************************             15450000
CURNREAD EQU   *                                                        15500000
         NI    DCMIOCM2,N255-DCMIOCRD TURN OFF BIT                      15550000
         LA    XPOINT,DCMBAENT     GET INSERT CURSOR ADDRESS            15600000
         BAL   XRTRN,BUILDSET      BUILD STOP REGEN CCW                 15650000
         BAL   XRTRN,BUILDSET      BUILD INSERT CCW                     15700000
         MVI   DCMCHPGM+N8,INSERT                                       15750000
         BAL   XRTRN,BUILDSET      BUILD STOP REGEN CCW                 15800000
         LA    XWORK1,DCMENTRY     POINT TO ENTRY AREA                  15850000
         ST    XWORK1,DCMCHPGM+N24                                      15900000
         MVI   DCMCHPGM+N24,READ                                        15950000
         MVI   DCMCHPGM+N31,READLGNH                                    16000000
         BAL   XRTRN,FINCCW        FINISH BUILDING CCW                  16050000
         OI    DCMCOM1,DCMIOPRD                                         16100000
         EJECT                                                          16150000
*/*STREGEN: P (,ENEXCP) BUILD START REGENERATION CCW */                 16200000
***********************************************************             16250000
STREGEN  EQU   *                                                        16300000
         LA    XWORK1,DCMBASRT     GET START OF REGEN                   16350000
ASYREGEN EQU   *                                                        16400000
         ST    XWORK1,N0(XCHPGM)   PUT ADDRESS IN CCW                   16450000
         MVI   N0(XCHPGM),STARTREG MOVE OP CODE IN                      16500000
         MVI   N7(XCHPGM),N2       MOVE BYTE COUNT IN                   16550000
         BAL   XRTRN,FINCCW        FINISH BUILDING CCW                  16600000
         SPACE 5                                                        16650000
*/*ENEXCP: P (,EXCP) REMOVE CHAIN FLAG FROM LAST CCW */                 16700000
***********************************************************             16750000
ENEXCP   EQU   *                                                        16800000
         SH    XCHPGM,EIGHT        UPDATE CCW POINTER                   16850000
         MVI   N4(XCHPGM),STOP     STOP CCW CHAIN                       16900000
         SPACE 5                                                        16950000
*/*EXCP: I (,EXIT) EXCP */                                              17000000
***********************************************************             17050000
EXCP     EQU   *                                                        17100000
         L     XFBRANCH,CSAXB      ADDR GETLOCK SBR           JE YM8371 17150003
         LR    X1PARM,XCXSA        COPY CSA PTR               JE YM8371 17160003
         BALR  XRTRN,XFBRANCH      OBTAIN LOCKS               JE YM8371 17170003
         XC    UCMECB,UCMECB       CLEAR ECB                            17200003
         OI    UCMSTS,UCMBF        TURN ON BUSY BIT                     17210003
         L     XWORK1,UCMDCB       GET DCB ADDRESS                      17250000
         L     XFBRANCH,CSAXC      ADDR FREELOCK SBR          JE YM8371 17260003
         LR    X1PARM,XCXSA        COPY CSA PTR               JE YM8371 17270003
         BALR  XRTRN,XFBRANCH      RELEASE LOCKS              JE YM8371 17280003
         L     XPARM,N28(XWORK1)   GET IOB ADDRESS                      17300000
         EXCP  (XPARM)             INITIATE I/O                         17350000
         SPACE 5                                                        17450000
*/*EXIT: R PROCESSOR 1 (IEECVET1) */                                    17500000
***********************************************************             17550000
EXIT     EQU   *                                                        17600000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  17650000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 17700000
         BR    XFBRANCH            EXIT TO IEECVET1                     17750000
         EJECT                                                          17800000
*/*PFKWRIT: D (NO,PFKEXT,YES,WRITEPFK) ENTRY TO WRITE PFK LINE? */      17850000
***********************************************************             17900000
PFKWRIT  EQU   *                                                        17950000
         TM    DCMIOCM3,DCMWRPFK   WRITE PFK AREA                       18000000
         BNO   PFKEXT               NO, GO SEE IF LIGHT PFKS            18050000
         SPACE 5                                                        18100000
*/*WRITEPFK: D (NO,BUILDIT,YES,ERASEIT) IS PFK LINE DISPLAYED NOW? */   18150000
***********************************************************             18200000
WRITEPFK EQU   *                                                        18250000
* EACH TIME THIS ROUTINE IS ENTERED IT WILL CHANGE THE STATUS OF THE    18300000
*  DISPLAYED PFK LINE.  IF THE LINE IS DISPLAYED IT WILL BE ERASED      18350000
*   IF IT IS BLANK IT WILL BE BUILT AND WRITTEN TO THE SCREEN.          18400000
         SPACE                                                          18450000
         LR    XPOINT,PFKPTR      GET POINTER TO PFK AREA               18500000
         L     XWORK1,DCMPFKLN    GET POINTER TO PFK LINE               18550000
         CLC   N0(N6,XWORK1),BLANKS    IS LINE NOW BLANK      MH  M2070 18560000
         BE    BUILDIT             YES, GO DISPLAY IT         MH  M2070 18570000
         SPACE 5                                                        18700000
*/*ERASEIT: P (,WRITIT) BLANK PFK LINE IN DCM */                        18750000
***********************************************************             18800000
ERASEIT  EQU   *                   YES, ERASE IT                        18850000
         MVI   N0(XWORK1),BLANK   BLANK FIRST POSITION                  18900000
         MVC   N1(N72,XWORK1),N0(XWORK1)    PROPAGATE NULL              18950000
         MVI   N73(XWORK1),NEWLINE INSERT NEW LINE CHARACTER            19000000
         B     WRITIT             GO TO WRITE THE SCREEN                19050000
         EJECT                                                          19100000
*/*BUILDIT: P (,WRITIT) BUILD PFK LINE IN DCM */                        19150000
***********************************************************             19200000
BUILDIT  EQU   *                                                        19250000
         MVI   N0(XWORK1),BLANK    BLANK FIRST LINE POSITION            19300000
         MVC   N1(N72,XWORK1),N0(XWORK1)     BLANK REST OF LINE         19350000
         LA    X2,N12              SET LIMIT ON DISPLAYED KEYS          19400000
         LTR   XPOINT,XPOINT       ANY KEYS ALLOCATED         MH Y01566 19410003
         BZ    WRITIT               NO, JUST WRITE BLANK LINE MH Y01566 19420003
LOOP3    CLI   N0(XPOINT),STOPPER IS THIS END OF AREA                   19450000
         BE    WRITIT              YES, STOP GENERATION                 19500000
         SR    XKEEP,XKEEP         NO, CLEAR WORK REGISTER              19550000
         IC    XKEEP,N0(XPOINT)   GET KEY NUMBER                        19600000
         CVD   XKEEP,DCMPACK      CONVERT IT TO DECIMAL                 19650000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2)   UNPACK IT              19700000
         OI    DCMCVBIN+N3,ZONE   CHANGE SIGN TO EBCDIC                 19750000
         MVC   N3(N2,XWORK1),DCMCVBIN+N2    MOVE KEY TO LINE            19800000
         CLI   N3(XWORK1),ZERO    IS FIRST DIGIT ZERO                   19850000
         BNE   TWOCHAR             NO, CONTINUE                         19900000
         MVI   N3(XWORK1),BLANK    YES, BLANK IT                        19950000
TWOCHAR  EQU   *                                                        20000000
         MVI   DCMCVBIN+N2,ZEROS  CLEAR OUT                             20050000
         MVI   DCMCVBIN+N3,ZEROS     WORK AREA                          20100000
         LA    XWORK1,N6(XWORK1)  POINT TO NEXT LINE SEGMENT            20150000
         LA    XPOINT,PFKLGN(XPOINT)     POINT TO NEXT PFK AREA         20200000
         BCT   X2,LOOP3           GO SEE IF ANY MORE                    20250000
* NOTE  IF THERE ARE MORE THAN TWELVE KEYS ALLOCATED ONLY THE FIRST     20300000
*       TWELVE WILL BE DISPLAYED ON THE SCREEN.                         20350000
         SPACE 5                                                        20400000
*/*WRITIT: P (,PFKEXT) BUILD CCWS TO WRITE PFK LINE TO SCREEN */        20450000
***********************************************************             20500000
WRITIT   EQU   *                                                        20550000
         NI    DCMIOCM3,X'FF'-DCMWRPFK  TURN OFF BIT                    20600000
         LA    XPOINT,DCMBAPFK     POINT TO BUFFER ADDRESS OF PFK AREA  20650000
         BAL   XRTRN,BUILDSET      BUILD SET CCW                        20700000
         LA    XKEEP,DCMPFKAR      GET ADDRESS TO WRITE FROM            20750000
         LH    XWORK1,DCMCORLN     GET LENGTH OF WRITE                  20800000
         BAL   XRTRN,BUILDWRT      BUILD WRITE CCW                      20850000
         EJECT                                                          20900000
*/*PFKEXT: D (NO,SUPREG,YES,%KEYTEST) ENTRY TO LIGHT ANY PFKS? */       20950000
***********************************************************             21000000
PFKEXT   EQU   *                                                        21050000
         TM    DCMIOCM3,DCMLTPFK+DCMACPFK   TRYING TO LIGHT PFKS        21100000
         BZ    SUPREG              NO, CONTINUE                         21150000
         SPACE 5                                                        21200000
*/*%KEYTEST: D (NO,SUPREG,YES,%LTACT) PFK KEYBOARD INSTALLED? (UCB) */  21250000
***********************************************************             21300000
         L     XPFK,UCMUCB         YES, GET UCB POINTER                 21350000
         TM    OPFEAT(XPFK),PFKBD IS PFK KEYBOARD INSTALLED             21400000
         BNO   SUPREG              NO, DON'T TRY TO LIGHT IT            21450000
         SPACE 5                                                        21500000
*/*%LTACT: D (NO,PFKLITE,YES,ONEPFK) ENTRY TO EXTINGUISH PFKS? */       21550000
***********************************************************             21600000
         TM    DCMIOCM3,DCMACPFK  SEE IF EXTINGUISH PFKS                21650000
         BNO   PFKLITE              NO, CHECK NEXT FUNCTION             21700000
         SPACE 5                                                        21750000
*/*ONEPFK: P (,OUT) BUILD DATA TO EXTINGUISH KEYS */                    21800000
***********************************************************             21850000
ONEPFK   EQU   *                                                        21900000
         NI    DCMIOCM3,N255-DCMACPFK TURN OFF BIT                      21950000
         SR    XWORK1,XWORK1       CLEAR KEY REGISTER                   22000000
         SPACE 5                                                        22050000
*/*OUT: P (,SUPREG) BUILD LIGHT PFK CCW */                              22100000
***********************************************************             22150000
OUT      EQU   *                                                        22200000
         ST    XWORK1,DCMDSAV+N4   STORE BYTES THAT INDICATE ASSOCIATED 22250000
*                                  PFK'S                                22300000
         LA    XPOINT,DCMDSAV+N4   GET POINTER TO DATA FIELD            22350000
         ST    XPOINT,N0(XCHPGM)   SAVE POINTER IN CCW                  22400000
         MVI   N0(XCHPGM),SETPFK   MOVE IN SET PFK INDICATOR            22450000
         MVI   N7(XCHPGM),N4       MOVE IN BYTE COUNT                   22500000
         BAL   XRTRN,FINCCW        COMPLETE THE CCW                     22550000
         SPACE 5                                                        22600000
*/*SUPREG: D (YES,ENEXCP,NO,STREGEN) SUPPRESS REGENERATION? */          22650000
***********************************************************             22700000
SUPREG   EQU   *                                                        22750000
         TM    DCMIOCM3,DCMSSRG    Q. SUPPRESS START REGENERATION       22800000
         BNO   STREGEN              NO, THEN START REGENERATION         22850000
         NI    DCMIOCM3,N255-DCMSSRG    YES.  TURN OFF BIT              22900000
         B     ENEXCP                GO TO DO I/O                       22950000
         SPACE 5                                                        23000000
*/*PFKLITE: D (NO,SUPREG,YES,LITEPFK) ENTRY TO LIGHT ALL ALLOCATED      23050000
*/*KEYS? */                                                             23100000
***********************************************************             23150000
PFKLITE  EQU   *                                                        23200000
         TM    DCMIOCM3,DCMLTPFK   LIGHT PFK'S                          23250000
         BNO   SUPREG               NO, SEE IF SUPPRESS REGEN           23300000
         SPACE 5                                                        23350000
*/*LITEPFK: P (,OUT) BUILD LIGHT PFK DATA FOR ALL ALLOCATED KEYS */     23400000
***********************************************************             23450000
LITEPFK  EQU   *                                                        23500000
         NI    DCMIOCM3,N255-DCMLTPFK TURN OFF BIT                      23550000
         LR    XKEEP,PFKPTR        GET POINTER TO PFK LIST              23600000
         SR    X2,X2               CLEAR                                23650000
         SR    XWORK1,XWORK1          WORK                              23700000
         SR    XWORK2,XWORK2             REGISTERS                      23750000
LOOP     EQU   *                                                        23800000
         CLI   N0(XKEEP),STOPPER   ANY MORE KEYS                        23850000
         BE    OUT                  NO,GO BUILD CCW                     23900000
         IC    XWORK2,N0(XKEEP)    GET PFK NUMBER                       23950000
         SLDL  X2,N0(XWORK2)       ALIGN REGISTER                       24000000
         O     XWORK1,ONPFK        TURN ON BIT                          24050000
         SRDL  X2,N0(XWORK2)       REALIGN REGISTER                     24100000
         LA    XKEEP,PFKLGN(XKEEP)   GET NEXT KEY NUMBER                24150000
         B     LOOP                GO TO TURN ON NEXT BIT               24200000
         EJECT                                                          24250000
BUILDSET EQU   *                                                        24300000
         ST    XPOINT,N0(XCHPGM)   PUT BUF ADD PTR INTO CCW             24350000
         MVI   N0(XCHPGM),SETBUF   PUT COMMAND CODE INTO CCW            24400000
B2CCW    MVI   N7(XCHPGM),N2       PUT BYTE COUNT IN                    24450000
         B     FINCCW              FINISH BUILDING CCW                  24500000
BUILDWRT EQU   *                                                        24550000
         ST    XKEEP,N0(XCHPGM)    SAVE WRITE FROM ADDRESS              24600000
         MVI   N0(XCHPGM),WRITE    PUT OP CODE IN CCW                   24650000
         STH   XWORK1,N6(XCHPGM)   PUT BYTE COUNT IN                    24700000
FINCCW   MVI   N4(XCHPGM),CHAIN    CHAIN CCW'S                          24750000
         LA    XCHPGM,N8(XCHPGM)   UPDATE CCW POINTER                   24800000
         BR    XRTRN               RETURN                               24850000
         SPACE 5                                                        24900000
*/*IEECVETQ: END */                                                     24950000
         EJECT                                                          25000000
*        CONSTANTS                                                      25050000
BLANKS   DC    6C' '              BLANKS                      MH  M2070 25060000
         DS    0F                                                       25100000
ONPFK    DC    X'80000000'         FULLWORD TO LIGHT PFK                25150000
EIGHT    DC    H'8'                UPDATE CCW PTR                       25200000
INSLMESG DC    C'IEE152I  *ENTER*  *CANCEL*  *D C,K*' INST LN MH  M2070 25210000
         EJECT                                                          25300000
*      EQUATES                                                          25350000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            25360000
ID2      EQU   C'Q'                2ND CHARACTER OF CSECT ID            25370000
BLANK    EQU   X'40'               BLANKING CHARACTER                   25400000
CHAIN    EQU   X'60'               CCW CHAIN FLAG                       25450000
DIGIT    EQU   X'F0'               ZONE FOR EBCDIC DIGIT                25500000
ERRMSGL  EQU   25                  LINE FOR ASYN ERROR MESG             25550000
INSERT   EQU   X'0F'               INSERT CURSOR                        25600000
NEWLINE  EQU   X'15'               NEW LINE CHARACTER                   25650000
NULL     EQU   X'00'               NULLING CHARACTER                    25700000
NULLNG   EQU   69                  LENGTH OF CHARS TO NULL              25750000
N0       EQU   0                   NUMBER                               25800000
N1       EQU   1                   NUMBER                               25850000
N2       EQU   2                   NUMBER                               25900000
N3       EQU   3                   NUMBER                               25950000
N4       EQU   4                   NUMBER                               26000000
N6       EQU   6                   NUMBER                               26050000
N7       EQU   7                   NUMBER                               26100000
N8       EQU   8                   NUMBER                               26150000
N10      EQU   10                  BYTE COUNT OFF ERROR ORDERS          26200000
N12      EQU   12                  MAX NUMBER OF DISPLAYABLE KEYS       26250000
N24      EQU   24                  NUMBER                               26300000
N28      EQU   28                  NUMBER                               26350000
N31      EQU   31                  NUMBER                               26400000
N35      EQU   35                  NUMBER                               26500000
N36      EQU   36                  NUMBER                               26550000
N37      EQU   37                  NUMBER                               26600000
N38      EQU   38                  NUMBER                               26650000
N72      EQU   72                  LENGTH OF LINE MINUS TWO             26700000
N73      EQU   73                  NUMBER                               26750000
N74      EQU   74                  NUMBER                               26800000
N147     EQU   147                 NUMBER                               26850000
N255     EQU   255                 NUMBER                               26900000
OPFEAT   EQU   17                  FEATURE BYTE IN UCB                  26950000
PFKBD    EQU   X'10'               PFK KEYBOARD FEATURE                 27000000
PFKLGN   EQU   110                 LENGTH OF PFK AREA                   27050000
READ     EQU   X'02'               READ CODE                            27100000
READLGNH EQU   148                READ LENGTH FOR ENTRY AREA ME SA52709 27150018
RMICODE  EQU   X'0E'               RMI CODE                             27200000
SETBUF   EQU   X'07'               SET BUFFER COMMAND                   27250000
SETPFK   EQU   X'1B'               SET PFK CODE                         27300000
STARTREG EQU   X'27'                                                    27350000
STOP     EQU   X'20'                                                    27400000
STOPPER  EQU   X'64'               NO MORE PFK'S INDICATOR              27450000
WRITE    EQU   X'01'               WRITE                                27500000
ZERO     EQU   C'0'                CHARACTER ZERO                       27550000
ZEROS    EQU   X'00'               HEX ZEROS                            27600000
ZONE     EQU   X'F0'               EBCDIC NUMERIC ZONE                  27650000
         SPACE 2                                                        27700000
         TITLE 'IEECVETQ  IGC5Q07B  2250 I/O 2   RESIDENT DISPLAY CONTR*27750000
               OL MODULE'                                               27800000
         IEERDCM                                                        27850000
         TITLE 'IEECVETQ  IGC5Q07B  2250 I/O 2   TRANSIENT DISPLAY DONT*27950000
               ROL MODULE'                                              28000000
DCMSTRT  DSECT                                                          28050000
         IEECDCM  DEVICE=B                                              28100000
         TITLE 'IEECVETQ  IGC5Q07B  2250 I/O 2     CXSA'                28150000
         IHACTM  CXSA                                                   28250000
         TITLE 'IEECVETQ  IGC5Q07B  2250 I/O 2     UNIT CONTROL MODULE' 28300000
         IEECUCM  FORMAT=NEW                                            28400000
         END                                                            28450000
./  ADD  SSI=41201003,NAME=IEECVETR
* /* START OF SPECIFICATIONS ****                                       00050000
*02*  PROCESSOR = ASSEMBLER;                                            00100000
**** END OF SPECIFICATIONS ***/                                         00150000
IEECVETR CSECT                                                          00200000
*A051100,134600,236600-236900                                 MH Y02158 00202003
*C126000,144500,150000                                        MH Y02158 00204003
*A111600                                                      MH Y01563 00210003
* A 45100-45300,75100-75300,75600,101600-101800,102600        MC YM4102 00250000
         TITLE 'IEECVETR IGC5R07B 2260 IO'                              02950000
*                                                                     * 03000000
* STATUS       CHANGE LEVEL=0                                         * 03050000
*                                                                     * 03100000
* FUNCTION     ANALYZE COMMUNICATIONS BYTES AND PERFORM REQUESTED     * 03150000
*              I/O. RETURN INDICATION THAT I/O IS IN PROGRESS         * 03200000
*                                                                     * 03250000
* INPUT        BITS SET IN DISPLAY CONTROL MODULE                     * 03300000
*                                                                     * 03350000
* OUTPUT       I/O OPERATION PERFORMED                                * 03400000
*                                                                     * 03450000
* EXTERNAL REFERENCES NONE                                              03500000
*                                                                       03550000
* EXITS - NORMAL IEECVET1 PROCESSOR ROUTINE                             03600000
*                IEECVETF LIGHTPEN/CURSOR ROUTINE                       03650000
*                IEECVFTR 2260 I/O 2                             S21003 03700000
*       - ERROR  NONE                                                   03750000
*                                                                       03800000
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         03850000
*                                                                       03900000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      03950000
*                                                                       04000000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      04050000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       04100000
*              CHARACTER SET.                                           04150000
*                                                                     * 04200000
         EJECT                                                          04250000
**                                                                   ** 04300000
*              INITIALIZE PROGRAM                                     * 04350000
**                                                                   ** 04400000
         BALR  PBASE,N0            SET UP                               04450000
         USING *,PBASE             ADDRESSABILITY                       04500000
         B     ICATCH              BRANCH AROUND MODULE NAME  MC YM4102 04510000
         DC    C'   MODULE IGC5R07B, FICHE IEECVETR  '        MC YM4102 04520000
ZAPAREA  DC    12C'ZAP'            FIELD MODIFICATION         MC YM4102 04530000
ICATCH   LR    PXSA,PARM           SAVE CXSA ADDRESS             S21003 04550000
         USING CXSA,PXSA           DECLARE CXSA ADDRESS                 04600000
         L     UCMENTRY,CSAUCM     GET UCM ENTRY ADDRESS                04700000
         USING UCMLIST,UCMENTRY    DECLARE UCMENTRY BASE                04750000
         L     RBASE,UCMXB         LOAD R DCM BASE               S21003 04800000
         USING DCMTSRT,RBASE          ESTABLISH ADDRESSABILITY          04850000
         L     DCMBASE,N0(RBASE)   LOAD T DCM BASE               S21003 04900000
         USING DCMSTRT,DCMBASE       DECLARE DCM BASE                   04950000
         L     UCMBASE,CSACTLM     GET UCM BASE ADDRESS      MD         05000000
         USING UCM,UCMBASE         DECLARE ADDRESS           MD         05050000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      05060000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    05070000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      05080000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          05090000
         LR    X1PARM,PXSA         PASS CXSA ADDRESS IN REG 1           05092000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        05094000
         L     CCWPTR,DCMADCHP     POINT TO CHANNEL PROGRAM             05100000
         MVI   DCMLNEA,NF9         INIT EA LINE DATA CHAR     MH Y02158 05110003
         EJECT                                                          05150000
**                                                                   ** 05200000
*       TEST REASON FOR ENTRY AND TAKE APPROIATE ACTION               * 05250000
**                                                                   ** 05300000
TESTXX   TM    DCMR3FLG,DCMSTSWT   IS STATUS SWITCH REQUIRED     S21003 05350000
         BNO   TESTXY              NO,CONTINUE WITH NEXT TEST           05400000
         L     XFBRANCH,VCONIO2    LOAD SECOND LOAD ADDRESS             05450000
         B     EXIT2               EXIT TO IEECVFTR                     05500000
         SPACE 5                                                 S21003 05550000
TESTXY   TM    UCMDISP,UCMDISPF+UCMDISPG IS IT OUTPUT ONLY STAT  S21003 05600000
         BZ    TEST00               NO, CONTINUE                 S21003 05650000
         NI    DCMIOCM1,X'FF'-DCMDORMI-DCMWRINS-DCMWRENT  YES,   S21003 05700000
         NI    DCMIOCM2,X'FF'-DCMBLENT-DCMINSSH    TURN OFF BITS S21003 05750000
*                                                                S21003 05800000
TEST00   EQU   *        THIS CODE CHECKS FOR RMI REQUEST         S21003 05850000
*                                                                S21003 05900000
         TM    DCMIOCM1,DCMDORMI       TEST SWITCH FOR RMI              06000000
         BZ    TEST01                  NO   BRANCH                      06050000
         OI    DCMCOM1,DCMCOMRM        IND RMI PERFORMED                06100000
         OI    DCMIOUNQ,DCMIO226       IND 2260 TO BE RENT FOR FNDCUR   06150000
         LA    DATA,DCMENTRY           LOAD DATA ADDR                   06200000
         LA    CODE,RMICODE            LOAD CHAN COMMAND         S21003 06250000
         MVI   N4(CCWPTR),SURPDATA     SET CHAIN INDICATOR              06300000
         LH    LENGTH,SCRLEN           LOAD LENGTH                      06350000
         BAL   LINKREG,BUILDCCW        GO TO BUILD CCW           S21003 06400000
         B     EXCP                    GO TO EXEC CHAN PROG             06450000
*                                                                     * 06500000
TEST01   EQU   *       THIS CODE PROCESSES FIND CURSOR                  06550000
*                                                                     * 06600000
         TM    DCMIOUNQ,DCMIO226       FIND CURSOR                      06650000
         BZ    TEST02                  NO    BRANCH                     06700000
         NI    DCMIOUNQ,N255-DCMIO226  SET OFF SWITCH                   06750000
         L     WORK,UCMDCB             GET DCB ADDRESS                  06800000
         L     WORK,N28(WORK)          GET IOB ADDR                     06850000
         CLC   N14(N2,WORK),SCRLEN     TEST IOBCOUNT FIELD              06900000
         BL    EAREA                   NOT FREEZE OR CANCEL  BRANCH     06950000
         MVC   DCMCULNO(N2),XCOMP      INITIALIZE CURSOR LOCATION       07000000
         TM    DCMIOUNQ,DCMFRSCN       IS OUTPUT IN HOLD MODE           07050000
         BZ    STOPOUT                 NO  FREEZE IT                    07100000
         OI    DCMCOM1,DCMCANCL        INDICATE CANCEL                  07150000
         L     XFBRANCH,DCMNCMD1   LAOD COMMAND ROUTINE ADDRESS         07200000
         B     EXIT                EXIT TO IEECVET4                     07250000
STOPOUT  OI    DCMIOUNQ,DCMFRSCN       IND SCREEN IN HOLD MODE          07300000
         CLI   DCMRQDEL,BLANK          IS A DEKETE REQUEST PENDING      07350000
         BNE   OK                      YES                              07400000
         MVI   DCMRQDEL,CQ             MAKE IT LOOK AS ONE IS PENDING   07450000
OK       EQU   *             DELETE ESSENTIALLY PENDING                 07500000
         TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL             MC YM4102 07510000
         BO    OK3                 YES, DON'T SIMULATE        MC YM4102 07520000
         OI    DCMR3FLG,DCMRXHMT   SIMULATE FULL SCREEN       MC YM4102 07530000
         OI    DCMR2FLG,DCMRXSFL       SET ON SWITCH                    07550000
OK3      EQU   *                   CONTINUE                   MC YM4102 07560000
         OI    UCMDEVC,UCMDEVA         SET ON SWITCH                    07600000
         MVI   DCMENTRY,BLANK      PUT BLANK IN ENTRY AREA              07650000
         MVC   DCMENTRY+N1(N159),DCMENTRY  BLANK REST OF ENTRY AREA     07700000
         MVC   DCMENTRY+N132(N27),MESSAGE      MOVE WARNING INTO EA     07750000
         OI    DCMIOCM1,DCMWRENT       IND WRITE ENTRY AREA             07800000
         B     TEST02                  BRANCH                           07850000
EAREA    CLC   N14(N2,WORK),XCITE      TEST IOBCOUNT FIELD              07900000
         BL    NOTINEA                 NOT IN ENTRY AREA  BRANCH        07950000
         OI    DCMCOM1,DCMIOPRD        INDICATE READ PERFORMED          08000000
         LA    DATA,DCMENTRY           LOAD DATA ADDRESS                08050000
         LA    CODE,READ               LOAD COMMAND CODE         S21003 08100000
         MVI   N4(CCWPTR),DUMCHAIN     SET CHAIN INDICATOR              08150000
         LH    LENGTH,SURPLEN          LOAD LENGTH                      08200000
         BAL   LINKREG,BUILDCCW        GO TO BUILD CCW           S21003 08250000
         LH    LENGTH,ENTLEN           LOAD LENGTH                      08300000
         BAL   LINKREG,BLDCCWE         GO TO BUILD CCW           S21003 08350000
         B     EXCP                    GO TO EXEC CHAN PROGRAM          08400000
NOTINEA  SR    CHAR,CHAR               ZERO REGISTER                    08450000
         LH    LINE,SCRLEN             LOAD NUMBER CHARS/DISPLAY        08500000
         SH    LINE,N14(WORK)          SUBTRACT RESIDUAL COUNT          08550000
         LH    WORK,DCMLGNTH           LOAD NUMBER CHARS/LINE    S21003 08600000
         DR    CHAR,WORK               COMPUTE INIT LINE/CHAR           08650000
         BCTR  WORK,N0                 DECREMENT FOR COMPARE            08700000
         CR    CHAR,WORK               TEST FOR MAX CHAR POS            08750000
         BL    NOTMAX                  BRANCH IF NOT MAX                08800000
         SR    CHAR,CHAR               ZERO REGISTER                    08850000
         LA    LINE,N1(LINE)           INCREMENT LINE COUNT             08900000
GOBACK   LA    LINE,LINENO(LINE)       TRANSLATE LINE NUMBER            08950000
         MVC   DCMDSAV(N1),N0(LINE)     STORE LINE NUMBER        S21003 09000000
         STC   CHAR,DCMDSAV+N1         STORE CHAR POSITION              09050000
         L     XFBRANCH,DCMNLPCR   LOAD LIGHT-PEN/CURSOR ADDRESS        09100000
         B     EXIT                EXIT TO IEECVETF                     09150000
NOTMAX   LA    CHAR,N1(CHAR)           INCREMENT CHAR COUNT             09200000
         B     GOBACK                  BRANCH TO STORE LINE/CHAR        09250000
*                                                                     * 09300000
TEST02   EQU   *        THIS CODE CHECKS FOR AN ERASE CONDITION       * 09350000
*                                                                     * 09400000
         TM    DCMIOCM2,DCMERASE       ERASE SCREEN                     09450000
         BZ    TEST03                  NO    BRANCH                     09500000
         LA    CODE,ERASE              LOAD CODE              MH S21003 09550000
         LA    LENGTH,LENTWO           LOAD LENGTH            MH S21003 09600000
         BAL   LINKREG,BLDCCWE         GO TO BUILD CCW           S21003 09650000
         B     EXCP                    GO TO EXEC CHAN PROG             09700000
*                                                                     * 09750000
TEST03   EQU   *        THIS CODE BLANKS ENTRY AREA UPON REQUEST      * 09800000
*                                                                     * 09850000
         TM    DCMIOCM2,DCMBLENT       BLANK ENTRY AREA                 09900000
         BZ    TEST04                  NO    BRANCH                     09950000
         CLI   DCMRQDEL,CQ             DID IO ROUTINE MOVE CHAR IN      10000000
         BNE   OK1                     NO                               10050000
         MVI   DCMRQDEL,BLANK          YES MOVE BLANK INTO DEL REQ      10100000
OK1      EQU   *             DELETE ESSENTIALLY NOT PENDING             10150000
         TM    DCMR3FLG,DCMRXHMT   FULL SCREEN SIMULATED      MC YM4102 10160000
         BZ    OK2                 NO, BRANCH                 MC YM4102 10170000
         NI    DCMR3FLG,N255-DCMRXHMT   SIM FLAG OFF          MC YM4102 10180000
         NI    UCMDEVC,N255-UCMDEVA     SET OFF SWITCH                  10200000
         NI    DCMR2FLG,N255-DCMRXSFL   SET OFF SWITCH                  10250000
OK2      EQU   *                   CONTINUE                   MC YM4102 10260000
         NI    DCMIOUNQ,N255-DCMFRSCN  SET OFF FREEZE SWITCH            10300000
         MVI   DCMENTRY,BLANK          BLANK ENTRY AREA                 10350000
         MVC   DCMENTRY+N1(N159),DCMENTRY   BLANK ENTRY AREA            10400000
*                                                                     * 10450000
TEST04   EQU   *        THIS CODE BLANKS LEFT HALF OF WARNING         * 10500000
*                                                                     * 10550000
         TM    DCMIOCM2,DCMBLWRL       BLANK LEFT HALF WARNING          10600000
         BZ    TEST05                  NO   BRANCH                      10650000
         MVI   DCMWARN,BLANK           BLANK LEFT HALF WARNING          10700000
         MVC   DCMWARN+N1(N39),DCMWARN BLANK LEFT HALF WARNING          10750000
*                                                                     * 10800000
TEST05   EQU   *        THIS CODE BLANKS RIGHT HALF OF WARNING        * 10850000
*                                                                     * 10900000
         TM    DCMIOCM2,DCMBLWRR       BLANK RIGHT HALF WARNING         10950000
         BZ    TEST05A                 NO  BRANCH                       11000000
         MVI   DCMWARN+N40,BLANK       BLANK RIGHT HALF WARNING         11050000
         MVC   DCMWARN+N41(N39),DCMWARN+N40      BLANK RIGHT HALF WARN  11100000
         NI    DCMR2FLG,N255-DCMRXUNV   SET OFF SAME RDCM BIT    S21003 11150000
         NI    DCMCOM3,X'FF'-DCMOLUNV AND TDCM BIT            MH Y01563 11160003
*                                                                     * 11200000
TEST05A  EQU   *        THIS CODE CONTROLS INSTRUCTION LINE           * 11250000
*                                                                     * 11300000
         TM    DCMIOCM2,DCMINSSH       BLANK INSTRUCTION LINE           11350000
         BZ    TEST05B                 NO    BRANCH                     11400000
         MVI   DCMINSTR,BLANK               BLANK                       11450000
         MVC   DCMINSTR+N1(N79),DCMINSTR    INSTRUCTION LINE            11500000
         OI    DCMIOCM1,DCMWRINS       IND WRITE INSTRUCTION LINE       11550000
*                                                                     * 11600000
*        THIS CODE MOVES MESSAGE TO WARNING LINE                      * 11650000
*                                                                     * 11700000
TEST05B  TM    DCMCMSG1,DCMMSGWT       MOVE MSG TO WARNING LINE         11750000
         BZ    TEST06                  NO  BRANCH                       11800000
         NI    DCMCMSG1,N255-DCMMSGWT  SET OFF SWITCH                   11850000
         MVI   DCMWARN+N40,BLANK                 BLANK RIGHT HALF       11900000
         MVC   DCMWARN+N41(N39),DCMWARN+N40      OF WARNING LINE        11950000
         MVC   DCMWARN+N57(N23),HOLDMSG     MOVE HOLD MSG TO WARN LINE  12000000
*                                                                     * 12050000
TEST06   EQU   *        THIS CODE CAUSES WRITING OF MSG AREA          * 12100000
*                                                                     * 12150000
         TM    DCMIOCM1,DCMWRMSG        WRITE MESSAGE AREA       S21003 12200000
         BZ    TEST06AA                NO  BRANCH                       12250000
         NI    DCMIOCM1,X'FF'-DCMWRPAR  DO NOT WRITE PARTIAL     S21003 12300000
         L     LENGTH,DCMWTBUF         ADDR OF I D FIRST LINE           12350000
         L     DATA,DCMASCRN           LOAD ADDR OF INFO DISPLAY        12400000
         SR    LENGTH,DATA             COMPUTE LENGTH                   12450000
         BZ    TEST06AA                YES   GO TO NEXT TEST            12500000
         STH   LENGTH,MSGLEN           SAVE LENGTH                      12550000
         MVI   DCMLNE+N1,NF0           INIT FOR LINE WRITE    MH Y02158 12600003
         LA    DATA,DCMLNE+N1          LOAD LINE ADDRESS                12650000
         BAL   LINKREG,BLDCCWD1        GO TO BUILD CCW           S21003 12700000
         LA    DATA,DCMMFRST           LOAD DATA ADDRESS                12750000
         LH    LENGTH,MSGLEN           LOAD LENGTH                      12800000
         BAL   LINKREG,BLDCCWC         GO TO BUILD CCW           S21003 12850000
*                                                                     * 12900000
TEST06AA EQU   *        THIS CODE CAUSES WRITING OF INFO DISPLAY      * 12950000
*                         AND PARTIAL SCREEN.                    S21003 13000000
*                                                                     * 13050000
         TM    DCMIOCM2,DCMWINFD       WRITE I D                        13100000
         BO    WRITID               YES, DO IT                   S21003 13150000
         TM    DCMIOCM1,DCMWRPAR   IS WRITE PARTIAL REQUIRED     S21003 13200000
         BZ    TEST06A                 NO  BRANCH                       13250000
WRITID   SR    RSAVE,RSAVE         CLEAR REGISTER                S21003 13300000
         IC    RSAVE,DCMLINEN         LOAD LINE ADDRESS          S21003 13350000
         BCTR  RSAVE,N0               DECREMENT BY ONE           S21003 13400000
         STC   RSAVE,DCMLNE+N3        STORE FOR CHANNEL PROGRAM  S21003 13450000
         OI    DCMLNE+N3,NF0       CONVERT TO VALID LINE ADDR MH Y02158 13460003
         LA    DATA,DCMLNE+N3          LOAD DATA ADDR                   13500000
         BAL   LINKREG,BLDCCWD1        GO TO BUILD CCW           S21003 13550000
         TM    DCMIOCM1,DCMWRPAR       IS THIS WRITE PARTIAL     S21003 13600000
         BZ    WRINFO               NO, MUST BE WRITE INFO       S21003 13650000
         MH    RSAVE,DCMCORLN     MULT LINE NO. BY LINE LENGTH   S21003 13700000
         L     DATA,DCMASCRN       POINT TO START OF SCREEN      S21003 13750000
         AR    DATA,RSAVE         ADD INDEX VALUE                S21003 13800000
         LH    LENGTH,DCMBYTCT     GET BYTE COUNT                S21003 13850000
         BAL   LINKREG,BLDCCWC     GO BUILD CCW                  S21003 13900000
         NI    DCMIOCM1,X'FF'-DCMWRPAR  TURN OFF WRITE PARTIAL   S21003 13950000
         B     TEST06AA            TEST FOR INFO DISP            S21003 14000000
WRINFO   LA    DATA,DCMINSTR           LOAD DATA ADDR            S21003 14050000
         LH    LENGTH,DCMBYTCT         LOAD LENGTH                      14100000
         BAL   LINKREG,BLDCCWC         GO TO BUILD CCW           S21003 14150000
*                                                                     * 14200000
TEST06A  EQU   *        THIS CODE WRITES INSTRUCTION LINE             * 14250000
*                                                                     * 14300000
         TM    DCMIOCM1,DCMWRINS       WRITE INSTRUCTION LINE           14350000
         BZ    TEST07                  NO  BRANCH                       14400000
         MVI   DCMLNE+N2,NF8           INIT FOR WRITE LINE              14450003
         LA    DATA,DCMLNE+N2          LOAD DATA ADDRESS                14500000
         BAL   LINKREG,BLDCCWD1        GO TO BUILD CCW           S21003 14550000
         LA    DATA,DCMINSTR           LOAD DATA ADDRESS                14600000
         LH    LENGTH,DCMCORLN         LOAD LENGTH               S21003 14650000
         BAL   LINKREG,BLDCCWC         GO TO BUILD CCW           S21003 14700000
*                                                                     * 14750000
TEST07   EQU   *        THIS CODE CAUSES WRITING OF WARNING LINE      * 14800000
*                                                                     * 14850000
         TM    DCMIOCM1,DCMWRWRN       WRITE WARNING                    14900000
         BZ    TEST08                  NO   BRANCH                      14950000
         MVI   DCMLNE,NFB              LINE POS TO WRITE WARNING        15000003
         LA    DATA,DCMLNE             LOAD DATA ADDR (LINE NUMBER)     15050000
         BAL   LINKREG,BLDCCWD1        GO TO BUILD CCW           S21003 15100000
         LA    DATA,DCMWARN            LOAD DATA ADDRESS                15150000
         LH    LENGTH,DCMCORLN         LOAD LENGTH               S21003 15200000
         BAL   LINKREG,BLDCCWC         GO TO BUILD CCW           S21003 15250000
*                                                                     * 15300000
TEST08   EQU   *        THIS CODE CAUSES WRITING OF ENTRY AREA        * 15350000
*                                                                     * 15400000
         TM    DCMIOCM1,DCMWRENT       WRITE ENTRY AREA                 15450000
         BZ    TEST09                  NO   BRANCH                      15500000
         LA    DATA,DCMLNEA            LOAD DATA ADDR (LINE NUMBER)     15550000
         LA    CODE,WRITEL             LOAD CODE                 S21003 15600000
         LA    LENGTH,LENTWO           LOAD LENGTH               S21003 15650000
         BAL   LINKREG,BLDCCWD         GO TO BUILD CCW           S21003 15700000
         LA    DATA,DCMENTRY           LOAD DATA ADDR                   15750000
         LH    LENGTH,ENTLEN           LOAD LENGTH                      15800000
         BAL   LINKREG,BLDCCWC         GO TO BUILD CCW           S21003 15850000
*                                                                     * 15900000
TEST09   EQU   *        THIS CODE POSITIONS SOM AND CURSOR IN EA      * 15950000
*                                                                     * 16000000
         TM    UCMDISP,UCMDISPF+UCMDISPG IS IT OUTPUT ONLY STAT  S21003 16050000
         BNZ   NOP                  YES, DON'T INSERT CURSOR     S21003 16100000
         LA    DATA,DCMLNEA            LOAD DATA ADDR                   16150000
         LA    CODE,WRITEL             LOAD CODE                 S21003 16200000
         LA    LENGTH,LENTWO           LOAD LENGTH               S21003 16250000
         CLC   DCMCULNO(N2),XCOMP      SHOULD CURSOR BE ADJ SOM         16300000
         BE    TEST12                  YES  BRANCH                      16350000
         BAL   LINKREG,BLDCCWD         GO TO BUILD CCW           S21003 16400000
         SR    LENGTH,LENGTH           ZERO REGISTER                    16450000
         IC    LENGTH,DCMPOSCU         LOAD CURSOR CHAR POSITION        16500000
         CLI   DCMCULNO,N1             ENTRY LINE NUMBER ONE            16550000
         BE    TEST10                  YES   BRANCH                     16600000
         LA    LENGTH,N80(LENGTH)      ADD LENGTH OF A LINE             16650000
TEST10   BCTR  LENGTH,N0               ADJEST TO CHAR POSITION          16700000
         TM    DCMIOUNQ,DCMRPCUR       NEED TO ADVANCE CURSOR           16750000
         BZ    TEST11                  NO  BRANCH                       16800000
         NI    DCMIOUNQ,N255-DCMRPCUR  SET OFF SWITCH                   16850000
         LA    CHAR,DCMENTRY(LENGTH)   POINT TO ENTRY AREA              16900000
TESTLOOP CLI   N0(CHAR),BLANK          FOUND BLANK IN ENT AREA          16950000
         BE    TEST11                  YES   BRANCH                     17000000
         LA    CHAR,N1(CHAR)           ADJUST POINTER                   17050000
         LA    LENGTH,N1(LENGTH)       ADJUST LENGTH                    17100000
         B     TESTLOOP                KEEP LOOKING FOR BLANK           17150000
TEST11   LA    DATA,DCMENTRY           LOAD DATA ADRESS                 17200000
TEST12   BAL   LINKREG,BLDCCWE         GO TO BUILD CCW           S21003 17250000
         EJECT                                                          17300000
**                                                                   ** 17350000
*              SET UP TO EXECUTE CHANNEL PROGRAM                      * 17400000
**                                                                   ** 17450000
EXCP     EQU   *                       EXECUTE CHANNEL PROGRAM          17500000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBR       JE YM8371 17510003
         LR    X1PARM,PXSA         PASS CXSA ADDRESS IN REG 1 JE YM8371 17520003
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS               JE YM8371 17530003
         OI    UCMSTS,UCMBF        TURN ON BUSY BIT                     17550000
         XC    UCMECB,UCMECB       CLEAR ECB                  JE YM8371 17600003
         L     WORK,UCMDCB         GET DCB ADDRESS                      17650000
         L     WORK,N28(WORK)      GET IOB ADDRESS                      17700000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBR      JE YM8371 17750003
         LR    X1PARM,PXSA         PASS CXSA ADDRESS IN REG 1 JE YM8371 17760003
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS              JE YM8371 17770003
         EXCP  (WORK)                  INITIATE I/O                     17800000
         SPACE 4                                                 S21003 17850000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  17860000
*                                  FOR EXIT TO IEECVET1                 17880000
**                                                                   ** 17900000
*                     EXIT PROCEEDURE                                 * 17950000
**                                                                   ** 18000000
EXIT     EQU   *                       INITIALIZE FOR EXIT              18050000
         MVI   DCMIOCM1,N0         SET OFF FLAGS                        18100000
         NI    DCMIOCM2,N3             SET OFF SWITCHES                 18150000
EXIT2    EQU   *                                                        18200000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 18250000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             18300000
         SPACE 4                                                 S21003 18350000
NOP      EQU   *                                                 S21003 18400000
         LA    CODE,NOOP           SET CODE TO NO-OP             S21003 18450000
         LA    LENGTH,N1           SET BYTE COUNT                S21003 18500000
         B     TEST12              GO TO BUILD CCW               S21003 18550000
         EJECT                                                   S21003 18600000
**                                                                   ** 18650000
*       BUILDS ALL CCW'S BASED ON INFORMATION PASSED BY CALLER        * 18700000
**                                                                   ** 18750000
BLDCCWC  MVI   N4(CCWPTR),COMCHAIN INDICATE COMMAND CHAINING     S21003 18800000
         B     BUILDCCW            GO BUILD CCW                  S21003 18850000
BLDCCWD1 LA    CODE,WRITEL         LOAD WRITE CCW CODE           S21003 18900000
         LA    LENGTH,LENONE       LOAD LENGTH OF LINE ADDR      S21003 18950000
BLDCCWD  MVI   N4(CCWPTR),DATACHAN INDICATE DATA CHAINING        S21003 19000000
         B     BUILDCCW            GO BUILD CCW                  S21003 19050000
BLDCCWE  MVI   N4(CCWPTR),ENDCHAIN INDICATE NO CHAINING          S21003 19100000
BUILDCCW ST    DATA,N0(CCWPTR)    STORE DATA ADDR                       19150000
         STC   CODE,N0(CCWPTR)    STORE COMMAND CODE                    19200000
         STH   LENGTH,N6(CCWPTR)  STORE LENGTH                          19250000
         MVI   N5(CCWPTR),N0           ZERO CCW BYTE                    19300000
         LA    CCWPTR,N8(CCWPTR)  INCREMENT CCW POINTER                 19350000
         BR    LINKREG            RETURN                                19400000
         EJECT                                                          19450000
VCONIO2  DC    V(IEECVFTR)         ADDRESS OF SECOND LOAD               19460000
MESSAGE  DC  CL27'IEE167E OUTPUT IN HOLD MODE'   WARNING MESSAGE        19500000
HOLDMSG  DC    CL23'IEE159E MESSAGE WAITING'     SCREEN FULL MESSAGE    19550000
XCOMP    DC    X'0101'       COMPARE FOR FIRST LINE/FIRST CHARACTER     19600000
XCITE    DC    H'802'        CONSTANT                                   19650000
LINENO   DC    X'090A0B00010203040506070809'     TO COMPUTE LINE NO     19700000
         SPACE 2                                                 S21003 19750000
**                                                                   ** 19800000
*                  COMMAND CODE EQUATES                          S21003 19850000
**                                                                   ** 19900000
RMICODE  EQU   X'0A'                   RMI CODE                  S21003 19950000
WRITEL   EQU   X'05'                   WRITE LINE                S21003 20000000
ERASE    EQU   X'07'                   ERASE SCREEN              S21003 20050000
READ     EQU   X'06'               CODE FOR READ DS FULL BUFFER  S21003 20100000
NOOP     EQU   X'03'               NO-OP                         S21003 20150000
         SPACE 2                                                 S21003 20200000
**                                                                   ** 20250000
*                  CCW CHAINING EQUATES                                 20300000
**                                                                   ** 20350000
COMCHAIN EQU   X'60'                   COMMAND CHAINING                 20400000
DATACHAN EQU   X'A0'                   DATA CHAININD                    20450000
ENDCHAIN EQU   X'20'                   STOP CHAINING                    20500000
SURPDATA EQU   X'30'                   STOP CHAIN AND SURPRESS DATA     20550000
DUMCHAIN EQU   X'B0'                   SLI,SKIP,AND DATA CHAIN          20600000
         SPACE 2                                                 S21003 20650000
**                                                                   ** 20700000
*                  CCW LENGTH FIELDS CONSTANTS                        * 20750000
**                                                                   ** 20800000
ENTLEN   DC    H'159'                  LENGTH OF ENTRY AREA             20850000
SCRLEN   DC    H'960'                  TOTAL NUMBER CHAR POSITIONS      20900000
LENONE   EQU   1                   CONSTANT                      S21003 20950000
LENTWO   EQU   2                   CONSTANT                      S21003 21000000
MSGLEN   DC    H'640'                  LENGTH OF MESSAGE AREA           21050000
SURPLEN  DC    H'721'                  LENGTH OF SURPRESSED READ        21100000
         EJECT                                                          21150000
**                                                                   ** 21200000
*                        REGISTER EQUATES                             * 21250000
**                                                                   ** 21300000
X1PARM   EQU   1                                                        21310000
XERTRN   EQU   14                                                       21312000
XFBRANCH EQU   15                                                       21320000
PARM     EQU   1             HOLDS CXSA ADDRESS                         21350000
DATA     EQU   2             CONTAINS DATA ADDR FOR CCW BUILD           21400000
CHAR     EQU   2             HOLDS CHAR WHEN COMPUTING LINE/CHAR        21450000
CODE     EQU   3             HOLDS COMMAND CODE FOR CCW BUILD           21500000
LINE     EQU   3                   HOLDS LINE NUMBER             S21003 21550000
RBASE    EQU   4             R DCM BASE REGISTER                 S21003 21600000
LENGTH   EQU   5             HOLDS LENGTH FOR CCW BUILD                 21650000
LINKREG  EQU   6             BALR REG FOR CCW BUILD                     21700000
WORK     EQU   6             WORK REGISTER                              21750000
CCWPTR   EQU   7             POINTER TO CCW CHAIN                       21800000
RSAVE    EQU   8             WORK REG                            S21003 21850000
UCMBASE  EQU   9             UCM BASE                                   21900000
DCMBASE  EQU   10            DCM BASE                                   21950000
PBASE    EQU   11            PROGRAM BASE                               22000000
PXSA     EQU   12            CXSA ADDRESS                               22050000
UCMENTRY EQU   13            UCMENTRY BASE                              22100000
RETURN   EQU   14            RETURN REGISTER                            22150000
XCTLREG  EQU   15            XCTL PARAMETER REGISTER                    22200000
         EJECT                                                          22250000
**                                                                   ** 22300000
*              MISC  EQUATES                                          * 22350000
**                                                                   ** 22400000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            22410000
ID2      EQU   C'R'                2ND CHARACTER OF CSECT ID            22420000
N0       EQU   0                       NUMBER                           22450000
N1       EQU   1                       NUMBER                           22500000
N2       EQU   2                       NUMBER                           22550000
N3       EQU   3                       NUMBER                           22600000
N4       EQU   4                       NUMBER                           22650000
N5       EQU   5                       NUMBER                           22700000
N6       EQU   6                       NUMBER                           22750000
N8       EQU   8                       NUMBER                           22800000
N11      EQU   11                      NUMBER                           22900000
N14      EQU   14                      NUMBER                           22950000
N23      EQU   23                      NUMBER                           23000000
N27      EQU   27                      NUMBER                           23050000
N28      EQU   28                      NUMBER                           23100000
N39      EQU   39                      NUMBER                           23150000
N40      EQU   40                      NUMBER                           23200000
N41      EQU   41                      NUMBER                           23250000
N57      EQU   57                      NUMBER                           23300000
N79      EQU   79                      NUMBER                           23350000
N80      EQU   80                      NUMBER                           23400000
N132     EQU   132                     NUMBER                           23450000
N159     EQU   159                     NUMBER                           23500000
N255     EQU   255                     NUMBER                           23550000
BLANK    EQU   C' '                    BLANK NUMBER                     23600000
CQ       EQU   C'Q'                    CHARACTER                        23650000
NF0      EQU   X'F0'               LINE ZERO                  MH Y02158 23660003
NF8      EQU   X'F8'               LINE EIGHT                 MH Y02158 23670003
NF9      EQU   X'F9'               LINE NINE                  MH Y02158 23680003
NFB      EQU   X'FB'               LINE ELEVEN                MH Y02158 23690003
         EJECT                                                          23700000
         IHACTM  CXSA                                                   23800000
         EJECT                                                          23850000
         IEECUCM FORMAT=NEW                                             23950000
         EJECT                                                          23960000
         IEERDCM                                                        24010000
         EJECT                                                          24100000
DCMSTRT  DSECT                                                          24150000
         IEECDCM  DEVICE=C                                              24200000
         END                                                            24700000
./  ADD  SSI=41201004,NAME=IEECVETU
* /* START OF SPECIFICATIONS ****                                       00050000
*02*  PROCESSOR = ASSEMBLER;                                            00100000
**** END OF SPECIFICATIONS ***/                                         00150000
         TITLE 'IEECVETU IGC5U07B 3277 I/O 1'                           00200000
IEECVETU CSECT                                                          00250000
*A131600,131700,131800                                        MH Y02132 00260003
*D133500                                                      MH Y02132 00270003
*A157100                                                      MH Y01563 00280003
*/*IEECVETU: CHART */                                                   00300000
*/* HEADER                                                              00350000
*/*       CHART ??     IEECVETU     IGC5U07B          3277 I/O ROUTI    00400000
*/*NE 1                                                  PAGE #     */  00450000
*/* E IEECVETU */                                                       00500000
* STATUS                                                                00550000
*    CHANGE LEVEL 0.015                                                 00600000
*                                                                       00650000
* FUNCTION                                                              00700000
*    THIS IS A DEVICE DEPENDENT ROUTINE TO PERMORM THE REQUESTED I/O IN 00750000
*    PROPER SCREEN FORMAT.                                              00800000
*                                                                       00850000
* ENTRY POINTS                                                          00900000
*         IEECVETU FOR ALL FUNCTIONS                                    00950000
*                                                                       01000000
* OPERATION                                                             01050000
*    THE COMMUNICATION BYTES IN THE DCM ARE CHECKED AGAINST             01100000
*    PRE-ESTABLISHED BIT SETTINGS TO DETERMINE WHICH TYPE/FORMAT OF     01150000
*    I/O IS TO BE PERFORMED. EACH POSSIBLE REQUEST IS CHECKED AND, IF   01200000
*    APPLICABLE, THE APPROPRIATE CCWS ARE BUILT UNTIL ALL OF THE        01250000
*    DESIRED I/O REQUESTS ARE SET UP IN THE CHANNEL PROGRAM. THEY MAY   01300000
*    BE TO: BLANK THE ENTRY AREA, BLANK THE WARNING LINE, INITIALIZE    01350000
*    THE INSTRUCTION LINE, READ THE ENTRY AREA, WRITE 'MESSAGES         01400000
*    WAITING', RESTORE THE KEYBOARD. A TEST IS THEN MADE                01450000
*    TO DETERMINE IF ANY WORK NEEDS TO BE DONE BY 3277 I/O 2.           01500000
*    IF SO, AN XCTL IS TAKEN TO IEECVETV TO COMPLETE CCW BUILDING.      01550000
*    IF NOT AN EXCP IS ISSUED AND CONTROL IS RETURNED TO PROCESSOR      01600000
*    1 (IEECVET1).                                                      01650000
*                                                                       01700000
* INPUT                                                                 01750000
*    THE INDICATION OF THE DESIRED I/O IS RECEIVED IN I/O               01800000
*    COMMUNICATION BYTES 2 AND 3 IN THE DISPLAY CONTROL MODULE.         01850000
*                                                                       01900000
* OUTPUT                                                                01950000
*    WRITING OF WHAT IS REQUESTED BY THE OTHER MODULES.                 02000000
*                                                                       02050000
* EXTERNAL REFERENCES                                                   02100000
*         NONE.                                                         02150000
*                                                                       02200000
* EXITS, NORMAL                                                         02250000
*         IEECVET1 PROCESSOR 1 WHEN WORK IS COMPLETE.                   02300000
*         IEECVETV 3277 I/O 1 WHEN MORE CCWS ARE TO BE BUILT.           02350000
*         IEECVETF L/P CURSOR ON A LIGHT PEN DETECT OR ENTER            02400000
*                             WITH CURSOR OUTSIDE THE ENTRY AREA.       02450000
*         IEECVFTG CLEANUP ON A STATUS SWITCH.                          02500000
*                                                                       02550000
* EXITS, ERROR                                                          02600000
*         NONE.                                                         02650000
*                                                                       02700000
* TABLES/WORK AREAS                                                     02750000
*    DISPLAY CONTROL MODULE (CONTAINED IN DSECT AT END OF LISTING).     02800000
*                                                                       02850000
* ATTRIBUTES                                                            02900000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               02950000
*                                                                       03000000
* CHARACTER CODE DEPENDENCY                                             03050000
*    NONE.                                                              03100000
*                                                                       03150000
* NOTES                                                                 03200000
*    THE FOLLOWING FLAG BITS ARE USED:                                  03250000
*       THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF   03300000
*       OR JUST TESTED BY THIS MODULE.                                  03350000
*                                                                       03400000
*         NAME         ACTION                 FUNCTION                  03450000
*                                                                       03500000
*        DCMCOM1                                                        03550000
*         DCMIOPRD      ON         READ HAS BEEN PERFORMED              03600000
*        DCMIOCM2                                                       03650000
*         DCMBLENT   OFF/TEST      BLANK ENTRY AREA                     03700000
*         DCMBLWRL   OFF/TEST      BLANK LEFT HALF WARNING LINE         03750000
*         DCMBLWRR   OFF/TEST      BLANK RIGHT HALF WARNING LINE        03800000
*         DCMINSSH   OFF/TEST      INITIALIZE INSTRUCTION LINE          03850000
*         DCMWINFD   OFF/TEST      WRITE INFORMATION DISPLAY            03900000
*         DCMERASE   OFF/TEST      ERASE SCREEN                         03950000
*         DCMIOCRD   OFF/TEST      READ ENTRY AREA                      04000000
*         DCMWRASY   OFF/TEST      WRITE ASYNCHRONOUS ERROR MESSAGE     04050000
*        DCMIOCM3                                                       04100000
*         DCMWRPFK   OFF/TEST      ALTER PFK LINE                       04150000
*         DCMLTPFK   OFF/TEST      LIGHT ALLOCATED PFKS                 04200000
*         DCMACPFK   OFF/TEST      EXTINGUISH PFKS                      04250000
*         DCMSSRG    OFF/TEST      SUPPRESS REGENERATION                04300000
*        DCMIOUNQ                                                       04350000
*         DCMINERR    OFF          ERROR INSTRUCTION LINE               04400000
*         DCMINNOR     ON          NORMAL INSTRUCTION LINE              04450000
*        DCMUTILT                                                       04500000
*         DCMUTILB    ON/TEST      WRITE CCW EXISTS                     04550000
*********************************************************************** 04600000
  EJECT                                                                 04650000
*             REGISTER EQUATES                                          04700000
*********************************************************************** 04750000
X1PARM   EQU   1                                                        04760000
XERTRN   EQU   14                                                       04762000
XFBRANCH EQU   15                                                       04770000
R1PARM   EQU   1                   PARAMETER REGISTER                   04800000
R2COMP   EQU   2                   COMPENSATION REG                     04850000
R3WORK   EQU   3                   WORK REGISTER                        04900000
R3RMSGAL EQU   3                   STATUS SW WORK REG                   04950000
R4WORK   EQU   4                   WORK REGISTER                        05000000
R4ADDRL  EQU   4                   STATUS SW WORK REG                   05050000
R5KEEP   EQU   5                   WORK REGISTER                        05100000
R5WTINT  EQU   5                   STATUS SW WORK REG                   05150000
R6WRTSUB EQU   6                   SUBROUTINE POINTER                   05200000
R6LSCRN  EQU   6                   STATUS SW WORK REG                   05250000
R7DCMENT EQU   7                   DCM ENTRY BASE REGISTER              05300000
R8CHPGM  EQU   8                   POINTER TO CHANNEL PROGRAM AREA      05350000
RADCMBAS EQU   10                  TRANSIENT DCM BASE REGISTER          05400000
RBBASE   EQU   11                  PROGRAM BASE REGISTER                05450000
RCCXSA   EQU   12                  CXSA BASE REGISTER                   05500000
RDUCMENT EQU   13                  UCMENTRY BASE REGISTER               05550000
RERTRN   EQU   14                  WORK REGISTER                        05600000
RFRESBAS EQU   15                  RESIDENT DCM BASE                    05650000
         EJECT                                                          05700000
START    BALR  RBBASE,N0           SET UP                               05750000
         USING *,RBBASE            ADDRESSABILITY                       05800000
         B     ICATCH              BRANCH AROUND EYECATCHER             05850000
         DC    C'15 MODULE IGC5U07B, FICHE IEECVETU  ' EYECATCHER AND   05900000
ZAPAREA  DC    12C'ZAP'      RESERVED FOR FIELD MODIFICATION            05950000
ICATCH   LR    RCCXSA,R1PARM       SAVE CXSA BASE                       06000000
         USING CXSA,RCCXSA         DECLARE CXSA ADDRESS                 06050000
         L     RDUCMENT,CSAUCM     GET UCM ENTRY ADDRESS                06150000
         USING UCMLIST,RDUCMENT    DECLARE UCMENTRY BASE                06200000
         L     RFRESBAS,UCMXB      GET DCM POINTER                      06250000
         USING DCMTSRT,RFRESBAS                                         06300000
         L     RADCMBAS,DCMADTRN   GET BASE FOR TRANSIENT DCM           06350000
         USING DCMSTRT,RADCMBAS      DECLARE DCM BASE                   06400000
         L     R7DCMENT,DCMAENTR   GET DCM ENTRY POINTER                06450000
         USING DCMENTRY,R7DCMENT   DECLARE BASE                         06500000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06550000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    06560000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      06570000
         LR    R3WORK,XFBRANCH                                          06572000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          06580000
         LR    X1PARM,RCCXSA       PASS CXSA ADDRESS IN REG 1           06590000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        06592000
         LR    XFBRANCH,R3WORK                                          06594000
TOP      EQU   *                                                        06596000
         NI    DCMUTILT,N0         CLEAR UTILITY FLAGS                  06600000
         EJECT                                                          06650000
*/*%START: P               CLEAR CHANNEL PROGRAM AREA */                06700000
************************************************************            06750000
         MVI   DCMCHPGM,N0         ZERO CHANNEL PROG AREA               06800000
         MVC   DCMCHPGM+N1(N95),DCMCHPGM   ZERO CHANNEL PROG. AREA      06850000
         MVI   DCMWCC,N0           CLEAR THE WCC                        06900000
         LA    R8CHPGM,DCMCCWS     POINT TO CHANNEL PROGRAM             06950000
         MVC   N8(N8,R8CHPGM),N0(R8CHPGM)     RESTORE SELECT CCW        07000000
         LA    R8CHPGM,N16(R8CHPGM) POINT PAST SELECT CCW               07050000
         SPACE 5                                                        07100000
*/* D (YES,,NO,TESTOUT)        IS STATUS SWITCH REQUIRED? */            07150000
************************************************************            07200000
         TM    DCMR3FLG,DCMSTSWT   IS STATUS SWITCH REQUIRED            07250000
         BNO   TESTOUT              NO, TEST NEXT FUNCTION              07300000
         SPACE 5                                                        07350000
*/*TEST2: D (NO,TESTEXIT,YES,TYPE)   IS REOPEN BIT ON? */               07400000
************************************************************            07450000
TEST2    TM    DCMCS,DCMCSO        IS REOPEN BIT ON                     07500000
         BNO   TESTEXIT             NO, TEST FOR SECOND PASS            07550000
         SPACE 5                                                        07600000
*/*TYPE: D (YES,,NO,REOP)  IS THIS A MODEL 2 */                         07650000
************************************************************            07700000
TYPE     CLI   DCMLGNTH+N1,MOD2LGN  YES, IS THIS A MODEL 2              07750000
         BNE   REOP                  NO, DON'T MODIFY DCM               07800000
         SPACE 5                                                        07850000
*/* D (NO,OUTONLY,YES,)       CHANGING TO FULL CAPABIL? */              07900000
************************************************************            07950000
         TM    UCMDISP,UCMDISPE    ARE WE CHANGING TO FULL CAPACITY     08000000
         BNO   OUTONLY              NO, SET PARAMETERS                  08050000
         SPACE 5                                                        08100000
*/* P (,COMMON)   SET UP FULL CAPABILITY PARAMETERS */                  08150000
************************************************************            08200000
         LA    R3RMSGAL,N19         YES, SET PARMS FOR FULL CAP         08250000
         LA    R4ADDRL,DCMMSG19    LAST MESSAGE LINE SCT                08300000
         LA    R5WTINT,DCMBLNK1    LAST MESSAGE LINE + 1                08350000
         LA    R6LSCRN,DCMMLAST    LAST LINE ON SCREEN                  08400000
         MVI   DCMSEC20,DCMSECST    STOP SECONDARY SCT                  08450000
         MVC   DCMENTRY-N3(N3),INENT       MODIFY ATT-DES FOR           08500000
*                                   FULL CAP OPERATION                  08550000
         MVI   DCMPFKAR,DIGIT      MAKE PFK LINE LOOK FULL              08600000
         B     COMMON              GO TO INSERT VALUES                  08650000
         SPACE 5                                                        08700000
*/*OUTONLY: P (,COMMON) SET UP OUTPUT ONLY PARAMETERS */                08750000
************************************************************            08800000
OUTONLY  LA    R3RMSGAL,N23        NUMBER OF MESSAGE LINES              08850000
         LA    R4ADDRL,DCMMSG23    LAST MESSAGE LINE                    08900000
         LA    R5WTINT,DCMWARN     LAST MESSAGE LINE + 1                08950000
         LA    R6LSCRN,DCMENTR2    LAST LINE ON SCREEN                  09000000
         MVI   DCMSEC23+N1,DCMSECST STOP SECONDARY SCT                  09050000
         MVI   DCMSEC20,N0         REMOVE OLD STOPPER                   09100000
         MVI   DCMMSG20,N0         REMOVE OLD SCT STOPPER               09150000
         MVI   DCMINSTR-N2,DETECT  MAKE OLD INST LINE DETECTABLE        09200000
         MVC   DCMPFKAR(N6),SKELETON   INSERT ORDERS IN                 09250000
         MVC   DCMENTR2-N6(N6),SKELETON    SPECIAL LINES                09300000
         MVC   DCMPFKAR+N1(N2),PFKADDR    PLUG ADDRESSES                09350000
         MVC   DCMENTR2-N5(N2),ENT2ADDR    INTO SKELETONS               09400000
         MVC   DCMENTRY-N3(N3),DCMENTR2-N3 DUP SF-ATT-DES               09450000
         SPACE 5                                                        09500000
*/*COMMON:  P PUT PARAMETERS IN DCM */                                  09550000
************************************************************            09600000
COMMON   STH   R3RMSGAL,DCMMSGAL   UPDATE NUMBER OF MSG LINES           09650000
         MVC   DCMRMSAL(N2),DCMMSGAL       IN BOTH DCMS                 09700000
         ST    R4ADDRL,DCMADDRL    UPDATE ADDR OF LAST SCT              09750000
         ST    R5WTINT,DCMWTINT    UPDATE END OF FULL SCREEN WRITE      09800000
         ST    R6LSCRN,DCMLSCRN    UPDATE LAST MESSAGE LINE             09850000
         MVI   N2(R4ADDRL),DCMMSGST  STOP SCT TABLE                     09900000
         SPACE 5                                                        09950000
*/*REOP: P INDICATE REOPEN AND SECOND PASS */                           10000000
************************************************************            10050000
REOP     OI    DCMCS,DCMCSO        INDICATE REOPEN                      10100000
         OI    DCMFLG1,DCMOUTPT    INDICATE SECOND PASS                 10150000
         SPACE 5                                                        10200000
*/*CLNEXIT: P (,EXIT) SET EXIT TO CLEANUP (IEECVFTG) */                 10250000
************************************************************            10300000
CLNEXIT  L     XFBRANCH,DCMNCLN    LOAD CLEANUP ROUTINE ADDRESS         10350000
         B     EXIT                EXIT TO IEECVFTG                     10450000
         SPACE 5                                                        10500000
*/*TESTEXIT: D (NO,TYPE,YES,) IS THIS SECOND PASS? */                   10550000
************************************************************            10600000
TESTEXIT TM    DCMFLG1,DCMOUTPT    IS THIS SECOND PASS                  10650000
         BNO   TYPE                 NO, MODIFY DCM                      10700000
         SPACE 5                                                        10750000
*/*SWTCHOFF: P TURN OFF STATUS SWITCH AND SECOND PASS FLAGS */          10800000
************************************************************            10850000
SWTCHOFF NI    DCMR3FLG,X'FF'-DCMSTSWT  TURN OFF STATUS SWITCH BIT      10900000
         NI    DCMFLG1,X'FF'-DCMOUTPT   TURN OFF SECOND PASS SWITCH     10950000
         OI    DCMIOCM3,DCMWRPFK    FORCE PFK LINE WRITE                11000000
         SPACE 5                                                        11050000
*/* D (NO,%START,YES,TIMEXIT) IS CONSOLE NOW MESSAGE STREAM? */         11100000
************************************************************            11150000
         TM    UCMDISP,UCMDISPF    IS IT NOW MESSAGE STREAM             11200000
         BNO   TOP                 NO, GO BACK TO DO I/O                11250000
         SPACE 5                                                        11300000
*/*TIMEXIT: P SET UP ROLL DELETE MODE */                                11350000
************************************************************            11400000
TIMEXIT  MVC   DCMDEL(N2),RD       FORCE ROLL DELETE MODE               11450000
         OI    DCMOPTST,DCMOPRLL   TURN ON ROLL BIT                     11500000
         NI    DCMOPTST,X'FF'-DCMOPTAD  AUTO DELETE BIT OFF             11550000
         OI    DCMTIMES,DCMOTTMM+DCMOPTTI    GO FROM T/I TO MESG        11600000
         OI    DCMCMSG3,DCMCMRLL   WRITE ROLL MODE MESSAGE              11650000
         SPACE 5                                                        11700000
*/* P (,EXIT) SET EXIT TO TIMER/ INTERPRETER (IEECVETK) */              11750000
************************************************************            11800000
         L     XFBRANCH,DCMNTIMR   LOAD TIMER INTERPRETER ADDRESS       11850000
         B     EXIT                EXIT TO IEECVETK                     11900000
         SPACE 5                                                        11950000
*/*TESTOUT: D (NO,WAITWRT,YES,) IS THIS AN OUTPUT ONLY DEVICE? */       12000000
************************************************************            12050000
TESTOUT  TM    UCMDISP,UCMDISPD    IS THIS AN OUTPUT ONLY DEVICE        12100000
         BNO   WAITWRT              NO, PERFORM ALL FUNCTIONS           12150000
         SPACE 5                                                        12200000
*/* P CANCEL FUNCTIONS WHICH DO NOT APPLY */                            12250000
************************************************************            12300000
         NI    DCMIOCM1,X'FF'-DCMWRINS-DCMWRENT-DCMINSC  YES, TURN OFF  12350000
         NI    DCMIOCM2,X'FF'-DCMBLENT-DCMINSSH-DCMIOCRD-DCMWINFD BITS  12400000
         NI    DCMIOCM3,X'FF'-DCMOPRMI-DCMWRPFK  WHICH DO NOT APPLY     12450000
         SPACE 5                                                        12500000
*/*WAITWRT: D (NO,ENTBLNK,YES,WRITWAIT) ENTRY TO WRITE 'MESSAGES        12550000
*/*WAITING'                                                             12600000
*/*?*/                                                                  12650000
************************************************************            12700000
WAITWRT  EQU   *                                                        12750000
*  NOTE  THE FOLLOWING TEST APPLIES TO THE 3277 MOD 2 ONLY              12800000
         TM    DCMCMSG1,DCMMSGWT   SEE IF WRITE WAIT MSG                12850000
         BNO   ENTBLNK            NO, TEST NEXT FUNCTION                12900000
         SPACE 5                                                        12950000
*/*WRITWAIT: P MOVE MSG IN. INDICATE WRITE WARN AND SOUND               13000000
*/*ALARM */                                                             13050000
************************************************************            13100000
WRITWAIT EQU   *                                                        13150000
         NI    DCMCMSG1,N255-DCMMSGWT TURN BIT OFF                      13160003
         CLI   DCMLGNTH+N1,MOD2LGN      IS THIS A MODEL TWO   MH Y02132 13170003
         BNE   ENTBLNK              NO, DON'T OUTPUT MESSAGE  MH Y02132 13180003
         MVI   DCMWARN+N37,BLANK   MOVE BLANK IN                        13200000
         MVC   DCMWARN+N38(N40),DCMWARN+N37 PROPAGATE IT                13250000
         MVC   DCMWARN+N55(N23),WAITMSG MOVE IN WAIT MSG                13300000
         NI    DCMIOCM2,X'FF'-DCMBLWRR DON'T ERASE WARNING LINE         13400000
         OI    DCMIOCM1,DCMSOUND+DCMWRWRN   WRITE LINE AND SOUND ALARM  13450000
         SPACE 5                                                        13500000
*/*ENTBLNK: D (NO,LEFTWARN,YES,BLNKENT)  ENTRY TO BLANK ENTRY AREA? */  13550000
***********************************************************             13600000
ENTBLNK  EQU   *                                                        13650000
         TM    DCMIOCM2,DCMBLENT   BLANK ENTRY AREA                     13700000
         BNO   LEFTWARN            NO, SEE IF BLANK LEFT HALF WARN LINE 13750000
         SPACE 5                                                        13800000
*/*BLNKENT: P (,LEFTWARN) BLANK ENTRY AREA IN DCM */                    13850000
***********************************************************             13900000
BLNKENT  EQU   *                                                        13950000
         MVI   DCMENTRY,BLANK      BLANK FIRST CHARACTER                14000000
         MVC   DCMENTRY+N1(N127),DCMENTRY  BLNK REST OF COM AREA        14050000
         MVI   DCMENTRY+N128,NULL  NULL THE NEXT BYTE                   14100000
         MVC   DCMENTRY+N129(N33),DCMENTRY+N128     AND PROPAGATE IT    14150000
* NOTE  THE NULLS ARE NECESSARY TO ALLOW THE USE OF INSERT MODE.        14200000
         SPACE 5                                                        14250000
*/*LEFTWARN: D (NO,RGHTWARN,YES,WARNLEFT) ENTRY TO BLANK LEFT WARNING   14300000
*/*LINE? */                                                             14350000
***********************************************************             14400000
LEFTWARN EQU   *                                                        14450000
         L     R3WORK,DCMAWARN     POINT TO WARNING LINE                14500000
         LH    R5KEEP,DCMLGNTH     GET LENGTH OF LINE                   14550000
         SRL   R5KEEP,N1           DIVIDE BY TWO                        14600000
         TM    DCMIOCM2,DCMBLWRL   BLANK LEFT HALF WARNING LINE         14650000
         BNO   RGHTWARN             NO, SEE IF TO BLANK RIGHT SIDE      14700000
         SPACE 5                                                        14750000
*/*WARNLEFT: P (,RGHTWARN) BLANK LEFT HALF OF WARNING LINE IN DCM */    14800000
***********************************************************             14850000
WARNLEFT EQU   *                                                        14900000
         BAL   RERTRN,BLANKIT      BLANK LEFT SIDE OF LINE              14950000
         SPACE 5                                                        15000000
*/*RGHTWARN: D (NO,INSTINIT,YES,WARNRGHT) ENTRY TO BLANK RIGHT WARNING  15050000
*/*LINE? */                                                             15100000
***********************************************************             15150000
RGHTWARN EQU   *                                                        15200000
         TM    DCMIOCM2,DCMBLWRR   BLANK RIGHT HALF WARNING LINE        15250000
         BNO   INSTINIT             NO, GO TEST FOR NEXT FUNCTION       15300000
         SPACE 5                                                        15350000
*/*WARNRGHT: P (,INSTINIT) BLANK RIGHT HALF OF WARNING LINE IN DCM */   15400000
***********************************************************             15450000
WARNRGHT EQU   *                                                        15500000
         AR    R3WORK,R5KEEP       ADD 1/2 LGN TO START OF LINE         15550000
         BAL   RERTRN,BLANKIT      BLANK RIGHT SIDE OF LINE             15600000
         NI    DCMR2FLG,X'FF'-DCMRXUNV     UNV. MSG. NOT ON SCREEN      15700000
         NI    DCMCOM3,X'FF'-DCMOLUNV   IN EITHER DCM         MH Y01563 15710003
         SPACE 5                                                        15750000
*/*INSTINIT: D (NO,READMOD,YES,INITINST) ENTRY TO INIT.                 15800000
*/*INST. LINE? */                                                       15850000
***********************************************************             15900000
INSTINIT EQU   *                                                        15950000
         TM    DCMIOCM2,DCMINSSH   INITIALIZE INSTRUCTION LINE          16000000
         BNO   READMOD              NO, GO TEST FOR NEXT FUNCTION       16050000
         SPACE 4                                                        16100000
*/*INITINST: P (,READMOD) MOVE INSTRUCTION LINE TEXT TO INSTRUCTION     16150000
*/*LINE IN DCM */                                                       16200000
***********************************************************             16250000
INITINST EQU   *                                                        16300000
         MVI   DCMINSTR,BLANK      BLANK FIRST CHAR                     16350000
         MVC   DCMINSTR+N1(N77),DCMINSTR BLANK REST OF LINE             16400000
         MVC   DCMINSTR(N41),INSLMESG MOVE IN MESSAGE                   16450000
         NI    DCMIOUNQ,X'FF'-DCMINERR ERROR MESG GONE                  16500000
         OI    DCMIOUNQ,DCMINNOR   INSTRUCTION LINE IS NORMAL           16550000
         EJECT                                                          16600000
         SPACE 5                                                        16650000
*/*READMOD: D (NO,RMIKBD,YES,)  READ MODIFIED? */                       16700000
************************************************************            16750000
READMOD  NI    DCMIOCM2,X'FF'-DCMBLENT-DCMBLWRL-DCMBLWRR-DCMINSSH       16800000
*                                  INDICATE BLANKING DONE               16850000
         TM    DCMIOCM1,DCMDORMI   WAS READ MODIFIED REQUESTED          16900000
         BNO   RMIKBD               NO, TEST NEXT FUNCTION              16950000
         SPACE 5                                                        17000000
*/* P (,OPENKBD) INDICATE READ MODIFIED PERFORMED */                    17050000
************************************************************            17100000
         OI    DCMCOM1,DCMCOMRM    INDICATE READ MODIFIED PERFORMED     17150000
         NI    DCMIOCM1,X'FF'-DCMDORMI  TURN OFF BIT                    17200000
         OI    DCMIOUNQ,DCMRDARM   FORCE RETURN TO I/O                  17250000
         B     OPENKBD             GO TO BUILD CCWS                     17300000
         SPACE 5                                                        17350000
*/*RMIKBD: D (NO,READ,YES,RESTIT)   ENTRY TO UNLOCK KEYBOARD? */        17400000
************************************************************            17450000
RMIKBD   EQU   *                                                        17500000
         TM    DCMIOCM3,DCMOPRMI   SEE IF RMI                           17550000
         BNO   READ                 NO, TEST NEXT FUNCTION              17600000
         B     RESTIT               YES, DO IT                          17650000
         SPACE 5                                                        17700000
*/*OPENKBD: P BUILD CCWS FOR READ MODIFIED */                           17750000
************************************************************            17800000
OPENKBD  LA    R6WRTSUB,BUILDCCW   INIT SUBROUTINE POINTER              17850000
         LA    R5KEEP,DCMDSAV      POINT TO READ MOD DATA AREA          17900000
         LA    R3WORK,N6           PUT SIX BYTES THERE                  17950000
*                                     (AID-C1-C2-SBA-A1-A2)             18000000
         BALR  RERTRN,R6WRTSUB     GO BUILD CCW                         18050000
         MVI   0(R3WORK),READMD    INSERT READ MODIFIED COMMAND CODE    18100000
         MVI   N4(R3WORK),CHAINCOM CHANGE FLAG TO COMMAND CHAIN         18150000
         SPACE 5                                                        18200000
*/* D (NO,,YES,RESTIT) IS THIS AN OUTPUT ONLY DEVICE? */                18250000
************************************************************            18300000
         TM    UCMDISP,UCMDISPD     OUTPUT ONLY DEVICE?                 18350000
         BO    RESTIT                YES, DON'T READ ENTRY AREA         18400000
         SPACE 5                                                        18450000
*/* P BUILD CCWS TO READ ENTRY AREA */                                  18500000
************************************************************            18550000
         LA    R5KEEP,DCMENTRY-N7  POINT TO ENTRY AREA SBA -1           18600000
* NOTE  THIS WILL CAUSE THE LAST CHARACTER OF THE INSTRUCTION           18650000
*       LINE, WHICH IS ALWAYS A BLANK, TO BE USED AS THE WCC.           18700000
         LA    R3WORK,N4           SET BYTE COUNT                       18750000
         BALR  RERTRN,R6WRTSUB     BUILD THE CCW                        18800000
         MVI   N4(R3WORK),CHAINCOM CHANGE FLAG TO COMMAND CHAIN         18850000
         LA    R3WORK,N6           SET COUNT FOR SKIP                   18900000
*                                  SKIPPING AID-C1-C2-SF-ATT-DES        18950000
         BALR  RERTRN,R6WRTSUB     BUILD THE CCW                        19000000
         MVI   0(R3WORK),READBUF   CHANGE COMMAND TO READ BUFFER        19050000
         MVI   N4(R3WORK),SKIPDAT  SKIP AND CHAIN DATA                  19100000
         L     R5KEEP,DCMAENTR     POINT TO ENTRY AREA                  19150000
         LA    R3WORK,N127         LOAD LENGTH OF ENTRY AREA            19200000
         BALR  RERTRN,R6WRTSUB     BUILD THE CCW                        19250000
         MVI   N4(R3WORK),CHAINCOM CHANGE FLAGS TO COMMAND CHAIN        19300000
         SPACE 5                                                        19350000
*/*RESTIT: P (,WRITES) BUILD CCWS TO RESTORE KEYBOARD */                19400000
************************************************************            19450000
RESTIT   BAL   RERTRN,WRITECCW     BUILD WRITE CCW                      19500000
         OI    DCMUTILT,DCMUTILB    INDICATE WRITE CCW EXISTS           19550000
         OI    DCMWCC,RESTORE+RESETMDT+VALIDBIT                         19600000
*               INDICATE KEYBOARD RESTORE AND RESET MDT                 19650000
*  NOTE  WCC DOES NOT REQUIRE TRANSLATION BECAUSE ONLY ONE              19700000
*        VALUE (X'03') IS POSSIBLE WITHIN THIS MODULE.                  19750000
*        THIS IS COMPATIBLE WITH KATAKANA DEVICES.                      19800000
         NI    DCMIOCM3,X'FF'-DCMOPRMI  TURN OFF BIT                    19850000
         SPACE 5                                                        19900000
*/*WRITES: D (YES,WRITE,NO,TESTWRT) IS A WRITE CCW NEEDED? */           19950000
************************************************************            20000000
WRITES   TM    DCMIOCM1,DCMSOUND+DCMWRWRN+DCMWRMSG+DCMWRPAR+DCMWRINS+DC*20050000
               MWRENT+DCMINSC                          IS               20100000
         BNZ    WRITE                                   A               20150000
         TM    DCMIOCM2,DCMWINFD+DCMERASE+DCMWRASY     WRITE            20200000
         BNZ   WRITE                                     CCW            20250000
         TM    DCMIOCM3,DCMWRPFK                       NEEDED?          20300000
         BNO   TESTWRT             NO, IS I/O NEEDED                    20350000
         SPACE 5                                                        20400000
*/*WRITE: P (,EXIT) SET EXIT TO 3277 I/O 2 (IEECVETV) */                20450000
***********************************************************             20500000
WRITE    ST    R8CHPGM,DCMDSAV SAVE CCW POINTER                         20550000
         L     XFBRANCH,VCONIO2    GET SECOND LOAD ADDRESS              20600000
         B     EXIT                EXIT TO IEECVETV                     20650000
         SPACE 5                                                        20700000
*/*READ: D (NO,WRITES,YES,) PERFORM READ? */                            20750000
************************************************************            20800000
READ     EQU   *                                                        20850000
         TM    DCMIOCM2,DCMIOCRD   PERFORM READ                         20900000
         BNO   WRITES               NO, TEST NEXT FUNCTION              20950000
         NI    DCMIOCM2,X'FF'-DCMIOCRD  TURN OFF BIT                    21000000
         CLI   DCMDSAV,LPAID       IS THIS A SEL PEN ENTRY              21050000
         BE    LIGHT                YES, HANDLE                         21100000
         CLI   DCMDSAV,ENTAID      IS THIS AN ENTER KEY                 21150000
         BNE   WRITES               NO, IGNORE IT                       21200000
         SPACE 5                                                        21250000
*/*ENTER: P MOVE DETECT ADDRESS TO INPUT */                             21300000
************************************************************            21350000
ENTER    EQU   *                                                        21400000
         MVC   DCMDSAV(N2),DCMDSAV+N1   GET CURSOR POSITION             21450000
         LA    R2COMP,N2           ALLOW FOR ATT-DES CHARS              21500000
         B     ANREBC              GO CONVERT IT                        21550000
LIGHT    MVC   DCMDSAV(N2),DCMDSAV+N4   GET DETECT POSITION             21600000
         LA    R2COMP,N1           ALLOW FOR ATT CHAR                   21650000
         SPACE 5                                                        21700000
*/*ANREBC: P CONVERT TO LINE/CHAR */                                    21750000
************************************************************            21800000
ANREBC   LH    R4WORK,DCMDSAV      GET 3277 ADDRESS                     21850000
         SRDL  R4WORK,N8           STRIP OFF RIGHT BYTE                 21900000
         SLL   R5KEEP,N2           REMOVE EXCESS BITS                   21950000
         SLDL  R4WORK,N26          SPLICE IT BACK TOGETHER              22000000
         SRL   R4WORK,N20          ALIGN RESULT WITH NO GARBAGE         22050000
         LR    R5KEEP,R4WORK       ALIGN FOR DIVIDE                     22100000
         SR    R4WORK,R4WORK       CLEAR ANSWER REG                     22150000
         D     R4WORK,F80          DIVIDE BY LENGTH OF BUFFER LINE      22200000
         SR    R4WORK,R2COMP       APPLY COMPENSATION                   22250000
         STC   R4WORK,DCMDSAV+N1   SAVE CHAR POS IN LINE                22300000
         STC   R5KEEP,DCMDSAV      SAVE LINE NUMBER                     22350000
         SPACE 5                                                        22400000
*/* D (YES,ENTRY,NO,) WAS DETECT IN ENTRY AREA? */                      22450000
************************************************************            22500000
*  NOTE  FOLOWING TWO TESTS CAN BE TRUE ON 3277 MOD 2 ONLY.             22550000
         CLI   DCMDSAV,FRSTLINE    IS IT PTG TO FIRST LINE OF ENTRY     22600000
         BE    ENTRY                YES, HANDLE                         22650000
         CLI   DCMDSAV,SECLINE     HOW ABOUT SECOND LINE                22700000
         BE    ENTRY                YES, HANDLE SAME WAY                22750000
         SPACE 5                                                        22800000
*/*LPEXIT: P (,EXIT) SET EXIT TO L/P CURSOR ROUTINE (IEECVETF) */       22850000
************************************************************            22900000
LPEXIT   EQU   *                                                        22950000
         L     XFBRANCH,DCMNLPCR   LOAD LIGHT-PEN/CURSOR ADDRESS        23000000
         B     EXIT                EXIT TO IEECVETF                     23050000
         SPACE 5                                                        23100000
*/*ENTRY: P (,PROCEXIT) INDICATE READ PERFORMED */                      23150000
************************************************************            23200000
ENTRY    OI    DCMCOM1,DCMIOPRD    INDICATE READ PERFORMED              23250000
         B     PROCEXIT            RETURN TO PROCESSOR                  23300000
         SPACE 5                                                        23350000
*/*TESTWRT: D (YES,ENEXCP,NO,PROCEXIT) WAS A WRITE CCW BUILT? */        23400000
************************************************************            23450000
TESTWRT  TM    DCMUTILT,DCMUTILB    WAS A WRITE CCW BUILT               23500000
         BNO   PROCEXIT              NO, RETURN TO PROCESSOR            23550000
         SPACE 5                                                        23600000
*/*ENEXCP: P (,EXCP) REMOVE CHAIN FLAG FROM LAST CCW */                 23650000
***********************************************************             23700000
ENEXCP   EQU   *                                                        23750000
         SH    R8CHPGM,EIGHT       UPDATE CCW POINTER                   23800000
         MVI   N4(R8CHPGM),STOP    STOP CCW CHAIN                       23850000
         SPACE 5                                                        23900000
*/*EXCP: I (,EXIT) EXCP */                                              23950000
***********************************************************             24000000
EXCP     EQU   *                                                        24050000
         L     XFBRANCH,CSAXB      OBTAIN LOCKS               JE YM8371 24060003
         LR    R1PARM,RCCXSA       COPY CXSA ADDR             JE YM8371 24070003
         BALR  RERTRN,XFBRANCH     TO ROUTINE                 JE YM8371 24080003
         XC    UCMECB,UCMECB       CLEAR ECB                            24150003
         OI    UCMSTS,UCMBF        TURN ON BUSY BIT                     24160003
         L     R3WORK,UCMDCB       GET DCB ADDRESS                      24200000
         L     XFBRANCH,CSAXC      RELEASE LOCKS              JE YM8371 24210003
         LR    R1PARM,RCCXSA       COPY CXSA ADDR             JE YM8371 24220003
         BALR  RERTRN,XFBRANCH     TO ROUTINE                 JE YM8371 24230003
         L     R1PARM,N28(R3WORK)  GET IOB ADDRESS                      24250000
         EXCP  (R1PARM)            INITIATE I/O                         24300000
         SPACE 5                                                        24400000
*/*PROCEXIT: P (,EXIT) SET EXIT TO PROCESSOR 1 (IEECVET1) */            24450000
***********************************************************             24500000
PROCEXIT L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  24550000
*                                  FOR EXIT TO IEECVET1                 24560000
         SPACE 5                                                        24600000
*/*EXIT: R XCTL */                                                      24650000
***********************************************************             24700000
EXIT     EQU   *                                                        24750000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 24800000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             24850000
         SPACE 5                                                        24950000
********** CCW BUILDING SUBROUTINE *****************                    25000000
WRITECCW EQU   *                                                        25050000
         LA    R5KEEP,DCMWCC       POINT TO WCC CHAR                    25100000
         LA    R3WORK,N1           SET BYTE COUNT                       25150000
BUILDCCW ST    R5KEEP,N0(R8CHPGM)  SAVE WRITE FROM ADDRESS              25200000
         MVI   N0(R8CHPGM),WRITCOD INSERT WRITE CCW CODE                25250000
         STH   R3WORK,N6(R8CHPGM)  PUT BYTE COUNT IN                    25300000
         MVI   N4(R8CHPGM),CHAINDT CHAIN CCW'S                          25350000
         LR    R3WORK,R8CHPGM      SAVE PTR TO THIS CCW                 25400000
*                                     FOR CALLER                        25450000
         LA    R8CHPGM,N8(R8CHPGM) UPDATE CCW POINTER                   25500000
         BR    RERTRN              RETURN                               25550000
         SPACE 5                                                        25600000
********** BLANKING SUBROUTINE *********************                    25650000
BLANKIT  MVI   N0(R3WORK),BLANK    BLANK FIRST CHARACTER AND            25700000
         BCTR  R5KEEP,N0           REDUCE LENGTH BY ONE                 25750000
         BCTR  R5KEEP,N0           ONCE MORE FOR EXECUTE                25800000
         EX    R5KEEP,BLKEX        PROPAGATE CHARACTER                  25850000
         LA    R5KEEP,N2(R5KEEP)   RESTORE LENGTH REGISTER              25900000
         BR    RERTRN              RETURN TO CALLER                     25950000
         SPACE 5                                                        26000000
**************EXECUTED INSTRUCTION*************                         26050000
BLKEX    MVC   N1(N0,R3WORK),N0(R3WORK) PROPAGATE CHARACTER             26100000
         EJECT                                                          26150000
*     CONSTANTS                                                         26200000
VCONIO2  DC    V(IEECVETV)         SECOND LOAD ADDRESS                  26210000
EIGHT    DC    H'8'                COUNT FOR UPDATE CCW PTR             26250000
ENT2ADDR DC    X'5B60'             3277 BUFFER ADDR LINE 23             26300000
F80      DC    F'80'               LENGTH OF ONE LINE                   26350000
INENT    DC    X'401DC4'           B-SF-ATT                             26400000
PFKADDR  DC    X'D7F0'             PFK LINE ADDRESS                     26450000
SKELETON DC    X'1140401DE440'     SBA-A1-A2-SF-ATT-DES                 26500000
RD       DC    C'RD'                                                    26550000
WAITMSG  DC    C'IEE159E MESSAGE WAITING' MSGS WAITING WARNING          26600000
INSLMESG DC    C'IEE152I   '       MESSAGE ID                           26650000
         DC    X'1DE440'           SF-ATT-DES FOR DETECTION             26700000
         DC    C'ENTER   '         DETECTABLE FIELD                     26750000
         DC    X'1DE440'           SF-ATT-DES FOR DETECTION             26800000
         DC    C'CANCEL   '        DETECTABLE FIELD                     26850000
         DC    X'1DE440'           SF-ATT-DES FOR DETECTION             26900000
         DC    C'D C,K'            DETECTABLE FIELD                     26950000
         EJECT                                                          27000000
*        EQUATES                                                        27050000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            27060000
ID2      EQU   C'U'                2ND CHARACTER OF CSECT ID            27070000
BLANK    EQU   X'40'               BLANK                                27100000
CHAINCOM EQU   X'60'               COMMAND CHAINING FLAG                27150000
CHAINDT  EQU   X'A0'               DATA CHAINING FLAG                   27200000
DETECT   EQU   X'E4'               DETECTABLE ATTRIBUTE                 27250000
DIGIT    EQU   X'F0'               DECIMAL DIGIT                        27300000
ENTAID   EQU   X'7D'               ENTER AID CHAR                       27350000
FRSTLINE EQU   21                  FIRST LINE OF ENTRY AREA             27400000
LPAID    EQU   X'7E'               SEL. PEN AID CHAR                    27450000
MOD2LGN  EQU   78                  VALUE OF DCMLGNTH FOR MODEL 2        27500000
NODET    EQU   X'60'               NON-DETECTABLE ATTRIBUTE             27550000
NULL     EQU   X'00'               NULL VALUE FOR INSERT MODE HARDWARE  27600000
N0       EQU   0                   NUMBER                               27650000
N1       EQU   1                   NUMBER                               27700000
N2       EQU   2                   NUMBER                               27750000
N3       EQU   3                   NUMBER                               27800000
N4       EQU   4                   NUMBER                               27850000
N5       EQU   5                   NUMBER                               27900000
N6       EQU   6                   NUMBER                               27950000
N7       EQU   7                   NUMBER                               28000000
N8       EQU   8                   NUMBER                               28050000
N16      EQU   16                  NUMBER                               28150000
N19      EQU   19                  NUMBER                               28200000
N20      EQU   20                  NUMBER                               28250000
N23      EQU   23                  NUMBER                               28300000
N26      EQU   26                  NUMBER                               28350000
N28      EQU   28                  NUMBER                               28400000
N33      EQU   33                  NUMBER                               28450000
N37      EQU   37                  NUMBER                               28550000
N38      EQU   38                  NUMBER                               28600000
N40      EQU   40                  NUMBER                               28650000
N41      EQU   41                  NUMBER                               28700000
N55      EQU   55                  NUMBER                               28750000
N77      EQU   77                  NUMBER                               28800000
N95      EQU   95                  NUMBER                               28850000
N127     EQU   127                 LENGTH OF ENTRY AREA                 29000000
N128     EQU   128                 NUMBER                               29050000
N129     EQU   129                 NUMBER                               29100000
N255     EQU   255                 NUMBER                               29150000
READBUF  EQU   X'02'               READ BUFFER COMMAND CODE             29200000
READMD   EQU   X'06'               READ MODIFIED COMMAND CODE           29250000
RESETMDT EQU   X'01'               WCC RESET MOD DATA TAG               29300000
RESTORE  EQU   X'02'               WCC RESTORE KEYBOARD BIT             29350000
SECLINE  EQU   22                  SECOND LINE OF ENTRY AREA            29400000
SKIPDAT  EQU   X'90'               SKIP AND CHAIN DATA FLAGS            29450000
STOP     EQU   X'20'               STOP CCW CODE                        29500000
VALIDBIT EQU   X'C0'               WCC VALID BIT PATTERN WITH X'03'     29550000
WRITCOD  EQU   X'01'               WRITE CCW COMMAND CODE               29600000
         SPACE 5                                                        29650000
*/*IEECVETU: END */                                                     29700000
         SPACE 5                                                        29750000
         TITLE 'IEECVETU   IGC5U07B    327X I/O 1     RESIDENT DISPLAY *29800000
               CONTROL MODULE'                                          29850000
         IEERDCM                                                        29900000
         TITLE 'IEECVETU   IGC5U07B        3277 I/O 1        TRANSIENT *30000000
               DISPLAY CONTROL MODULE'                                  30050000
DCMSTRT  DSECT                                                          30100000
         IEECDCM  DEVICE=D                                              30150000
         TITLE 'IEECVETU   IGC5U07B     3277 I/O 1      CXSA'           30200000
         IHACTM  CXSA                                                   30300000
         TITLE 'IEECVETU   IGC5U07B        3277 I/O 1        UNIT CONTR*30350000
               OL MODULE'                                               30400000
         IEECUCM  FORMAT=NEW                                            30500000
         END                                                            30550000
./  ADD  SSI=63230282,NAME=IEECVETV
* /* START OF SPECIFICATIONS ****                                       00100000
*02*  PROCESSOR = ASSEMBLER;                                            00200000
**** END OF SPECIFICATIONS ***/                                         00300000
         TITLE 'IEECVETV IGC5V07B 3277 I/O 2'                           00400000
IEECVETV CSECT                                                          00500000
*A131600,131700                                               MH Y01566 00600000
*A261000,274000,274100                                        MH Y02159 00700000
*C163500,164000                                               MH Y02159 00800000
* STATUS                                                                01400000
*    CHANGE LEVEL 0.012                                                 01500000
*                                                                       01530000
* APARS FIXED = OZ13394                                                 01560000
*                                                                       01600000
* FUNCTION                                                              01700000
*    THIS IS A DEVICE DEPENDENT ROUTINE TO PERFORM THE REQUESTED I/O IN 01800000
*    PROPER SCREEN FORMAT.                                              01900000
*                                                                       02000000
* ENTRY POINTS                                                          02100000
*         IEECVETV FOR ALL FUNCTIONS                                    02200000
*                                                                       02300000
* OPERATION                                                             02400000
*    THE COMMUNICATION BYTES IN THE DCM ARE CHECKED AGAINST             02500000
*    PRE-ESTABLISHED BIT SETTINGS TO DETERMINE WHICH TYPE/FORMAT OF     02600000
*    I/O IS TO BE PERFORMED. EACH POSSIBLE REQUEST IS CHECKED AND, IF   02700000
*    APPLICABLE, THE APPROPRIATE CCWS ARE BUILT UNTIL ALL OF THE        02800000
*    DESIRED I/O REQUESTS ARE SET UP IN THE CHANNEL PROGRAM. THEY MAY   02900000
*    BE TO: WRITE THE FULL SCREEN, WRITE A PORTION OF THE SCREEN,       03000000
*    WRITE THE INSTRUCTION LINE, WRITE THE ENTRY AREA,                  03100000
*    INSERT THE CURSOR, WRITE THE WARNING LINE, SOUND                   03200000
*    THE ALARM, WRITE THE                                               03300000
*    INFORMATIONAL DISPLAY, ERASE THE SCREEN, WRITE THE ASYNCHRONOUS    03400000
*    ERROR MESSAGE OR WRITE THE PFK LINE. I/O IS THEN                   03500000
*    INITIATED VIA AN EXCP AND CONTROL IS RETURNED TO PROCESSOR 1       03600000
*    (IEECVET1).                                                        03700000
*                                                                       03800000
* INPUT                                                                 03900000
*    THE INDICATION OF THE DESIRED I/O IS RECEIVED IN I/O               04000000
*    COMMUNICATION BYTES 2 AND 3 IN THE DISPLAY CONTROL MODULE.         04100000
*                                                                       04200000
* OUTPUT                                                                04300000
*    WRITING OF WHAT IS REQUESTED BY THE OTHER MODULES.                 04400000
*                                                                       04500000
* EXTERNAL REFERENCES                                                   04600000
*         NONE.                                                         04700000
*                                                                       04800000
* EXITS, NORMAL                                                         04900000
*         IEECVET1 PROCESSOR 1 WHEN WORK IS COMPLETE.                   05000000
*                                                                       05100000
* EXITS, ERROR                                                          05200000
*         NONE.                                                         05300000
*                                                                       05400000
* TABLES/WORK AREAS                                                     05500000
*    DISPLAY CONTROL MODULE (CONTAINED IN DSECT AT END OF LISTING).     05600000
*                                                                       05700000
* ATTRIBUTES                                                            05800000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               05900000
*                                                                       06000000
* CHARACTER CODE DEPENDENCY                                             06100000
*    NONE.                                                              06200000
*                                                                       06300000
* NOTES                                                                 06400000
*    THE FOLLOWING FLAG BITS ARE USED:                                  06500000
*       THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF   06600000
*       OR JUST TESTED BY THIS MODULE.                                  06700000
*                                                                       06800000
*         NAME         ACTION                 FUNCTION                  06900000
*                                                                       07000000
*        DCMCOM1                                                        07100000
*         DCMIOPRD      ON         READ HAS BEEN PERFORMED              07200000
*        DCMIOCM2                                                       07300000
*         DCMBLENT   OFF/TEST      BLANK ENTRY AREA                     07400000
*         DCMBLWRL   OFF/TEST      BLANK LEFT HALF WARNING LINE         07500000
*         DCMBLWRR   OFF/TEST      BLANK RIGHT HALF WARNING LINE        07600000
*         DCMINSSH   OFF/TEST      INITIALIZE INSTRUCTION LINE          07700000
*         DCMWINFD   OFF/TEST      WRITE INFORMATION DISPLAY            07800000
*         DCMERASE   OFF/TEST      ERASE SCREEN                         07900000
*         DCMIOCRD   OFF/TEST      READ ENTRY AREA                      08000000
*         DCMWRASY   OFF/TEST      WRITE ASYNCHRONOUS ERROR MESSAGE     08100000
*        DCMIOCM3                                                       08200000
*         DCMWRPFK   OFF/TEST      ALTER PFK LINE                       08300000
*         DCMLTPFK   OFF/TEST      LIGHT ALLOCATED PFKS                 08400000
*         DCMACPFK   OFF/TEST      EXTINGUISH PFKS                      08500000
*         DCMSSRG    OFF/TEST      SUPPRESS REGENERATION                08600000
*        DCMIOUNQ                                                       08700000
*         DCMINERR    OFF          ERROR INSTRUCTION LINE               08800000
*         DCMINNOR     ON          NORMAL INSTRUCTION LINE              08900000
*        DCMUTILT                                                       09000000
*         DCMUTILB  ON/OFF/TEST    WRITE CCW EXISTS                     09100000
*********************************************************************** 09200000
  EJECT                                                                 09300000
*             REGISTER EQUATES                                          09400000
*********************************************************************** 09500000
X1PARM   EQU   1                                                        09600000
XFBRANCH EQU   15                                                       09700000
R1PARM   EQU   1                   PARAMETER REGISTER                   09800000
R2BRANCH EQU   2                   BRANCH REGISTER                      09900000
R3WORK   EQU   3                   WORK REGISTER                        10000000
R3RMSGAL EQU   3                   STATUS SW WORK REG                   10100000
R4WORK   EQU   4                   WORK REGISTER                        10200000
R4POINT  EQU   4                   WORK REGISTER                        10300000
R4ADDRL  EQU   4                   STATUS SW WORK REG                   10400000
R5KEEP   EQU   5                   WORK REGISTER                        10500000
R5WTINT  EQU   5                   STATUS SW WORK REG                   10600000
R6WORK   EQU   6                   WORK REGISTER                        10700000
R7DCMENT EQU   7                   DCM ENTRY BASE REGISTER              10800000
R8CHPGM  EQU   8                   POINTER TO CHANNEL PROGRAM AREA      10900000
R9PFKPTR EQU   9                   POINTER TO PFK AREA                  11000000
RADCMBAS EQU   10                  TRANSIENT DCM BASE REGISTER          11100000
RBBASE   EQU   11                  PROGRAM BASE REGISTER                11200000
RCCXSA   EQU   12                  CXSA BASE REGISTER                   11300000
RDUCMENT EQU   13                  UCMENTRY BASE REGISTER               11400000
RERTRN   EQU   14                  WORK REGISTER                        11500000
RFRESBAS EQU   15                  RESIDENT DCM BASE                    11600000
         EJECT                                                          11700000
START    BALR  RBBASE,N0           SET UP                               11800000
         USING *,RBBASE            ADDRESSABILITY                       11900000
         B     ICATCH              BRANCH AROUND EYECATCHER             12000000
         DC    C'12 MODULE IGC5V07B, FICHE IEECVETV  ' EYECATCHER AND   12100000
ZAPAREA  DC    12C'ZAP'               RESERVED FOR FIELD MODIFICATION   12200000
ICATCH   LR    RCCXSA,R1PARM       SAVE CXSA BASE                       12300000
         USING CXSA,RCCXSA         DECLARE CXSA ADDRESS                 12400000
         L     RDUCMENT,CSAUCM     GET UCM ENTRY ADDRESS                12500000
         USING UCMLIST,RDUCMENT    DECLARE UCMENTRY BASE                12600000
         L     RFRESBAS,UCMXB      GET DCM POINTER                      12700000
         USING DCMTSRT,RFRESBAS                                         12800000
         L     R9PFKPTR,DCMADPFK   POINT TO PFK AREA                    12900000
         L     RADCMBAS,DCMADTRN   GET BASE FOR TRANSIENT DCM           13000000
         USING DCMSTRT,RADCMBAS      DECLARE DCM BASE                   13100000
         L     R7DCMENT,DCMAENTR   GET DCM ENTRY POINTER                13200000
         USING DCMENTRY,R7DCMENT   DECLARE BASE                         13300000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      13400000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    13500000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      13600000
         L     R8CHPGM,DCMDSAV    POINT TO CHANNEL PROGRAM              13700000
         LA    R2BRANCH,BUMP1      SET BRANCH REG                       13800000
         TM    DCMUTILT,DCMUTILB   DOES WRITE CCW EXIST                 14200000
         BO    ERASEPFM             YES, DON'T BUILD ANOTHER            14300000
WRITE    BAL   RERTRN,WRITECCW     GO BUILD WRITE CCW                   14400000
         OI    DCMUTILT,DCMUTILB   INDICATE WRITE CCW EXISTS            14500000
ERASEPFM EQU   *                                                        14900000
         TM    DCMIOCM2,DCMERASE   SEE IF ERASE                         15000000
         BNO   FULLWRT              NO, CHECK NEXT FUNCTION             15100000
PFMERASE EQU   *                                                        15500000
         LA    R5KEEP,DCMERSDT     POINT TO ERASE DATA                  15600000
         LA    R3WORK,N7           SET BYTE COUNT                       15700000
         BAL   RERTRN,BUILDCCW     GO BUILD CCW                         15800000
         NI    DCMIOCM2,X'FF'-DCMERASE TURN OFF ERASE BIT               15900000
         B     ASYWRIT             TEST NEXT FUNCTION                   16000000
FULLWRT  EQU   *                                                        16500000
         TM    DCMIOCM1,DCMWRMSG   WRITE FULL MESSAGE AREA              16600000
         BNO   PARTWRT              NO, TEST NEXT FUNCTION              16700000
FULLMSG  EQU   *                                                        17100000
         L     R5KEEP,DCMASCRN     POINT TO START OF TEXT               17200000
         SH    R5KEEP,H6           BACK UP TO CONTROL CHARS             17300000
         L     R3WORK,DCMWTBUF     PT TO END OF BUFF                    17400000
         SR    R3WORK,R5KEEP       CALC BYTE COUNT                      17500000
         SH    R3WORK,H6           ACCOUNT FOR CONTROL CHARS            17600000
         LTR   R3WORK,R3WORK       IS BYTE COUNT ZERO                   17700000
         BZ    PARTWRT              YES, DON'T BUILD CCW                17800000
         ST    R8CHPGM,DCMDSAV+N4  SAVE CHAN PGM ADDR          @ZA13394 17850000
         BAL   RERTRN,BUILDCCW     GO BUILD THE CCW                     17900000
         BAL   RERTRN,XLATE        XLATE CTRL CHARAC FM TEXT   @ZA13394 17950000
         B     AANDD               INSERT ATTRIBUTE & DES AS REQ        18000000
PARTWRT  EQU   *                                                        18500000
         TM    DCMIOCM1,DCMWRPAR   WRITE PARTIAL MESSAGE AREA           18600000
         BNO   ASYWRIT              NO, TEST NEXT FUNCTION              18700000
PARTMSG  EQU   *                                                        19100000
         SR    R5KEEP,R5KEEP       CLEAR REG                            19200000
         L     R4POINT,DCMASCRN    POINT TO START OF MESSAGE AREA       19300000
         SH    R4POINT,H6          BACK UP TO CONTROL CHARS             19400000
         IC    R5KEEP,DCMLINEN     GET LINE NO                          19500000
         BCTR  R5KEEP,N0           DECREMENT BY 1                       19600000
         MH    R5KEEP,DCMCORLN     MULT BY LINE LENGTH        MB        19700000
         AR    R5KEEP,R4POINT      ADD BEGINNING ADDR TO GET ID ADDR    19800000
         LH    R3WORK,DCMBYTCT     GET WRITE LENGTH                     19900000
         ST    R8CHPGM,DCMDSAV+N4  SAVE CHAN PGM ADDR          @ZA13394 19950000
         BAL   RERTRN,BUILDCCW     BUILD CCW                            20000000
         BAL   RERTRN,XLATE        XLATE CTRL CHARAC FM TEXT   @ZA13394 20200000
AANDD    NI    DCMIOCM1,X'FF'-DCMWRMSG-DCMWRPAR TURN BITS OFF           20500000
         L     R3WORK,DCMAMTAB     POINT TO START OF SCT                20600000
         L     R6WORK,DCMASCRN     POINT TO FIRST LINE OF TEXT          20700000
         L     R5KEEP,DCMADSEC     POINT TO START OF SSCT               20800000
TESTCTL1 TM    N1(R3WORK),DCMMSGCL IS THIS IN-LINE CONTROL LINE         20900000
         BO    INSERT1              YES, INSERT ATT. AND DES.           21000000
         TM    0(R5KEEP),DCMSECCL  IS THIS OUT-OF-LINE CONTROL LINE     21100000
*                                     (MOD 2 ONLY)                      21200000
         BNO   BUMP1                NO, GET NEXT ENTRY                  21300000
         TM    N0(R3WORK),DCMMSGJK  YES, IS IT STILL IN DCM             21400000
         BO    INSERT2               YES, INSERT CONTROL CHARS          21500000
BUMP1    LA    R3WORK,N2(R3WORK)   POINT TO NEXT SCT ENTRY              21600000
         TM    N0(R3WORK),DCMMSGST IS THIS END OF TABLE                 21700000
         BO    ASYWRIT              YES, GO TO NEXT FUNCTION            21800000
         AH    R6WORK,DCMCORLN     POINT TO NEXT LINE                   21900000
         LA    R5KEEP,N1(R5KEEP)   POINT TO NEXT SSCT ENTRY             22000000
         B     TESTCTL1            GO TEST NEXT ENTRY                   22100000
INSERT1  CLI   DCMLGNTH+N1,MOD1LGN IS IT A MODEL 1                      22200000
         BE    BUMP1                YES, NO CONTROL CHARS NEEDED        22300000
MOD2     MVC   N63(N3,R6WORK),DETAD    INSERT  SF, ATT & DES            22400000
         B     BUMP1               GO TO TEST NEXT ENTRY                22500000
ASYWRIT  EQU   *                                                        23000000
         TM    DCMIOCM2,DCMWRASY   SEE IF WRITE ASYN ERROR              23100000
         BNO   PFKWRITE             NO, CHECK NEXT FUNCTION             23200000
WRITASY  EQU   *                                                        23600000
         OI    DCMWCC,RESTORE+RESETMDT  RESTORE AND RESET MDT           23700000
         L     R5KEEP,DCMAENTR     POINT TO START OF MSG                23800000
         LH    R3WORK,DCMLGNTH     GET LENGTH OF LINE                   23900000
         SLL   R3WORK,N1           DOUBLE IT                            24000000
         BAL   RERTRN,BUILDCCW     BUILD CCW                            24100000
*  NOTE  LINE WILL BE WRITTEN TO MID-SCREEN, WHERE                      24200000
*        BLANKING DATA LEAVES CURSOR.                                   24300000
         NI    DCMIOCM2,X'FF'-DCMWRASY   TURN BIT OFF                   24400000
         B     ENEXCP              GO TO EXECUTE                        24500000
PFKWRITE EQU   *                                                        24900000
         TM    DCMIOCM3,DCMWRPFK   WRITE PFK AREA                       25000000
         BNO   INSTWRT              NO, TEST NEXT FUNCTION              25100000
WRITEPFK EQU   *                                                        25500000
* EACH TIME THIS ROUTINE IS ENTERED IT WILL CHANGE THE STATUS OF THE    25600000
*  DISPLAYED PFK LINE.  IF THE LINE IS DISPLAYED IT WILL BE ERASED      25700000
*   IF IT IS BLANK IT WILL BE BUILT AND WRITTEN TO THE SCREEN.          25800000
         SPACE                                                          25900000
         LR    R4POINT,R9PFKPTR   GET POINTER TO PFK AREA               26000000
         L     R3WORK,DCMPFKLN    GET POINTER TO PFK LINE               26100000
         CLI   N0(R3WORK),BLANK    IS LINE BLANK NOW                    26200000
         MVI   N0(R3WORK),BLANK   BLANK FIRST POSITION                  26300000
         MVC   N1(N83,R3WORK),N0(R3WORK)     PROPAGATE BLANK            26400000
         BNE   WRITIT             NO, IT WASN'T BUT WE JUST             26500000
*                                  BLANKED IT SO WRITE IT               26600000
         LTR   R4POINT,R4POINT     ANY KEYS ALLOCATED         MH Y01566 27000000
         BZ    WRITIT               NO, JUST WRITE BLANK LINE MH Y01566 27100000
LOOP3    CLI   N0(R4POINT),STOPPER IS THIS END OF AREA                  27200000
         BE    WRITIT              YES, STOP GENERATION                 27300000
         MVC   N0(N3,R3WORK),DETAD NO, INSERT SF, ATT AND DES CHARS     27400000
KEYSTART SR    R5KEEP,R5KEEP      CLEAR WORK REGISTER                   27500000
         IC    R5KEEP,N0(R4POINT) GET KEY NUMBER                        27600000
         CVD   R5KEEP,DCMPACK     CONVERT IT TO DECIMAL                 27700000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2)   UNPACK IT              27800000
         OI    DCMCVBIN+N3,ZONE   CHANGE SIGN TO EBCDIC                 27900000
         MVC   N3(N2,R3WORK),DCMCVBIN+N2    MOVE KEY TO LINE            28000000
         CLI   N3(R3WORK),ZERO    IS FIRST DIGIT ZERO                   28100000
         BNE   TWOCHAR             NO, CONTINUE                         28200000
         MVC   N3(N2,R3WORK),N4(R3WORK) SHIFT CHAR OVER                 28300000
         BCTR  R3WORK,N0           ADJUST POINTER                       28400000
TWOCHAR  EQU   *                                                        28500000
         MVI   DCMCVBIN+N2,ZEROS  CLEAR OUT                             28600000
         MVI   DCMCVBIN+N3,ZEROS     WORK AREA                          28700000
         LA    R3WORK,N8(R3WORK)  POINT TO NEXT LINE SEGMENT            28800000
         LA    R4POINT,PFKLGN(R4POINT)     POINT TO NEXT PFK AREA       28900000
         B     LOOP3              GO SEE IF ANY MORE                    29000000
WRITIT   EQU   *                                                        29400000
         NI    DCMIOCM3,X'FF'-DCMWRPFK  TURN OFF BIT                    29500000
         LA    R5KEEP,DCMPFKC      POINT TO CONTROL CHARS               29600000
         LA    R3WORK,N3           SET BYTE COUNT                       29700000
         BAL   RERTRN,BUILDCCW     GO BUILD CCW                         29800000
         L     R5KEEP,DCMPFKLN     POINT TO PFK LINE                    29900000
         LH    R3WORK,DCMCORLN     GET LENGTH OF WRITE                  30000000
         BAL   RERTRN,BUILDCCW     BUILD CCW                            30100000
INSTWRT  EQU   *                                                        30600000
         TM    DCMIOCM1,DCMWRINS   WRITE INSTR LINE                     30700000
         BNO   ENTRYWRT             NO, TEST NEXT FUNCTION              30800000
WRITEINS EQU   *                                                        31200000
         NI    DCMIOCM1,N255-DCMWRINS TURN OFF INS LINE WRITE BIT       31300000
         LA    R5KEEP,DCMINSTR-N6  POINT TO INST LINE                   31400000
         LH    R3WORK,DCMCORLN     GET WRITE LENGTH                     31500000
         BAL   RERTRN,BUILDCCW     BUILD WRITE SCREEN CCW               31600000
         TM    DCMIOUNQ,DCMINNOR   IS LINE NORMAL                       31700000
         BO    NORMINST             YES, DE-INTENSIFY                   31800000
         MVI   DCMINSTR-N2,HIGHINT  NO, INTENSIFY IT                    31900000
         MVC   DCMINSTR+N57(N20),DETAD  PUT ENTER-CANCEL ON RIGHT       32000000
         B     ENTRYWRT            TEST NEXT FUNCTION                   32100000
NORMINST MVI   DCMINSTR-N2,NORMINT SET NORMAL INTENSITY                 32200000
ENTRYWRT EQU   *                                                        32700000
         TM    DCMIOCM1,DCMWRENT   WRITE ENTRY AREA                     32800000
         BNO   CURSORIN             NO, TEST NEXT FUNCTION              32900000
WRITENT  EQU   *                                                        33300000
         NI    DCMIOCM1,X'FF'-DCMWRENT TURN OFF WRITE ENTRY AREA BIT    33400000
         MVI   DCMENTRY+N127,NULL  NULL BYTE PAST COMMAND     MH Y02159 33500000
         MVC   DCMENTRY+N128(N34),DCMENTRY+N127   AND REST OF LINE      33600000
         LA    R5KEEP,DCMENTRY-N6  POINT TO ENTRY LINE                  33700000
         LA    R3WORK,ENTLGN       LOAD LENGTH OF ENTRY AREA            33800000
         BAL   RERTRN,BUILDCCW     BUILD WRITE CCW                      33900000
CURSORIN EQU   *                                                        34300000
         TM    DCMIOCM1,DCMINSC    INSERT CURSOR                        34400000
         BNO   WARNWRIT             NO, TEST NEXT FUNCTION              34500000
INCURSOR EQU   *                                                        34900000
         NI    DCMIOCM1,X'FF'-DCMINSC TURN OFF BIT                      35000000
         SR    R5KEEP,R5KEEP       CLEAR WORK REG                       35100000
         IC    R5KEEP,DCMCULNO     GET LINE NUMBER                      35200000
         BCTR  R5KEEP,N0           REDUCE BY ONE                        35300000
         MH    R5KEEP,H78          MULT BY LGN LINE 1                   35400000
         SR    R3WORK,R3WORK       CLEAR WORK REG             MB        35500000
         IC    R3WORK,DCMPOSCU     GET CHARACTER POSITION               35600000
         LA    R5KEEP,EACHAR(R5KEEP,R3WORK) GET ADDR TO INS CURSOR      35700000
         STC   R5KEEP,DCMCRSDT+N2  STORE RIGHT HALF OF DATA             35800000
         SRL   R5KEEP,N6           ISOLATE LEFT HALF OF DATA            35900000
         STC   R5KEEP,DCMCRSDT+N1  STORE IT                             36000000
         NI    DCMCRSDT+N2,CLEANIT CLEAN UP RIGHT HALF                  36100000
         TR    DCMCRSDT+N1(N2),TRTABLE  TRANSLATE TO 3277 CODE          36200000
         LA    R5KEEP,DCMCRSDT     GET PTR FOR INSERT CURSOR            36300000
         LA    R3WORK,N4           SET BYTE COUNT                       36400000
         BAL   RERTRN,BUILDCCW     BUILD CCW                            36500000
WARNWRIT EQU   *                                                        37000000
         TM    DCMIOCM1,DCMWRWRN   WRITE WARNING LINE                   37100000
         BNO   INFOWRIT             NO, TEST NEXT FUNCTION              37200000
WRITWARN EQU   *                                                        37600000
         NI    DCMIOCM1,X'FF'-DCMWRWRN TURN OFF WARNING LINE BIT        37700000
         L     R5KEEP,DCMAWARN     POINT TO WARNING LINE                37800000
         SH    R5KEEP,H6           BACK UP TO CONTROL CHARACTERS        37900000
         LH    R3WORK,DCMCORLN     LENGTH OF WRITE                      38000000
         BAL   RERTRN,BUILDCCW     BUILD WRITE CCW                      38100000
INFOWRIT EQU   *                                                        38600000
         TM    DCMIOCM2,DCMWINFD   SEE IF WRITE INFO DISPLAY            38700000
         BNO   ALRMSND              NO, GO TEST FOR NEXT FUNCTION       38800000
WRITINFO EQU   *                                                        39200000
         NI    DCMIOCM2,X'FF'-DCMWINFD  TURN OFF BIT                    39300000
         SR    R4WORK,R4WORK       CLEAR REG                            39400000
         IC    R4WORK,DCMLINEN     GET LINE NUMBER                      39500000
         BCTR  R4WORK,N0           BACK UP TO LINE                      39600000
         MH    R4WORK,DCMCORLN     INDEX TO THAT LINE                   39700000
         A     R4WORK,DCMASCRN     ADD TO START OF BUFFER               39800000
         SH    R4WORK,H6           BACK UP TO CONTROL CHARS             39900000
         L     R6WORK,DCMAINS      POINT TO FIRST DATA LINE   MB        40000000
         CLI   N65(R6WORK),SPLAT   IS IT A CONTROL LINE                 40100000
         BNE   BUILDEM              NO, CONTINUE                        40200000
         LA    R2BRANCH,BUILDEM    LOAD SUBROUTINE RETURN               40300000
INSERT2  MVC   N55(N3,R6WORK),DETAD     YES, INSERT SF-ATT-DES          40400000
         MVC   N63(N3,R6WORK),DETAD           FOR DETECTION             40500000
         TM    N71(R6WORK),DIGIT   IS CCA STILL INTACT                  40600000
         BCR   NOTONE,R2BRANCH      NO, WE'VE BEEN HERE BEFORE          40700000
         MVC   DCMDSAV(N3),N71(R6WORK)    SAVE CCA                      40800000
         MVC   N75(N3,R6WORK),DCMDSAV     RESTORE IT                    40900000
         MVC   N71(N3,R6WORK),NORMAT    MAKE IT UNDETECTABLE            41000000
         BR    R2BRANCH            RETURN TO CALLER                     41100000
* NOTE  BRANCH IS A NO-OP IF WE ENTERED FROM THE WRITINFO ROUTINE       41200000
*       AND TO LABLE 'BUMP1' IF WE CAME FROM WRITE FULL OR PARTIAL      41300000
BUILDEM  LA    R3WORK,N6           SET BYTE COUNT                       41400000
         LR    R5KEEP,R4WORK       SET WRITE FROM ADDRESS               41500000
         BAL   RERTRN,BUILDCCW     BUILD CCW TO WRITE CONTROL           41600000
         LH    R3WORK,DCMLGNTH     SET  BYTE COUNT FOR TEXT             41700000
         LR    R5KEEP,R6WORK       POINT TO DATA                        41800000
         BAL   RERTRN,BUILDCCW     BUILD CCW TO WRITE DATA              41900000
         CLC   DCMBYTCT,DCMCORLN   WAS THIS LAST LINE                   42000000
         BNH   ALRMSND              YES, ALL DONE                       42100000
         LH    R3WORK,DCMBYTCT      NO, GET BYTE COUNT                  42200000
         SH    R3WORK,DCMCORLN     SUBTRACT LENGTH OF LAST LINE         42300000
         STH   R3WORK,DCMBYTCT     UPDATE BYTE COUNT                    42400000
         AH    R4WORK,DCMCORLN     UPDATE CONTROL POINTER               42500000
         AH    R6WORK,DCMCORLN     UPDATE DATA POINTER                  42600000
         B     BUILDEM             GO DO NEXT LINE                      42700000
ALRMSND  EQU   *                                                        43100000
         TM    DCMIOCM1,DCMSOUND   SOUND ALARM                          43200000
         BNO   ENEXCP               NO, STOP CCW CHAIN                  43300000
SOUNDALM EQU   *                                                        43700000
         NI    DCMIOCM1,X'FF'-DCMSOUND                                  43800000
         OI    DCMWCC,ALARM        TURN ON BIT IN WCC                   43900000
ENEXCP   EQU   *                                                        44300000
         SH    R8CHPGM,EIGHT       UPDATE CCW POINTER                   44400000
         MVI   N4(R8CHPGM),STOP    STOP CCW CHAIN                       44500000
         NI    DCMWCC,VALRNG       ENSURE VALID INPUT TO XLATE          44600000
*  NOTE HIGH ORDER TWO BITS MAY HAVE BEEN TURNED ON IN                  44700000
*       I/O ROUTINE 1.                                                  44800000
         TR    DCMWCC(N1),TRTABLE  CONVERT WCC CHARACTER                44900000
EXCP     EQU   *                                                        45300000
         L     XFBRANCH,CSAXB      OBTAIN LOCKS               JE YM8371 45400000
         LR    R1PARM,RCCXSA       COPY CXSA ADDR             JE YM8371 45500000
         BALR  RERTRN,XFBRANCH     TO ROUTINE                 JE YM8371 45600000
         XC    UCMECB,UCMECB       CLEAR ECB                            45700000
         OI    UCMSTS,UCMBF        TURN ON BUSY BIT                     45800000
         L     R3WORK,UCMDCB       GET DCB ADDRESS                      45900000
         L     XFBRANCH,CSAXC      RELEASE LOCKS              JE YM8371 46000000
         LR    R1PARM,RCCXSA       COPY CXSA ADDR             JE YM8371 46100000
         BALR  RERTRN,XFBRANCH     TO ROUTINE                 JE YM8371 46200000
         L     R1PARM,N28(R3WORK)  GET IOB ADDRESS                      46300000
         EXCP  (R1PARM)            INITIATE I/O                         46400000
PROCEXIT L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  46800000
*                                  FOR EXIT TO IEECVET1                 46900000
EXIT     EQU   *                                                        47300000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 47400000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             47500000
         SPACE 5                                                        47600000
WRITECCW EQU   *                                                        47700000
         LA    R5KEEP,DCMWCC       POINT TO WCC CHAR                    47800000
         LA    R3WORK,N1           SET BYTE COUNT                       47900000
BUILDCCW ST    R5KEEP,N0(R8CHPGM)  SAVE WRITE FROM ADDRESS              48000000
         MVI   N0(R8CHPGM),WRITCOD INSERT WRITE CCW CODE                48100000
         STH   R3WORK,N6(R8CHPGM)  PUT BYTE COUNT IN                    48200000
         MVI   N4(R8CHPGM),CHAINDT CHAIN CCW'S                          48300000
         LA    R8CHPGM,N8(R8CHPGM) UPDATE CCW POINTER                   48400000
         BR    RERTRN              RETURN                               48500000
XLATE    L     R6WORK,DCMDSAV+N4   GET CHAN PGM ADDR           @ZA13394 48507000
         LH    R5KEEP,N6(R6WORK)   GET TEXT LNGTH              @ZA13394 48514000
         L     R6WORK,N0(R6WORK)   GET TEXT BEGINING           @ZA13394 48516000
         LA    R6WORK,N0(R6WORK)   CLR HIGH ORDER BYTE         @ZA13394 48518000
         AR    R5KEEP,R6WORK       GET TEXT END+1              @ZA13394 48521000
         LH    R3WORK,DCMAXLGN     MAX LINE LGTH               @ZA13394 48535000
         BCTR  R3WORK,N0           DECREMENT BY ONE            @ZA13394 48542000
LOOP     EX    R3WORK,TRIN         BLANK OUT CTRL CHARC        @ZA13394 48549000
         AH    R6WORK,DCMCORLN     GET NEXT LINE               @ZA13394 48556000
         CR    R6WORK,R5KEEP       LAST LINE                   @ZA13394 48563000
         BL    LOOP                NO                          @ZA13394 48570000
         BR    RERTRN              RETURN TO PGM               @ZA13394 48577000
TRIN     TR    N6(0,R6WORK),TRTAB                              @ZA13394 48584000
         EJECT                                                          48600000
*     CONSTANTS                                                         48700000
BLANKS   DC    2C' '               BLANKS                               48800000
DETAD    DC    X'1DE440'           SF-ATT-DES FOR DETECTION             48900000
         DC    C'ENTER   '         DETECTABLE FIELD                     49000000
         DC    X'1DE440'           SF-ATT-DES FOR DETECTION             49100000
         DC    C'CANCEL'           DETECTABLE FIELD                     49200000
EIGHT    DC    H'8'                COUNT FOR UPDATE CCW PTR             49300000
F80      DC    F'80'               LENGTH OF ONE LINE                   49400000
H6       DC    H'6'                LENGTH OF CONTROL CHAR FIELD         49500000
H78      DC    H'78'               LENGTH OF ENT AREA LINE 1            49600000
NORMAT   DC    X'1D6040'           NON DETECT FIELD                     49700000
TRTABLE  DC    X'40C1C2C3C4C5C6C7C8C94A4B4C4D4E4F'                      49800000
         DC    X'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F'                      49900000
         DC    X'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F'                      50000000
         DC    X'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F'                      50100000
TRTAB    DS    0CL256                                          @ZA13394 50103000
         DC    AL1(0)                                          @ZA13394 50104000
         DC    AL1(01,02,03,04,64,06,07,08,09,10)              @ZA13394 50106000
         DC    AL1(11,12,13,14,15,16,64,64,64,20)              @ZA13394 50109000
         DC    AL1(21,22,23,24,25,26,27,28,64,30)              @ZA13394 50112000
         DC    AL1(31,32,33,34,35,36,37,38,39,40)              @ZA13394 50115000
         DC    AL1(41,42,43,44,45,46,47,48,49,50)              @ZA13394 50118000
         DC    AL1(51,52,53,54,55,56,57,58,59,64)              @ZA13394 50121000
         DC    AL1(61,62,63,64,65,66,67,68,69,70)              @ZA13394 50124000
         DC    AL1(71,72,73,74,75,76,77,78,79,80)              @ZA13394 50127000
         DC    AL1(81,82,83,84,85,86,87,88,89,90)              @ZA13394 50130000
         DC    AL1(91,92,93,94,95,96,97,98,99,100)             @ZA13394 50133000
         DC    AL1(101,102,103,104,105,106,107,108,109,110)    @ZA13394 50136000
         DC    AL1(111,112,113,114,115,116,117,118,119,120)    @ZA13394 50139000
         DC    AL1(121,122,123,124,125,126,127,128,129,130)    @ZA13394 50142000
         DC    AL1(131,132,133,134,135,136,137,138,139,140)    @ZA13394 50145000
         DC    AL1(141,142,143,144,145,146,147,148,149,150)    @ZA13394 50148000
         DC    AL1(151,152,153,154,155,156,157,158,159,160)    @ZA13394 50151000
         DC    AL1(161,162,163,164,165,166,167,168,169,170)    @ZA13394 50154000
         DC    AL1(171,172,173,174,175,176,177,178,179,180)    @ZA13394 50157000
         DC    AL1(181,182,183,184,185,186,187,188,189,190)    @ZA13394 50160000
         DC    AL1(191,192,193,194,195,196,197,198,199,200)    @ZA13394 50163000
         DC    AL1(201,202,203,204,205,206,207,208,209,210)    @ZA13394 50166000
         DC    AL1(211,212,213,214,215,216,217,218,219,220)    @ZA13394 50169000
         DC    AL1(221,222,223,224,225,226,227,228,229,230)    @ZA13394 50172000
         DC    AL1(231,232,233,234,235,236,237,238,239,240)    @ZA13394 50175000
         DC    AL1(241,242,243,244,245,246,247,248,249,250)    @ZA13394 50178000
         DC    AL1(251,252,253,254)                            @ZA13394 50181000
TREND    DC    AL1(TREND-TRTAB)                                @ZA13394 50184000
*        EQUATES                                                        50200000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            50300000
ID2      EQU   C'V'                2ND CHARACTER OF CSECT ID            50400000
ALARM    EQU   X'04'               WCC ALARM BIT                        50500000
BLANK    EQU   C' '                BLANK                                50600000
CHAINCOM EQU   X'60'               COMMAND CHAINING FLAG                50700000
CHAINDT  EQU   X'A0'               DATA CHAINING FLAG                   50800000
CLEANIT  EQU   X'3F'               STRIPS LEFT TWO BITS IN BYTE         50900000
DIGIT    EQU   X'F0'               ZONE FOR EBCDIC DIGIT                51000000
EACHAR   EQU   1681                CHAR POS OF ENTRY AREA               51100000
ENTAID   EQU   X'7D'               ENTER AID CHAR                       51200000
ENTLGN   EQU   164                 LENGTH OF ENTRY AREA WRITE           51300000
FRSTLINE EQU   21                  FIRST LINE OF ENTRY AREA             51400000
HIGHINT  EQU   X'E8'               ATTRIBUTE HIGH INTENSITY BYTE        51500000
LPAID    EQU   X'7E'               SEL. PEN AID CHAR                    51600000
MOD1LGN  EQU   38                  LENGTH OF MODEL 1 LINE               51700000
NODIG    EQU   X'00'               NULL HEX VALUE                       51800000
NORMINT  EQU   X'60'               ATTRIBUTE NORMAL INTENSITY BYTE      51900000
NOTONE   EQU   14                  BRANCH CONDITION                     52000000
NULL     EQU   X'00'               NULL CHARACTER                       52100000
N0       EQU   0                   NUMBER                               52200000
N1       EQU   1                   NUMBER                               52300000
N2       EQU   2                   NUMBER                               52400000
N3       EQU   3                   NUMBER                               52500000
N4       EQU   4                   NUMBER                               52600000
N6       EQU   6                   NUMBER                               52700000
N7       EQU   7                   NUMBER                               52800000
N8       EQU   8                   NUMBER                               52900000
N20      EQU   20                  NUMBER                               53000000
N28      EQU   28                  NUMBER                               53100000
N33      EQU   33                  NUMBER                               53200000
N34      EQU   34                  NUMBER                     MH Y02159 53300000
N55      EQU   55                  NUMBER                               53400000
N57      EQU   57                  NUMBER                               53500000
N63      EQU   63                  NUMBER                               53600000
N65      EQU   65                  NUMBER                               53700000
N71      EQU   71                  NUMBER                               53800000
N75      EQU   75                  NUMBER                               53900000
N83      EQU   83                  NUMBER                               54000000
N127     EQU   127                 ENTRY AREA CHAR PAST CMD   MH Y02159 54100000
N128     EQU   128                 NUMBER                     MH Y02159 54200000
N129     EQU   129                 NUMBER                               54300000
N255     EQU   255                 NUMBER                               54400000
PFKLGN   EQU   110                 LENGTH OF PFK AREA                   54500000
READMD   EQU   X'06'               READ MODIFIED COMMAND CODE           54600000
RESETMDT EQU   X'01'               WCC RESET MOD DATA TAG               54700000
RESTORE  EQU   X'02'               WCC RESTORE KEYBOARD BIT             54800000
SECLINE  EQU   22                  SECOND LINE OF ENTRY AREA            54900000
SPLAT    EQU   C'*'                CHARACTER                            55000000
STOP     EQU   X'20'               STOP CCW CODE                        55100000
STOPPER  EQU   X'64'               NO MORE PFK'S INDICATOR              55200000
VALRNG   EQU   X'3F'               VALID RANGE FOR 64 BYTE TABLE        55300000
WRITCOD  EQU   X'01'               WRITE CCW COMMAND CODE               55400000
ZERO     EQU   C'0'                CHARACTER ZERO                       55500000
ZEROS    EQU   X'00'               HEX ZEROS                            55600000
ZONE     EQU   X'F0'               EBCDIC NUMERIC ZONE                  55700000
         SPACE 5                                                        55800000
         TITLE 'IEECVETV   IGC5V07B    3277 I/O 2     RESIDENT DISPLAY *56000000
               CONTROL MODULE'                                          56100000
         IEERDCM                                                        56200000
         TITLE 'IEECVETV   IGC5V07B        3277 I/O 2        TRANSIENT *56300000
               DISPLAY CONTROL MODULE'                                  56400000
DCMSTRT  DSECT                                                          56500000
         IEECDCM  DEVICE=D                                              56600000
         TITLE 'IEECVETV   IGC5V07B     3277 I/O 2      CXSA'           56700000
         IHACTM  CXSA                                                   56800000
         TITLE 'IEECVETV   IGC5V07B        3277 I/O 2        UNIT CONTR*56900000
               OL MODULE'                                               57000000
         IEECUCM  FORMAT=NEW                                            57100000
         END                                                            57200000
./  ADD  SSI=72780122,NAME=IEECVETW
         TITLE 'IEECVETW -ALIAS IGC5W07B- 3284/6 I/O '                  00050000
IEECVETW CSECT                                                          00100000
* A 077500-077700,366100                                       MB M2523 00120000
* C 155000,310400,421000                                       MB M2523 00160000
* A 164500,164520,165900,166000                               JE YM8416 00220000
* STATUS                                                                00280000
*                                                                       00340000
*    VS2 RELEASE 2                                                      00400000
*                                                                       00430000
*    APARS FIXED ZA00539,ZA08139                                        00500000
*                                                                       00530000
* FUNCTION                                                              00600000
*    THIS IS A DEVICE DEPENDENT ROUTINE TO PERMORM THE REQUESTED I/O IN 00650000
*    PROPER SCREEN FORMAT.                                              00700000
*                                                                       00750000
* ENTRY POINTS                                                          00800000
*         IEECVETW FOR ALL FUNCTIONS                                    00850000
*                                                                       00900000
* OPERATION                                                             00950000
*                                                                       01000000
* INPUT                                                                 01050000
*                                                                       01100000
* OUTPUT                                                                01150000
*    WRITING OF TEXT IN OUTPUT WQES.                                    01200000
*                                                                       01250000
* EXTERNAL REFERENCES                                                   01300000
*         NONE.                                                         01350000
*                                                                       01400000
* EXITS, NORMAL                                                         01450000
*                                                                       01500000
* EXITS, ERROR                                                          01550000
*         NONE.                                                         01600000
*                                                                       01650000
* TABLES/WORK AREAS                                                     01700000
*                                                                       01750000
* ATTRIBUTES                                                            01800000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               01850000
*                                                                       01900000
* CHARACTER CODE DEPENDENCY                                             01950000
*    NONE.                                                              02000000
*                                                                       02050000
* NOTES                                                                 02100000
*    THE FOLLOWING FLAG BITS ARE USED:                                  02150000
*       THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF   02200000
*       OR JUST TESTED BY THIS MODULE.                                  02250000
*                                                                       02300000
*         NAME         ACTION                 FUNCTION                  02350000
         EJECT                                                          02400000
**************REGISTER EQUATES*******************                       02450000
*                                                                       02500000
R0PARM   EQU   0                   GETMAIN-FREEMAIN PARAMETER MB        02550000
R1PARM   EQU   1                   PARAMETER REGISTER                   02600000
R2CXSA   EQU   2                   CXSA BASE REGISTER                   02650000
R3WORK   EQU   3                   WORK REGISTER                        02700000
R3WQE    EQU   3                   WQE POINTER                          02750000
R4CCW    EQU   4                   CCW POINTER                          02800000
R5WQETXT EQU   5                   WQE TEXT POINTER                     02850000
R6WORK   EQU   6                   WORK REGISTER                        02900000
R6LENGTH EQU   6                   LENGTH OF TEXT                       02950000
R7WORK   EQU   7                   WORK REGISTER                        03000000
R7TCB    EQU   7                   TCB POINTER                          03050000
R8RTRN   EQU   8                   RETURN REG FOR SUBROUTINES           03100000
R8WORK   EQU   8                   WORK REGISTER                        03150000
R9DCB    EQU   9                   DCB BASE REGISTER                    03200000
RAUCM    EQU   10                  UCM BASE REGISTER                    03250000
RBUCME   EQU   11                  UCM ENTRY BASE REGISTER              03300000
RCBASE   EQU   12                  PROGRAM BASE REGISTER                03350000
RDMAJOR  EQU   13                  POINTER TO MAJOR WQE                 03400000
RDQUEUE  EQU   13                  OUTPUT QUEUE POINTER                 03450000
RERTRN   EQU   14                  MAIN LINE RETURN REGISTER            03500000
RFWORK   EQU   15                  WORK REGISTER                        03550000
         EJECT                                                          03600000
         ENTRY IGC5W07B            ALIAS NAME FOR IEECVETW              03620000
IGC5W07B EQU   *                   ONLY ENTRY POINT                     03700000
         BALR  RCBASE,0            SET UP BASE REGISTER                 03720000
         USING ETWBASE,RCBASE      AND TELL ASSEMBLER                   03800000
ETWBASE  B     BEGIN               BRANCH AROUND EYECATCHER   MB Y02958 03806000
ICATCH   DC    C'IEECVETW, ALIAS IGC5W07B'                    MB Y02958 03900000
         DC    C'&SYSDATE',CL40' '                            MB Y02958 03940000
BEGIN    LR    R2CXSA,R1PARM       SAVE CXSA POINTER          MB Y02958 03980000
         USING CXSA,R2CXSA                                              04020000
         ST    RERTRN,CSAXA        SAVE RETURN ADDRESS        MB Y02958 04060000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDRESS                 04120000
         BZ    NOESTAE             IF NONE, SKIP SETUP                  04200000
         USING PARMLIST,R6WORK     PARMLIST ADDRESSABILITY              04240000
         LA    R7WORK,ETWRTY       GET ETW'S ADDRESS                    04280000
         C     R7WORK,PARMRTAD     IS OUR RETRY ALREADY IN LIST        *04320000
                                                             JE @YM8452 04360000
         BE    NOESTAE             YES, BYPASS SETUP         JE @YM8452 04400000
         MVC   CSAXB(8),RELEASED   SET UP LOCKING SBRTN      JE @YM8452 04440000
         MVC   CSANAME(8),PARMRTAD SAVE RETRY ADDRESSES                 04480000
         ST    R7WORK,PARMRTAD     SET IT UP                            04520000
         DROP  R6WORK                                                   04560000
NOESTAE  EQU   *                                                        04600000
         L     RBUCME,CSAUCM       POINT TO UCM ENTRY                   04640000
         USING UCMLIST,RBUCME                                           04680000
         L     RAUCM,CSACTLM       SET UCM BASE                         04720000
         USING UCM,RAUCM                                                04760000
         L     R9DCB,UCMDCB        POINT TO DCB (IF PRESENT)            04800000
         USING IHADCB,R9DCB                                   MB Y02958 04840000
         LA    RFWORK,GETLOCK      ADDRESS GETLOCK SUROUTINE  MB Y02958 04880000
         LR    R1PARM,R2CXSA       PASS CXSA                            04920000
         BALR  RERTRN,RFWORK       OBTAIN LOCKS AND INITIALIZE ADCONS   05130000
         SPACE 5                                                        05200000
TESTCLOS TM    UCMSTS,UCMCF        CLOSE REQUEST?                       05240000
         BZ    TESTOPEN             NO, TEST FOR OPEN                   05280000
         TM    UCMSTS,UCMPF        IS OUTPUT PENDING                    05320000
         BNO   CLOSE                NO, GO AHEAD AND CLOSE              05360000
*                                   YES, HANDLE OUTPUT FIRST            05400000
TESTOPEN TM    UCMSTS,UCMTA        OPEN REQUEST?                        05440000
         BO    OPEN                 YES, GO DO IT                       05480000
TESTBUSY EQU   *                                                        05520000
         TM    UCMSTS,UCMBF        IS DEVICE BUSY                       05560000
         BNO   TESTOUT               NO, CHECK FOR OUTPUT               05600000
TESTIO   TM    UCMECB,GOODIO       WAS I/O SUCCESFUL                    05640000
         BZ    EXIT                NOT EVEN COMPLETE YET                05680000
         BNO   SWITCHEX            NO, SWITCH CONSOLES                  05720000
ENDIO    XC    UCMECB,UCMECB       YES, CLEAR ECB                       05760000
         NI    UCMSTS,X'FF'-UCMBF  TURN OFF BUSY FLAG                   05800000
         SPACE 5                                                        05840000
PMFWQE   EQU   *                                                        05880000
         L     RDQUEUE,UCMWLAST    GET POINTER TO LAST OUTPUT           05920000
*                                       QUEUE ENTRY SERVICED            05960000
         USING CQE,RDQUEUE         BASE FOR CONSOLE Q ENTRY   MB Y02958 06000000
         LTR   RDQUEUE,RDQUEUE     HAS K C,D,ID ALLOWED                 06040000
*                                  A PURGE TO BE DONE                   06080000
         BZ    PMFWQEND            YES, RESTORE FOR WTO                 06120000
         TM    CQEFLAG,CQEMAJOR    MLWTO                      MB Y02958 06160000
         BNO   PMFWQEN1            NO                                   06200000
         TM    UCMSTS,UCMTC        HAS THIS MLWTO BEEN CANCELLED        06240000
         BNO   PMF1                YES, REDUCE USE COUNT                06280000
         USING WQE,R3WQE                                                06320000
         L     R3WQE,CQEWQE        GET BUFFER POINTER         MB Y02958 06360000
         LA    R3WQE,0(R3WQE)      BUFFER POINTED TO BY R3WQE IS        06400000
*                        THE MAJOR WHICH MAY OR MAY NOT HAVE JUST       06440000
*                        BEEN WRITTEN.                                  06480000
*                        UCMMLAST POINTS TO THE MINOR HALF              06520000
*                        CONTAINING THE LINE JUST WRITTEN, IF           06560000
*                        ADDRESS EXISTS.                                06600000
         NC    UCMMLAST(N4),UCMMLAST   MINOR JUST WRITTEN               06640000
         BNZ   PMF1                      YES                            06680000
PMF0     EQU   *                                                        06720000
         TM    WMJMLTYP,WMJMLTYD   END INDICATOR IN MAJOR               06760000
         BO    PMFWQEND            YES, PURGE                           06800000
         TM    WMJMMLW,WMJMMLWH    ANY MINORS EXIST                     06840000
         BO    MRETURN             NO, RETURN                           06880000
         NI    CQEFLAG,X'FF'-CQEATTOP TURN OFF FLAG           MB Y02958 06920000
         MVC   UCMMLAST(N4),WMJMMIN   NEXT LINE TO BE WRITTEN           06960000
         B     PMLW3               WRITE LINE                           07000000
PMF1     EQU   *                                                        07040000
         L     R3WQE,UCMMLAST      PT TO HALF WITH WRITTEN LN           07080000
         SR    R6WORK,R6WORK       CLEAR REGISTER                       07120000
         IC    R6WORK,WMNMUC1      GET USE COUNT                        07160000
         BCTR  R6WORK,0            REDUCE BY ONE                        07200000
         STC   R6WORK,WMNMUC1      STORE COUNT                          07240000
         TM    UCMSTS,UCMTC        MLWTO CANCELLED                      07280000
         BNO   PMFWQEND            YES, PURGE                           07320000
         LTR   R6WORK,R6WORK       IS COUNT ZERO                        07360000
         BNZ   PMF2                 NO                                  07400000
         L     RFWORK,0(RDQUEUE)   POINT TO MAJOR                       07440000
         OI    N4(RFWORK),WMJMMLWG TELL DEQ TO CHECK THIS CHAIN         07480000
         OI    UCMSTS,UCMTB        TELL DEQ TO CHECK MY QUEUE           07520000
PMF2     EQU   *                                                        07560000
         TM    WMNMLT1,WMNMLT1D    END INDICATOR IN THIS LINE           07600000
         BO    PMFWQEND            YES, PURGE                           07640000
PMF3     EQU   *                                                        07680000
         L     R3WQE,WMNMNX1-1     BASE FOR NEXT MINOR        MB  M2184 07720000
         LA    R3WQE,0(R3WQE)      IGNORE USE COUNT           MB  M2523 07760000
         LTR   R3WQE,R3WQE         NEXT LINE EXIST            MB  M2184 07800000
         BZ    MRETURN             NO, RETURN                 MB  M2184 07840000
         NC    WMNMLT1,WMNMLT1     THIS MINOR BUILT YET       MB  M2184 07880000
         BZ    MRETURN             NO,RETURN                  MB  M2184 07920000
         ST    R3WQE,UCMMLAST      NEXT LINE TO WRITE         MB  M2184 08650000
         B     PMLW3               WRITE LINE                           08700000
PMF4     EQU   *                                                        08740000
         L     R3WQE,UCMMLAST      ADDRESS LAST MINOR                   08780000
         LTR   R3WQE,R3WQE         WAS LAST WRITE A MAJOR               08820000
         BNZ   PMF3                NO GET NEXT LINE POINTER             08860000
PMF5     EQU   *                                                        08900000
         L     RDQUEUE,UCMWLAST    POINT TO ENTRY                       08940000
PMF6     EQU   *                                                        08980000
         L     R3WQE,CQEWQE        GET MAJOR POINTER          MB Y02958 09020000
         LA    R3WQE,0(R3WQE)      CLEAR OUT FLAGS                      09060000
         B     PMF0                WORK WITH MAJOR                      09100000
MRETURN  EQU   *                                                        09140000
         OI    UCMSDS5,UCMSDS5A    WAITING FOR MORE LINES               09180000
         NI    UCMSTS,X'FF'-UCMPF  LOCK OUT OTHER OUTPUT                09220000
         B     EXIT                RETURN TO MCS                        09260000
COMEBACK EQU   *                                                        09300000
         NI    UCMSDS5,X'FF'-UCMSDS5A   NO LONGER WAITING               09340000
         L     RDQUEUE,UCMWLAST    POINT TO MAJOR ENTRY                 09380000
         TM    CQEFLAG,CQEATTOP    START AT TOP OF CHAIN      MB Y02958 09420000
         BNO   PMF4                NO, PROCEED NORMALLY                 09460000
         NI    CQEFLAG,X'FF'-CQEATTOP TURN OFF START-AT-TOP             09500000
         B     PMF6                START AT TOP                         09540000
HCOPY    EQU   *        TEST FOR HARDCOPYING PURGED MESSAGES  MB Y02958 09580000
         TM    CQEFLAG,CQEMLQHC    QUEUED FOR HARDCOPY        MB Y02958 09620000
         BNO   PMFWQEND            NO, TREAT AS IO COMPLETE   MB Y02958 09660000
         TM    WQEXA,WQEQFHC       ISSUES FOR HARDCOPY        MB Y02958 09700000
         BNO   PMFWQEND            NO, TREAT AS IO COMPLETE   MB Y02958 09740000
         TM    WQEAVAIL,WQEBUFC    ALREADY GONE OUT           MB Y02958 09780000
         BO    FOUNDML             YES, TEST FOR MLWTO        MB Y02958 09820000
PMFWQEND EQU   *                                                        09860000
         NI    UCMSTS,X'FF'-UCMTC  NO LONGER WORKING                    09900000
PMFWQEN1 EQU   *                                                        09940000
         OI    CQEFLAG,CQEAVAIL    FLAG AS NO LONGER NEEDED   MB Y02958 09980000
         NI    CQEFLAG,X'FF'-CQEENTR AND NOT A VALID ENTRY    MB Y02958 10020000
         OI    UCMSTS,UCMTB        INDICATE DEQUEUE NEEDED              10060000
TESTOUT  TM    UCMSTS,UCMPF        IS OUTPUT PENDING                    10420000
         BZ    EXIT                NO, RETURN TO MCS                    10500000
NXTLINE  TM    UCMSTS,UCMTC        IS MLWTO IN PROGRESS                 10520000
         BO    COMEBACK                                                 10600000
         SPACE 5                                                        10650000
PMOUTPUT EQU   *                                                        10700000
         L     RDQUEUE,UCMWLAST    GET PTR TO LAST WQE PTR              10750000
         LTR   RDQUEUE,RDQUEUE     IS THERE ANY                         10800000
         BNE   TESTLAST                 YES GO TEST IT                  10850000
         L     RDQUEUE,UCMOUTQ     TRY THE OUTPUT QUEUE PTR             10900000
TEST0    LTR   RDQUEUE,RDQUEUE     IS ANYTHING THERE                    10950000
         BZ    ENDOFQ               NO, NO MORE QUEUE                   11000000
TESTLAST TM    CQEFLAG,CQEENTR     IS THIS A VALID ENTRY      MB Y02958 11050000
         BO    FOUND                   YES                              11100000
         TM    CQEFLAG,CQEEOB      IS THIS LINK OR END OF QUEUE  Y02958 11150000
         BO    LINK                    LINK                             11200000
         BM    ENDOFQ                  END OF Q                         11250000
         LA    RDQUEUE,N4(RDQUEUE) LOOK AT NEXT ENTRY                   11300000
         B     TESTLAST            CHECK FOR LAST ENTRY                 11350000
ENDOFQ   EQU   *                                                        11400000
         NI    UCMSTS,X'FF'-UCMPF  TURN OFF OUTPUT FLAG                 11440000
         B     TESTCLOS            RETURN CHECKING FOR CLOSE            11480000
LINK     L     RDQUEUE,CQEWQE      GET PTR TO NEXT BLOCK      MB Y02958 11520000
         B     TESTLAST            TEST NEXT WQE POINTER                11560000
FOUND    EQU   *                                                        11600000
         LA    RDQUEUE,0(RDQUEUE)  ZERO HIGH ORDER BYTE                 11640000
         ST    RDQUEUE,UCMWLAST    UPDATE LAST POINTER                  11680000
         L     R3WQE,CQEWQE        GET WQE POINTER            MB Y02958 11720000
         TM    WQEXA,WQEPURGE      IS THIS WQE PURGED                   11830000
         BO    HCOPY               YES, CHECK FOR HARDCOPY    MB Y02958 11900000
         OI    WQEAVAIL,WQEBUFC    READY FOR HARDCOPY         MB Y02958 11950000
FOUNDML  EQU   *                   CHECK FOR MLWTO            MB Y02958 12000000
         TM    CQEFLAG,CQEMAJOR    MLWTO                      MB Y02958 12050000
         BNO   NOTMLW              NO, ADJUST LENGTH          MB Y02958 12100000
         OI    UCMSTS,UCMTC        NOW WORKING ON MLWTO                 12150000
         XC    UCMMLAST(N4),UCMMLAST   ZERO MINOR PTR                   12200000
NOTMLW   EQU   *                                                        12250000
         LH    R6LENGTH,WMJMTXTL   TEXT LENGTH IN WQE         MB Y02958 12300000
         LA    R6LENGTH,WQETXT(R6LENGTH) END OF TEXT TO WRITE MB Y02958 12350000
         LA    R5WQETXT,WQERR      LOCATE HARDCOPY TEXT       MB Y02958 12400000
         TM    CQEFLAG,CQEMLQHC    HARDCOPY FORMAT            MB Y02958 12440000
         BO    FOUND1              SET UP CCW                 MB Y02958 12480000
         LA    R5WQETXT,WQETXT     LOCATE NORMAL TEXT         MB Y02958 12520000
         TM    UCMDISP2,UCMDISPI+UCMDISPJ TEXT MODIFIED       MB Y02958 12560000
         BZ    FOUND1              NO, SET UP CCW             MB Y02958 12600000
         LA    R5WQETXT,WQETS      LOCATE TIME STAMP          MB Y02958 12640000
         TM    UCMDISP2,UCMDISPI   WRITE FROM TIME STAMP      MB Y02958 12740000
         BO    FOUND1              YES, SET UP CCW            MB Y02958 12780000
         LA    R5WQETXT,WQEJOBNM   LOCATE JOBNAME             MB Y02958 12820000
FOUND1   ST    R5WQETXT,DMCWRITE   POINT CCW TO TEXT          MB Y02958 12900000
         SR    R6LENGTH,R5WQETXT   GET LENGTH TO WRITE        MB Y02958 12940000
         STH   R6LENGTH,DMCWNBR    INSERT BYTE COUNT                    12980000
         SR    R7WORK,R7WORK       STORE ZEROS                          13020000
         ST    R7WORK,UCMECB       INTO THE ECB                         13100000
         OI    UCMSTS,UCMBF        INDICATE CONSOLE BUSY                13140000
         L     RFWORK,CSAXC        ADDRESS FREELOCK SUBROUTNE MB Y02958 13180000
         LR    R1PARM,R2CXSA       PASS CXSA ADDRESS          MB Y02958 13220000
         BALR  RERTRN,RFWORK       RELEASE LOCKS FOR EXCP     MB Y02958 13300000
         EXCP  DMIOB               GET THE IO STARTED         MB Y02958 13340000
         L     RERTRN,CSAXA                                   MB Y02958 13380000
         BR    RERTRN              DONE FOR NOW                         13420000
         SPACE 5                                                        13460000
PMLW3    EQU   *                                                        13530000
         L     RDQUEUE,UCMWLAST    GET LIST POINTER                     13600000
         L     R3WQE,UCMMLAST      MINOR HALF TO BE WRITTEN             13650000
         SR    R6LENGTH,R6LENGTH   CLEAR LENGTH REG                     13700000
         IC    R6LENGTH,WMNMTL1    GET TEXT LENGTH                      13750000
         LTR   R6LENGTH,R6LENGTH   ZERO LENGTH, NULL LINE               13800000
         BZ    PMFWQE              YES, HANDLE AS I/O COMPLETE          13850000
         LA    R5WQETXT,WMNMTXT1   POINT TO REGULAR TEXT                13900000
         AR    R6LENGTH,R5WQETXT   END OF TEXT TO WRITE       MB Y02958 13950000
         TM    CQEFLAG,CQEMLQHC    HARDCOPY CONSOLE MESSAGE   MB Y02958 14000000
         BNO   FOUND1              NO, WRITE LINE             MB Y02958 14050000
         LA    R5WQETXT,WMNMHCT1   POINT TO TEXT                        14100000
         B     FOUND1              WRITE LINE                           14150000
OPEN     EQU   *                                                        14200000
         L     R6WORK,UCMUCB       GET UCB ADDRESS                      14250000
         USING UCBOB,R6WORK                                             14300000
         TM    UCBSTAT,UCBALOC     IS DEVICE IN ALLOCATION              14350000
         BO    EXIT                YES RETURN                           14400000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDRESS                 14440000
         BZ    OPNO                IF NONE, SKIP SETUP                  14480000
         USING PARMLIST,R6WORK     PARMLIST ADDRESSABILITY              14520000
         OI    PARMFTPT,UCMTA      INDICATE OPENING                     14560000
         DROP  R6WORK                                                   14600000
OPNO     EQU   *                                                        14660000
         L     RFWORK,CSAXC      ADDRESS FREELOCK SUBROUTINE            14720000
         LR    R1PARM,R2CXSA     CXSA ADDRESS IN REG 1                  14800000
         BALR  RERTRN,RFWORK     RELEASE LOCKS FOR SVC'S                14820000
       GETMAIN R,SP=255,LV=DMCORE                                       14860000
         LR    R9DCB,R1PARM                                             14910000
         ST    R9DCB,UCMDCB        STORE DCB ADDRESS IN UCM             14960000
         USING IHADCB,R9DCB                                             15010000
         MVC   IHADCB(DMCORE),DMDCB                                     15060000
*                                      RELOCATE POINTERS.               15110000
         MVI   DMCREAD,0            *** GRAPHICS BYTE                   15160000
         EJECT                                                          15210000
         GETMAIN R,SP=255,LV=PNCORE                                     15260000
         LR    R8WORK,R1PARM       BASE OPEN BLOCKS.                    15310000
         USING PNOPEND,R8WORK                                           15360000
         XC    PNOPEND(PNCORE),PNOPEND                                  15410000
         SR    R1PARM,R1PARM       CLEAR FOR IC INSTRUCTION             15460000
         IC    R1PARM,UCMID        GET CONSOLE I.D. IN BINARY           15510000
         CVD   R1PARM,PNWORKD      CONVERT TO PACKED DECIMAL            15560000
         UNPK  PNWORKD(N5),PNWORKH4(N3)                                 15610000
         MVC   DCBDDNAM(L'BASENAM),BASENAM CONSTANT PART OF DDNAME      15660000
         MVC   DCBDDNAM+L'BASENAM(N3),PNWORKD REST OF NAME              15710000
         MVC   JFCBDSNM(L'PNDSN),PNDSN                                  15760000
         MVC   JFCBDSNM+8(36),JFCBDSNM+7                                15810000
         OI    JFCBTSDM,JFCTTR+JFCNWRIT+JFCNDSCB+JFCNDCB+JFCPAT         15900000
         LA    R7WORK,JFCB                                              15940000
         STCM  R7WORK,M7,PNXLST+N1                                      15980000
         OI    PNXLST,LASTNTRY+EXITJFCB                                 16020000
         LA    R7WORK,PNXLST                                            16060000
         STCM  R7WORK,M7,DCBEXLST+N1                                    16150000
         EJECT                                                          16200000
         OPEN  ((R9DCB),INOUT),TYPE=J,MF=(E,PNJEF)                      16250000
         LR    R1PARM,R8WORK       OPEN BLOCKS PTR.                     16300000
         FREEMAIN R,SP=255,LV=PNCORE,A=(1)                              16320000
         DROP  R8WORK                                                   16400000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDRESS                 16450000
         BZ    OPENRCVR            IF NONE, SKIP SETUP                  16500000
         USING PARMLIST,R6WORK     PARMLIST ADDRESSABILITY              16550000
         NI    PARMFTPT,N255-UCMTA      INDICATE OPENED                 16570000
         DROP  R6WORK                                                   16608000
OPENRCVR EQU   *                                                        16700000
         XC    DCBEXLST+N1(N3),DCBEXLST+N1                              16750000
         L     RFWORK,CSAXB      ADDRESS GETLOCK SUBROUTINE             16800000
         LR    R1PARM,R2CXSA       PASS CXSA ADDRESS IN REG 1           16850000
         BALR  RERTRN,RFWORK       OBTAIN LOCKS TO RESET UCM            16900000
         L     R6WORK,UCMUCB       POINT TO UCB                         16950000
         USING UCBOB,R6WORK                                             17000000
         L     R6WORK,UCBEXTPT     BASE UCB EXTENSION                   17050000
         USING UCBCMEXT,R6WORK                                          17100000
         MVC   DMXATI(N1),UCBATI   SAVE ATTN INDEX                      17150000
         MVI   UCBATI,0            ZERO ATTENTION INDEX FOR PRINTER     17200000
         MVI   DCBIFLGS,0          USE STD ERP                          17250000
         OI    UCMATR,UCMUF        TURN ON ACTIVE BIT                   17300000
         NI    UCMSTS,N255-UCMTA   TURN OFF OPEN PENDING                17330000
         LA    R3WORK,DMIOB        PUT IOB POINTER                      17400000
         ST    R3WORK,DCBIOBAD     IN DCB                               17450000
         LA    R3WORK,UCMECB       PUT ECB POINTER                      17500000
         ST    R3WORK,DMIECBP      IN IOB                               17550000
         LA    R3WORK,DMCTRA       PUT CCW AREA POINTER                 17600000
         ST    R3WORK,DMICPA       IN IOB                               17650000
         ST    R9DCB,DMIDCB        PUT DCB POINTER IN IOB               17700000
         MVI   DMXEM,EMCHAR        END-OF-MESSAGE CHARACTER             17750000
         MVI   DMXWCC,WCCHAR       WRITE-CONTROL CHARACTER              17800000
         MVC   DMCTRA(N8),MODELCCW INITIALIZE THE ENTIRE                17850000
         MVC   DMCWRITE(N16),DMCTRA CCW AREA                            17900000
         LA    R3WORK,DMXWCC       LOCATE WRITE CONTROL CHAR            17950000
         STCM  R3WORK,M7,DMCTRA+N1 WRITE-CTL-CHAR CCW BUILT             18000000
         LA    R3WORK,DMXEM        ADDRESS END OF MSG CHAR              18050000
         STCM  R3WORK,M7,DMCNOP+N1 IN LAST CCW                          18100000
         MVI   DMCNOP+N4,0         KILL CHAINING                        18150000
         TM    DCBOFLGS,DCBOFOPN   OPEN SUCCESSFULL                     18200000
         BNO   SWITCHEX            NO,CALL CONSOLE SWITCH               18250000
         B     TESTBUSY            SEE IF OUTPUT IS READY               18300000
         SPACE 5                                                        18350000
CLOSE    EQU   *                                                        18400000
         LTR   R9DCB,R9DCB         IS A DCB PRESENT                     18450000
         BZ    ENDCLS              NO, EXIT                             18500000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDRESS                 18550000
         BZ    CLSNO               IF NONE, SKIP SETUP                  18600000
         USING PARMLIST,R6WORK     PARMLIST ADDRESSABILITY              18650000
         OI    PARMFTPT,UCMCF      INDICATE CLOSING                     18700000
         DROP  R6WORK                                                   18750000
CLSNO    EQU   *                                                        18800000
         L     R6WORK,UCMUCB       GET UCB ADDRESS                      18850000
         USING UCBOB,R6WORK                                             18900000
         L     R6WORK,UCBEXTPT            BASE UCB EXTENSION            18940000
         USING UCBCMEXT,R6WORK                                          18980000
         MVC   UCBATI,DMXATI  RESTORE ATTENTION TABLE INDEX             19020000
         DROP  R6WORK                                                   19060000
         MVI   DMX4,DMX4C          INDICATE END OF REMOTE PARMLIST      19100000
         L     RFWORK,CSAXC        ADDRESS FREELOCK SUBROUTINE          19140000
         LR    R1PARM,R2CXSA       CXSA ADDRESS IN REG 1                19180000
         BALR  RERTRN,RFWORK       RELEASE LOCKS FOR SVC'S              19220000
         LA    R1PARM,DMX4                                              19260000
         CLOSE   ((R9DCB)),MF=(E,(1))                                   19300000
         LR    R1PARM,R9DCB                                             19340000
         FREEMAIN R,SP=255,LV=DMCORE,A=(1)                              19380000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDR          JE YM6718 19550000
         BZ    ENDCLS              NOT TEHER, BYPASS          JE YM6718 19580000
         NI    PARMFTPT-PARMLIST,XFF-UCMCF TURN OFF CLOSE PENDJE YM6718 19650000
ENDCLS   EQU   *                                                        19700000
         L     RFWORK,CSAXB      ADDRESS GETLOCK SUBROUTINE             19720000
         LR    R1PARM,R2CXSA       PASS CXSA ADDRESS IN REG 1           19800000
         BALR  RERTRN,RFWORK     OBTAIN LOCKS TO RESET UCM              19850000
         XC    UCMECB,UCMECB           CLEAR ECB.                       19900000
         XC    UCMDCB,UCMDCB           CLEAR DCB PTR.                   19920000
         NI    UCMSTS,N255-UCMBF-UCMCF  NOT BUSY, CLOSED                20000000
         L     RERTRN,CSAXA            RESTORE RETURN REG.              20030000
         L     R6WORK,UCMUCB           GET TO ASSOCIATED UCB            20100000
         USING UCBOB,R6WORK                                             20150000
         LR    R3WORK,R2CXSA       SAVE CSA PTR SINCE NIL MACRO        *20200000
                                   CLOBBERS GPR 2             JE YM8416 20250000
         TM    UCBSTAT,UCBCHGS                                          20300000
         BZ    DEVSTAT                                                  20350000
*                                                                       20400000
*  WARNING --- NIL MACRO CLOBBERS GPRS 0, 1, 2                JE YM8416 20450000
*                                                                       20500000
         NIL   UCBSTAT,N255-UCBONLI-UCBCHGS-UCBALOC-UCBSYSR-UCBDADI,REF*20550000
               =UCBOB                                                   20600000
         B     CONTINUE                                                 20650000
DEVSTAT  NIL   UCBSTAT,N255-UCBALOC-UCBSYSR-UCBDADI,REF=UCBOB           20700000
CONTINUE NI    UCMATR,N255-UCMAT04-UCMUF                                20750000
         LR    R2CXSA,R3WORK       RESTORE CSA PTR SINCE NIL MACRO     *20800000
                                   CLOBBERS GPR 2             JE YM8416 20850000
EXIT     EQU   *                                                        20900000
         L     RERTRN,CSAXA        RESTORE RETURN ADDRESS               20950000
         LR    R1PARM,R2CXSA       CXSA ADDRESS IN REG 1                21000000
         L     RFWORK,CSAXC        ADDRESS FREELOCK ROUTINE             21050000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDR          JE YM6718 21100000
         BZ    EXIT1               NOT TEHER                  JE YM6718 21150000
         USING PARMLIST,R6WORK                                          21200000
         MVC   PARMRTAD(8),CSANAME RESTORE FIELD              JE YM6718 21250000
EXIT1    MVC   CSANAME(8),UCMNAME  MODULE NAME                JE YM6718 21300000
         BR    RFWORK              RELEASE LOCKS AND EXIT               21350000
SWITCHEX EQU   *                                                        21400000
         MVI   CSACODE,0           INDICATE CONSOLE SWITCH              21450000
OPENSWCH EQU   *         CALL TO SWITCH AFTER OPEN                      21500000
         LR    R1PARM,R2CXSA       PASS CXSA IN REG 1                   21550000
         L     RFWORK,CSAXC        ADDRESS FREELOCK SUBROUTINE          21600000
         BALR  RERTRN,RFWORK       RELEASE LOCKS                        21650000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDR          JE YM6718 21700000
         BZ    SWCHNO              NOT THERE                  JE YM6718 21750000
         MVC   PARMRTAD(8),CSANAME RESTORE FILED              JE YM6718 21800000
SWCHNO   MVC   CSANAME(8),UCMNAME  MODULE NAME                JE YM6718 21850000
         MVC   CSANAME+N3(N2),PMXTRNL ADJUST NAME IN CXSA               21900000
         L     RERTRN,CSAXA        RESTORE RETURN ADDRESS               21950000
         L     RFWORK,UCMSWCH      SWITCH ENTRY POINT                   22000000
         BR    RFWORK              CALL CONSOLE SWITCH                  22050000
         EJECT                                                          22100000
*                                                                       22150000
*        IEECVETW ESTAE RECOVERY ROUTINE                                22200000
*                                                                       22250000
ETWRTY   DS    0D                                                       22300000
         BALR  RFWORK,0            SET BASE                   JE YM6718 22350000
         USING *,RFWORK                                       JE YM6718 22400000
         L     RCBASE,ETWAD        GET REAL BASE              JE YM6718 22450000
         USING ETWBASE,RCBASE      TELL ASSEMBLER             JE YM6718 22500000
         DROP  RFWORK                                                   22550000
         USING PSA,0               ADDRESS LOW CORE           JE YM6718 22600000
         L     RFWORK,PSATOLD      GET TCB ADDRESS            JE YM6718 22650000
         DROP  0                                                        22700000
         USING TCB,RFWORK                                     JE YM6718 22750000
         L     RFWORK,TCBRBP       MY SVRB ADDR               JE YM6718 22800000
         USING RBSECT,RFWORK                                            22850000
         LA    R2CXSA,RBEXSAVE     RESOTRE CXSA ADDR        JE @ZA00539 22900000
         DROP  RFWORK                                                   22950000
         L     RBUCME,CSAUCM       RESTORE UCME ADDR          JE YM6718 23000000
         L     RAUCM,CSACTLM       RESTORE UCM BASE           JE YM6718 23050000
         L     R9DCB,UCMDCB        RESTORE DCB BASE           JE YM6718 23100000
         ICM   R6WORK,MF,CSANPTR   GET PARMLIST ADDR          JE YM6718 23150000
         BZ    SWITCHEX            NOT THER GET OUT           JE YM6718 23200000
         USING PARMLIST,R6WORK                                          23250000
*                                                                       23300000
         TM    PARMFTPT,UCMTA      OPEN PENDING               JE YM6718 23350000
         BNO   TRYCLOSE            NO, TEST CLOSE             JE YM6718 23400000
         MVI   PARMFTPT,0          CLEAR FOOTPRINTS           JE YM6718 23450000
         LTR   R9DCB,R9DCB         ANY DCB THERE              JE YM6718 23500000
         BZ    SWITCHEX            NO, SWITCH CONSOLES        JE YM6718 23550000
         B     OPENRCVR            YES, CONTINUE OPEN         JE YM6718 23600000
*                                                                       23650000
TRYCLOSE TM    PARMFTPT,UCMTC      CLOSE PENDING              JE YM6718 23700000
         BNO   TRYBUSY             NO, TEST FOR EXCP          JE YM6718 23750000
         MVI   PARMFTPT,0          CLEAR FOOTPRINTS           JE YM6718 23800000
         B     ENDCLS              GO CLEANUP CLOSE           JE YM6718 23850000
*                                                                       23900000
TRYBUSY  TM    UCMSTS,UCMBF       EXCP IN PROCESS             JE YM6718 23950000
         BNO   SWITCH              NO, SWITCH CONSOLES         @ZA08139 24000000
         NI    UCMSTS,XFF-UCMBF    TURN OFF BUSY              JE YM6718 24050000
         NI    UCMDEVC,XFF-UCMDEVE TURN OFF I/O COMPLETE     JE @YM8452 24100000
SWITCH   B     SWITCHEX            SWITCH CONSOLES             @ZA08139 24150000
*                                                                       24200000
*********************************************************************** 24250000
*                                                                       24300000
*      FIVE LINES OF CODE DELETED HERE TO FORCE IEECVETW TO    @ZA08139 24350000
*      SWITCH CONSOLES AFTER ANY ERROR CONDITION THAT          @ZA08139 24400000
*      PREVIOUSLY CAUSED RETURN TO IEAVVCTR WITHOUT CLEANING   @ZA08139 24420000
*      UP THE ERROR CONDITION.                                          24500000
*********************************************************************** 24550000
         EJECT                                                          24600000
*                                                                       24650000
*        OBTAIN LOCKS SUBROUTINE                                        24700000
*                                                                       24750000
GETLOCK  EQU   *                                                        24800000
         USING *,RFWORK          SUBROUTINE ADDRESSABILITY BASED ON     24850000
*                                  ENTRY REGISTER                       24860000
         DROP  R2CXSA              DROP OLD CXSA BASE                   25360000
         USING CXSA,R1PARM         REG 1 ADDRESSES THE CXSA AS          25860000
*                                  AN INPUT PARAMETER                   26360000
         STM   11,14,CSAXB         SAVE REGS OVER SETLOCK CALL          26860000
GETLOCL  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *27360000
               RELATED=(WQE,IEECVETW(FREELOCL))                         27860000
GETCMS   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          *28360000
               RELATED=(UCM,IEECVETW(FREECMS))                          28860000
         L     RAUCM,CSACTLM       GET UCM                    JE YM6718 29360000
         L     11,UCMFRRAD         GET FRR ADDR               JE YM6718 29860000
         USING PSA,0                                                    30360000
GETFRR   SETFRR A,FRRAD=(11),PARMAD=(13),WRKREGS=(12,13),              *30860000
               RELATED=(CMSLOCK,IEECVETW(FREEFRR))            JE YM6718 31360000
         ST    13,CSADCBP                                     JE YM6718 31860000
         USING PARMLIST,13                                              32360000
         ICM   12,15,CSANPTR       GET ESTAE PARMLIST PTR    JE @YM8452 32860000
         BZ    FRRA                NOT THERE                 JE @YM8452 33360000
         MVC   PARMLIST(PARMSIZE),0(12) COPY ESTAE PARMLIST TO         *33860000
                                   FRR PARMLIST              JE @YM8452 34360000
FRRA     MVC   PARMID,SVC72ID                                 JE YM6718 34860000
         LM    11,14,CSAXB         RESTORE REGS AFTER SETLOCK           35360000
GETEXIT  MVC   CSAXB(N8),OBTAINED  RESET SUBROUTINE ADDRESSES           35860000
         LR    RFWORK,RERTRN     COPY EXIT ADDRESS                      36360000
         BR    RERTRN              EXIT FROM GETLOCK SUBROUTINE         36860000
         SPACE 5                                                        37360000
*                                                                       37860000
*        RELEASE LOCKS SUBROUTINE                                       38360000
*                                                                       38860000
FREELOCK EQU   *                                                        39360000
         USING *,RFWORK          SUBROUTINE ADDRESSABILITY BASED ON     39860000
*                                  ENTRY REGISTER                       40360000
         USING CXSA,R1PARM         REG 1 ADDRESSES THE CXSA AS          40860000
*                                  AN INPUT PARAMETER                   41360000
         STM   11,14,CSAXB         SAVE REGS OVER SETLOCK CALL          41860000
FREEFRR  SETFRR D,WRKREGS=(12,13),RELATED=(CMSLOCK,IEECVETW(GETFRR))    42360000
*                                                             JE YM6718 42860000
         XC    CSADCBP,CSADCBP     CLEAR                      JE YM6718 43360000
FREECMS  SETLOCK RELEASE,TYPE=CMS,                                     *43860000
               RELATED=(UCM,IEECVETW(GETCMS))                           44360000
FREELOCL SETLOCK RELEASE,TYPE=LOCAL,                                   *44860000
               RELATED=(WQE,IEECVETW(GETLOCL))                          45360000
         LM    11,14,CSAXB         RESTORE REGS AFTER SETLOCK           45860000
FREEXIT  MVC   CSAXB(N8),RELEASED  RESET SUBROUTINE ADDRESSES           46360000
NOOPLOCK LR    RFWORK,RERTRN     COPY EXIT ADDRESS                      46860000
         BR    RERTRN              EXIT FROM FREELOCK SUBROUTINE        47360000
         SPACE 5                                                        47860000
*                                                                       48360000
*   CONSTANTS                                                           48860000
*                                                                       49360000
RELEASED DC    A(GETLOCK)                                               49860000
OBTAINED DC    A(NOOPLOCK)                                              50360000
         DC    A(FREELOCK)                                              50860000
         EJECT                                                          51360000
**************** CONSTANTS *******************                          51860000
MODELCCW CCW   ERWRIT,0,CHAINDT,N1                                      52360000
BASENAM  DC    C'IEAVM'            CONSTANT PART OF CONSOLE DDNAME      52860000
PMXTRNL  DC    CL2'04'             EXTERNAL PROCESSOR NAME.             53360000
PNDSN    DC    C'CONSOLE '         DSNAME FOR JFCB                      53860000
SVC72ID  DC    CL4'VCTR'        SVC 72 ID                     JE YM6718 54360000
ETWAD    DC    A(ETWBASE)                                               54860000
         EJECT                                                          55360000
**************** EQUATES *********************                          55860000
EMCHAR   EQU   X'19'               END-OF-MESSAGE CHARACTER             56360000
WCCHAR   EQU   X'C8'               WRITE-CONTROL CHARACTER              56860000
CHAINDT  EQU   X'80'               CHAIN DATA FLAG                      57360000
COUNT    EQU   7                   DISP TO COUNT FIELD IN CCW           57860000
ERWRIT   EQU   X'05'               ERASE-WRITE CCW CODE                 58360000
FLAGS    EQU   4                   DISP TO FLAG FIELD IN CCW            58860000
FOURMULT EQU   2                   MULTIPLY BY FOUR                     59360000
GOODIO   EQU   X'7F'               POST CODE FROM IOS                   59860000
IOCOMP   EQU   X'40'               POST CODE FROM IOS                   60360000
NEXT     EQU   16                  DISP TO NEXT VARIABLE CCW            60860000
NOTHING  EQU   X'00'               NULL                                 61360000
N1       EQU   1                   NUMBER                               61860000
N2       EQU   2                   NUMBER                               62360000
N3       EQU   3                   NUMBER                               62860000
N4       EQU   4                   NUMBER                               63360000
N5       EQU   5                   NUMBER                               63860000
N8       EQU   8                   NUMBER                               64360000
N11      EQU   11                  NUMBER                               64860000
N12      EQU   12                  NUMBER                               65360000
N16      EQU   16                  NUMBER                               65860000
N20      EQU   20                  NUMBER                               66360000
N24      EQU   24                  NUMBER                               66860000
N120     EQU   120                 NUMBER                               67360000
N128     EQU   128                 NUMBER                               67860000
N255     EQU   255                                                      68360000
M7       EQU   7                   STORE CHARACTER MASK       MB Y02958 68860000
MF       EQU   15                  INSERT CHARACTER MASK                69360000
XFF      EQU   X'FF'                                                    69860000
         TITLE 'IEECVETW     DATA CONTROL BLOCKS'                       70360000
         IEEUCDX                                                        70860000
DMXATI   EQU   DMX+1               FOR SAVING UCBATI                    71360000
DMXEM    EQU   DMX+2               END OF MESSAGE CHARACTER             71860000
DMXWCC   EQU   DMX+3               WRITE CONTROL CHARACTER              72360000
         TITLE 'IEECVETW                   OPEN-JFCB'                   72860000
*                       DEFINITION OF DYNAMIC CORE FOR CONSOLE OPEN,    73360000
PNOPEND  DSECT                                                          73860000
JFCB     DS    0D                                                       74360000
         IEFJFCBN ,                                                     74860000
*                            OPENJ E-FORM SLOT.                         75360000
PNJEF    DC    X'80'              LAST ENTRY.                           75860000
         DC    AL3(0)             DCB PTR.                              76360000
         SPACE                                                          76860000
*                            OPENJ JFCB EXLST PTR.                      77360000
LASTNTRY EQU   X'80'               LAST ENTRY                           77860000
EXITJFCB EQU   X'07'               JFCB CODE                            78360000
PNXLST   DC    X'87'              LAST ENTRY AND JFCB 07 CODE.          78860000
         DC    AL3(0)                   JFCB PTR. DCBEXLST PTS HERE.    79360000
PNWORKD  DC    D'0'                DOUBLE WORD FOR CVD                  79860000
         ORG   PNWORKD+6                                                80360000
PNWORKH4 DC    H'0'                LAST HALFWORD                        80860000
PNWORKX  DC    X'0'                EXTRA BYTE FOR UNPK                  81360000
PNCORE   EQU   *-PNOPEND            DYNAMIC CORE REQIREMENT.            81860000
         TITLE 'IEECVETW                OPEN/CLOSE   UCB'               82360000
UCBD     DSECT                                                          82860000
         IEFUCBOB                                                       83360000
         TITLE 'IEECVETW               CONSOLE QUEUE ENTRY'             83860000
         IHACTM  CQE                                                    84360000
         TITLE 'IEECVETW               ESTAE RECOVERY WORKAREA'         84860000
         IHACTM  FTPT                                                   85360000
         TITLE 'IEECVETW          COMM TASK EXTENDED SAVE AREA'         85860000
         IHACTM  CXSA                                                   86360000
         TITLE 'IEECVETW                  FRR MAPPING'                  86860000
         IHAFRRS                                                        87360000
         TITLE 'IEECVETW                  WQE'                          87860000
         IHAWQE  DSECT=YES                                              88360000
         TITLE 'IEECVETW                  UCM'                          88860000
         IEECUCM  FORMAT=NEW                                            89360000
         TITLE 'IEECVETW            PREFIXED SAVE AREA'                 89860000
         IHAPSA                                                         90360000
         EJECT                                                          90860000
         IKJTCB                                                         91360000
         EJECT                                                          91860000
         IHARB   DSECT=YES                                              92360000
          END                                                           92860000
./  ADD  SSI=81250528,NAME=IEECVET1
         TITLE 'IEECVET1, ALIAS - IGC5107B - PROCESSOR 1'               00100000
IEECVET1 CSECT                                                          00200000
         ENTRY IGC5107B                                                 00300000
* A 085100-085492,253530-253546,312404-313621                 JE YM6718 00600003
* ET1RTY(A,C,D) APPROX. 817000                                 @ZA29665 00620003
* CONSWTCH(A) APPROX. 870000                                   @ZA29665 00640003
* NOESTAE(C) APPROX. 164000                                    @ZA29401 00660003
         EJECT                                                          00700000
*                                                                       00800000
* STATUS       CHANGE LEVEL 1 VS2 RELEASE 3                             00900000
*                                                                       01000000
*                                                                       01200000
* FUNCTION     ROUTE CONTROL TO ROUTINES ON THE BASIS OF FUNCTION       01300000
*              NEEDED.                                                  01400000
*                                                                       01500000
* STATUS -                                                              01600000
*                                                                       01700000
*  PTMS FIXED @YM8452                                                   01800000
*  APARS FIXED ZA00506,ZA00513,ZA00539,ZA02303,ZA02341,ZA02835,ZA04689, 01900000
*              ZA06411,ZA10109,ZA13458,ZA14126,ZA16376,ZA16389,ZA13189, 02000003
*              ZA29665,ZA29401                                          02030003
* ENTRY POINT  IEECVET1                                                 02100000
*                                                                       02200000
* INPUT        REGISTER 1 CONTAINS A POINTER TO A PARAMETER LIST MAPPED 02300000
*              BY CXSA                                                  02400000
*              BIT SETTINGS ON INPUT INDICATING TYPE OF ACTION REQUIRED 02500000
*                UCMSTS                                                 02600000
*                  UCMAF  ATTENTION                                     02700000
*                  UCMPF  OUTPUT PENDING                                02800000
*                  UCMCF  CLOSE REQUEST                                 02900000
*                  UCMTA  OPEN PENDING                                  03000000
*                UCMSDS5                                                03100000
*                  UCMSDS5B  INLINE OUTPUT PENDING                      03200000
*                  UCMSDSD8  OUT OF LINE OUTPUT PENDING                 03300000
*                UCMDEVC                                                03400000
*                  UCMDEVD  DOM ISSUED                                  03500000
*                DCMCS                                                  03600000
*                  DCMCSO   REOPEN DEVICE                               03700000
*                UCMMODE                                                03800000
*                  HARDBIT  NO HARD COPY                                03900000
*                                                                       04000000
*                DCMCOM1                                                04100000
*                  DCMIOPRD  A READ WAS PERFORMED- EXAMINE INPUT        04200000
*                                  (FOR DEVICES THAT DO RMI AND READ    04300000
*                                   IN SEPARATE I/O)                    04400000
*                  DCMCOMRM  RMI PERFORMED -CHECK RMI INPUT             04500000
*                DCMCOM2                                                04600000
*                   DCMCMIN5 RETURN TO INTERFACE 5                      04700000
*                DCMCOM3                                                04800000
*                  DCMRTPFK  RETURN TO PFK ROUTINE                      04900000
*                  DCMVLPFK  COMMAND BEING VERIFIED                     05000000
*                  DCMOLUNV  NEED UNVIEWABLE MSG MESSAGE                05100000
*                  DCMSTSWT  SWITCH USE OF CONSOLE                      05200000
*                  DCMCMIN7  RETURN TO INTERFACE 7                      05300000
*                DCMIOCM3                                               05400000
*                  DCMPFKAT  PFK ATTENTION                              05500000
*                  DCMACPFK  LIGHT ACTIVE PFK                           05600000
*                  DCMLTPFK  LIGHT ALLOCATED PFKS                       05700000
*                DCMTIMES                                               05800000
*                  DCMTIMER  TIMER HAS ELAPSED                          05900000
*                  DCMGROLL  READY FOR ROLL                             06000000
*                  DCMTASYN  PERFORM CANCEL AFTER AN ASYNCHRONOUS       06100000
*                                   ERROR                               06200000
*                DCMADKP - WORD                                         06300000
*                  IF NON-ZERO, INDICATES ROUTED COMMAND ON Q           06400000
*                                                                       06500000
* OUTPUT       STATUS IN UCM ENTRY AND DCM                              06600000
*              ON EXIT TO THE SECOND LOAD, REGISTER 2 CONTAINS          06700000
*                   A BRANCH CODE ACCORDING TO THE FUNCTION             06800000
*                   TO BE PERFORMED                                     06900000
*                                                                       07000000
* EXTERNAL REFERENCES  NONE                                             07100000
*                                                                       07200000
* EXITS-NORMAL      1. IEECVETG OPEN-CLOSE                              07300000
*                   2. IEECVETC ASYNCHRONOUS ERROR                      07400000
*                   3. IEECVET4 COMMAND                                 07500000
*                   4. IEECVET2 DISPLAY 1                               07600000
*                   5. IEECVET7 DELETE 2                                07700000
*                   6. IEECVET9 DELETE 4                                07800000
*                   7. IEECVFTP STATUS DISPLAY INTERFACE 5              07900000
*                   8. IEECVETJ ROLL                                    08000000
*                   9. IEECVETK TIMER-INTERPRETER                       08100000
*                   10.IEECVFTM STATUS DISPLAY INTERFACE 2              08200000
*                   11.IEECVETF LIGHT PEN-CURSOR                        08300000
*                   12.IEECVETH OR P OR R  DEVICE-DEPENDENT IO          08400000
*                   13.ROUTER                                 MD Y01958 08500000
*                   14.IEECVFTA PFK ROUTINE 1                           08600000
*                   15.IEECVFTL STATUS DISPLAY INTERFACE 1              08700000
*                   16.IEECVFT1 PROCESSOR 0                             08800000
*                   17.IEECVFT7 STATUS DISPLAY INTERFACE 7              08900000
*                   18.IEECVETD MESSAGE 1                               09000000
*                                                                       09100000
* TABLES/WORK AREAS                                                     09200000
*                   DCM - DISPLAY CONTROL MODULE                        09300000
*                        SPLIT IN TWO PORTIONS                          09400000
*                        1. RESIDENT PORTION - ALWAYS IN CORE           09500000
*                        2. PAGEABLE  PORTION - IN VIRTUAL MEMORY       09600000
*                   UCM - UNIT CONTROL MODULE                           09700000
*                   CXSA - COMMUNICATIONS TASK EXTENDED SAVE AREA       09800000
*                                                                       09900000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      10000000
*                                                                       10100000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON        10200000
*              A PARTICULAR INTERNAL REPRESENTATION OF THE              10300000
*              EXTERNAL CHARACTER SET                                   10400000
*                                                                       10500000
*                                                                       10600000
*                                                                       10700000
*        REGISTER EQUATES                                               10800000
*                                                                       10900000
XFBRANCH EQU   15        BRANCH EXIT TO OTHER ROUTINES                  11000000
*                        CONTENTS MAY CHANGE FOR SVC CALLS              11100000
XERTRN   EQU   14        RETURN BRANCH REG                              11200000
*                        CONTENTS MAY CHANGE FOR SVC CALLS              11300000
XDCXSA   EQU   13        CXSA BASE REG                                  11400000
XCPBASE  EQU   12        PROGRAM BASE REG                               11500000
XBTDCM   EQU   11        PAGEABLE DCM BASE REG                          11600000
XARDCM   EQU   10        RESIDENT DCM BASE REG                          11700000
X9UCM    EQU   9         UCM BASE REG                                   11800000
X8UCME   EQU   8         UCM ENTRY BASE REG                             11900000
X7UCB    EQU   7         UCB BASE                                       12000000
X6       EQU   6                                                        12100000
X5       EQU   5                                                        12200000
X4WORK   EQU   4                                                        12300000
X3MASK   EQU   3         MASK REGISTER                                  12400000
X2WORK   EQU   2         WORK REG                                       12500000
X1PARM   EQU   1         CXSA ADDRESS ON ENTRY AND EXIT                 12600000
*                        CONTENTS MAY CHANGE FOR SVC CALLS              12700000
X0       EQU   0         CONTENTS MAY CHANGE FOR SVC CALLS              12800000
         EJECT                                                          12900000
IGC5107B BALR  XCPBASE,N0          ESTABLISH REG FOR                    13000000
         USING *,XCPBASE           PROGRAM ADDRESSABILITY               13100000
         B     BEGIN               BRANCH AROUND PATCH AREA             13200000
ICATCH   DC    CL8'IEECVET1'       EYECATCHER AND FIELD MAINTENANCE     13300000
         DC    CL16' ALIAS IGC5107B'                                    13400000
         DC    XL2'4309'           JULIAN DATE LAST CHANGE  JE @ZA02303 13500000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY                   13600000
         DC    S(*)                                                     13700000
         DC    CL40' '             PATCH AREA                           13800000
BEGIN    EQU   *                   END OF PATCH AREA                    13900000
         USING CXSA,XDCXSA         CXSA ADDRESSABILITY                  14100000
         LR    XDCXSA,X1PARM       SET CXSA ADDRESS           MB YM6305 14200000
         L     X8UCME,CSAUCM       ESTABLISH REG FOR                    14300000
         USING UCMLIST,X8UCME      UCM ENTRY ADDRESSABILITY             14400000
*                                                                       14500000
*                 SETUP ESTAE ENVIRONMENT                               14600000
*                                                                       14700000
         ICM   X4WORK,15,CSANPTR   GET RECOVERY AREA          JE YM6718 14800000
         BZ    NOESTAE             NOT THERE, BYPASS          JE YM6718 14900000
         USING PARMLIST,X4WORK                                          15000000
         LA    X2WORK,ET1RTY       GET COMMON RECOVERY       JE @YM8452 15100000
         C     X2WORK,PARMRTAD    OUR RETRY ALREADY IN STACK JE @YM8452 15200000
         BE    NOESTAE             YES, LEAVE IT             JE @YM8452 15300000
         MVC   CSAXB(N8),RELEASED  NO,ESTAB LOCKING ADDRESSES          *15400000
                                   FOR RETRY ROUTINE         JE @YM8452 15500000
         MVC   CSANAME(8),PARMRTAD SAVE RETRY & REGSAVE       JE YM6718 15600000
         ST    X2WORK,PARMRTAD      ADDR & SAVE IT            JE YM6718 15700000
         DROP X4WORK                                                    15800000
NOESTAE  DS    0H                                             JE YM6718 15900000
         L     XARDCM,UCMXB        ESTABLISH REG FOR                    16000000
         USING DCMTSRT,XARDCM      RESIDENT DCM ADDRESSABILITY          16100000
         L     XBTDCM,DCMADTRN     ESTABLISH REG FOR                    16200000
         USING DCMSTRT,XBTDCM      PAGEABLE DCM ADDRESSABILITY          16300000
         ICM   X4WORK,15,DCMCXSVE  CSA POINTER INIT            @ZA29401 16350003
         BNZ   GOTDCM              YES DCM EXISTS              @ZA29401 16500003
         LA    0,SP241             SUBPOOL FOR GETMAIN        MB YM4087 16600000
         SLL   0,24                PUT IT IN HI ORDER BYTE    MB YM4087 16700000
         ICM   0,M3,DCMLEN         LENGTH FOR GETMAIN         MB YM4087 16800000
         GETMAIN R,LV=(0)          GET DCM CORE               MB YM4087 16900000
         LH    X3MASK,DCMLEN       DCM LENGTH                 MB YM4087 17000000
         LR    X5,X3MASK           FOR COPYING DCM            MB YM4087 17100000
         LR    X2WORK,X1PARM       MOVE TO ADDRESS            MB YM4087 17200000
         LR    X4WORK,XBTDCM       MOVE FROM ADDRESS          MB YM4087 17300000
         MVCL  X2WORK,X4WORK       COPY TDCM                  MB YM4087 17400000
         LR    X4WORK,XBTDCM       MODEL ADDRESS              MB YM4087 17500000
         LR    XBTDCM,X1PARM       NEW TDCM ADDRESS           MB YM4087 17600000
         ST    XBTDCM,DCMADTRN     RDCM POINTS TO TDCM        MB YM4087 17700000
         ST    X4WORK,DCMSTRT      TDCM POINTS TO MODEL       MB YM4087 17800000
         LA    X5,DCMBUFAD         FIRST ADCON                MB YM4087 17900000
         LA    X2WORK,4            BXLE INCREMENT             MB YM4087 18000000
         LA    X3MASK,DCMPFKLN     LAST ADCON                 MB YM4087 18100000
RELOC    EQU   *         TOP OF BXLE LOOP                     MB YM4087 18200000
         L     X1PARM,N0(X5)       GET ADCON VALUE            MB YM4087 18300000
         SR    X1PARM,X4WORK       GET DCM DISPLACEMENT       MB YM4087 18400000
         BM    NXTADDR             SKIP NEG DISPLACEMENT      MB YM4087 18500000
         AR    X1PARM,XBTDCM       GET RELOCATED VALUE        MB YM4087 18600000
         ST    X1PARM,N0(X5)       STORE IT                   MB YM4087 18700000
NXTADDR  BXLE  X5,X2WORK,RELOC     DO THE REST                MB YM4087 18800000
GOTDCM   ST    XDCXSA,DCMCXSVE     SAVE CXSA POINTER                    18900000
         L     X9UCM,CSACTLM       ESTABLISH REG FOR                    19000000
         USING UCM,X9UCM           UCM ADDRESSABILITY                   19100000
         TM    DCMMCSST,DCMDUSE    RE-ENTRY FROM DIDOCS                 19200000
         BZ    SAVE14              NO, SET UP INITIAL TRACE ENTRY       19300000
         TM    UCMSTS,UCMTA        OPEN PENDING ON RE-ENTRY             19400000
         BZ    TRACE               NO, ET1 ENTRY IS RECURSIVE           19500000
* NOTE: IF DCMDUSE AND UCMTA ARE BOTH ON, THIS IS AND ENTRY             19600000
*       TO OPEN THE CONSOLE AFTER A COMTASK ABEND THAT HAPPENED         19700000
*       WHILE DIDOCS WAS IN CONTROL FOR THIS CONSOLE AND DCMDUSE        19800000
*       WAS NEVER TURNED OFF.                                           19900000
SAVE14   EQU   *                                                        20000000
         ST    XERTRN,CSAXA        SAVE RETURN REG                      20100000
         OI    DCMMCSST,DCMDUSE    INDICATE OUR ROUTINES IN CONTROL     20200000
         MVC   CSAXB(N8),RELEASED INITIALIZE SETLOCK ADDRESSES  @YM8452 20300000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD ENTRIES            20400000
         MVI   DCMTREN1,CSTAR      MOVE IN '**' TO                      20500000
         MVI   DCMTREN2,CSTAR      INDICATE NEW DIDOCS ENTRY            20600000
         B     OBTAIN              GET LOCKS                            20700000
TRACE    EQU   *                   LOG ET1 ENTRY                        20800000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD ENTRIES            20900000
         MVI   DCMTREN1,ID1        MOVE IN MODULE ID OF                 21000000
         MVI   DCMTREN2,ID2        'E1' FOR IEECVET1                    21100000
OBTAIN   EQU   *                                                        21300000
         LR    X1PARM,XDCXSA       SET INPUT ADDRESS          MB YM6305 21400000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           21500000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         21600000
TESTOP   EQU   *                                               @ZA16376 21620000
         TM    UCMSTS,UCMTA        Q. OPEN PENDING             @ZA16376 21640000
         BO    SETOPEN             YES, GO OPEN                @ZA16376 21660000
TSTDOM   EQU   *                                                        21700000
*        TEST FOR DOM BEFORE ALL ELSE                                   21800000
         TM    UCMDEVC,UCMDEVD     WAS A DOM DONE                       22000000
         BNO   BUSY                NO, CONTINUE                         22100000
         L     XFBRANCH,DCMNDEL2   LOAD DELETE 2 ADDRESS                22300000
         B     PGONE               EXIT TO IEECVET7            @ZA10109 22400000
*  THIS SECTION OF CODE WILL TEST FOR POSTING OF THE ECB                22500000
*    IF THE ECB WAS POSTED FOR THE TIMER, AN EXIT WILL EVENTUALLY BE    22600000
*      MADE TO THE ROLL MODE OR TIMER INTERVAL CONTROL RTN              22700000
*    IF THE ECB WAS POSTED TO SIGNAL QUEUEING OF A ROUTED               22800000
*      COMMAND, THE COMMAND WILL EVENTUALLY BE FOUND ON THE             22900000
*      QUEUE AND HANDLED.                                               23000000
*    IF THE ECB WAS POSTED TO SIGNAL THAT THE USE OF THE USE OF         23100000
*      THE CONSOLE IS TO BE CHANGED, ALL OTHER WORK IS HANDLED          23200000
*      FIRST, AND THEN EXIT IS MADE TO THE DEVICE DEPENDENT IO          23300000
*      MODULE                                                           23400000
*    IF THE ECB WAS POSTED FOR AN I/O COMPLETE, A TEST WILL BE MADE TO  23500000
*      DETERMINE IF THE I/O WAS GOOD                                    23600000
*    IF THE I/O WAS NOT GOOD, AN EXIT WILL BE MADE TO THE ERROR RTN SO  23700000
*      THAT CONSOLE SWITCHING CAN BE PERFORMED                          23800000
BUSY     EQU   *                                                        23900000
         CLI   UCMECB,BLANK        ECB POSTED OTHER THAN FOR IO         24100000
         BNE   CHKIO               NO, GO CHECK FOR IO                  24200000
         CLI   UCMECB+N3,N255      LOW ORDER BYTE FF (ROLL MODE)        24500000
         BE    ZEROECB             YES, ZERO ECB                        24600000
         CLI   UCMECB+N3,CMNDCODE  ECB POSTED FOR ROUTED COMMAND        24700000
         BE    ZEROECB             YES, ZERO ECB                        24800000
         CLI   UCMECB+N3,KV        CONSOLE USE TO BE CHANGED            24900000
         BE    ZEROECB             YES, ZERO ECB                        25000000
         B     ERROR               IF NONE OF THESE, GO TO              25100000
*                                  ASYNCHRONOUS ERROR                   25200000
CHKIO    EQU   *                                                        25300000
         TM    UCMSTS,UCMBF        CONSOLE BUSY                         25500000
         BNO   TEST                NO. TEST REASON FOR ENTRY  MB YM5671 25600000
         TM    UCMECB,IOWAIT       WAIT BIT ON                          25800000
         BO    TEST                YES, TEST REASON FOR ENTRY MB YM5671 25900000
         CLI   UCMECB,ZERO         Q.IS ECB ZERO                        26000000
         BNE   CHKPFK1             YES, TEST FOR PFK I/O    JE @ZA00513 26100000
         TM    UCMDEVC,UCMDEVE     I/O COMPLETE ON          JE @ZA00513 26200000
         BO    ERROR               YES, GO SWITCH CONSOLES  JE @ZA00513 26300000
         B     TEST                ELSE, SEE WHY ENTERED    JE @ZA00513 26400000
         SPACE 5                                                        26500000
CHKPFK1  DS    0H                                           JE @ZA00513 26600000
         TM    DCMR3FLG,DCMR3PKA   IS THIS IO COMPLETE FOR PFK          26700000
         BO    PRC0EXIT            YES LET PROC 0 HANDLE IT             26800000
         SPACE 5                                                        26900000
         NI    UCMDEVC,N255-UCMDEVE  TURN OFF I/O COMPLETE FLAG         27100000
         NI    UCMSTS,N255-UCMBF   YES, TURN OFF BUSY BIT               27200000
         TM    UCMECB,IOGOOD       WAS I/O GOOD                         27400000
         BO    ZEROECB             YES, GO ZERO ECB                     27500000
         TM    DCMR3FLG,DCMCLPR    CLOSE IN PROGRESS                    27600000
         BO    ZEROECB             YES, IGNORE BAD I/O                  27700000
ERROR    EQU   *                                                        27800000
         L     XFBRANCH,DCMNERRO   LOAD ERROR RTN ADDRESS               28000000
         B     PMGONE              EXIT TO IEECVETC                     28100000
SETOPEN  EQU   *                                                        28200000
         MVI   CSACODE,CSAOPEN     INDICATE OPEN                        28400000
*              ONE LINE OF CODE DELETED HERE                   @ZA16389 28500000
         NI    UCMDEVC,N255-UCMDEVE  TURN OFF I/O COMPLETE     @ZA13458 28600000
OPENEXT  EQU   *                   EXIT TO IEECVETG                     28700000
         L     XFBRANCH,VOPCL      LOAD OPEN RTN ADDRESS                28800000
PMGONE   EQU   *                                                        28900000
         NI    DCMCOM1,N255-DCMLPENT-DCMCOMRM  TURN OFF BITS            29000000
PGONE    EQU   *                                               @ZA10109 29050000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 29100000
         BR    XFBRANCH            EXIT TO ADDRESSED ROUTINE            29200000
ZEROECB  EQU   *                                                        29300000
         MVI   UCMECB,ZERO         CLEAR I/O ECB                        29500000
         NI    UCMDEVC,N255-UCMDEVE TURN OFF I/O COMPLETE   JE @ZA00513 29600000
TEST     EQU   *                   TEST ASYNCHRONOUS SENSE    MB YM5671 29700000
         TM    UCMSTS,UCMAF        ATTENTION RECEIVED         MB YM5671 29800000
         BNO   TSTBSY              NO, GO TO NEXT TEST        MB YM5671 29900000
         L     X7UCB,UCMUCB        ADDRESS CONSOLE UCB        MB YM5671 30000000
         USING UCBOB,X7UCB         UCB ADDRESSABILITY         MB YM5671 30100000
         TM    UCBSNS,ASYNCHK      ASYNCHRONOUS ERROR         MB YM5671 30200000
         BNZ   ERROR               YES, GO CHECK IT OUT       MB YM5671 30300000
         NI    DCMASYNC,N255-DCMASDA-DCMASIN-DCMASBA-DCMASLOG           30330000
*                                  RESET ERROR BITS            @ZA14126 30360000
TSTBSY   EQU   *                                                        30400000
         TM    UCMSTS,UCMBF        Q. IS BUSY BIT ON                    30600000
         BO    REST14              YES, WAIT FOR I/O                    30700000
         TM    DCMR3FLG,DCMCLPR    Q. CLOSE IN PROGRESS                 30800000
         BO    TESTCL              YES, CONTINUE HANDLING CLOSE         30900000
*********************************************************************** 31100000
*              THREE LINES MOVED JUST PRIOR TO LABEL TSTDOM   @ZA16376* 31200000
*********************************************************************** 31300000
TESTREO  EQU   *                                                        31500000
         TM    DCMCS,DCMCSO        Q. REOPEN DEVICE                     31600000
         BNO   TESTCL              NO, GO TEST FOR CLOSE                31700000
         OI    DCMR3FLG,DCMSTSWT   YES,INDICATE STATUS CHANGING         31800000
IOEXIT   EQU   *                                                        32000000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              32100000
         B     PMGONE              EXIT TO IEECVET(H,P,R, OR U)         32200000
TESTCL   EQU   *                                                        32400000
         TM    UCMSTS,UCMCF        Q.WAS CLOSE REQUESTED                32500000
         BO    CLOSE            EXIT TO LOAD 2                          32600000
TSTCLCL  EQU   *                                                        32700000
         TM    DCMR3FLG,DCMCLPR    Q. CLOSE IN PROGRESS                 32900000
         BNO   TESTRD             NO, GO TEST FOR DOM                   33000000
         NI    DCMR3FLG,N255-DCMCLPR  TURN OFF CLOSE IN PROGRESS        33100000
         B     PFKCODE             RETURN TO MCS                        33200000
TESTRD   EQU   *                                                        33400000
         TM    DCMCOM1,DCMIOPRD    Q.WAS A READ PERFORMED               33500000
         BO    FIND                YES, GO EXAMINE INPUT                33600000
         TM    DCMCOM1,DCMCOMRM    Q. WAS A RMI PERFORMED               33800000
         BO    TSTRMI              YES, GO CHECK RMI INPUT              33900000
CHKCMDQ  EQU   *                                                        34000000
         L     X2WORK,DCMADKP      GET POINTER TO QUEUE OF              34200000
*                                       ROUTED COMMANDS                 34300000
* A NON-ZERO POINTER INDICATES A ROUTED COMMAND ON THE QUEUE.           34400000
*    IF THE COMMAND HAS BEEN HANDLED ALREADY, THE PARAMETER LIST        34500000
*    MUST BE FREED.  OTHERWISE BRANCH TO THE MODULE ADDRESSED IN        34600000
*    THE PARAMETER LIST TO HANDLE THE COMMAND.                          34700000
TESTKQ   EQU   *                                                        34800000
         LTR   X2WORK,X2WORK       ANY COMMANDS ON Q                    34900000
         BZ    LPCENT              NO, GO TEST NEXT FUNCTION            35000000
         USING KPARAM,X2WORK                                            35100000
RTCMDQ   EQU   *                                                        35300000
         TM    KFLGS,KGM           WAS THIS PARAMETER LIST             X35400000
                                        GETMAINED                       35500000
         BO    GMPARAM             YES, GO HANDLE GETMAINED TYPE        35600000
         XC    DCMADKP(N4),DCMADKP NO, THERE CAN ONLY BE ONE           X35800000
                                   COMMAND - DEQUEUE IT                 35900000
         B     KMODEXIT            EXIT TO INDICATED ROUTINE            36000000
GMPARAM  EQU   *                                                        36100000
         TM    KFLGS,KSRVCD        HAS THIS COMMAND BEEN SERVICED       36300000
         BO    FREE                YES, BRANCH TO FREE THE              36400000
*                                       PARAMETER LIST                  36500000
         OI    KFLGS,KSRVCD        INDICATE SERVICED                    36700000
KMODEXIT EQU   *                                                        36800000
         LA    X4WORK,KOPN         GET ADDRESS OF OPERAND FIELD         37000000
         ST    X4WORK,DCMADOPN     STORE ADDR OF OPERAND FIELD          37100000
         L     XFBRANCH,KMOD       BRANCH TO MODULE INDICATED IN        37200000
         B     PMGONE                   PARAMETER LIST                  37300000
FREE     EQU   *                                                        37400000
         L     X1PARM,KCHAIN     BASE NEXT KPARAM LIST                  37600000
         ST    X1PARM,DCMADKP    AND SAVE ITS ADDRESS                   37700000
         LR    X1PARM,XDCXSA       ADDRESS CXSA FOR FREELOCK  MB Y02958 37900000
         L     XFBRANCH,CSAXC      ADDRESS RELEASE SUBROUTINE MB Y02958 38000000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS FOR FREEMAIN MB Y02958 38100000
         FREEMAIN R,SP=SP241,LV=KPLLNGTH,A=(X2WORK)           MB Y02958 38200000
         LR    X1PARM,XDCXSA       ADDRESS CXSA FOR FREELOCK  MB Y02958 38300000
         L     XFBRANCH,CSAXB      ADDRESS OBTAIN SUBROUTINE  MB Y02958 38400000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS               MB Y02958 38500000
         B     CHKCMDQ           BRANCH TO CHECK NEXT LIST              38600000
         DROP  X2WORK                                                   38700000
         EJECT                                                          38800000
CLOSE    EQU   *                                                        38900000
*   ERASE SCREEN BEFORE CLOSING DEVICE                                  39000000
         TM    DCMCOM2,DCMERPF     Q. HAS SCREEN BEEN ERASED            39200000
         BO    FINCLOSE            YES, EXIT TO OPEN/CLOSE RTN          39300000
         OI    DCMR3FLG,DCMCLPR    INDICATE CLOSE IN PROGRESS           39500000
         OI    DCMCOM2,DCMERPF     INDICATE ERASE PERFORMED             39700000
         OI    DCMIOCM2,DCMERASE   INDICATE ERASE SCREEN                39800000
         OI    DCMIOCM3,DCMACPFK   INDICATE TURN OFF PFKS               40000000
         B     IOEXIT              EXIT TO I/O RTN                      40100000
FINCLOSE EQU   *                                                        40200000
         OI    DCMCS,DCMCSO        INDICATE REOPEN FOR NEXT ENTRY       40400000
         MVI   CSACODE,CSACLOSE    CLOSE INDICATION TO CLOSE RTN        40500000
         B     OPENEXT             EXIT TO IEECVETG                     40600000
LPCENT   EQU   *                                                        40700000
         TM    DCMCOM1,DCMLPENT    Q. ENTER PERFORMED USING CURSOR OR   40900000
*                                   LIGHT PEN                           41000000
         BO    FIND                YES, GO EXAMINE INPUT                41100000
         TM    UCMSTS,UCMAF        Q. IS THERE AN ATTENTION             41300000
         BO    ATTEN               YES GO FIND TYPE                     41400000
TEST1    EQU   *                                                        41500000
         TM    DCMR2FLG,DCMRXTIM   HAS TIMER ELAPSED                    41700000
         BNO   TSTINT7             NO, CONTINUE TESTS                   41800000
TIMEXIT  EQU   *                                                        42000000
         L     XFBRANCH,DCMNTIMR   LOAD TIMER RTN ADDRESS               42100000
         B     PMGONE              EXIT TO IEECVETK                     42200000
TSTINT7  EQU   *                                                        42300000
         TM    DCMCOM3,DCMCMIN7    RETURN TO INTERFACE 7                42600000
         BNO   TSTINT5             NO, GO TO NEXT TEST                  42700000
INT7EXIT EQU   *                                                        42800000
         L     XFBRANCH,DCMNINT7   LOAD INTERFACE 7 ADDRESS             43000000
         B     PMGONE              EXIT TO IEECVFTT                     43100000
TSTINT5        EQU                 *                                    43200000
         TM    DCMCOM2,DCMCMIN5    Q. RETURN CONTROL TO                X43500000
                                        INTERFACE 5 FOR BLANKING        43600000
         BNO   SEARCH              NO, CONTINUE LOOKING FOR            X43700000
                                        SOMETHING TO DO                 43800000
INT5EXIT EQU   *                                                        43900000
         L     XFBRANCH,DCMNINT5   LOAD INTERFACE 5 ADDRESS             44100000
         B     PMGONE              EXIT TO IEECVFTQ                     44200000
         SPACE                                                          44300000
SEARCH   EQU   *                                                        44400000
* CHECK FOR ANY MESSAGES ON THE QUEUE TO BE OUTPUT                      44500000
* THE OUTPUT PENDING BITS OPERATE AS FOLLOWS:                           44600000
*     UCMPF - OUTPUT PENDING, EITHER INLINE OR OUT OF LINE              44700000
*              THIS BIT CAUSES THE PROCESSOR TO RECEIVE CONTROL.        44800000
*     UCMSDS5B - INLINE OUTPUT PENDING                                  44900000
*              THIS BIT IS ON WHENEVER MESSAGES TO BE WRITTEN           45000000
*              IN LINE ARE ON THE QUEUE, EVEN IF A FULL SCREEN          45100000
*              CONDITION EXISTS, UNLESS THE CONSOLE IS IN THE           45200000
*              MIDDLE OF WRITING OUT AN INLINE MLWTO.  IF THE           45300000
*              CONSOLE IS HANDLING AN MLWTO, THE INLINE PENDING         45400000
*              BIT WILL BE TURNED ON ONLY WHEN MORE LINES OF THE        45500000
*              SAME MLWTO ARE ADDED.                                    45600000
*     UCMSDS5C - OUT OF LINE OUTPUT PENDING                             45700000
*              THIS BIT IS ON WHENEVER A MESSAGE WHICH CAN NOW          45800000
*              BE WRITTEN OUT OF LINE IS ON THE QUEUE.  THIS BIT        45900000
*              IS NOT ON IF THE ONLY MESSAGES ON THE QUEUE TO BE        46000000
*              WRITTEN OUT OF LINE ARE TO BE WRITTEN TO AN AREA         46100000
*              WITH A FULL FRAME CONDITION.  IT IS TURNED OFF           46200000
*              IF THE CONSOLE IS IN HOLD MODE.                          46300000
         TM    UCMSDS5,UCMSDS5B    Q. INLINE OUTPUT PENDING             46500000
         BO    DISPTST             YES                                  46600000
         CLI   DCMDEL,R            CONSOLE IN ROLL MODE     JE @ZA02835 46700000
         BNE   OUTLNTST            NO, BYPASS NEXT TEST     JE @ZA02835 46800000
         TM    DCMR2FLG,DCMRXRLL   Q. READY FOR ROLL                    47000000
         BO    ROLEXIT             YES, EXIT TO ROLL ROUTINE            47100000
OUTLNTST EQU   *                                                        47200000
         TM    UCMSDS5,UCMSDS5C    Q. OUT OF LINE OUTPUT PENDING        47400000
         BO    TESTHOLD            YES, GO TEST FOR HOLD MODE           47500000
         TM    DCMCOM3,DCMOLHLD    Q. OUT OF LINE MSGS HELD             47700000
         BNO   OFFOP               NO, GO TURN OFF OUTPUT               47800000
*                                       PENDING FLAG                    47900000
TESTHOLD EQU   *                                                        48000000
         TM    DCMIOUNQ,DCMFRSCN   Q. SCREEN IN HOLD MODE               48200000
         BO    ONOLHLD             YES, HOLD OUT OF LINE MSGS           48300000
         NI    DCMCOM3,N255-DCMOLHLD TURN OFF OUT OF LINE               48500000
*                                       MSGS HELD BIT                   48600000
INT2EXIT EQU   *                                                        48700000
         L     XFBRANCH,DCMNINT2   LOAD INTERFACE 2 ADDRESS             48900000
         B     PMGONE              EXIT TO IEECVFTM                     49000000
ONOLHLD  EQU   *                                                        49100000
         OI    DCMCOM3,DCMOLHLD    INDICATE OUT OF LINE                 49300000
*                                       MESSAGES HELD                   49400000
         NI    UCMSDS5,N255-UCMSDS5C TURN OFF OUT OF LINE BIT           49600000
OFFOP    EQU   *                                                        49700000
         NI    UCMSTS,X'FF'-UCMPF  TURN OFF OUTPUT PENDING FLAG,        49900000
*                                       SINCE BOTH INLINE AND           50000000
*                                       OUT OF LINE OUTPUT HAVE         50100000
*                                       BEEN HANDLED BY THIS            50200000
*                                       POINT                           50300000
         SPACE                                                          50400000
TSTUNVW  EQU   *                                                        50500000
         TM    DCMCOM3,DCMOLUNV    DID OUT OF LINE MSG CAUSE           X50700000
                                        UNVIEWABLE MSGS                 50800000
         BNO   TSTPFK              NO, CONTINUE LOOKING FOR            X50900000
                                        SOMETHING TO DO                 51000000
         NI    DCMCOM3,N255-DCMOLUNV  YES, TURN OFF BIT                 51100000
         TM    DCMR2FLG,DCMRXUNV+DCMRXSFL Q. UNVIEWABLE MSG MSG        X51200000
                                        ALREADY ON SCREEN OR            51300000
*                                       SCREEN FULL (MSG WAITING       X51400000
                                        MSG ON SCREEN)                  51500000
         BNZ   TSTPFK              YES, CONTINUE LOOKING FOR           X51600000
                                   SOMETHING TO DO                      51700000
         CLI   DCMDEL,Y            DEL = Y                              51900000
         BNE   WRUNVW              NO, GO WRITE UNVIEWABLE MSG          52000000
         OI    DCMCOM1,DCMCOMAU    YES, INDICATE PERFORM AUTO          X52100000
                                        DELETE                          52200000
         OI    DCMDSTAT,DCMDSAUT   INDICATE AUTO DELETE TRIED           52300000
DEL4EXIT EQU   *                                                        52400000
         L     XFBRANCH,DCMNDEL4   LOAD DELETE 4 ADDRESS                52600000
         B     PMGONE              EXIT TO IEECVET9                     52700000
WRUNVW   EQU   *                                                        52800000
         OI    DCMCMSG1,DCMUNMSG   TURN ON UNVIEWABLE MSG BIT           53000000
         CLI   DCMDEL,R            ROLL MODE (OR ROLL DELETABLE)        53200000
         BE    XDISP               YES, EXIT TO DISPLAY 1               53300000
         L     XFBRANCH,DCMNMSG1   NO, LOAD MESSAGE 1 ADDRESS           53400000
         B     PMGONE              EXIT TO IEECVETD                     53500000
TSTPFK   EQU   *                                                        53600000
         TM    DCMIOCM3,DCMACPFK+DCMLTPFK   ANY PFKS TO BE LIT          53800000
         BO    IOEXIT              YES, GO DO IT                        53900000
         TM    DCMCOM3,DCMRTPFK    MORE PFK WORK TO DO                  54100000
         BNO   ONWARD              NO, CHECK NEXT FUNCTION              54200000
         TM    DCMCOM3,DCMVLPFK     YES, ARE WAITING FOR A VERIFY       54400000
         BNO   PFK1A                 NO, GO TO FINISH PFK WORK          54500000
ONWARD   EQU   *                                                        54600000
*** TESTS FOR MORE MORE FUNCTIONS MAY BE MADE HERE ***                  54700000
         TM    DCMR3FLG,DCMSTSWT   CONSOLE USE TO BE CHANGED            54900000
         BO    IOEXIT              YES, EXIT TO IO ROUTINE              55000000
PFKCODE  TM    DCMCOM3,DCMPFKWR    SHOULD PFKS BE WRITTEN               55200000
         BO    PRC0EXIT            YES, GO TO PROC ZERO                 55300000
         B     ROUTOUT             EXIT TO ROUTER                       55400000
DISPTST  EQU   *                                                        55600000
         CLI   DCMDEL,R            CONSOLE IN ROLL MOD      JE @ZA02835 55700000
         BNE   SCRFUL              NO, CONTINUE LOOKING     DC @ZA04689 55800000
         TM    DCMR2FLG,DCMRXRLL    Q. READY FOR ROLL                   55900000
         BO    ROLEXIT             YES                                  56000000
SCRFUL   TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL           DC @ZA04689 56200000
         BO    TSTROLL             GO TEST FOR ROLL MODE         A38905 56300000
         TM    UCMSTS,UCMTC        WORKING ON AN INLINE MLWTO           56500000
         BO    INT1EXIT            YES, CALL INTERFACE ROUTINES         56600000
XDISP    L     XFBRANCH,DCMNDSP1   LOAD DISPLAY ROUTINE ADDRESS         56800000
         B     PMGONE              EXIT TO IEECVET6                     56900000
INT1EXIT EQU   *                                                        57000000
         L     XFBRANCH,DCMNINT1   LOAD INTERFACE 1 ADDRESS             57200000
         B     PMGONE              EXIT TO IEECVFTN                     57300000
         SPACE 2                                                        57400000
TSTROLL  EQU   *                                                        57600000
         CLI   DCMDEL,R            Q. ROLL MODE                         57700000
         BNE   OUTLNTST            NO, CONTINUE LOOKING                 57800000
         L     X2WORK,DCMSUBAD     ESTABLISH REG FOR                    58000000
         USING DSUB,X2WORK         SUB ADDRESSABILITY                   58100000
         L     X2WORK,SUBPBASE     ESTABLISH REG FOR                    58200000
         USING SUBDCMB,X2WORK      BASE DCM ADDRESSABILITY              58300000
         TM    DCMIND,DCMTMRST     IS STIMER IN EFFECT YET              58500000
         BO    OUTLNTST            YES, CONT LOOKING FOR                58600000
*                                  SOMETHING TO DO                      58700000
         CLC   DCMWTBUF(N4),DCMASCRN STATUS DISPLAYS COVER             *58800000
               THE SCREEN                                     MB YM4360 58900000
         BE    OUTLNTST            YES,LOOK FOR OTHER WORK    MB YM4360 59000000
         B     XDISP               NO, GO TO DISPLAY ROUTINE            59100000
*                                  TO GET TIMER SET                     59200000
PRC0EXIT EQU   *                                                        59300000
         NI    DCMR3FLG,N255-DCMR3PKA     TURN OFF EXIT BIT             59500000
         L     XFBRANCH,DCMNPRZ    LOAD PROC 0 ADDRESS                  59600000
         B     PMGONE              EXIT TO IEECVETZ                     59700000
ROUTOUT  EQU   *      EXIT TO ROUTER                                    59800000
         TM    DCMRFLGS,DCMDOM     DOM DONE WHILE BUSY        MB YM4087 60000000
         BNO   REST14              NO, CONTINUE LOOKING       MB YM4087 60100000
         TM    UCMSTS,UCMBF        STILL BUSY                 MB YM4087 60200000
         BO    REST14              YES, WAIT FOR IO COMPLETE  MB YM4087 60300000
         NI    DCMRFLGS,N255-DCMDOM TURN OFF DOM DONE         MB YM4087 60400000
         TM    UCMATR,UCMUF        CONSOLE STILL ACTIVE     JE @ZA02303 60500000
         BNO   REST14              NO, EXIT TO COMM TASK    JE @ZA02303 60600000
         OI    DCMIOCM1,DCMWRMSG   WRITE MESSAGE AREA         MB YM4087 60700000
         B     IOEXIT              EXIT TO IO ROUTINE         MB YM4087 60800000
REST14   EQU   *                   NO LEFTOVER DOM WORK       MB YM4087 60900000
         NI    DCMMCSST,N255-DCMDUSE  INDIC OUR RTNS NO LONGER IN CONT  61000000
         L     XERTRN,CSAXA        RESET RETURN REG                     61100000
         ICM   X4WORK,15,CSANPTR   GET RECOVERY AREA          JE YM6718 61200000
         BZ    NOESTAE1            NOT THERE, BYPASS          JE YM6718 61300000
         USING PARMLIST,X4WORK                                          61400000
         MVC   PARMRTAD(8),CSANAME RESOTRE RETRY & REGSAVE    JE YM6718 61500000
NOESTAE1 DS    0H                                             JE YM6718 61600000
         TM    UCMATR,UCMUF        CONSOLE STILL ACTIVE       MB YM4087 61700000
         BO    DONTFREE            YES,KEEP GETMAINED DCM     MB YM4087 61800000
         MVC   DCMADTRN(N4),DCMSTRT POINT RDCM TO MODEL DCM   MB YM4087 61900000
         LA    XERTRN,FREEDCM      RETURN FROM FREELOCK       MB YM4087 62000000
DONTFREE EQU   *        RELEASE LOCKS FOR EXIT OR FREEMAIN    MB YM4087 62100000
         LR    X1PARM,XDCXSA       GET CXSA ADDR                        62200000
         LA    XFBRANCH,FREELOCK   ADDRESS FREELOCK SUBROUTINE          62300000
         BR    XFBRANCH            RELEASE LOCKS                        62400000
FREEDCM  EQU   *         FREE TDCM IF CONSOLE NOT ACTIVE      MB YM4087 62500000
         LH    X0,DCMLEN           FREEMAIN LENGTH            MB YM4087 62600000
         FREEMAIN RC,SP=SP241,LV=(0),A=(XBTDCM)               MB YM4087 62700000
         LR    X1PARM,XDCXSA       RESET CXSA IN REG 1        MB YM4087 62800000
         L     XERTRN,CSAXA        RESET RETURN REG           MB YM4087 62900000
         BR    XERTRN              EXIT FROM DIDOCS           MB YM4087 63000000
ROLEXIT  EQU   *                                                        63100000
         TM    DCMTIMES,DCMTASYN   Q. HAS TIMER ELAPSED FOR ASYN ERROR  63400000
         BO    CANCEL              YES, GO TO REWRITE SCREEN            63500000
         CLI   DCMRQDEL,BLANK      Q. IS A DELETE REQUEST PENDING       63700000
         BNE   XDISP               YES DO NOT ROLL                      63800000
         L     XFBRANCH,DCMNROLL   LOAD ROLL RTN ADDRESS                64000000
         B     PMGONE              EXIT TO IEECVETJ                     64100000
FIND     EQU   *                                                        64200000
         NI    DCMCOM1,N255-DCMLPENT-DCMIOPRD  TURN OFF BITS            64400000
* CODE WAS MOVED FROM HERE TO IEECVET4                                  64500000
CMD1EXIT EQU   *                                                        64600000
         L     XFBRANCH,DCMNCMD1        LOAD COMMAND RTN ADDRESS        64800000
         B     PMGONE                   EXIT TO IEECVET4                64900000
CANCEL   EQU   *                                                        65000000
         OI    DCMCOM1,DCMCANCL         INDICATE CANCEL KEY             65200000
         B     CMD1EXIT                 EXIT                            65300000
* ROUTINE FOR ROUTING ATTENTIONS                                        65400000
ATTEN    EQU   *                                                        65500000
         NI    UCMSTS,N255-UCMAF   TURN OFF ATTENTION FLAG              65700000
         TM    UCMDISP,UCMDISPG    Q. STATUS DISPLAY CONSOLE            65900000
         BO    TEST1               YES, IGNORE ATTENTION                66000000
         OI    DCMIOCM1,DCMDORMI   TURN ON BIT - ISSUE RMI              66200000
         B     IOEXIT              GO TO ROUTINE                        66300000
TSTRMI   EQU   *                                                        66400000
         TM    DCMIOUNQ,DCMIO226   Q.READ RMI PERF FOR 2260             66600000
         BO    IOEXIT              YES, EXIT TO I/O RTN -FIND CURSOR    66700000
         LA    X2WORK,DCMDSAV      GET ADDR WHERE RMI INFO RETURNED     66800000
         AH    X2WORK,DCMRMINC     ADD INCRE TO IT TO ACCOUNT FOR       66900000
*                                  DIFFERENT DEVICES                    67000000
         IC    X3MASK,DCMASKEN      LOAD REG WITH MASK FOR ENTER        67100000
         EX    X3MASK,TESTMASK      Q. ENTER KEY                        67300000
         BO    ENTER               YES, GO READ INPUT                   67400000
         IC    X3MASK,DCMASKLP      LOAD MASK FOR LIGHT PEN             67500000
         EX    X3MASK,TESTMASK      Q. LIGHT PEN                        67700000
         BO    ENTER                YES, GO READ INPUT                  67800000
         IC    X3MASK,DCMASKCN      LOAD MASK FOR CANCEL                67900000
         EX    X3MASK,TESTMASK      Q. CANCEL KEY                       68100000
         BO    CANCEL              YES, GO HANDLE CANCEL                68200000
PFK      IC    X3MASK,DCMASKPF      LOAD MASK FOR PFK ATTENTION         68300000
         EX    X3MASK,TESTMASK     WAS IT A PFK                         68500000
         BNO   ENTER               NO, CHECK NEXT FUNCTION              68600000
         B     PFK1                YES, GO TO TAKE CARE OF PFK          68700000
* ASSUME ENTER                                                          68800000
ENTER    EQU   *                                                        68900000
         TM    DCMTIMES,DCMTASYN   IS ASYNCHRONOUS ERR MSG ON SCREEN    69100000
         BO    CANCEL              YES, GO CANCEL                       69200000
         IC    X3MASK,DCMASKCR     INSERT CURSOR MASK                   69400000
         EX    X3MASK,TESTMASK      Q.CURSOR FOR 22D0C OR               69500000
         BO    TSTCRS              YES, GO TEST FOR CURSOR POSITION     69600000
* ANY DEVICE WITH PFK CAPABILITY MUST HAVE RMI & READ DONE SEPARATELY   69700000
         TM    DCMIOUNQ,DCMRDARM   Q. PERFORM A READ                    69900000
         BNO   FIND                NO, TEST INPUT                       70000000
         OI    DCMIOCM2,DCMIOCRD   TURN ON BIT- ISSUE READ              70100000
         B     IOEXIT              GO ISSUE  I/O                        70300000
TSTCRS   EQU   *                   MUST BE 220C,22D0C -CURS POS IN BYTE 70400000
         L     X3MASK,DCMBUFAD      GET DISPLACEMENT                    70600000
         LA    X3MASK,N4(X3MASK)      OF DCMBAENT                       70700000
         CLC   DCMDSAV(N2),N0(X3MASK)  Q. CURSOR IN MESSAGE AREA        70800000
         BL    FNDCRS              YES, GO TO LIGHT PEN/CURSOR          70900000
         CLC   DCMDSAV(N2),N2(X3MASK)  Q.CURSOR IN WARNING LINE         71000000
         BL    FIND                NO, GO EXAMINE INPUT                 71100000
FNDCRS   EQU   *                                                        71200000
         L     XFBRANCH,DCMNLPCR  LOAD CURSOR/LIGHT PEN ADDRESS         71400000
         B     PMGONE              EXIT TO IEECVETF                     71500000
PFK1     EQU   *                                                        71600000
         OI    DCMIOCM3,DCMPFKAT  INDICATE PFK ATTENTION OCCURRED       71800000
PFK1A    EQU   *                                                        71900000
         L     XFBRANCH,DCMNPFK1   LOAD PFK1 ROUTINE ADDRESS            72100000
         B     PMGONE              EXIT TO IEECVFTA                     72200000
*                                                                       72300000
*        EXECUTED INSTRUCTIONS                                          72400000
TESTMASK TM    N0(X2WORK),ZERO  TEST FOR DETERMINING ATTENTION TYPE     72500000
         EJECT                                                          72600000
*                                                                       72700000
*        OBTAIN LOCKS SUBROUTINE                                        72800000
*                                                                       72900000
         DROP X8UCME,X9UCM                                  JE @ZA02341 73000000
         USING UCM,14                                       JE @ZA02341 73100000
GETLOCK  EQU   *                                                        73200000
         USING *,XFBRANCH          SUBROUTINE ADDRESSABILITY BASED ON   73300000
*                                  ENTRY REGISTER                       73400000
         DROP  XDCXSA              DROP OLD CXSA BASE                   73500000
         USING CXSA,X1PARM         REG 1 ADDRESSES THE CXSA AS          73600000
*                                  AN INPUT PARAMETER                   73700000
         STM   11,13,CSAXD SAVE REGS OVER SETLOCK CALL       JE @YM8452 73800000
         LR    0,14                SAVE 14 OVER SETLOCK      JE @YM8452 73900000
GETLOCL  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *74000000
               RELATED=(WQE,IEECVET1(FREELOCL))                         74100000
GETCMS   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          *74200000
               RELATED=(UCM,IEECVET1(FREECMS))                          74300000
         L     14,CSACTLM          GET UCME ADDR             JE @YM8452 74400000
         L     11,UCMFRRAD         GET VCTR FRR RTN ADDR     JE @YM8452 74500000
         USING PSA,0                                         JE @YM8452 74600000
GETFRR   SETFRR A,FRRAD=(11),PARMAD=(13),WRKREGS=(12,13),              *74700000
                RELATED=(CMSLOCK,IEECVET1(FREEFRR))          JE @YM8452 74800000
         ST    13,CSADCBP  SAVE FRR PARMLIST PTR             JE @YM8452 74900000
         USING PARMLIST,13                                   JE @YM8452 75000000
         ICM   12,15,CSANPTR       GET ESTAE PARMLIST PTR    JE @YM8452 75100000
         BZ    FRRA                NOT THERE                 JE @YM8452 75200000
         MVC   PARMLIST(PARMSIZE),0(12) COPY ESTAE PARMLIST TO         *75300000
                                   FRR PARMLIST              JE @YM8452 75400000
FRRA     MVC   PARMID,SVC72ID      SET UP PROCESSOR ID       JE @YM8452 75500000
         LM    11,13,CSAXD         RESTORE REGS AFTER SETLOCK   @YM8452 75600000
         LR    14,0                RESTORE 14                JE @YM8452 75700000
GETEXIT  MVC   CSAXB(N8),OBTAINED  RESET SUBROUTINE ADDRESSES           75800000
         LR    XFBRANCH,XERTRN     COPY EXIT ADDRESS                    75900000
         BR    XERTRN              EXIT FROM GETLOCK SUBROUTINE         76000000
         SPACE 5                                                        76100000
*                                                                       76200000
*        RELEASE LOCKS SUBROUTINE                                       76300000
*                                                                       76400000
FREELOCK EQU   *                                                        76500000
         USING *,XFBRANCH          SUBROUTINE ADDRESSABILITY BASED ON   76600000
*                                  ENTRY REGISTER                       76700000
         USING CXSA,X1PARM         REG 1 ADDRESSES THE CXSA AS          76800000
*                                  AN INPUT PARAMETER                   76900000
         STM   11,13,CSAXD         SAVE REGS OVER SETLOCK CALL  @YM8452 77000000
         LR    0,14                SAVE REG 14               JE @YM8452 77100000
FREEFRR SETFRR D,WRKREGS=(12,13),                                      *77200000
                RELATED=(CMSLOCK,IEECVET1(GETFRR))           JE @YM8452 77300000
         XC    CSADCBP,CSADCBP     ZERO PTR                  JE @YM8452 77400000
FREECMS  SETLOCK RELEASE,TYPE=CMS,                                     *77500000
               RELATED=(UCM,IEECVET1(GETCMS))                           77600000
FREELOCL SETLOCK RELEASE,TYPE=LOCAL,                                   *77700000
               RELATED=(WQE,IEECVET1(GETLOCL))                          77800000
         DROP  13,14,0                                       JE @YM8452 77900000
         USING UCMLIST,X8UCME                                JE @YM8452 78000000
         LM    11,13,CSAXD        RESTORE REGS AFTER SETLOCK JE @YM8452 78100000
         LR    14,0                RESTORE 14                JE @YM8452 78200000
FREEXIT  MVC   CSAXB(N8),RELEASED  RESET SUBROUTINE ADDRESSES           78300000
NOOPLOCK LR    XFBRANCH,XERTRN     COPY EXIT ADDRESS                    78400000
         BR    XERTRN              EXIT FROM FREELOCK SUBROUTINE        78500000
         EJECT                                                          78600000
*                                                                       78700000
*              ESTAE RETRY ROUTINE FOR DIDOCS PROCESSING                78800000
*                                                                       78900000
ET1RTY   DS    0D                                             JE YM6718 79000000
         BALR  XFBRANCH,0          GET BASE                   JE YM6718 79100000
         USING *,XFBRANCH          TELL ASSM                  JE YM6718 79200000
         L     XCPBASE,ADET1       SETUP STND BASE            JE YM6718 79300000
         DROP XFBRANCH,X1PARM                                 JE YM6718 79400000
         USING CXSA,XDCXSA                                   JE @YM8452 79500000
         USING IGC5107B+2,XCPBASE                             JE YM6718 79600000
         USING PSA,0                                          JE YM6718 79700000
         L     X5,PSATOLD          GET OUR TCB PTR            JE YM6718 79800000
         L     X5,TCBRBP-TCB(X5)   GET SVRB PTR               JE YM6718 79900000
         LA    XDCXSA,RBEXSAVE-RBSECT(X5) GET CXSA PTR      JE @ZA00539 80000000
         L     X8UCME,CSAUCM       RELOAD UCME PTR            JE YM6718 80100000
         L     XARDCM,UCMXB        RELOAD RDCM PTR            JE YM6718 80200000
         L     XBTDCM,DCMADTRN     RELOAD TDCM PTR            JE YM6718 80300000
*                                                                       80400000
*              END OF REGISTER SETUP CODE                               80500000
*                                                                       80600000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2  SHIFT OLD ENTRIES           80700000
         MVI   DCMTREN1,ID3        MOVE IN MOD ID OF 'ES'               80800000
         MVI   DCMTREN2,ID4        FOR IEECVET1 ESTAE RTN               80900000
*                                                                       81000000
*     GET LOCAL AND CMS LOCKS                                           81100000
*                                                                       81200000
         LR    X1PARM,XDCXSA       POINT TO CXSA             JE @YM8452 81300000
         L     XFBRANCH,CSAXB      ADDR GETLOCKS RTN         JE @YM8452 81400000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS              JE @YM8452 81500000
*                                                                       81600000
         ICM   X4WORK,15,CSANPTR      GET RECOVERY AREA       JE YM6718 81700000
         BZ    NORCVRY             NOT THERE SWITCH CONSOLES   @ZA29665 81800003
         MVI   PARMFTPT,0          CLEAR FOOTPRINTS           JE YM6718 81900000
         TM    UCMSTS,UCMBF        CONSOLE BUSY               JE YM6718 82000000
         BO    BSYRCVRY            YES, GO HANDLE             JE YM6718 82100000
         TM    UCMSTS,UCMCF        CLOSE PENDING              JE YM6718 82200000
         BO    CLSRCVRY            YES, GO HANDLE             JE YM6718 82300000
         TM    UCMSTS,UCMTA        OPEN PENDING               JE YM6718 82400000
         BO    OPNRCVRY            YES, GO HANDLE             JE YM6718 82500000
*                                                                       82600000
*     ADDITIONAL RECOVERY CODE CAN GO HERE                              82700000
*                                                                       82800000
NORCVRY  NI    UCMDEVC,N255-UCMDEVE   TURN OFF I/O COMPLETE  JE @YM8452 82900000
         NI    DCMMCSST,N255-DCMDUSE  RTN NO LONGER IN CTRL D02 ZA06411 83000000
         L     XFBRANCH,CSAXC      ADDR RELEASE LOCK SBRTN   JE @YM8452 83100000
         BALR  XERTRN,XFBRANCH     GO RELEASE LOCKS          JE @YM8452 83200000
*                                                                       83300000
         L     XERTRN,CSAXA        RESET RETURN REGISTER       @ZA29665 83400003
         ICM   X4WORK,15,CSANPTR   RECOVERY AREA PRESENT?      @ZA29665 83410003
         BZ    SETSWCH          NO,SET CONSOLE SWITCH PARMLIST @ZA29665 83420003
PARMCTN  MVC   PARMRTAD(N8),CSANAME RESTORE RETRY AND REGSAVE  @ZA29665 83440003
SETSWCH  MVI   CSACODE,CSASWTCH    INDICATE CONSOLE SWITCH     @ZA29665 83470003
         MVC   CSANAME(N8),CONSWTCH MODULE NAME OF SWITCH      @ZA29665 83480003
         L     XFBRANCH,CSACTLM    SET UCM BASE ADDRESS        @ZA29665 83550003
         L     XFBRANCH,UCMSWCH-UCM(XFBRANCH) ADDR OF CON SW   @ZA29665 83600003
         LR    X1PARM,XDCXSA       ADDRESS OF CXSA IN REG1     @ZA29665 83650003
         BR    XFBRANCH            EXIT TO CONSOLE SWITCH      @ZA29665 83700003
*                                                                       83800000
*      CLOSE RECOVERY                                                   83900000
*                                                                       84000000
CLSRCVRY DS    0H                                             JE YM6718 84100000
         MVI   CSACODE,CLSRCV      SET CLOSE RECOVERY CODE    JE YM6718 84200000
         B     OPENEXT             GO TO ETG                  JE YM6718 84300000
*                                                                       84400000
*     OPEN RECOVERY                                                     84500000
*                                                                       84600000
OPNRCVRY DS    0H                                             JE YM6718 84700000
         MVI   CSACODE,OPNRCV      SET OPEN RECOVERY CODE     JE YM6718 84800000
         B     OPENEXT             GO TO ETG                  JE YM6718 84900000
*                                                                       85000000
*     EXCP ERECOVERY                                                   85100000
*                                                                       85200000
BSYRCVRY DS    0H                                             JE YM6718 85300000
         NI    UCMSTS,N255-UCMBF   TURN OFF BUSY              JE YM6718 85400000
         NI    UCMDEVC,N255-UCMDEVE   TURN OFF I/O COMPLETE  JE @YM8452 85500000
         MVI   UCMECB,BADIO        SET PERM I/O ERROR       JE @ZA02303 85600000
         L     XFBRANCH,CSAXC      ADDR RELEASE LOCK SBRTN    JE YM6718 85700000
         BALR  XERTRN,XFBRANCH     GO RELEASE LOCKS           JE YM6718 85800000
         B     ERROR               TREAT AS BAD I/O AND       JE YM6718 85900000
*                                  SWITCH CONSOLES            JE YM6718 86000000
*                                                                       86100000
CLSRCV   EQU   12                  CLOSE RECOVERY CODE        JE YM6718 86200000
OPNRCV   EQU   8                   OPEN RECOVERY CODE         JE YM6718 86300000
BADIO    EQU   X'41'               PERM I/O ERROR POST CODE JE @ZA02303 86400000
         SPACE 5                                                        86500000
*                                                                       86600000
*   CONSTANTS                                                           86700000
*                                                                       86800000
         DS    0F                                                       86900000
SVC72ID  DC    CL4'VCTR'                                     JE @YM8452 87000000
CONSWTCH DC    CL8'IGC0407B'  NAME OF CONSOLE SWITCH RTN       @ZA29665 87050003
VOPCL    DC    V(IEECVETG)                                              87100000
ADET1    DC    A(IGC5107B+2)       BASE OF MODULE             JE YM6718 87200000
RELEASED DC    A(GETLOCK)                                               87300000
OBTAINED DC    A(NOOPLOCK)                                              87400000
         DC    A(FREELOCK)                                              87500000
*                                                                       87600000
*   EQUATES                                                             87700000
*                                                                       87800000
ID1      EQU   C'E'                1ST CHAR OF CSECT ID                 87900000
ID2      EQU   C'1'                2ND CHAR OF CSECT ID                 88000000
ID3      EQU   C'E'                1ST CHAR OF ESTAE ID                 88100000
ID4      EQU   C'S'                2ND CHAR OF ESTAE ID                 88200000
CSTAR    EQU   C'*'                ID ENTRY TO INDICATE 1ST TIME        88300000
SP241    EQU   241                                            MB Y02958 88400000
IOBCOUNT EQU   14                  IOB COUNT FIELD                      88500000
CMNDCODE EQU   X'FE'               POST CODE FOR ROUTED COMMAND         88600000
KV       EQU   X'FD'               POST CODE FOR K V                    88700000
IOWAIT   EQU   X'80'               WAIT FOR I/O                         88800000
DISPBIT  EQU   X'10'        DISPLAY BIT                                 88900000
IOGOOD   EQU   X'7F'     I/O GOOD                                       89000000
BLANK    EQU   X'40'     BLANK CHAR.                                    89100000
UCMPOST  EQU   X'80'          POST BIT FOR ECB                          89200000
ZERO     EQU   X'00'               ZERO FOR UTILITY BYTE& ECB           89300000
R        EQU   C'R'                DEL = R OR RD                        89400000
Y        EQU   C'Y'                DEL = Y                              89500000
N0       EQU   0              ZERO                                      89600000
N1       EQU   1              ONE                                       89700000
N2       EQU   2                       2                                89800000
N3       EQU   3                       3                                89900000
N4       EQU   4         FIELD INCREMENT FOR CXSA                       90000000
N8       EQU   8                                                        90100000
N22      EQU   22        FIELD INCREMENT FOR  UCB                       90200000
N255     EQU   255       USED TO TURN OFF SINGLE BITS                   90300000
ASYNCHK  EQU   X'1B'                    ASYNCH ERRORS                   90400000
CONSOLE  EQU   X'02'               UCB CONSOLE FLAG                     90500000
M3       EQU   3                   MASK FOR INSERT CHARACTER  MB YM4087 90600000
         EJECT                                                          90700000
DKPARAM  DSECT                                                          90800000
         IEECVMAP KPARAM                                                90900000
         EJECT                                                          91000000
         IHACTM FTPT               RECOVERY WORKAREA MAPPING  JE YM6718 91100000
         EJECT                                                          91200000
         IHAFRRS                   MAP FRR PARMLIST          JE @YM8452 91300000
         EJECT                                                          91400000
         IHARB DSECT=YES                                      JE YM6718 91500000
         EJECT                                                          91600000
         IKJTCB                                               JE YM6718 91700000
         EJECT                                                          91800000
         IEERDCM                                                        91900000
         EJECT                                                          92000000
         IEETDCM                                                        92100000
         EJECT                                                          92200000
         IHACTM  CXSA                                                   92300000
         EJECT                                                          92400000
         IEECUCM  FORMAT=NEW                                            92500000
         EJECT                                                          92600000
*                                                                       92700000
DSUB     DSECT                                                          92800000
         IEECSUB Y,N,N,N,N,Y                                            92900000
         EJECT                                                          93000000
         IHAPSA                                                         93100000
         EJECT                                                          93200000
         CVT   DSECT=YES                                                93300000
         EJECT                                                          93400000
ET1UCB   DSECT                                                          93500000
         IEFUCBOB LIST=YES                                              93600000
         END                                                            93800000
./  ADD  SSI=53380144,NAME=IEECVET2
* /* START OF SPECIFICATIONS ****************************************** 00010002
*                                                                       00020002
*01*  MODULE-NAME = IEECVET2                                            00030002
*                                                                       00040002
*01*  DESCRIPTIVE-NAME = DISPLAY ROUTINE 1                              00050002
*                                                                       00060002
*01*  COPYRIGHT = NONE                                                  00070002
*                                                                       00080002
*01*  STATUS = CHANGE LEVEL 1 FOR VS2 RELEASE 3                         00090000
*                                                                       00100002
*    APARS FIXED -- OZ00507, OZ02835                                    00102000
*                                                                       00104023
*01*  FUNCTION = TO ROUTE CONTROL TO THE PROPER ROUTINES TO HANDLE THE  00110002
*     OUTPUT OF IN-LINE MESSAGES. ON INTIAL ENTRY, THE LOCATION OF ANY  00120002
*     STATUS DISPLAY THAT MAY BE ON THE SCREEN IS DETERMINED AND SAVED  00130002
*     FOR USE BY THE OTHER DISPLAY ROUTINES.   INITIAL VALUES ARE ALSO  00140002
*     SET FOR THE PARAMETERS  THAT WILL EVENTUALLY BE USED  BY THE I/O  00142002
*     ROUTINES TO WRITE THE NEWLY DISPLAYED MESSAGES.                   00144002
*                                                                       00160002
*01*  NOTES = LOCAL AND  CROSS-MEMORY  LOCKS ARE OBTAINED ON ENTRY VIA  00170002
*     THE GETLOCK SUBROUTINE ADDRESSED IN THE CXSA (CSAXB).             00180002
*                                                                       00190002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              00200002
*                                                                       00210002
*02*    DEPENDENCIES = NONE                                             00220002
*                                                                       00230002
*02*    RESTRICTIONS = NONE                                             00240002
*                                                                       00250002
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES                     00260002
*                                                                       00270002
*02*    PATCH-LABEL = ICATCH A DC STATEMENT                             00280002
*                                                                       00290002
*01*  MODULE-TYPE = MODULE                                              00300002
*                                                                       00310002
*02*    PROCESSOR = ASSEMF-370R                                         00320002
*                                                                       00330002
*02*    MODULE-SIZE = X'178' BYTES                                      00340002
*                                                                       00350002
*02*    ATTRIBUTES = REENTERABLE                                        00360002
*                                                                       00370002
*01*  ENTRY-POINT = IEECVET2                                            00380002
*                                                                       00390002
*02*    PURPOSE = TO ROUTE CONTROL TO OTHER ROUTINES DURING DISPLAY     00400002
*       PROCESSING                                                      00402002
*                                                                       00410002
*02*    LINKAGE = BALR                                                  00420002
*                                                                       00430002
*02*    INPUT = REGISTER 1 ADDRESSES THE CXSA                           00440002
*       SEE ALSO CONTROL BLOCK USAGE                                    00450002
*                                                                       00460002
*02*    OUTPUT = REGISTER 1 ADDRESSES THE CXSA                          00470002
*       SEE ALSO CONTROL BLOCK USAGE  AND EXITS                         00480002
*                                                                       00490002
*02*    EXIT-NORMAL = IEECVFT2 - DISPLAY ROUTINE 3                      00500002
*       TO DISPLAY ANY WAITING LINES IF THE SCREEN IS NOT FULL          00510002
*                                                                       00530002
*02*    EXIT-NORMAL = IEECVETH, P, R, OR U - I/O ROUTINE                00540002
*       IF ANY INDICATORS ARE SET IN  DCMIOCM1  THAT THERE IS SOMETHING 00550002
*       NEW TO BE WRITTEN.                                              00560002
*                                                                       00580002
*02*    EXIT-NORMAL = IEECVET3 - DISPLAY ROUTINE 2                      00582002
*       FOR CONSOLES IN ROLL MODE TO SET THE TIMER.                     00582402
*                                                                       00584002
*02*    EXIT-NORMAL = IEECVET7 - DELETE ROUTINE 2                       00586002
*       IF THE SCREEN IS FULL AND DCMIRCTR, THE INTERVENTION REQUIRED   00586402
*       MESSAGE COUNT, IS NOT ZERO TO TRY DELETION OF INTERVENTION      00586802
*       REQUIRED ACTION MESSAGES IF DELETION HAS NOT BEEN TRIED YET.    00587202
*                                                                       00588002
*02*    EXIT-NORMAL = IEECVET9 - DELETE ROUTINE 4                       00588402
*       FOR CONSOLES IN AUTO DELETE MODE, IF THE SCREEN IS FULL, IN     00588502
*       ORDER TO TRY DELETION OF ANY AUTOMATICALLY DELETABLE MESSAGES   00588602
*       IF DELETION HAS NOT BEEN TRIED YET.                             00588702
*                                                                       00588802
*02*    EXIT-NORMAL = IEECVETD - MESSAGE ROUTINE 1                      00589202
*       FOR CONSOLES NOT IN ROLL MODE, TO DISPLAY THE UNVIEWABLE        00589302
*       MESSAGE WARNING LINE IF DCMCMSG1, BIT DCMUNMSG REQUESTS IT.     00589402
*                                                                       00589602
*02*    EXIT-NORMAL = IEECVET1 - DIDOCS MAIN PROCESSOR ROUTINE          00589702
*       AS AN EXIT WHEN NO FURTHER INDICATION OF DISPLAY PROCESSING     00592202
*       WORK CAN BE FOUND.                                              00594202
*                                                                       00595002
*02*    EXIT-ERROR = NONE                                               00597502
*                                                                       00600002
*01*  EXTERNAL-REFERENCES = NONE                                        00610002
*                                                                       00620002
*02*    ROUTINES = GETLOCK SUBROUTINE - DEFINED IN IEECVET1, AND        00630002
*       ADDRESSED BY WORD CSAXB OF THE CXSA ON ENTRY.                   00640002
*                                                                       00650002
*02*    DATA-SETS = NONE                                                00660002
*                                                                       00670002
*02*    DATA-AREA = NONE                                                00680002
*                                                                       00690002
*02*    CONTROL-BLOCKS = CXSA,UCM,WQE,CQE,RDCM,TDCM                     00700002
*                                                                       00710002
*01*  TABLES = NONE                                                     00720002
*                                                                       00730002
*01*  MACROS = EXECUTABLE - NONE                                        00740002
*              MAPPING - IHAWQE  WQE DSECT                              00750002
*                        IHACTM  CXSA DSECT                             00760002
*                        IEECUCM UCM DSECT                              00770002
*                        IEERDCM RESIDENT DCM DSECT                     00780002
*                        IEETDCM PAGEABLE DCM DSECT                     00790002
*                                                                       00800002
*01*  CHANGE-ACTIVITY = MODULE REWRITTEN TO REPACKAGE DIDOCS            00810002
*     FOR VS2 RELEASE 2. - SUPPORT CODE Y02958.                         00820002
*                                                                       00830002
**** END OF SPECIFICATIONS *******************************************/ 00840002
         TITLE 'IEECVET2 DISPLAY 1'                                     00850002
*/*IEECVET2:     CHART */                                               00860002
*/*              HEADER                                                 00870002
*/*          IEECVET2                   DISPLAY 1                       00880002
*/*           CHART E2           PAGE #    */                           00890002
*/*      E  IEECVET2 */                                                 00892002
IEECVET2 CSECT                                                          00900002
*A083520,083540,083560                                        MH Y02140 00950002
*C084000                                                      MH Y02140 01000002
*        REGISTER EQUATES                                               03050002
*                                                                       03100002
XFBRANCH EQU   15        BRANCH EXIT TO OTHER ROUTINES                  04060002
*                        CONTENTS MAY CHANGE FOR SVC CALLS              04070002
XERTRN   EQU   14        RETURN BRANCH REG                              04080002
*                        CONTENTS MAY CHANGE FOR SVC CALLS              04090002
XD       EQU   13                                                       04092002
XCPBASE  EQU   12        PROGRAM BASE REG                               04094002
XBTDCM   EQU   11        PAGEABLE DCM BASE REG                          04096002
XARDCM   EQU   10        RESIDENT DCM BASE REG                          04098002
X9UCM    EQU   9         UCM BASE REG                                   04098402
X8UCME   EQU   8         UCM ENTRY BASE REG                             04098802
X7       EQU   7                                                        04099202
X6       EQU   6                                                        04099602
X5       EQU   5                                                        04099702
X4       EQU   4                                                        04099802
X3       EQU   3                                                        04099902
X2SSCT   EQU   2         SSCT SEARCH REG                                04116602
X1PARM   EQU   1         CXSA BASE REGISTER                             04126602
X0ZERO   EQU   0         FOR ZEROING DCM FIELDS                         04130602
*                                                                       04133302
**********************************************************************  04150002
         EJECT                                                          04200002
         SPACE 2                                                        04250002
*/*      P                         INITIALIZE BASE REGS */              04260002
*********************************************************************** 04300002
         BALR  XCPBASE,N0          LOAD PROGRAM BASE REGISTER           04350002
         USING *,XCPBASE           ESTABLISH PROG ADDRESSABILITY        04400002
         B     BEGIN               BRANCH AROUND PATCH AREA             04450002
ICATCH   DC    CL8'IEECVET2'      EYECATCHER AND FIELD MAINTENANCE      04460000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY                   04462000
         DC    XL2'5056'           DATE LAST CHANGE         JE @ZA02835 04464000
         DC    S(*)                                                     04466000
         DC    CL52'ZAPS'          PATCH AREA                           04468000
BEGIN    EQU   *                   END OF PATCH AREA                    04470002
         USING UCMLIST,X8UCME      ESTABLISH UCMENTRY ADDRESSABILITY    04500002
         USING CXSA,X1PARM         ESTABLISH CXSA ADDRESSABILITY        04600002
         USING UCM,X9UCM           ESTABLISH UCM ADDRESSABILITY         04700002
         USING DCMTSRT,XARDCM      ESTABLISH R DCM ADDRESSABILITY       04850002
         USING DCMSTRT,XBTDCM      ESTABLISH DCM ADDRESS                04950002
         L     X8UCME,CSAUCM       ADDRESS UCM ENTRY                    04960002
         L     X9UCM,CSACTLM       ADDRESS UCM BASE                     04970002
         L     XARDCM,UCMXB        ADDRESS RESIDENT DCM                 04980002
         L     XBTDCM,DCMADTRN     ADDRESS PAGEABLE DCM                 04990002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD ENTRIES            05000002
         MVI   DCMTREN1,CE         MOVE IN MODULE ID OF                 05010002
         MVI   DCMTREN2,C2         'E2' FOR IEECVET2                    05020002
         SPACE 2                                                        05070002
*/*      S     GETLOCK:OBTAIN LOCAL AND CROSS MEMORY LOCKS*/            05080002
**********************************************************************  05100002
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           05150002
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         05200002
         SPACE 2                                                        05250002
*/*      D     (NO,,YES,FINISH)    RETURN FROM DISP 3 */                05260002
*********************************************************************** 05300002
*    CHECK IF ENTRY IS FROM DISPLAY 3 MODULE                            05650002
         TM    DCMCOM3,DCMCDSP3    HAS WORK BEEN DONE                   05700002
         BO    FINISH              YES--GO MOP UP                       05750002
         SPACE 2                                                        05760002
*/*      P     CLEAR FLAGS AND INITIALIZE I/O PARAMETERS */             05770002
*********************************************************************** 05780002
         MVI   DCMUTILT,N0         ZERO OUT INTERNAL FLAGS              05850002
         SR    X0ZERO,X0ZERO       GET REG OF ZEROS                     05900002
         STH   X0ZERO,DCMBYTCT     ZERO WRITE LENGTH                    05950002
         MVI   DCMLINEN,N0         ZERO WRITE ADDRESS                   06000002
         STH   X0ZERO,DCMBADLN     ZERO OUT WRITE BUFFER ADDR           06050002
         SPACE 2                                                        06100002
*/*      D     (YES,,NO,ZAPITOUT)  DYNAMIC DISPLAY ON SCREEN */         06150002
*********************************************************************** 06200002
         L     X2SSCT,DCMADSEC     GET SSCT ADDR                        06350002
NEXTSSCT EQU   *                                                        06400002
         TM    N0(X2SSCT),DCMSECDD IS DYNAMIC DISPLAY BIT ON            06450002
         BO    SAVEDYNM            YES-SAVE AREA ADDR OF LINE           06500002
         TM    N0(X2SSCT),DCMSECST IS IT END OF TABLE                   06550002
         BO    ZAPITOUT            YES-SET PT TO 0                      06600002
         LA    X2SSCT,N1(X2SSCT)   NO-- PT TO NEXT SSCT ENTRY           06650002
         B     NEXTSSCT                                                 06700002
         SPACE 2                                                        06702002
*/*      P     (,DISPTST) SAVE ADDR OF SCT ENTRY FOR DYN DISP */        06704002
*********************************************************************** 06706002
SAVEDYNM EQU   *                                                        06710002
         S     X2SSCT,DCMADSEC       GET DISPLACEMENT FROM START        06720002
         MH    X2SSCT,DCMSCTCN       MPY BY SCT ENTRY LENGTH            06730002
         A     X2SSCT,DCMAMTAB       ADD START OF SCT TABLE ADDR        06740002
         ST    X2SSCT,DCMDSAV+N16    SAVE ADDR FOR LATER                06742002
         B     DISPTST                                                  06744002
         SPACE 2                                                        06746002
*/*ZAPITOUT: P ZERO DYNAMIC DISPLAY SCT ADDRESS  */                     06748002
*********************************************************************** 06748402
ZAPITOUT EQU   *                                                        06750002
         ST    X0ZERO,DCMDSAV+N16  SET DYNAMIC DISPLAY PT=0             06850002
         SPACE 2                                                        06900002
*/*DISPTST: D (NO,,YES,DISPTST1) IS SCREEN FULL */                      06920002
*********************************************************************** 06930002
DISPTST  EQU   *                                                        06950002
         TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL                       07050002
         BO    DISPTST1            YES, CONTINUE                        07100002
         SPACE 2                                                        07102002
*/*      R     BRANCH IEECVFT2  */                                      07104002
*********************************************************************** 07106002
         L     XFBRANCH,DCMNDSP3   LOAD DISPLAY 3 ADDRESS               07110002
         BR    XFBRANCH            EXIT TO IEECVFT2                     07120002
         SPACE 2                                                        07130002
DISPTST1 EQU   *                                                        07300002
DISPTST3 EQU   *                                                        07450002
*   8 LINES DELETED HERE FOR APAR OZ02835                               07500000
         SPACE 2                                                        07580002
*/*NEXTEST: D (YES,,NO,NOAUTO)     DOES DEL EQUAL YES */                07590002
*********************************************************************** 07592002
NEXTEST  EQU   *                                                        07600002
         CLI   DCMDEL,Y            IS DEL=Y                             07650002
         BNE   NOAUTO              NO TEST FOR ROLL MODE                07700002
         CLI   DCMRQDEL,BLANK      YES IS A DEL REQUEST PENDING         07750002
         BNE   NOAUTO              YES TEST FOR TIMER DEFAULT           07800002
         SPACE 2                                                        07810002
*/*      D (NO,,YES,MSGMOD) HAS AUTO DELETE BEEN TRIED */               07820002
*********************************************************************** 07830002
         TM    DCMDSTAT,DCMDSAUT   HAS AUTO DEL BEEN TRIED              07850002
         BO    MSGMOD              YES WRITE MSG TO SCREEN              07900002
         SPACE 2                                                        07910002
*/*      R     BRANCH IEECVET9  */                                      07920002
*********************************************************************** 07930002
         OI    DCMDSTAT,DCMDSAUT   IND AUTO DEL TRIED                   07950002
         OI    DCMCOM1,DCMCOMAU    IND TRY AUTO DEL                     08000002
         NI    DCMCMSG1,N255-DCMUNMSG  TURN OFF UNVIEW MSG BIT          08050002
         L     XFBRANCH,DCMNDEL4   LOAD DELETE 4 ADDRESS                08100002
         BR    XFBRANCH            EXIT TO IEECVET9                     08150002
         SPACE 2                                                        08160002
*/*NOAUTO: D (NO,,YES,ROLLMODE)    ARE WE IN ROLL MODE */               08170002
*********************************************************************** 08180002
NOAUTO   EQU   *                                                        08200002
         CLI   DCMDEL,R            ARE WE IN ROLL MODE                  08250002
         BE    ROLLMODE            YES, TEST FOR PROPER EXIT            08300002
         SPACE 2                                                        08302002
*/*MSGMOD: D (YES,,NO,IOEXIT) WRITE UNVIEWABLE MESSAGE MESSAGE */       08304002
*********************************************************************** 08306002
MSGMOD   EQU   *                   WRITE WARNING MESSAGE                08310002
         TM    DCMCMSG1,DCMUNMSG   UNVIEWABLE MESSAGES                  08320002
         BNO   IOEXIT              NO,WRITE SCREEN FULL                 08330002
         SPACE 2                                                        08332002
*/*      R     BRANCH IEECVETD  */                                      08334002
*********************************************************************** 08336002
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               08340002
         BR    XFBRANCH            EXIT TO IEECVETD                     08342002
         SPACE 2                                                        08344002
*/*ROLLMODE: P TURN ON DCM SET TIMER FLAG */                            08346002
*********************************************************************** 08348002
ROLLMODE OI    DCMR2FLG,DCMRXTMR   SET R DCM TIMER FLAG                 08350002
         CLC   DCMASCRN(N4),DCMWTBUF    DO DISPLAYS FILL SCRN MH Y02140 08352002
         BL    REGPROC             NO, GO AHEAD               MH Y02140 08354002
         NI    DCMR2FLG,X'FF'-DCMRXTMR  YES, DONT ISSUE STMER MH Y02140 08356002
         SPACE 2                                                        08360002
*/*      D     (YES,,NO,DISP2)     WAS UNVIEWABLE MSG FLAG ON */        08370002
*********************************************************************** 08380002
REGPROC  TM    DCMCMSG1,DCMUNMSG WAS UNVIEW. MSG BIT TURNED ONMH Y02140 08400002
         BNO   DISP2               NO, NOT FROM PROC 1 FOR ROLL         08450002
         SPACE 2                                                        08460002
*/*      P     SET ON ROLL FLAG FOR T/I ROUTINE */                      08470002
*********************************************************************** 08480002
         OI    DCMR2FLG,DCMRXUNV   TURN ON ROLL BIT FOR T-I             08500002
         SPACE 2                                                        08510002
*/*DISP2: R     BRANCH IEECVET3  */                                     08520002
*********************************************************************** 08530002
DISP2    EQU   *                                                        08550002
         L     XFBRANCH,DCMNDSP2   LOAD DISPLAY 2 ADDRESS               08600002
         BR    XFBRANCH            EXIT TO IEECVET3                     08610002
         SPACE 2                                                        08660002
*/*FINISH: D   (NO,,YES,DISPTST1)  IS MESSAGE WAITING */                08710002
*********************************************************************** 08760002
FINISH   EQU   *                                                        09050002
         NI    DCMCOM3,N255-DCMCDSP3 TURN OFF WORK DONE FLAG            09300002
         TM    DCMCMSG1,DCMMSGWT   Q. IS MSG WAITING                    09350002
         BO    DISPTST1            YES-                                 09400002
         CLI   DCMIOCM1,N0         ANY I/O TO DO            JE @ZA00507 09402023
         BNE   IOEXIT              YES, GO DO IT            JE @ZA00507 09404023
         SPACE 2                                                        09410002
*/*      D     (NO,,YES,IOEXIT)   ANY I/O TO DO */                      09420023
*/*      D     (NO,,YES,DISPTST1)   IS SCREEN FULL BIT ON */            09422023
*********************************************************************** 09430002
         TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL BIT ON                09450002
         BO    DISPTST1            YES-                                 09500002
         SPACE 2                                                        09510002
*/*      D     (NO,,YES,NEXTEST)   UNVIEWABLE MESSAGE */                09620002
*********************************************************************** 09630002
         TM    DCMCMSG1,DCMUNMSG   IS THERE AN UNVIEWABLE MESSAGE       09650002
         BO    NEXTEST             YES CHECK EXIT POSSIBILITIES         09700002
         SPACE 2                                                        09710002
*/*      D (YES,CHKROLL,NO,FINISH1) CONSOLE IN ROLL MODE */             09720002
*********************************************************************** 09730002
         CLI   DCMDEL,R            CONSOLE IN ROLL MODE                 09750002
         BNE   FINISH1             NO, READY TO EXIT                    09800002
         SPACE 2                                                        09802002
*/*CHKROLL: D (YES,DISP2,NO,FINISH1) DCM SET TIMER FLAG ON */           09804002
*********************************************************************** 09806002
CHKROLL  EQU   *                   SEE IF SET TIMER NECESSARY           09810002
         TM    DCMR2FLG,DCMRXTMR   SET TIMER                            09820002
         BO    DISP2               YES, GO TO DISPLAY 2                 09840002
         SPACE 2                                                        09842002
*/*FINISH1: D (YES,IOEXIT,NO,AROUND) ANY I/O TO DO */                   09844002
*********************************************************************** 09846002
FINISH1  EQU   *                   DETERMINE PROPER EXIT                09850002
         CLI   DCMIOCM1,N0         ANY IO TO DO                         09900002
         BE    AROUND              NO SKIP IO EXIT                      09950002
         SPACE 2                                                        09960002
*/*IOEXIT: R     BRANCH I/O ROUTINE  */                                 09970002
*********************************************************************** 09980002
IOEXIT   EQU   *                                                        10000002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              10050002
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         10100002
         SPACE 2                                                        10150002
*/*AROUND: D   (NO,,YES,DISPTST3) ANY INT REQ MESSAGES ON SCREEN */     10200002
AROUND   EQU   *                                                        10350002
*    2 LINES DELETED HERE                                   ZA02835     10400000
         SPACE 2                                                        10460002
*/*      D     (YES,,NO,PEXIT)     ECB POSTED FOR TIMER  */             10470002
*********************************************************************** 10480002
         CLI   UCMECB,BLANK        IS ECB POSTED FOR TIMER              10500002
         BNE   PEXIT               NO, EXIT TO PROCESSOR 1              10550002
         CLI   UCMECB+N3,N255      IS LOW ORDER BYTE FF                 10600002
         BNE   PEXIT               NO, EXIT TO PROCESSOR 1              10650002
         SPACE 2                                                        10660002
*/*      P     CLEAR ECB  */                                            10670002
*********************************************************************** 10680002
         XC    UCMECB(N1),UCMECB        ZERO ECB                        10700002
         SPACE 2                                                        10710002
*/*PEXIT: R    BRANCH IEECVET1  */                                      10720002
*********************************************************************** 10730002
PEXIT    EQU   *                   CHECK FOR MORE WORK TO DO            10750002
*                                  FOR THIS CONSOLE                     10800002
         L     X1PARM,DCMCXSVE     PASS CXSA ADDRESS IN REG 1           10850002
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  10900002
         BR    XFBRANCH            EXIT TO IEECVET1                     10950002
         SPACE 2                                                        11000002
*/*IEECVET2: END */                                                     11050002
*********************************************************************** 11850002
         EJECT                                                          11900002
*********************************************************************** 11950002
***                        EQUATES                                   ** 12000002
****                                                               **** 12050002
*********************************************************************** 12100002
CE       EQU   C'E'                1ST CHARACTER OF CSECT ID            12150002
C2       EQU   C'2'                2ND CHARACTER OF CSECT ID            12200002
N0       EQU   0                   FIELD INCREMENT                      12500002
N1       EQU   1                   FIELD INCREMENT                      12550002
N3       EQU   3                   FIELD INCREMENT                      12650002
N4       EQU   4                   FULLWORD LENGTH                      12700002
N16      EQU   16                  FIELD INCR                           12950002
N255     EQU   255                 USED TO TURN OF SELECTED BITS        13100002
BLANK    EQU   C' '                BLANK COMPARAND                      13200002
Y        EQU   C'Y'                CHARACTER FOR COMPARE                13350002
R        EQU   C'R'                R COMPARAND                          13400002
*********************************************************************** 14000002
         TITLE 'IEECVET2 DISPLAY 1 - - RESIDENT DCM'                    16760002
         IEERDCM                                                        16900002
         TITLE 'IEECVET2 DISPLAY 1 - - PAGEABLE DCM'                    16910002
         IEETDCM                                                        17050002
         TITLE 'IEECVET2 DISPLAY 1 - - CXSA '                           17060002
         IHACTM  CXSA                                                   18100002
         TITLE 'IEECVET2 DISPLAY 1 - - UCM '                            18160002
         IEECUCM  FORMAT=NEW                                            18300002
         END                                                            19700002
./  ADD  SSI=33250099,NAME=IEECVET3
IEECVET3 CSECT                                                          00050002
*A162804,162846,162850                                        MH Y02137 00060002
*D162724-162803                                               MH Y02137 00070002
*C 076000                                                     MB YM4087 00080002
*A 161790,161929                                              MB YM1955 00100002
*C 036000                                                     MB YM1955 00150002
*A 035600,044100,069100,069200,069600                         MB YM1956 00200002
*C 069500-070500,162882                                       MB YM1956 00250002
*D 065500,066000,162405,162435,162485                         MB YM1956 00300002
         TITLE 'IEECVET3 DISPLAY 2'                                     00350002
*********************************************************************** 00400002
*                                                                       00450002
* STATUS       CHANGE LEVEL=0                                           00500002
*                                                                       00550002
* FUNCTION     WHEN MESSAGES DISPLAYED ARE ACCEPTED REPLIES, THIS       00600002
*              ROUTINE WILL GET CONTROL TO MARK THE ACCEPTED REPLY AND  00650002
*              ITS ASSOCIATED WTOR WITH VERTICAL BAR.                   00700002
*                                                                       00750002
* ENTRY POINT  IEECVET3                                                 00800002
*                                                                       00850002
* INPUT        INDICATION OF ACCEPTED REPLIES IN SCREEN CONTROL TABLE   00900002
*                                                                       00950002
* OUTPUT       MARKING OF ACCEPTED REPLIES AND ASSOCIATED WTORS         01000002
*                                                                       01050002
* EXTERNAL REFERENCES NONE                                              01100002
*                                                                       01150002
* EXITS-NORMAL  IEECVET1 PROCESSOR                                      01200002
*      -ERROR   NONE                                                    01250002
*                                                                       01300002
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         01350002
*                                                                       01400002
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      01450002
*                                                                       01500002
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      01550002
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       01600002
*              CHARACTER SET.                                           01650002
*                                                                       01700002
* NOTES:                                                                01800002
*    CHANGES FOR SDS/DIDOCS LINE ITEMS S21002,S21003, RESPECTIVELY:     01850002
*    1.  EXTRA LOAD INSTRUCTION TO ACCESS TDCM.                         01900002
*                                                                       01950002
*    2.  CHANGE SEQUENCE OF BRANCH INSTRUCTIONS AT PREPEXIT.            02000002
*                                                                       02050002
*    3.  IF A MESSAGE AREA BUFFER LINE CONTAINS JUNK, TO TURN OFF       02100002
*       JUNK BIT AND BLANK LINE, BEFORE MOVING TEXT INTO LINE FROM WQE. 02150002
*                                                                       02200002
*********************************************************************** 02400002
         EJECT                                                          02450002
*********************************************************************** 02500002
*                                                                       02550002
*    REGISTER USAGE                                                     02600002
*********************************************************************** 02650002
*                                                                       02700002
XFBRANCH EQU   15                                                       02750002
XFWORK   EQU   15                                                       02800002
XERTRN   EQU   14                                                       02850002
XEWORK   EQU   14                                                       02900002
XDWORK   EQU   13                                                       02950002
XCPBASE  EQU   12                                                       03000002
XBTDCM   EQU   11                                                       03050002
XARDCM   EQU   10                                                       03100002
X9UCM    EQU   9                                                        03150002
X8UCME   EQU   8                                                        03200002
X7SUB    EQU   7                                                        03250002
X6DOM    EQU   6                                                        03300002
X5SCT    EQU   5                                                        03350002
X4MSG    EQU   4                                                        03400002
X3WORK   EQU   3                                                        03450002
X2WORK   EQU   2                                                        03500002
X1PARM   EQU   1                                                        03600002
X0WORK   EQU   0                                                        03650002
         EJECT                                                          04050002
*********************************************************************** 04100002
***                                                                 *** 04150002
*                        EQUATES                                      * 04200002
***                                                                 *** 04250002
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            04260002
ID2      EQU   C'3'                2ND CHARACTER OF CSECT ID            04270002
ONQUE    EQU   X'80'               TIMER ELEMENT NOT ON QUEUE    S21003 04300002
ISSUETIM EQU   X'80'               STIMER BIT IN BASE DCM               04350002
LOWR     EQU   C'R'                LOWER CASE R                         04400002
DOMLN    EQU   6                   LENGTH OF DOM TAB ENTRY    MB YM1956 04410002
N0       EQU   0                   NUMBER                               04450002
N1       EQU   1                   NUMBER                               04500002
N2       EQU   2                   NUMBER                               04550002
N3       EQU   3                   NUMBER                               04600002
N4       EQU   4                   NUMBER                               04650002
N5       EQU   5             FIELD INCREMENT                            04700002
N7       EQU   7                   NUMBER                     MC  M1457 04750002
N16      EQU   16                  NUMBER                               04900002
N22      EQU   22                  NUMBER                     MC  M1457 05000002
N28      EQU   28                  NUMBER                               05050002
N120     EQU   120                 DISPLACEMENT OF TCBTME        S21003 05100002
N255     EQU   255                 NUMBER                               05150002
N6       EQU   6                   NUMBER                               05300002
N21      EQU   21                  NUMBER                               05450002
F0       EQU   C'0'                CHARACTER                  MC  M1457 05750002
SLASH    EQU   C'|'                SLASH FOR AUTOMATIC DELETE           05800002
R        EQU   C'R'                R FOR REPLY COMPARISOR               05850002
BLANK    EQU   C' '                BLANK                                05900002
Y        EQU   C'Y'                LETTER Y                             05950002
COMMA    EQU   C','                COMMA FOR SPLIT POINT                06000002
*********************************************************************** 06100002
         EJECT                                                          06150002
*********************************************************************** 06200002
*                                                                       06250002
***                                                                 *** 06300002
*                        INITIALIZE PROGRAM                           * 06350002
***                                                                 *** 06400002
         BALR  XCPBASE,N0         SET UP                                06450002
         USING *,XCPBASE                 PROGRAM ADDRESSABILITY         06500002
         B     BEGIN               BRANCH AROUND PATCH AREA             06510002
ICATCH   DC    CL72'IEECVET3'      EYECATCHER AND FIELD MAINTENANCE     06520002
BEGIN    EQU   *                   END OF PATCH AREA                    06530002
         USING CXSA,X1PARM         ESTABLISH CXSA ADDRESSABILITY        06550002
         L     X9UCM,CSACTLM          GET UCB POINTER                   06750002
         USING UCM,X9UCM              DECLARE IT                        06800002
         L     X8UCME,CSAUCM        GET UCM ENTRY ADDRESS               06910002
         USING UCMLIST,X8UCME       DECLARE IT                          06920002
         L     XARDCM,UCMXB         GET POINTER TO RES DCM              06950002
         DROP  X8UCME               DONT NEED UCM ENTRY PTR             06960002
         USING DCMTSRT,XARDCM          USE SAME REG FOR RES DCM         07000002
         L     XBTDCM,DCMADTRN    GET BASE FOR PAGEABLE DCM             07050002
         USING DCMSTRT,XBTDCM              DECLARE IT                   07100002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      07110002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    07120002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      07130002
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          07140002
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        07142002
         TM    DCMR2FLG,DCMRXTMR  SET TIMER                             07500002
         BO    SETIMER            YES SEE IF TIMER IS SET               07550002
         B     IOEXIT              FALSE ENTRY EXIT           MB YM4087 07600002
MSGEXIT  EQU   *                                                        14450002
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               14500002
         B     DISPEX              EXIT TO IEECVETD                     14550002
PROCEXIT EQU   *                                                        14560002
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  14570002
         B     DISPEX              EXIT TO IEECVET1                     14580002
IOEXIT   EQU   *                                                        14600002
         TM    DCMCMSG1,DCMUNMSG   WRITE UNVIEWABLE MSG                 14650002
         BO    MSGEXIT            EXIT TO MSG MODULE                    14700002
         CLI   DCMIOCM1,N0         ANY IO TO DO                         14750002
         BE    PROCEXIT            NO EXIT                              14800002
         L     XFBRANCH,DCMIORTN   YES GO TO IO RTN                     14850002
DISPEX   EQU   *                                                        14900002
         L     X1PARM,DCMCXSVE     PASS CXSA ADDRESS IN REG 1           14950002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             15000002
SETIMER  EQU   *                                                        16240102
         NI    DCMR2FLG,N255-DCMRXTMR-DCMRXRLL  FLAGS OFF               16245502
         L     X7SUB,DCMSUBAD       LOAD POINTER                        16246502
         USING SUBDSECT,X7SUB       ADDRESS SUB                         16249502
         L    X7SUB,SUBPBASE        ADDRESS BASE DCM                    16252502
         DROP X7SUB                                                     16262502
         USING SUBDCMB,X7SUB                                            16264502
         TM   DCMIND,DCMTMRST      IS AN STIMER IN EFFECT               16268402
         BZ    TIMESET             BRANCH NO TO SET TIMER               16270402
         L     XDWORK,UCMPXA       POINT TO COMM TASK TCB     MH Y02137 16280402
         L     XDWORK,N120(XDWORK)   GET TQE POINTER                    16284202
         LTR   XDWORK,XDWORK       VALID POINTER              MH Y02137 16284602
         BZ    TIMESET             NO, RESTART TIMER          MH Y02137 16285002
         TM    N0(XDWORK),ONQUE     IS ELEMENT ON TIMER QUEUE           16286202
         BZ    IOEXIT              YES GO STRAIGHT TO IO                16288202
TIMESET  EQU   *                                                        16298502
         NI    DCMDSTAT,N255-DCMDSINR   TURN OFF INT REQD               16308502
         LA    XDWORK,DCMSTART       GET EXIT ADDRESS                   16308602
         STIMER REAL,(XDWORK),BINTVL=(X7SUB)                            16308702
         OI    DCMIND,DCMTMRST          TURN ON STIMER BIT              16312102
         DROP X7SUB                                                     16314102
GETOUT   EQU   *                                                        16314502
         B     IOEXIT                   GO TO IO ROUTINE                16314902
         EJECT                                                          19900002
*********************************************************************** 19950002
***                                                                 *** 20000002
*                   CONSTANTS                                         * 20050002
***                                                                 *** 20100002
*********************************************************************** 20150002
H126     DC    H'126'              NUMBER                               20200002
TWO      DC    H'2'                NUMBER                               20250002
H143     DC    H'143'              FIELD OF 2 LINES                     20300002
HSIX     DC    H'6'                FIELD INCREMENT                      20350002
EIGHT    DC    H'8'                CONSTANT                             20400002
H1       DC    H'1'                CONSTANT                             20450002
CON80    DC    H'80'                    BXLE INCREMENT                  20500002
FOUR     DC    H'4'                FIELD CONSTANT                       20660002
         EJECT                                                          20700002
*********************************************************************** 20750002
*        FLOW CHART STATEMENTS                                        * 20800002
*********************************************************************** 20850002
*/*IEECVET3: CHART */                                                   20900002
*/*%A: E (,%B) ENTRY POINT */                                           20950002
*/*%B: P (,%C) PROGRAM INITIALIZATION */                                21000002
*/*%C: D (YES,SPLITMSG,NO,%D) ENTRY TO SPLIT MESSAGES */                21050002
*/*%D: D (YES,DISPCONT,NO,%E) ENTRY FOR ACCEPTED REPLY */               21100002
*/*%E: D (YES,SETIMER,NO,DISPEX) SET TIMER */                           21150002
*/*DISPCONT: P (,FIND) INIT MESSAGE AND SCT POINTERS */                 21200002
*/*FIND: D (YES,TEST,NO,TESTEND) IS MESSAGE IN LINE */                  21250002
*/*TESTEND: D (YES,PREPEXIT,NO,%F) END OF TABLE */                      21300002
*/*%F: P (,FIND) ADJUST POINTERS */                                     21350002
*/*TEST: D (YES,%G,NO,TESTEND) IS THIS AN ACCEPTED REPLY */             21400002
*/*%G: D (YES,DONTMARK,NO,%H) DELETE REQUEST PENDING */                 21450002
*/*%H: P (,DONTMARK) FLAG MESSAGE */                                    21500002
*/*DONTMARK: P (,LOOP1) INIT FOR SCANNING */                            21550002
*/*LOOP1: D (YES,%I,NO,NEXTMSG) IS THIS A WTOR */                       21600002
*/*%I: D (YES,FLAG,NO,NEXTMSG) DO THE IDS MATCH */                      21650002
*/*NEXTMSG: D (YES,%J,NO,REPLY) DID WE FIND WTOR */                     21700002
*/*%J: P (,LOOP1) ADJUST POINTERS */                                    21750002
*/*REPLY: P (,REPLY1) INIT POINTERS FOR SCANNING */                     21800002
*/*REPLY1: D (YES,FOUNDR,NO,%K) IS THIS CHARACTER AN R */               21850002
*/*%K: D (YES,TESTEND,NO,KICKLINE) END OF LIST */                       21900002
*/*KICKLINE: P (,REPLY1) ADJUST POINTERS */                             21950002
*/*FLAG: P (,%L) INIT CERTAIN DCM FIELDS */                             22000002
*/*%L: D (YES,NOSLASH,NO,%M) DELETE REQUEST PENDING */                  22050002
*/*%M: P (,NOSLASH) MARK AS AUTO DELETABLE */                           22100002
*/*NOSLASH: D (YES,%N,NO,KICKLINE) IS THIS LINE CONTINUED */            22150002
*/*%N: P (,%O) GET NEXT LINE */                                         22200002
*/*%O: D (YES,DONTSLSH,NO,%P) DELETE REQUEST PENDING */                 22250002
*/*%P: P (,DONTSLSH) FLAG AS AUTO DELETABLE */                          22300002
*/*DONTSLSH: P (,KICKLINE) TURN OFF ACTION FLAGS  */                    22350002
*/*FOUNDR: P (,LOOK) INIT FOR SCANNING */                               22400002
*/*LOOK: D (YES,COMPARE,NO,%Q) IS THIS BYTE A NUMBER */                 22450002
*/*%Q: D (YES,KICKLINE,NO,LOOK) ARE WE DONE */                          22500002
*/*COMPARE: D (YES,%R,NO,KICKLINE) DO IDS MATCH */                      22550002
*/*%R: P (,KICKLINE) MARK AS AUTO DELETABLE */                          22600002
*/*PREPEXIT: D (YES,%S,NO,UNVTST) IS SCREEN FULL */                     22650002
*/*%S: D (YES,%T,NO,NEXTEST) ANY INT REQ MSG ON SCREEN */               22700002
*/*%T: D (YES,NEXTEST,NO,DEL2EXIT) HAS INT DELETE BEEN TRIED */         22750002
*/*NEXTEST: D (YES,%U,NO,ROLLTST) DOES DELETE EQUAL YES */              22800002
*/*%U: D (YES,ROLLTST,NO,%V) DELETE REQUEST PENDING */                  22850002
*/*%V: D (YES,IOEXIT,NO,%W) HAS DELETE BEEN TRIED */                    22900002
*/*%W: P (,DISPEX) INIT FOR DELETE 4 EXIT */                            22950002
*/*UNVTST: D (YES,NEXTEST,NO,ROLLTST) IS THERE AN UNVIEWABLE MESSAGE */ 23000002
*/*ROLLTST: D (YES,SETIMER,NO,IOEXIT) ARE WE IN ROLL MODE */            23050002
*/*DEL2EXIT: P (,DISPEX) INIT FOR DELETE 2 EXIT */                      23100002
*/*MSGEXIT: P (,DISPEX) INIT FOR MESSAGE MODULE EXIT */                 23150002
*/*IOEXIT: D (YES,MSGEXIT,NO,%X) WRITE UNVIEWABLE MESSAGE MESSAGE */    23200002
*/*%X: D (YES,%Y,NO,DISPEX) ANY I/O TO DO */                            23250002
*/*%Y: P (,DISPEX) INIT FOR I/O ROUTINE EXIT */                         23300002
*/*DISPEX: R XCTL TO PROPER DIDOCS MODULE */                            23350002
*/*SPLITMSG: P (,GOMOVE1) SPLIT MESSAGE */                              23400002
*/*GOMOVE1: P (,MOVE) MOVE BOTH PARTS INTO DCM MESSAGE AREA */          23450002
*/*MOVE: P (,%Z) MARK DOM AND SCT TABLES */                             23500002
*/*%Z: R RETURN TO CALLER */                                            23550002
*/*SETIMER: P (,%AA) SET OFF TIMER FLAGS */                             23600002
*/*%AA: D (YES,%BB,NO,GETOUT) SHOULD TIMER BE ISSUED */                 23650002
*/*%BB: P (,GETOUT) ISSUE TIMER MACRO */                                23700002
*/*GETOUT: P (,IOEXIT) INIT FOR I/O ROUTINE EXIT */                     23750002
*/*IEECVET3: END */                                                     23800002
         EJECT                                                          23850002
****                                                                *** 23900002
*                    DSECTS                                           * 23950002
***                                                                 *** 24000002
         IEERDCM                                                        24050002
         EJECT                                                          24150002
         IEETDCM                                                        24200002
         EJECT                                                          24300002
         IHACTM  CXSA                                                   24400002
         EJECT                                                          24500002
         IHAWQE  DSECT=YES                                              24600002
         EJECT                                                          24650002
         IEECUCM  FORMAT=NEW                                            24750002
         EJECT                                                          24800002
SUBDSECT DSECT                                                          24850002
         IEECSUB Y,N,N,N,N,Y                                            24900002
NUMBMASK EQU   X'F0'                   NUMBER MASK                      25250002
         END                                                            25300002
./  ADD  SSI=81030038,NAME=IEECVET4
* /* START OF SPECIFICATIONS ****************************************** 00100000
*                                                                       00150000
*01*  MODULE-NAME = IEECVET4                                            00200000
*                                                                       00250000
*01*  DESCRIPTIVE-NAME = COMMAND ROUTINE                                00300000
*                                                                       00350000
*01*  COPYRIGHT = NONE                                                  00400000
*                                                                       00450000
*01*  STATUS = CHANGE LEVEL 1 FOR VS2 RELEASE 2                         00500000
*                                                                       00510000
*     APARS FIXED --- ZA11437,ZA18576                                   00520000
*                                                                       00550000
*01*  FUNCTION = TO CANCEL THE COMMAND IN THE ENTRY AREA IN RESPONSE TO 00600000
*     A CANCEL ATTENTION,  OR ANALYZE THE CONTENTS OF THE ENTRY AREA IN 00650000
*     THE DCM WHEN A COMMAND IS ENTERED VIA THE KEYBOARD OR A PFK.      00700000
*     COMMANDS ARE CHECKED  FOR LENGTH, AND REWRITTEN TO THE ENTRY AREA 00750000
*     WITH A MESSAGE IN THE INSTRUCTION LINE IF TOO LONG.               00800000
*     IF  THE  COMMAND  IS  'K'  WITH NO OPERAND,  OR  A DELETE REQUEST 00850000
*     VERIFICATION, CONTROL IS GIVEN IMMEDIATELY  TO  THE PROPER DELETE 00900000
*     ROUTINE.  FOR REPLY COMMANDS,  THE REPLY ID IS CHECKED FOR ON THE 00950000
*     QUEUE OF  OUTSTANDING  OPERATOR  REQUESTS TO SEE IF IT WAS ISSUED 01000000
*     WITH A  ROUTING  CODE  OF 9.  IF SO,  THE TEXT OF THE  OPERATOR'S 01050000
*     REPLY IS SUPPRESSED.   A WTO IS ISSUED INDICATING NO HARD-COPY TO 01100000
*     COPY ALL COMMANDS  EXCEPT 'K' COMMANDS TO THE MESSAGE AREA OF THE 01150000
*     SCREEN.  SVC 34  IS ISSUED TO ENTER COMMANDS  INTO THE SYSTEM VIA 01200000
*     SCHEDULER PROCESSING.  ON RETURN FROM SVC 34 'K E,N' COMMANDS ARE 01250000
*     PROCESSED BY THIS ROUTINE.                                        01300000
*                                                                       01350000
*01*  NOTES = LOCAL AND CROSS-MEMORY LOCKS ARE RELEASED ON ENTRY VIA    01400000
*     THE FREELOCK SUBROUTINE ADDRESSED IN THE CXSA (CSAXC).            01450000
*                                                                       01500000
*02*    CHARACTER-CODE-DEPENDENCIES = EBCDIC CHARACTER REPRESENTATION   01550000
*       IS ASSUMED FOR ANALYZING THE CONTENTS OF THE ENTRY AREA.        01600000
*                                                                       01650000
*02*    DEPENDENCIES = THE SHORT FORM OF THE REPLY COMMAND SUPPORTED BY 01700000
*       JES2 IS RECOGNIZED BY THIS ROUTINE FOR TEXT SUPPRESSION  IF THE 01750000
*       FIRST CHARACTER OF A COMMAND IS NUMERIC.                        01800000
*                                                                       01850000
*02*    RESTRICTIONS = NONE                                             01900000
*                                                                       01950000
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES                     02000000
*                                                                       02050000
*02*    PATCH-LABEL = ICATCH A DC STATEMENT                             02100000
*                                                                       02150000
*01*  MODULE-TYPE = MODULE                                              02200000
*                                                                       02250000
*02*    PROCESSOR = ASSEMF-370R                                         02300000
*                                                                       02350000
*02*    MODULE-SIZE = X'41B' BYTES                                      02400000
*                                                                       02450000
*02*    ATTRIBUTES = REENTERABLE                                        02500000
*                                                                       02550000
*01*  ENTRY-POINT = IEECVET4                                            02600000
*                                                                       02650000
*02*    PURPOSE = THIS IS THE ONLY ENTRY POINT TO PERFORM ALL FUNCTIONS 02700000
*                                                                       02750000
*02*    LINKAGE = BALR                                                  02800000
*                                                                       02850000
*02*    INPUT = REGISTER 1 ADDRESSES THE CXSA                           02900000
*       SEE ALSO CONTROL BLOCKS USAGE                                   02950000
*                                                                       03000000
*02*    OUTPUT = REGISTER 1 ADDRESSES THE CXSA                          03050000
*       SEE ALSO CONTROL BLOCKS USAGE AND EXITS                         03100000
*                                                                       03150000
*02*    EXIT-NORMAL = IEECVETC - ASYNCHRONOUS ERROR ROUTINE             03200000
*       AFTER HANDLING A CANCEL DURING ASYNCHRONOUS ERROR PROCESSING.   03250000
*                                                                       03300000
*02*    EXIT-NORMAL = IEECVET8 - DELETE ROUTINE 3                       03350000
*                                                                       03400000
*02*    EXIT-NORMAL = IEECVET9 - DELETE ROUTINE 4                       03450000
*                                                                       03500000
*02*    EXIT-NORMAL = IEECVET1 - PROCESSOR ROUTINE                      03550000
*                                                                       03600000
*02*    EXIT-ERROR = IEECVETE - MESSAGE ROUTINE 2                       03650000
*                                                                       03700000
*01*  EXTERNAL-REFERENCES = NONE                                        03750000
*                                                                       03800000
*02*    ROUTINES = FREELOCK SUBROUTINE - DEFINED IN IEECVET1, AND       03850000
*       ADDRESSED BY WORD CSAXC OF THE CXSA ON ENTRY.                   03900000
*                                                                       03950000
*02*    DATA-SETS = NONE                                                04000000
*                                                                       04050000
*02*    DATA-AREA = NONE                                                04100000
*                                                                       04150000
*02*    CONTROL-BLOCKS = CXSA,UCM,WQE,CQE,RDCM,TDCM                     04200000
*                                                                       04250000
*01*  TABLES = NONE                                                     04300000
*                                                                       04350000
*01*  MACROS = EXECUTABLE - WTO, E-FORM                                 04400000
*              MAPPING - IHACTM  CXSA DSECT                             04450000
*                        IEECUCM UCM DSECT                              04500000
*                        IEERDCM RESIDENT DCM DSECT                     04550000
*                        IEETDCM PAGEABLE DCM DSECT                     04600000
*                        IEFUCBOB UCB DSECT                             04650000
*                        IHAORE OPERATOR REQUEST ELEMENT DSECT          04700000
*                        IHAWQE WQE DSECT                               04750000
*                                                                       04800000
*02*    ROUTINES = FREELOCK SUBROUTINE - DEFINED IN IEECVET1, AND       04850000
*       ADDRESSED BY WORD CSAXC OF THE CXSA ON ENTRY.                   04900000
*                                                                       04950000
**** END OF SPECIFICATIONS *******************************************/ 05000000
         TITLE 'IEECVET4 COMMAND   '                                    05050000
IEECVET4 CSECT                                                          05100000
*A136100,136200,136300                                        MH Y02446 05150000
*C136000,136500                                               MH Y02446 05200000
*********************************************************************** 05250000
*        REGISTER EQUATES                                               05300000
*********************************************************************** 05350000
*                                                                       05400000
XFBRANCH EQU   15        BRANCH EXIT TO OTHER ROUTINES                  05450000
XFQUOTEN EQU   15        ODD REG FOR DIVISION                           05500000
XELEN    EQU   14                                                       05550000
XERTRN   EQU   14        RETURN BRANCH REG                              05600000
XEREMAIN EQU   14        EVEN REG FOR DIVISION                          05650000
XDWORK   EQU   13                                                       05700000
XCPBASE  EQU   12        PROGRAM BASE REG                               05750000
XBTDCM   EQU   11        PAGEABLE DCM BASE REG                          05800000
XARDCM   EQU   10        RESIDENT DCM BASE REG                          05850000
X9SCNSRT EQU   9                                                        05900000
X9UCM    EQU   9         UCM BASE REG                                   05950000
X8UCME   EQU   8         UCM ENTRY BASE REG                             06000000
X7WQE    EQU   7         WQE BASE                                       06050000
X6ORE    EQU   6         ORE BASE                                       06100000
X5SCT    EQU   5         SCT ENTRY POINTER                              06150000
X4MSG    EQU   4         MESSAGE AREA TEXT POINTER                      06200000
X3END    EQU   3         END OF COMMAND                                 06250000
X2START  EQU   2         START OF COMMAND                               06300000
X2WORK   EQU   2         WORK REG                                       06350000
X1PARM   EQU   1         CXSA ADDRESS ON ENTRY AND EXIT                 06400000
X0       EQU   0                                                        06450000
X0WORK   EQU   0                                                        06500000
*********************************************************************** 06550000
*    INITIALIZE PROGRAM                                                 06600000
*********************************************************************** 06650000
         BALR  XCPBASE,N0          LOAD PROGRAM BASE REGISTER           06700000
         USING *,XCPBASE           ESTABLISH PROG ADDRESSABILITY        06750000
         B     BEGIN               BRANCH AROUND PATCH AREA             06800000
ICATCH   DC    CL72'IEECVET4'      EYECATCHER AND FIELD MAINTENANCE     06850000
BEGIN    EQU   *                   END OF PATCH AREA                    06900000
         USING CXSA,X1PARM         ESTABLISH CXSA ADDRESSABILITY        06950000
         USING UCMLIST,X8UCME      ESTABLISH UCMENTRY ADDRESSABILITY    07000000
         USING UCM,X9UCM           ESTABLISH UCM ADDRESSABILITY         07050000
         USING DCMTSRT,XARDCM      ESTABLISH R DCM ADDRESSABILITY       07100000
         USING DCMSTRT,XBTDCM      ESTABLISH DCM ADDRESS                07150000
         L     X8UCME,CSAUCM       UCM ENTRY BASE                       07200000
         L     X9UCM,CSACTLM       UCM BASE                             07250000
         L     XARDCM,UCMXB        RESIDENT DCM BASE                    07300000
         L     XBTDCM,DCMADTRN     PAGEABLE DCM BASE                    07350000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      07400000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    07450000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      07500000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          07550000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        07600000
         NI    DCMCOM3,N255-DCMVLPFK   TURN OFF PFK VERIFY BIT   S21003 07650000
         TM    DCMCOM1,DCMCANCL    Q. PERFORM A CANCEL                  07700000
         BNO   ENTRY               NO, ASSUME COMMAND ENTRY             07750000
         NI    DCMCOM1,N255-DCMCANCL   TURN OFF CANCEL FLAG             07800000
         TM    DCMR3FLG,DCMRXSCN   IS THIS CANCEL AFTER ASYN ERR        07850000
         BNO   NOTASYNC            NO                                   07900000
         NI    DCMR2FLG,N255-DCMRXSFL   NO SCREEN FULL IN R-DCM  S21003 07950000
NOTASYNC EQU   *                                                        08000000
         L     X4MSG,DCMASCRN      FIRST MESSAGE ADDRESS                08050000
         L     X5SCT,DCMAMTAB      SCT ADDRESS                          08100000
         TM    DCMDSTAT,DCMDSTNH   MSG NUMBERS HELD           MG  M2097 08150000
         BO    CANLOOP             YES, LEAVE NUMBERS         MG  M2097 08200000
         NI    DCMDSTAT,N255-DCMDSTNM   SET OFF NMBERING FLAG MG  M2097 08250000
CANLOOP  EQU   *                                                        08300000
         TM    N0(X5SCT),DCMMSGIN     MESSAGE IN THIS LINE              08350000
         BNO   CANSUBR             NO, LEAVE LOOP                       08400000
         NI    N0(X5SCT),N255-DCMMSGRD   TURN OF REMOVE MSG FLAG        08450000
         TM    DCMDSTAT,DCMDSTNH   NUMBERS HELD                         08500000
         BO    SKIPNUMR            YES, DON'T BLANK NUMBER              08550000
         MVC   N0(N2,X4MSG),CBLANK    NO, BLANK NUMBER                  08600000
         NI    DCMDSTAT,N255-DCMDSTNM   TURN OFF NUMBERING FLAG         08650000
SKIPNUMR EQU   *                                                        08700000
         MVI   N2(X4MSG),BLANK        BLANK POSITION 3                  08750000
         TM    N1(X5SCT),DCMMSGAC     ACTION MESSAGE                    08800000
         BNO   CANIF               NO                                   08850000
         SPACE 5                                                        08900000
*********************************************************************** 08950000
*                         OS/370R OPTION 1 AND 2 SECURITY CODE          09000000
*********************************************************************** 09050000
         TM    N1(X5SCT),DCMMSGPP     PROP. PROG. ACTION MSG            09100000
         BNO   SYSAST              NO PUT ASTERISK                      09150000
         MVI   N3(X4MSG),PPACT     SET AT SIGN FOR PP ACTION            09200000
         B     CANIF               NEXT CHECK                           09250000
SYSAST   EQU   *                                                        09300000
*********************************************************************** 09350000
         SPACE 5                                                        09400000
         MVI   N3(X4MSG),ASTER        YES, MARK WITH ASTERISK           09450000
CANIF    EQU   *                                                        09500000
         TM    N0(X5SCT),DCMMSGIF     INFORMATIONAL MESSAGE             09550000
         BNO   CANAUTO             NO                                   09600000
         MVI   N2(X4MSG),ISDASH       YES, MARK WITH DASH               09650000
CANAUTO  EQU   *                                                        09700000
         TM    N0(X5SCT),DCMMSGAD     MESSAGE AUTO DELETABLE            09750000
         BNO   CANLOOP2            NO                                   09800000
         MVI   N2(X4MSG),SLASH        YES, MARK WITH VERTICAL BAR       09850000
CANLOOP2 EQU   *                                                        09900000
         AH    X4MSG,DCMCORLN      BUMP TO NEXT LINE          MB YM4360 09950000
         AH    X5SCT,DCMSCTCN      AND NEXT SCT ENTRY         MB YM4360 10000000
         C     X5SCT,DCMADDRL      CHECK FOR END              MB YM4360 10050000
         BNH   CANLOOP             FLAG UNTIL END             MB YM4360 10100000
CANSUBR  EQU   *                                                        10150000
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS+DCMWRWRN SET WRITE  MB YM4360 10200000
         MVI   DCMLINEN,N1         START WRITE ON LINE ONE              10250000
         MVI   DCMRQDEL,BLANK      BLANK THE                  MB YM4360 10300000
         MVC   DCMRQDEL+N1(N7),DCMRQDEL DELETE REQUEST BUFFER MB YM4360 10350000
         TM    DCMCOM1,DCMCANCL    INTERNAL REQUEST           MB YM4360 10400000
         BNO   CANLP               NO, CHECK LP DELETE        MB YM4360 10450000
         NI    DCMCOM1,N255-DCMCANCL TURN OFF CANCEL REQUEST  MB YM4360 10500000
         B     SVC34               CONTINUE CMD PROCESSING    MB YM4360 10550000
CANLP    EQU   *                                              MB YM4360 10600000
         TM    DCMCOM1,DCMLPENT    WAS ERASE ENTERED WITH LP            10650000
         BNO   CANCURS             NO                                   10700000
         NI    DCMCOM1,N255-DCMLPENT YES, DON'T WRITE ENTRY AREA        10750000
         B     INSRT               EXIT                                 10800000
CANCURS  EQU   *                                                        10850000
*                                  WRITE MESSAGE AREA TO OUT-OF-        10900000
*                                  LINE MESSAGE,INSERT CURSOR,          10950000
*                                  REINITIALIZE + SHIFT INSTRUCT        11000000
*                                  LINE, BLANK ENTRY AREA               11050000
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS+DCMWRENT+DCMINSC+DCMWRWRN     11100000
INSRT    EQU   *                                                        11150000
         OI    DCMIOCM2,DCMBLENT                              MH Y02446 11200000
         TM    DCMIOCM3,DCMRTPFK   IS PFK PROCESSING          MH Y02446 11250000
         BO    SKIPINLN            YES, SKIP INST. LINE       MH Y02446 11300000
         OI    DCMIOCM2,DCMINSSH   INIT. INST. LINE           MH Y02446 11350000
SKIPINLN MVI   DCMCULNO,N1         CURSOR POSITION            MH Y02446 11400000
         MVI   DCMPOSCU,N1         POSITION 1 OF DCMENTRY               11450000
         TM    DCMTIMES,DCMTASYN   ASYNCHRONOUS ERROR MSG UP            11500000
         BNO   IOEXIT              NO, WRITE SCREEN                     11550000
         L     XFBRANCH,DCMNERRO   LOAD ASYNCH ERR ADDRESS              11600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 11650000
         BR    XFBRANCH            EXIT TO IEECVETC                     11700000
         EJECT                                                          11750000
ENTRY    EQU   *                                                        11800000
         L     X2START,DCMAENTR    GET PTR TO ENTRY AREA                11850000
         CLI   DCMIONDX,NDX2260    INPUT DEVICE A 2260                  11900000
         BNE   NORMTRAN            NO, JUST TRANSLATE FIRST            *11950000
               QUADRANT CHARACTERS TO BLANKS                            12000000
         TR    N0(N127,X2START),TAB2260   TRANSLATE OUT ANY 2260       *12050000
               SPECIAL CHARACTERS AS WELL                               12100000
         B     TSTLNG              CHECK COMMAND LENGTH                 12150000
NORMTRAN TR    N0(N127,X2START),TRTAB   TRANSLATE                       12200000
TSTLNG   CLI   N126(X2START),BLANK   CHAR 127 A BLANK                   12250000
         BE    LNGTHOK             YES, INPUT LENGTH OK                 12300000
         OI    DCMCMSG1,DCMELONG   INDICATE LENGTH TOO LONG             12350000
         L     XFBRANCH,DCMNMSG2   LOAD MESSAGE 2 ADDRESS               12400000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 12450000
         BR    XFBRANCH            EXIT TO IEECVETE                     12500000
LNGTHOK  EQU   *                                                        12550000
         L     X2START,DCMAENTR    LOCATE START OF AREA                 12600000
         LA    X3END,N125(X2START) SET END POINTER                      12650000
FIND1    CLI   N0(X2START),BLANK   IS THERE A LEADING BLANK             12700000
         BNE   FINDEND             NO, START OF COMMAND IS FOUND        12750000
         LA    X2START,N1(X2START) POINT TO NEXT CHARACTER              12800000
         B     FIND1               CONTINUE SCAN FOR START              12850000
FINDEND  EQU   *                                                        12900000
         CLI   N0(X3END),BLANK     IS THERE A TRAILING BLANK            12950000
         BNE   COMPLENG            NO, END OF COMMAND IS FOUND          13000000
         BCT   X3END,FINDEND       BACK UP ONE, AND CONTINUE            13050000
COMPLENG EQU   *                                                        13100000
         LR    XELEN,X3END         LAST BYTE OF COMMAND                 13150000
         SR    XELEN,X2START       ZERO ORIGIN LENGTH OF COMMAND        13200000
         BM    BLENT               LENGTH ZERO, DONE.         MB YM4360 13250000
         MVI   DCMINPUT,BLANK      INITIALIZE INPUT AREA                13300000
         MVC   DCMINPUT+N1(N125),DCMINPUT WITH BLANKS                   13350000
         EX    XELEN,CMDMOVE       MOVE COMMAND TO INPUT AREA           13400000
         LA    X3END,DCMINPUT(XELEN) POINT TO LAST CHARACTER            13450000
         LA    XDWORK,N5(XELEN)    LENGTH FOR SVC'S                     13500000
         ST    XDWORK,DCMDSAV      SAVE IT                              13550000
         STH   XDWORK,DCMINLGN     PLACE IT IN PARM LIST                13600000
         LA    XDWORK,DCMINPUT     START OPERAND SCAN                   13650000
ENDVERB  LA    XDWORK,N1(XDWORK)   LOCATE NEXT CHARACTER                13700000
         CR    XDWORK,X3END        PAST THE END OF THE COMMAND          13750000
         BL    NOTEND              NO, CHECK FOR END OF VERB            13800000
         LA    XDWORK,N1(XDWORK)   NO OPERAND TO BE FOUND               13850000
         B     CMDCHECK            CHECK FOR K OR R                     13900000
NOTEND   CLI   N0(XDWORK),BLANK    END OF COMMAND VERB                  13950000
         BNE   ENDVERB             NO KEEP LOOKING FOR END              14000000
STARTOP  LA    XDWORK,N1(XDWORK)   TRY NEXT CHARACTER                   14050000
         CLI   N0(XDWORK),BLANK    START OF OPERAND                     14100000
         BE    STARTOP             NO,SCAN OVER ANOTHER BLANK           14150000
         ST    XDWORK,DCMADOPN     SAVE OPERAND ADDRESS                 14200000
CMDCHECK EQU   *                                                        14250000
         MVI   DCMPACK,BLANK       BLANK AN EIGHT BYTE AREA             14300000
         MVC   DCMPACK+N1(N7),DCMPACK FOR INSPECTING THE COMMAND        14350000
         OC    DCMPACK(N8),DCMINPUT VERB IN UPPER CASE                  14400000
         CLC   DCMPACK(N2),K       IS VERB K                            14450000
         BE    PROC1               YES, CHECK FOR DELETE VERIFICATION   14500000
         CLC   DCMPACK(N8),CONTROL IS VERB CONTROL                      14550000
         BE    PROC1               YES, CHECK FOR DELETE VERIFICATION   14600000
         CLC   DCMPACK(N3),MR      IS VERB MR                 MB YM4360 14650000
         BE    SVC34               YES, SKIP WTO FOR COMMAND  MB YM4360 14700000
         CLC   DCMPACK(N6),MSGRT   IS VERB MSGRT              MB YM4360 14750000
         BE    SVC34               YES, SKIP WTO FOR COMMAND  MB YM4360 14800000
         CLC   DCMPACK(N2),R       IS VERB R                            14850000
         BE    RPYNUM              YES, CHECK REPLY ID                  14900000
         CLC   DCMPACK(N6),REPLY   IS VERB REPLY                        14950000
         BE    RPYNUM              YES, CHECK REPLY ID                  15000000
         LA    XDWORK,DCMINPUT     RESET OPERAND PTR TO START OF VERB   15050000
         B     NUMSTART            SEE IF COMMAND STARTS WITH REPLY ID  15100000
*                                  THE FOLLOWING CODE CATCHES K         15150000
*                                  BY ITSELF OR K FOR VERIFICATION OF   15200000
*                                  A DELETE REQUEST. IF FOUND,          15250000
*                                  SVC 34 IS NOT ISSUED. INSTEAD        15300000
*                                  THE APPROPRIATE DIDOCS MODULE        15350000
*                                  IS GIVEN CONTROL.                    15400000
*                            NOTE: THIS CODE WILL HAVE TO BE            15450000
*                                  REMOVED IF IT BECOMES POSSIBLE       15500000
*                                  TO ROUTE THESE COMMANDS.             15550000
*                                  XDWORK HAS ADDR OF FIRST CHARACTER   15600000
*                                  OF THE K COMMAND OPERAND             15650000
PROC1    EQU   *                                                        15700000
         L     X2START,DCMAENTR    ADDRESS START OF ENTRY AREA          15750000
         MVI   N0(X2START),BLANK   MOVE BLANKS INTO ENTRY AREA          15800000
         MVC   N1(N126,X2START),N0(X2START) FOR 127 BYTES               15850000
         OC    N0(N126,X2START),DCMINPUT TRANSLATE COMMAND THERE        15900000
         CLI   N0(XDWORK),BLANK   BLANK OPERAND                         15950000
         BNZ   VERIFY              NO, CHECK FOR DELETE VERIFICATION    16000000
         LA    X2START,DCMINPUT    GET INPUT AREA PTR          @ZA11437 16010000
         SR    XDWORK,X2START      COMPUTE OPERAND DISP        @ZA11437 16020000
         A     XDWORK,DCMAENTR     INDEX INTO ENTRY AREA       @ZA11437 16030000
         ST    XDWORK,DCMADOPN     SAVE PTR TO OP IN ENTRY AREA@ZA11437 16040000
         L     XFBRANCH,DCMNDEL3   LOAD DELETE 3 ADDRESS                16050000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 16100000
         BR    XFBRANCH            EXIT TO IEECVET8                     16150000
VERIFY   EQU   *         CHECK DELETE REQUEST VERIFICATION    MB YM4360 16200000
         CLI   DCMCON,Y            CONVERSATIONAL DELETE MODE MB YM4360 16250000
         BNE   SVC34               NO, ISSUE THE COMMAND      MB YM4360 16300000
         CLI   DCMRQDEL,BLANK      BLANK BUFFER               MB YM4360 16350000
         BE    SVC34               YES, NO NEED TO CHECK      MB YM4360 16400000
         SR    X3END,XDWORK        GET OPERAND LENGTH MINUS 1 MB YM4360 16450000
         LA    X3END,N1(X3END)     COMPARE FOR 1 MORE                   16500000
         EX    X3END,VERCOMP       COMPARE OPERAND WITH DELETE REQUEST *16550000
               BUFFER IN THE RESIDENT DCM                               16600000
         BNE   NOVERIFY            NOT SUCCESSFUL VERIFIY     MB YM4360 16650000
         L     XFBRANCH,DCMNDEL4   LOAD DELETE 4 ADDRESS                16700000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 16750000
         BR    XFBRANCH            EXIT TO IEECVET9                     16800000
NOVERIFY EQU   *         A 'K' COMMAND HAS BEEN RECEIVED THAT FAILS TO  16850000
*              VERIFY A DELETE REQUEST.  PERFORM A CANCEL FUNCTION      16900000
*              IMMEDIATELY  THEN COMPLETE COMMAND PROCESSING            16950000
*              AT LABEL 'SVC34'.                              MB YM4360 17000000
         OI    DCMCOM1,DCMCANCL    INDICATE INTERNAL ET4 CALL MB YM4360 17050000
         B     NOTASYNC            PERFORM CANCEL LOGIC       MB YM4360 17100000
RPYNUM   CLI   N0(XDWORK),BLANK    REPLY WITH NO OPERANDS               17150000
         BZ    SVC35               NO OPERANDS, NO WTOR REPLY           17200000
NUMSTART EQU   *                                                        17250000
         TM    N0(XDWORK),F0       FIRST CHARACTER NUMERIC              17300000
         BNO   SVC35               NO, CANT CHECK REPLY ID              17350000
         MVI   DCMPACK,F0         INITIALIZE TENS DIGIT TO 0            17400000
         TM    N1(XDWORK),F0       IS THERE A SECOND NUMBER             17450000
         BNO   ONENUM              NO, JUST ONE                         17500000
         MVC   DCMPACK(N1),N0(XDWORK) MOVE FIRST IN AS TENS DIGIT       17550000
         LA    XDWORK,N1(XDWORK)   POINT TO UNITS DIGIT                 17600000
ONENUM   EQU   *                                                        17650000
         MVC   DCMPACK+N1(N1),N0(XDWORK) MOVE UNITS DIGIT               17700000
         L     X6ORE,UCMRPYQ    BASE FIRST ORE                          17750000
         USING OREF,X6ORE                                               17800000
LASTORE  LTR   X6ORE,X6ORE   ZERO ADDRESS                               17850000
         BZ    SVC35               END OF REPLY Q, NOT FOUND            17900000
         TM    OREXC,OREBUFB       VALID ORE                            17950000
         BNO   NEXTORE             NO, LOOK AT NEXT ONE                 18000000
         CLC   DCMPACK(N2),OREID  REPLY ID'S MATCH                      18050000
         BNE   NEXTORE             NO, LOOK AT NEXT ONE                 18100000
         L     X7WQE,OREWQE     BASE WQE FOR THIS WTOR                  18150000
         USING WQE,X7WQE        ESTABLISH ADDRESSABILITY                18200000
         TM    WQEROUT2,WQEROUTI   SYSTEM SECURITY ROUT CODE            18250000
         BNO   SVC35               NO, DONT SUPPRESS TEXT               18300000
         LA    X1PARM,DCMINLGN     START OF PARAMETER AREA              18350000
         MVC   N1(L'SUPPRESS,XDWORK),SUPPRESS SUPRESS TEXT OF REPLY     18400000
         SR    XDWORK,X1PARM       GET LENGTH TO END OF REPLY ID        18450000
         LA    XDWORK,L'SUPPRESS+N1(XDWORK)  CALCULATE NEW LENGTH       18500000
         STH   XDWORK,DCMINLGN     SET UP ADJUSTED COMMAND LENGTH       18550000
         B     SVC35               WRITE THE REPLY COMMAND              18600000
NEXTORE  L     X6ORE,ORELKP     BASE NEXT ORE                           18650000
         B     LASTORE             CONTINUE SEARCH                      18700000
SVC35    EQU   *                                                        18750000
         MVI   DCMMCSFL,WQEMCSB+WQEMCSH   QUEUE BY REG 0                18800000
         MVI   DCMMCSFL+N1,WQEMCSN BYPASS HARDCOPY                      18850000
         LA    X1PARM,DCMINLGN     ADDRESS PARAMETER LIST               18900000
         SR    X0,X0               CLEAR REG ZERO             MG  M2097 18950000
         IC    X0,UCMID            GET UCMID                  MG  M2097 19000000
         SVC   N35                 ISSUE SVC                  MG  M2097 19050000
SVC34    EQU   *                                                        19100000
         L     X1PARM,DCMDSAV      GET THE LENGTH FOR SVC 34            19150000
         STH   X1PARM,DCMINLGN     STORE LENGTH                         19200000
         EX    XELEN,CMDMOVE       MOVE COMMAND                        *19250000
               TO BE ISSUED AS TYPED BY THE OPERATOR                    19300000
         LA    X1PARM,DCMINLGN     POINT TO INPUT                       19350000
         SR    X0,X0               CLEAR REG ZERO                       19400000
         IC    X0,UCMID            GET UCMID                            19450000
         MVI   DCMSVC34,N0         ZERO OUT COMM. FLAGS FOR USE         19500000
*                                  BY SVC 34 AND K COMMAND              19550000
         XC    DCMMCSFL(N2),DCMMCSFL   ZERO MCS FLAGS                   19600000
         SVC   N34                 ISSUE SVC 34                         19650000
         TM    DCMSVC34,DCMMYCMD   VALID K COMMAND TO THIS CONS.        19700000
         BO    FORCOM              YES, DOES THIS ROUTINE DO IT         19750000
         TM    DCMSVC34,DCMINVLD   INVALID K COMMAND                    19800000
         BO    KCURSCMP            COMPUTE CURSOR POSITION              19850000
BLENT    EQU   *                                                        19900000
         OI    DCMIOCM1,DCMWRENT+DCMWRINS+DCMINSC TURN ON WRITE BITS    19950000
         B     INSRT               COMPUTE CURS POS AND EXIT            20000000
FORCOM   EQU   *                                                        20050000
         LA    X1PARM,DCMINLGN     GET POINTER TO PARAMETER LIST        20100000
         TM    DCMSVC34,DCMTYPE1   POINT ADOPN TO ENTRY AREA            20150000
         BO    FORCOM1             YES                                  20200000
         ST    X1PARM,DCMADKP      STORE PTR IN RESIDENT DCM            20250000
         B     BLENT               BLANK ENTRY AREA                     20300000
FORCOM1  EQU   *                                                        20350000
         USING KMOD,X1PARM         BASE KPARAM LIST                     20400000
         L     XDWORK,DCMADOPN     GET OPERAND POINTER                  20450000
         LA    X2START,DCMINPUT    GET INPUT AREA PTR                   20500000
         SR    XDWORK,X2START      COMPUTE OPERAND DISPLACEMENT         20550000
         A     XDWORK,DCMAENTR     INDEX INTO ENTRY AREA                20600000
         ST    XDWORK,DCMADOPN     SAVE PTR TO OP IN ENTRY AREA         20650000
         CLC   KMOD(N4),DCMNCMD1   IS K COMMAND DONE HERE               20700000
         BE    CHECKOPR            YES, CHECK OPERAND                   20750000
         L     XFBRANCH,KMOD       ADDRESS ROUTINE TO HANDLE COMMAND    20800000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 20850000
         BR    XFBRANCH                                                 20900000
         DROP  X1PARM                                                   20950000
CHECKOPR EQU   *                   XDWORK POINTS TO FIRST OPERAND CHAR  21000000
         CLC   N0(N3,XDWORK),EN    K E,N                                21050000
         BE    ERASNUM             YES, ERASE NUMBERS                   21100000
         L     XFBRANCH,DCMNPROC   LOAD PROCESSOR ROUTINE ADDRESS       21150000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 21200000
         BR    XFBRANCH            EXIT TO IEECVET1                     21250000
CURSCOMP EQU   *                                                        21300000
         L     XDWORK,DCMAENTR     START OF COMMAND                     21350000
         L     XELEN,DCMADOPN      GET OPERAND DISPLACEMENT             21400000
         SR    XELEN,XDWORK                                             21450000
CURSCOM1 EQU   *                                                        21500000
*                                  INSERT CURSOR, WRITE ENTRY           21550000
*                                  AREA, WRITE INSTRUCTION LINE,        21600000
*                                  WRITE WARNING LINE.                  21650000
         OI    DCMIOCM1,DCMINSC+DCMWRINS+DCMWRENT+DCMWRWRN              21700000
         CH    XELEN,DCMLGNTH      OPERAND IN SECOND LINE               21750000
         BNL   LINE2               YES DISPLACEMENT OF OPERAND @ZA18576 21800000
         MVI   DCMCULNO,N1         SET LINE NUMBER (IN ENTRY AREA) TO 1 21850000
STCURS   EQU   *                                                        21900000
         LA    XELEN,N1(XELEN)     ADD ONE TO LENGTH                    21950000
         STC   XELEN,DCMPOSCU      STORE CURSOR POSITION                22000000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 22050000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             22100000
LINE2    EQU   *                                                        22150000
         MVI   DCMCULNO,N2         SET LINE NUMBER (IN ENTRY AREA) TO 2 22200000
         SH    XELEN,DCMLGNTH      GET CURSOR POSITION ON LINE 2 OF     22250000
         B     STCURS                ENTRY AREA AND STORE IT            22300000
KCURSCMP EQU   *                                                        22350000
         LH    XELEN,DCMINLGN      POINT TO BAD OPERAND IN ENTRY        22400000
*                                  AREA BASED ON DISPLACEMENT IN        22450000
*                                  K LIST FROM SVC 34                   22500000
         NI    DCMR3FLG,N255-DCMRXSCN   TURN OFF ASYNC ERROR FLG        22550000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              22600000
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     22650000
         B     CURSCOM1            STORE CURSOR POSITION                22700000
ERASNUM  EQU   *                                                        22750000
         TM    DCMDSTAT,DCMDSTNM   Q. ARE MESSAGES NUMBERED             22800000
         BNO   ERRORNDL            NO, ERROR- NO DELET MSGS             22850000
*                                  YES, ERASE NUMBERS                   22900000
NUMERAS  EQU   *                                                        22950000
         NI    DCMDSTAT,N255-DCMDSTNM-DCMDSTNH   TURN OFF NUMBER FLAGS  23000000
         L     X2START,DCMASCRN    GET ADDR OF FIRST MESSAGE LINE       23050000
         LH    XELEN,DCMMSGAL      GET NUMBER OR LINES IN MESSAGE AREA  23100000
REMVNUM  EQU   *                                                        23150000
         MVC   N0(N2,X2START),CBLANK BLANK NUMBERS                      23200000
         AH    X2START,DCMCORLN    INCRE TO NEXT LINE             M1517 23250000
         BCT   XELEN,REMVNUM       LOOP UNTIL ALL NUMBERS ARE BLANKED   23300000
         B     CANSUBR             SET UP FOR WRITE                     23350000
ERRORNDL EQU   *                                                        23400000
         OI    DCMCMSG2,DCMDELRI   REQUEST INCONSISTENT MESSAGE         23450000
         L     XFBRANCH,DCMNMSG2   LOAD MESSAGE 2 ADDRESS               23500000
*                                  FOR EXIT TO IEECVETE                 23550000
         B     CURSCOMP            POSITION CURSOR                      23600000
IOEXIT   EQU   *                                                        23650000
         NI    DCMR3FLG,N255-DCMRXSCN    TURN OFF ASYNC ERROR INDICATOR 23700000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              23750000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 23800000
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         23850000
VERCOMP  CLC   DCMRQDEL(N0),N0(XDWORK)                                  23900000
CMDMOVE  MVC   DCMINPUT(N0),N0(X2START)                                 23950000
         EJECT                                                          24000000
*********************************************************************** 24050000
*                                                                       24100000
*        CONSTANTS                                                      24150000
*                                                                       24200000
*********************************************************************** 24250000
TAB2260  EQU   *                                                        24300000
         DC    64C' '                                                   24350000
         DC    X'40414243444546474849404B4C4D4E4F' BLANK X'4A'          24400000
         DC    X'505152535455565758595A5B5C5D5E5F'                      24450000
         DC    X'60616263646566676869406B6C6D6E6F' BLANK X'6A'          24500000
         DC    X'707172737475767778797A7B7C7D7E7F'                      24550000
         DC    X'808182838485868788898A8B8C8D8E8F'                      24600000
         DC    X'909192939495969798999A9B9C9D9E9F'                      24650000
         DC    X'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'                      24700000
         DC    X'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'                      24750000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      24800000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      24850000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      24900000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      24950000
TRTAB    EQU   *                                                        25000000
         DC    64C' '                                                   25050000
         DC    X'404142434445464748494A4B4C4D4E4F'                      25100000
         DC    X'505152535455565758595A5B5C5D5E5F'                      25150000
         DC    X'606162636465666768696A6B6C6D6E6F'                      25200000
         DC    X'707172737475767778797A7B7C7D7E7F'                      25250000
         DC    X'808182838485868788898A8B8C8D8E8F'                      25300000
         DC    X'909192939495969798999A9B9C9D9E9F'                      25350000
         DC    X'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'                      25400000
         DC    X'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'                      25450000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      25500000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      25550000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      25600000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      25650000
H4       DC    H'4'                CONSTANT                             25700000
EN       DC    C'E,N'              COMPARAND FOR K E,N                  25750000
CONTROL  DC    C'CONTROL '         COMPARAND FOR CONTROL VERB           25800000
K        DC    C'K '               COMPARAND FOR K VERB                 25850000
R        DC    C'R '               COMPARAND FOR R VERB                 25900000
REPLY    DC    C'REPLY '           COMPARAND FOR REPLY VERB             25950000
MR       DC    C'MR '              COMPARAND FOR MR VERB                26000000
MSGRT    DC    C'MSGRT'            COMPARAND FOR MSGRT VERB             26050000
SUPPRESS DC    C' SUPPRESSED'                                           26100000
CBLANK   DC    C'  '               BLANK CHARACTERS                     26150000
*********************************************************************** 26200000
*                                                                       26250000
*        EQUATES                                                        26300000
*                                                                       26350000
*********************************************************************** 26400000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            26450000
ID2      EQU   C'4'                2ND CHARACTER OF CSECT ID            26500000
N0       EQU   0                   FIELD INCREMENT                      26550000
N1       EQU   1                   FIELD INCREMENT                      26600000
N2       EQU   2                   FIELD INCREMENT                      26650000
N3       EQU   3                   FIELD INCREMENT                      26700000
N4       EQU   4                   FIELD INCREMENT                      26750000
N5       EQU   5                   FIELD INCREMENT                      26800000
N6       EQU   6                   FIELD INCREMENT                      26850000
N7       EQU   7                   FIELD INCREMENT                      26900000
N8       EQU   8                   FIELD INCREMENT                      26950000
N34      EQU   34                  FIELD INCREMENT                      27000000
N35      EQU   35                  FIELD INCREMENT                      27050000
N56      EQU   56                  FIELD INCREMENT                      27100000
N57      EQU   57                  FIELD INCREMENT                      27150000
N125     EQU   125                 FIELD INCREMENT                      27200000
N126     EQU   126                 FIELD INCREMENT                      27250000
N127     EQU   127                 FIELD INCREMENT                      27300000
N255     EQU   255                 FIELD INCREMENT                      27350000
ISDASH   EQU   C'-'                DASH                                 27400000
SLASH    EQU   C'|'                SLASH                                27450000
ASTER    EQU   C'*'                ASTERISK                             27500000
BLANK    EQU   C' '                BLANK                                27550000
NDX2260  EQU   12                  DCMIONDX VALUE FOR 2260              27600000
PPACT    EQU   C'@'                SIGN FOR PP ACTION                   27650000
F0       EQU   C'0'                                                     27700000
Y        EQU   C'Y'                CON=Y OPTION COMPARE       MB YM4360 27750000
         EJECT                                                          27800000
*********************************************************************** 27850000
*                                                                       27900000
*        DSECTS                                                         27950000
*                                                                       28000000
*********************************************************************** 28050000
         SPACE                                                          28100000
         IHAORE                                                         28150000
         EJECT                                                          28200000
UCBBLK   DSECT                                                          28250000
         IEFUCBOB                                                       28300000
         EJECT                                                          28350000
         IEERDCM                                                        28400000
         EJECT                                                          28450000
         IEETDCM                                                        28500000
         EJECT                                                          28550000
         IHAWQE  DSECT=YES                                              28600000
         EJECT                                                          28650000
         IHACTM  CXSA                                                   28700000
         EJECT                                                          28750000
         IEECVMAP KPARAM                                                28800000
         EJECT                                                          28850000
         IEECUCM  FORMAT=NEW                                            28900000
    END                                                                 28950000
./  ADD  SSI=62730413,NAME=IEECVET6
IEECVET6 CSECT                                                          00050000
*********************************************************************** 00100000
         TITLE 'IEECVET6  DELETE 1'                                     00150000
*********************************************************************** 00200000
*                                                                     * 00250000
* STATUS       CHANGE LEVEL=0                                         * 00300000
*                                                                     * 00310000
* APARS FIXED  ZA08082,ZA14031                                        * 00320000
*                                                                     * 00350000
* FUNCTION     ANALYZE DELETION OF MESSAGES REQUESTED BY K E,F OR     * 00400000
*              K E,NN CONTROL COMMAND                                 * 00450000
*                                                                     * 00500000
* ENTRY POINT  IEECVET6                                               * 00550000
*                                                                     * 00600000
* INPUT        INDICATION OF K E,NN OR K E,F DELETE REQUEST.          * 00650000
*                                                                     * 00700000
* OUTPUT       ALTERATION OF DISPLAY- INDICATION OF MESSAGES TO BE    * 00750000
*              DELETED                                                * 00800000
*                                                                     * 00850000
* EXTERNAL REFERENCES NONE                                            * 00900000
*                                                                     * 00950000
* EXITS - NORMAL                                                      * 01000000
*              IEECVETH OR P OR R  DEVICE-DEPENDENT IO                * 01050000
*              IEECVET9 DELETE 4  WHEN NO VERIFICATION NECESSARY      * 01100000
*       - ERROR                                                       * 01150000
*              IEECVETE MESSAGE 2                                     * 01200000
*                                                                     * 01250000
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)       * 01300000
*                   SCREEN CONTROL TABLE (SCT)                        * 01350000
*                   SECONDARY SCREEN CONTROL TABLE (SSCT)             * 01400000
*                                                                     * 01450000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                    * 01500000
*                                                                     * 01550000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A    * 01600000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL     * 01650000
*              CHARACTER SET.                                         * 01700000
*                                                                     * 01750000
*********************************************************************** 01800000
         EJECT                                                          01850000
*                                                                       04650000
*   REGISTER EQUATES                                                    04700000
*                                                                       04750000
X0       EQU   0         SECONDARY SCREEN CONTROL TABLE PTR      S21002 04800000
X1       EQU   1         REG 1                                          04850000
XNUM     EQU   1         REG 1                                          04900000
XWORK    EQU   2         WORK REG.                                      04950000
XHCTR    EQU   3         HIGH VALUE FOR NN                              05000000
XINC     EQU   4         INCREMENT REG (BXLE)                           05050000
XCOMP    EQU   5         COMPARAND (BXLE)                               05100000
XLCTR    EQU   6         LOW VALUE FOR NN                               05150000
X7       EQU   7         UCM BASE REG                                   05200000
XMSG     EQU   8         BRANCH REG.                                    05250000
X9       EQU   9         DCM BASE REG                                   05300000
XA       EQU   10        PROGRAM BASEREG.                               05350000
XB       EQU   11        CXSA BASE REG.                                 05400000
XC       EQU   12        UCM ENTRY BASE REG.                            05450000
X13      EQU   13                  RESIDENT DCM BASE REGISTER    S21002 05500000
XE       EQU   14        REG 14                                         05550000
XMASK    EQU   15        MASK REGISTER                                  05600000
XFBRANCH EQU   15                                                       05650000
XERTRN   EQU   14                                                       05700000
X1PARM   EQU   1                                                        05750000
         EJECT                                                          05800000
         BALR  XA,N0               ESTABLISH PROGRAM ADDRESSIBILITY     05850000
         USING *,XA                                                     05900000
         LR    XB,X1               ESTABLISH CXSA ADDRESS               05950000
         B     BEGIN               BRANCH AROUND PATCH AREA             06000000
ICATCH   DC    C'IEECVET6'         EYECATCHER AND FIELD MAINTENANCE     06050000
         DC    CL8'&SYSDATE',CL56' '                                    06100000
BEGIN    EQU   *                   END OF PATCH AREA                    06150000
         USING CXSA,XB                                                  06200000
         L     XC,CSAUCM           ESTABLISH UCM ADDRESS                06250000
         USING UCMLIST,XC                                               06300000
         L     X13,UCMXB           GET PTR TO RESIDENT DCM       S21002 06350000
         L     X9,N0(X13)          GET PTR TO TRANSIENT DCM      S21002 06400000
         USING DCMTSRT,X13         ADDRESSIBILITY RESIDENT DCM   S21002 06450000
         USING DCMSTRT,X9         ESTABLISH DCM BASE REGISTER           06500000
         L     X7,CSACTLM          GET POINTER TO UCM                   06550000
         USING UCM,X7              ESTABLISH UCM BASE REGISTER          06600000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06650000
         MVI   DCMTREN1,ID1         PUT CSECT ID INTO                   06700000
         MVI   DCMTREN2,ID2         NEW TRACE ENTRY                     06750000
         L     XFBRANCH,CSAXC       ADDRESS FREELOCK SUBROUTINE         06800000
         BALR  XERTRN,XFBRANCH      RELEASE LOCKS                       06850000
         LH    XINC,DCMSCTCN        INCREMENT FOR SCT          @ZA08082 06900000
         CLC   DCMASCRN,DCMWTBUF    ANY VISABLE MESSAGES       @ZA08082 06950000
         BE    ERROR2               NO,NO DELETABLES           @ZA08082 07000000
         MVI   DCMUTILT,ZERO   ZERO UTILITY BYTE                        07050000
         SR    XMASK,XMASK         ZERO MASK REGISTER                   07100000
         LA    XLCTR,N1            SET LOW NUMBER REG TO ONE     S21002 07150000
         L     XWORK,DCMADOPN     GET ADDR OF OPERAND                   07200000
         MVC   DCMRQDEL(N8),N0(XWORK)                                   07250000
         CLI   N1(XWORK),COMMA     Q. IS SECOND CHARACTER COMMA         07300000
         BNE   ERROR1              NO, INVALID OPERAND                  07350000
         CLC   N2(N2,XWORK),FDEL   IS OPERAND  E,F                      07400000
         BE    DF                  YES                                  07450000
         TM    N2(XWORK),FZERO     Q. IS OPERAND A NUMBER               07500000
         BNO   ERROR1              NO, INVALID OPERAND                  07550000
***                                                                     07600000
***  K E,NN(,NN) DELETE REQUEST                                         07650000
***                                                                     07700000
         ST    XMASK,DCMCVBIN      INIT DCMPACK & DCMCVBIN TO 0         07750000
         OI    DCMCVBIN+N2,FZERO   PUT 'F0' IN 3RD BYTE IN CASE ONE     07800000
         MVC   DCMPACK(N4),DCMCVBIN DIGIT NUMBER SPECIFIED              07850000
***                                                                     07900000
***  TEST FOR  VALIDITY OF   NN(,NN)                                    07950000
***                                                                     08000000
         CLI   N3(XWORK),BLANK     Q  IS COLUMN 2 BLANK                 08050000
         BNE   COM2                NO - GO TEST FOR COMMA               08100000
         MVC   DCMPACK+N3(N1),N2(XWORK) MOVE COL 1 TO FIELD             08150000
         B     ONENUM              ONLY ONE NUMBER SPECIFIED            08200000
COM2     EQU   *                                                        08250000
         CLI   N3(XWORK),COMMA     Q. IS COLUMN 2 A COMMA               08300000
         BNE   C3                  NO- GO TEST FOR COMMA IN COL.3       08350000
         MVC   DCMPACK+N3(N1),N2(XWORK) YES,MOVE COL 1 TO FIELD         08400000
         CLI   N5(XWORK),BLANK     Q. IS COL 4 BLANK                    08450000
         BNE   M34                      NO-GO TO M34                    08500000
         MVC   DCMCVBIN+N3(N1),N4(XWORK) MOVE COL 3 TO FIELD            08550000
         B     TEST                GO TEST VALIDITY OF NUMBERS          08600000
M34      MVC   DCMCVBIN+N2(N2),N4(XWORK) MOVE COL 3 AND 4 TO FIELD1     08650000
         CLI   N6(XWORK),BLANK     Q. IS COL 5 BLANK                    08700000
         BE    TEST                YES- GO TEST FOR VALIDITY OF NUMBERS 08750000
         BNE   ERROR               NO- ERROR                            08800000
C3       MVC   DCMPACK+N2(N2),N2(XWORK) MOVE COL 1+2 TO FIELD           08850000
         CLI   N4(XWORK),COMMA     Q. IS COL 3 A COMMA                  08900000
         BNE   C3B                 NO-GO TEST FOR BLANK                 08950000
         CLI   N6(XWORK),BLANK     Q. IS COLS BLANK                     09000000
         BNE   M45                 NO-GO TO M45                         09050000
         MVC   DCMCVBIN+N3(N1),N5(XWORK) MOVE COL 4 TO FIELD1           09100000
         B     TEST                GO TEST FOR VALIDITY OF NUMBERS      09150000
M45      EQU   *                                                        09200000
         CLI   N7(XWORK),BLANK     Q. IS COLUMN 6 BLANK                 09250000
         BNE   ERROR     NO-INVALID OPERAND                             09300000
         MVC   DCMCVBIN+N2(N2),N5(XWORK) MOVE COL 4 AND 5 TO FIELD1     09350000
         B     TEST                GO TEST VALIDITY OF NUMBERS          09400000
C3B      CLI   N4(XWORK),BLANK     Q. IS COL 3 BLANK                    09450000
         BNE   ERROR     NO- DELETE REQ INCONSISTENT                    09500000
ONENUM   EQU   *                                                        09550000
         MVC   DCMCVBIN+N2(N2),DCMPACK+N2 SET FIELD1=FIELD              09600000
TEST     EQU   *                                                        09650000
         CLI   DCMPACK+N2,FZERO        TEST VALIDITY OF NUMBER          09700000
         BL    ERROR                   NO, ERROR                        09750000
         CLI   DCMPACK+N3,FZERO        TEST VALIDITY OF NUMBER          09800000
         BL    ERROR                   NO, ERROR                        09850000
         CLI   DCMCVBIN+N2,FZERO       Q, IS NUMBER VALID               09900000
         BL    ERROR                   NO, ERROR                        09950000
         CLI   DCMCVBIN+N3,FZERO      Q.    IS NUMBER VALID             10000000
         BL    ERROR                   NO, ERROR                        10050000
         CLC   DCMPACK+N2(N2),DCMCVBIN+N2 COMPARE FIELD WITH FIELD1     10100000
         BH    ERROR     ERROR- DELETE REQUEST INCONSISTENT             10150000
         L     XLCTR,DCMPACK                                            10200000
         BAL   XMSG,BCONVERT   CONVERT HIGH NUMBER TO BINARY            10250000
         LR    XHCTR,XWORK                                              10300000
         LH    XWORK,DCMMSGAL      GET LENGTH OF MESSAGE AREA           10350000
         CR    XHCTR,XWORK         Q. IS HIGH NUMBER WITHIN MESSAGE ARE 10400000
         BH    ERROR               NO, ERROR                            10450000
         ST    XLCTR,DCMCVBIN   CONVERT LOW NUMBER TO BIN               10500000
         BAL   XMSG,BCONVERT       GO TO CONVERSION RTN.                10550000
         LR    XLCTR,XWORK   BIN VALUE COMES BACK IN XWORK              10600000
         LTR   XLCTR,XLCTR             Q. IS FIRST NUMBER ZERO          10650000
         BZ    ERROR                   YES, DELETE REQ INCONSISTENT     10700000
WIDTEST  EQU   *                                                        10750000
         LR    XCOMP,XHCTR         COMPUTE SCREEN CONTROL TABLE         10800000
         MH    XCOMP,DCMSCTCN        DISPLACEMENT OF HIGH NUMBER        10850000
         SR    XCOMP,XINC                                               10900000
         L     XWORK,DCMAMTAB      GET ADDR OF THE SCREEN CONTROL TABLE 10950000
         LA    XCOMP,N0(XCOMP,XWORK)   INCREMENT TO SCT ADDRESS OF HIGH 11000000
*                                      NUMBER IN RANGE FOR DELETION     11050000
         TM    N0(XCOMP),DCMMSGIN  Q. IS THERE A MSG. IN LINE           11100000
         BZ    ERROR                    NO- ERROR                       11150000
         L     XWORK,DCMADSEC      ADDR OF THE SECONDARY SCT     S21002 11200000
         AR    XWORK,XHCTR         INCR TO SSCT HIGH NUMBER MSG  S21002 11250000
         BCTR  XWORK,N0            DECREMENT TO LAST SSCT ENTRY  S21002 11300000
*                                  IS LAST MSG IN STATUS DISPLAY S21002 11350000
         TM    N0(XWORK),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL     S21002 11400000
         BC    5,ERROR             BRANCH YES                    S21002 11450000
         TM    N1(XCOMP),DCMMSGAC  Q. IS LAST MSG. A WTOR               11500000
         BZ    SETMASK                  NO- GO SET UP MASK FOR DELETE   11550000
         CR    XLCTR,XHCTR              Q. ONLY ONE MESSAGE SPECIFIED   11600000
         BNE   SETMASK             NO, GO ON TO DELETE                  11650000
         OI    DCMUTILT,DCMUTILC   BIT TO INDICATE WTOR DELETABLE       11700000
SETMASK    EQU   *                                                      11750000
         IC    XMASK,MASKBIT+N1        SET UP MASK FOR DEL REQUEST      11800000
***                                                                     11850000
***  THIS ROUTINE WILL SET THE DELETION REQUEST BIT FOR ALL MESSAGES    11900000
***  WITH THE APPROPRIATE MASK                                          11950000
***                                                                     12000000
INIT     EQU   *                                                        12050000
         L     X0,DCMADSEC         START OF SSCT              MB YM4087 12100000
         LR    XE,X0               SAME FOR HIGH LINE         MB YM4087 12150000
         BCTR  XE,0                BACK UP ONE                MB YM4087 12200000
         AR    XE,XHCTR            HIGH LINE SSCT             MB YM4087 12250000
         MH    XHCTR,DCMSCTCN  MULT. HIGH NUMBER BY SCT INCRE.          12300000
         SR    XHCTR,XINC          AND COMPUTE SCT ADDRESS FOR HIGH NUM 12350000
         L     XWORK,DCMAMTAB      SET UP REGISTERS FOR BXLE            12400000
         L     XCOMP,DCMADDRL      GET ADDR OF LAST MSG IN SCT          12450000
         AR    XHCTR,XWORK         HIGH LINE SCT              MB YM4087 12500000
         MH    XLCTR,DCMSCTCN  COMPUTE SCT ADDR. FOR LOW NUMBER         12550000
         SR    XLCTR,XINC                                               12600000
         AR    XLCTR,XWORK         LOW LINE SCT               MB YM4087 12650000
         SR    XNUM,XNUM           ZERO NUMBER REGISTER                 12700000
         OI    DCMDSTAT,DCMDSTNM    SET BIT- MSGS. NUMBERED             12750000
         L     XMSG,DCMASCRN       ADDR OF FIRST MSG IN BUFFER          12800000
***                                                                     12850000
***  XLCTR AND XHCTR ARE THE LIMITS FOR DELETION                        12900000
***  TEST FOR CONTINUATION LINES IN FIRST OR LAST MESSAGE WITHIN RANGE  12950000
***  OF DELETION                                                        13000000
***                                                                     13050000
CONT1    TM    N1(XLCTR),DCMMSGCT  Q. IS FIRST LINE A CONTINATION LINE  13100000
         BNO   GOON                NO                                   13150000
         SR    XLCTR,XINC          DECREMENT TO INCLUDE PREVIOUS LINE   13200000
         B     CONT1               CHECK FOR FURTHER CONTIN             13250000
GOON     EQU   *                                                        13300000
         TM    N0(XHCTR),DCMMSGCN  Q. IS LAST LINE CONTINUED            13350000
         BNO   LOOP                NO                                   13400000
***                                                              S21002 13450000
***         IS THE CONTINUED LINE IN A STATUS DISPLAY            S21002 13500000
***                                                              S21002 13550000
         TM    N1(XE),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL        S21002 13600000
         BZ    CINCRE              BRANCH NO                     S21002 13650000
         SR    XHCTR,XINC          YES, DO NOT DELETE IT                13700000
         CLR   XLCTR,XHCTR         Q. ARE THERE ANY DELETABLE MSGS      13750000
         BH    ERROR2              NO, ERROR                            13800000
         B     LOOP                YES, CONTINUE                        13850000
CINCRE   EQU   *                                                        13900000
         AR    XHCTR,XINC          INCREMENT TO INCLUDE CONTINUED LINE  13950000
         LA    XE,X1(XE)           AND CONTINUED LINE SSCT    MB YM4087 14000000
         B     GOON                CHECK FOR FURTHER CONTIN             14050000
LOOP    EQU    *                                                        14100000
         TM    N0(XWORK),DCMMSGIN  Q. IS THERE A MSG IN THE LINE        14150000
         BZ    NOUT      NO/ NO MORE MESSAGES                           14200000
         BAL   XE,NUMBER           GO NUMBER MESSAGE                    14250000
         CLR   XWORK,XLCTR         IF MESSAGE BEING TESTED IS NOT       14300000
         BL    TURNOFF                BETWEEN HIGH AND LOW NUMBERS      14350000
         CLR   XWORK,XHCTR            SPECIFIED - TURN OFF DEL.REQ.BIT  14400000
         BH    TURNOFF                AND REMOVE VERTICAL BAR           14450000
SLOOP   EQU   *                                                         14500000
         EX    XMASK,TUMASK  DLETEION FOR THIS MSG                      14550000
         BNZ   HERE                YES-DELETE THIS MESSAGE              14600000
TURNOFF   EQU   *                                                       14650000
         NI    N0(XWORK),N255-DCMMSGRD TURN OFF DELETE REQUEST BIT      14700000
         TM    N0(XWORK),DCMMSGIF  IS THERE AN INFORMATIONAL MSG IN LIN 14750000
         BZ    REMOVE     NO-GO REMOVE BAR                              14800000
         MVI   N2(XMSG),HORBAR     REPLACE HORIZ. BAR                   14850000
         B     NNEXT               GO INCREMENT CTRS.                   14900000
REMOVE    EQU   *                                                       14950000
         MVI   N2(XMSG),BLANK      REMOVE VERTICAL BAR                  15000000
         TM    N1(XWORK),DCMMSGAC      Q. AN ACTION MESSAGE             15050000
         BZ    NNEXT                   NO, GO INCRE COUNTERS            15100000
         TM    N1(XWORK),DCMMSGPP   IS IT A PROB PROG ACTION MSG.Y01958 15150000
         BNO   ASTER                NO MARK WITH ASTERISK     MD Y01958 15200000
         MVI   N3(XMSG),PPACT       MARK WITH A '@'           MD Y01958 15250000
         B     NNEXT                GET NEXT MSG              MD Y01958 15300000
ASTER    EQU   *                                              MD Y01958 15350000
         MVI   N3(XMSG),ASTERISK       MOVE IN ASTERISK                 15400000
         B     NNEXT               GO INCREMENT CTRS                    15450000
HERE     EQU   *                                                        15500000
         TM    N1(XWORK),DCMMSGAC  Q. IS MSG A WTOR                     15550000
         BZ    SET   NO-  SET BIT                                       15600000
         TM    DCMUTILT,DCMUTILC   Q. IS WTOR DELETABLE                 15650000
         BNO   TURNOFF             NO,  DO NOT MARK FOR DELETION        15700000
SET      EQU   *                                                        15750000
         TM    N0(XWORK),DCMMSGCN  Q. IS THIS MSG CONTINUED             15800000
         BNO   GODEL               NO, GO DELETE IT                     15850000
         LR    XE,X0               ADDRESS OF SSCT ENTRY         S21002 15900000
***                                                              S21002 15950000
***        IS THE CONTINUED LINE IN A STATUS DISPLAY             S21002 16000000
***                                                              S21002 16050000
         TM    N1(XE),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL        S21002 16100000
         BNZ   TURNOFF           BRANCH YES                    S21002   16150000
GODEL    EQU   *                                                        16200000
         OI    DCMUTILT,DCMUTILA    SET BIT-DELETION POSSIBLE           16250000
         OI    N0(XWORK),DCMMSGRD  SET DELETION REQUEST BIT IN SCT      16300000
         MVI   N3(XMSG),BLANK      REMOVE ASTERISK IF PRESENT           16350000
         MVI   N2(XMSG),VERTBAR    MARK MESSAGE WITH VERTICAL BAR       16400000
NNEXT    EQU   *                                                        16450000
         AH    XMSG,DCMCORLN       INCREMEMT TONEXT MSG LINE     S21003 16500000
         AH    X0,ONE              INCREMENT TO NEXT SSCT ENTRY  S21002 16550000
         BXLE  XWORK,XINC,LOOP     LOOP IF MORE MESSAGES TO CHECK       16600000
NOUT     EQU   *                                                        16650000
         STH   XNUM,DCMADNUM       STORE NUMBER                         16700000
         TM    DCMUTILT,DCMUTILA     Q. IS DELETION POSSIBLE            16750000
         BZ    ERROR2              NO, ERROR- NO DELETABLE MESSAGES     16800000
         CLI   DCMDEL,R            ROLL OR ROLL DELETE MODE    @ZA14031 16803000
         BE    DEL4EXIT            BRANCH TO IEECVET9 EXIT     @ZA14031 16806000
         TM    DCMOPTST,DCMOPTVR    Q.  IS VERIFICATION REQUIRED        16850000
         BO    VERIFMSG                YES, GO SET UP VERIF MSG         16900000
DEL4EXIT EQU   *                                                        16950000
         L     XFBRANCH,DCMNDEL4    LOAD DELETE 4 ADDRESS               17000000
         B     XCTL                 EXIT TO IEECVET9                    17050000
VERIFMSG EQU   *                                                        17100000
         OI    DCMCMSG2,DCMDLREQ        INDIC MOVE IN VERIFIC INSTRUC   17150000
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS+DCMWRENT+DCMINSC              17200000
         BAL   XE,CURSCOMP         GO COMPUTE CURSOR POSITION           17250000
         L     XFBRANCH,DCMNMSG1    LOAD MESSAGE 1 ADDRESS              17300000
*                                   FOR EXIT TO IEECVETD                17350000
XCTL     EQU   *         EXIT FROM MODULE                               17400000
         L     X1PARM,DCMCXSVE      PASS CXSA ADDRESS IN REG 1          17450000
         BR    XFBRANCH             EXIT ADDRESS ALREADY SET            17500000
ERROR1   EQU   *                                                        17550000
         OI    DCMCMSG3,DCMCDLR5   INDICATE INVALID OPERAND             17600000
         B     ERRORALL            GO INDICATE WRITE DEL REQ INCONSIST  17650000
ERROR2   EQU   *                                                        17700000
         OI    DCMCMSG3,DCMCDLR1   INDICATE NO DELETABLE MESSAGES       17750000
         B     ERRORALL            GO INDICATE WRITE DEL REQ INCONSIST  17800000
ERROR    EQU   *                                                        17850000
         OI    DCMCMSG3,DCMCDLR2    INDICATE INVALID RANGE              17900000
ERRORALL EQU   *                                                        17950000
         MVI   DCMRQDEL,BLANK      BLANK DCMRQDEL                       18000000
         MVC   DCMRQDEL+N1(N7),DCMRQDEL                                 18050000
         OI    DCMCMSG2,DCMDELRI   INDICATE WRITE ERROR MSG             18100000
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS+DCMINSC                       18150000
         BAL   XE,CURSCOMP         GO COMPUTE CURSOR POSITION           18200000
ERRNUM   EQU   *                                                        18250000
         SR    XNUM,XNUM           ZERO NUMBER CTR                      18300000
         L     XWORK,DCMAMTAB      GET ADDR OF FIRST MSG IN SCT         18350000
         L     XCOMP,DCMADDRL      GET ADDR OF LAST NUM                 18400000
         L     XMSG,DCMASCRN       GET ADDR OF FIRST MSG IN BUFFER      18450000
LOOP1    EQU   *                                                        18500000
         TM    N0(XWORK),DCMMSGIN    Q. MSG IN LINE                     18550000
         BNO   OUT                 EXIT                                 18600000
         BAL   XE,NUMBER           GO MOVE IN NUMBER                    18650000
         AH    XMSG,DCMCORLN       INCRE TO NEXT MSG IN BUFFER   S21003 18700000
         BXLE  XWORK,XINC,LOOP1    LOOP UNTIL NO MORE MSGS              18750000
OUT      EQU   *                                                        18800000
         STH   XNUM,DCMADNUM       STORE NUMBER                         18850000
MSGEXIT  EQU   *                                                        18900000
         L     XFBRANCH,DCMNMSG2    LOAD MESSAGE 2 ADDRESS              18950000
         B     XCTL                EXIT TO IEECVETE                     19000000
***                                                                     19050000
***  NUMBER MESSAGE                                                     19100000
***                                                                     19150000
NUMBER   EQU   *                                                        19200000
         AH    XNUM,ONE            INCREMENT TO NEXT NUMBER             19250000
         CVD   XNUM,DCMPACK        CONVERT NUMB TO DECIMAL              19300000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2)    UNPACK NUMBER         19350000
         OI    DCMCVBIN+N3,CF0     FIX SIGN                             19400000
         CLI   DCMCVBIN+N2,CF0     Q. A ONE-DIGIT NUMBER                19450000
         BNE   MOVENUM             NO, GO MOVE 2 DIGITS                 19500000
         MVI   DCMCVBIN+N2,BLANK   YES, BLANK OUT FIRST DIGIT           19550000
MOVENUM  EQU   *                                                        19600000
         MVC   N0(N2,XMSG),DCMCVBIN+N2  MOVE NUMBER INTO MESSAGE LINE   19650000
         BR    XE                  RETURN TO CALLER                     19700000
DF       EQU   *                                                        19750000
         L     XFBRANCH,DCMWTBUF   TOP DISPLAY LINE           MB YM4087 19800000
         S     XFBRANCH,DCMASCRN   DISPLACEMENT IN BYTES      MB YM4087 19850000
         SR    XE,XE               CLEAR EVEN REG             MB YM4087 19900000
         LH    XHCTR,DCMCORLN      BYTES PER LINE             MB YM4087 19950000
         DR    XE,XHCTR            TOP DISPLAY LINE NUMBER    MB YM4087 20000000
         LR    XHCTR,XFBRANCH      HIGH LINE FOR DELETES      MB YM4087 20050000
         IC    XMASK,MASKBIT      SET UP MASK                 MB YM     20100000
         B     INIT                GO SET DELETION REQ.BIT              20150000
***                                                                     20200000
***  THIS ROUTINE WILL CONVERT A NUMBER IN DCMCVBIN TO BINARY-          20250000
***  THE RESULT WILL BE RETURNED IN XWORK                               20300000
***                                                                     20350000
BCONVERT    EQU   *                                                     20400000
         SR    XWORK,XWORK                                              20450000
         ST    XWORK,DCMPACK   STORE ZERO IN DCMPACK                    20500000
         NI    DCMCVBIN+N3,CCF     TAKE CARE OF SIGN BIT                20550000
         PACK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2) PACK NUMBER AND          20600000
         CVB   XWORK,DCMPACK               CONVERT TO BINARY            20650000
         BR    XMSG   RETURN TO CALLER                                  20700000
CURSCOMP EQU   *                                                        20750000
         L     X1,DCMADOPN         GET ADDR OF OPERAND                  20800000
         L     XWORK,DCMAENTR      GET ADDR OF ENTRY AREA               20850000
         SR    X1,XWORK            SUBTRACT TO GET POS OF OPERAND       20900000
         CH    X1,DCMCORLN         Q. IS OPERAND ON LINE 2       S21003 20950000
         BH    LINE2               YES                                  21000000
         MVI   DCMCULNO,N1         SET LINE NUMBER(IN ENTRY AREA) TO 1  21050000
STCURS   EQU   *                                                        21100000
         LA    X1,N3(X1)           INCREMENT POSITION BY THREE   S21002 21150000
         STC   X1,DCMPOSCU         SET CURSOR POSITION                  21200000
         BR    XE                  RETURN TO CALLER                     21250000
LINE2    EQU   *                                                        21300000
         MVI   DCMCULNO,N2         SET LINE NUMBER TO 2                 21350000
         SH    X1,DCMCORLN         THEN GO TO                    S21003 21400000
         B     STCURS              STORE CURSOR POSITION                21450000
TUMASK   TM    N0(XWORK),ZERO                                           21500000
         EJECT                                                          21550000
***                                                                     21600000
***      EQUATES                                                        21650000
***                                                                     21700000
ID1      EQU   C'E'                 1ST CHARACTER OF CSECT ID           21750000
ID2      EQU   C'6'                 2ND CHARACTER OF CSECT ID           21800000
ZERO     EQU   0                   NUMBER 0                             21850000
CF0      EQU   C'0'          CHARACTER OF ZERO                          21900000
VERTBAR  EQU   C'|'                VERTICAL BAR                         21950000
COMMA    EQU   C','                COMMA                                22000000
BLANK    EQU   C' '                BLANK                                22050000
FZERO    EQU   C'0'                CHARACTER 0                          22100000
HORBAR   EQU   C'-'                HORIZONTAL BAR                       22150000
ASTERISK EQU   C'*'          ASTERISK                                   22200000
N0       EQU   0              NUMBER 0                                  22250000
N1       EQU   1                     1                                  22300000
N2       EQU   2                     2                                  22350000
N3       EQU   3                     3                                  22400000
N4       EQU   4                     4                                  22450000
N5       EQU   5                     5                                  22500000
N6       EQU   6                     6                                  22550000
N7       EQU   7                     7                                  22600000
N8       EQU   8                     8                                  22650000
C20      EQU   X'20'          CHAR 20                                   22700000
CCF      EQU   X'CF'          FIX FOR SIGN BIT                          22750000
N255     EQU   255     FIELD INCREMENT                                  22800000
PPACT    EQU   C'@'             PROBLEM PROGRAM ACTION MARK   MD Y01958 22850000
R        EQU   C'R'             DEL=R OR RD                   @ZA14031  22870000
         EJECT                                                          22900000
***                                                                     22950000
***  CONSTANTS                                                          23000000
***                                                                     23050000
FDEL     DC    C'F '     CHARACTER F                                    23100000
ONE      DC    H'1'                NUMBER 1                             23150000
MASKBIT  DC    X'0A40'    FLAGGED MSGS  -- K E,SEG                      23200000
         EJECT                                                          23250000
         IEERDCM                                                        23300000
         EJECT                                                          23350000
         IEETDCM                                                        23400000
         EJECT                                                          23450000
         IEECUCM  FORMAT=NEW                                            23500000
         EJECT                                                          23550000
         IHACTM  CXSA                                                   23600000
         END                                                            23650000
./  ADD  SSI=42701008,NAME=IEECVET7
         TITLE 'IEECVET7  DELETE 2'                                     00050000
IEECVET7 CSECT                                                          00100000
         SPACE 1                                                        00150000
* D 076000-115100,166500-167000                               JE YM6828 00157103
*A149600-149800,155100,165600,165700,085600,085700            MH Y02131 00164503
*C 86500,104000                                              MC SA52275 00171600
*C 150000                                                     MB YM1956 00178700
*D 150500,151000,152000,161500-162500,172500,173000           MB YM1956 00185800
*A 140100,140200,152100,152200                                MB YM0664 00192900
*A610500-610700,C615000,C619000,A619500,C630000,A657300       MG  M1543 00200000
*A657720-657740                                               MG  M1543 00250000
*A267500-269500                                               MF A45435 00300000
*A459500-460000,A468500,A501500,C516500,A546020,C594000       MG  M1427 00350000
*C605000,A610500,A616500-616600,C629000,D659200,A729500       MG  M1427 00400000
*A609100-669200                                                  S21002 00450000
*A047300-047600,A168500,A178000,A186000,A191000-192000           S21003 00500000
*A307000-309000,A438500,A444000-447000,A462500,A516500,A546500   S21003 00550000
*A576000-580500,C585000-633000,A646000-647000,A657400-657600     S21003 00600000
*A659000-659200,A761100-761400                                   S21003 00650000
**********************************************************************  00700000
*                                                                       00750000
*                                                                       00800000
*                                                                       00810000
* STATUS --                                                             00820000
*                                                                       00830000
* PTMS FIXED YM6718,YM6828,YM8648                                       00840000
* APARS FIXED ZA00512                                                   00842000
*                                                                       00844000
* FUNCTION     1 CHECK FOR INTERVENTION REQUIRED MESSAGES. IF THE       00850000
*                DEVICE NAMED IN THE MESSAGE IS READY, THE MESSAGE IS   00900000
*                MARKED AUTOMATICALLY DELETABLE                         00950000
*              2 DOM INDICATED MESSAGES EITHER BY PROTECT KEY OR ID.    01000000
* ENTRY POINT  IEECVET7                                                 01050000
*                                                                       01100000
* INPUT        INDICATION THAT DOMMING IS TO BE PERFORMED               01150000
*              OTHERWISE, IT IS ASSUMED THAT INTERVENTION REQ'D MESSAGE 01200000
*              TO BE INTERROGATED                                       01250000
* OUTPUT       ALTERATION OF DISPLAY OR INDICATION THAT AUTO DELETION   01300000
*              TO BE TRIED BY DELETE RTN 4                              01350000
* EXTERNAL REFERENCES NONE                                              01400000
*                                                                       01450000
* EXITS - NORMAL  IEECVETH OR P OR R  DEVICE-DEPENDENT IO               01500000
*                 IEECVET9 DELETE 4                                     01550000
*                 IEECVET1 PROCESSOR                                    01600000
*       - ERROR   NONE                                                  01650000
*                                                                       01700000
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         01750000
*                   RESIDENT DISPLAY CONTROL MODULE (CONTAINED   S21003 01800000
*                   IN DSECT)                                    S21003 01850000
*                                                                       01900000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      01950000
*                                                                       02000000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      02050000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       02100000
*              CHARACTER SET.                                           02150000
*********************************************************************** 02200000
         EJECT                                                          02250000
*/*IEECVET7: CHART */                                                   02300000
*/*%START: E IEECVET7 DELETE 2 */                                       02350000
*/*%GO:        P       SET BASES */                                     02400000
*/*%TSTDOM:    D       (YES,DOMRTN,NO,) WAS A DOM ISSUED */             02450000
*/*TEST1: D (YES,,NO,XCTL) ANY INT. REQ'D MSGS */                       02500000
*/*%A1: P SET COUNT OF 20 INT REQ'D MSGS */                             02550000
*/*LISTINTR: P POINT TO CCW AREA SCT, SIB AND END OF SCT */             02600000
*/*%A2: D (YES,,NO,INTLOOP2) ANY MSGS LEFT TO DO */                     02650000
*/*INTLOOP: D (YES,,NO,INCRE2) THIS MSG AN INT REQ'D MSG */             02700000
*/*%A3: P SAVE DEVICE ADDRESS */                                        02750000
*/*%A4: D (YES,OUT,NO,) 20 MSGS DONE */                                 02800000
*/*INCRE2: P INCRE SCT, SIB CCW AREA PTRS */                            02850000
*/*%A5: D (YES,,NO,INTLOOP) END OF SCREEN */                            02900000
*/*OUT: P SAVE REGS 1 AND 2 */                                          02950000
*/*%A7: S IOSGEN:FIND SATISFIED INT REQD CONDITIONS */                  03000000
*/*MARK: P (,LISTINTR) ZERO COUNT OF 20 MSGS (IF NOT ZERO ALREADY) */   03050000
*/*INTLOOP2: D (YES,,NO,INCRE3) THIS A INT REQD MSG */                  03100000
*/*%B1: D (YES,,NO,INCCCW) THIS MSG SATISFIED */                        03150000
*/*%B2: P MARK MSG DELETEABLE REDUCE INT REQD COUNT */                  03200000
*/*INCCCW: D (YES,OUT2,NO,) END OF DOM LIST */                          03250000
*/*%B3: P POINT TO NEXT INT REQD ELEMENT */                             03300000
*/*INCRE3: P INCREMENT SCT SIB */                                       03350000
*/*%B4: D (YES,,NO,INTLOOP2) END OF SCREEN */                           03400000
*/*OUT2: P RESTORE REGS 1 AND 2 */                                      03450000
*/*%B5: D (YES,FINISHR,NO,) ALL MSGS TESTED FOR INT REQD */             03500000
*/*%B6: P (,INTLOOP) POINT TO CCW AREA SET CNT OF 20 MSGS */            03550000
*/*FINISHR: P INDICATE INT REQ DEL TRIED */                             03600000
*/*%B7:  D (YES,XCTL,NO,) DELETE REQUEST PENDING */                     03650000
*/*%B8: D (YES,,NO,BUILDCCW) DEL=Y */                                   03700000
*/*%B9: P SET AUTO DELETE TRIED */                                      03750000
*/*%C1: P SET TRY AUTO DELETE */                                        03800000
*/*DEL4: P SET DELETE 4 NAME IN XSA */                                  03850000
*/*XCTL: R TO ROUTINE SET IN XSA */                                     03900000
*/*BR14: P TURN OFF OUR RTNS IN CONTROL */                              03950000
*/*%C2: R BR REG14 */                                                   04000000
*/*DOMRTN: P TURN OFF DOM FLAG */                                       04050000
*/*%C3: P POINT TO START OF SCT,SIB,DOM TABLE */                        04100000
*/*%C4: P GET DOMLIST POINTER */                                        04150000
*/*%C5: D (YES,,NO,BR14) DOES A DOMLIST EXIST */                        04200000
*/*ELTEST: D (YES,,NO,NEXTLINK) USE THIS ELEMENT */                     04250000
*/*%CX: P SAVE POSSIBLE LINK POINTER */                                 04300000
*/*%SAVALL: P SAVE TCBLSQA INDEX AND TJID */                            04350000
*/*%USED: P INDICATE THIS ELEMENT USED */                               04400000
*/*LOOP2: P SAVE POSSIBLE DOM MSG ID */                                 04450000
*/*IDCOMP: D (YES,,NO,NEXT) MSG IN THIS LINE */                         04500000
*/*%TCBTJID: D (YES,,NO,INCRE4) DO TCBLSQA INDEX AND TJID MATCH */      04550000
*/*%LSQA: D (YES,MARK1,NO,) IS THIS DOM BY LSQA INDEX */                04600000
*/*%DOMID: D  (YES,MARK1,NO,) DO MSG IDS MATCH */                       04650000
*/*INCRE4: P POINT TO NEXT SCT,SIB,AND DOM ELEMENT */                   04700000
*/*%SCREND: D (YES,NEXT,NO,IDCOMP) END OF SCREEN */                     04750000
*/*NEXT: D (YES,NEXTLINK,NO,LOOP2) END OF THIS DOM LIST */              04800000
*/*NEXTLINK: D (YES,SETKEY3,NO,ELTEST) END OF DOM CHAIN */              04850000
*/*SETKEY3: D (YES,BR14,NO,) DELETE REQUEST PENDING */                  04900000
*/*BUILDCCW: D (YES,DEL4,NO,) INT REQD MSGS TO DELETE */                04950000
*/*%WRMSG: P INDICATE WRITE MSG AREA */                                 05000000
*/*%IO: P (,XCTL) SET XSA FOR IO ROUTINE */                             05050000
*/*MARK1: P (,INCRE4) MARK MESSAGE AS AUTO DELETEABLE */                05100000
*/*IEECVET7: END */                                                     05150000
         EJECT                                                          05200000
*********************************************************************** 05250000
*                                                                       05300000
*        REGISTER EQUATES                                               05350000
*                                                                       05400000
*********************************************************************** 05450000
X0       EQU   0              CTR FOR MSGS MOVED INTO CCW AREA          05500000
X1       EQU   1              PARM REG                                  05550000
XMSG     EQU   1              PTR TO MESSAGE AREA                       05600000
XWORK    EQU   2              WORK REG                                  05650000
XSCT     EQU   2        POINTER TO SCREEN CONTROL TABLE                 05700000
XWORK2   EQU   3              WORK REG                                  05750000
XDOMPTR  EQU   3        POINTER TO DOM ELEMENT                          05800000
XINC     EQU   4              INCRE FOR SCREEN CONTROL TABLE REG        05850000
XCOMP    EQU   5              ADDR OF LAST MSG IN SCT                   05900000
XDOMEL   EQU   6        POINTER TO DOM ID IN DOM ELEMENT                05950000
XWORK3   EQU   6              WORK REG                                  06000000
X7       EQU   7             UCM BASE                                   06050000
XCCWCTR  EQU   8              PTR TO CCW AREA                           06100000
X9       EQU   9              DCM BASE REG                              06150000
XA       EQU   10             PROGRAM BASE REG                          06200000
XB       EQU   11             CXSA BASE REG                             06250000
XC       EQU   12             UCM ENTRY BASE REG                        06300000
XIOB     EQU   13             IOB PTR REG                               06350000
XLINK    EQU   14                  LINK REGISTER                        06400000
XE       EQU   14             REG 14                                    06450000
XERTRN   EQU   14                                                       06460000
XDCMDOM  EQU   15                  POINTER TO DCM                       06500000
XF       EQU   15             REG 15                                    06550000
X1PARM   EQU   1                                                        06550400
X8UCME   EQU   8                                                        06552000
XFBRANCH EQU   15                                                       06560000
ENDLIST  EQU   X'80'          END OF LIST INDICATOR                     06600000
ZERO     EQU   0              ZERO                                      06650000
         SPACE 3                                                        06700000
         BALR  XA,N0     ESTABLISH PROGRAM ADDRESSIBILITY               06750000
         USING *,XA                                                     06800000
         B     BEGIN               BRANCH AROUND PATCH AREA             06810000
ICATCH   DC    CL8'IEECVET7'       EYECATCHER AND FIELD MAINTENANCE     06820000
         DC    CL8'&SYSDATE',CL56' '                                    06840000
BEGIN    EQU   *                   END OF PATCH AREA                    06844000
         LR    XB,X1               ESTABLISH CXSA ADDRESS               06850000
         USING CXSA,XB                                                  06900000
         L     XC,CSAUCM           ESTABLISH UCM ADDRESS                07000000
         USING UCMLIST,XC                                               07050000
         L     XDCMDOM,UCMXB            GET POINTER TO DCM              07100003
         USING DCMTSRT,XDCMDOM                                          07110003
         L     X9,DCMADTRN            LOAD T DCM BASE                   07150003
         USING DCMSTRT,X9          ESTABLISH DCM BASE REGISTER          07200000
         L     X7,CSACTLM          GET POINTER TO UCM                   07250000
         USING UCM,X7              ESTABLISH UCM BASE REGISTER          07300000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      07310000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    07320000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      07330000
         MVI   DCMUTILT,ZERO       CLEAR UTILITY FLAGS           S21003 07350000
         LH    XINC,DCMSCTCN            SCT INCREMENT                   07450000
         TM    UCMDEVC,UCMDEVD          Q. DOM ISSUED            S21003 07500000
         BO    DOMRTN                   YES,GO HANDLE DOM               07550000
         DROP  XDCMDOM                                                  07580003
XCTL     EQU   *                                                        11550000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  11600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 11610000
         BR    XFBRANCH            EXIT TO IEECVET1                     11650000
BR14     EQU   *                                                        11800000
         ICM   XWORK,15,CSANPTR    PTR TO RECOVERY AREA       JE YM6718 11810003
         BZ    NOESTAE             NOT THERE, BYPASS NSI      JE YM6718 11820003
         MVC   PARMRTAD-PARMLIST(8,XWORK),CSANAME RESTORE     JE YM6718 11830003
NOESTAE  DS    0H                                             JE YM6718 11840003
         NI    DCMMCSST,N255-DCMDUSE   INDIC OUR RTNS NOT IN CONTROL    11850000
         L     XE,CSAXA            PICK UP RETURN ADDRESS               11860000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          11870000
         L     X1PARM,DCMCXSVE     PASS CXSA ADDRESS IN REG 1           11880000
         BR    XFBRANCH            RELEASE LOCKS AND RETURN TO MCS      11900003
DOMRTN   EQU   *        THIS RTN WILL MARK DOMMED MSGS DELETABLE        11950000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           11960000
         L     X1PARM,DCMCXSVE     PASS CXSA ADDRESS IN REG 1           11970000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCAL AND CMS LOCKS           11980000
         NI    UCMDEVC,N255-UCMDEVD    TURN OFF DOM FLAG         S21003 12000000
         L     XCOMP,DCMADDRL      ADDR OF LAST MSG LINE IN SCT         12050000
         LR    XMSG,X7                 GET UCM POINTER           S21003 12100000
         SH    XMSG,FOUR               POINT TO PREFIX           S21003 12150000
         L     XMSG,N0(XMSG)           GET PTR TO UCM PREFIX            12200000
         USING UCMPRFX,XMSG            ESTABLISH BASE FOR UCM PREFIX    12250000
         L     XDOMPTR,UCMDOME         PTR TO FIRST DOM ELEMENT         12300000
         USING DOMC,XDOMPTR        DOM ELEMENT ADDRESSABILITY MB Y02958 12310000
         LA    XDOMPTR,N0(XDOMPTR) CLEAR HIGH ORDER BYTE       MD       12350000
         LTR   XDOMPTR,XDOMPTR     IS POINTER ZERO             MD       12400000
         BZ    BR14                YES FALSE ENTRY EXIT        MD       12450000
         DROP  XMSG                                                     12500000
         NI    DCMDSTAT,N255-DCMDSAUT    TURN OFF AUTO DEL TRIED BIT    12550000
ELTEST   EQU   *              TEST WHETHER TO USE THIS DOM ELEMENT      12600000
         L     XIOB,DCMASCRN           POINT TO FIRST MESSAGE MG  M1427 12650000
         LR    XDOMEL,XDOMPTR     SAVE PTR TO LINK PTR      JE @ZA00512 12660000
         TM    DOMCNTRL,DOMCPROC   USE THIS DOM ELEMENT       MB Y02958 12700000
         BNO   NEXTLINK                 NO, GO ON TO NEXT ELEMENT       12750000
         TM    DOMCNTRL,DOMCAUTH   AUTHORIZED MSGID CALL      ZZ        12760000
         BO    LOOP2               YES,DONT GET ASID AND JSTCB          12770000
         TM    DOMCNTRL,DOMCDBL+DOMCDBAJ  ANY MSG ID'S                 X12850000
                                   IN THIS BLOCK              MB Y02958 12860000
         BNZ   SAVID               NO SAVE ID AND TJID                  12900000
KICK4    EQU   *                                                        12950000
         LA    XDOMPTR,DOMCID      ADDRESS MSG ID ENTRIES     MB Y02958 13000000
         USING DOMCID,XDOMPTR      ADDRESSABILITY FOR                  X13010000
                                   MESSAGE ID ENTRIES         MB Y02958 13010400
         TM    DOMCFLAG,DOMCEND    IS THIS LAST ELEMENT       MB Y02958 13050000
         BNO   KICK4               NO GET NEXT ELEMENT        MD        13100000
SAVID    EQU   *                                              MD        13150000
         MVC   DCMDSAV+N4(N2),DOMCASID SAVE ASID              MB Y02958 13200000
         MVC   DCMDSAV+N6(N3),DOMCJTCB+N1 SAVE JSTCB ADDRESS  MB Y02958 13250000
         LR    XDOMPTR,XDOMEL      RESTORE PTR TO START OF LSTMD        13300000
         USING DOMC,XDOMPTR        MESSAGE ID ENTRY POINTER NOT        X13310000
                                   VALID UNTIL INCREMENTED    MB Y02958 13330000
LOOP2    EQU   *              LOOP THRO DOM ID S TESTING FOR MATCH WITH 13350000
*                             MSGS ON THE SCREEN                        13400000
         L     XSCT,DCMAMTAB       PTR TO BEGIN OF SCT        MD        13450000
         L     XDCMDOM,DCMDOMPK    POINT TO DOM TABLE         MD        13500000
         TM    DOMCNTRL,DOMCDBL+DOMCDBAJ DOM BY ASID OR JSTCB MB Y02958 13550000
         BNZ   IDCOMP              YES DON'T SAVE SEQ NO.     MD        13600000
         AH    XDOMEL,FOUR         GET FIRST ID               MD        13650000
         USING DOMCID,XDOMEL       ID ENTRY BASE VALID NOW    MB Y02958 13660000
         MVC   DCMDSAV+N9(N3),DOMCIDA SAVE ID                 MB Y02958 13700000
         L     XIOB,DCMASCRN       POINT TO FIRST MESSAGE     MG  M1427 13750000
IDCOMP   EQU   *                                                        13800000
         TM    N0(XSCT),DCMMSGIN   MESSAGE IN LINE                      13850000
         BNO   NEXT                NO GET NEXT DOM ELEMENT              13900000
         TM    DOMCNTRL,DOMCDBL+DOMCDBAJ DOM ASID OR JSTCB    MB Y02958 13950000
         BNZ   CHECK7              YES, TEST FOR DECRIPTOR CODE 7       14000000
         TM    DOMCNTRL,DOMCAUTH   AUTHORIZED REQUEST         MB Y02958 14010000
         BNO   FULLCOMP            NO, CHECK TCB AND MSG ID   MB Y02958 14020000
         CLC   N5(N3,XDCMDOM),DCMDSAV+N9 CHECK MSG ID         MB Y02958 14030000
         BE    MARK1               MARK MSG DELETABLE         MB Y02958 14040000
         B     INCRE4              NOT FOUND, KEEP LOOKING    MB Y02958 14044000
FULLCOMP EQU   *          CHECK ASID AND JSTCB WITH MSG ID    MB Y02958 14046000
         CLC   N0(N8,XDCMDOM),DCMDSAV+N4  COMPARE ID NUMBERS  MB Y02958 14050000
         BE    MARK1                    YES, GO MARK MSG DELETABLE      14100000
INCRE4   EQU   *                                                        14150000
         LA    XDCMDOM,N8(XDCMDOM)                                      14200000
         AH    XIOB,DCMCORLN            POINT TO NEXT LINE    MG  M1427 14250000
         BXLE  XSCT,XINC,IDCOMP         INCRE TO NEXT MSG IN SCT        14300000
NEXT     EQU   *                                                        14350000
         TM    DOMCNTRL,DOMCDBL+DOMCDBAJ DOM BY ASID OR JSTCB MB Y02958 14400000
         BNZ   NEXTLINK            YES NO MORE IDS            MD        14450000
         TM    DOMCFLAG,DOMCEND    END OF DOM ELEMENT CHAIN   MB Y02958 14500000
         BNO   LOOP2                    NO,TEST NEXT DOM ID FOR MATCH   14550000
NEXTLINK EQU   *                                                        14600000
         L     XDOMPTR,DOMCLNK     GET NEXT DOM ELEMENT       MB Y02958 14650000
         LA    XDOMPTR,N0(XDOMPTR)      CLEAR HIGH ORDER BYTE           14700000
         LTR   XDOMPTR,XDOMPTR          Q. IS LINK PTR ZERO             14750000
         BNZ   ELTEST                   NO,GO TEST TO SEE WHETHER TO    14800000
*                                       USE THIS DOM ELEMENT            14850000
         TM    DCMUTILT,DCMUTILB   IO TO DO                   MB Y02958 14860000
         BNO   BR14                NO, RETURN IMMEDIATELY     MB Y02958 14870000
WHATELSE TM    UCMSTS,UCMBF        IS THE DEVICE BUSY         MG S21003 14900003
         BNO   SETKEY3             NO, KEEP GOING             MG S21003 14950000
         TM    DCMUTILT,DCMUTILB   WAS ANYTHING DOMMED        MH Y02131 14960003
         BZ    BR14                 NO, GO TO MCS             MH Y02131 14970003
         NI    DCMUTILT,X'FF'-DCMUTILB  TURN OFF FLAG         MH Y02131 14980003
         L     XDCMDOM,UCMXB            POINT TO RDCM                   14990003
         USING DCMTSRT,XDCMDOM           BASE RDCM                      14992003
         OI    DCMRFLGS,DCMDOM     IND SCRN UPDATE NEEDED               15000003
         B     BR14                RETURN TO MCS              MG S21003 15150000
         DROP  XDCMDOM                                                  15200003
MARK1    EQU   *                                                        15250000
         NI    N0(XSCT),N255-DCMMSGWR-DCMMSGIF   TURN OFF SCT    S21003 15300000
         NI    N1(XSCT),N255-DCMMSGAC-DCMMSGC7-DCMMSGDM   FLAGS  S21003 15350000
         MVI   N2(XIOB),VERTBAR         MARK WITH VERTICLE BAR   S21003 15400000
         MVI   N3(XIOB),CBLANK          REMOVE ACTION *          S21003 15450000
         OI    N0(XSCT),DCMMSGAD        MARK AUTO DELETABLE      S21003 15500000
         C     XIOB,DCMWTBUF       MESSAGE BEHIND A DISPLAY   MB YM4087 15502000
         BNL   INCRE4              YES, DONT DO IO            MB YM4087 15504000
         OI    DCMUTILT,DCMUTILB   IO TO DO                   MH Y02131 15510003
         B     INCRE4                   GO FINISH SEARCH                15550000
CHECK7   EQU   *                                              MD        15600000
         TM    N1(XSCT),DCMMSGC7   DESC. CODE 7 MSG           MD        15650000
         BNO   INCRE4              NO NOT DOMMABLE            MD        15700000
         TM    DOMCNTRL,DOMCDBL MATCH ON ASID ONLY            MB Y02958 15750000
         BO    COMPASID            YES CHECK ASID ONLY                  15800000
         CLC   DCMDSAV+N4(N5),N0(XDCMDOM) DO JSTCBS MATCH               15850000
         BNE   INCRE4              NO CHECK NEXT LINE         MD        15900000
         B     MARK1               YES, MARK FOR DELETION               15910000
COMPASID EQU   *                                                        15950000
         CLC   DCMDSAV+N4(N2),N0(XDCMDOM) ASID MATCH                    16000000
         BE    MARK1               YES MARK MSG               MD        16050000
         B     INCRE4              GET NEXT LINE              MD        16100000
SETKEY3  EQU   *                                                 S21003 16300000
         USING DCMTSRT,XF           BASE RDCM                           16350000
         L     XF,UCMXB            GET POINTER TO RDCM        MD        16400000
         CLI   DCMRQDEL,BLANK          Q. IS A DELETE REQUEST PENDING   16450000
         DROP  XF                  DROP RDCM BASE             MD        16500000
         BNE   BR14                EXIT TO MCS                          16550000
         TM    DCMUTILT,DCMUTILB   WAS ANYTHING DOMMED        MH Y02131 16560003
         BZ    BR14                NO, GO TO MCS              MH Y02131 16570003
BUILDCCW EQU   *                                                        16600000
         OI    DCMIOCM1,DCMWRMSG   INDICATE WRITE MESSAGE AREA          16750000
IOEXIT   EQU   *                                                        16800000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              16850000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 16860000
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         16900000
         EJECT                                                          17350000
*********************************************************************** 17400000
*                                                                       17450000
*        CONSTANTS                                                      17500000
*                                                                       17550000
******************************************************************      17600000
FOUR     DC    H'4'                FOUR                                 17750000
H20      DC    H'20'               NUMBER                               17850000
         SPACE 3                                                        18050000
*********************************************************************** 18100000
*                                                                       18150000
*        EQUATE STATEMENTS                                              18200000
*                                                                       18250000
*********************************************************************** 18300000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            18310000
ID2      EQU   C'7'                2ND CHARACTER OF CSECT ID            18320000
DOMSET   EQU   X'40'              INDICATES MSG TO BE DOMMED            18350000
N0       EQU   0                  NUMBER                                18450000
N1       EQU   1                  NUMBER                                18500000
N2       EQU   2                  NUMBER                                18550000
N3       EQU   3                  NUMBER                                18600000
N4       EQU   4                  NUMBER                                18650000
N5       EQU   5                  NUMBER                                18700000
N6       EQU   6                  NUMBER                                18750000
N7       EQU   7                  NUMBER                      MD        18800000
N8       EQU   8                  NUMBER                                18850000
N9       EQU   9                   NUMBER                               18860000
N12      EQU   12                 NUMBER                                18900000
N14      EQU   14                 NUMBER                                19000000
N15      EQU   15                 NUMBER                                19050000
N17      EQU   17                 NUMBER                                19100000
N21      EQU   21                 NUMBER                                19150000
N28      EQU   28                 NUMBER                                19200000
N32      EQU   32                 NUMBER                                19250000
N39      EQU   39                 NUMBER                                19300000
N40      EQU   40                 NUMBER                                19350000
N80      EQU   X'80'              DOM KEY BIT                 MG  M1427 19400000
N255     EQU   255                NUMBER                                19450000
VERTBAR  EQU   C'|'          VERTICAL BAR                               19500000
CBLANK   EQU   C' '          BLANK                                      19550000
BLANK    EQU   C' '          BLANK CHARACTER                            19600000
CN       EQU   C'N'          CHARACTER N                                19750000
CHARY    EQU   C'Y'          CHARACTER Y                                19800000
         EJECT                                                          19900000
*********************************************************************** 19950000
*                                                                       20000000
*        DSECTS                                                         20050000
*                                                                       20100000
*********************************************************************** 20150000
         EJECT                                                          20160003
         IHACTM FTPT                                          JE YM6718 20170003
         IEERDCM                                                        20200000
         EJECT                                                          20300000
         IEETDCM                                                        20350000
         EJECT                                                          20450000
         IEECUCM  FORMAT=NEW                                            20550000
         EJECT                                                          20600000
         IHACTM  CXSA                                                   20700000
         EJECT                                                          20750000
         IHADOMC                                                        20760000
         EJECT                                                          20770000
UNIT     DSECT                                                          20800000
         IEFUCBOB                                                       20850000
         EJECT                                                          20900000
         CVT   DSECT=YES                                                20950000
    END                                                                 21200000
./  ADD  SSI=62050087,NAME=IEECVET8
IEECVET8 CSECT                                                          00200000
*********************************************************************** 00400000
         TITLE 'IEECVET8 IGC5807B DELETE 3'                             00600000
*********************************************************************** 00800000
*                                                                     * 01000000
* STATUS       CHANGE LEVEL=0                                         * 01200000
*                                                                     * 01400000
* APARS FIXED ZA08078                                                 * 01600000
*                                                                     * 01800000
* FUNCTION     THIS ROUTINE ANALYZES DELETION OF MESSAGES REQUESTED BY* 02000000
*              K E,SEG OR BY CURSOR OR LIGHT PEN DETECT               * 02200000
*                                                                     * 02400000
* ENTRY POINT  IEECVET8                                               * 02600000
*                                                                     * 02800000
* INPUT        INDICATION OF K E,SEG,CURSOR DELETE                    * 03000000
*              THE FOLLOWING BIT INDICATES A CURSOR OR LIGHT PEN      * 03200000
*              REQUEST                                                * 03400000
*                   DCMCOM1,DCMCOMRD  X'08'                           * 03600000
*              DCMDSAV  CONTAINS THE NUMBER OF THE MESSAGE THE DETECT * 03800000
*                       OCCURRED ON                                   * 04000000
*              DCMDSAV+8 CONTAINS THE SCREEN CONTROL TABLE ENTRY FOR  * 04200000
*                        THE MESSAGE THE DETECT OCCURRED ON           * 04400000
*              THE APPROPRIATE MESSAGES ARE MARKED FOR DELETION, AND  * 04600000
*              ALL VISIBLE MESSAGES ARE NUMBERED.                     * 04800000
*                                                                     * 05000000
* OUTPUT       ALTERATION OF DISPLAY- INDICATION OF MESSAGES TO BE    * 05200000
*              DELETED                                                * 05400000
*                                                                     * 05600000
* EXTERNAL REFERENCES NONE                                            * 05800000
*                                                                     * 06000000
* EXITS - NORMAL  IEECVETH OR P OR R  DEVICE-DEPENDENT IO             * 06200000
*                 IEECVET9 DELETE 4                                   * 06400000
*       - ERROR   IEECVETE MESSAGE 2                                  * 06600000
*                                                                     * 06800000
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)       * 07000000
*                   SCREEN CONTROL TABLE (SCT)                        * 07200000
*                   SECONDARY SCREEN CONTROL TABLE (SSCT)             * 07400000
*                                                                     * 07600000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                    * 07800000
*                                                                     * 08000000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A    * 08200000
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL     * 08400000
*              CHARACTER SET.                                         * 08600000
*                                                                     * 08800000
*                                                                     * 09000000
*********************************************************************** 09200000
         EJECT                                                          09400000
*/*IEECVET8: CHART */                                                   09600000
*/*IEECVET8: E DELETE RTN 3 */                                          09800000
*/* P ESTABLISH BASE REGISTERS */                                       10000000
*/* D (NO,,YES,LPDEL) LP/CURSOR DELETION ? */                           10200000
*/* D (NO,,YES,ERROR) IS SEG = 0 ? */                                   10400000
*/* P FIND LAST MSG ENTRY IN SCT */                                     10600000
*/*DELET: D (NO,DSETUP,YES,) IS LAST MSG IN SEG CONTINUED ? */          10800000
*/* P INCLUDE CONTINUED LINE */                                         11000000
*/*DSETUP: P FIND FIRST MSG ENTRY IN SCT */                             11200000
*/*DSETUP1: P SET UP TO LOOP THRU MESSAGES */                           11400000
*/*LOOP: D (NO,NOUT,YES,) IS A MSG IN THIS LINE ? */                    11600000
*/* S NUMBER RTN: GO NUMBER THE MESSAGE */                              11800000
*/* D (NO,,YES,NNEXT) MSG IN A STATUS DISPLAY ? */                      12000000
*/* D (NO,L1,YES,NNEXT) CONTINUED LINE IN A STATUS DISP ? */            12200000
*/*L1: D (NO,,YES,TURNOFF) MSG ABOVE DELETE RANGE ? */                  12400000
*/*SLOOP: D (NO,,YES,RESET) IS MSG AN ACTION MSG ? */                   12600000
*/*SET: P INDICATE DELETION POSSIBLE */                                 12800000
*/* P MARK MSG WITH VERTICLE BAR */                                     13000000
*/*NNEXT: P GO TO NEXT MESSAGE */                                       13200000
*/* D (NO,,YES,LOOP) MORE MESSAGES TO DO ? */                           13400000
*/*NOUT: D (NO,,YES,MOVENT) LP/CURSOR DELETE WTOR ? */                  13600000
*/* D (NO,ERROR1,YES,) ANY MESSAGES TO DELETE? */                       13800000
*/* P PUT COMMAND IN ENTRY AREA */                                      14000000
*/*MOVENT: P PUT COMMAND IN DELETE REQUEST BUFFER */                    14200000
*/* D (NO,,YES,VERIFMSG) IS VERIFY REQUIRED ? */                        14400000
*/*DEL4EXIT: P (,XCTL) SET EXIT TO IGC5907B */                          14600000
*/*VERIFMSG: P INDICATE VERIFICATE INSTR NEEDED */                      14800000
*/*CURSCOMP: P SET CURSOR POS TO LINE 1, CHAR 5 */                      15000000
*/*IOEXIT: P SET EXIT TO IGC5D07B */                                    15200000
*/*XCTL: R NEST LOAD */                                                 15400000
*/*ERROR1: P (,ERRORALL) INDICATE NO DELETABLE MESSAGES */              15600000
*/*ERROR: P INDICATE SEG = 0 */                                         15800000
*/*ERRORALL: P INDICATE WRITE ERROR MSG */                              16000000
*/* P FIND POSITION OF OPERAND */                                       16200000
*/* D (NO,,YES,LINE2) SET LINE NUMBER TO 1 */                           16400000
*/*STCURS: P SET CURSOR POSITION IN LINE */                             16600000
*/*ERRNUM: P SET UP LOOP THRU MSGS */                                   16800000
*/*LOOP1: D (NO,OUT,YES,) MESSAGE IN LINE ? */                          17000000
*/* S NUMBER RTN: GO NUMBER MESSAGES */                                 17200000
*/* D (NO,LOOP1,YES,) ALL MESSAGES DONE ? */                            17400000
*/*OUT: P HOLD LAST NUMBER */                                           17600000
*/*MSGEXIT: P (,XCTL) SET EXIT TO IGC5E07B */                           17800000
*/*NUMBER: E NUMBER RTN */                                              18000000
*/* P CONVERT NUMBER FOR PRINT */                                       18200000
*/* D (NO,MOVENUM,YES,) ONE DIGIT NUMBER ? */                           18400000
*/* P BLANK FIRST DIGIT */                                              18600000
*/*MOVENUM: P PUT NUMBER IN MESSAGE LINE */                             18800000
*/* R BR 14 */                                                          19000000
*/*LINE2: P (,STCURS) SET LINE NUMBER TO TWO */                         19200000
*/*TURNOFF: P TURN OFF DELETE REQUEST BIT */                            19400000
*/* D (NO,REMOVE,YES,) IS THIS AN INFORM MSG ? */                       19600000
*/* P PUT HORIZONTAL BAR IN MSG */                                      19800000
*/*RESET: P TURN OFF DELETE REQUEST FLAG */                             20000000
*/*REMOVE: P PUT VERTICLE BAR IN MESSAGE */                             20200000
*/* D (NO,EXITB,YES,) IS THIS AN ACTION MESSAGE ? */                    20400000
*/* P PUT AN ASTERISK IN THE MESSAGE */                                 20600000
*/*EXITB: R BR 14 */                                                    20800000
*/*LPDEL: P GET SCT ADDR FOR DELETION */                                21000000
*/* D (NO,DELET,YES,) IS THIS AN ACTION MSG ? */                        21200000
*/* P INDICATE THIS IS A WTOR */                                        21400000
*/*MARKWTOR: D (NO,MARKOK,YES,) IS THIS A CONTINUATE LINE ? */          21600000
*/* P ALTER POINTERS TO INCLUDE FIRST LINE */                           21800000
*/*MARKOK: P INDICATE DELETE REQUESTED AND MSG DELETABLE */             22000000
*/* D (NO,ENTSETUP,YES,) IS WTOR CONTINUED ? */                         22200000
*/* P (,MARKWTOR) GO TO NEXT LINE */                                    22400000
*/*ENTSETUP: P BLANK THE ENTRY AREA */                                  22600000
*/* P PUT COMMAND (K E,NN) IN ENTRY AREA */                             22800000
*/* P INDICATE MESSAGES NUMBERED */                                     23000000
*/*NUMTURN: D (NO,NOUT,YES,) MESSAGE IN THIS LINE ? */                  23200000
*/* S NUMBER RTN:NUMBER MESSAGE */                                      23400000
*/* D (NO,,YES,TURNOFF) MSG OUTSIDE DELETE RANGE ? */                   23600000
*/*UPDTE: P (,NOUT) GO TO NEXT MESSAGE */                               23800000
*/*IEECVET8: END */                                                     24000000
          EJECT                                                         24200000
***                                                                   * 24400000
***      REGISTER EQUATES                                             * 24600000
***                                                                   * 24800000
X0       EQU   0         SECONDARY SCREEN CONTROL TABLE PTR      S21002 25000000
X1       EQU   1         REG 1                                          25200000
XNUM     EQU   1         REG 1                                          25400000
XWORK    EQU   2         WORK REG.                                      25600000
XSCT     EQU   2                        SCREEN CONTROL TABLE PTR        25800000
XHCTR    EQU   3         HIGH VALUE FOR NN                              26000000
XDOMEL   EQU   3                        PTR TO DOM ID IN DOM ELEMENT    26200000
XINC     EQU   4         INCREMENT REG (BXLE)                           26400000
XCOMP    EQU   5         COMPARAND (BXLE)                               26600000
XLCTR    EQU   6         LOW VALUE FOR NN                               26800000
XDCMDOM  EQU   6         PTR TO DOM ID IN DCM                           27000000
X7       EQU   7         UCM BASE REG                                   27200000
R7SCT    EQU   7         SCT TABLE POINTER                              27400000
XMSG     EQU   8         BRANCH REG.                                    27600000
X9       EQU   9         DCM BASE REG                                   27800000
XA       EQU   10        PROGRAM BASEREG.                               28000000
XB       EQU   11        CXSA BASE REG.                                 28200000
XC       EQU   12        UCM ENTRY BASE REG.                            28400000
XE       EQU   14        REG 14                                         28600000
X13      EQU   13        RESIDENT DCM BASE REGISTER              S21002 28800000
XCCWCTR  EQU   14        REG TO COUNT CCW'S CONSTRUCTED                 29000000
XF       EQU   15        REG 15                                         29200000
XMASK    EQU   15        MASK REGISTER                                  29400000
XRETURN  EQU   15        REG 15                                         29600000
RETURN   EQU   15        REG 15                                         29800000
X1PARM   EQU   1                                                        30000000
XFBRANCH EQU   15                                                       30200000
         EJECT                                                          30400000
***                                                                     30600000
***  ESTABLISH BASE REGISTERS                                           30800000
***                                                                     31000000
         BALR  XA,N0                    ESTABLISH PROGRAM ADDRESSIBIL   31200000
         USING *,XA                                                     31400000
         B     ICATCH          BRANCH AROUND EYECATCHER                 31600000
         DC    C'01 MODULE IGC5807B, FICHE IEECVET8  '  EYECATCHER AND  31800000
ZAPAREA  DC    12C'ZAP'    RESERVED FOR FIELD MODIFICATION              32000000
ICATCH   LR    XB,X1                    ESTABLISH CXSA ADDRESS          32200000
         USING CXSA,XB                                                  32400000
         L     XC,CSAUCM                ESTABLISH UCM ADDRESS           32600000
         USING UCMLIST,XC                                               32800000
         L     X13,UCMXB           GET PTR TO RESIDENT DCM       S21002 33000000
         L     X9,N0(X13)          GET PTR TO TRANSIENT DCM      S21002 33200000
         USING DCMTSRT,X13         ADDRESSIBILITY RESIDENT DCM          33400000
         USING DCMSTRT,X9                                               33600000
         L     X7,CSACTLM               GET PTR TO UCM                  33800000
         USING UCM,X7                                                   34000000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      34200000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    34400000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      34600000
         MVI   DCMUTILT,ZERO       ZERO UTILITY BYTE                    34800000
         LH    XINC,DCMSCTCN       GET INCREMENT FOR SCREEN CONTROL TAB 35000000
         SR    XHCTR,XHCTR         ZERO REGISTER                        35200000
         L     XMSG,DCMASCRN       ADDR OF FIRST MSG LINE IN BUFFER     35400000
         L     XLCTR,DCMAMTAB      ADDR OF SCT FOR MSG 1                35600000
         TM    DCMCOM1,DCMCOMRD    Q. PERFORM DELETE AS INDICATED BY    35800000
*                                     LIGHT PEN OR CURSOR               36000000
         BO    LPDEL               YES, GO SET UP FOR IT                36200000
         IC    XHCTR,DCMSEG        GET SEG VALUE                        36400000
         LTR   XHCTR,XHCTR         Q. IS SEG VALUE EQUAL TO ZERO        36600000
         BZ    ERROR               YES, ERROR                           36800000
         MH    XHCTR,DCMSCTCN      COMPUTE SCREEN CONTROL ADDR OF       37000000
         SR    XHCTR,XINC           LAST MSG OF SEGMENT                 37200000
         AR    XHCTR,XLCTR                                              37400000
DELET    EQU   *                                                        37600000
         LA    XF,NNEXT            GET  RETURN ADDR FOR TURNOFF RTN     37800000
CONT1    TM    N0(XHCTR),DCMMSGCN  Q. IS LAST MSG IN SEG CONTINUED      38000000
         BNO   DSETUP              NO                                   38200000
         AR    XHCTR,XINC          INCREMENT TO INCLUDE CONTINUED LINE  38400000
         B     CONT1               CHECK FOR FURTHER CONTIN             38600000
DSETUP   EQU   *                                                        38800000
         LR    XWORK,XLCTR         ADDR OF FIRST MSG IN SCT             39000000
DSETUP1  EQU   *                                                        39200000
         L     XCOMP,DCMADDRL      ADDR OF LAST MSG IN SCT              39400000
         SR    XNUM,XNUM           ZERO NUMBER REG                      39600000
         OI    DCMDSTAT,DCMDSTNM   TURN ON MSGS NUMBEREA BIT            39800000
         L     X0,DCMADSEC         ADDR OF STATUS DISPLAYS SSCT  S21002 40000000
LOOP     EQU   *                                                        40200000
         TM    N0(XWORK),DCMMSGIN  Q. IS THERE A MESSAGE IN THIS LINE   40400000
         BZ    NOUT                NO, EXIT                             40600000
***                                                                     40800000
***   NUMBER MESSAGES                                                   41000000
***                                                                     41200000
         BAL   XE,NUMBER           GO NUMBER MESSAGES                   41400000
         LR    XE,X0               ADDR OF SSCT MSG ENTRY        S21002 41600000
         LR    R7SCT,XWORK         GET SCT POINTER                      41800000
***                                                              S21002 42000000
***        IS THIS MESSAGE LINE IN A STATUS DISPLAY              S21002 42200000
***                                                              S21002 42400000
TESTDISP TM    N0(XE),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL        S21002 42600000
         BNZ   NNEXT               BRANCH YES                    S21002 42800000
         TM    N0(R7SCT),DCMMSGCN  Q. DOES IT HAVE A CONTINUATION LINE  43000000
         BNO   L1                  NO                                   43200000
         LA    XE,N1(XE)          POINT TO NEXT SSCT                    43400000
         AH    R7SCT,DCMSCTCN     POINT TO NEXT SCT                     43600000
         B     TESTDISP           TEST FOR FURTHER CONTIN               43800000
***                                                              S21002 44000000
***        IS THE CONTINUED LINE IN A STATUS DISPLAY             S21002 44200000
***                                                              S21002 44400000
         TM    N1(XE),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL        S21002 44600000
         BZ    L1                  BRANCH NO                     S21002 44800000
         B     NNEXT               GO ON                                45000000
L1       EQU   *                                                        45200000
         CLR   XWORK,XHCTR         Q. IS MSG ABOVE RANGE FOR DELETION   45400000
         BH    TURNOFF             YES, REMOVE VERTICAL BAR, IF ANY     45600000
SLOOP    EQU   *                                                        45800000
         TM    N1(XWORK),DCMMSGAC  Q. IS MSG AN ACTION MESSAGE          46000000
         BO    RESET               YES REMARK IF PREVIOUSLY DELETABLE   46200000
SET      EQU   *                                                        46400000
         OI    DCMUTILT,DCMUTILA   SET BIT- DELETION POSSIBLE           46600000
         OI    N0(XWORK),DCMMSGRD  TURN ON DELETE REQUEST BIT           46800000
         ST    XMSG,CSAXD          SAVE ADDRESS OF MSG NUMBER           47000000
         MVI   N2(XMSG),VERTBAR    MARK MSG WITH VERTICAL BAR           47200000
NNEXT    EQU   *                                                        47400000
         AH    XMSG,DCMCORLN       INCRE ADDR OF MSG IN BUFFER   S21003 47600000
         AH    X0,ONE              INCREMENT SSCT BY LENGTH      S21002 47800000
         BXLE  XWORK,XINC,LOOP     LOOP UNTIL ALL MSGS ARE SEARCHED     48000000
NOUT     EQU   *                                                        48200000
         STH   XNUM,DCMADNUM       SAVE LAST NUMBER USED                48400000
         L     XE,DCMAENTR         GET ADDR OF ENTRY AREA               48600000
         TM    DCMUTILT,DCMUTILB   Q. LP OR CURSOR DELETE OF A WTOR     48800000
         BO    MOVENT              YES                                  49000000
         TM    DCMUTILT,DCMUTILA   Q. ANY MESSAGES DELETABLE            49200000
         BNO   ERROR1              NO, ERROR- NO DELETABLE MSGS         49400000
         MVI   N0(XE),BLANK        MOVE BLANK INTO ENTRY AREA           49600000
         LH    XWORK,DCMELGN       GET LENGTH OF ENTRY FOR BLANKING     49800000
         EX    XWORK,MVBLNK             EXECUTE MOVE INSTRUC            50000000
         MVC   N0(N6,XE),KCOMMAND  MOVE COMMAND INTO ENTRY AREA         50200000
         L     XMSG,CSAXD          RESTORE ADDRESS OF MSG NUMBER        50400000
         MVC   N6(N2,XE),N0(XMSG)  MOVE IN NUMBER                S21002 50600000
         CLI   N6(XE),CBLANK       Q. A ONE DIGIT NUMBER                50800000
         BNE   MOVENT              NO                                   51000000
         MVC   N6(N1,XE),N7(XE)    YES, MOVE OVER DIGIT                 51200000
         MVI   N7(XE),CBLANK       BLANK OUT FORMER POSITION            51400000
MOVENT   EQU   *                                                        51600000
         MVC   DCMRQDEL(N6),N2(XE) MOVE COMMAND INT DEL REQUEST BUF     51800000
         CLI   DCMDEL,R            ROLL OR ROLL DELETE MODE?   @ZA08078 52000000
         BE    DEL4EXIT            YES, BR. TO IEECVET9 EXIT   @ZA08078 52200000
         TM    DCMOPTST,DCMOPTVR        Q. IS VERIFICATION REQUIRED     52400000
         BO    VERIFMSG                 YES, GO SET UP VERIF MSG        52600000
DEL4EXIT EQU   *                                                        52800000
         L     XFBRANCH,DCMNDEL4   LOAD DELETE 4 ADDRESS                53000000
         B     XCTL                EXIT TO IEECVET9                     53200000
VERIFMSG EQU   *                                                        53400000
         NI    DCMCOM1,N255-DCMLPENT   TURN OFF LIGHT PEN DELETE FLAG   53600000
         OI    DCMCMSG2,DCMDLREQ        INDIC MOVE IN VERIFIC INSTRUC   53800000
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS+DCMWRENT+DCMINSC              54000000
CURSCOMP EQU   *                                                        54200000
         MVI   DCMCULNO,N1         SET LINE NUMBER (IN ENTRY AREA) TO 1 54400000
         MVI   DCMPOSCU,N5         MOVE IN CURSOR POSITION              54600000
IOEXIT   EQU   *                                                        54800000
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               55000000
*                                  FOR EXIT TO IEECVETD                 55200000
XCTL     EQU   *         EXIT FROM MODULE                               55400000
         NI    DCMCOM1,N255-DCMCOMRD   TURN OFF DELET FLAG              55600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 55800000
         BR    XFBRANCH            EXIT TO ADDRESS ALREADY SET          56000000
ERROR1   EQU   *                                                        56200000
         OI    DCMCMSG3,DCMCDLR1    INDICATE NO DEL ETABLE MSGS         56400000
         B     ERRORALL            GO INDIC WRITE DELETE REQ INCONS     56600000
ERROR    EQU   *                                                        56800000
         OI    DCMCMSG3,DCMCDLR3   INDICATE SEG EQUAL TO 0              57000000
ERRORALL EQU   *                                                        57200000
         MVI   DCMRQDEL,CBLANK     BLANK THE DELETE REQUEST BUFFER      57400000
         MVC   DCMRQDEL+N1(N7),DCMRQDEL                                 57600000
         OI    DCMCMSG2,DCMDELRI   INDICATE WRITE ERROR MSG             57800000
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS+DCMINSC                       58000000
         L     X1,DCMADOPN         GET ADDR OF OPERAND                  58200000
         L     XWORK,DCMAENTR      GET ADDR OF ENTRY AREA               58400000
         SR    X1,XWORK            SUBTRACT TO GET DOS OF OPERAND       58600000
         CH    X1,DCMCORLN         Q. IS OPERAND ON LINE 2       S21003 58800000
         BH    LINE2               YES                                  59000000
         AH    X1,ONE              NO, INCREMENT POS BY 1               59200000
         MVI   DCMCULNO,N1         SET LINE NUMBER(IN ENTRY AREA) TO 1  59400000
STCURS   EQU   *                                                        59600000
         STC   X1,DCMPOSCU         SET CURSOR POSITION                  59800000
ERRNUM   EQU   *                                                        60000000
         SR    XNUM,XNUM           ZERO NUMBER CTR                      60200000
         L     XWORK,DCMAMTAB      GET ADDR OF FIRST MSG IN SCT         60400000
         L     XCOMP,DCMADDRL      GET ADDR OF LAST NUM                 60600000
         L     XMSG,DCMASCRN       GET ADDR OF FIRST MSG IN BUFFER      60800000
LOOP1    EQU   *                                                        61000000
         TM    N0(XWORK),DCMMSGIN    Q. MSG IN LINE                     61200000
         BNO   OUT                 EXIT                                 61400000
         BAL   XE,NUMBER           GO MOVE IN NUMBER                    61600000
         AH    XMSG,DCMCORLN       INCRE TO NEXT MSG IN BUFFER   S21003 61800000
         BXLE  XWORK,XINC,LOOP1    LOOP UNTIL NO MORE MSGS              62000000
OUT      EQU   *                                                        62200000
         STH   XNUM,DCMADNUM       STORE NUMBER                         62400000
MSGEXIT  EQU   *                                                        62600000
         L     XFBRANCH,DCMNMSG2   LOAD MESSAGE 2 ADDRESS               62800000
         B     XCTL                EXIT TO IEECVETE                     63000000
***                                                                     63200000
***   NUMBER MESSAGE                                                    63400000
***                                                                     63600000
NUMBER   EQU   *                                                        63800000
         AH    XNUM,ONE            INCREMENT TO NEXT NUMBER             64000000
         CVD   XNUM,DCMPACK        CONVERT NUMB TO DECIMAL              64200000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2)    UNPACK NUMBER         64400000
         OI    DCMCVBIN+N3,CF0     FIX SIGN                             64600000
         CLI   DCMCVBIN+N2,CF0     Q. A ONE-DIGIT NUMBER                64800000
         BNE   MOVENUM             NO, GO MOVE 2 DIGITS                 65000000
         MVI   DCMCVBIN+N2,BLANK   YES, BLANK OUT FIRST DIGIT           65200000
MOVENUM  EQU   *                                                        65400000
         MVC   N0(N2,XMSG),DCMCVBIN+N2  MOVE NUMBER INTO MESSAGE LINE   65600000
         BR    XE                  RETURN TO CALLER                     65800000
LINE2    EQU   *                                                        66000000
         MVI   DCMCULNO,N2         SET LINE NUMBER TO 2                 66200000
         SH    X1,DCMCORLN         THEN GO TO                    S21003 66400000
         B     STCURS              STORE CURSOR POSITION                66600000
TURNOFF  EQU   *                                                        66800000
         NI    N0(XWORK),N255-DCMMSGRD  TURN OFF DELETE REQUEST BIT     67000000
         TM    N0(XWORK),DCMMSGIF       Q. AN INFORMATIONAL MSG         67200000
         BZ    REMOVE                   NO,GO REMOVE BAR                67400000
         MVI   N2(XMSG),HORBAR          REPLACE HORIZONTAL BAR          67600000
         BR    XF                  RETURN TO CALLER                     67800000
RESET    NI    N0(XWORK),N255-DCMMSGRD   TURN OFF DELETE BIT            68000000
REMOVE   EQU   *                                                        68200000
         MVI   N2(XMSG),CBLANK           REMOVE VERTICAL BAR            68400000
         TM    N1(XWORK),DCMMSGAC      Q. AN ACTION MESSAGE             68600000
         BNO   EXITB               NO, RETURN TO CALLER                 68800000
         TM    N1(XWORK),DCMMSGPP  THIS A PP ACTION MSG.      MD Y01958 69000000
         BNO   ASTER               NO MARK WITH AN ASTERISK   MD Y01958 69200000
         MVI   N3(XMSG),PPACT      MOVE IN '@'                MD Y01958 69400000
         B     EXITB               EXIT THIS SUBROUTINE       MD Y01958 69600000
ASTER    EQU   *                                              MD Y01958 69800000
         MVI   N3(XMSG),ASTERISK       MOVE IN ASTERISK                 70000000
EXITB    EQU   *                                                        70200000
         BR    XF                  RETURN TO CALLER                     70400000
LPDEL    EQU   *                                                        70600000
         L     XHCTR,DCMDSAV+N8    GET SCT ADDR FOR DELETION AS PASSED  70800000
*                                   BY LIGHT PEN/CURSOR ROUTINE         71000000
         TM    N1(XHCTR),DCMMSGAC  Q. IS THIS AN ACTION MESSAGE         71200000
         BNO   DELET               NO, GO PERFORM DELETION              71400000
         OI    DCMUTILT,DCMUTILB   INDICATE A WTOR                      71600000
         L     XMSG,DCMDSAV+N4     GET BUFFER ADDR OF MESSAGE           71800000
         LR    XLCTR,XHCTR         GET ADDR OF SCT FOR DELETABLE WTOR   72000000
MARKWTOR EQU   *                                                        72200000
         TM    N1(XLCTR),DCMMSGCT  Q. IS THIS A CONTINUATION LINE       72400000
         BNO   MARKOK              NO                                   72600000
         SR    XLCTR,XINC          YES, DECREMENT TO INCLUDE FIRST LINE 72800000
         SH    XMSG,DCMCORLN       MESSAGE ADDRESS AND SCT ADDR  S21003 73000000
         LR    XHCTR,XLCTR         OF THE WTOR                          73200000
         B     MARKWTOR            CHECK FOR FURTHER CONTIN             73400000
MARKOK   EQU   *                                                        73600000
         OI    N0(XHCTR),DCMMSGRD  MARK SCT ENTRY- DELETION REQUESTED   73800000
         MVI   N2(XMSG),VERTBAR    MARK MSG DELETABLE                   74000000
         MVI   N3(XMSG),BLANK      BLANK OUT ACTION INDICATOR           74200000
         TM    N0(XHCTR),DCMMSGCN  Q. IS WTOR CONTINUED                 74400000
         BNO   ENTSETUP            NO, GO SET UP COMMAND IN ENTRY       74600000
         AH    XMSG,DCMCORLN       INCREMENT TO NEXT LINE        S21003 74800000
         AR    XHCTR,XINC          INCREMENT TO NEXT SCT ENTRY          75000000
         B     MARKWTOR            GO MARK CONTINUATION LINE            75200000
ENTSETUP EQU   *                                                        75400000
         L     XE,DCMAENTR         GET ADDR OF ENTRY AREA               75600000
         LH    XWORK,DCMELGN       GET INCRE FOR END OF ENTRY           75800000
         MVI   N0(XE),CBLANK       BLANK FIRST CHARACTER                76000000
         EX    XWORK,MVBLNK       EXECUTE MOVE FOR BLANKING ENTRY       76200000
         LA    XMSG,N4(XE)         GET ADDR TO MOVE NUMBER INTO         76400000
         SR    XNUM,XNUM           ZERO REG                             76600000
         IC    XNUM,DCMDSAV        GET NUMBER OF MSG TO BE DELETED      76800000
         MVC   N0(N4,XE),KCOMMAND  MOVE IN K COMMAND                    77000000
         BAL   XE,NUMBER           CONVERT LINE NUMBER TO BINARY        77200000
         CLI   N0(XMSG),CBLANK     Q. A ONE DIGIT NUMBER                77400000
         BNE   OK                  NO                                   77600000
         MVC   N0(N1,XMSG),N1(XMSG)  MOVE NUMBER OVER                   77800000
         MVI   N1(XMSG),CBLANK                                          78000000
OK       EQU   *                                                        78200000
         L     XMSG,DCMASCRN       RESTORE ADDR OF BUFFER               78400000
         L     XWORK,DCMAMTAB      AND ADDR OF SCT                      78600000
         L     XCOMP,DCMADDRL      GET LAST SCREEN CONTROL TABLE ADDR   78800000
         LA    XF,UPDTE            GET RETURN ADDR FOR TURNOFF RTN      79000000
         SR    XNUM,XNUM           ZERO NUMBER REGISTER                 79200000
         OI    DCMDSTAT,DCMDSTNM   TURN ON MSGS NUMBERED BIT            79400000
NUMTURN  EQU   *                                                        79600000
         TM    N0(XWORK),DCMMSGIN  Q. IS THERE A MESSAGE IN THIS LINE   79800000
         BZ    NOUT                NO, EXIT                             80000000
         BAL   XE,NUMBER           YES, GO NUMBER MESSAGE               80200000
         CLR   XWORK,XLCTR         Q. IS THIS MESSAGE OUTSIDE RANGE     80400000
         BL    TURNOFF             YES                   OF DELETION    80600000
         CLR   XWORK,XHCTR         Q. IS THIS MESSAGE OUTSIDE RANGE     80800000
         BH    TURNOFF             YES, GO TURN OFF DELETE REQUEST      81000000
UPDTE    EQU   *                        FLAGS IF ANY PRESENT            81200000
         AH    XMSG,DCMCORLN       INCREMENT TO NEXT MESSAGE     S21003 81400000
         BXLE  XWORK,XINC,NUMTURN  INCREMENT POINTER TO SCREEN CONTRL T 81600000
         B     NOUT                GO TEST FOR VERIFICATION DESIRED     81800000
MVBLNK   MVC   N1(N0,XE),N0(XE)    BLANK ENTRY AREA                     82000000
         EJECT                                                          82200000
***                                                                     82400000
***       EQUATES                                                       82600000
***                                                                     82800000
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            83000000
ID2      EQU   C'8'                2ND CHARACTER OF CSECT ID            83200000
BLANK    EQU   C' '                BLANK CHARACTER                      83400000
CF0      EQU   C'0'                CHARACTER OF ZERO                    83600000
N0       EQU   0                       NUMBER                           83800000
N1       EQU   1                       NUMBER                           84000000
N2       EQU   2                       NUMBER                           84200000
N3       EQU   3                       NUMBER                           84400000
N4       EQU   4                       NUMBER                           84600000
N5       EQU   5                       NUMBER                           84800000
N6       EQU   6                       NUMBER                           85000000
N7       EQU   7                       NUMBER                           85200000
N8       EQU   8                       NUMBER                           85400000
TWENTY4  EQU   24            NUMBER                                     85600000
N255     EQU   255                     NUMBER                           85800000
REGDELET EQU   64                      PERFORM REGULAR DELET IN DEL 2   86000000
LINE29   EQU   28            LINE 29                                    86200000
CCF      EQU   X'CF'                                                    86400000
VERTBAR  EQU   C'|'                VERTICAL BAR                         86600000
ZERO     EQU   0                   NUMBER                               86800000
ASTERISK EQU   C'*'          ASTERISK                                   87000000
HORBAR   EQU   C'-'                    HORIZONTAL BAR                   87200000
C20      EQU   X'20'                   END OF CCW CHAIN INDICATOR       87400000
CBLANK   EQU   C' '                    BLANK                            87600000
PPACT    EQU   C'@'                PROBLEM PROGRAM ACTION     MD Y01958 87800000
R        EQU   C'R'                    DEL = R OR RD           @ZA08078 88000000
         EJECT                                                          88200000
*                                                                       88400000
*        CONSTANTS                                                      88600000
*                                                                       88800000
KCOMMAND DC    C'K E,1,'               CONSTANT                         89000000
ONE      DC    H'1'                    CONSTANT                         89200000
         EJECT                                                          89400000
         IEERDCM                                                        89600000
         EJECT                                                          89800000
         IEETDCM                                                        90000000
         EJECT                                                          90200000
         IEECUCM  FORMAT=NEW                                            90400000
         EJECT                                                          90600000
         IHACTM  CXSA                                                   90800000
         END                                                            91000000
./  ADD  SSI=33250175,NAME=IEECVET9
         TITLE 'IEECVET9  DELETE FOUR'                                  00050002
IEECVET9 CSECT                                                          00100002
*A151600-151900                                               MH Y01564 00110002
*C151500,152000                                               MH Y01564 00120002
*A079020,079040,079100,079200,084100,084200                   MH Y01270 00150002
*D077500,078000,081000                                        MH Y01270 00200002
**********************************************************************  00500002
* STATUS       CHANGE LEVEL=0                                           00550002
*                                                                       00600002
* FUNCTION                                                              00650002
*              1. REMOVAL  OF MESSAGES FOR A REGULAR DELETE REQUEST     00700002
*                INITIATED BY A CONTROL E COMMAND                       00750002
*              2. AUTOMATIC MESSAGE DELETION ON A FULL SCREEN CONDITION 00800002
*              3. NUMBERING OF MESSAGES AS REQUESTED BY K D,N           00850002
*                                                                       00900002
* ENTRY POINT  IEECVET9                                                 00950002
*                                                                       01000002
* INPUT        INDICATION OF MESSAGES TO BE REMOVED                     01050002
*                   BIT SETTINGS ON INPUT INDICATING ACTION REQUIRED    01100002
*                       DCMCOM1                                         01150002
*                         DCMCOMAU   AUTOMATIC DELETION REQUIRED        01200002
*                         DCMCOMNM NUMBER MESSAGES                      01250002
*                                                                       01300002
* OUTPUT       ALTERATION OF DISPLAY- MESSAGE REMOVAL                   01350002
*              MESSAGES NUMBERED FOR K D,N REQUEST                      01400002
*                                                                       01450002
* EXTERNAL REFERENCES NONE                                              01500002
*                                                                       01550002
* EXITS - NORMAL  IEECVETH OR P OR R  DEVICE-DEPENDENT IO               01600002
*                 IEECVET2 DISPLAY 1  (IF AUTOMATIC DELETE WORKS)       01650002
*       - ERROR   NONE                                                  01700002
*                                                                       01750002
* TABLES/WORK AREAS DISPLAY CONTROL MODULE (CONTAINED IN DSECT)         01800002
*                   RESIDENT DISPLAY CONTROL MODULE CONTAINED    S21003 01850002
*                   IN A DSECT                                   S21003 01900002
*                                                                       01950002
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      02000002
*                                                                       02050002
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A      02100002
*              PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL       02150002
*              CHARACTER SET.                                           02200002
*                                                                       02250002
*********************************************************************** 02300002
         EJECT                                                          02350002
*/*IEECVET9: CHART */                                                   02400002
*/*CSECT: E IEECVET9 DELETE 4 */                                        02450002
*/*START: P SET ALL BASES */                                            02500002
*/*%AUTO: D (YES,AUTODEL,NO,) AUTO DELETE REQUEST */                    02550002
*/*%KDN: D (YES,NUMBER,NO,) K D,N OR K D REQUEST */                     02600002
*/*%DELBUF: P BLANK DELETE REQUEST BUFFER */                            02650002
*/*%WR: P SET WRITE FULL SCREEN, POSITION CURSOR HOME */                02700002
*/*PRELOOP: P POINT TO TOP OF SCT SIB */                                02750002
*/*PRELOOP1: D (YES,,NO,PRELOOP2) ANY MSG IN LINE */                    02800002
*/*%NEXTSCT: P (,PRELOOP1) GET NEXT SCT ENTRY */                        02850002
*/*PRELOOP2: D (YES,BLANKOUT,NO,) THIS MESSAGE TO BE DELETED */         02900002
*/*MOVEUP: P (,IN) MOVE MESSAGE UP TO NEXT FREE LINE */                 02950002
*/*%DOMM: P MOVE UP DOM + TJID TO NEXT FREE DOM ENTRY */                03000002
*/*%SCTM: P MOVE UP SCT ENTRY TO NEXT FREE ENTRY */                     03050002
*/*IN: P INCREMENT TO NEXT SCT AND DOM ENTRY */                         03100002
*/*%D1: D (YES,,NO,NOBAR) MESSAGE AUTO DELETEABLE */                    03150002
*/*%BAR: P PUT BAR IN MESSAGE */                                        03200002
*/*NOBAR: D (YES,BLANKOUT,NO,) SHOULD LINE MOVED FROM BE BLANKED */     03250002
*/*INCRE: P GET NEXT LINE */                                            03300002
*/*%ANY: D (YES,PRELOOP2,NO,) ANY MORE LINES */                         03350002
*/*TAUTO: D (YES,TNUM,NO,) DEL = Y */                                   03400002
*/*%NUMH: D (YES,NUMBER1,NO,TESTDISP) HOLD NUMBERS */                   03450002
*/*BLANKOUT: P BLANK OUT THIS LINE */                                   03500002
*/*%DOMB: P CLEAR DOM AND TJID ENTRY */                                 03550002
*/*%SCTB: P CLEAR SCT ENTRY */                                          03600002
*/*%DELO: P (,INCRE) SET DELETION HAS OCCURRED */                       03650002
*/*TNUM: D (YES,NUMBER1,NO,TESTDISP) ARE MSGS NUMBERED */               03700002
*/*NUMBER: D (YES,NUMBER2,NO,) HOLD NUMBERS */                          03750002
*/*%MN: D (YES,NUMBER2,NO,) MESSAGES NUMBERED NOW */                    03800002
*/*NUMBER0: D (YES,NUMBERR,NO,) IN ROLL MODE */                         03850002
*/*NUMBER1: P SET MSGS NOW NUMBERED */                                  03900002
*/*NLOOP: S (,NOUT) MOVENUM:NUMBER ALL MSGS ON SCREEN */                03950002
*/*NUMBER2: D (YES,NUMBERR,NO,) MSG NO.'S HELD */                       04000002
*/*%NOHOLD: P (,NUMBER0) SET NO LONGER HELD */                          04050002
*/*NUMBERR: P (,MSGEXIT) SET CURSOR, SET REQUEST INCONSISTANT MSG */    04100002
*/*NOUT: P SET CURSOR, SET FULL SCREEN WRITE */                         04150002
*/*%EN: D (YES,IOEXIT,NO,TESTDISP) ENTRY JUST TO NUMBER MSGS */         04200002
*/*TESTDISP: D (YES,,NO,FULLTEST) IS A MSG IN INFO DISPLAY */           04250002
*/*%UNVM: P SET UNVIEWABLE MSG BIT */                                   04300002
*/*FULLTEST: D (YES,,NO,IOEXIT) IS SCREEN FULL */                       04350002
*/*%DELSUC: D (YES,DISPEXIT,NO,) WAS DELETEION SUCESSFUL */             04400002
*/*%FG: D (YES,IOEXIT,NO,) DEVICE IN ROLL MODE */                       04450002
*/*%MSGWT: P SET MSG WAITING BIT, OFF UNVIEW. MSG BIT */                04500002
*/*IOEXIT: D (YES,MSGEXIT,NO,) UNVIEWABLE MSG */                        04550002
*/*IOE: P (,XCTL) SET EXIT TO IO RTN */                                 04600002
*/*DISPEXIT: P (,XCTL) TURN OFF SCREEN FULL, SET EXIT TO IEECVET2 */    04650002
*/*MSGEXIT: P SET EXIT TO IEECVETD */                                   04700002
*/*XCTL: R XCTL TO PRESET MODULE */                                     04750002
*/*AUTODEL: P (,PRELOOP) SET UP FOR AUTO DELETE */                      04800002
*/*IEECVET9: END */                                                     04850002
         EJECT                                                          04900002
*********************************************************************** 04950002
*                                                                       05000002
*   REGISTER EQUATES                                                    05050002
*                                                                       05100002
*********************************************************************** 05150002
X0       EQU   0         REG 0                                          05200002
XMOVECTR EQU   1         ADDR CTR FOR MOVING UNDELETED MSGS.            05250002
X1       EQU   1         REG 1                                          05300002
XNUM     EQU   1         NUMBER REG                                     05350002
XWORK    EQU   2         WORK REG.                                      05400002
XHCTR    EQU   3         HIGH VALUE FOR NN                              05450002
XSCTCTR  EQU   3         SCT REG                                        05500002
XINC     EQU   4         INCREMENT REG (BXLE)                           05550002
XCOMP    EQU   5         COMPARAND (BXLE)                               05600002
XLCTR    EQU   6         LOW VALUE FOR NN                               05650002
X7       EQU   7         UCM BASE REG                                   05700002
XMSG     EQU   8         WORK REG                                       05750002
RETURN   EQU   8         WORK REG                                       05800002
X9       EQU   9         DCM BASE REG                                   05850002
XA       EQU   10        PROGRAM BASEREG.                               05900002
XB       EQU   11        CXSA BASE REG.                                 05950002
XDOM1    EQU   11            PTR TO DOM ID NUMBER                       06000002
XC       EQU   12        UCM ENTRY BASE REG.                            06050002
XDOM2    EQU   12            PTR TO DOM ID FOR UNDELETED MSG            06100002
XIOB     EQU   13        IOB PTR. REG.                                  06150002
XLINK    EQU   13        WORK REG                                       06200002
XCCWCTR  EQU   14        REG TO COUNT CCW'S CONSTRUCTED                 06250002
XE       EQU   14        WORK REG                                       06300002
XMASK    EQU   15                 MASK REGISTER                         06350002
XF       EQU   15        REGISTER 15                                    06400002
X1PARM   EQU   1                                                        06402002
XFBRANCH EQU   15                                                       06410002
         EJECT                                                          06450002
         BALR  XA,N0               ESTABLISH PROGRAM ADDRESSIBILITY     06500002
         USING *,XA                                                     06550002
         B     BEGIN                                                    06560002
ICATCH   DC    CL8'IEECVET9'                                            06570002
         DC    CL8'&SYSDATE',CL56' '                                    06580002
BEGIN    EQU   *                                                        06590002
         LR    XB,X1               ESTABLISH CXSA ADDRESS               06600002
         USING CXSA,XB                                                  06650002
         L     XC,CSAUCM           ESTABLISH UCM ADDRESS                06750002
         USING UCMLIST,XC                                               06800002
         L     X9,UCMXB            GET POINTER TO RESIDENT DCM   S21003 06850002
         L     X9,N0(X9)           GET POINTER TO T DCM          S21003 06900002
         USING DCMSTRT,X9                                               06950002
         L     X7,CSACTLM          GET POINTER TO UCM                   07000002
         USING UCM,X7              ESTABLISH UCM BASE REGISTER          07050002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      07060002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    07070002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      07080002
*   THIS ROUTINE WILL REINITIALIZE THE INSTRUCTION LINE AND             07100002
*   DELETE MSG. LINES MARKED WITH DELETE REQUEST BIT                    07150002
         MVI   DCMUTILT,ZERO    ZERO UTILITY BYTE                       07200002
         SR    XMASK,XMASK         ZERO MASK REGISTER                   07250002
         LH    XINC,DCMSCTCN       LOAD SCREEN CONTROL TABLE INCREMENT  07300002
         TM    DCMCOM1,DCMCOMAU    Q. AUTOMAT DELETE REQUEST            07350002
         BO    AUTODEL             YES                                  07400002
         L     XWORK,DCMADOPN      POINT TO COMMAND OPERAND      S21002 07450002
         CLC   ZERO(N3,XWORK),DN   K D,N REQUEST                 S21002 07500002
         BE    NUMBER              YES, GO NUMBER MESSAGES       S21002 07550002
         CLC   ZERO(N2,XWORK),DB   K D DEFAULT                   S21002 07600002
         BE    NUMBER              YES, GO NUMBER LINES          S21002 07650002
* ASSUME REGULAR DELETION                                               07700002
         L     X1,UCMXB            POINT TO RESIDENT DCM         S21003 07850002
         USING DCMTSRT,X1                                               07900002
         CLI   DCMRQDEL,BLANK      INTERNAL REQUEST           MH Y01270 07902002
         BE    INTERN               YES, DONT ALT. SCREEN     MH Y01270 07904002
         NI    DCMDSTAT,N255-DCMDSAUT  TURN OFF AUTO DELETE   MH Y01270 07910002
*                                  TRIED BIT                  MH Y01270 07920002
         MVI   DCMRQDEL,BLANK      BLANK THE                            07950002
         MVC   DCMRQDEL+N1(N7),DCMRQDEL      DELETE REQUEST BUFFER      08000002
         DROP  X1                                                S21003 08050002
         OI    DCMIOCM1,DCMWRWRN+DCMWRMSG+DCMWRENT+DCMINSC+DCMWRINS     08150002
         MVI   DCMCULNO,N1         INDICATE INSERT CURSOR IN POSITION   08200002
         MVI   DCMPOSCU,N1          ONE OF THE ENTRY AREA               08250002
         OI    DCMIOCM2,DCMBLENT   INDICATE BLANK ENTRY AREA            08300002
         NI    DCMCOM1,N255-DCMLPENT    TURN OFF LIGHT PEN ENTRY BIT    08350002
         OI    DCMIOCM2,DCMINSSH   REINITIALIZE INSTRUC LINE            08400002
INTERN   NI    DCMDSTAT,X'FF'-DCMDSINR INT. REQ. DEL. TRIED   MH Y01270 08410002
         IC    XMASK,MASKBIT+N1 MASK FOR DEL. REQ. SCT BIT    MH Y01270 08420002
PRELOOP  EQU   *                                                        08450002
         STM   XB,XC,DCMDSAV+N4    SAVE REGISTERS WHILE DELETING        08500002
         L     XMOVECTR,DCMASCRN   GET ADDRESS OF FIRST MESSAGE IN      08550002
         LA    XMOVECTR,N0(XMOVECTR)   CLEAR HIGH ORDER BYTE            08600002
         LR    XMSG,XMOVECTR        THE SCREEN IMAGE BUFFER             08650002
         L     XWORK,DCMAMTAB      GET ADDR OF FIRST ENTRY IN THE SCT   08700002
         LR    XCOMP,XWORK         SET UP FOR TOP OF SCT         S21003 08750002
PRELOOP1 EQU   *                                                 S21003 08800002
         TM    N0(XCOMP),DCMMSGIN   ANY ENTRY                    S21003 08850002
         BNO   PRELOOP2            NO, END OF ENTRIES            S21003 08900002
         LA    XCOMP,N2(XCOMP)     NEXT ELEMENT                  S21003 08950002
         B     PRELOOP1            TEST FOR ENTRY                S21003 09000002
PRELOOP2 EQU   *                                                 S21003 09050002
         BCTR  XCOMP,X0            POINT TO THE                  S21003 09100002
         BCTR  XCOMP,X0            LAST SCT ENTRY FOR BXLE       S21003 09150002
         LR    XSCTCTR,XWORK                                            09200002
         L     XDOM1,DCMDOMPK      GET ADDRESS OF FIRST DOM ID NUMBER   09250002
         LR    XDOM2,XDOM1                                              09300002
         LH    XE,DCMLGNTH         GET LENGTHN OF LINE                  09350002
         BCTR  XE,N0               DECREENT BY 1                        09400002
         LR    X7,XE               GET LENGTH FOR MOVING LINE           09450002
         BCTR  XE,N0               GET LENGTH FOR BLANKING LINES        09500002
DNEXT    EQU   *                                                        09550002
         EX    XMASK,TUMASK        Q. DELETE THIS MESSAGE LINE          09600002
         BZ    MOVEUP              NO, MOVE IT UP                       09650002
         TM    N1(XWORK),DCMMSGIR  Q. AN INTERVENTION REQUIRED MESSAGE  09700002
         BNO   BLANKOUT            NO                                   09750002
         LH    XLINK,DCMIRCTR      LOAD CTR FOR INTERV REQ'D MSGS       09800002
         SH    XLINK,ONE           SUBTRACT ONE FROM 17                 09850002
         STH   XLINK,DCMIRCTR      STORE IT BACK                        09900002
BLANKOUT EQU   *                                                        09950002
         MVI   N0(XMSG),BLANK      BLANK ONE BYTE                       10000002
         EX    XE,MVEBLANK         THEN PROPAGATE BLANKS THRO LINE      10050002
         MVC   N0(N2,XWORK),CZERO   CLEAR SCT ENTRY FLAGS        S21002 10100002
         XC    N0(N8,XDOM1),N0(XDOM1) CLEAR DOM BYTES                   10150002
         OI    DCMUTILT,DCMUTILA   SET BIT - DELETION HAS OCCURRED      10200002
         B     INCRE               GO INCREMENT COUNTERS                10250002
MOVEUP   EQU   *                                                        10300002
         EX    X7,MVELINE          MOVE MSG LINE UP                     10350002
         MVC   N0(N2,XMOVECTR),CBLANK   BLANK NUMBER                    10400002
         MVC   N0(N8,XDOM2),N0(XDOM1)  MOVE DOM ID INTO CORRES. POSITIO 10450002
         MVC   N0(N2,XSCTCTR),N0(XWORK)   HOLD NEW SCT ENTRY            10500002
IN       EQU   *                                                        10550002
         LA    XDOM2,N8(XDOM2)     INCREMENT DOM REGISTER               10600002
         LA    XSCTCTR,N0(XSCTCTR,XINC)                                 10650002
         TM    N0(XWORK),DCMMSGAD  Q. MSG. AUTOMATICALLY DELETABLE      10700002
         BZ    NOBAR               NO VERTICAL BAR REQUIRED             10750002
         MVI   N2(XMOVECTR),VERTBAR REPLACE VERTICAL BAR                10800002
NOBAR    EQU   *                                                        10850002
         LH    XLINK,DCMCORLN      LOAD REG FOR INCREMENT     MB  M2070 10860002
         CR    XMOVECTR,XMSG       DETERMINE WHETHER LINE SHOULD BE     10900002
*                                   BLANKED OUT                         10950002
         LA    XMOVECTR,N0(XLINK,XMOVECTR) INCR TO NXT LINE   MB  M2070 11010002
         BNE   BLANKOUT  GO BLANK OUT LINE                              11050002
INCRE    EQU   *                                                        11100002
         LA    XDOM1,N8(XDOM1)     INCREMENT DOM REGISTER               11150002
         AH    XMSG,DCMCORLN       INCREMENT ADDR OF MSG LINE MB  M2070 11160002
BXLE     EQU   *                                                        11250002
         BXLE  XWORK,XINC,DNEXT    INCREMENT + BR                       11300002
         LM    XB,XC,DCMDSAV+N4        RESTORE REGISTERS 11 AND 12      11350002
TAUTO    EQU   *                                                        11400002
         TM    DCMCOM1,DCMCOMAU    TEST FOR AUTOMATIC DELETE            11450002
         BO    TNUM      YES                                            11500002
         TM    DCMDSTAT,DCMDSTNH   Q. NUMBER HOLD OPTION IN EFFECT      11550002
         BO    NUMBER1             YES, GO NUMBER                S21002 11600002
         NI    DCMDSTAT,N255-DCMDSTNM  TURN OFF MSGS ARE NUMB. BIT      11650002
         B     TESTDISP            TEST FOR WARNING MESSAGES            11700002
TNUM     EQU   *                                                        11750002
         TM    DCMDSTAT,DCMDSTNM    Q. ARE MESSAGES NUMBERED            11800002
         BZ    TESTDISP  TEST FOR WARNING MSG                           11850002
         B     NUMBER1             YES, GO NUMBER                S21002 11900002
NUMBER   EQU   *                                                        11950002
         CLC   ZERO(N8,XWORK),DNHOLD   K D,N,HOLD REQUEST        S21002 12000002
         BE NUMBER2                YES                           S21002 12050002
         TM    DCMDSTAT,DCMDSTNM   ARE MESSAGES NUMBERED         S21002 12100002
         BO    NUMBER3             YES, SEE IF IN HOLD MODE      S21002 12150002
NUMBER0  EQU   *                                                 S21002 12200002
         CLI   DCMDEL,CR           ARE WE IN ROLL MODE           S21002 12250002
         BE    NUMBERR             YES, DO NOT NUMBER            S21002 12300002
NUMBER1  EQU   *                                                 S21002 12350002
         OI    DCMDSTAT,DCMDSTNM   INDICATE MESSAGES NUMBERED    S21002 12400002
         L     XMSG,DCMASCRN       ADDR OF FIRST MSG IN BUFFER          12450002
         L     XWORK,DCMAMTAB      GET ADDR OF FIRST MSG IN SCT         12500002
         SR    XNUM,XNUM           ZERO NUMBER REGISTER                 12550002
NLOOP    EQU   *                                                        12600002
         TM    N0(XWORK),DCMMSGIN  Q. IS THERE A MESSAGE IN THE LINE    12650002
         BZ    NOUT                NO, EXT                              12700002
         AH    XNUM,ONE            INCREMENT TO NEXT NUMBER             12750002
         CVD   XNUM,DCMPACK        CONVERT NUMBER TO DECIMAL            12800002
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2)  UNPACK NUMBER           12850002
         OI    DCMCVBIN+N3,CF0     FIX SIGN                             12900002
         CLI   DCMCVBIN+N2,CF0     Q. A ONE DIGIT NUMBER                12950002
         BNE   MOVENUM             NO                                   13000002
         MVI   DCMCVBIN+N2,BLANK   YES, BLANK OUT FIRST DIGIT           13050002
MOVENUM  EQU   *                                                        13100002
         MVC   N0(N2,XMSG),DCMCVBIN+N2  MOVE NUMBER INTO MSG LINE       13150002
         AH    XMSG,DCMCORLN       INCRE TO NEXT MSG LINE     MB  M2070 13210002
         LA    XWORK,N2(XWORK)     POINT TO NEXT SCT ENTRY       S21002 13250002
         B     NLOOP               LOOP TO LAST MESSAGE          S21002 13300002
NUMBER2  EQU   *                                                 S21002 13350002
         TM    DCMDSTAT,DCMDSTNH   ARE MESSAGE NUMBERS HELD      S21002 13400002
         BO    NUMBERR             YES, DO NOT NUMBER            S21002 13450002
         CLI   DCMDEL,CR           ARE WE IN ROLL MODE           S21002 13500002
         BE    NUMBERR             YES, DO NOT NUMBER            S21002 13550002
         OI    DCMDSTAT,DCMDSTNH   INDICATE NUMBERS HELD         S21002 13600002
         B     NUMBER1             NUMBER MESSAGES               S21002 13650002
NUMBER3  EQU   *                                                 S21002 13700002
         TM    DCMDSTAT,DCMDSTNH   ARE MESSAGE NUMBERS HELD      S21002 13750002
         BNO   NUMBERR             NO, ERROR                     S21002 13800002
         NI    DCMDSTAT,N255-DCMDSTNH   NO LONGER HELD           S21002 13850002
         B     NUMBER0             CHECK FOR ROLL MODE           S21002 13900002
NUMBERR  EQU   *                                                 S21002 13950002
         L     X1,DCMAENTR         POINT TO ENTRY AREA           S21002 14000002
         SR    XWORK,X1            FIND OPERAND DISPLACEMENT     S21002 14050002
         LA    XWORK,N1(XWORK)     CURSOR POSITION               S21002 14100002
         CH    XWORK,DCMLGNTH      LINE TWO                      S21002 14150002
         BH    NUMBERR2            YES                           S21002 14200002
         MVI   DCMCULNO,N1         LINE ONE                      S21002 14250002
NUMBERR1 EQU   *                                                 S21002 14300002
         STC   XWORK,DCMPOSCU      POSITION CURSOR               S21002 14350002
         OI    DCMIOCM1,DCMINSC    INSERT CURSOR                 S21002 14400002
         OI    DCMCMSG2,DCMRQINC   REQUEST INCONSISTANT          S21002 14450002
         CLI   DCMDEL,CR           ARE WE IN ROLL MODE        MF  M1680 14500002
         BE    MSGEXIT             YES, JUST REQUEST          MF  M1680 14550002
*                                       INCONSISTENT          MF  M1680 14600002
         OI    DCMCMSG1,DCMSTEX    NO, INDICATE STATUS        MF  M1680 14650002
*                                       ALREADY EXISTS        MF  M1680 14700002
         B     MSGEXIT             GO TO MESSAGE MODULE          S21002 14750002
NUMBERR2 EQU   *                                                 S21002 14800002
         SH    XWORK,DCMLGNTH      COMPUTE LINE 2 OPERAND        S21002 14850002
         MVI   DCMCULNO,N2         LINE NUMBER 2                 S21002 14900002
         B     NUMBERR1            CONTINUE                      S21002 14950002
NOUT     EQU   *                                                        15000002
         STH   XNUM,DCMADNUM       STORE NUMBER                         15050002
         MVI   DCMLINEN,N1         START AT LINE ONE             S21002 15100002
         OI    DCMIOCM1,DCMWRMSG+DCMWRINS                     MH Y01564 15150002
         L     XWORK,DCMADOPN      POINT TO OPERAND           MH Y01564 15160002
         CLI   N0(XWORK),BLANK     IS REQUEST FROM OPERATOR   MH Y01564 15170002
         BE    DONTWRT             NO, DONT REWRT ENTRY AREA  MH Y01564 15180002
         OI    DCMIOCM1,DCMWRENT+DCMINSC YES, WRITE ENTRY     MB YM4087 15190002
DONTWRT  OI    DCMIOCM2,DCMBLENT+DCMINSSH      BLANK ENTR     MH Y01564 15200002
         MVI   DCMCULNO,N1         INDICATE SET CURSOR                  15250002
         MVI   DCMPOSCU,N1           IN POSITION ONE OF ENTRY AREA      15300002
         TM    DCMCOM1,DCMCOMNM    JUST NUMBERING TO DO          S21002 15350002
         BNO   TESTDISP            NO, CHECK OTHER               S21002 15400002
         B     IOEXIT              EXIT TO I/O ROUTINE                  15450002
TESTDISP EQU   *                                                        15500002
         OI    DCMIOCM2,DCMBLWRR   BLANK RIGHT HALF OF WARNING LINE     15550002
         OI    DCMIOCM1,DCMWRWRN+DCMWRMSG  INDIC WRITE WARN AND MSG AR  15600002
         L     XWORK,DCMADSEC      POINT TO TOP OF SSCT          S21002 15650002
         SR    XNUM,XNUM           CLEAR COUNT REG               S21002 15700002
TESTLOOP EQU   *                                                 S21002 15750002
         TM    N0(XWORK),SSCTF0    ANY ENTRY IN LINE             S21002 15800002
         BNZ   TESTD1              YES, STATUS DISPLAY ON SCREEN S21002 15850002
         TM    N0(XWORK),DCMSECST   END OF SSCT                  S21002 15900002
         BO    FULLTEST            YES, NO DISPLAY ON SCREEN     S21002 15950002
         LA    XWORK,N1(XWORK)     POINT TO NEXT SSCT ELEMENT    S21002 16000002
         LA    XNUM,N1(XNUM)       RECODR ONE NON-DISPLAY LINE   S21002 16050002
         B     TESTLOOP            TEST ELEMENT                  S21002 16100002
TESTD1   EQU   *                                                 S21002 16150002
         L     XWORK,DCMAMTAB      GET POINTER TO SCT            S21002 16200002
         SLL   XNUM,N1             FIND FIRST DISPLAY LINE       S21002 16250002
         AR    XWORK,XNUM          EQUIVALENT IN SCT             S21002 16300002
         TM    N0(XWORK),DCMMSGIN  Q. IS MSG IN INFO DISPLAY            16350002
         BNO   FULLTEST            NO GO TEST . FOR FULL SCREEN BIT     16400002
         OI    DCMCMSG1,DCMUNMSG   INDICATE WRITE UNVIEW MSG            16450002
FULLTEST EQU   *                                                        16500002
         L     X1,UCMXB            POINT TO RESIDENT DCM         S21003 16550002
         USING DCMTSRT,X1                                               16600002
         TM    DCMR2FLG,DCMRXSFL   Q. IS SCREEN FULL BIT ON             16650002
         BNO   IOEXIT              NO, EXIT                             16700002
         DROP  X1                                                S21003 16750002
         TM    DCMUTILT,DCMUTILA   Q. WAS DELETION SUCCESSFUL           16800002
         BO    DISPEXIT            YES, EXIT TO DISPLAY RTN             16850002
         CLI   DCMDEL,CR           Q. ARE WE IN ROLL MODE               16900002
         BE    IOEXIT              YES, DONT WRITE MESSAGE WAITING      16950002
         OI    DCMCMSG1,DCMMSGWT   MOVE IN MSG WAITING WARNING          17000002
         NI    DCMCMSG1,N255-DCMUNMSG TURN OFF UNVIEWABLE MSG BIT       17050002
IOEXIT   EQU   *                                                        17100002
         TM    DCMCMSG1,DCMUNMSG   Q. MOVE IN UNVIEWABLE MSG            17150002
         BO    MSGEXIT             YES, EXIT TO MESSAGE MODULE 1        17200002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              17250002
         B     XCTL                EXIT TO IEECVET(H,P,R, OR U)         17300002
DISPEXIT EQU   *                                                        17350002
         NI    UCMDEVC,N255-UCMDEVA    TURN OFF UCM SCREEN FULL BIT     17400002
         L     X1,UCMXB            POINT TO RESIDENT DCM         S21003 17450002
         USING DCMTSRT,X1                                               17500002
         NI    DCMR2FLG,N255-DCMRXSFL   SET OFF FULL SCREEN      S21003 17550002
         DROP  X1                                                S21003 17600002
         NI    DCMCMSG1,N255-DCMMSGWT  TURN OFF MESSAGE WAITING BIT     17650002
         L     XFBRANCH,DCMNDSP1   LOAD DISPLAY 1 ADDRESS               17700002
         B     XCTL                EXIT TO IEECVET2                     17750002
MSGEXIT  EQU   *                                                        17800002
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               17850002
*                                  FOR EXIT TO IEECVETD                 17860002
XCTL     EQU   *                                                        17900002
         NI    DCMCOM1,N255-DCMCOMAU-DCMCOMNM  TURN OFF BITS            17950002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 17960002
         BR    XFBRANCH            EXIT TO ADDRESS ALREADY SET          18000002
AUTODEL  EQU   *                                                        18200002
         NI    DCMDSTAT,N255-DCMDSAUT   TURN OFF AUTO DELETE TRIED BIT  18250002
         IC    XMASK,MASKBIT    MASK FOR AUTO DELETE                    18300002
         B     PRELOOP NO-DON'T REINIT INSTRUC LINE                     18350002
         EJECT                                                          18400002
*********************************************************************** 18450002
*                                                                     * 18500002
*        EXECUTABLE INSTRUCTIONS                                      * 18550002
*                                                                     * 18600002
*********************************************************************** 18650002
MVEBLANK MVC   N1(N0,XMSG),N0(XMSG)  USED FOR BLANKING LINES            18700002
MVELINE  MVC   N0(N0,XMOVECTR),N0(XMSG) MOVE MESSAGE LINE               18750002
TUMASK   TM    N0(XWORK),HEXZERO                                        18800002
         SPACE 3                                                        18850002
*********************************************************************** 18900002
*                                                                     * 18950002
*        CONSTANTS                                                    * 19000002
*                                                                     * 19050002
*********************************************************************** 19100002
DN       EQU   *                                                 S21002 19150002
DNHOLD   EQU   *                                                        19200002
         DC    C'D,N'              K D,N COMPARAND               S21002 19250002
         DC    C',HOLD'            K D,N,HOLD COMPARAND          S21002 19300002
DB       DC    C'D '               K D DEFAULT COMPARAND         S21002 19350002
CBLANK   DC    C'  '               BLANK CHARACTER                      19400002
ONE      DC    H'1'                CONSTANT  OF ONE                     19450002
MASKBIT  DC    X'0804'             AUTO.DELETE- DEL. REQUEST BIT        19500002
CZERO    DC    F'0'                ZERO                                 19550002
HSIX     DC    H'6'                CONSTANT OF SIX                      19600002
         SPACE 3                                                        19750002
*********************************************************************** 19800002
*                                                                     * 19850002
*        EQUATE STATEMENTS                                            * 19900002
*                                                                     * 19950002
*********************************************************************** 20000002
ID1      EQU   C'E'                1ST CHARACTER OF CSECT ID            20010002
ID2      EQU   C'9'                2ND CHARACTER OF CSECT ID            20020002
TMASK    EQU   X'80'               FOR FINDKEY TEST              S21003 20050002
SSCTF0   EQU   X'F0'               ENTRY EXISTS IN SSCT          S21002 20100002
ZERO     EQU   0         NUMBER                                         20150002
VERTBAR  EQU   C'|'                VERTICAL BAR                         20200002
CF0      EQU   C'0'          CHARACTER 0                                20250002
HEXZERO  EQU   X'00'               HEX ZERO                             20300002
N0       EQU   0         NUMBER                                         20350002
N1       EQU   1         NUMBER                                         20400002
N2       EQU   2         NUMBER                                         20450002
N3       EQU   3         NUMBER                                         20500002
N4       EQU   4         NUMBER                                         20550002
N6       EQU   6         NUMBER                                         20650002
N7       EQU   7         NUMBER                                         20700002
N8       EQU   8         NUMBER                                         20750002
N15      EQU   15        NUMBER                                         20950002
N255     EQU   255       NUMBER                                         21000002
ENDCHAIN EQU   X'20'     NUMBER                                         21050002
DASH     EQU   C'-'          DASH                                       21100002
BLANK    EQU   C' '          BLANK CHARACTER                            21150002
CR       EQU   C'R'                CHARACTER FOR ROLL MODE TEST         21200002
         EJECT                                                          21250002
*********************************************************************** 21300002
*                                                                     * 21350002
*        DSECTS                                                       * 21400002
*                                                                     * 21450002
*********************************************************************** 21500002
         IEERDCM                                                        21550002
         EJECT                                                          21600002
         IEETDCM                                                        21650002
         EJECT                                                          21800002
         IEECUCM  FORMAT=NEW                                            21900002
         EJECT                                                          21950002
         IHACTM  CXSA                                                   22050002
         SPACE 5                                                        22100002
         END                                                            22150002
./  ADD  SSI=32971322,NAME=IEECVFTA
         TITLE 'IEECVFTA      DIDOCS PFK ROUTINE 1'                     00050002
IEECVFTA CSECT                                                          00100002
*C193000,193100                                               MH YM2960 00150002
*/*IEECVFTA: CHART */                                                   00200002
*/* HEADER                                                              00250002
*/*         CHART FA     IEECVFTA            DIDOCS PFK ROUTINE 1       00300002
*/*                                           PAGE #          */        00350002
*/* E IEECVFTA */                                                       00400002
         SPACE 2                                                        00450002
* /* START OF SPECIFICATIONS ****                                       00500002
*02*  PROCESSOR = ASSEMBLER;                                            00550002
**** END OF SPECIFICATIONS ***/                                         00600002
         SPACE 5                                                        00650002
* STATUS                                                                00700002
*    CHANGE LEVEL 0                                                     00750002
*    CREATED FOR RELEASE 21, LINE ITEM S21003.                          00800002
         SPACE                                                          00850002
* FUNCTION                                                              00900002
*    TO CONTROL AUTOMATIC COMMAND ENTRY AS A RESULT OF DEPRESSING A     00950002
*    PROGRAM FUNCTION KEY OR A LIGHT PEN DETECT ON THE PFK LINE.        01000002
         SPACE                                                          01050002
* ENTRY POINTS                                                          01100002
*         IEECVFTA FOR ALL FUNCTIONS                                    01150002
*             FROM IEECVET1 WHEN A PFK IS PRESSED OR THERE IS           01200002
*                  MORE WORK TO BE DONE ON A KEY.                       01250002
*             FROM IEECVETF MODULE WHEN LIGHT PEN DETECTS               01300002
*                  ON THE PFK LINE.                                     01350002
         SPACE                                                          01400002
* INPUT                                                                 01450002
*    A BINARY KEY NUMBER IN DCMDSAV, FLAGS IN THE PFK AREA FOR THAT     01500002
*    KEY AND FLAGS IN THE DCM.                                          01550002
         SPACE                                                          01600002
* OUTPUT                                                                01650002
*    DCM FLAGS TO THE PROCESSOR, DEVICE DEPENDENT I/O AND ERROR         01700002
*    MESSAGE ROUTINES INDICATING ACTION REQUIRED.                       01750002
         SPACE                                                          01950002
* EXITS, NORMAL                                                         02000002
*         IEECVET4 (COMMAND) TO ISSUE A COMMAND.                        02050002
*         DEVICE DEPENDENT I/O ROUTINE TO WRITE A COMMAND FOR           02100002
*         VERIFICATION.                                                 02150002
         SPACE                                                          02200002
* EXITS, ERROR                                                          02250002
*         IEECVETD (MESSAGE MODULE 1) TO WRITE OUT ERROR MESSAGES.      02300002
         EJECT                                                          02350002
* TABLES/WORK AREAS                                                     02400002
*    PFK AREA                                                           02450002
*     THIS MODULE USES THE PFK AREA IN THE DCM, WHICH IS CREATED BY     02500002
*    SYSGEN.  THERE WILL BE ONE AREA FOR EACH PFK WHICH WAS             02550002
*    ALLOCATED AT SYSGEN TIME.  THE DCMADPFK                            02600002
*    FIELD IN THE DCM POINTS TO THE FIRST AREA AND ALL AREAS ARE        02650002
*    CONTIGUOUS.  FOLLOWING THE LAST AREA IS A ONE BYTE FIELD EQUAL TO  02700002
*    X'64', USED TO IDENTIFY THE END OF PFK WORKSPACE.                  02750002
*     EACH PFK AREA IS 110 BYTES LONG FORMATTED AS FOLLOWS              02800002
*                                                                       02850002
*      DCMNUM    A ONE BYTE FIELD CONTAINING THE KEY NUMBER             02900002
*                IN BINARY.                                             02950002
*                                                                       03000002
*      DCMSTS    A ONE BYTE FLAG FIELD.  FOR EXPLANATION SEE THE DCM    03050002
*                DSECT FOLLOWING THE CODE FOR THIS MODULE.              03100002
*                                                                       03150002
*      DCMVAL    A 108 BYTE FIELD WHICH IS EITHER                       03200002
*                                                                       03250002
*                 A.  A LIST OF KEYS IN THE FORM KFKF...KF/ WHERE K IS  03300002
*                      A ONE BYTE BINARY KEY NUMBER AND F IS A CONTROL  03350002
*                      BYTE WHICH CONTAINS C';' UNLESS PROCESSING       03400002
*                      IS TAKING PLACE.  THE SLASH (X'61')              03450002
*                      IDENTIFIES THE END OF THE LIST OF KEYS.          03500002
*                 B.  ONE OR MORE COMMANDS IN THE FORM                  03550002
*                          COMMAND;COMMAND;...COMMAND                   03600002
*                     WHERE SEMI-COLONS DELIMIT THE COMMANDS.  IF THE   03650002
*                     LAST COMMAND DOES NOT FILL THE BUFFER IT IS       03700002
*                     PADDED WITH BLANKS.                               03750002
*                                                                       03800002
*     DURING PROCESSING OF A PFK THE CONTROL BYTE IN A LIST OF KEYS     03850002
*    OR THE SEMI-COLON IN A LIST OF COMMANDS WILL BE CHANGED TO X'FF'   03900002
*    TO INDICATE THAT THE PRECEEDING ITEM HAS BEEN PROCESSED.           03950002
*                                                                       04000002
*    DCM   DESCRIBED IN DSECT AT END OF MODULE                          04050002
         SPACE 2                                                        04100002
* ATTRIBUTES                                                            04150002
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               04200002
         SPACE                                                          04250002
* CHARACTER CODE DEPENDENCY                                             04300002
*    NONE                                                               04350002
         EJECT                                                          04400002
* NOTES                                                                 04450002
*    THE FOLLOWING FLAG BITS ARE USED:                                  04500002
*     THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF OR  04550002
*    JUST TESTED BY THIS MODULE.                                        04600002
*                                                                       04650002
*        NAME     ACTION            FUNCTION                            04700002
*      DCMIOCM1                                                         04750002
*       DCMINSC     ON           INSERT CURSOR                          04800002
*       DCMWRENT    ON           WRITE A COMMAND IN ENTRY AREA          04850002
*      DCMIOCM3                                                         04900002
*       DCMPFKAT  OFF/TEST       KEY ATTENTION OCCURRED                 04950002
*       DCMRDPFK  OFF/TEST       DETECT ON PFK LINE                     05000002
*       DCMLTPFK    ON           LIGHT ALL ALLOCATED PFKS               05050002
*      DCMCOM1                                                          05100002
*       DCMLPENT    ON           COMMAND IS TO BE ISSUED                05150002
*      DCMCOM3                                                          05200002
*       DCMVLPFK ON/OFF/TEST     KEY IS BEING VERIFIED                  05250002
*       DCMRTPFK ON/OFF/TEST     RETURN TO PFK 1 IS REQUIRED            05300002
*      DCMUTILT                                                         05350002
*       DCMUTILA ON/OFF/TEST     USER DEFINED CURSOR IN COMMAND         05400002
*       DCMUTILB ON/OFF/TEST     CANCEL REQUESTED WITH MASTER KEY ACT   05450002
*       DCMUTILC ON/OFF/TEST     CANCEL REQUESTED                       05500002
*       DCMUTILD   ON/TEST       MODIFIED CANCEL AND MESG EXIT          05550002
*      DCMCMSG3                                                         05600002
*       DCMDTBSY    ON           ISSUE TASK BUSY MESSAGE                05650002
*      DCMCMSG4                                                         05700002
*       DCMPFKNA    ON           ISSUE PFK NOT ALLOCATED MESSAGE        05750002
*       DCMPFKND    ON           ISSUE PFK NOT DEFINED MESSAGE          05800002
*      PFK AREA                                                         05850002
*       DCMPFKDF   TEST          KEY HAS BEEN DEFINED                   05900002
*       DCMPFKPR ON/OFF/TEST     KEY IS BEING PROCESSED                 05950002
*       DCMPFKKY   TEST          KEY IS A LIST OF KEYS                  06000002
*       DCMPFKCN   TEST          KEY DEFINED AS CONVERSATIONAL MODE     06050002
         EJECT                                                          06100002
*                REGISTER EQUATES                                       06150002
         SPACE                                                          06200002
X1PARM   EQU   1                                                        06210002
XERTRN   EQU   14                                                       06212002
XFBRANCH EQU   15                                                       06220002
R0       EQU   0                   WORK REGISTER                        06250002
PARM     EQU   1                   PARAMETER REGISTER (CXSA POINTER)    06300002
APFK     EQU   2                   PFK AREA POINTER                     06350002
POSIT    EQU   2                   PFK POSITION IN LINE                 06400002
SCAN     EQU   3                   SCAN REGISTER                        06450002
INDEX    EQU   3                   PFK POSITION IN LINE                 06500002
DECR     EQU   4                   DECREMENTING REG FOR COMMAND SEARCH  06550002
STOPRG   EQU   5                   END OF COMMAND                       06600002
ENTRYPT  EQU   6                   PTR TO ENTRY AREA                    06650002
CURSREG  EQU   6                   CURSOR POSITION REGISTER             06700002
MPFK     EQU   7                   PTR TO MASTER KEY AREA               06750002
STARTRG  EQU   8                   START OF COMMAND                     06800002
CXSABASE EQU   9                   CXSA BASE REGISTER                   06850002
UCME     EQU   10                  UCM ENTRY ADDRESS (MOMENTARY)        06900002
RETURN   EQU   10                  SUBROUTINE RETURN POINTER            06950002
DCMB     EQU   11                  DCM BASE REGISTER                    07000002
BASE     EQU   12                  PROGRAM BASE REGISTER                07050002
PFKPTR   EQU   13                  POINTER TO PFK AREA                  07100002
SWTCHREG EQU   15                  BRANCH REGISTER FOR KEY CANCEL       07150002
**************************************************                      07200002
         EJECT                                                          07250002
START    BALR  BASE,N0             ESTABLISH BASE REGISTER              07300002
         USING *,BASE                                                   07350002
         B     BEGIN               BRANCH AROUND PATCH AREA             07360002
ICATCH   DC    CL72'IEECVFTA'      EYECATCHER AND FIELD MAINTENANCE     07370002
BEGIN    EQU   *                   END OF PATCH AREA                    07380002
         LR    CXSABASE,PARM       ESTABLISH CXSA BASE REGISTER         07550002
         USING CXSA,CXSABASE                                            07600002
         L     UCME,N16(PARM)      ESTABLISH UCM ENTRY ADDRESS          07650002
         L     DCMB,N28(UCME)      ESTABLISH DCM ADDRESS                07700002
         USING DCMTSRT,DCMB                                             07750002
         L     PFKPTR,DCMADPFK     POINT TO PFK AREA                    07800002
         L     DCMB,DCMADTRN       GET TRANSIENT DCM BASE               07850002
         DROP  DCMB                                                     07900002
         USING DCMSTRT,DCMB                                             07950002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      08000002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    08010002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      08020002
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          08030002
         LR    X1PARM,CXSABASE     PASS CXSA ADDRESS IN REG 1           08040002
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        08042002
         NI    DCMUTILT,Z          CLEAR ALL UTILITY FLAGS              08050002
         SPACE 5                                                        08100002
*/*%START: P (,%BEGIN)  SET SWITCH REGISTER TO LABEL 'VALID' */         08150002
*****************************************************************       08200002
         LA    SWTCHREG,VALID      SET SWITCH REG FOR NORMAL OP         08250002
         SPACE 5                                                        08300002
*/*%BEGIN: D (VER,TESTCANX,WORK,TESTERR,ATTN,ENTRY) REASON FOR ENTRY */ 08350002
*****************************************************************       08400002
         TM    DCMCOM3,DCMVLPFK    RETURN FROM VERIFY                   08450002
         BO    TESTCANX             YES, POSSIBLE CANCEL                08500002
         TM    DCMCOM3,DCMRTPFK    IS A KEY IN PROCESS                  08550002
         BO    TESTERR              YES, SEE IF 2ND ATTENTION           08600002
         B     ENTRY                NO, DETERMINE REASON FOR ENTRY      08650002
         SPACE 5                                                        08700002
*/*TESTCANX: D (NO,FIND,YES,CANX)            CANCEL REQUESTED? */       08750002
*****************************************************************       08800002
TESTCANX EQU   *                                                        08850002
         TM    DCMIOCM3,DCMPFKAT+DCMRDPFK    2ND PFK ATTENTION          08900002
         BNZ   CANX                 YES, CANCEL CURRENT KEY             08950002
         B     FIND                 NO, CONTINUE WITH THIS KEY          09000002
         SPACE 5                                                        09050002
*/*TESTERR: D (NO,FIND,YES,ERROR)           SECOND ATTENTION? */        09100002
*****************************************************************       09150002
TESTERR  EQU   *                                                        09200002
         TM    DCMIOCM3,DCMPFKAT+DCMRDPFK    2ND PFK ATTENTION          09250002
         BNZ   ERROR3               YES, INVALID. ONE AT A TIME         09300002
         B     FIND                 NO, CONTINUE WITH THIS KEY          09350002
         SPACE 5                                                        09400002
*/*CANX: D (YES,GETOUT,NO,%SETREG)   IS LAST COMMAND ON SCREEN? */      09450002
*****************************************************************       09500002
CANX     EQU   *                                                        09550002
         NI    DCMIOCM3,X'FF'-DCMPFKAT-DCMRDPFK   CANCEL ATTENTIONS     09600002
         NI    DCMCOM3,X'FF'-DCMRTPFK-DCMVLPFK     AND IN PROCESS FLAGS 09650002
         OI    DCMUTILT,DCMUTILC   INDICATE CANCEL                      09700002
         CLI   DCMPFKNM,FOXFLAG    IS LAST COMMAND ON SCREEN            09750002
         BE    GETOUT               YES, NO CLEANUP REQUIRED            09800002
         SPACE 5                                                        09850002
*/*%SETREG: P (,FIND)  SET SWITCH REGISTER TO LABEL 'CANMAS' */         09900002
*****************************************************************       09950002
         BAL   SWTCHREG,FIND       LOCATE KEY IN PROCESS                10000002
         SPACE 5                                                        10050002
*/*CANMAS: P (,MOPUP)   SET FLAG (DCMUTILB) IF MASTER KEY IN USE */     10100002
*****************************************************************       10150002
CANMAS   CLI   DCMPFKKN,FOXFLAG    IS A MASTER KEY IN USE               10200002
         BE    MOPUP                NO, CLEAR SINGLE KEY                10250002
CXMAS    EQU   *                    YES, CLEAR MASTER KEY               10300002
         OI    DCMUTILT,DCMUTILB   INDICATE CANCEL MASTER KEY           10350002
         B     MOPUP               GO TO IT                             10400002
         SPACE 4                                                        10450002
*/*ENTRY: D (L/P,LPPFK,KEY,ATTENT)      ATTENTION TYPE */               10500002
*****************************************************************       10550002
ENTRY    EQU   *                                                        10600002
         TM    DCMIOCM3,DCMPFKAT   PFK ATTENTION                        10650002
         BO    ATTENT               YES, HANDLE                         10700002
*ASSUME LIGHT PEN DETECT ON PFK LINE                                    10750002
         B     LPPFK               GO TO HANDLE LIGHT PEN               10800002
         EJECT                                                          10850002
*/*ATTENT: P (,FIND)           MOVE KEY TO WORK AREA */                 10900002
*****************************************************************       10950002
ATTENT   EQU   *                                                        11000002
         NI    DCMIOCM3,X'FF'-DCMPFKAT  TURN OFF ATTENTION FLAG         11050002
* START OF DEVICE DEPENDENT CODE *********                              11100002
         TM    DCMDSAV,ANRPFK      IS THIS A 3270 DEVICE      MH  M1517 11150002
         BNO   G2250                NO, ASSUME 2250 TYPE                11200002
         MVC   DCMPFKNM(L'DCMPFKNM),DCMDSAV  YES, GET KEY #   MH  M1517 11250002
         NI    DCMPFKNM,X'FF'-STRIP  STRIP OFF ZONE           MH  M1517 11300002
         B     FIND                GO TO BEGIN PROCESSING     MH  M1517 11350002
G2250    MVC   DCMPFKNM(L'DCMPFKNM),DCMDSAV+N1  GET KEY #     MH  M1517 11400002
         B     FIND                GO TO BEGIN PROCESSING     MH  M1517 11450002
* END OF DEVICE DEPENDENT CODE ***********                    MH  M1517 11500002
         SPACE 5                                                        11550002
*/*LPPFK: P (,FIND)           CONVERT LOCATION TO KEY NUMBER */         11600002
*****************************************************************       11650002
LPPFK    EQU   *                                                        11700002
         NI    DCMIOCM3,X'FF'-DCMRDPFK  TURN OFF ATTN FLAG              11750002
         SR    POSIT,POSIT         CLEAR WORK                           11800002
         SR    INDEX,INDEX              REGISTERS                       11850002
         IC    INDEX,DCMDSAV+N1    GET CHARACTER POSITION               11900002
         D     POSIT,F6            DIVIDE BY SPACES PER KEY             11950002
* NOTE: RESULT NOW IN INDEX                                             12000002
         M     POSIT,FPFKLGN       MULTIPLY BY PFK AREA LENGTH          12050002
         AR    INDEX,PFKPTR        ADD TO START OF AREAS                12100002
         MVC   DCMPFKNM(L'DCMPFKNM),N0(INDEX)     GET KEY NUMBER        12150002
         B     FIND                GO TO PROCESS IT                     12200002
         SPACE 5                                                        12250002
*/*FIND: D (YES,%SWITCH,NO,ERROR)   IS KEY ALLOCATED?        */         12300002
************************************************************            12350002
FIND     EQU   *                                                        12400002
         LR    APFK,PFKPTR         GET ADDRESS OF FIRST PFK AREA        12450002
         LTR   APFK,APFK           ANY KEYS ALLOCATED                   12500002
         BZ    ERROR                NO, ERROR                           12550002
CHECK    EQU   *                                                        12600002
         CLI   Z(APFK),N100        HAVE WE CHECKED THEM ALL             12650002
         BE    ERROR                IF SO, PFK ENTRY IS INVALID         12700002
         CLC   Z(N1,APFK),DCMPFKNM IS THIS THE AREA FOR THE KEY         12750002
         EJECT                                                          12800002
*/*%SWITCH: D (NORM,VALID,CANX,CANMAS) WHICH WAY IS SWITCH REGISTER     12850002
*/*SET? */                                                              12900002
************************************************************            12950002
         BCR   EQUAL,SWTCHREG       IF SO, CONTINUE PROCESSING          13000002
* NOTE  BRANCH IS TO LABEL 'VALID' FOR NORMAL PROCESSING AND            13050002
*       TO LABEL 'CANMAS' FOR KEY CANCEL OPERATION.                     13100002
         LA    APFK,PFKLGN(APFK)    ELSE, POINT TO NEXT PFK AREA        13150002
         B     CHECK               GO BACK AND CHECK IT OUT             13200002
         SPACE 5                                                        13250002
*/*VALID: D (YES,%PROCTST,NO,ERROR)      IS KEY DEFINED? */             13300002
************************************************************            13350002
VALID    EQU   *                                                        13400002
         TM    N1(APFK),DCMPFKDF   HAS THIS KEY BEEN DEFINED            13450002
         BZ    ERROR2               IF NOT, KEY CANNOT BE USED          13500002
         SR    DECR,DECR           CLEAR REGISTER                       13550002
         LH    DECR,CHARPOS        NUMBER OF CHARACTER POSITIONS        13600002
         SPACE 5                                                        13650002
*/*%PROCTST: D (NO,%INPROC,YES,KEYLIST) KEY ALREADY IN PROCESS? */      13700002
************************************************************            13750002
         TM    N1(APFK),DCMPFKPR   IS PROCESSING ALREADY IN PROGRESS    13800002
         BO    KEYLIST              YES, GET FIRST OR NEXT COMMAND      13850002
         SPACE 5                                                        13900002
*/*%INPROC: P (,KEYLIST)  INDICATE IN PROCESS */                        13950002
************************************************************            14000002
         OI    N1(APFK),DCMPFKPR   INDICATE PROCESSING IN PROGRESS      14050002
         EJECT                                                          14100002
*/*KEYLIST: D (NO,SCANCOM,YES,%POINT) IS THIS KEY A LIST OF KEYS? */    14150002
************************************************************            14200002
KEYLIST  TM    N1(APFK),DCMPFKKY   IS THIS KEY A LIST OF KEYS           14250002
         BZ    SCANCOM              NO, GET FIRST OR NEXT COMMAND       14300002
         SPACE 5                                                        14350002
*/*%POINT: P (,FIND)               POINT TO FIRST KEY IN LIST */        14400002
************************************************************            14450002
         SR    MPFK,MPFK           CLEAR MASTER KEY POINTER             14500002
         MVC   DCMPFKKN(L'DCMPFKKN),DCMPFKNM SAVE MASTER KEY            14550002
TESTIT   TM    N3(APFK),STOPPER    IS THIS KEY ALREADY PROCESSED        14600002
         BNO   FIRST                NO, HANDLE IT                       14650002
         LA    APFK,N2(APFK)        YES, POINT TO NEXT ONE              14700002
         CLI   N2(APFK),KEYSTOP    IS THIS THE LIST STOPPER             14750002
         BE    MOPMAST              YES, CLEAN UP LIST                  14800002
         B     TESTIT               NO, GO TO TEST IT                   14850002
* NOTE  THE PRECEEDING SIX INSTRUCTIONS ARE USED ONLY WHEN A LIST OF    14900002
*       KEYS CONTAINED AN UNDEFINED KEY, WHICH STOPS PROCESSING OF THE  14950002
*       LIST. WHEN THE KEY IS DEPRESSED A SECOND TIME THIS CODE         15000002
*       INSURES THAT PROCESSING RESUMES WITH THE KEY AFTER THE ONE      15050002
*       WHICH WAS NOT DEFINED. IF THE UNDEFINED KEY WAS THE LAST        15100002
*       IN THE LIST THE LIST IS MOPPED UP.                              15150002
FIRST    MVC   DCMPFKNM(L'DCMPFKNM),N2(APFK) SET UP 1ST KEY IN LIST     15200002
         MVI   N3(APFK),STOPPER    MARK IT AS PROCESSED                 15250002
         B     FIND                GO TO PROCESS THIS KEY               15300002
         EJECT                                                          15350002
*/*SCANCOM: P (,CON)  MOVE FIRST OR NEXT COMMAND TO ENTRY AREA   */     15400002
************************************************************            15450002
SCANCOM  LA    STARTRG,N2(APFK)    POINT TO START OF AREA               15500002
         LA    CURSREG,N3(STARTRG) SET DEFAULT CURSOR AT POS. 3         15550002
         SR    SCAN,SCAN           CLEAR SCAN REGISTER                  15600002
         LR    SCAN,STARTRG        POINT SCAN REG TO START OF TEXT      15650002
FOXES    CLI   Z(SCAN),STOPPER     IS THIS A STOPPER                    15700002
         BE    STARTPT              YES, THIS IS START OF NEXT COMMAND  15750002
         CLI   Z(SCAN),SEMI        IS THIS A SEMI-COLON                 15800002
         BE    STOPPT               YES, THIS IS END OF NEXT COMMAND    15850002
         CLI   Z(SCAN),CURS        IS THIS A CURSOR                     15900002
         BE    CURSE                YES, GO SAVE ITS LOCATION           15950002
INCR     LA    SCAN,N1(SCAN)        NO, POINT TO NEXT CHARACTER         16000002
         BCT   DECR,FOXES          LOOK AT NEXT CHARACTER               16050002
         LR    STOPRG,SCAN         STOP AT END OF AREA                  16100002
         B     CALC                GO TO FIGURE COMMAND LENGTH          16150002
STARTPT  LA    STARTRG,N1(SCAN)    REMEMBER WHERE COMMAND STARTS        16200002
         NI    DCMUTILT,X'FF'-DCMUTILA  CLEAR USER CURSOR FLAG          16250002
         LA    CURSREG,N3(STARTRG) SET DEFAULT CURSOR AT POS. 3         16300002
         B     INCR                GO LOOK FOR END OF COMMAND           16350002
CURSE    LA    CURSREG,N1(SCAN)    SAVE CURSOR LOCATION                 16400002
         OI    DCMUTILT,DCMUTILA   FLAG AS USER-DEFINED CURSOR          16450002
         B     INCR                GO LOOK FOR END OF COMMAND           16500002
STOPPT   LR    STOPRG,SCAN         REMEMBER WHERE COMMAND STOPS         16550002
         MVI   Z(SCAN),STOPPER     AND MARK IT AS PROCESSED             16600002
CALC     SR    STOPRG,STARTRG      CALCULATE COMMAND LENGTH IN STOPRG   16650002
         LTR   STOPRG,STOPRG       IS LENGTH ZERO                       16700002
         BZ    ERROR2               YES, INDICATE ERROR                 16750002
         BCTR  STOPRG,R0           REDUCE LENGTH BY ONE FOR EXECUTE     16800002
         SR    CURSREG,STARTRG     CALCULATE CURSOR POSITION + 1        16850002
         STC   CURSREG,DCMPOSCU    SAVE IT                              16900002
         MVI   DCMCULNO,N1         CURSOR GOES IN LINE ONE              16950002
         L     ENTRYPT,DCMAENTR    POINT TO ENTRY AREA                  17000002
         MVI   N0(ENTRYPT),BLANK   BLANK FIRST CHAR OF ENTRY AREA       17050002
         MVC   N1(N126,ENTRYPT),N0(ENTRYPT)  BLANK REST OF IT           17100002
         EX    STOPRG,MVCM         MOVE COMMAND TO ENTRY AREA           17150002
         TM    DCMUTILT,DCMUTILA   USER-DEFINED CURSOR                  17200002
         BNO   CON                  NO, CONTINUE                        17250002
         SR    SCAN,SCAN           CLEAR REGISTER                       17300002
         IC    SCAN,DCMPOSCU       GET CURSOR POSITION + 1              17350002
         BCTR  SCAN,N0             GET CURSOR POSITION                  17400002
         AR    ENTRYPT,SCAN        POINT TO CURSOR                      17450002
         LA    STARTRG,N1(ENTRYPT) POINT TO NEXT CHARACTER              17500002
         LH    STOPRG,CHARPOS      GET NUMBER OF CHARS. PER LINE        17550002
         SR    STOPRG,SCAN         SUBTRACT TO GET MOVE LENGTH          17600002
         BCTR  STOPRG,R0           REDUCE BY ONE FOR EXECUTE            17650002
         EX    STOPRG,MVCM         SCRUNCH LINE TO LEFT TO              17700002
*                                   DELETE CURSOR CHARACTER             17750002
         EJECT                                                          17800002
*/*CON: D (YES,WRIT,NO,ISSU)                CON- VERSATIONAL MODE? */   17850002
************************************************************            17900002
CON      OI    DCMCOM3,DCMRTPFK    TELL PROC TO RETURN TO PFK ROUT      17950002
         TM    N1(APFK),DCMPFKCN   KEY IN CONVERSATIONAL MODE           18000002
         BO    WRIT                 YES, GO TO WRITE ENTRY              18050002
         CLI   DCMPFKKN,FOXFLAG    IS THIS KEY PART OF A LIST           18100002
         BE    ISSU                 NO, GO TO ISSUE COMMAND             18150002
         BAL   RETURN,FINDKN        YES, GET MASTER KEY FOR INSPECTION  18200002
OUT      TM    N1(MPFK),DCMPFKCN   MASTER KEY IN CONVERSATIONAL MODE    18250002
         BO    WRIT                 YES, GO TO WRITE ENTRY              18300002
         B     ISSU                 NO, GO TO ISSUE COMMAND             18350002
         SPACE 5                                                        18400002
*/*WRIT: P (,IO)    INDICATE VERIFY, WRITE ENTRY & INSERT CURSOR */     18450002
************************************************************            18500002
WRIT     OI    DCMIOCM1,DCMWRENT+DCMINSC+DCMWRINS     INDICATE          18550002
*                                  WRITE ENTRY, WRITE INST LINE AND     18600002
*                                  INSERT CURSOR                        18650002
         OI    DCMIOCM2,DCMINSSH   INDICATE INIT INST LINE              18700002
         OI    DCMCOM3,DCMVLPFK    INDICATE VERIFY IN PROCESS           18750002
         SPACE 5                                                        18800002
*/*IO: P (,ENDTEST)   SET EXIT FOR DEV.DEP. I/O ROUTINE */              18850002
************************************************************            18900002
IO       L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              18950002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     18960002
         B     ENDTEST             GO WRITE THE COMMAND FOR VERIFY      19000002
         SPACE 5                                                        19050002
*/*ISSU: P (,ENDTEST)  TURN ON ISSUE FLAG AND SET EXIT FOR COMMAND */   19100002
************************************************************            19150002
ISSU     OI    DCMCOM1,DCMLPENT    INDICATE COMMAND TO BE ISSUED        19200002
*                                  (DUMMY ENTER)                        19250002
         L     XFBRANCH,DCMNCMD1   LOAD COMMAND ADDRESS       MH YM2960 19300002
*                                  FOR EXIT TO IEECVET4       MH YM2960 19310002
         EJECT                                                          19350002
*/*ENDTEST: D (NO,XCTL,YES,MOPUP)  DONE WITH THIS KEY? */               19400002
************************************************************            19450002
ENDTEST  EQU   *                                                        19500002
         LTR   DECR,DECR           WAS THIS LAST COMMAND OF A KEY       19550002
         BP    XCTL                 NO, EXIT TO REQUIRED MODULE         19600002
         SPACE 5                                                        19650002
*/*MOPUP: P (,MORE)               CLEAN UP PFK AREA */                  19700002
************************************************************            19750002
MOPUP    MVI   DCMPFKNM,FOXFLAG    CLEAR OLD KEY NUMBER                 19800002
         SR    DECR,DECR           CLEAR LIMIT REGISTER                 19850002
         LH    DECR,CHARPOS        SET LIMIT VALUE                      19900002
         LA    SCAN,N2(APFK)       POINT TO START OF AREA               19950002
THERE    CLI   Z(SCAN),STOPPER     IS THIS A STOPPER                    20000002
         BNE   BUMPIT               NO, LOOK AT NEXT CHARACTER          20050002
         MVI   Z(SCAN),SEMI         YES, CHANGE IT TO SEMI-COLON        20100002
BUMPIT   LA    SCAN,N1(SCAN)       POINT TO NEXT CHARACTER              20150002
         BCT   DECR,THERE          LOOP UNTIL FINISHED                  20200002
         NI    N1(APFK),X'FF'-DCMPFKPR    TURN OFF IN PROGRESS BIT      20250002
         TM    DCMUTILT,DCMUTILB   CANCEL REQUESTED WITH LIST OF KEYS   20300002
         BNO   MORE                 NO, CONTINUE                        20350002
         NI    DCMUTILT,X'FF'-DCMUTILB  TURN OFF CANCEL FLAG            20400002
         B     MOPMAST             GO TO CLEAN UP                       20450002
         SPACE 5                                                        20500002
*/*MORE: D (NO,GETOUT,YES,%NEXT)   MORE KEYS IN LIST? */                20550002
************************************************************            20600002
MORE     CLI   DCMPFKKN,FOXFLAG    IS A MASTER KEY IN USE               20650002
         BE    GETOUT               NO, WE ARE ALL DONE                 20700002
         BAL   RETURN,FINDKN       LOCATE MASTER KEY AREA               20750002
         SR    SCAN,SCAN           CLEAR SCAN REG                       20800002
         LA    SCAN,Z(MPFK)        POINT TO PFK AREA                    20850002
LOOP     LA    SCAN,N2(SCAN)       POINT TO NEXT KEY                    20900002
         CLI   N1(SCAN),STOPPER    HAS THIS KEY BEEN PROCESSED          20950002
         BE    LOOP                 YES, LOOK AT NEXT ONE               21000002
         CLI   Z(SCAN),KEYSTOP      NO, ANY MORE KEYS IN LIST           21050002
         BE    MOPMAST               NO, CLEAN UP MASTER KEY AREA       21100002
         EJECT                                                          21150002
*/*%NEXT: P (,XCTL)        SET UP NEXT KEY */                           21200002
************************************************************            21250002
         MVC   DCMPFKNM(L'DCMPFKNM),Z(SCAN)  YES, MOVE TO ENTRY         21300002
         MVI   N1(SCAN),STOPPER    FLAG THIS KEY AS HANDLED             21350002
         B     XCTL                RETURN TO PROCESSOR                  21400002
MOPMAST  EQU   *                                                        21450002
         MVC   DCMPFKNM(L'DCMPFKNM),DCMPFKKN  MAKE MASTER KEY ACTIVE    21500002
         BAL   RETURN,FINDKN       GO TO FIND MASTER PFK AREA           21550002
         LR    APFK,MPFK           POINT TO MASTER FOR MOPUP            21600002
         MVI   DCMPFKKN,FOXFLAG    CLEAR SAVED MASTER KEY               21650002
         B     MOPUP               GO TO MOP UP MASTER KEY AREA         21700002
         SPACE 5                                                        21750002
*/*GETOUT: P (,XCTL)     INDICATE PROCESSING DONE   */                  21800002
************************************************************            21850002
GETOUT   NI    DCMCOM3,X'FF'-DCMRTPFK   TELL PROCESSOR WE ARE DONE      21900002
         OI    DCMIOCM2,DCMINSSH   INDICATE INIT. INSTRUCTION LINE      21950002
         OI    DCMIOCM1,DCMWRINS   INDICATE WRITE INST. LINE            22000002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              22050002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     22100002
         TM    DCMUTILT,DCMUTILC   CANCEL IN PROGRESS                   22150002
         BNO   XCTL                 NO, CONTINUE                        22200002
         NI    DCMUTILT,X'FF'-DCMUTILC   YES, TURN OFF CANCEL FLAG      22250002
         MVI   DCMPOSCU,N1         RESTORE NORMAL CURSOR TO             22300002
         MVI   DCMCULNO,N1            LINE 1 POSITION 1                 22350002
         OI    DCMIOCM2,DCMBLENT   INDICATE BLANK ENTRY AREA            22400002
         OI    DCMIOCM1,DCMWRENT+DCMINSC      AND WRITE TO SCREEN       22450002
         B     XCTL                GO TO DO IT                          22500002
         SPACE 5                                                        22550002
***************SUBROUTINE TO POINT TO AREA OF MASTER KEY*************   22600002
FINDKN   LR    MPFK,PFKPTR         ADDRESS OF FIRST PFK AREA            22650002
LP       EQU   *                                                        22700002
         CLC   Z(N1,MPFK),DCMPFKKN IS THIS THE AREA FOR THE KEY         22750002
         BCR   EQUAL,RETURN         YES, RETURN TO CALLER               22800002
         LA    MPFK,PFKLGN(MPFK)    NO, POINT TO NEXT AREA              22850002
         B     LP                  SEE IF THIS IS IT                    22900002
***************************END OF SUBROUTINE**************              22950002
         EJECT                                                          23000002
*/*ERROR: P (,XCTL) SET UP ERROR MESSAGE & SET EXIT FOR MESSAGE MODULE  23050002
*/**/                                                                   23100002
************************************************************            23150002
ERROR    EQU   *                                                        23200002
         OI    DCMCMSG4,DCMPFKNA   INDICATE PFK UNALLOCATED ERROR MSG   23250002
         B     MSG3NAME            GO TO WRITE ERROR MESG               23300002
ERROR2   EQU   *                                                        23350002
         OI    DCMCMSG4,DCMPFKND   INDICATE PFK UNDEFINED ERROR MSG     23400002
CLEANUP  MVI   DCMPFKKN,FOXFLAG    ERASE MASTER KEY IF IN USE           23450002
         NI    DCMCOM3,X'FF'-DCMRTPFK-DCMVLPFK   DO NOT RETURN HERE     23500002
         B     MSG3NAME            GO TO PERFORM KEY CANCEL             23550002
ERROR3   EQU   *                                                        23600002
         OI    DCMCMSG4,DCMPFKIP    INDICATE IN PROCESS                 23650002
         NI    DCMIOCM3,X'FF'-DCMPFKAT-DCMRDPFK   TURN OFF FLAGS        23700002
MSG3NAME EQU   *                                                        23750002
         L     XFBRANCH,DCMNMSG3   LOAD MESSAGE 3 ADDRESS               23800002
*                                  FOR EXIT TO IEECVFTD                 23850002
         SPACE 5                                                        23900002
*/*XCTL: R          PROCESSOR, I/O OR MESSAGE MODULE */                 23950002
************************************************************            24000002
XCTL     EQU   *                                                        24050002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 24100002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             24110002
         SPACE 5                                                        24150002
*********  EXECUTED INSTRUCTION  **************                         24200002
*     THIS INSTRUCTION IS EXECUTED FOR TWO PURPOSES:                    24250002
*         1. TO MOVE A COMMAND FROM THE PFK AREA TO                     24300002
*             THE COMMAND ENTRY AREA.                                   24350002
*         2. TO MOVE A PORTION OF A COMMAND WITHIN THE COMMAND          24400002
*             ENTRY AREA TO DELETE A USER-DEFINED CURSOR.               24450002
MVCM     MVC   Z(Z,ENTRYPT),Z(STARTRG)                                  24500002
***********************************************                         24550002
         SPACE 5                                                        24600002
*/*IEECVFTA: END */                                                     24650002
***********************************************************             24700002
         EJECT                                                          24750002
*      CONSTANTS                                                        24800002
CHARPOS  DC    H'108'              NO. OF CHAR POSITIONS      MH  M0633 24850002
F6       DC    F'6'                NUMBER OF SPACES PER PFK ON SCREEN   24900002
FPFKLGN  DC    F'110'              MUST BE SAME AS PFKLGN               24950002
*      EQUATES                                                          25000002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            25010002
ID2      EQU   C'A'                2ND CHARACTER OF CSECT ID            25020002
*      PFK AREA EQUATES                                                 25030002
DCMPFKDF EQU   X'80'               KEY HAS BEEN DEFINED                 25040002
DCMPFKPR EQU   X'40'               KEY IS BEING PROCESSED               25042002
DCMPFKCN EQU   X'20'               KEY DEFINED AS CONVERSATIONAL MODE   25042402
DCMPFKKY EQU   X'08'               KEY IS A LIST OF KEYS                25044002
ANRPFK   EQU   X'70'               3277 PFK ZONE                        25050002
BLANK    EQU   C' '                BLANK CHARACTER                      25100002
CURS     EQU   X'6D'               UNDERSCORE CHARACTER FOR CURSOR      25150002
EQUAL    EQU   8                   BRANCH CONDITION                     25200002
FOXFLAG  EQU   X'FF'               NO MASTER KEY                        25250002
KEYSTOP  EQU   X'61'               MASTER KEY STOPPER                   25300002
N0       EQU   0                   NUMBER                               25350002
N1       EQU   1                   NUMBER                               25400002
N2       EQU   2                   NUMBER                               25450002
N3       EQU   3                   NUMBER                               25500002
N4       EQU   4                   NUMBER                               25550002
N16      EQU   16                  NUMBER                               25600002
N28      EQU   28                  NUMBER                               25650002
N100     EQU   100                 NUMBER                               25700002
N126     EQU   126                 LENGTH OF ENTRY AREA                 25750002
PFKLGN   EQU   110                 LENGTH OF PFK AREA                   25800002
SEMI     EQU   C';'                CHARACTER                            25850002
STOPPER  EQU   X'FF'               STOPPER FLAG                         25900002
STRIP    EQU   X'F0'               REMOVES ANR AID ZONE                 25950002
Z        EQU   0                   NUMBER                               26000002
         EJECT                                                          26050002
* THE FOLLOWING STATEMENTS WILL GENERATE A FLOWCHART WHICH SHOWS THE    26100002
* RELATIONSHIP BETWEEN PFK 1 AND THE REST OF DIDOCS.                    26150002
         SPACE 5                                                        26200002
*/*PFKFLOW: CHART */                                                    26250002
*/* HEADER                                                              26300002
*/*                       PFK OPERATION - OVERALL FLOW                  26350002
*/*                                                    PAGE #       */  26400002
*/* E (,%PROC) ATTENTION OR RETURN FROM OTHER MODULES */                26450002
*/*%PROC: S (,%LPATTN)   XCTL:         PROCESSOR 1 */                   26500002
*/*%LPATTN: D (NO,%ECATTN,YES,%LP)      LIGHT PEN ATTENTION */          26550002
*/*%ECATTN: D (NO,%PFKATTN,YES,%CMD)     ENTER OR CANCEL ATTENTION */   26600002
*/*%PFKATTN: D (NO,%MRWRK,YES,%INDPFK)     PFK ATTENTION */             26650002
*/*%MRWRK: D (NO,%MCS,YES,%VERIP)     MORE PFK WORK TO DO */            26700002
*/*%MCS: R                            MCS ROUTER */                     26750002
*/*%LP: S (,%PFKAR)    XCTL:  L/P CURSOR */                             26800002
*/*%PFKAR: D (NO,%OTH,YES,%INDLP)    ATTENTION IN PFK AREA */           26850002
*/*%OTH: R                         OTHER L/P FUNCTIONS */               26900002
*/*%INDLP: P (,%PFK1)             INDICATE LIGHT PEN ATTENTION */       26950002
*/*%CMD: S (,%VEROFF)   XCTL:         COMMAND */                        27000002
*/*%VEROFF: P (,%HANDLE)            TURN OFF VERIFY BIT */              27050002
*/*%HANDLE: P (,%PROC)              PROCESS ENTER OR CANCEL */          27100002
*/*%INDPFK: P (,%PFK1)              INDICATE PFK ATTENTION OCCURRED */  27150002
*/*%VERIP: D (YES,%MCS,NO,%PFK1)     VERIFY BIT ON */                   27200002
*/*%PFK1: S (,%MVCOM) XCTL:           PFK 1 */                          27250002
*/*%MVCOM: P (,%CONV) MOVE COMMAND TO ENTRY AREA IN DCM */              27300002
*/*%CONV: D (NO,%INDENT,YES,%INDWRT)    CON- VERSATIONAL MODE */        27350002
*/*%INDENT: P (,%PROC)        INDICATE ENTER ATTENTION OCCURRED */      27400002
*/*%INDWRT: P (,%VERBIT)      INDICATE WRITE ENTRY AREA TO SCREEN */    27450002
*/*%VERBIT: P (,%IO)              TURN ON VERIFY BIT */                 27500002
*/*%IO: S (,%WRT)  XCTL: DEVICE DEPENDENT I/O ROUTINE */                27550002
*/*%WRT: P (,%PROC)  WRITE ENTRY AREA TO SCREEN */                      27600002
*/*PFKFLOW: END */                                                      27650002
         TITLE 'IEECVFTA   IGC6A07B    PFK ROUTINE 1     RESIDENT DISPL*27700002
               AY CONTROL MODULE'                                       27750002
         IEERDCM                                                        27800002
         TITLE 'IEECVFTA   IGC6A07B    PFK ROUTINE 1      TRANSIENT DIS*27900002
               PLAY CONTROL MODULE'                                     27950002
         IEETDCM                                                        28000002
         TITLE 'IEECVFTA   IGC6A07B     PFK ROUTINE 1      CXSA'        28100002
         IHACTM  CXSA                                                   28200002
         END   START                                                    28250002
./  ADD  SSI=32960794,NAME=IEECVFTB
         TITLE 'IEECVFTB   IGC6B07B    DIDOCS PFK ROUTINE 2'            00050002
IEECVFTB CSECT                                                          00100002
*D 251000,251500                                             ME  YM2527 00110002
*C 252000                                                    ME  YM2527 00120002
*/*IEECVFTB: CHART */                                                   00150002
*/* HEADER                                                              00200002
*/*CHART EA     IEECVFTB                  DIDOCS PFK ROUTINE            00250002
*/* 2                                             PAGE #             */ 00300002
*/* E IEECVFTB */                                                       00350002
         SPACE 5                                                        00400002
* /* START OF SPECIFICATIONS ****                                       00450002
*02*  PROCESSOR = ASSEMBLER;                                            00500002
**** END OF SPECIFICATIONS ***/                                         00550002
         SPACE 4                                                        00600002
* STATUS                                                                00650002
*    CHANGE LEVEL 0                                                     00700002
*    CREATED FOR RELEASE 21, LINE ITEM S21003.                          00750002
         SPACE                                                          00800002
* FUNCTION                                                              00850002
*    TO PROCESS THE DEFINITION OR REDEFINITION, BY THE OPERATOR,        00900002
*    OF PROGRAM FUNTION KEYS ALLOCATED FOR AT SYSGEN TIME AND THE       00950002
*    DISPLAY OF THE PFK LINE ON THE SCREEN.                             01000002
         SPACE                                                          01050002
* ENTRY POINTS                                                          01100002
*         IEECVFTB FOR ALL FUNCTIONS                                    01150002
*             FROM IEECVET4 WHEN A K D,PFK, K N,PFK OR K E,PFK COMMAND  01200002
*             IS ENTERED.                                               01250002
         SPACE                                                          01300002
* INPUT                                                                 01350002
*    THE COMMAND AS ENTERED.                                            01400002
         SPACE                                                          01450002
* OUTPUT                                                                01500002
*    A NEW PFK DEFINITION IN THE DCM OR A FLAG BIT TO THE DEVICE        01550002
*    DEPENDENT I/O ROUTINE, INDICATING THAT THE PFK LINE MUST           01600002
*    BE ALTERED.                                                        01650002
         SPACE                                                          01700002
* EXITS, NORMAL                                                         01900002
*         IEECVET1 (PROCESSOR 1) WHEN A KEY HAS BEEN DEFINED.           01950002
*         DEVICE DEPENDENT I/O ROUTINE TO WRITE THE PFK LINE.           02000002
         SPACE                                                          02050002
* EXITS, ERROR                                                          02100002
*         IEECVETD (MESSAGE MODULE 1) OR IEECVFTD (MESSAGE MODULE 3)    02150002
*         TO WRITE OUT ERROR MESSAGES.                                  02200002
         EJECT                                                          02250002
* TABLES/WORK AREAS                                                     02300002
*    PFK AREA                                                           02350002
*     THIS MODULE USES THE PFK AREA WHICH IS CREATED BY                 02400002
*    SYSGEN.  THERE WILL BE ONE AREA FOR EACH PFK WHICH WAS             02450002
*    ALLOCATED AT SYSGEN TIME.  THE DCMADPFK FIELD IN THE               02500002
*    RESIDENT DCM POINTS TO THE FIRST AREA AND ALL AREAS ARE            02550002
*    CONTIGUOUS.  FOLLOWING THE LAST AREA IS A ONE BYTE FIELD EQUAL TO  02600002
*    X'64', USED TO IDENTIFY THE END OF PFK WORKSPACE.                  02650002
*     EACH PFK AREA IS 110 BYTES LONG FORMATTED AS FOLLOWS:             02700002
*                                                                       02750002
*      DCMNUM    A ONE BYTE FIELD CONTAINING THE KEY NUMBER             02800002
*                IN BINARY.                                             02850002
*                                                                       02900002
*      DCMSTS    A ONE BYTE FLAG FIELD.  FOR EXPLANATION SEE THE DCM    02950002
*                DSECT FOLLOWING THE CODE FOR THIS MODULE.              03000002
*                                                                       03050002
*      DCMVAL    A 108 BYTE FIELD WHICH IS EITHER:                      03100002
*                                                                       03150002
*                 A.  A LIST OF KEYS IN THE FORM KFKF...KF/ WHERE K IS  03200002
*                      A ONE BYTE BINARY KEY NUMBER AND F IS A CONTROL  03250002
*                      BYTE WHICH CONTAINS C';' UNLESS PROCESSING       03300002
*                      IS TAKING PLACE.  THE SLASH (X'61')              03350002
*                      IDENTIFIES THE END OF THE LIST OF KEYS.          03400002
*                 B.  ONE OR MORE COMMANDS IN THE FORM                  03450002
*                            COMMAND;COMMAND;...COMMAND                 03500002
*                      WHERE SEMI-COLONS DELIMIT THE COMMANDS.  IF THE  03550002
*                      LAST COMMAND DOES NOT FILL THE BUFFER IT IS      03600002
*                      PADDED WITH BLANKS.                              03650002
*                                                                       03700002
*    DCM   DESCRIBED IN DSECT AT END OF MODULE                          03750002
         SPACE 2                                                        03800002
* ATTRIBUTES                                                            03850002
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               03900002
         SPACE                                                          03950002
* CHARACTER CODE DEPENDENCY                                             04000002
*    THIS MODULE WAS ASSEMBLED WITH THE EBCDIC CHARACTER SET. IF A      04050002
*    DIFFERENT CHARACTER SET WILL BE USED AT EXECUTION THE MODULE       04100002
*    MUST BE RE-ASSEMBLED USING THAT CHARACTER SET. IN ADDITION THE     04150002
*    EQUATE 'DIGIT' MUST BE CHANGED TO INDICATE THE ZONE ASSIGNED       04200002
*    TO DIGIT CHARACTERS AND THE EQUATE 'PLUS' MUST BE CHANGED TO       04250002
*    A VALID POSITIVE DECIMAL SIGN.                                     04300002
         EJECT                                                          04350002
* NOTES                                                                 04400002
*    THE FOLLOWING FLAG BITS ARE USED:                                  04450002
*     THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF OR  04500002
*    JUST TESTED BY THIS MODULE.                                        04550002
*                                                                       04600002
*        NAME     ACTION            FUNCTION                            04650002
*     DCMCMSG2                                                          04700002
*      DCMRQINC     ON             REQUEST INCONSISTANT MESSAGE         04750002
*      DCMINVOP     ON             INVALID OPERAND MESSAGE              04800002
*     DCMCMSG4                                                          04850002
*      DCMPFKNO     ON             NO PFK ALLOCATION MESSAGE            04900002
*     DCMIOCM1                                                          04950002
*      DCMWRENT     ON             WRITE THE ENTRY AREA                 05000002
*      DCMWRINS     ON             WRITE THE INSTRUCTION LINE           05050002
*      DCMINSC      ON             INSERT CURSOR                        05100002
*     DCMIOCM2                                                          05150002
*      DCMINSSH     ON             INITIALIZE THE INSTRUCTION LINE      05200002
*      DCMBLENT     ON             BLANK THE ENTRY AREA                 05250002
*     DCMIOCM3                                                          05300002
*      DCMOPRMI     ON             RESTORE KEYBOARD                     05350002
*      DCMWRPFK     ON             ALTER PFK LINE                       05400002
*     DCMCOM3                                                           05450002
*      DCMPFKWR     ON             WRITE PFK AREA TO DISK               05500002
*     DCMUTILT                                                          05550002
*      DCMUTILA ON/OFF/TEST        KEY= OPERAND USED                    05600002
*      DCMUTILB ON/OFF/TEST        END OF OPERAND FOUND                 05650002
*      DCMUTILC ON/OFF/TEST        CON= OPERAND EXPECTED                05700002
*      DCMUTILD ON/OFF/TEST        PREVIOUS QUOTE DETECTED              05750002
*      DCMUTILF ON/OFF/TEST        MASTER KEY IN PROCESS                05800002
*     PFK AREA                                                          05850002
*      DCMPFKCN     ON             KEY DEFINED AS CONVERSATIONAL MODE   05900002
*      DCMPFKDF   ON/TEST          KEY HAS BEEN DEFINED                 05950002
*      DCMPFKKY   ON/TEST          KEY IS A LIST OF KEYS                06000002
         EJECT                                                          06050002
*       REGISTER EQUATES                                                06100002
         SPACE                                                          06150002
X1PARM   EQU   1                                                        06160002
XERTRN   EQU   14                                                       06162002
XFBRANCH EQU   15                                                       06170002
PFKPTR   EQU   0                   POINTER TO PFK AREA                  06200002
CXSABASE EQU   1                   CXSA BASE REGISTER                   06250002
OPER     EQU   2                   OPERAND POINTER                      06300002
APFK     EQU   3                   PFK AREA POINTER OR BINARY KEY       06350002
LPFK     EQU   4                   PFK LINE POINTER                     06400002
COMPARE  EQU   4                   KEY COMPARISON                       06450002
BADPT    EQU   4                   WORK REG FOR ERROR MESG SETUP        06500002
LIMIT    EQU   5                   SCAN LIMIT REGISTER                  06550002
LISTAPFK EQU   5                   PFK AREA POINTER                     06600002
MPFK     EQU   6                   MASTER PFK                           06650002
SCAN     EQU   7                   SCAN REGISTER                        06700002
DCMB     EQU   8                   DCM BASE REGISTER                    06750002
UCME     EQU   9                   UCM ENTRY ADDRESS (MOMENTARY)        06800002
STRTPT   EQU   9                   WORK REGISTER                        06850002
SCAN2    EQU   10                  SUBSCAN POINTER                      06900002
ENDREG   EQU   10                  END OF NEW DEFINITION                06950002
BASE     EQU   11                  PROGRAM BASE REGISTER                07000002
LENGTH   EQU   12                  LENGTH FOR MVC                       07050002
OPSTART  EQU   12                  START OF OPERAND LIST                07100002
RET      EQU   13                  RETURN FROM SUBROUTINE               07150002
KEYLIST  EQU   14                  KEY NUMBER FROM LIST                 07200002
BADOP    EQU   14                  NUMBER OF DELETED QUOTES             07250002
RETURN   EQU   14                  RETURN REG FOR XCTL                  07300002
STORE    EQU   15                  DEFINITION INDEX                     07350002
         EJECT                                                          07400002
START    BALR  BASE,N0             ESTABLISH BASE REGISTER              07450002
         USING *,BASE                                                   07500002
         B     BEGIN               BRANCH AROUND PATCH AREA             07550002
ICATCH   DC    CL72'IEECVFTB'      EYECATCHER AND FIELD MAINTENANCE     07600002
BEGIN    EQU   *                   END OF PATCH AREA                    07650002
         USING CXSA,CXSABASE       CXSA BASE PASSED AS PARM             07700002
         L     UCME,N16(CXSABASE)  ESTABLISH UCM ENTRY ADDRESS          07800002
         L     DCMB,N28(UCME)      ESTABLISH DCM ADDRESS                07850002
         USING DCMTSRT,DCMB                                             07900002
         L     PFKPTR,DCMADPFK     SAVE PFK AREA POINTER                07950002
         L     DCMB,DCMADTRN       GET TRANSIENT DCM BASE               08000002
         DROP  DCMB                                                     08050002
         USING DCMSTRT,DCMB                                             08100002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      08150002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    08160002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      08170002
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          08180002
         LR    X1PARM,CXSABASE     PASS CXSA ADDRESS IN REG 1           08190002
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        08192002
         OI    DCMIOCM2,DCMBLENT   BLANK THE ENTRY AREA                 08200002
         OI    DCMIOCM1,DCMINSC+DCMWRENT+DCMWRINS CLEAN UP ENTRY AREA   08250002
         OI    DCMIOCM3,DCMOPRMI   AND RESTORE KEYBOARD                 08300002
         SPACE 5                                                        08350002
*/*%START: D (YES,%CK,NO,%ERROR)              ANY PFK ALLOCATED? */     08400002
***********************************************************             08450002
         LTR   APFK,PFKPTR         ANY PFKS ALLOCATED                   08500002
         BZ    ERROR1               NO, GO TO INDICATE ERROR            08550002
         SPACE 5                                                        08600002
*/*%CK: D (E,ERSPFK,N,DEFPFK,D,DISPFK)       WHICH OPERAND USED? */     08650002
***********************************************************             08700002
*  AT ENTRY THE POINTER IN DCMADOPN POINTS TO THE FIRST CHARACTER       08750002
*  OF THE OPERAND IN THE ENTRY AREA.  THIS IS EQUIVALENT TO             08800002
*  THE FIRST POSITION IN THE INPUT AREA, WHERE THE SCAN                 08850002
*  WILL ACTUALLY TAKE PLACE.  IF A BAD OPERAND IS FOUND THE SCAN        08900002
*  POINTER WILL BE CONVERTED BACK TO INDICATE A POSITION IN THE         08950002
*  ENTRY AREA SO THAT THE CURSOR CAN BE CORRECTLY POSITIONED.           09000002
*  NOTE THAT THE INPUT AREA IS MODIFIED AS THE SCAN PROGRESSES          09050002
*  BY CONVERTING NUMBERS FROM EBCDIC TO BINARY AND REMOVING             09100002
*  PAIRED QUOTES.  AS A RESULT IT CANNOT BE USED TO WRITE ERROR         09150002
*  INFORMATION TO THE SCREEN.                                           09200002
         LA    OPER,DCMINPUT       POINT TO INPUT AREA                  09250002
         CLI   N0(OPER),EPFK       IS OPERAND E,PFK                     09300002
         BE    ERSPFK               YES, ERASE PFK LINE                 09350002
         CLI   N0(OPER),NPFK       IS OPERAND N,PFK=                    09400002
         BE    DEFPFK               YES, GO TO DEFINE PFK               09450002
*                                   NO, ASSUME OPERAND D,PFK            09500002
         SPACE 5                                                        09550002
*/*DISPFK: D (NO,ALTER,YES,%ERROR)           IS PFK LINE DISPLAYED? */  09600002
***********************************************************             09650002
DISPFK   EQU   *                                                        09700002
         L     LPFK,DCMPFKLN       GET START OF PFK LINE                09750002
         CLC   N0(N6,LPFK),BLANKS  IS LINE NOW BLANK                    09760002
         BNE   ERROR2              NO, INCONSISTANT REQUEST             09770002
         B     ALTER               EXIT TO I/O MODULE                   09900002
         SPACE 5                                                        09950002
*/*ERSPFK: D (YES,ALTER,NO,%ERROR)           IS PFK LINE DISPLAYED? */  10000002
***********************************************************             10050002
ERSPFK   EQU   *                                                        10100002
         L     LPFK,DCMPFKLN       POINT TO PFK LINE                    10150002
         CLC   N0(N6,LPFK),BLANKS  IS LINE NOW BLANK                    10160002
         BE    ERROR2              YES, INCONSISTANT REQUEST            10170002
         SPACE 5                                                        10300002
*/*ALTER: P (,IOEXIT)    INDICATE LINE TO BE ALTERED (DCMWRPFK) */      10350002
***********************************************************             10400002
ALTER    OI    DCMIOCM3,DCMWRPFK   INDICATE LINE MUST BE ALTERED        10450002
         SPACE 5                                                        10500002
*/*IOEXIT: R DEV. DEP. I/O ROUTINE */                                   10550002
***********************************************************             10600002
IOEXIT   EQU   *                                                        10650002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              10700002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     10710002
         OI    DCMIOCM2,DCMINSSH   RESTORE INSTRUCTION LINE             10750002
XCTL     EQU   *                                                        10800002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 10850002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             10900002
         EJECT                                                          11000002
*/*DEFPFK: D (YES,%DIG,NO,%ERROR)    LEADING KEYWORD OK? */             11050002
***********************************************************             11100002
DEFPFK   EQU   *                                                        11150002
         NI    DCMUTILT,ZEROS      CLEAR ALL UTILITY FLAGS              11200002
         LA    OPER,N1(OPER)       POINT TO COMMA                       11250002
         CLI   N0(OPER),COMMA      IS IT THERE                          11300002
         BNE   INVALOP              NO, INVALID                         11350002
         LA    OPER,N1(OPER)       POINT TO PFK= KEYWORD                11400002
         CLC   N0(N4,OPER),PFK     CHECK KEYWORD                        11450002
         BNE   INVALOP             NOT VALID. TELL OPERATOR             11500002
         LA    OPER,N4(OPER)       POINT TO NEXT SEGMENT                11550002
         CLI   Z(OPER),LPAREN      IS IT LEFT PARENTHESIS               11600002
         BNE   INVALOP              NO, GO TO FLAG ERROR                11650002
         SPACE 5                                                        11700002
*/*%DIG: S (,VALID) CKDIGIT:         CHECK MASTER KEY FOR VALIDITY */   11750002
***********************************************************             11800002
         LA    OPER,N1(OPER)       POINT TO KEY BEING DEFINED           11850002
         LR    STRTPT,OPER         SAVE POINTER FOR STORE               11900002
         OI    DCMUTILT,DCMUTILF   INDICATE MASTER KEY IN PROCESS       11950002
         BAL   RET,CKDIGIT         GO TO CHECK VALIDITY                 12000002
         NI    DCMUTILT,X'FF'-DCMUTILF  MASTER KEY PROCESSING OVER      12050002
         LR    MPFK,SCAN2          SAVE MASTER KEY AREA POINTER         12100002
         STC   APFK,Z(STRTPT)      STORE MASTER KEY (DIAG. ONLY)        12150002
         NI    N1(STRTPT),ZEROS    CLEAR FLAG BYTE                      12200002
         SPACE 5                                                        12250002
*/*VALID: D (CMD=,TEXT,KEY=,LIST,NONE,%ERROR) WHICH OPERAND USED? */    12300002
***********************************************************             12350002
VALID    CLC   Z(N4,OPER),CE       IS OPERAND CMD=                      12400002
         BE    TEXT                 YES, FORMAT TEXT                    12450002
         CLC   Z(N4,OPER),KE       IS OPERAND KEY=                      12500002
         BNE   INVALOP              NO, GO TO FLAG ERROR                12550002
         OI    DCMUTILT,DCMUTILA   REMEMBER KEY= OPERAND                12600002
         LA    COMPARE,N108(OPER)  POINT TO END OF LIST                 12650002
         ST    COMPARE,DCMDSAV+N12 SAVE FOR LATER COMPARE               12700002
         EJECT                                                          12750002
*/*LIST: D (NO,OK,YES,%ERROR) IS MASTER KEY PART OF ANOTHER LIST?       12800002
*/**/                                                                   12850002
***********************************************************             12900002
LIST     EQU   *                                                        12950002
         SR    COMPARE,COMPARE     CLEAR COMPARE REGISTER               13000002
         LR    LISTAPFK,PFKPTR     POINT TO PFK AREA                    13050002
CKEND    CLI   Z(LISTAPFK),STOPPER IS THIS END OF AREA                  13100002
         BE    OK                   YES, OK TO CONTINUE                 13150002
         TM    N1(LISTAPFK),DCMPFKDF+DCMPFKKY     IS IT DEFINED         13200002
*                                                 AS A LIST OF KEYS     13250002
         BNO   BUMP                 NO, GO TO NEXT KEY                  13300002
         IC    COMPARE,N0(LISTAPFK)     GET KEY NUMBER                  13350002
         CR    COMPARE,APFK        IS IT ONE WE ARE DEFINING            13400002
         BE    BUMP                 YES, GO TO NEXT KEY                 13450002
         LA    KEYLIST,N2(LISTAPFK) NO, POINT TO FIRST                  13500002
*                                      KEY IN LIST                      13550002
DEFTEST  IC    COMPARE,N0(KEYLIST) GET KEY FROM LIST                    13600002
         CR    COMPARE,APFK        IS IT ONE WE ARE DEFINING            13650002
         BE    INVAL                YES, CAN'T DEFINE THIS ONE AS LIST  13700002
         LA    KEYLIST,N2(KEYLIST) POINT TO NEXT KEY                    13750002
         CLI   N0(KEYLIST),KEYSTOP IS THIS END OF LIST                  13800002
         BNE   DEFTEST              NO, LOOK AT NEXT ONE                13850002
BUMP     LA    LISTAPFK,PFKLGN(LISTAPFK)   YES, POINT TO NEXT AREA      13900002
         B     CKEND               GO CHECK IT                          13950002
INVAL    LR    OPER,STRTPT         POINT BACK TO MASTER KEY             14000002
         B     INVALOP             ISSUE ERROR MESSAGE                  14050002
         SPACE 5                                                        14100002
*/*OK: P (,NEXT)      GET KEYS FROM LIST */                             14150002
*/*NEXT: S (,ENDEF)  CKDIGIT: KEY IN LIST MUST NOT BE A LIST OF KEYS */ 14200002
***********************************************************             14250002
OK       EQU   *                                                        14300002
         LA    OPER,N4(OPER)       POINT TO FIRST KEY IN LIST           14350002
         LR    OPSTART,OPER        SAVE POINTER TO START OF LIST        14400002
         LR    STORE,OPER          POINT TO START OF NEW DEFINITION     14450002
NEXT     BAL   RET,CKDIGIT         CHECK AND CONVERT A KEY              14500002
         STC   APFK,N0(STORE)      STORE KEY IN DEFINITION              14550002
         MVI   N1(STORE),SEMI      STORE SEPARATOR IN DEFINITION        14600002
         LA    STORE,N2(STORE)     POINT TO NEXT FIELD                  14650002
         TM    DCMUTILT,DCMUTILB+DCMUTILC    IS THIS END OF OPERAND     14700002
         BNZ   ENDEF                YES, CHECK FOR CON=                 14750002
         C     OPER,DCMDSAV+N12    IS THIS END OF WORK AREA             14800002
         BL    NEXT                 NO, GET NEXT KEY                    14850002
         B     INVALOP               YES, INVALID, TOO LONG             14900002
         EJECT                                                          14950002
*/*ENDEF: D (NO,MOVEIT,YES,PCON) IS CON= OPERAND EXPECTED? */           15000002
***********************************************************             15050002
ENDEF    EQU   *                                                        15100002
         MVI   N0(STORE),KEYSTOP   STOP LIST OF KEYS                    15150002
         LR    OPER,OPSTART        POINT TO START OF DEFINITION         15200002
         LA    ENDREG,N2(STORE)    POINT TO END OF OPERAND              15250002
         TM    DCMUTILT,DCMUTILC   IS CON= OPERAND EXPECTED             15300002
         BNO   MOVEIT               NO, GO TO MOVE DEFINITION           15350002
         SR    BADOP,BADOP          YES, CLEAR REMOVED QUOTE REG        15400002
         B     PCON                CHECK OUT CON= OPERAND               15450002
         SPACE 5                                                        15500002
*/*     E (,CKDIGIT)                    CKDIGIT SUBROUTINE */           15550002
*/*CKDIGIT: D (NO,%A,YES,COMCK) ARE WE LOOKING AT THE MASTER KEY? */    15600002
***********************************************************             15650002
CKDIGIT  EQU   *                                                        15700002
         LA    LIMIT,N3(LIMIT)     MAXIMUM TWO DIGITS                   15750002
         XC    DCMPACK(N8),DCMPACK CLEAR WORK AREA                      15800002
         MVC   DCMCVBIN(N2),Z(OPER)  MOVE IN NEXT TWO CHARACTERS        15850002
         LR    SCAN,OPER           POINT SCANNER TO OPERAND             15900002
         TM    DCMUTILT,DCMUTILF   IS THIS THE KEY BEING DEFINED        15950002
         BO    COMCK                YES, MUST BE A NUMBER               16000002
         SPACE 5                                                        16050002
*/*%A:  D (NO,%B,YES,CONVERS) IS THIS A RIGHT PAREN AND COMMA? */       16100002
***********************************************************             16150002
CKNUMB   EQU   *                                                        16200002
         CLI   N0(SCAN),RTPAREN    IS IT RIGHT PAREN                    16250002
         BNE   COMCK                NO, CONTINUE TESTING                16300002
         CLI   N1(SCAN),COMMA       YES, IS NEXT ONE A COMMA            16350002
         BE    CONVERS               YES, CONVERSATIONAL SPEC FOLLOWS   16400002
         SPACE 5                                                        16450002
*/*%B: D (NO,COMCK,YES,ENDOP) IS THIS A RIGHT PAREN ALONE? */           16500002
***********************************************************             16550002
         CLI   N1(SCAN),BLANK        NO, IS IT A BLANK                  16600002
         BE    ENDOP                  YES, END OF REDEFINE OPERANDS     16650002
         LA    SCAN,N1(SCAN)          NO, POINT TO BAD OPERAND          16700002
         B     BADSCAN2            TELL OPERATOR                        16750002
         SPACE 5                                                        16800002
*/*COMCK: D (YES,CONVERT,NO,%ERROR) IS THIS A VALID NUMBER? */          16850002
***********************************************************             16900002
COMCK    CLI   Z(SCAN),COMMA       IS THIS A COMMA                      16950002
         BE    CONVERT              YES, GO TO CONVERT DIGITS           17000002
         CLI   Z(SCAN),ZERO        IS DIGIT LESS THAN ZERO              17050002
         BL    BADSCAN2             YES, ERROR                          17100002
         CLI   Z(SCAN),NINE        IS DIGIT MORE THAN NINE              17150002
         BH    BADSCAN2             YES, ERROR                          17200002
         MVC   DCMPACK+N1(N5),DCMPACK+N2  SHIFT ONE CHARACTER           17250002
         LA    SCAN,N1(SCAN)       POINT TO NEXT DIGIT                  17300002
         BCT   LIMIT,CKNUMB        DIGIT OK, CHECK NEXT ONE             17350002
         B     BADSCAN2            OVER TWO DIGITS IS ERROR             17400002
* NOTE  CURSOR WILL POINT TO THIRD DIGIT.  TO POINT TO FIRST            17450002
*       DIGIT CHANGE BRANCH TO INVALOP.                                 17500002
         SPACE 5                                                        17550002
*/*CONVERS: P (,CONVERT)   INDICATE CON= OPERAND EXPECTED (DCMUTILC) */ 17600002
***********************************************************             17650002
CONVERS  EQU   *                                                        17700002
         OI    DCMUTILT,DCMUTILC   INDICATE CON= OPER EXPECTED          17750002
         B     CONVERT             GO TO EXIT                           17800002
         SPACE 5                                                        17850002
*/*ENDOP: P (,CONVERT)     INDICATE END OF OPERAND FOUND (DCMUTILB) */  17900002
***********************************************************             17950002
ENDOP    EQU   *                                                        18000002
         OI    DCMUTILT,DCMUTILB   INDICATE END OF OPERAND              18050002
         B     CONVERT             GO TO EXIT                           18100002
         SPACE 5                                                        18150002
*/*CONVERT: P (,ALLOC)     CONVERT KEY NUMBER TO BINARY */              18200002
***********************************************************             18250002
CONVERT  EQU   *                                                        18300002
         OI    DCMPACK+N3,PLUS     FORCE VALID SIGN                     18350002
         CR    OPER,SCAN           WERE THERE ANY DIGITS                18400002
         BE    INVALOP              NO, ERROR                           18450002
* NOTE  CURSOR WILL POINT TO WHERE FIRST DIGIT SHOULD HAVE BEEN         18500002
         SR    APFK,APFK            YES, CLEAR ANSWER REG               18550002
         PACK  DCMCVBIN(N4),DCMPACK(N4) CONVERT                         18600002
         XC    DCMPACK(N4),DCMPACK         EBCDIC                       18650002
         CVB   APFK,DCMPACK                   TO BINARY                 18700002
         SPACE 5                                                        18750002
*/*ALLOC: D (YES,GOOD,NO,%ERROR)      IS KEY ALLOCATED? */              18800002
***********************************************************             18850002
ALLOC    EQU   *                                                        18900002
         LR    SCAN2,PFKPTR        POINT TO FIRST PFK AREA              18950002
         SR    COMPARE,COMPARE     CLEAR REGISTER                       19000002
CHECK    EQU   *                                                        19050002
         CLI   Z(SCAN2),STOPPER    IS THIS END OF AREA                  19100002
         BE    INVALOP              YES, KEY NOT ALLOCATED              19150002
         IC    COMPARE,Z(SCAN2)    GET KEY NUMBER                       19200002
         CR    COMPARE,APFK        IS IT THE ONE WE WANT                19250002
         BE    GOOD                 YES                                 19300002
         LA    SCAN2,PFKLGN(SCAN2)  NO, INCREMENT TO NEXT AREA          19350002
         B     CHECK               CHECK NEXT ONE                       19400002
         SPACE 5                                                        19450002
*/*GOOD: D (NO,POINT,YES,%C)  ARE WE DEFINING A LIST? */                19500002
***********************************************************             19550002
GOOD     EQU   *                                                        19600002
*  NOTE  DCMUTILA WILL NEVER BE ON DURING PROCESSING OF THE             19650002
*           KEY BEING DEFINED.                                          19700002
         TM    DCMUTILT,DCMUTILA   ARE WE DEFINING A LIST               19750002
         BNO   POINT                NO, CONTINUE                        19800002
         SPACE 5                                                        19850002
*/*%C: D (NO,POINT,YES,%ERROR)  IS THIS KEY A LIST OF KEYS? */          19900002
***********************************************************             19950002
         TM    N1(SCAN2),DCMPFKKY   YES, IS THIS KEY A LIST             20000002
         BO    INVALOP               YES, INVALID                       20050002
         CR    SCAN2,MPFK            NO, IS THIS THE KEY BEING DEFINED  20100002
         BE    INVALOP                YES, INVALID                      20150002
* NOTE  CURSOR WILL POINT TO FIRST DIGIT OF KEY NUMBER                  20200002
*                                     NO, CONTINUE                      20250002
         SPACE 5                                                        20300002
*/*POINT: R                        RETURN TO CALLER */                  20350002
***********************************************************             20400002
POINT    LA    OPER,N1(SCAN)       POINT TO NEXT PART OF OPERAND        20450002
         BR    RET                 RETURN TO CALLER                     20500002
         EJECT                                                          20550002
*/*TEXT: P (,END)       SCAN TWO SINGLE QUOTES TO ONE */                20600002
***********************************************************             20650002
TEXT     EQU   *                                                        20700002
         LA    OPER,N4(OPER)       UPDATE OPERAND POINTER               20750002
         CLI   Z(OPER),QUOTE       IS THIS A QUOTE                      20800002
         BNE   INVALOP              NO, INVALID                         20850002
         LA    OPER,N1(OPER)       POINT TO START OF TEXT               20900002
         SR    BADOP,BADOP         CLEAR QUOTE COUNTER                  20950002
         SR    LIMIT,LIMIT         CLEAR LIMIT REGISTER                 21000002
         LA    LIMIT,TEXTLGN(LIMIT)   MAXIMUM NUMBER OF CHARACTERS      21050002
         LR    SCAN,OPER           INITIALIZE SCAN REGISTER             21100002
CKQUOTE  EQU   *                                                        21150002
         CLI   Z(SCAN),QUOTE       IS THIS A QUOTE                      21200002
         BE    QUOTECK              YES, CHECK FOR PAIR                 21250002
         TM    DCMUTILT,DCMUTILD   WAS THERE A PREVIOUS QUOTE           21300002
         BO    END                  YES, MUST BE END OF TEXT            21350002
CT       LA    SCAN,N1(SCAN)       POINT AT NEXT CHARACTER              21400002
         BCT   LIMIT,CKQUOTE       GO CHECK IT                          21450002
         B     BADSCAN             TOO MANY CHARACTERS                  21500002
* NOTE  CURSOR WILL POINT TO 127TH CHARACTER IN ENTRY AREA.             21550002
QUOTECK  EQU   *                                                        21600002
         TM    DCMUTILT,DCMUTILD   WAS LAST CHAR A QUOTE                21650002
         BO    ADJUST               YES, ADJUST LINE                    21700002
         OI    DCMUTILT,DCMUTILD    NO, INDICATE THIS ONE IS            21750002
         B     CT                  CONTINUE SCAN                        21800002
ADJUST   EQU   *                                                        21850002
         NI    DCMUTILT,X'FF'-DCMUTILD  TURN OFF QUOTE FLAG             21900002
         BCTR  SCAN,N0             POINT BACK TO FIRST QUOTE            21950002
         LA    LENGTH,DCMINPUT     POINT TO START OF INPUT AREA         22000002
         LA    LENGTH,N126(LENGTH) POINT TO END OF INPUT AREA           22050002
         SR    LENGTH,SCAN         CALC LENGTH OF TEXT TO MOVE          22100002
         EX    LENGTH,MVCENTRY     SHIFT LINE TO CLEAR                  22150002
*                                    DOUBLE QUOTE                       22200002
         LA    BADOP,N1(BADOP)     ADD TO COUNT OF QUOTES REMOVED       22250002
         B     CT                  CONTINUE SCAN                        22300002
         EJECT                                                          22350002
*/*END: D (YES,PCON,NO,MOVEIT)             CON= OPERAND? */             22400002
***********************************************************             22450002
END      EQU   *                                                        22500002
         LR    ENDREG,SCAN         SAVE PTR TO END OF TEXT              22550002
         CLI   Z(SCAN),RTPAREN     IS THIS RTPAREN                      22600002
         BNE   BADSCAN              NO, INVALID                         22650002
         CLI   N1(SCAN),COMMA      IS THIS A COMMA                      22700002
         BE    PCON                 YES, PCON EXPECTED                  22750002
         CLI   N1(SCAN),BLANK      IS THIS A BLANK                      22800002
         BE    MOVEIT               YES, GO TO MOVE TEXT                22850002
         LA    SCAN,N1(SCAN)        NO, POINT TO BAD CHAR               22900002
         B     BADSCAN             GO TO TELL OPERATOR INVALID          22950002
         EJECT                                                          23000002
*/*PCON: P (,MOVEIT)  CHECK OPERAND AND SET FLAG AS REQUIRED */         23050002
***********************************************************             23100002
PCON     EQU   *                                                        23150002
         LA    SCAN,N2(SCAN)       POINT TO OPERAND                     23200002
         CLC   N0(N4,SCAN),CONV    IS OPERAND CON=                      23250002
         BNE   BADSCAN              NO, INVALID                         23300002
         LA    SCAN,N4(SCAN)       POINT TO NEXT OPERAND                23350002
         CLI   N0(SCAN),Y          IS OPERAND YES (Y)                   23400002
         BE    YES                  YES, GO TO FLAG IT                  23450002
         CLI   N0(SCAN),N          IS OPERAND NO (N)                    23500002
         BE    MOVEIT               YES, IT IS NO. BYPASS FLAGGING      23550002
         B     BADSCAN             NONE OF ABOVE, ERROR                 23600002
YES      OI    N1(STRTPT),DCMPFKCN INDICATE CONVERSATIONAL MODE         23650002
         SPACE 4                                                        23700002
*/*MOVEIT: P (,MOVE)  MOVE DEFINITION TO PFK AREA */                    23750002
***********************************************************             23800002
MOVEIT   EQU   *                                                        23850002
         MVI   N2(MPFK),BLANK      CLEAR OUT OLD                        23900002
         MVC   N3(CLRLGN,MPFK),N2(MPFK)    PFK AREA                     23950002
         XR    LENGTH,LENGTH       CLEAR LENGTH REGISTER                24000002
         LR    LENGTH,ENDREG       COMPUTE LENGTH                       24050002
         SR    LENGTH,OPER            OF MOVE                           24100002
         BCTR  LENGTH,N0           REDUCE BY ONE BECAUSE WE             24150002
*                                    SCANNED TO DELIMITER               24200002
         LTR   LENGTH,LENGTH       WAS THERE ANY TEXT                   24250002
         BZ    UNDEF                NO, FLAG KEY AS UNDEFINED           24300002
         BCTR  LENGTH,N0           REDUCE BY ONE FOR EXECUTE            24350002
         EX    LENGTH,MVCKEY       MOVE DEFINITION TO PFK AREA          24400002
         TM    DCMUTILT,DCMUTILA   IS THIS A LIST OF KEYS               24450002
         BNO   MOVE                 NO, GO TO MOVE FLAGS                24500002
         OI    N1(STRTPT),DCMPFKKY INDICATE LIST OF KEYS                24550002
         SPACE 4                                                        24600002
*/*MOVE: P (,IOEXIT)     FLAG KEY AS DEFINED */                         24650002
***********************************************************             24700002
MOVE     EQU   *                                                        24750002
         OI    N1(STRTPT),DCMPFKDF INDICATE KEY NOW DEFINED             24800002
UNDEF    MVC   N1(N1,MPFK),N1(STRTPT)   MOVE FLAGS TO PFK AREA          24850002
         MVI   DCMCULNO,N1         RESTORE CURSOR TO                    24900002
         MVI   DCMPOSCU,N1            POSITION 1 LINE 1                 24950002
         OI    DCMCOM3,DCMPFKWR    INDICATE THAT PFK AREA MUST          25000002
*                                     BE RE-WRITTEN TO DISK             25050002
         B     IOEXIT              EXIT FROM MODULE           ME YM2527 25200002
        EJECT                                                           25250002
*/*%ERROR: P (,MESG)            SET UP ERROR MESSAGE */                 25300002
***********************************************************             25350002
ERROR2   EQU   *                                                        25400002
         OI    DCMCMSG2,DCMRQINC   INDICATE REQUEST INCONSISTANT        25450002
         B     MESG1               GO TO ISSUE MESSAGE                  25500002
BADSCAN  EQU   *                                                        25550002
         AR    SCAN,BADOP           NO, COMPENSATE FOR REMOVED QUOTES   25600002
BADSCAN2 LR    OPER,SCAN           POINT OPERAND TO BAD SCAN CHAR       25650002
INVALOP  EQU   *                                                        25700002
         LA    BADPT,DCMINPUT      POINT TO INPUT AREA                  25750002
         SR    OPER,BADPT          CALC DISPLACEMENT IN OPERAND         25800002
         L     BADPT,DCMADOPN      POINT TO OPERAND IN ENTRY AREA       25850002
         AR    BADPT,OPER          POINT TO BAD OPERAND IN ENTRY        25900002
         ST    BADPT,DCMDSAV       PASS POINTER TO MESG MODULE          25950002
         S     BADPT,DCMAENTR      CALC DISPLACEMENT IN ENTRY           26000002
         CH    BADPT,DCMLGNTH      IS OPERAND IN LINE TWO               26050002
         BH    LINE2                YES, COMPENSATE                     26100002
         MVI   DCMCULNO,N1          NO, SET LINE NUMBER TO ONE          26150002
STCURS   EQU   *                                                        26200002
         LA    BADPT,N1(BADPT)     ADD ONE TO POSITION                  26250002
         STC   BADPT,DCMPOSCU      STORE CURSOR POSITION                26300002
         NI    DCMIOCM2,X'FF'-DCMBLENT  DON'T BLANK ENTRY AREA          26350002
         OI    DCMIOCM1,DCMINSC    INDICATE INSERT CURSOR               26400002
         OI    DCMCMSG2,DCMINVOP   INVALID OPERAND MESSAGE BIT          26450002
         B     MESG1               GO TO WRITE MESSAGE                  26500002
LINE2    EQU   *                                                        26550002
         MVI   DCMCULNO,N2         SET LINE NUMBER TO TWO               26600002
         SH    BADPT,DCMLGNTH      CALC OFFSET WITHIN LINE              26650002
         B     STCURS              GO TO STORE VALUE                    26700002
ERROR1   EQU   *                                                        26750002
         OI    DCMCMSG4,DCMPFKNO   INDICATE NO PFK ALLOCATION           26800002
         SPACE 5                                                        26850002
*/*MESG: R IEECVETD */                                                  26900002
***********************************************************             26950002
MESG3    EQU   *                                                        27000002
         L     XFBRANCH,DCMNMSG3   LOAD MESSAGE 3 ADDRESS               27050002
         B     XCTL                EXIT TO IEECVFTD                     27060002
MESG1    EQU   *                                                        27100002
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               27150002
         B     XCTL                EXIT TO IEECVETD                     27200002
         EJECT                                                          27250002
**********************************************************************  27300002
*         EXECUTED INSTRUCTIONS                                         27350002
MVCENTRY MVC   Z(N0,SCAN),N1(SCAN) SHIFT CHAR IN WORK AREA              27400002
MVCKEY   MVC   N2(N0,MPFK),Z(OPER) MOVE DEF TO PFK AREA                 27450002
**********************************************************************  27500002
         SPACE 5                                                        27550002
*/*IEECVFTB: END */                                                     27600002
         EJECT                                                          27650002
*      CONSTANTS                                                        27700002
BLANKS   DC    6C' '               BLANKS                               27710002
CE       DC    C'CMD='             CMD= OPERAND                         27750002
CONV     DC    C'CON='             PCON= OPERAND                        27800002
KE       DC    C'KEY='             KEY= OPERAND                         27850002
PFK      DC    C'PFK='             PFK= KEYWORD                         27900002
         SPACE 5                                                        27950002
*      EQUATES                                                          28000002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            28010002
ID2      EQU   C'B'                2ND CHARACTER OF CSECT ID            28020002
*     PFK AREA EQUATES                                                  28030002
DCMPFKDF EQU   X'80'               KEY HAS BEEN DEFINED                 28032002
DCMPFKCN EQU   X'20'               KEY DEFINED AS CONVERSATIONAL MODE   28040002
DCMPFKKY EQU   X'08'               KEY IS A LIST OF KEYS                28044002
*     MISCELLANEOUS EQUATES                                             28046002
BLANK    EQU   C' '                BLANK CHARACTER                      28050002
COMMA    EQU   C','                CHARACTER                            28100002
EPFK     EQU   C'E'                ERASE PFK LINE OPERAND               28200002
KEYSTOP  EQU   X'61'               STOPS LIST OF KEYS                   28250002
LPAREN   EQU   C'('                LEFT PARENTHESIS                     28300002
N        EQU   C'N'                CHARACTER                            28350002
NINE     EQU   C'9'                CHARACTER                            28400002
NPFK     EQU   C'N'                DEFINE PFK OPERAND                   28450002
N0       EQU   0                   NUMBER                               28500002
N1       EQU   1                   NUMBER                               28550002
N2       EQU   2                   NUMBER                               28600002
N3       EQU   3                   NUMBER                               28650002
N4       EQU   4                   NUMBER                               28700002
N5       EQU   5                   NUMBER                               28750002
N6       EQU   6                   NUMBER                               28760002
N8       EQU   8                   LENGTH OF DCMPACK + DCMCVBIN         28800002
N12      EQU   12                  DISPLACEMENT IN DCMDSAVE FOR REG SAV 28850002
N16      EQU   16                  NUMBER                               28900002
N28      EQU   28                  NUMBER                               28950002
N108     EQU   108                 NUMBER OF CHARS IN TEXT              29000002
N126     EQU   126                 LENGTH OF ENTRY AREA                 29050002
PFKLGN   EQU   110                 LENGTH OF PFK AREA                   29100002
CLRLGN   EQU   PFKLGN-3            LENGTH OF TEXT MINUS ONE             29150002
PLUS     EQU   X'F0'               PLUS SIGN VALUE                      29200002
QUOTE    EQU   C''''               SINGLE QUOTE                         29250002
RTPAREN  EQU   C')'                RIGHT PAREN                          29300002
SEMI     EQU   C';'                SEMI-COLON                           29350002
STOPPER  EQU   X'64'               END OF PFK AREAS                     29400002
TEXTLGN  EQU   PFKLGN              LENGTH OF CMD= TEXT                  29450002
Y        EQU   C'Y'                CHARACTER                            29500002
Z        EQU   0                   ZERO                                 29550002
ZERO     EQU   C'0'                CHARACTER                            29600002
ZEROS    EQU   X'00'               HEX ZEROS                            29650002
         SPACE 5                                                        29700002
         TITLE 'IEECVFTB  IGC6B07B   PFK ROUTINE 2  RESIDENT DISPLAY CO*29750002
               NTROL MODULE'                                            29800002
         IEERDCM                                                        29850002
         TITLE 'IEECVFTB   IGC6B07B   PFK ROUTINE 2  TRANSIENT DISPLAY *29950002
               CONTROL MODULE'                                          30000002
         IEETDCM                                                        30050002
         TITLE 'IEECVFTB  IGC6B07B  PFK ROUTINE 2     CXSA'             30150002
         IHACTM  CXSA                                                   30250002
         END   START                                                    30300002
./  ADD  SSI=32960795,NAME=IEECVFTD
IEECVFTD CSECT                                                          00050002
         SPACE 2                                                        00100002
*    THIS ROUTINE WAS CREATED FOR PROGRAM FUNCTION KEY (PFK) SUPPORT, * 00150002
*    LINE ITEM 21003, OS RELEASE 21.                                  * 00200002
         TITLE 'IEECVFTD MESSAGE 3 - PFK SUPPORT MESSAGES'              00250002
*********************************************************************** 00300002
*                                                                       00350002
* STATUS                                                              * 00400002
*    CHANGE LEVEL 0                                                   * 00450002
* FUNCTION                                                            * 00500002
*    TO PLACE ERROR MESSAGES OR INFORMATIONAL MESSAGES INTO THE       * 00550002
*    INSTRUCTION.                                                     * 00600002
* ENTRY POINT                                                         * 00650002
*    IEECVFTD  (CSECT)                                                * 00700002
* INPUT                                                               * 00800002
*    BIT SETTINGS IN DCMCMSG4                                         * 00850002
*    TO INDICATE WHICH MESSAGE MUST BE MOVED INTO THE DCM             * 00900002
* OUTPUT                                                              * 00950002
*    INDICATIONS TO I/O ROUTINE OF WHAT TO WRITE                      * 01000002
* EXTERNAL REFERENCES                                                 * 01050002
*    NONE                                                             * 01100002
* EXITS,NORMAL                                                        * 01150002
*    IEECVETH OR P OR R DEVICE DEPENDENT I/O                          * 01200002
* EXITS,ERROR                                                         * 01250002
*    NONE                                                             * 01300002
* TABLES/WORK AREAS                                                   * 01350002
*    DISPLAY CONTROL MODULE (CONTAINED IN DSECT)                      * 01400002
* ATTRIBUTES                                                          * 01450002
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC                              * 01500002
* NOTES                                                               * 01550002
*    THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A PARTICULAR   * 01600002
*    INTERNAL PRESENTATION OF THE EXTERNAL CHARACTER SET.             * 01650002
*                                                                     * 01700002
*********************************************************************** 01750002
         EJECT                                                          01800002
*    REGISTER EQUATES                                                   01850002
*                                                                       01900002
X1PARM   EQU   1                                                        01910002
XERTRN   EQU   14                                                       01912002
XFBRANCH EQU   15                                                       01920002
MYBASE   EQU   12                  THIS MODULE'S BASE REG               01950002
CXSABASE EQU   11                  CXSA BASE REG                        02000002
PARM     EQU   1                   PARAMETER LIST POINTER               02050002
RETURN   EQU   14                  RETURN REG                           02100002
UCMEBASE EQU   13                  UCME BASE REG                        02150002
DCMBASE  EQU   10                  DCM BASE REG                         02200002
UCMBASE  EQU   9                   UCM BASE REG                         02250002
X2       EQU   2                   WORK REG                             02300002
X3       EQU   3                   WORK REG                             02350002
XWORK    EQU   4                   WORK REG                             02400002
XWORK1   EQU   5                   WORK REG                             02450002
X6       EQU   6                   WORK REG                             02500002
X7       EQU   7                   WORK REG                             02550002
X8       EQU   8                   WORK REG                             02600002
XE       EQU   14                                                       02650002
CODEREG  EQU   15                  RETURN CODE REG                      02700002
*                                                                       02750002
*********************************************************************** 02800002
*    EQUATES                                                            02850002
*                                                                       02900002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            02910002
ID2      EQU   C'D'                2ND CHARACTER OF CSECT ID            02920002
N0       EQU   0                   FIELD DISPLACEMENT                   02950002
N1       EQU   1                   FIELD DISPLACEMENT                   03000002
N2       EQU   2                   FIELD DISPLACEMENT                   03050002
N3       EQU   3                   FIELD DISPLACEMENT                   03100002
N4       EQU   4                   FIELD DISPLACEMENT                   03150002
N6       EQU   6                   FIELD DISPLACEMENT                   03250002
N15      EQU   15                  FIELD DISPLACEMENT                   03750002
N21      EQU   21                  FIELD DISPLACEMENT                   03800002
N25      EQU   25                  FIELD DISPLACEMENT                   03850002
N35      EQU   35                  FIELD DISPLACEMENT                   03900002
N37      EQU   37                  FIELD DISPLACEMENT                   03950002
N46      EQU   46                  FIELD DISPLACEMENT                   04000002
N59      EQU   59                  FIELD DISPLACEMENT                   04050002
N255     EQU   255                 USED TO TURN BITS OFF WITH           04100002
*                                                                       04150002
BLANK    EQU   C' '                BLANK CHAR.                          04200002
F0       EQU   X'F0'               BITS TO FIX SIGN OF CONVERTED NO.    04250002
*********************************************************************** 04300002
         EJECT                                                          04350002
*/*IEECVFTD: CHART */                                                   04400002
*/*IEECVFTD: E MESSAGE MOD 3 */                                         04450002
*/* P ESTABLISH ADDRESSABILITY */                                       04500002
*/* P DETERMINE TYPE OF MESSAGE TO BE DISPLAYED */                      04550002
*/* D (NO,,YES,IGNORE) LAST INTRPT IGNORED MSG ? */                     04600002
*/* D (NO,,YES,NOTSUP) PFK NN NOT SUPPORTED MSG ? */                    04650002
*/* D (NO,,YES,NOTDEF) PFK NN NOT DEFINED MSG ? */                      04700002
*/* D (NO,,YES,NOALLOC) PFK NOT ALLOC MSG ? */                          04750002
*/*IOEXIT: P INDICATE SOUND ALARM */                                    04800002
*/* P SET EXIT TO PROPER I/O ROUTINE */                                 04850002
*/*EXIT: R XCTL TO NEXT LOAD */                                         04900002
*/*IGNORE: S BLINST RTN: GO BLANK INSTRUCTION LINE */                   04950002
*/* P (,INSTWRIT) PUT ERROR MSG IN INSTRUCTION LINE */                  05000002
*/*NOTSUP: S BLINST RTN: GO BLANK INSTRUCTION LINE */                   05050002
*/* P (,CNVRTPFK) PUT ERROR MSG IN INSTRUCTION LINE */                  05100002
*/*NOTDEF: S BLINST RTN:GO BLANK INSTRUCTION LINE */                    05150002
*/* P (,CNVRTPFK) PUT ERROR MSG IN INSTRUCTION LINE */                  05200002
*/*NOALLOC: S BLINST RTN: GO BLANK INSTRUCTION LINE */                  05250002
*/* P PUT ERROR MSG IN INSTRUCTION LINE */                              05300002
*/*INSTWRIT: P INDICATE WRITE INSTRUCTION LINE */                       05350002
*/* D (NO,IOEXIT,YES,) DOES DEVICE HAVE LITE PEN ? */                   05400002
*/* P PUT 'ENTER - CANCEL MSG IN INSTR LINE */                          05450002
*/* P (,IOEXIT) INDICATE ERROR MSG IN INSTR LINE */                     05500002
*/*CNVRTPFK: P CONVERT PFK NUMBER FOR PRINT */                          05550002
*/* P (,INSTWRIT) PUT NUMBER INTO MSG */                                05600002
*/*BLINST: E BLINST RTN */                                              05650002
*/* P BLANK INSTRUCTION LINE IN DCM */                                  05700002
*/* R BR 14 */                                                          05750002
*/*IEECVFTD: END */                                                     05800002
         EJECT                                                          05850002
*    ESTABLISH ADDRESSABILITY                                           05900002
*                                                                       05950002
         BALR  MYBASE,N0           ESTABLISH PROGRAM ADDRESSABILITY     06000002
         USING *,MYBASE                                                 06050002
         B     BEGIN               BRANCH AROUND PATCH AREA             06060002
ICATCH   DC    CL72'IEECVFTD'      EYECATCHER AND FIELD MAINTENANCE     06070002
BEGIN    EQU   *                   END OF PATCH AREA                    06080002
*                                                                       06100002
         LR    CXSABASE,PARM       ESTABLISH CXSA BASE REG              06150002
         USING CXSA,CXSABASE                                            06200002
         L     UCMEBASE,CSAUCM     ESTABLISH UCM ENTRY BASE REG         06300002
         USING UCMLIST,UCMEBASE                                         06350002
         L     DCMBASE,UCMXB       LOAD RDCM PT                         06400002
         L     DCMBASE,N0(DCMBASE) LOAD TDCM PT                         06450002
         USING DCMSTRT,DCMBASE    ESTABLISH T DCM BASE REG              06500002
         L     UCMBASE,CSACTLM     LOAD UCM POINTER                     06550002
         USING UCM,UCMBASE         ESTABLISH UCM BASE REG               06600002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06610002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    06620002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      06630002
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          06640002
         LR    X1PARM,CXSABASE     PASS CXSA ADDRESS IN REG 1           06642002
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        06644002
*                                                                       06650002
         L     X2,DCMAINS          LOAD ADDR OF INSTRUCTION LINE        06700002
*                                                                       06750002
*    TEST FOR TYPE OF MESSAGE TO BE MOVED INTO INSTRUCTION LINE         06800002
*                                                                       06850002
         TM    DCMCMSG4,DCMPFKIP   LAST INTERRUPT IGNORED MSG           06900002
         BO    IGNORE              YES-                                 06950002
         TM    DCMCMSG4,DCMPFKNA   PFJ NN NOT SUPPORTED(WRONG KEY)      07000002
         BO    NOTSUP              YES-                                 07050002
         TM    DCMCMSG4,DCMPFKND   PFK NN NOT DEFINED MSG               07100002
         BO    NOTDEF              YES-                                 07150002
         TM    DCMCMSG4,DCMPFKNO   PFK NOT ALLOCATED MSG                07200002
         BO    NOALLOC             YES-                                 07250002
*    NONE OF ABOVE, GO TO I/O ROUTINE                                   07300002
*                                                                       07350002
IOEXIT   EQU   *                                                        07400002
         OI    DCMIOCM1,DCMSOUND   TURN ON SOUND ALARM BIT              07450002
         L     XFBRANCH,DCMIORTN       LOAD IO ROUTINE ADDRESS          07500002
         L     X1PARM,DCMCXSVE         RESTORE CXSA ADDRESS             07650002
         BR    XFBRANCH                EXIT TO IEECVET(H,P,R, OR U)     07700002
*                                                                       07900002
IGNORE   EQU   *                                                        07950002
         NI    DCMCMSG4,N255-DCMPFKIP TURN BIT OFF                      08000002
         BAL   XE,BLINST           BLANK INSTRUCTION LINE               08050002
         MVC   N0(N46,X2),IGNORMSG MOVE IN ERROR MESSAGE                08100002
         B     INSTWRIT            EXIT TO I/O RTN                      08150002
         EJECT                                                          08200002
NOTSUP   EQU   *                                                        08250002
         NI    DCMCMSG4,N255-DCMPFKNA TURN BIT OFF                      08300002
         BAL   XE,BLINST           BLANK INSTRUCTION LINE               08350002
         MVC   N0(N37,X2),SUPPORT  MOVE IN ERROR MESSAGE                08400002
         B     CNVRTPFK            GO CONVERT PFK NO.                   08450002
*                                                                       08500002
NOTDEF   EQU   *                                                        08550002
         NI    DCMCMSG4,N255-DCMPFKND TURN BIT OFF                      08600002
         BAL   XE,BLINST           BLANK INSTRUCTION LINE               08650002
         MVC   N0(N35,X2),DEFINE   MOVE IN ERROR MESSAGE                08700002
         B     CNVRTPFK            GO CONVERT PFK NO.                   08750002
*                                                                       08800002
NOALLOC  EQU   *                                                        08850002
         NI    DCMCMSG4,N255-DCMPFKNO TURN BIT OFF                      08900002
         BAL   XE,BLINST           BLANK INSTRUCTION LINE               08950002
         MVC   N0(N25,X2),NOALMSG  MOVE IN ERROR MESSAGE                09000002
*                                                                       09050002
INSTWRIT EQU   *                                                        09100002
         OI    DCMIOCM1,DCMWRINS   INDICATE WRITE INSTRUCTION LINE      09150002
         TM    DCMIOUNQ,DCMW2250   Q. IS DEVICE A LIGHT PEN DEVICE      09200002
         BNO   EXITWRIT            NO--EXIT                             09250002
         MVC   N59(N15,X2),ENCN    YES-MOVE ENTER-CANCEL MSG INTO LINE  09300002
         NI    DCMIOUNQ,N255-DCMINNOR TURN OFF NORMAL LINE BIT          09350002
         OI    DCMIOUNQ,DCMINERR   INDICATE ERROR MSG IN INST. LINE     09400002
EXITWRIT EQU   *                                                        09450002
         B     IOEXIT              EXIT TO I/O RTN                      09500002
*                                                                       09550002
CNVRTPFK EQU   *                                                        09600002
         SR    XWORK,XWORK         CLEAR REG                            09650002
         IC    XWORK,DCMPFKNM      LOAD PFK NO.                         09700002
         CVD   XWORK,DCMPACK       CONVERT PFK NO. TO DECIMAL           09750002
         UNPK  DCMPACK(N3),DCMPACK+N6(N2) UNPACK NO.                    09800002
         OI    DCMPACK+N2,F0       FIX SIGN                             09850002
         MVC   N21(N2,X2),DCMPACK+N1  MOVE EBCDIC CONVERTED PFK NO.     09900002
*                                                                       09950002
         B     INSTWRIT                                                 10000002
BLINST   EQU   *                                                        10050002
         LR    XWORK1,X2           LOAD ADDR OF INSTRUCTION LINE        10100002
         LH    XWORK,DCMLGNTH      GET LENGTH OF A LINE                 10150002
         BCTR  XWORK,N0            SUBTRACT 2                           10200002
         BCTR  XWORK,N0              FROM LENGTH OF MOVE                10250002
         MVI   N0(XWORK1),BLANK    BLANK 1ST CHAR                       10300002
         EX    XWORK,BLANKIT       PROPAGATE BLANKS                     10350002
         BR    XE                                                       10400002
*                                                                       10450002
         EJECT                                                          10500002
*                                                                       10550002
BLANKIT  MVC   N1(N0,XWORK1),N0(XWORK1) USED FOR BLANKING               10600002
*                                                                       10650002
*    CONSTANTS                                                          10700002
SUPPORT  DC    C'IEE721I SELECTED PFK NN NOT SUPPORTED' 37 CHARS        10750002
DEFINE   DC    C'IEE722I SELECTED PFK NN NOT DEFINED' 35 CHARS          10800002
IGNORMSG DC    C'IEE723I PFK IN PROCESS. LAST INTERRUPT IGNORED' 46 C   10850002
NOALMSG  DC    C'IEE720I NO PFK ALLOCATION' 25 CHARS                    10900002
ENCN     DC    C'*ENTER**CANCEL*' 15 CHARS                              10950002
         EJECT                                                          11000002
*    ALL DSECTS FOLLOW THIS POINT                                       11450002
*                                                                       11500002
*                                                                       11550002
         IEERDCM                                                        11560002
         EJECT                                                          11570002
         IEETDCM                                                        11600002
         EJECT                                                          11700002
         IEECUCM FORMAT=NEW                                             11750002
         EJECT                                                          11760002
         IHACTM  CXSA                                                   11850002
*                                                                       11900002
*********************************************************************** 11950002
         END                                                            12000002
./  ADD  SSI=33250190,NAME=IEECVFTG
         TITLE 'IEECVFTG           CLEANUP MODULE'                      00050002
IEECVFTG CSECT                                                          00100002
*C138500,139000                                               MH Y01274 00102002
*C138500,153500,155000                                       MC SA52539 00110002
*C140000,144500                                              MC SA52721 00120002
*D170500                                                     MC SA52721 00130002
*/*IEECVFTG: CHART */                                                   00150002
*/*%START: E (,BEGIN) IEECVFTG */                                       00200002
         SPACE 2                                                        00250002
* THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM 21002, 00300002
*    OS RELEASE 21                                                      00350002
         SPACE 2                                                        00400002
* STATUS -- CHANGE LEVEL 0                                              00450002
*                                                                       00500002
* FUNCTION -- CLEANUP ROUTINE WHEN DEVICE CHANGES STATUS                00550002
*    1) DEVICE IS BEING CLOSED - FREES ALL MESSAGES ON QUEUE            00600002
*    2) DEVICE IS CHANGING USE TO                                       00650002
*       A) MESSAGE STREAM - FREES OUT OF LINE MESSAGES                  00700002
*       B) STATUS DISPLAY - FREES INLINE AND OUT OF LINE MSGS           00750002
*       C) FULL CAPABILITY - FREES OUT OF LINE MESSAGES                 00800002
*    3) DEVICE IS RECOVERING FROM AN ASYNCHRONOUS ERROR - FREES         00850002
*       OUT OF LINE MESSAGES, LEAVING ANY MONITOR GOING, AND            00900002
*       LEAVING AREA DEFINITION ALONE                                   00950002
*    4) WHENEVER OUT OF LINE MSGS ARE FREED, EXCEPT ON                  01000002
*       ASYNCHRONOUS ERROR, ANY DYNAMIC DISPLAY IS STOPPED,             01050002
*       ANY GETMAINED SACB IS FREED, AND THE AREA DEFINITION IS         01100002
*       RESET TO SYSGEN VALUE                                           01150002
*                                                                       01200002
* ENTRY POINT -- IEECVFTG                                               01250002
*                                                                       01300002
* INPUT                                                                 01350002
*    1) REGISTER 1 - POINTER TO CXSA                                    01400002
*                                                                       01450002
* OUTPUT                                                                01500002
*    1) REGISTER 1 - POINTER TO CXSA                                    01550002
*                                                                       01600002
* EXTERNAL REFERENCES -- FREEMAIN, SVC 34                               01650002
*                                                                       01700002
* EXITS,NORMAL                                                          01750002
*    1) IEECVET1 - PROCESSOR 1, IF HANDLING CLOSE                       01800002
*    2) IEECVETC - ASYNCHRONOUS ERROR, IF HANDLING A CHANGE IN          01850002
*       STATUS OR AN ASYNCHRONOUS ERROR                                 01900002
*                                                                       01950002
* EXITS,ERROR                                                           02000002
*    IEECVET1 - PROCESSOR 1                                             02050002
*                                                                       02100002
* TABLES/WORK AREAS                                                     02150002
*    1) UNIT CONTROL MODULE (UCM)                                       02200002
*    2) TRANSIENT PORTION OF THE DISPLAY CONTROL MODULE (DCM)           02250002
*    3) RESIDENT PORTION OF THE DISPLAY CONTROL MODULE                  02300002
*       (INCLUDING SCREEN AREA CONTROL BLOCKS - SACB'S)                 02350002
*                                                                       02400002
* ATTRIBUTES -- REFRESHABLE, PRIVILEGED, TYPE 4 SVC                     02450002
*    DISABLED WHEN DECREMENTING USE COUNTS OF MINOR WQE'S               02500002
*                                                                       02550002
* CHARACTER CODE DEPENDENCY -- THE OPERATION OF THIS MODULE DOES        02600002
*    NOT DEPEND ON A PARTICULAR INTERNAL REPRESENTATION OF THE          02650002
*    EXTERNAL CHARACTER SET                                             02700002
         EJECT                                                          02750002
* REGISTER USAGE                                                        02800002
X1PARM   EQU   1                                                        02810002
XERTRN   EQU   14                                                       02812002
XFBRANCH EQU   15                                                       02820002
R0       EQU   0                   REG 0                                02850002
R1       EQU   1                   REG 1                                02900002
WORKR    EQU   1                   WORK REG                             02950002
WORK2    EQU   2                   WORK REG                             03000002
WORK3    EQU   3                   WORK REG                             03050002
WORK4    EQU   4                   WORK REG                             03100002
WORK1    EQU   5                   WORK REG                             03150002
RDCMBASE EQU   6                   RESIDENT PORTION OF DCM BASE         03200002
SACBBASE EQU   7                   SCREEN AREA CONTROL BLOCK BASE       03250002
X7ASCB   EQU   7                   ASCB ADDRESS FOR FREEMAIN  MB YM4086 03260002
TDCMBASE EQU   8                   TRANSIENT PORTION OF DCM BASE        03300002
OUTQREG  EQU   9                   POINTER TO CONSOLE OUTPUT           X03350002
                                        QUEUE ENTRY                     03400002
UCMEBASE EQU   10                  UCM ENTRY BASE                       03450002
WQEBASE  EQU   11                  WQE BASE                             03500002
MYBASE   EQU   12                  BASE REG FOR THIS MODULE             03550002
CXSABASE EQU   13                  CXSA BASE                            03600002
RETURNR  EQU   14                  RETURN REG                           03650002
LINKR    EQU   14                  FIRST LEVEL LINK REG                 03700002
LINK1    EQU   15                  SECOND LEVEL LINK REG                03750002
R15      EQU   15                  XCTL REG                             03800002
         EJECT                                                          03850002
*/*BEGIN: P ESTABLISH ADDRESSABILITY */                                 03900002
         SPACE                                                          03950002
         BALR  MYBASE,E0           BASE                                 04000002
         USING *,MYBASE                 THIS MODULE                     04050002
         B     BEGIN               BRANCH AROUND PATCH AREA             04100002
ICATCH   DC    C'IEECVFTG'         EYECATCHER AND FIELD MAINTENANCE     04150002
         DC    CL8'&SYSDATE',CL56' '                                    04160002
BEGIN    EQU   *                                                        04200002
         LR    CXSABASE,R1         GET CXSA ADDRESS                     04250002
         USING CXSA,CXSABASE       BASE CXSA                            04300002
         L     UCMEBASE,CSAUCM     GET ADDRESS OF UCM ENTRY             04350002
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY                       04400002
         L     RDCMBASE,UCMXB      GET ADDRESS OF RESIDENT DCB          04450002
         USING DCMTSRT,RDCMBASE      BASE RESIDENT DCM                  04500002
         L     TDCMBASE,DCMADTRN   GET ADDRESS OF TRANSIENT DCM         04550002
         USING DCMSTRT,TDCMBASE      BASE TRANSIENT DCM                 04600002
         USING DCMACB,SACBBASE     BASE SACB'S                          04650002
         USING WQE,WQEBASE         BASE WQE'S                           04700002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      04710002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    04720002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      04730002
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           04740002
         LR    X1PARM,CXSABASE     PASS CXSA ADDRESS IN REG 1           04742002
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         04744002
         SPACE 3                                                        04750002
* INITIALIZATION                                                        04800002
         SPACE                                                          04850002
         MVI   DCMUTILT,E0         ZERO OUT UTILITY BYTE                04950002
*    THE UTILITY BYTE IS USED AS FOLLOWS IN THIS MODULE:                05000002
*    DCMUTILA -- INDICATES FREE INLINE MESSAGES                         05050002
*    DCMUTILC -- INTERRUPTS HAVE BEEN DISABLED                          05100002
         EJECT                                                          05150002
* TEST TYPE OF CLEAN-UP REQUIRED                                        05200002
* 1) OUT OF LINE MESSAGES ARE ALWAYS FREED                              05250002
* 2) INLINE MESSAGES ARE FREED WHEN DEVICE IS CLOSING OR                05300002
*    CHANGING TO STATUS DISPLAY USE                                     05350002
         SPACE 2                                                        05400002
TESTTYPE EQU   *                                                        05450002
*/*TESTTYPE: D (YES,%INDFRIN,NO,TEST2) CLOSE IN PROGRESS */             05500002
         TM    DCMR3FLG,DCMCLPR    Q. CLOSE IN PROGRESS                 05550002
         BNO   TEST2               NO, GO TO NEXT TEST                  05600002
*/*%INDFRIN: P (,STOPMN) INDICATE FREE INLINE MESSAGES */               05650002
         OI    DCMUTILT,DCMUTILA   CLOSE - INDICATE FREE INLINE        X05700002
                                        MESSAGES                        05750002
         B     SACBSRCH            GO STOP ANY MONITOR                  05800002
         SPACE                                                          05850002
TEST2    EQU   *                                                        05900002
*/*TEST2: D (YES,%TSTSD,NO,TEST3) STATUS SWITCH */                      05950002
         TM    DCMCS,DCMCSO        Q. STATUS SWITCH                     06000002
         BNO   TEST3               NO, GO TO NEXT TEST                  06050002
*/*%TSTSD: D (YES,%INDFRIN,NO,STOPMN) TO STATUS DISPLAY */              06100002
         TM    UCMDISP,UCMDISPG    Q. TO STATUS DISPLAY                 06150002
         BNO   SACBSRCH            NO, GO STOP ANY MONITOR              06200002
         OI    DCMUTILT,DCMUTILA   TO SD - INDICATE FREE INLINE        X06250002
                                        MESSAGES                        06300002
         B     SACBSRCH            GO STOP ANY MONITOR                  06350002
         SPACE                                                          06400002
TEST3    EQU   *                                                        06450002
*/*TEST3: D (YES,SACBSRCH,NO,PROC1EXT) ASYNCHRONOUS ERROR */            06500002
         TM    DCMCOM2,DCMAE       Q. ASYNCHRONOUS ERROR                06550002
         BO    SACBSRCH            YES, GO SEARCH SACB'S                06600002
         SPACE                                                          06650002
         B     PROC1EXT            NO, THIS CONDITION SHOULD            06700002
*                                       NEVER OCCUR - MODULE WAS        06750002
*                                       ENTERED WITHOUT REASON.         06800002
*                                       GO TO PROCESSOR 1               06850002
         EJECT                                                          08350002
SACBSRCH EQU   *                                                        08400002
* THE SACB'S ARE SEARCHED AND HANDLED AS FOLLOWS:                       08450002
* 1) ANY WQE'S FOR OUT OF LINE DISPLAYS NOT COMPLETELY OUTPUT           08500002
*    ARE FREED                                                          08550002
* 2) ALL SACB'S ARE CLEANED UP                                          08600002
* 3) EXCEPT ON HANDLING AN ASYNCHRONOUS ERROR                           08650002
*    A) RESIDENT SACB'S ARE SET TO SYSGEN VALUES                        08700002
*    B) ANY GETMAINED SACB'S ARE FREED                                  08750002
* 4) ON AN ASYNCHRONOUS ERROR                                           08800002
*    A) SET UP FOR ANY MONITOR TO CONTINUE                              08850002
         SPACE                                                          08900002
*    WORK REGISTERS ARE USED AS FOLLOWS DURING THE SACB SEARCH          08950002
*        WORKR TEMPORARY USE ONLY                                       09000002
*        WORK1 SAVES SACB PTR WHEN WORKING WITH GETMAINED SACB'S        09050002
*        WORK2 PREVIOUS SACB POINTER                                    09100002
*        WORK3 LINE COUNTER TO FIND TOP LINE OF AREA                    09150002
*        WORK4 TEMPORARY USE ONLY                                       09200002
         SPACE 2                                                        09250002
*/*SACBSRCH: P (,SACBLOOP) INITIALIZE FOR SACB SEARCH */                09300002
         LH    WORK3,DCMMSGAL      GET NO. OF LINES IN MSG AREA         09350002
         LA    WORK3,E1(WORK3)     INCREASE NO. OF LINES BY ONE         09400002
         SR    WORK2,WORK2         CLEAR WORK2                          09450002
         SR    WORK1,WORK1         CLEAR WORK1                          09500002
         L     SACBBASE,DCMADSDS   GET POINTER TO FIRST SACB            09550002
SACBLOOP EQU   *                                                        09600002
*/*SACBLOOP: D (YES,%TSTDEF,NO,ENDSACBS) ANY MORE SACB'S */             09650002
         LTR   SACBBASE,SACBBASE   ANY MORE SACB'S                      09700002
         BZ    ENDSACBS            NO, BRANCH OUT OF SACB SEARCH        09750002
*/*%TSTDEF: D (YES,AREADEF,NO,%TSTAE1) AREA DEFINED HERE */             09800002
         TM    DCMASACB,DCMAUSE    Q. AREA DEFINED HERE                 09850002
         BO    AREADEF             YES, CLEAN UP SACB                   09900002
*/*%TSTAE1: D (YES,ENDSACBS,NO,TSTGM) HANDLING ASYNCHRONOUS ERROR */    09950002
         TM    DCMCOM2,DCMAE       Q. ASYNCHRONOUS ERROR                10000002
         BO    ENDSACBS            YES, GET OUT OF SACB SEARCH          10050002
         B     TSTGM               NO, GO REINITIALIZE AREA TO         X10100002
                                        SYSGEN DEFINITION               10150002
AREADEF  EQU   *                                                        10200002
*/*AREADEF: P (,AFTFREE1) FREE ANY WQE'S FOR ANY DISPLAY IN THE AREA */ 10250002
         L     WQEBASE,DCMATECB    STOP TRACK ECB             MB YM4086 10255002
         LTR   WQEBASE,WQEBASE     ANY ECB TO POST            MB YM4086 10265002
         BZ    NOPOST              NO, DONT POST              MB YM4086 10270002
         TM    E0(WQEBASE),X'40'   ALREADY POSTED             MB YM4086 10271002
         BZ    POST                NO, POST IT                MB YM4086 10272002
         XC    E1(E3,WQEBASE),E1(WQEBASE) ZERO COMPLETION CODE          10273002
         B     NOPOST              DONT POST                  MB YM4086 10274002
POST     SR    UCMEBASE,UCMEBASE   ZERO COMPLETION CODE       MB YM4086 10275002
         STM   MYBASE,CXSABASE,DCMDSAV SAVE REGS 12 AND 13    MB YM4086 10280002
         L     15,CVTPTR           BASE CVT                   MB YM4086 10285002
         USING CVTMAP,15                                                10290002
         L     15,CVT0PT01         POST ENTRY POINT           MB YM4086 10295002
         DROP  15                                                       10296002
         BALR  14,15               POST TRACK ECB             MB YM4086 10297002
         LM    MYBASE,CXSABASE,DCMDSAV RESTORE REGS           MB YM4086 10298002
         L     UCMEBASE,CSAUCM     RESTORE UCME BASE          MB YM4086 10299002
NOPOST   EQU   *                                                        10299202
         TM    DCMAFLG1,DCMADISP   Q. DISPLAY IN AREA                   10300002
         BNO   AFTFREE1            NO, BRANCH AROUND FREEING            10350002
         TM    DCMAFLG2,DCMAMJFR   Q. IS MAJOR FREED                    10400002
         BO    AFTFREE1            YES, BRANCH AROUND FREEING           10450002
         L     OUTQREG,DCMAMJWQ    GET OUTPUT QUEUE POINTER             10500002
         USING CQE,OUTQREG                                              10510002
         TM    DCMAFLG1,DCMADEND   Q. END OF DISPLAY ON SCREEN          10550002
         BNO   FINDNEXT            NO, GO FREE REMAINING MINORS         10600002
         LA    LINKR,AFTFREE1      YES, GO FREE MAJOR ONLY AND          10650002
         B     FREEMAJ                  RETURN TO AFTFREE1              10700002
         SPACE 2                                                        10750002
FINDNEXT EQU   *                                                        10800002
*    FIND NEXT MINOR TO BE OUTPUT                                       10850002
         TM    CQEFLAG,CQEATTOP    SHOULD MINOR SEARCH                 X10900002
                                        BEGIN AT TOP OF CHAIN           10950002
         BNO   GETSAVD1            NO, GO GET MINOR PTR SAVED           11000002
         LA    LINKR,AFTFREE1      YES, GO FREE MAJOR AND MINORS        11050002
         B     FREEMINT                 AND RETURN TO AFTFREE1          11100002
         SPACE                                                          11150002
GETSAVD1 EQU   *                                                        11200002
         L     WQEBASE,DCMAMIN     GET MINOR POINTER SAVED              11250002
         TM    DCMAFLG2,DCMALMIN   Q. LAST MINOR OUTPUT SAVED           11300002
         BNO   TSTZERO1            NO, GO CHECK POINTER                 11350002
         BAL   LINKR,GETNEXT       GET POINTER TO NEXT MINOR           X11400002
                                        TO BE OUTPUT                    11450002
         LA    LINKR,AFTFREE1      YES, GO FIND NEXT MINOR TO BE        11500002
         B     GETNEXT                  OUTPUT, FREE MAJOR AND         X11550002
                                        MINORS, AND RETURN TO          X11600002
                                        AFTFREE1                        11650002
TSTZERO1 EQU   *                                                        11700002
         LTR   WQEBASE,WQEBASE     Q. ANY POINTER SAVED                 11750002
         BNZ   USESAVD1            YES, GO START FROM POINTER          X11800002
                                        SAVED                           11850002
         LA    LINKR,AFTFREE1      NO, GO FREE MAJOR, AND MINORS        11900002
         B     FREMLWTO                 IF ANY,  AND RETURN TO         X11950002
                                        AFTFREE1                        12000002
         SPACE                                                          12050002
USESAVD1 EQU   *                                                        12100002
         BAL   LINKR,FREEMIN       GO FREE MAJOR, AND MINORS           X12150002
                                        STARTING FROM PTR SAVED         12200002
         EJECT                                                          12250002
AFTFREE1 EQU   *                                                        12300002
*/*AFTFREE1: D (YES,AECLEAN,NO,TSTGM) HANDLING ASYNCHRONOUS ERROR */    12350002
         TM    DCMCOM2,DCMAE       Q. ASYNCHRONOUS ERROR                12400002
         BO    AECLEAN             YES, CLEAN UP SACB, BUT LEAVE       X12450002
                                        AREA DEFINITION ALONE           12500002
TSTGM    EQU   *                                                        12550002
*/*TSTGM: D (YES,GMSACB,NO,RESSACB) GETMAINED SACB */                   12600002
         TM    DCMASACB,DCMAGM     Q. GETMAINED SACB                    12650002
         BO    GMSACB              YES, GO FREE SACB                    12700002
         SPACE 2                                                        12750002
RESSACB  EQU   *                   HANDLE RESIDENT SACB'S               12800002
* 1) IF MESSAGE STREAM CONSOLE, UNDEFINE ALL AREAS                      12850002
* 2) OTHERWISE, REINITIALIZE SACB'S TO SYSGEN VALUES                    12900002
*/*RESSACB: D (YES,UNDEFINE,NO,%INSACB) MESSAGE STREAM CONSOLE */       12950002
         TM    UCMDISP,UCMDISPF    Q. MESSAGE STREAM CONSOLE            13000002
         BO    UNDEFINE            YES, GO UNDEFINE AREA                13050002
*    REINITIALIZE SACB TO SYSGEN VALUES                                 13100002
*/*%INSACB: P (,%TSTTOP) REINITIALIZE SACB TO SYSGEN VALUES */          13150002
         LR    WORKR,SACBBASE      GET SACB ADDRESS                     13200002
         SH    WORKR,DCMACB-HALFWORD  SUBTRACT LENGTH OF PREFIX        X13250002
                                        TO GET PREFIX ADDRESS           13300002
         USING DCMPACB,WORKR       BASE PREFIX                          13350002
         LH    WORK4,DCMPLN        GET SYSGEN'D AREA LENGTH             13400002
         STH   WORK4,DCMALN             STORE IN SACB                   13450002
         DROP  WORKR                                                    13500002
         OI    DCMASACB,DCMAUSE    INDICATE AREA DEFINED                13550002
         SR    WORK3,WORK4         CALCULATE TOP LINE OF AREA           13600002
         LTR   WORK3,WORK3         Q. IS TOP LINE ON SCREEN             13650002
         BNP   SHRINK              NO, GO SHRINK AREA                   13700002
*/*%TSTTOP: D (YES,SHRINK,NO,NEXTSACB) TOTAL AREAS GREATER THAN MSG     13750002
*/*AREA SIZE  */                                                        13800002
         STC   WORK3,DCMATOP       STORE TOP LINE NO IN SACB  MH Y01274 13850002
STORTOP  MVC   DCMTOPAR(E1),DCMAID SAVE AREA ID TO EVENTUALLY MH Y01274 13900002
*                                       HAVE ID OF TOP AREA             13950002
SAVESACB LR    WORK2,SACBBASE      SAVE SACB ADDRESS         MC SA52721 14000002
         XC    DCMAROW(DCMACBND-DCMAROW),DCMAROW  ZERO OUT SACB         14050002
         B     NEXTSACB            GO GET NEXT SACB                     14100002
         SPACE                                                          14150002
UNDEFINE EQU   *                                                        14200002
*/*UNDEFINE: P (,NEXTSACB) INDICATE THIS SACB NOT IN USE */             14250002
         NI    DCMASACB,XFF-DCMAUSE  INDICATE THIS SACB NOT            X14300002
                                        IN USE                          14350002
         MVI   DCMTOPAR,E0         INDICATE NO AREAS DEFINED            14400002
         B     SAVESACB            GO SAVE SACB ADDR         MC SA52721 14450002
         SPACE 2                                                        14500002
SHRINK   EQU   *                                                        14550002
*/*SHRINK: P (,ENDSACBS) SHRINK TOP AREA */                             14600002
* THE NEED FOR SHRINKING WOULD ARISE ONLY IF A CONSOLE HAS BEEN         14650002
* SYSGEN'D WITH USE=SD AND AREAS DEFINED FOR THE ENTIRE SCREEN          14700002
* AND IS NOW BEING VARY'D TO FC.  SINCE A MS MESSAGE AREA IS            14750002
* NEVER MORE THAN 4 LINES LARGER THAN A FC MESSAGE AREA, THIS           14800002
* CORRECTION CAN ALWAYS BE MADE BY EITHER SHRINKING OR                  14850002
* UNDEFINING ONLY THE TOP AREA                                          14900002
         MVI   DCMATOP,E1          PUT TOP LINE AT TOP                 X14950002
                                        OF MESSAGE AREA                 15000002
         LA    WORKR,E1            CALCULATE AMOUNT OVER                15050002
         SR    WORKR,WORK3              MESSAGE AREA SIZE               15100002
*      WORK4 STILL CONTAINS THE SYSGENED LENGTH                         15150002
         SR    WORK4,WORKR         CALCULATE NEW LENGTH                 15200002
         STH   WORK4,DCMALN        STORE NEW LENGTH                     15250002
         CLI   DCMALN+E1,E4        Q. IS LENGTH OK                      15300002
         BNL   STORTOP             YES, GO TO SAVE TOP       MC SA52539 15350002
         NI    DCMASACB,XFF-DCMAUSE   UNDEFINE AREA SINCE              X15400002
                                        LENGTH IS LESS THAN MINIMUM     15450002
         B     STORTOP             GO TO SAVE TOP            MC SA52539 15500002
         SPACE 2                                                        15550002
GMSACB   EQU   *                                                        15600002
*/*GMSACB: S (,%NXTSACB) FREEMAIN:FREE THE SACB */                      15650002
         LTR   WORK1,WORK1         Q. FIRST GETMAINED SACB              15700002
         BNZ   FREESACB            NO, GO FREE SACB                     15750002
         LTR   WORK2,WORK2         Q. ANY RESIDENT SACB'S               15800002
         BZ    NOAREAS             NO, GO INITIALIZE FOR NO AREAS       15850002
         XC    DCMACBNX-DCMACB(E4,WORK2),DCMACBNX-DCMACB(WORK2)        X15900002
                                        ZERO OUT CHAIN FIELD OF        X15950002
                                        LAST RESIDENT SACB              16000002
         B     FREESACB            GO FREE SACB                         16050002
NOAREAS  EQU   *                                                        16100002
         ST    WORK2,DCMADSDS      ZERO OUT POINTER TO FIRST           X16150002
                                        SACB                            16200002
         MVI   DCMTOPAR,E0         ZERO OUT TOP AREA DEFINED ID         16250002
FREESACB EQU   *                                                        16300002
         L     WORK1,DCMACBNX      SAVE CHAIN FIELD                     16350002
         ST    WORK3,DCMDSAV       SAVE LINE COUNTER          MB YM4086 16360002
         LR    X1PARM,SACBBASE     AREA TO FREE               MB YM4086 16370002
         L     XFBRANCH,CSACTLM    BASE UCM BASE PORTION      MB YM4086 16372002
         USING UCM,XFBRANCH        DECLARE ADDRESSABILITY     MB YM4086 16374002
         LA    R0,DCMACBSZ         SACB SIZE                  MB YM4086 16380002
         L     X7ASCB,UCMASCB      ASCB FOR FREEMAIN          MB YM4086 16430002
         L     WORK4,UCMPXA        ADDRESS TCB                MB YM4086 16440002
         DROP  XFBRANCH                                       MB YM4086 16442002
         FREEMAIN RC,SP=SP241,LV=(0),A=(1),BRANCH=YES                   16444002
         L     WORK3,DCMDSAV       RESTORE LINE COUNTER       MB YM4086 16446002
*/*%NXTSACB: P (,SACBLOOP) GET POINTER TO NEXT SACB */                  16450002
         LR    SACBBASE,WORK1      BASE NEXT SACB                       16500002
         B     SACBLOOP            GO LOOK AT NEXT SACB                 16550002
         SPACE 2                                                        16600002
AECLEAN  EQU   *                                                        16650002
*/*AECLEAN: P (,NEXTSACB) CLEAN UP THE SACB, SAVING THE MSG TYPE FLAGS  16800002
*/*FOR ANY MONITOR */                                                   16850002
         XC    DCMAROW(DCMACBND-DCMAROW),DCMAROW  ZERO OUT SACB         16950002
         SPACE 2                                                        17100002
NEXTSACB EQU   *                                                        17150002
*/*NEXTSACB: P (,SACBLOOP) GET POINTER TO NEXT SACB */                  17200002
         L     SACBBASE,DCMACBNX   GET PTR TO NEXT SACB                 17250002
         B     SACBLOOP            GO LOOK AT NEXT SACB                 17300002
         EJECT                                                          17350002
ENDSACBS EQU   *                                                        17400002
*/*ENDSACBS: P (,%TOPDS) REINITIALIZE POINTER TO END OF VIEWABLE MSG    17450002
*/*AREA */                                                              17500002
         MVC   DCMWTBUF(E4),DCMWTINT  REINITIALIZE POINTER TO          X17550002
                                             END OF VIEWABLE MSG AREA   17600002
*/*%TOPDS: P (,QSRCH) INDICATE NO DISPLAYS ON SCREEN */                 17650002
         MVI   DCMTOPDS,E0         ZERO OUT ID OF TOP DISPLAY           17700002
         B     QSRCH               GO SEARCH CONSOLE Q                  17750002
         EJECT                                                          17800002
QSRCH    EQU   *                                                        17850002
         SPACE                                                          17900002
*    THE ENTIRE CONSOLE OUTPUT QUEUE IS SEARCHED.  ALL OUT OF           17950002
* LINE MLWTO'S IN PROGRESS HAVE ALREADY BEEN FREED BY THE               18000002
* SACBSRCH ROUTINE.  ANY OUT OF LINE MESSAGES STILL ON THE QUEUE        18050002
* ARE FREED.  IF INDICATED, INLINE MESSAGES ARE ALSO FREED.             18100002
         SPACE                                                          18150002
*/*QSRCH: D (YES,ENTRYFND,NO,ENDOFQ) ANYTHING ON QUEUE */               18200002
         L     OUTQREG,UCMOUTQ     GET CONSOLE OUTPUT Q POINTER         18250002
         LTR   OUTQREG,OUTQREG     Q. ANYTHING ON QUEUE                 18300002
         BZ    ENDOFQ              NO, GO HANDLE END OF Q               18350002
TESTLAST EQU   *                                                        18400002
         TM    CQEFLAG,CQEENTR     Q. ENTRY                             18450002
         BO    ENTRYFND            YES, GO LOOK AT ENTRY                18500002
         TM    CQEFLAG,CQEEOB      Q. END OF BLOCK                      18550002
         BO    EOB                 YES, GO GET NEXT BLOCK               18600002
NXTENTRY EQU   *                                                        18650002
*/*NXTENTRY: D (YES,ENTRYFND,NO,ENDOFQ) ANYTHING ELSE ON QUEUE */       18700002
         TM    CQEFLAG,CQEEOQ      Q. END OF QUEUE                      18750002
         BO    ENDOFQ              YES, GO HANDLE END OF Q              18800002
         LA    OUTQREG,E4(OUTQREG) LOOK AT NEXT ENTRY                   18850002
         B     TESTLAST            CHECK FOR LAST ENTRY                 18900002
         SPACE                                                          18950002
EOB      L     OUTQREG,CQEWQE      GET POINTER TO NEXT BLOCK            19050002
         B     TESTLAST            TEST NEXT CONSOLE Q ENTRY            19100002
         SPACE 2                                                        19150002
ENDOFQ   EQU   *                                                        19200002
*/*ENDOFQ: P TURN OFF OUT OF LINE OUTPUT PENDING FLAG */                19250002
         NI    UCMSDS5,XFF-UCMSDS5C  TURN OFF OUT OF LINE OUTPUT       X19300002
                                        PENDING FLAG                    19350002
*/*%TSTIN: D (YES,%OFFIN,NO,LEAVE1) WERE INLINE MESSAGES FREED */       19400002
         TM    DCMUTILT,DCMUTILA   Q. INLINE MESSAGES FREED             19450002
         BNO   LEAVE1              NO, LEAVE MODULE                     19500002
*/*%OFFIN: P (,LEAVE1) TURN OFF INLINE OUTPUT PENDING FLAG */           19550002
         NI    UCMSDS5,XFF-UCMSDS5B  TURN OFF INLINE OUTPUT            X19600002
                                        PENDING FLAG                    19650002
LEAVE1   EQU   *                                                        19700002
*/*LEAVE1: D (YES,LEAVE,NO,%OFFOP) IS ANY OUTPUT PENDING */             19750002
         TM    UCMSDS5,UCMSDS5B+UCMSDS5C  Q. IS EITHER OUTPUT          X19800002
                                        PENDING FLAG ON                 19850002
         BNZ   LEAVE               YES, EXIT                            19900002
*/*%OFFOP: P (,LEAVE) TURN OFF OUTPUT PENDING FLAG */                   19950002
         NI    UCMSTS,XFF-UCMPF    NO, TURN OFF OUTPUT PENDING          20000002
LEAVE   EQU   *                                                         20050002
*/*LEAVE: D (YES,PROC1EXT,NO,AEEXT) CLOSE IN PROGRESS */                20100002
         TM    DCMR3FLG,DCMCLPR    Q. CLOSE IN PROGRESS                 20150002
         BO    PROC1EXT            YES, GO TO PROCESSOR 1               20200002
         B     AEEXT               OTHERWISE EXIT TO ASYCHRONOUS       X20250002
                                        ERROR ROUTINE                   20300002
         EJECT                                                          20350002
ENTRYFND EQU   *                                                        20400002
*/*ENTRYFND: D (YES,,NO,REGWQE)   MLWTO */                              20450002
         TM    CQEWQE,CQEMAJOR     Q. MLWTO                             20500002
         BNO   REGWQE              NO, GO HANDLE REGULAR WQE            20550002
*/*%TST3: D (YES,,NO,INMLWTO) DESCRIPTOR CODES 8 AND 9 */               20750002
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR WQE             20800002
         TM    WMJMCS1,WMJMCS1A    Q. ROUTING OR DESCRIPTOR            X20850002
                                        CODES PRESENT                   20900002
         BNO   INMLWTO             NO, GO HANDLE INLINE MLWTO           20950002
         TM    WMJMDEC1,WMJMDECH   Q. DESCRIPTOR CODE 8                 21000002
         BNO   INMLWTO             NO, GO HANDLE INLINE MLWTO           21050002
         TM    WMJMDEC2,WMJMDECI   Q. DESCRIPTOR CODE 9                 21100002
         BNO   INMLWTO             NO, GO HANDLE INLINE MLWTO           21150002
*/*%TST4: D (YES,INMLWTO,NO,OUTMLWTO) TARGET AREA = Z */                21200002
         CLI   WMJMAREA,Z          Q. AREA ID=Z FOR MSG STREAM          21250002
         BE    INMLWTO             YES, GO HANDLE INLINE MLWTO          21300002
         SPACE 2                                                        21350002
OUTMLWTO EQU   *                                                        21400002
*/*OUTMLWTO: P (,NXTENTRY) FREE THE OUT OF LINE MLWTO */                21450002
         LA    LINKR,NXTENTRY      GO FREE MLWTO AND THEN LOOK          21500002
         B     FREMLWTO                 AT NEXT CONSOLE Q ENTRY         21550002
         SPACE 2                                                        21600002
REGWQE   EQU   *                                                        21650002
*/*REGWQE: D (YES,%FREEREG,NO,NXTENTRY) INLINE MSGS TO BE FREED */      21700002
         TM    DCMUTILT,DCMUTILA   Q. INLINE MSGS TO BE FREED           21750002
         BNO   NXTENTRY            NO, GO LOOK AT NEXT CONSOLE         X21800002
                                        QUEUE ENTRY                     21850002
*/*%FREEREG: P (,NXTENTRY) INDICATE WQE TO BE FREED */                  21900002
         OI    UCMSTS,UCMTB        INDICATE DEQ WORK TO DO              21950002
         OI    CQEFLAG,CQEAVAIL    TURN ON PURGE BIT                    22000002
         NI    CQEFLAG,XFF-CQEENTR TURN OFF ENTRY FLAG                  22050002
         B     NXTENTRY            GET NEXT CONSOLE Q ENTRY             22100002
         SPACE 2                                                        22150002
INMLWTO  EQU   *                                                        22200002
*/*INMLWTO: D (YES,%TSTWRKG,NO,NXTENTRY) INLINE MSGS TO BE FREED */     22250002
         TM    DCMUTILT,DCMUTILA   Q. INLINE MSGS TO BE FREED           22300002
         BNO   NXTENTRY            NO, GO LOOK AT NEXT CONSOLE         X22350002
                                        OUTPUT QUEUE ENTRY              22400002
*/*%TSTWRKG: D (YES,WORKIN,NO,%FREEINM) WORKING ON AN INLINE MLWTO */   22450002
         TM    UCMSTS,UCMTC        Q. WORKING ON AN INLINE MLWTO        22500002
         BO    WORKIN              YES, GO FREE WHAT IS NOT YET        X22550002
                                        OUTPUT                          22600002
*/*%FREEINM: P (,NXTENTRY) FREE INLINE MLWTO */                         22650002
         LA    LINKR,NXTENTRY      GO FREE MLWTO AND THEN LOOK          22700002
         B     FREMLWTO                 AT NEXT CONSOLE Q ENTRY         22750002
         SPACE 2                                                        22800002
WORKIN   EQU   *                                                        22850002
*/*WORKIN: P (,%FREEIN1) INDICATE NOT WORKING ON AN INLINE MLWTO */     22900002
         NI    UCMSTS,XFF-UCMTC    TURN OFF WORKING ON MLWTO BIT        22950002
         NI    UCMSDS5,XFF-UCMSDS5A TURN OFF WAITING ON MLWTO           23000002
*    FIND NEXT MINOR TO BE OUTPUT                                       23050002
*/*%FREEIN1: P (,NXTENTRY) FREE REMAINDER OF INLINE MLWTO */            23100002
         LA    LINKR,NXTENTRY      SET UP TO RETURN TO LOOK AT         X23150002
                                        NEXT CONSOLE Q ENTRY           X23200002
                                        AFTER FREEING MLWTO             23250002
         TM    CQEFLAG,CQEATTOP    Q. SHOULD MINOR SEARCH              X23300002
                                        BEGIN AT TOP OF CHAIN           23350002
         BO    FREEMINT            YES, GO FREE MINORS STARTING        X23400002
                                   FROM TOP OF CHAIN                    23450002
         SPACE                                                          23500002
GETSAVD2 EQU   *                                                        23550002
         L     WQEBASE,UCMMLAST    GET POINTER TO LAST MINOR           X23600002
                                        OUTPUT                          23650002
         LTR   WQEBASE,WQEBASE     Q. ANY MINORS OUTPUT YET             23700002
         BZ    FREMLWTO            NO, GO FREE MLWTO                    23750002
         B     GETNEXT             GO FIND NEXT MINOR TO BE            X23800002
                                        OUTPUT, FREE MAJOR AND         X23850002
                                        MINORS                          23900002
         EJECT                                                          23950002
* THE FOLLOWING ROUTINE FREES MLWTO'S.  THERE ARE MANY ENTRY            24000002
* POINTS, DEPENDING ON THE TYPE OF MLWTO TO BE FREED.  ALL              24050002
* EVENTUALLY END UP AT FREEMAJ TO FREE THE MAJOR WQE AFTER ALL          24100002
* MINORS, IF ANY, ARE FREED.  RETURN IS VIA REGISTER LINKR.             24150002
         SPACE 2                                                        24200002
GETNEXT  EQU   *                                                        24250002
*    CHECK TO SEE IF LAST MINOR OUTPUT IS STILL ON QUEUE                24300002
         LR    WORKR,WQEBASE       SAVE POINTER TO LAST MINOR          X24350002
                                        OUTPUT                          24400002
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR                 24450002
         L     WQEBASE,WMJMMIN     GET POINTER TO FIRST MINOR           24500002
LOOKNEXT EQU   *                                                        24550002
         LA    WQEBASE,E0(WQEBASE) CLEAR HIGH ORDER BYTE                24600002
         LTR   WQEBASE,WQEBASE     Q. END OF MINOR QUEUE                24650002
         BNZ   CHKEQ               NO, BRANCH TO SEE IF EQUAL TO       X24700002
                                        LAST MINOR OUTPUT               24750002
         B     FREEMINT            GO FREE MINORS FROM TOP OF          X24800002
                                        QUEUE SINCE LAST MINOR         X24850002
                                        OUTPUT IS NO LONGER ON Q        24900002
CHKEQ    EQU   *                                                        24950002
         CR    WORKR,WQEBASE       Q. MINOR POINTER EQUAL TO           X25000002
                                        LAST MINOR OUTPUT               25050002
         BE    LASTONQ             YES, LAST OUTPUT IS STILL ON        X25100002
                                        QUEUE - GO GET ITS CHAIN       X25150002
                                        FIELD                           25200002
         L     WQEBASE,WMNMNX1-E1  NO, GO LOOK AT                       25250002
         B     LOOKNEXT                 NEXT MINOR ON QUEUE             25300002
LASTONQ  EQU   *                                                        25350002
*    LAST MINOR IS STILL ON QUEUE -- CONTINUE FROM THERE                25400002
         L     WQEBASE,WMNMNX1-E1  GET CHAIN FIELD OF LAST MINOR       X25450002
                                        OUTPUT                          25500002
         LA    WQEBASE,E0(WQEBASE)  CLEAR HIGH ORDER BYTE               25550002
         B     FREEMIN             GO FREE MAJOR AND MINOR WQE'S        25600002
         SPACE 3                                                        25650002
FREMLWTO EQU   *                                                        25700002
*    FREE MLWTO MAJOR AND MINOR WQE'S                                   25750002
         L     WQEBASE,E0(OUTQREG) BASE MAJOR WQE                       25800002
         TM    WMJMMLW,WMJMMLWH    Q. NULL MINOR ON QUEUE               25850002
         BO    FREEMAJ                                                  25900002
         SPACE                                                          25950002
FREEMINT EQU   *                                                        26000002
*    FREE MINORS STARTING AT TOP OF CHAIN                               26050002
         L     WQEBASE,CQEWQE      BASE MAJOR WQE                       26100002
         L     WQEBASE,WMJMMIN     GET POINTER TO FIRST MINOR           26150002
         NI    CQEFLAG,XFF-CQEATTOP TURN OFF TOP OF CHAIN              X26200002
                                        FLAG                            26250002
         SPACE                                                          26300002
FREEMIN  EQU   *                                                        26350002
*    FREE MINORS STARTING WITH MINOR POINTED TO BY WQEBASE              26400002
         LTR   WQEBASE,WQEBASE     Q. ANY MINORS TO FREE                26450002
         BZ    FREEMAJ             NO, GO FREE MAJOR                    26500002
         SPACE                                                          26750002
FREEONE  EQU   *                                                        26800002
         SR    WORKR,WORKR         CLEAR REG                            26850002
         IC    WORKR,WMNMUC1       GET USE COUNT FROM MINOR             26900002
         BCTR  WORKR,E0            DECREMENT USE COUNT BY ONE           26950002
         STC   WORKR,WMNMUC1       STORE NEW USE COUNT                  27000002
         L     WQEBASE,WMNMNX1-E1  GET ADDRESS OF NEXT MINOR            27050002
         LA    WQEBASE,E0(WQEBASE) CLEAR HIGH ORDER BYTE                27100002
         LTR   WQEBASE,WQEBASE     Q. MORE MINORS ON QUEUE              27150002
         BNZ   FREEONE             YES, GO FREE ANOTHER MINOR           27200002
         SPACE 3                                                        27250002
FREEMAJ  EQU   *                                                        27300002
         OI    CQEFLAG,CQEAVAIL    INDICATE MAJOR NO LONGER            X27350002
                                        NEEDED BY THIS CONSOLE          27400002
         NI    CQEFLAG,XFF-CQEENTR TURN OFF ENTRY FLAG                  27450002
         OI    UCMSTS,UCMTB        INDICATE DEQ WORK NEEDED             27500002
         BR    LINKR                                                    27550002
         EJECT                                                          27600002
*                             EXITS                                     27650002
         SPACE 2                                                        27700002
PROC1EXT EQU   *                                                        27750002
*/*PROC1EXT: R IEECVET1 PROCESSOR 1 */                                  27800002
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  27850002
         B     XCTL                EXIT TO IEECVET1                     27900002
         SPACE 2                                                        27950002
AEEXT    EQU   *                                                        28000002
*/*AEEXT: R IEECVETC ASYNCHRONOUS ERROR */                              28050002
         L     XFBRANCH,DCMNERRO   LOAD ASYNCH ERROR ADDRESS            28100002
XCTL     EQU   *                                                        28350002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 28650002
         BR    XFBRANCH            EXIT  ADDRESS ALREADY SET            28700002
         EJECT                                                          29350002
*********************************************************************** 29600002
*                                                                     * 29850002
*                             EQUATES                                 * 29900002
*                                                                     * 29950002
*********************************************************************** 30000002
         SPACE 2                                                        30050002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            30060002
ID2      EQU   C'G'                2ND CHARACTER OF CSECT ID            30070002
E0       EQU   0                   NUMBER                               30100002
E1       EQU   1                   NUMBER                               30150002
E2       EQU   2                   NUMBER                               30200002
E3       EQU   3                   NUMBER                               30250002
E4       EQU   4                   NUMBER                               30300002
Z        EQU   C'Z'                MSG AREA ID                          31150002
XFF      EQU   X'FF'               TO TURN OFF BITS                     31250002
SP241    EQU   241                 GETMAINED SACB SUBPOOL               31300002
HALFWORD EQU   2                   BYTES IN HALFWORD                    31350002
         EJECT                                                          31360002
         CVT   DSECT=YES                                                31362002
         EJECT                                                          31364002
         IHACTM CQE                                                     31370002
         EJECT                                                          31380002
         IHACTM  CXSA                                                   31750002
         EJECT                                                          31800002
         IEECUCM FORMAT=NEW                                             31900002
         EJECT                                                          31950002
         IHAWQE  DSECT=YES                                              32050002
         EJECT                                                          32400002
         IEERDCM                                                        32450002
         EJECT                                                          32550002
         IEETDCM                                                        32600002
*/*IEECVFTG: END */                                                     32750002
         END                                                            32800002
./  ADD  SSI=80970104,NAME=IEECVFTL
         TITLE 'IEECVFTL IN-LINE MLWTO MODULE'                          00100000
IEECVFTL CSECT                                                          00200000
*EQUATES(C) APPROX 202000                                      @ZA30599 00250003
*********************************************************************** 00300000
*                                                                     * 00400000
*STATUS -- CHANGE LEVEL 1                                             * 00500000
*                                                                     * 00530000
*APARS FIXED = OZ14125, ZA30599                                       * 00560003
*                                                                     * 00600000
*FUNCTION -- HANDLE THE DISPLAY OF IN-LINE MULTIPLE LINE WRITE TO     * 00700000
*    OPERATOR (MLWTO) FOR DIDOCS. CONTROL IS PASSED FROM IEECVFT2,    * 00800000
*    THE DISPLAY 3 ROUTINE,WHEN AN IN-LINE MLWTO IS FOUND ON THE OUT- * 00900000
*    PUT QUEUE.                                                       * 01000000
*                                                                     * 01100000
*ENTRY POINTS -- IEECVFTL                                             * 01200000
*                                                                     * 01300000
*INPUT -- REGISTER ONE ADDRESS OF THE COMMUNICATION EXTENDED SAVE     * 01400000
*    AREA (CXSA)                                                      * 01500000
*          REGISTER TEN ADDRESS OF THE IN-LINE MLWTO TO BE DISPLAYED  * 01600000
*                                                                     * 01700000
*OUTPUT -- MESSAGE TEXT MOVED FROM THE WRITE QUEUE ELEMENT(WQE) TO THE* 01800000
*    DISPLAY CONTROL MODULE (DCM) FOR THE I/O ROUTINE TO WRITE OUT.   * 01900000
*    UPDATE OF SCT, SSCT, AND DOM TABLE WHEN REQUIRED                 * 02000000
*                                                                     * 02100000
*EXITS,NORMAL -- TO IEECVFT2, DISPLAY 3 ROUTINE                       * 02200000
*                TO IEECVET2, DISPLAY 1 ROUTINE                       * 02300000
*                TO DEPENDENT I/O ROUTINES                            * 02400000
*                TO IEECVET1, PROCESSOR 1 ROUTINE                     * 02500000
*                TO IEECVETD, MESSAGE 1 ROUTINE                       * 02600000
*                                                                     * 02700000
*EXITS,ERROR -- NONE                                                  * 02800000
*                                                                     * 02900000
*TABLES/WORK AREA -- UNIT CONTROL MODULE (UCM)                        * 03000000
*                    DISPLAY CONTROL MODULE (DCM)                     * 03100000
*                    WRITE QUEUE ELEMENT (WQE)                        * 03200000
*                    COMMUNICATION EXTENDED SAVE AREA (CXSA)          * 03300000
*                    SCREEN CONTROL TABLE (SCT)                       * 03400000
*                    SCREEN SECONDARY CONTROL TABLE (SSCT)            * 03500000
*                    DELETE OPERATOR MESSAGE TABLE (DOM)              * 03600000
*                                                                     * 03700000
*ATTRIBUTES -- TRANSIENT,PRIVILEGED,REFRESHABLE                       * 03800000
*                                                                     * 03900000
*NOTE -- THIS MODULE WAS CREATED FOR RELEASE 21 TO SUPPORT IN-LINE    * 04000000
*    MLWTO FOR DIDOCS.                                                * 04100000
*                                                                     * 04200000
*********************************************************************** 04300000
         EJECT                                                          04400000
         EJECT                                                          14500000
********                                                              * 14600000
******** REGISTER EQUATES                                             * 14700000
********                                                              * 14800000
X1PARM   EQU   1                                                        14900000
XERTRN   EQU   14                                                       15000000
XFBRANCH EQU   15                                                       15100000
R0       EQU   0                   WORK REG                             15200000
R1       EQU   1                   FIRST AND CURRENT DOM ENTRY          15300000
R2       EQU   2                   FIRST AND CURRENT SCT ENTRY          15400000
R3       EQU   3                   FIRST AND CURRENT SSCT ENTRY         15500000
R4       EQU   4                   LENGTH OF ONE SCT ENTRY FOR INCREMEN 15600000
R5       EQU   5                   LAST SCT ENTRY                       15700000
R6       EQU   6                   FIRST AND CURRENT SCREEN IMAGE BUFFE 15800000
R7       EQU   7                   BASE REGISTER FOR THE UCM ENTRY      15900000
R8       EQU   8                   BASE REGISTER FOR THE UCM BASE       16000000
R9       EQU   9                   BASE REGISTER FOR THE TRANSIENT DCM  16100000
R10      EQU   10                  ADDRESS OF MLWTO WQE FROM DISPLAY 1  16200000
R11      EQU   11                  BASE REGISTER FOR THE CXSA           16300000
R12      EQU   12                  BASE REGISTER FOR THIS ROUTINE       16400000
R13      EQU   13                  ADDRESS OF LAST WQE ENTRY            16500000
R14      EQU   14                  WORK REG                             16600000
RRDCM    EQU   14                  TEMP R DCM BASE REGISTER             16700000
R15      EQU   15                  WORK REG                             16800000
         EJECT                                                          16900000
********                                                              * 17000000
******** NUMBER EQUATES                                               * 17100000
********                                                              * 17200000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            17300000
ID2      EQU   C'L'                2ND CHARACTER OF CSECT ID            17400000
N0       EQU   0                   NUMBER CONSTANT                      17500000
N1       EQU   1                   NUMBER CONSTANT                      17600000
N2       EQU   2                   NUMBER CONSTANT                      17700000
N3       EQU   3                   NUMBER CONSTANT                      17800000
N4       EQU   4                   NUMBER CONSTANT                      17900000
N5       EQU   5                   NUMBER CONSTANT                      18000000
N6       EQU   6                   NUMBER CONSTANT                      18100000
N8       EQU   8                   NUMBER CONSTANT                      18200000
N12      EQU   12                  NUMBER CONSTANT                      18300000
N65      EQU   65                  NUMBER CONSTANT                      18400000
BLK      EQU   X'40'               EBCDIC BLANK                         18500000
ACTB     EQU   X'01'               ACTIVE FLAG FOR WQE Q                18600000
PURGE    EQU   X'02'               PURGE FLAG FOR WQE Q                 18700000
X08      EQU   X'08'               HARD COPY FLAG FOR WQE Q             18800000
X10      EQU   X'10'               REUSE WQE FLAG FOR WQE Q             18900000
X80      EQU   X'80'               END FLAG FOR WQE Q                   19000000
XC0      EQU   X'C0'               CONTINUE FLAG FOR WQE Q              19100000
TF       EQU   X'FF'               FLAG FOR TURNING OFF SWITCHES        19200000
DEFAULT  EQU   X'00'               DESCRIPTOR CODE ZERO                 19300000
DEFCODE  EQU   X'38'               DESCRIPTOR CODES 3,4,AND 5           19400000
DNCODE   EQU   X'80'               DESCRIPTOR CODE NINE                 19500000
ACTCODE  EQU   X'C0'               ACTION MESSAGES CODES                19600000
PPACT    EQU   C'@'                ACTION SYMBOL PROB PROG              19700000
INFOFLAG EQU   X'04'               INFORMATIONAL MSG FLAG               19800000
DISP7    EQU   X'02'               DISPOSITION FLAG ACTION MSG          19900000
NULL     EQU   X'00'               ZERO VALUE                           20000000
F0       EQU   C'0'                EBCDIC ZERO                          20100000
ISDASH   EQU   C'-'                EBCDIC DASH                          20200000
SLASH    EQU   C'|'                EBCDIC VERTICAL BAR         @ZA30599 20300003
ROLL     EQU   C'R'                CHARACTER R FOR ROLL MODE            20400000
         EJECT                                                          20500000
         BALR  R12,N0              LOAD BASE REG                        20600000
         USING *,R12               ESTABLISH ADDRESSIBILITY OF THE RTN  20700000
         B     BEGIN               BRANCH AROUND PATCH AREA             20800000
ICATCH   DC    CL8'IEECVFTL'       EYECATCHER AND FIELD MAINTENANCE     20900000
         DC    CL8'&SYSDATE',CL56' '                                    21000000
BEGIN    EQU   *                   END OF PATCH AREA                    21100000
         LR    R11,R1              ADDRESS OF CXSA                      21200000
         USING CXSA,R11            ADDRESSIBILITY OF CXSA               21300000
         LM    R7,R8,CSAUCM        ADDRESS OF UCM ENTRY AND THE UCM     21400000
         USING UCM,R8              ADDRESSIBILITY OF UCM                21500000
         USING UCMLIST,R7          ADDRESSIBILITY OF THE UCM ENTRY      21600000
         L     R9,UCMXB            ADDRESS OF RESIDENT DCM              21700000
         L     R9,N0(R9)           ADDRESS OF TRANSIENT DCM             21800000
         USING DCMSTRT,R9          ADDRESSIBILITY OF THE TRANSIENT DCM  21900000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      22000000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    22100000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      22200000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           22300000
         LR    X1PARM,R11          PASS CXSA ADDRESS IN REG 1           22400000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         22500000
         USING CQE,R13             ADDRESSIBILITY OF CQE                22600000
         USING WMJM,R10            ADDRESSIBILITY OF WQE                22700000
         L     R13,UCMWLAST        ADDRESS OF LAST CQE ON QUE           22800000
         L     R10,CQEWQE          ADDRESS OF MAJOR WQE                 22900000
         ST    R10,CSAXD           SAVE ADDRESS OF MAJOR WQE  ME        23000000
         SR    R0,R0               CLEAR REG                            23100000
***                                                                   * 23200000
***  GET ADDRESSES OF DELETE OPERATOR MESSAGES (DOM),SCREEN CONTROL   * 23300000
***  TABLE (SCT), AND THE SECONDARY SCREEN CONTROL TABLE (SSCT)       * 23400000
***                                                                   * 23500000
CHECKRM  EQU   *                                                        23600000
         LM    R1,R3,DCMDOMPK      ADDRESS OF THE FIRST DOM ENTRY, THE  23700000
*                                   FIRST SCT ENTRY, AND THE FIRST SSCT 23800000
         LM    R5,R6,DCMADDRL      ADDRESS OF THE LAST SCT ENTRY        23900000
*                                  ADDRESS OF SCREEN IMAGE BUFFER(SIB)  24000000
         TM    UCMSTS,UCMTC        WORKING ON A MLWTO                   24100000
         BO    MINTEST             BRANCH YES                           24200000
         ST    R0,UCMMLAST         SET LAST MINOR INDICATOR TO ZERO     24300000
         NI    UCMSDS5,TF-UCMSDS5F TURN OFF MLAST VALID       JE YM8408 24400000
PURGCON  EQU   *                                                        24500000
         TM    WMJMDSP,WMJMDSPA+WMJMDSPF IS PURGE OR DOM ON   ME YM4153 24600000
         BZ    ROOM                BRANCH NO TO CHECK ROOM    ME A46454 24700000
         TM    DCMOPTST,DCMOPTAD   IS AUTO DELETE REQUIRED              24800000
         BO    TURNOFF             BRANCH YES TO EXIT                   24900000
***                                                                   * 25000000
***  FIND FREE LINE TO START MLWTO                                    * 25100000
***                                                                   * 25200000
ROOM     EQU   *                                                        25300000
         LH    R4,DCMSCTCN         LENGTH OF SCT ENTRY                  25400000
         TM    N0(R2),DCMMSGIN     IS THERE A FREE LINE?                25500000
         BNO   NOTFULL             YES INSERT WQE FROM MLWTO            25600000
         AH    R6,DCMCORLN         GET NEXT LINE OF SIB          S21003 25700000
         LA    R3,N1(R3)           NEXT SSCT ENTRY                      25800000
         LA    R1,N8(R1)           NEXT DOM  ENTRY                      25900000
         BXLE  R2,R4,ROOM          INCREMENT TO NEXT SCT ENTRY          26000000
FULLDIS  EQU   *                                                        26100000
         OI    UCMSDS5,UCMSDS5F    SET BIT FOR VALID UCMMLAST           26200000
         ST    R10,UCMMLAST        SAVE ADDRESS OF NEXT WQE TO WRITE    26300000
         NI    DCMCMSG1,TF-DCMUNMSG TURN OFF UNVIEWABLE MESSAGE IF FULL 26400000
         OI    UCMDEVC,UCMDEVA     INDICATE FULL SCREEN IN UCM          26500000
         L     RRDCM,UCMXB         ADDRESS OF RESIDENT DCM              26600000
         USING DCMTSRT,RRDCM       ADDRESSIBILITY OF RESIDENT DCM       26700000
         OI    DCMR2FLG,DCMRXSFL   INDICATE FULL SCREEN IN RESIDENT DCM 26800000
         CLI   DCMDEL,ROLL         IS DEVICE IN ROLL MODE               26900000
         BE    DISPLAY1            BRANCH YES                 ME  M1544 27000000
         DROP  RRDCM               DROP R DCM ADDRESSABILITY            27100000
         OI    DCMCMSG1,DCMMSGWT   SET WRITE MESSAGE WAITING BIT        27200000
         OI    DCMIOCM1,DCMWRWRN   SET WRITE WARNING LINE               27300000
         B     DISPLAY1            BRANCH TO I/O ROUTINE EXIT ME  M1544 27400000
NOTFULL  EQU   *                                                        27500000
         TM    N0(R3),DCMSECDD     IS LINE RESERVED FOR DYNAMIC DISPLAY 27600000
         BO    FULLDIS             BRANCH YES TO RETURN TO DISPLAY      27700000
         OI    UCMSTS,UCMTC        TURN ON WORKING ON MLWTO INDICATOR   27800000
         SR    R14,R14             CLEAR REG                            27900000
         IC    R14,WMJMTXTL+N1     LENGTH OF MSG FROM WQE     MB Y01958 28000000
         LTR   R14,R14             IS LENGTH ZERO                       28100000
         BZ    ROOMDCM             BRANCH YES DO NOT MOVE               28200000
***                                                                   * 28300000
***  CLEAR A LINE IN THE DCM BY INSERTING BLANKS                      * 28400000
***                                                                   * 28500000
         MVI   N2(R6),BLK          MOVE A BLANK INTO SIB LINE ME        28600000
         LH    R4,DCMLGNTH         LENGTH OF ONE SIB LINE               28700000
         SH    R4,FOUR             DECREMENT LENGTH BY FOUR   ME        28800000
         EX    R4,BLKTXT           BLANK OUT SIB LINE                   28900000
         TM    N0(R2),DCMMSGJK     IS JUNK IN LINE            ME        29000000
         BNO   MOVEA               BRANCH NO                  ME        29100000
         NI    N0(R2),TF-DCMMSGJK  TURN OFF JUNK BIT IN SCT             29200000
         MVC   N0(N2,R6),N2(R6)    BLANK OUT FIRST TWO CHAR   ME        29300000
***                                                                   * 29400000
***  PREPARE TO MOVE TEXT OF MAJOR WQE INTO DCM                       * 29500000
***                                                                   * 29600000
MOVEA    EQU   *                                                        29700000
         DROP  R10                                                      29800000
         USING WMJM,R15            ADDRESSIBILITY OF MAJOR WQEME        29900000
         L     R15,CSAXD           ADDRESS OF MAJOR WQE       ME        30000000
         MVC   N0(N2,R1),WMJMASID  MEMORY ID TO DOM TABLE               30100000
         MVC   N2(N3,R1),WMJMJTCB+N1 MOVE TCB ADDRESS TO DOM TABLE      30200000
         MVC   N5(N3,R1),WMJMSEQ   MOVE SEQ NUMBER TO DOM TABLE         30300000
         DROP  R15                                            ME        30400000
         USING WMJM,R10            ADDRESSIBILITY OF WQE      ME        30500000
         TM    WMJMMLW,WMJMMLWB    IS THIS A MAJOR WQE        MB Y01958 30600000
         BNO   MOVEDOM             BRANCH NO                            30700000
         OI    WMJMBUF,WMJMBUFC    INDICATE RDY FOR HARDCOPY  MB YM7435 30800000
         LA    R15,WMJMTXT         BEGINNING OF TEXT FROM WQE ME        30900000
         TM    UCMDISP2,UCMDISPI   TIME STAMP REQ'D           JE YM6828 31000000
         BZ    TSTDISPJ            NO, TEST FOR JOBID         JE YM6828 31100000
         LA    R14,19(0,R14)       INCR FOR TIME              JE YM6828 31200000
         LA    R15,WMJMPAD         POINT TO TIME STAMP        JE YM6828 31300000
         B     MOVEA1              CONTINUE                   JE YM6828 31400000
TSTDISPJ TM    UCMDISP2,UCMDISPJ   JOBID REQ'D                JE YM6828 31500000
         BZ    MOVEA1              NO,CONTINUE                JE YM6828 31600000
         LA    R14,10(0,R14)       INCR FOR JOBID             JE YM6828 31700000
         LA    R15,WMJMPAD1        POINT TO JOBID             JE YM6828 31800000
MOVEA1   EQU   *                                                        31900000
         CH    R14,DCMAXLGN        IS LENGTH NOW OVER LINE LENGTH?      32000000
         BL    MOVEA2              BRANCH NO TO CONTINUE                32100000
         LH    R14,DCMAXLGN        TRUNCATE MESSAGE USING MAXIMUM LEN   32200000
MOVEA2   EQU   *                                                        32300000
         BCTR  R14,N0              DECREMENT LENGTH FOR EXECUTE         32400000
         TM    WMJMLTYP,WMJMLTYA   IS THIS MAJOR A CONTROL LINE         32500000
         BNO   SETSCT1             BRANCH NO                            32600000
         OI    N1(R2),DCMMSGCL     SET CONTROL LINE BIT IN SCT          32700000
         TM    WMJMDEC+N1,DNCODE   IS MLWTO DESCRIPTOR CODE NINE        32800000
         BNO   SETSCT1             BRANCH NO                            32900000
         MVC   N65(N2,R6),ASTCHAR  MOVE IN ASTERIST AND C FOR LIGHT PEN 33000000
SETSCT1  EQU   *                                                        33100000
         EX    R14,MSGTXT          MOVE MSG TEXT INTO DCM BUFFER        33200000
SETSCT   EQU   *                                                        33300000
         OI    N0(R2),DCMMSGIN     INDICATE LINE IN USE                 33400000
         TM    WMJMDSP,WMJMDSPA+WMJMDSPF IS PURGE OR DOM ON   ME YM4153 33500000
         BNZ   PURGFLG             BRANCH YES TO FLAG IT                33600000
         TM    WMJMCS1,WMJMCS1A    DO ROUTING OR DESCRIPTOR CODES EXITS 33700000
         BNO   INFOMSG             BRANCH NO TO DEFAULT CODE 6          33800000
         CLI   WMJMDEC,DEFAULT     IS THIS CODE ZERO?                   33900000
         BE    INFOMSG             BRANCH YES TO DEFAULT CODE 6         34000000
         TM    WMJMDEC,DISP7       IS THIS CODE 7 ?            @ZA14125 34020000
         BNO   ACTMSG              BRANCH NO TO ACTION MSG     @ZA14125 34040000
         OI    N1(R2),DCMMSGC7     FLAG SCT AS DESC CODE 7     @ZA14125 34060000
ACTMSG   TM    WMJMDEC,ACTCODE     IS THIS AN ACTION MSG?               34100000
         BNZ   FLGACT              BRANCH YES TO FLAG IT                34200000
         TM    WMJMDEC,DEFCODE     DESCRIPTOR CODE 3,4,OR 5 ?           34300000
         BNZ   NUMTST              BRANCH YES                           34400000
         TM    WMJMDEC,INFOFLAG    IS THIS AN INFORMATION MSG?          34500000
         BO    INFOMSG             BRANCH YES TO MARK IT                34600000
         TM    WMJMDEC,DISP7       IS THIS CODE 7?                      34700000
         BNO   NUMTST              BRANCH NO TO NUMBER CHECK            34800000
****************** DELETE ONE LINE OF CODE ******************* @ZA14125 34900000
         B     INFOMSG             BRANCH                               35000000
FLGACT   EQU   *                                                        35100000
         MVC   N3(N1,R6),WMJMTXT   COPY ACTION CODE           JE YM6828 35200000
         OI    N1(R2),DCMMSGAC     INDICATE ACTION MSG IN SCT           35300000
         OI    DCMIOCM1,DCMSOUND   INDICATE SOUND ALARM                 35400000
         CLI   WMJMTXT,PPACT       IS THIS A PROB PROG ACTION MSG       35500000
         BNE   NUMTST              NO CONTINUE NORMALLY                 35600000
         OI    N1(R2),DCMMSGPP     SET MSG IS PROB PGOG                 35700000
         B     NUMTST              BRANCH TO NUMBER TEST                35800000
INFOMSG  EQU   *                                                        35900000
         MVI   N2(R6),ISDASH       FLAG INFORMATION MSG                 36000000
         OI    N0(R2),DCMMSGIF     UPDATE SCT WITH INFO BIT             36100000
NUMTST   EQU   *                                                        36200000
         TM    DCMDSTAT,DCMDSTNM   ARE MESSAGES NUMBERED?               36300000
         BZ    GOON                BRANCH NO                            36400000
         LH    R15,DCMADNUM        GET CURRENT NUMBER                   36500000
         LA    R15,N1(R15)         INCREMENT COUNT                      36600000
         STH   R15,DCMADNUM        STORE NEW NUMBER                     36700000
         CVD   R15,DCMPACK         CONVERT TO DECIMAL                   36800000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2) UNPACK NUMBER            36900000
         OI    DCMCVBIN+N3,F0      MAKE IT PRINTABLE                    37000000
         CLI   DCMCVBIN+N2,F0      IS FIRST CHARACTER ZERO              37100000
         BNE   MOVEALL             BRANCH NO TO MOVE                    37200000
         MVI   DCMCVBIN+N2,BLK     REPLACE ZERO                         37300000
MOVEALL  EQU   *                                                        37400000
         MVC   N0(N2,R6),DCMCVBIN+N2 MOVE NUMBER ON SCREEN              37500000
GOON     EQU   *                                                        37600000
         TM    N0(R3),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL IS LINE A     37700000
*                                  STATUS DISPLAY                       37800000
         BNZ   UNVIEW              BRANCH YES                           37900000
         CLI   DCMLINEN,N0         IS THIS THE FIRST MESSAGE?           38000000
         BNZ   VISA                BRANCH NO-DO NOT UP WRITE COUNTER    38100000
         L     R0,DCMASCRN         GET ADDRESS SIB                      38200000
         SR    R14,R14             ZERO OUT EVEN REG                    38300000
         LR    R15,R6              GET CURRENT LINE POINTER             38400000
         SR    R15,R0              GET DISPLACEMENT                     38500000
         AH    R15,DCMCORLN        ADD ONE LINE                  S21003 38600000
         LH    R0,DCMCORLN         GET DIVISOR                   S21003 38700000
         DR    R14,R0              QUOTIENT IS LINE NUMBER              38800000
         STC   R15,DCMLINEN        SAVE LINE NUMBER                     38900000
VISA     EQU   *                                                        39000000
         OI    DCMIOCM1,DCMWRPAR   WRITE PARTIAL MSG AREA               39100000
         LH    R15,DCMBYTCT        GET CURRENT BYTE COUNT               39200000
         AH    R15,DCMCORLN        ADD LENGTH OF LINE            S21003 39300000
         STH   R15,DCMBYTCT        SAVE NEW LENGTH                      39400000
SDSON    EQU   *                                                        39500000
         NC    UCMMLAST(N4),UCMMLAST HAS A MINOR BEEN WRITTEN           39600000
         BZ    MAJWRITA            BRANCH NO FOR ADDRESS OF MINOR       39700000
         L     R10,UCMMLAST        ADDRESS OF LAST WRITTEN MINOR        39800000
         DROP  R10                                                      39900000
         USING WMNM,R10                                                 40000000
         NC    WMNMNX1(N3),WMNMNX1 IS THERE A NEXT MINOR TO WRITE       40100000
         BNZ   MINWRIT             BRANCH YES FOR NEXT MINOR            40200000
VISA1    EQU   *                                                        40300000
         TM    WMNMLT1,WMNMLT1D    IS END IN MINOR WQE?                 40400000
         BNO   IORET1              BRANCH NO                            40500000
***                                                                   * 40600000
***  PREPARE TO EXIT TO I/O ROUTINES IF LAST WQE ON OUTPUT QUE        * 40700000
***  OR RETURN TO DISPLAY THREE IF MORE WORK ON QUE                   * 40800000
***                                                                   * 40900000
TURNOFF  EQU   *                                                        41000000
         NI    UCMSTS,TF-UCMTC     TURN OFF WORKING ON MLWTO IND.       41100000
         OI    UCMSTS,UCMTB        SET DEQUE WQE BIT                    41200000
         OI    CQEFLAG,CQEAVAIL    SET PURGE BIT IN QUE AND   ME        41300000
         NI    CQEFLAG,TF-CQEENTR  TURN OFF ACTIVE FLAG                 41400000
         TM    CQEFLAG,CQEEOQ      IS THIS THE LAST QUE ENTRY           41500000
         BO    IORET               BRANCH YES                           41600000
         LA    R13,N4(R13)         NEXT QUE ELEMENT                     41700000
         TM    CQEFLAG,CQEEOB      IS THIS A CONTINUE QUE ENTRY         41800000
         BNO   SETUP               BRANCH NO                            41900000
         L     R13,CQEWQE          NEXT QUE ENTRY                       42000000
SETUP    EQU   *                                                        42100000
         OI    DCMCOM3,DCMXINT1    SET RETURN BIT FOR DISPLAY3          42200000
         ST    R13,UCMWLAST        UPDATE NEXT QUE ENTRY FOR DISPLAY3   42300000
         L     XFBRANCH,DCMNDSP3   LOAD DISPLAY 3 ADDRESS               42400000
         B     PEXIT               EXIT TO IEECVFT2                     42500000
***                                                                     42600000
***   THIS HANDLES MINOR WQE BY MOVING THEM INTO THE DCM                42700000
***                                                                     42800000
MINTEST  EQU   *                                                        42900000
         DROP  R10                                                      43000000
         USING WMJM,R10                                                 43100000
         STH   R0,DCMBYTCT         ZERO BYTE COUNT FOR I/O PARIAL WRITE 43200000
         MVI   DCMLINEN,NULL       ZERO LINE NUMBER FOR PARTIAL WRITE   43300000
         TM    CQEFLAG,CQEATTOP    IS START AT TOP ON                   43400000
         BO    MAJWRITA            BRANCH YES                           43500000
         NC    UCMMLAST(N4),UCMMLAST WAS THE LAST WRITE A MAJOR?        43600000
         BZ    MAJWRIT             BRANCH YES                           43700000
         TM    UCMSDS5,UCMSDS5F    UCMMLAST POINT TO NXT WQE TO OUTPUT  43800000
         BO    ROOMGO              BRANCH YES                           43900000
QSEARCH  EQU   *                                                        44000000
         CLC   UCMMLAST(N4),WMJMMIN IS MLAST VALID                      44100000
         BE    QFOUND              BRANCH YES                           44200000
         L     R10,WMJMMIN         ADDRESS OF QUED MINOR                44300000
         DROP  R10                                                      44400000
         USING WMNM,R10            MINOR ADDRESSIBILITY                 44500000
NEXTELM  EQU   *                                                        44600000
         CLC   UCMMLAST+N1(N3),WMNMNX1 IS MLAST VALID                   44700000
         BE    QFOUND              BRANCH YES                           44800000
         L     R10,WMNMNX1-N1      ADDRESS OF NEXT MINOR                44900000
         LA    R10,N0(R10)         ZERO USE COUNT                       45000000
         LTR   R10,R10             IS POINTER ZERO                      45100000
         BNZ   NEXTELM             BRANCH NO TO CONTINUE SEARCH         45200000
QNFOUND  EQU   *                                                        45300000
         L     R10,CSAXD           ADDRESS OF MAJORWQE                  45400000
         B     MAJWRIT1            BRANCH TO WRITE QUEUED MINOR         45500000
QFOUND   EQU   *                                                        45600000
         L     R10,UCMMLAST        SET BASE FOR MINOR                   45700000
         NC    WMNMNX1(N3),WMNMNX1 DOES NEXT MINOR EXIST?               45800000
         BNZ   MINWRIT             BRANCH YES                           45900000
RETR     EQU   *                                                        46000000
         NI    UCMSDS5,TF-UCMSDS5B TURN OFF IN-LINE BIT                 46100000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  46200000
         B     PEXIT               EXIT TO IEECVET1                     46300000
ROOMGO   EQU   *                                                        46400000
         NI    UCMSDS5,TF-UCMSDS5F TURN OFF MLAST VALID BIT             46500000
         L     R10,UCMMLAST        ADDRESS OF NEXT WQE TO PUT OUT       46600000
         B     ROOM                BRANCH TO FIND LINE                  46700000
DISPLAY1 EQU   *                                              ME  M1544 46800000
         OI    DCMCOM3,DCMCDSP3    IND WORK DONE FOR DISP RTN ME  M1544 46900000
         L     XFBRANCH,DCMNDSP1   LOAD DISPLAY 1 ADDRESS               47000000
         B     PEXIT               EXIT TO IEECVET2                     47100000
***                                                                   * 47200000
***  PREPARE TO MOVE TEXT OF MINOR WQE'S INTO DCM                     * 47300000
***                                                                   * 47400000
MOVEDOM  EQU   *                                                        47500000
         LA    R15,WMNMTXT1        BEGINNING OF TEXT FROM MINOR WQE     47600000
MOVED1   EQU   *                                                        47700000
         CH    R14,DCMAXLGN        IS LENGTH NOW OVER LINE LENGTH?      47800000
         BL    MOVED2              BRANCH NO TO CONTINUE                47900000
         LH    R14,DCMAXLGN        TRUNCATE MESSAGE USING MAXIMUM LEN   48000000
MOVED2   EQU   *                                                        48100000
         BCTR  R14,N0              DECREMENT LENGTH FOR EXECUTE         48200000
         EX    R14,MSGTXT          BRANCH BACK FOR TEXT MOVE            48300000
ROOMDCM  EQU   *                                                        48400000
         CLI   WMNMLT1,N0          IS THIS A NULL MINOR       JE YM9999 48500000
         BE    VISA1               BRANCH YES TO RETURN       MB YM0664 48600000
         SR    R15,R15             CLEAR WORK REG                       48700000
         ICM   R15,1,WMNMUC1       GET USE COUNT FROM WQE     JE YM8408 48800000
         BZ    RMDCM2              ALREADY ZERO, DON'T DECRMT JE YM8408 48900000
         BCTR  R15,N0              DECREMENT USE COUNT BY ONE           49000000
         STC   R15,WMNMUC1         RESTORE USE COUNT TO WQE             49100000
         LTR   R15,R15             IS USE COUNT NOW ZERO                49200000
         BNZ   SETMLAST            BRANCH NO                            49300000
RMDCM2   OI    UCMSTS,UCMTB        TELL DEQUE TO CHECK CHAIN  JE YM8408 49400000
         L     R15,CSAXD           RESTORE MAJOR WQE ADDRESS            49500000
         USING WMJM,R15                                                 49600000
         OI    WMJMMLW,WMJMMLWG    INDICATE A MINOR WQE CAN BE DECHAIN  49700000
         DROP  R15                                                      49800000
SETMLAST EQU   *                                                        49900000
         ST    R10,UCMMLAST        SAVE ADDRESS OF LAST WRITTEN WQE     50000000
         LTR   R14,R14             IS LENGTH EQUAL TO ZERO              50100000
         BZ    VISA1               BRANCH YES                           50200000
         L     R10,CSAXD           ADDRESS OF MAJOR WQE                 50300000
         B     SETSCT              RETURN TO SET UP SCT TABLE           50400000
MINWRIT  EQU   *                                                        50500000
         L     R10,WMNMUC1         ADDRESS OF NEXT MINOR WQE            50600000
         LA    R10,N0(R10)         ZERO USE COUNT                       50700000
         B     ROOM                RETURN TO FIND ROOM FOR MINOR WQE    50800000
IORET1   EQU   *                                                        50900000
         NI    UCMSDS5,TF-UCMSDS5B TURN OFF IN-LINE BIT                 51000000
IORET    EQU   *                                                        51100000
         TM    DCMCMSG1,DCMUNMSG   IS WRITE UNVIEWABLE MSG ON           51200000
         BO    MSGEXIT             BRANCH YES TO MSG EXIT               51300000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              51400000
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     51500000
PEXIT    EQU   *                                                        51600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 51700000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             51800000
MSGEXIT  EQU   *                                                        51900000
         L     XFBRANCH,DCMNMSG1   LOAD MESSAGE 1 ADDRESS               52000000
         B     PEXIT               EXIT TO IEECVETD                     52100000
PURGFLG  EQU   *                                                        52200000
         OI    N0(R2),DCMMSGAD     FLAG AS AUTO DELETEABLE              52300000
         L     RRDCM,UCMXB         ADDRESS OF RESIDENT DCM              52400000
         USING DCMTSRT,RRDCM       ADDRESSIBILITY OF RESIDENT DCM       52500000
         CLI   DCMRQDEL,BLK        IS A DELETE REQ PENDING?             52600000
         BNE   NUMTST              NO DO NOT UPDATE SCREEN              52700000
         DROP  RRDCM               DROP R DCM ADDRESSABILITY            52800000
         MVI   N2(R6),SLASH        FLAG ON SCREEN                       52900000
         B     NUMTST              BRANCH TO NUMBER TEST                53000000
UNVIEW   EQU   *                                                        53100000
         OI    DCMCMSG1,DCMUNMSG   TURN ON WRITE UNVIEWABLE MSG BIT     53200000
         B     SDSON               BRANCH TO CHECK MLWTO TYPE           53300000
MAJWRITA EQU   *                                                        53400000
         NI    CQEFLAG,TF-CQEATTOP TURN OFF START-AT-TOP                53500000
MAJWRIT  EQU   *                                                        53600000
         XC    UCMMLAST(N4),UCMMLAST ZERO LAST MINOR ADDRESS            53700000
         NI    UCMSDS5,TF-UCMSDS5F TURN OFF MLAST VALID       JE YM8408 53800000
         TM    WMJMLTYP,WMJMLTYD   IS END INDICATED IN MAJOR WQE        53900000
         BO    TURNOFF             BRANCH YES TO EXIT                   54000000
MAJWRIT1 EQU   *                                                        54100000
         TM    WMJMMLW,WMJMMLWH    IS MINOR POINTER VALID               54200000
         BO    IORET1              BRANCH NO                            54300000
         L     R10,WMJMMIN         ADDRESS OF MINOR FROM MAJOR          54400000
         B     ROOM                BRANCH YES FOR NEXT LINE             54500000
BLKTXT   MVC   N3(N0,R6),N2(R6)    MOVE TO BLANK OUT SIB LINE           54600000
MSGTXT   MVC   N3(N0,R6),N0(R15)   MOVE TEXT FROMWQE TO DCM             54700000
         EJECT                                                          54800000
***                                                                   * 54900000
***  CONSTANT USED BY THIS ROUTINE                                    * 55000000
***                                                                   * 55100000
FOUR     DC    H'4'                FOR SUBTRACTING                      55200000
ASTCHAR  DC    C'*C'               ASTERISK AND C FOR LIGHT PEN         55300000
         EJECT                                                          55400000
         IEERDCM                                                        55500000
         EJECT                                                          55600000
         IEETDCM                                                        55700000
         EJECT                                                          55800000
         IEECUCM  FORMAT=NEW                                            55900000
         EJECT                                                          56000000
         IHACTM  CXSA                                                   56100000
         EJECT                                                          56200000
         IHACTM CQE                                                     56300000
         EJECT                                                          56400000
         IHAWQE  DSECT=YES                                              56500000
         END                                                            56600000
./  ADD  SSI=70270972,NAME=IEECVFTM
         TITLE 'IEECVFTM -- STATUS DISPLAY INTERFACE 2'                 00100000
IEECVFTM CSECT                                                          00200000
*D 286100                                                     ME YM3335 00300000
         SPACE 2                                                        00600000
* THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM 21002, 00700000
*    OS RELEASE 21                                                      00800000
         SPACE 2                                                        00900000
*                                                                       01000000
* STATUS -- CHANGE LEVEL 0                                              01100000
*                                                                       01130000
* APARS FIXED --- ZA14992                                               01160000
*                                                                       01200000
* FUNCTION -- CONTROL MODULE FOR OUTPUT OF OUT OF LINE DISPLAYS         01300000
*    1) FINDS OUT OF LINE MULTIPLE LINE WRITE TO OPERATORS ON           01400000
*    CONSOLE OUTPUT QUEUE                                               01500000
*    2) INITIALIZES SCREEN AREA CONTROL BLOCKS (SACB'S)                 01600000
*    3) ROUTES CONTROL TO THE APPROPRIATE INTERFACE MODULE              01700000
*    TO SET UP FOR OUTPUT OF THE DISPLAY                                01800000
*                                                                       01900000
* ENTRY POINT -- IEECVFTM                                               02000000
*                                                                       02100000
* INPUT                                                                 02200000
*    1) REGISTER 1 - POINTER TO CXSA                                    02300000
*                                                                       02400000
* OUTPUT                                                                02500000
*    1) REGISTER 1 - POINTER TO CXSA                                    02600000
*    2) REGISTER 7 - POINTER TO SACB (ONLY ON EXIT TO                   02700000
*    INTERFACE 4 OR 6)                                                  02800000
*                                                                       02900000
* EXTERNAL REFERENCES -- TIME                                           03000000
*                                                                       03100000
* EXITS,NORMAL                                                          03200000
*    1) IEECVFTO - INTERFACE 4 TO OUTPUT 3 LINES OF A DISPLAY           03300000
*    WHICH OVERLAYS MESSAGES                                            03400000
*    2) IEECVFTQ - INTERFACE 6 TO OUTPUT AS MUCH OF THE DISPLAY         03500000
*    AS POSSIBLE WHEN THE DISPLAY WILL NOT OVERLAY MESSAGES             03600000
*    3) IEECVET1 - PROCESSOR 1 WHEN THERE ARE NO MORE OUT OF            03700000
*    LINE MESSAGES TO BE OUTPUT                                         03800000
*    4) IEECVFTP - INTERFACE 5 WHEN BLANKING OF MESSAGES BELOW          03900000
*    A DISPLAY IS REQUIRED                                              04000000
*                                                                       04100000
* EXITS,ERROR -- NONE                                                   04200000
*                                                                       04300000
* TABLES/WORK AREAS                                                     04400000
*    1) UNIT CONTROL MODULE (UCM)                                       04500000
*    2) TRANSIENT PORTION OF THE DISPLAY CONTROL MODULE (DCM)           04600000
*    3) RESIDENT PORTION OF THE DISPLAY CONTROL MODULE                  04700000
*    (INCLUDING SCREEN AREA CONTROL BLOCKS - SACB'S)                    04800000
*                                                                       04900000
* ATTRIBUTES -- REFRESHABLE, PRIVILEGED, TYPE 4 SVC                     05000000
*    DISABLED WHEN DECREMENTING USE COUNTS OF MINOR WQE'S               05100000
*                                                                       05200000
* CHARACTER CODE DEPENDENCY -- THE OPERATION OF THIS MODULE DOES        05300000
*    NOT DEPEND ON A PARTICULAR INTERNAL REPRESENTATION OF THE          05400000
*    EXTERNAL CHARACTER SET                                             05500000
*                                                                       05600000
         EJECT                                                          05700000
* REGISTER USAGE                                                        05800000
X1PARM   EQU   1                                                        05900000
XERTRN   EQU   14                                                       06000000
XFBRANCH EQU   15                                                       06100000
R0       EQU   0                   REG 0                                06200000
R1       EQU   1                   PARAMETER REGISTER                   06300000
WORKR    EQU   2                   WORK REG                             06400000
WORK1    EQU   3                   WORK REG                             06500000
EVEN     EQU   4                   WORK REG                             06600000
ODD      EQU   5                   WORK REG                             06700000
RDCMBASE EQU   6                   RESIDENT PORTION OF DCM BASE         06800000
SACBBASE EQU   7                   SCREEN AREA CONTROL BLOCK BASE       06900000
TDCMBASE EQU   8                   TRANSIENT PORTION OF DCM BASE        07000000
OUTQREG  EQU   9                   POINTER TO CONSOLE OUTPUT           X07100000
                                        QUEUE ENTRY                     07200000
UCMEBASE EQU   10                  UCM ENTRY BASE                       07300000
WQEBASE  EQU   11                  WQE BASE                             07400000
MYBASE   EQU   12                  BASE REGISTER FOR THIS MODULE        07500000
CXSABASE EQU   13                  CXSA BASE                            07600000
RETURNR  EQU   14                  RETURN REGISTER                      07700000
LINKR    EQU   14                  FIRST LEVEL LINK REG                 07800000
LINK1    EQU   15                  SECOND LEVEL LINK REGISTER           07900000
R15      EQU   15                                                       08000000
         EJECT                                                          08100000
* ESTABLISH ADDRESSABILITY                                              08200000
         SPACE 2                                                        08400000
         BALR  MYBASE,0                                                 08500000
         USING *,MYBASE            BASE THIS MODULE                     08600000
         B     BEGIN                                                    08700000
         DC    CL8'IEECVFTM'         MODULE NAME                        08800000
         DC    CL8'&SYSDATE',CL56' '    DATE AND PATCH AREA             08900000
BEGIN    EQU   *                                                        09000000
         LR    CXSABASE,R1         GET CXSA ADDRESS                     09100000
         USING CXSA,CXSABASE       BASE CXSA                            09200000
         L     UCMEBASE,CSAUCM     GET ADDRESS OF UCM ENTRY             09300000
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY                       09400000
         L     RDCMBASE,UCMXB      GET ADDRESS OF RESIDENT DCM          09500000
         USING DCMTSRT,RDCMBASE      BASE RESIDENT DCM                  09600000
         L     TDCMBASE,E0(RDCMBASE) GET ADDRESS OF TRANSIENT DCM       09700000
         USING DCMSTRT,TDCMBASE      BASE TRANSIENT DCM                 09800000
         USING DCMACB,SACBBASE     BASE SACB                            09900000
         USING WMJM,WQEBASE        BASE WQE'S                           10000000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      10100000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    10200000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      10300000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           10400000
         LR    X1PARM,CXSABASE     PASS CXSA ADDRESS IN REG 1           10500000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         10600000
         SPACE 3                                                        10700000
* INITIALIZATION                                                        10800000
         SPACE 2                                                        10900000
         EJECT                                                          11000000
*     THE CONSOLE OUTPUT QUEUE IS SEARCHED FOR ANY WQE'S WHICH          11100000
* MAY BE WRITTEN OUT OF LINE.  IN ORDER TO BE PUT OUT OF LINE A         11200000
* WQE MUST:                                                             11300000
*     1) BE AN MLWTO                                                    11400000
*     2) HAVE BOTH DESCRIPTOR CODES 8 AND 9                             11500000
*     3) CONTAIN A VALID OUT OF LINE DISPLAY AREA ID                    11600000
*     4) NOT BE FOR HARDCPY                                             11700000
*     5) BE EXPECTED (DISPLAY COMING FLAG SET IN SACB)                  11800000
* ANY WQE'S WHICH ARE TO BE PUT IN AN AREA WITH A FRAME FULL            11900000
* CONDITION ARE IGNORED.                                                12000000
         SPACE 2                                                        12100000
CONSOUTQ EQU   *                                                        12200000
         L     OUTQREG,UCMOUTQ     GET CONSOLE OUTPUT Q POINTER         12400000
         USING CQE,OUTQREG         CQE ADDRESSABILITY         MB Y02958 12500000
         LTR   OUTQREG,OUTQREG     Q. ANY ON QUEUE                      12600000
         BZ    ENDOFQ              NO, BRANCH TO HANDLE END OF Q        12700000
TESTLAST EQU   *                                                        12800000
         TM    CQEFLAG,CQEENTR     ENTRY EXIST HERE                     12900000
         BO    ENTRYFND            YES, BRANCH TO LOOK AT ENTRY         13000000
         TM    CQEFLAG,CQEEOB      END OF CQE BLOCK                     13100000
         BO    EOB                 YES, BRANCH TO GET NEXT BLOCK        13200000
NXTENTRY EQU   *                                                        13300000
         TM    CQEFLAG,CQEEOQ      END OF CQES                MB Y02958 13500000
         BO    ENDOFQ              YES, BRANCH TO HANDLE Q END          13600000
         LA    OUTQREG,E4(OUTQREG) LOOK AT NEXT ENTRY                   13700000
         B     TESTLAST            CHECK FOR LAST ENTRY                 13800000
         SPACE                                                          13900000
EOB      EQU   *                                                        14000000
         L     OUTQREG,CQEWQE      GET POINTER TO NEXT BLOCK            14100000
         B     TESTLAST            TEST NEXT CONSOLE Q ENTRY            14200000
         SPACE 2                                                        14300000
ENDOFQ   EQU   *                                                        14400000
         NI    UCMSDS5,XFF-UCMSDS5C  TURN OFF OUT OF LINE              X14600000
                                        OUTPUT PENDING FLAG             14700000
         TM    DCMCOM2,DCMCBLNK    Q. BLANKING TO BE CHECKED            14900000
         BO    INT7EXIT            YES, EXIT TO INTERFACE 7             15000000
         B     PROC1EXT            NO, EXIT TO PROCESSOR 1              15100000
         EJECT                                                          15200000
ENTRYFND EQU   *                                                        15300000
         LA    OUTQREG,E0(OUTQREG) CLEAR HIGH ORDER BYTE                15400000
         TM    CQEFLAG,CQEMAJOR    ENTRY FOR MLWTO            MB Y02958 15600000
         BNO   NXTENTRY            NO. IGNORE                           15700000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR WQE   MB Y02958 15900000
         LA    WQEBASE,E0(WQEBASE) CLEAR HIGH ORDER BYTE                16000000
         TM    WMJMDSP,WMJMDSPG    PROCESSING TEMP SUSPENDED   @ZA14992 16030000
         BO    ENDOFQ              YES, DON'T PROCESS THIS MSG @ZA14992 16060000
         TM    WMJMCS1,WMJMCS1A    Q. ROUTING OR DESCRIPTOR            X16100000
                                        CODES PRESENT                   16200000
         BNO   NXTENTRY            NO. IGNORE                           16300000
         TM    WMJMDEC,WMJMDECH    Q. DESCRIPTOR CODE 8 - OUT          X16400000
                                        OF LINE CANDIDATE     MB Y02958 16500000
         BNO   NXTENTRY            NO. IGNORE                           16600000
         TM    WMJMDEC2,WMJMDECI   Q. DESCRIPTOR CODE 9 - INFO         X16700000
                                        REQUESTED BY DISPLAY OR        X16800000
                                        TRACK                 MB Y02958 16900000
         BNO   NXTENTRY            NO. IGNORE                           17000000
         CLI   WMJMAREA,Z          Q. AREA ID Z FOR MSG STREAM          17200000
         BE    NXTENTRY            YES. IGNORE                          17300000
         SPACE                                                          17400000
*    CHECK TO SEE IF WQE IS WAITING BEHIND A FRAME FULL CONDITION       17500000
*      (THIS ALGORITHM MANIPULATES THE CONSOLE ID TO FIND THE           17600000
*      CORRESPONDING BIT POSITION IN THE DOUBLE WORD FRAME FULL         17700000
*      FIELD)                                                           17800000
         SR    WORK1,WORK1         CLEAR REG                            18000000
         IC    WORK1,UCMID         GET CONSOLE ID                       18100000
         BCTR  WORK1,E0            REDUCE FOR ALGORITHM                 18200000
         SR    WORKR,WORKR         CLEAR REG                            18300000
         LA    ODD,E8              GET DIVISOR                          18400000
         DR    WORKR,ODD           DIVIDE ID                            18500000
*                                  WORKR IS BIT IN BYTE                 18600000
*                                  WORK1 IS BYTE IN FIELD               18700000
         LA    EVEN,E1             GET BIT                              18800000
         SRDL  EVEN,E25(WORKR)     CREATE MASK                          18900000
         LA    EVEN,WMJMCONS(WORK1) POINT TO FRAME FULL BITS  MB Y02958 19000000
         EX    ODD,CHKFF           CHECK IF FRAME FULL BIT IS ON        19100000
         BO    NXTENTRY            IF ON, GET NEXT WQE                  19200000
GETSACB  EQU   *                                                        19300000
         OI    WMJMBUF,WMJMBUFC   FLAG AS READY FOR HARDCOPY MB Y02958  19500000
         SR    R1,R1               CLEAR REG                            19600000
         IC    R1,WMJMAREA         GET SPECIFIED AREA ID                19700000
         BAL   LINKR,FINDSACB      FIND SACB FOR AREA                   19800000
         LTR   SACBBASE,SACBBASE   Q. SACB FOUND                        19900000
         BZ    NOAREA              NO. BRANCH TO PUT INLINE             20000000
AREAFND  EQU   *                                                        20100000
         TM    DCMAFLG1,DCMADISP   Q. DISPLAY ALREADY IN AREA           20300000
         BNO   NEWDISP             NO. BRANCH TO PUT DISPLAY IN         20400000
         TM    DCMAFLG2,DCMARCON   Q. REWRITE CONTROL LINE              20600000
         BO    INT4EXIT            YES, XCTL TO INTERFACE 4             20700000
         TM    DCMAFLG1,DCMABL     Q. BLANK REST OF AREA                20900000
         BO    TSTMTHD             YES, BRANCH TO TEST FOR             X21000000
                                        METHOD OF OUTPUT                21100000
         TM    DCMAFLG1,DCMADEND   IS END OF OLD DISPLAY ON            X21300000
                                        SCREEN                          21400000
         BO    OVLYDISP            YES. OVERLAY OLD DISPLAY             21500000
         C     OUTQREG,DCMAMJWQ    Q. DISPLAY IN AREA SAME AS          X21600000
                                        ONE ON Q                        21700000
         BNE   OVLYDISP            NO. BRANCH TO OVERLAY THE OLD       X21800000
                                        DISPLAY                         21900000
         SPACE 2                                                        22000000
* FIND NEXT MINOR TO BE WRITTEN, IF ANY                                 22100000
         DROP  WQEBASE                                                  22300000
         USING WMNM,WQEBASE         BASE WQE                            22400000
         BAL   LINKR,FINDNEXT      GET POINTER TO NEXT MINOR            22500000
         LA    WQEBASE,E0(WQEBASE) CLEAR HIGH ORDER BYTE                22600000
         LTR   WQEBASE,WQEBASE     ANY MINORS TO BE WRITTEN             22800000
         BZ    NXTENTRY            NO, GET NEXT CONSOLE Q ENTRY         22900000
         ST    WQEBASE,DCMAMIN     SAVE MINOR POINTER         MF  M1694 23000000
         CLI   WMNMLT1,E0          LINE TYPE FLAGS ZERO       MB Y02958 23100000
         BE    NXTENTRY            YES, MINOR IS NOT FULLY    MF       X23200000
                                        BUILT YET - GET NEXT  MF       X23300000
                                        CONSOLE Q ENTRY       MF        23400000
         B     TSTMTHD             BRANCH TO TEST FOR OUTPUT           X23500000
                                        METHOD                          23600000
         DROP  WQEBASE                                                  23700000
         USING WMJM,WQEBASE         BASE WQE                            23800000
         SPACE 3                                                        23900000
NOAREA   EQU   *                                                        24000000
* THIS CONDITION SHOULD NEVER HAPPEN.  IF IT DOES, SOMEONE IS           24100000
* PROBABLY TRYING TO PUT SOMETHING BESIDES A STATUS DISPLAY             24200000
* OUT OF LINE. THIS CODE PURGES SUCH A REQUEST FROM THE CONSOLE Q.      24300000
         LR    EVEN,WQEBASE        POINT TO MAJOR FOR SUBRTN  MH Y02134 24500000
         DROP  WQEBASE             DROP ADDRESABILITY         MH Y02134 24600000
         USING WQE,EVEN            BASE MAJOR                 MH Y02134 24700000
         L     WQEBASE,WMJMMIN     POINT TO FIRST MINOR       MH Y02134 24800000
         BAL   WORK1,FREEWQE       FREE UP THIS DISPLAY       MH Y02134 24900000
         DROP  EVEN                DROP ADDRESABILITY         MH Y02134 25000000
         USING WQE,WQEBASE         ESTABLISH ADDRESABILITY    MH Y02134 25100000
         B     NXTENTRY            GET NEXT Q ENTRY           MH Y02134 25200000
         EJECT                                                          25300000
*********************************************************************** 25400000
*                                                                     * 25500000
* FIND NEXT MINOR TO BE WRITTEN                                       * 25600000
*    FROM THE POINTER SAVED IN THE SACB, DETERMINE THE ADDRESS        * 25700000
* OF THE NEXT MINOR TO BE WRITTEN, IF THERE IS ONE                    * 25800000
*    INPUT - OUTQREG - POINTER TO CONSOLE QUEUE ENTRY                 * 25900000
*            SACBBASE - SACB POINTER                                  * 26000000
*    OUTPUT - WQEBASE - POINTER TO NEXT MINOR TO BE WRITTEN, OR       * 26100000
*                   ZERO IF NO MORE ON QUEUE                          * 26200000
*    REGISTER USAGE - WQEBASE - OUTPUT                                * 26300000
*              LINKR - LINK REGISTER                                  * 26400000
*                                                                     * 26500000
*********************************************************************** 26600000
         SPACE 2                                                        26700000
FINDNEXT EQU   *                                                        26800000
         TM    CQEFLAG,CQEATTOP    SHOULD MINOR SEARCH BEGIN           X27200000
                                   AT TOP OF CHAIN            MB Y02958 27300000
         BO    MINPTR0             YES, BRANCH TO GET FIRST MINOR       27400000
         L     WQEBASE,DCMAMIN     GET MINOR POINTER SAVED              27600000
         TM    DCMAFLG2,DCMALMIN   Q. LAST MINOR OUTPUT SAVED           27900000
         BO    GETNEXT             YES, BRANCH TO GET NEXT MINOR        28000000
         LTR   WQEBASE,WQEBASE     Q. ZERO POINTER SAVED                28200000
         BZ    MINPTR0             YES, BRANCH TO HANDLE                28300000
         BR    LINKR               RETURN WITH POINTER SAVED           X28500000
                                        TO NEXT MINOR                   28600000
         SPACE                                                          28700000
MINPTR0  EQU   *                                                        28800000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR                 28900000
         TM    WMJMMLW,WMJMMLWH    Q. NULL MINOR ON QUEUE               29100000
         BNO   GETFIRST            NO, GET POINTER TO FIRST            X29200000
                                        MINOR                           29300000
         SR    WQEBASE,WQEBASE     INDICATE NO MINOR WAITING           X29400000
                                        TO BE OUTPUT                    29500000
         BR    LINKR               RETURN                               29600000
         SPACE                                                          29700000
GETFIRST EQU   *                                                        29800000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR                 30000000
         L     WQEBASE,WMJMMIN     GET POINTER TO FIRST MINOR           30100000
         NI    CQEFLAG,XFF-CQEATTOP TURN OFF START AT TOP     MB Y02958 30200000
         NI    DCMAFLG2,XFF-DCMALMIN  TURN OFF LAST MINOR FLAG          30300000
         XC    DCMAMIN(E4),DCMAMIN    CLEAR MINWQE SACB PTR    @ZA14992 30350000
         BR    LINKR               RETURN                               30400000
         SPACE                                                          30500000
GETNEXT  EQU   *                                                        30600000
* CHECK TO SEE IF LAST MINOR OUTPUT IS STILL ON QUEUE                   30700000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR       MB Y02958 31000000
         L     WQEBASE,WMJMMIN     GET POINTER TO FIRST MINOR           31100000
LOOKNEXT EQU   *                                                        31200000
         LA    WQEBASE,E0(WQEBASE) CLEAR HIGH ORDER BYTE                31300000
         LTR   WQEBASE,WQEBASE     END OF MINOR QUEUE                   31400000
         BNZ   CHKEQ               NO, BRANCH TO SEE IF EQUAL TO       X31500000
                                        LAST OUTPUT                     31600000
         B     GETFIRST            GET POINTER TO FIRST                X31700000
                                        MINOR ON QUEUE SINCE            31800000
*                                       LAST MINOR OUTPUT IS NO        X31900000
                                        LONGER ON QUEUE                 32000000
CHKEQ    EQU   *                                                        32100000
         C     WQEBASE,DCMAMIN     MINOR POINTER EQUAL TO              X32200000
                                        POINTER TO LAST MINOR          X32300000
                                        OUTPUT                          32400000
         BE    LASTONQ             YES. LAST OUTPUT IS ON QUEUE         32500000
         DROP  WQEBASE                                                  32600000
         USING WMNM,WQEBASE         BASE WQE                            32700000
         L     WQEBASE,WMNMNX1-E1  NO. LOOK AT                          32800000
         B     LOOKNEXT                 NEXT MINOR ON QUEUE             32900000
* LAST MINOR OUTPUT IS STILL ON QUEUE - CONTINUE FROM THERE             33000000
LASTONQ  EQU   *                                                        33100000
         L     WQEBASE,WMNMNX1-E1  GET CHAIN FIELD OF LAST             X33300000
                                        MINOR OUTPUT                    33400000
         LA    WQEBASE,E0(WQEBASE) CLEAR HIGH ORDER BYTE                33500000
         LTR   WQEBASE,WQEBASE     Q. ANY MORE MINORS                   33600000
         BCR   NOMORE,LINKR        NO, RETURN                           33700000
         NI    DCMAFLG2,XFF-DCMALMIN  TURN OFF LAST MINOR FLAG          33800000
         BR    LINKR               RETURN                               33900000
         EJECT                                                          34000000
*********************************************************************** 34100000
*                                                                     * 34200000
*    A NEW DISPLAY IS TO BE WRITTEN TO THE SCREEN.  THE SACB          * 34300000
* MUST BE INITIALIZED.  IF AN OLD DISPLAY IS BEING OVERLAYED ITS      * 34400000
* WQE'S MUST BE FREED                                                 * 34500000
*                                                                     * 34600000
*********************************************************************** 34700000
         SPACE 2                                                        34800000
OVLYDISP EQU   *                   OVERLAY OLD DISPLAY                  34900000
         TM    DCMAFLG2,DCMAMJFR   Q. IS MAJOR FREED                    35200000
         BO    REINSACB            YES, GO REINITIALIZE SACB            35300000
         ST    OUTQREG,DCMDSAV+4   SAVE CURRENT OUTPUT Q POINTER        35400000
         L     OUTQREG,DCMAMJWQ    GET QUEUE POINTER FOR OLD           X35500000
                                        DISPLAY                         35600000
         TM    DCMAFLG1,DCMADEND   IS END OF DISPLAY ON SCREEN          35900000
         BO    FREEMAJ1            YES, FREE MAJOR ONLY -              X36000000
                                        MINORS ALREADY FREED            36100000
         BAL   LINKR,FINDNEXT      GET POINTER TO NEXT MINOR TO        X36200000
                                        BE OUTPUT FOR OLD              X36300000
                                        DISPLAY                         36400000
         L     EVEN,CQEWQE         POINT TO MAJOR             MH Y02134 36500000
         LA    EVEN,E0(EVEN)       CLEAR HIGH BYTE            MH Y02134 36600000
         BAL   WORK1,FREEWQE       FREE OLD DISPLAY           MH Y02134 36700000
         SPACE                                                          36800000
*     RESTORE POINTERS FOR NEW DISPLAY                                  36900000
HRDNEWDS L     OUTQREG,DCMDSAV+E4  GET POINTER TO CONSOLE     MH Y02134X37000000
                                        OUTPUT QUEUE ENTRY FOR         X37100000
                                        NEW  DISPLAY                    37200000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR WQE   MB Y02958 37300000
         SPACE 2                                                        37400000
REINSACB EQU   *                                                        37500000
*    REINITIALIZE SACB                                                  37600000
         XC    DCMAROW(DCMADFLG-DCMAROW),DCMAROW  ZERO DIDOCS          X37800000
                                        PORTION OF SACB       MB Y02958 37900000
         B     REINSSCT            BRANCH TO REINITIALIZE SSCT          38000000
FREEMAJ1 EQU   *                                                        38100000
         L     EVEN,CQEWQE         POINT TO MAJOR             MH Y02134 38300000
         SR    WQEBASE,WQEBASE     ZERO MINOR POINTER         MH Y02134 38400000
         BAL   WORK1,FREEWQE       GO TO FREE SUBROUTINE      MH Y02134 38500000
         B     HRDNEWDS            BRANCH                     MH Y02134 38600000
         SPACE                                                          38700000
         EJECT                                                          38800000
NEWDISP  EQU   *                   PUT DISPLAY IN AREA WHICH            38900000
*                                       DOES NOT ALREADY CONTAIN        39000000
*                                       A DISPLAY                       39100000
         SPACE                                                          39200000
*    IF NEW DISPLAY IS ABOVE TOP DISPLAY ALREADY ON SCREEN,             39300000
*      CHANGE TOP DISPLAY INDICATOR                                     39400000
         CLC   DCMAID(E1),DCMTOPDS Q. NEW DISPLAY ABOVE OLD TOP         39700000
         BNH   REINSSCT            NO, GO REINITIALIZE SSCT             39800000
         OI    DCMCOM2,DCMCBLNK    INDICATE CHECK BLANKING SO          X40000000
                                        THAT NO MESSAGES WILL          X40100000
                                        APPEAR BELOW DISPLAY            40200000
         MVC   DCMTOPDS(E1),DCMAID YES, STORE ID OF AREA NEW           X40400000
                                        DISPLAY IS IN                   40500000
         SR    WORKR,WORKR         CLEAR REG                            40600000
         IC    WORKR,DCMATOP       GET LINE NO. OF TOP OF DISPLAY       40700000
         BCTR  WORKR,E0            SUBTRACT ONE                         40800000
         MH    WORKR,DCMCORLN      MULTIPLY BY LINE LENGTH              40900000
         A     WORKR,DCMASCRN      ADD ADDRESS OF BEGINNING OF         X41000000
                                        MSG AREA SCREEN IMAGE           41100000
         ST    WORKR,DCMWTBUF      STORE ADDRESS OF SCREEN IMAGE       X41200000
                                        BUFFER OF FIRST STATUS         X41300000
                                        DISPLAY LINE                    41400000
         SPACE 3                                                        41500000
REINSSCT EQU   *                                                        41600000
*    REINITIALIZE SSCT                                                  41700000
         SR    WORKR,WORKR         CLEAR REG                            41900000
         IC    WORKR,DCMATOP       GET LINE NO. OF TOP ROW              42000000
         BCTR  WORKR,E0            SUBTRACT ONE                         42100000
         A     WORKR,DCMADSEC      ADD ADDRESS OF BEGINNING OF         X42200000
                                        SSCT TO GET POINTER TO         X42300000
                                        FIRST SSCT ENTRY OF AREA        42400000
         LH    WORK1,DCMALN        GET LENGTH OF AREA                   42500000
         BCTR  WORK1,E0            SUBTRACT ONE FOR EXECUTE             42600000
         EX    WORK1,ZEROSSCT      ZERO OUT AREA'S SSCT                 42700000
         SPACE 3                                                        42800000
INITSACB EQU   *                   INITIALIZE SACB                      42900000
         OI    DCMAFLG1,DCMADISP   INDICATE DISPLAY IN AREA             43100000
         MVC   DCMAROW(E1),DCMATOP PUT TOP LINE NO. IN DCMAROW          43200000
         ST    OUTQREG,DCMAMJWQ    SAVE ADDRESS OF CONSOLE Q           X43300000
                                        ENTRY FOR MAJOR WQE             43400000
         MVI   DCMAFR,F0           INDICATE FRAME ONE                   43500000
         MVI   DCMAFR+E1,F1             IN SACB                         43600000
         OI    DCMAFLG1,DCMAFRPR   INDICATE FRAME IN PROGRESS           43700000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK ROUTINE             43800000
         LR    X1PARM,CXSABASE     PASS XSA ADDRESS IN REG 1            43900000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        44000000
         SR    R0,R0               CLEAR REG 0                          44100000
         TIME  BIN                 GET TIME OF DAY                      44200000
         ST    R0,DCMATIME         SAVE TIME STAMP                      44300000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK ROUTINE              44400000
         LR    X1PARM,CXSABASE     PASS XSA ADDRESS IN REG 1            44500000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         44600000
         DROP  WQEBASE                                                  44700000
         USING WMJM,WQEBASE         BASE WQE                            44800000
         TM    WMJMDEC2,WMJMDECJ   IS THIS A DYNAMIC DISPLAY  MB Y02958 45000000
         BO   DDINIT               YES, BRANCH TO INITIALIZE FOR       X45100000
                                        DYNAMIC DISPLAY       MB Y02958 45200000
BACK     EQU   *                                                        45300000
         OI    DCMAFLG2,DCMAWCON   INDICATE WRITE CONTROL LINE          45500000
         TM    WMJMMLW,WMJMMLWH    Q. MINOR CREATED WITHOUT TEXT        45600000
         BO    JSTCNTRL            BRANCH TO OUTPUT JUST CONTROL       X45700000
                                        LINE                            45800000
         L     WORKR,WMJMMIN       GET POINTER TO FIRST MINOR           45900000
         ST    WORKR,DCMAMIN       PUT POINTER IN SACB                  46000000
         NI    CQEFLAG,XFF-CQEATTOP TURN OFF TOP OF CHAIN BIT MB Y02958 46100000
         NI    DCMAFLG2,XFF-DCMALMIN   TF MLAST VALID FLAG     @ZA14992 46150000
         B     TSTMTHD             BRANCH TO TEST FOR METHOD OF        X46200000
                                        OUTPUT                          46300000
JSTCNTRL EQU   *                                                        46400000
         XC    DCMAMIN(E4),DCMAMIN ZERO OUT MINOR POINTER IN           X46500000
                                        SACB                            46600000
         NI    DCMAFLG2,XFF-DCMALMIN    TF MLAST VALID         @ZA14992 46650000
         B     TSTMTHD             BRANCH TO TEST FOR METHOD OF        X46700000
                                        OUTPUT                          46800000
         SPACE 3                                                        46900000
DDINIT   EQU   *                   INITIALIZE SACB AND SSCT FOR        X47000000
                                        EACH COPY OF A DYNAMIC         X47100000
                                        DISPLAY                         47200000
*    IF THE DYNAMIC DISPLAY IS IN THE BOTTOM-MOST AREA, THE             47400000
*      SECONDARY SCREEN CONTROL TABLE IS SET TO INDICATE THAT           47500000
*      THE MESSAGE AREA LINES ARE TO BE RESERVED FOR THE DYNAMIC        47600000
*      DISPLAY.  THIS WILL EVENTUALLY FREE THIS SECTION OF THE          47700000
*      DCM SO THAT THE DYNAMIC DISPLAY CAN BE WRITTEN FROM THE          47800000
*      SCREEN IMAGE BUFFER.                                             47900000
         CLI   DCMAID,A            Q. IN BOTTOM-MOST AREA               48000000
         BNE   BACK                NO, DO NOT RESERVE AREA              48100000
         SR    WORKR,WORKR         CLEAR REG                            48200000
         IC    WORKR,DCMATOP       GET TOP ROW OF AREA                  48300000
         BCTR  WORKR,E0            SUBTRACT ONE                         48400000
         A     WORKR,DCMADSEC      WORKR NOW POINTS TO FIRST           X48500000
                                        SSCT BYTE FOR AREA              48600000
         LH    WORK1,DCMALN        GET LENGTH OF AREA                   48700000
SETSECDD EQU   *                                                        48800000
         OI    E0(WORKR),DCMSECDD  INDICATE LINE RESERVED FOR          X48900000
                                        DYNAMIC DISPLAY                 49000000
         LA    WORKR,E1(WORKR)     POINT TO NEXT SSCT BYTE              49100000
         BCT   WORK1,SETSECDD      SET FOR ALL LINES OF AREA            49200000
         B     BACK                BRANCH BACK                          49300000
         EJECT                                                          49400000
* A STATUS DISPLAY MAY BE OUTPUT IN ANY OF THREE WAYS:                  49500000
*    1.        IF THERE ARE MESSAGES IN THE LINES TO WHICH THE          49600000
*        STATUS DISPLAY IS TO BE WRITTEN, THE STATUS DISPLAY IS         49700000
*        WRITTEN OUT FROM A 3-LINE WRITE AREA (CONSISTING OF THE        49800000
*        INSTRUCTION LINE AND TWO ENTRY AREA LINES) THREE LINES         49900000
*        AT A TIME.                                                     50000000
*    2.        IF THERE ARE NO MESSAGES IN THE LINES TO WHICH           50100000
*        THE STATUS DISPLAY IS TO BE WRITTEN, THE STATUS DISPLAY        50200000
*        IS WRITTEN OUT A FRAME AT A TIME (OR ANY PORTION               50300000
*        THEREOF WHICH IS ON THE QUEUE) FROM THE MESSAGE AREA           50400000
*        PORTION OF THE SCREEN IMAGE BUFFER IN THE DCM.                 50500000
*    3.        COMBINATION OF (1) AND (2) - OUTPUT OF A DISPLAY         50600000
*        MAY BE STARTED IN THE FIRST WAY, 3 LINES AT A TIME, AND        50700000
*        THEN, IF THE MESSAGES END, THE REMAINDER OF THE DISPLAY        50800000
*        MAY BE WRITTEN ALL AT ONCE.                                    50900000
         SPACE 2                                                        51000000
TSTMTHD  EQU   *                                                        51100000
* FIND OUT FROM THE SCT IF THERE IS A MESSAGE IN THE NEXT LINE          51200000
*    TO BE WRITTEN                                                      51300000
         SR    WORKR,WORKR         CLEAR REG                            51600000
         IC    WORKR,DCMAROW       GET NO. OF NEXT LINE TO BE          X51700000
                                        WRITTEN                         51800000
         BCTR  WORKR,E0            SUBTRACT ONE                         51900000
         MH    WORKR,DCMSCTCN      MULTIPLY BY LENGTH OF ONE           X52000000
                                        SCT ENTRY                       52100000
         A     WORKR,DCMAMTAB      ADD ADDRESS OF SCT                   52200000
*    WORKR NOW POINTS TO SCT ENTRY FOR NEXT LINE TO BE WRITTEN          52300000
         TM    E0(WORKR),DCMMSGIN  Q. MESSAGE IN LINE                   52400000
         BNO   INT6EXIT            NO, EXIT TO INTERFACE 6 TO          X52500000
                                        OUTPUT REST OF DISPLAY         X52600000
                                        FRAME                           52700000
*                                  YES, EXIT TO INTERFACE 4 TO         X52800000
                                        OUTPUT DISPLAY 3 LINES         X52900000
                                        AT A TIME                       53000000
         OI    DCMCOM3,DCMOLUNV    INDICATE MSGS OVERLAYED BY          X53100000
                                        DISPLAY                         53200000
INT4EXIT EQU   *                                                        53300000
         L     XFBRANCH,DCMNINT4   LOAD INTERFACE 4 ADDRESS             53500000
         B     XCTL                EXIT TO IEECVFTO                     53600000
INT6EXIT EQU   *                                                        53700000
*  THIS LINE OF CODE IS DELETED FOR OS A51415 AND THE AS2 YM3335        53900000
         L     XFBRANCH,DCMNINT6   LOAD INTERFACE 6 ADDRESS             54000000
         B     XCTL                EXIT TO IEECVFTQ                     54100000
         EJECT                                                          54200000
*********************************************************************** 54300000
*                                                                     * 54400000
* FIND AND BASE SACB SUBROUTINE                                       * 54500000
*    GIVEN A PARTICULAR CRT CONSOLE AND A ONE CHARACTER AREA ID       * 54600000
* THIS SUBROUTINE FINDS AND BASES THE SCREEN AREA CONTROL BLOCK       * 54700000
* (SACB) WHICH MATCHES THAT ID.  IF NONE IS FOUND, A ZERO IS          * 54800000
* RETURNED AS THE BASE.                                               * 54900000
*    INPUT - R1 - ONE CHARACTER AREA ID IN LOW ORDER BYTE             * 55000000
*                   (HIGH ORDER BYTES MUST BE ZERO)                   * 55100000
*            UCMEBASE - ADDRESS OF UCM ENTRY OF A CRT CONSOLE         * 55200000
*    OUTPUT - SACBBASE - ADDRESS OF SACB WITH MATCHING ID             * 55300000
*                   (ZERO IF NO MATCH)                                * 55400000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 55500000
*                   R0, SACBBASE, RDCMBASE                            * 55600000
*                   LINKR IS RETURN REGISTER                          * 55700000
*                                                                     * 55800000
*********************************************************************** 55900000
         SPACE 2                                                        56000000
FINDSACB EQU   *                                                        56100000
         SR    R0,R0               CLEAR REG                            56200000
         L     RDCMBASE,UCMXB      GET RESIDENT DCM ADDRESS             56300000
         L     SACBBASE,DCMADSDS   GET FIRST SACB ADDRESS               56400000
CONTINUE EQU   *                                                        56500000
         LTR   SACBBASE,SACBBASE   ANY MORE SACB'S                      56600000
         BCR   NOMORE,LINKR        NO, RETURN FROM SUBROUTINE           56700000
         TM    DCMASACB,DCMAUSE    DOES SACB DEFINE AN AREA             56800000
         BNO   ENDOSACB            NO, BRANCH TO RETURN                 56900000
         IC    R0,DCMAID           GET ID FROM SACB                     57000000
         CR    R0,R1               COMPARE WITH PASSED ID               57100000
         BCR   MATCH,LINKR         EQUAL, RETURN FROM SUBROUTINE        57200000
         L     SACBBASE,DCMACBNX   NOT EQUAL, GET NEXT SACB             57300000
         B     CONTINUE            CONTINUE SEARCH                      57400000
ENDOSACB EQU   *                                                        57500000
         SR    SACBBASE,SACBBASE   INDICATE NO SACB MATCH FOUND         57600000
         BR    LINKR               RETURN FROM SUBROUTINE               57700000
         EJECT                                                          57800000
FREEWQE  EQU   *                                              MH Y02134 57900000
*INPUT TO SUBROUTINE:                                         MH Y02134 58000000
*        UCM ENTRY POINTER IN UCMEBASE                        MH Y02134 58100000
*        CURRENT QUEUE ENTRY POINTER IN OUTQREG               MH Y02134 58200000
*        MAJOR WQE ADDRESS IN EVEN                            MH Y02134 58300000
*        MINOR WQE ADDRESS IN WQEBASE                         MH Y02134 58400000
         DROP WQEBASE                                         MH Y02134 58500000
         USING WMNM,WQEBASE        BASE MINOR                 MH Y02134 58600000
HRDLOOP  LA    WQEBASE,E0(WQEBASE) CLEAR HI BYTE MINOR PTR    MH Y02134 58700000
         LTR   WQEBASE,WQEBASE     IS IT ZERO                 MH Y02134 58800000
         BZ    HRDLAST              YES, FREE MAJOR           MH Y02134 58900000
         SR    ODD,ODD             CLEAR WORK REGISTER        MH Y02134 59000000
         IC    ODD,WMNMUC1         GET MINOR USE COUNT        MH Y02134 59100000
         BCTR  ODD,E0              REDUCE BY ONE              MH Y02134 59200000
         STC   ODD,WMNMUC1         STORE REDUCED COUNT        MH Y02134 59300000
NEXT     L     WQEBASE,WMNMNX1-E1  POINT TO NEXT MINOR        MH Y02134 59400000
         B     HRDLOOP             CHECK IT OUT               MH Y02134 59500000
         DROP  WQEBASE                                        MH Y02134 59600000
         USING WQE,EVEN            BASE MAJOR                 MH Y02134 59700000
HRDLAST  OI    WMJMMLW,WMJMMLWG    SERVICE THIS CHAIN         MH Y02134 59800000
         OI    CQEFLAG,CQEAVAIL    PURGE QUEUE ENTRY          MH Y02134 59900000
         NI    CQEFLAG,X'FF'-CQEENTR    NO LONGER ACTIVE      MH Y02134 60000000
         OI    UCMSTS,UCMTB        DEQUE WORK NEEDED          MH Y02134 60100000
         BR    WORK1               RETURN TO CALLER           MH Y02134 60200000
         DROP  EVEN                                           MH Y02134 60300000
         USING WQE,WQEBASE                                    MH Y02134 60400000
         SPACE 2                                                        60500000
NOMORE   EQU   8                   BRANCH ON ZERO                       60600000
MATCH    EQU   8                   BRANCH ON EQUAL                      60700000
         EJECT                                                          60800000
*                             EXITS                                     60900000
         SPACE 2                                                        61000000
PROC1EXT EQU   *                                                        61100000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  61300000
         B     XCTL                EXIT TO IEECVET1                     61400000
         SPACE                                                          61500000
INT7EXIT EQU   *                                                        61600000
         L     XFBRANCH,DCMNINT7   LOAD INTERFACE 7 ADDRESS             61800000
*                                  FOR EXIT TO IEECVFTT                 61900000
         SPACE 2                                                        62000000
XCTL     EQU   *                                                        62100000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 62200000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             62300000
*                                                                       62400000
*            EXECUTED INSTRUCTIONS                                      62500000
*                                                                       62600000
CHKFF    TM    E0(EVEN),E0         CHECK IF FRAME FULL BIT IS ON        62700000
ZEROSSCT XC    E0(E0,WORKR),E0(WORKR)  ZERO OUT AREA'S SSCT             62800000
         EJECT                                                          62900000
*********************************************************************** 63000000
*                                                                     * 63100000
*                             EQUATES                                 * 63200000
*                                                                     * 63300000
*********************************************************************** 63400000
         SPACE 2                                                        63500000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            63600000
ID2      EQU   C'M'                2ND CHARACTER OF CSECT ID            63700000
E0       EQU   0                   NUMBER                               63800000
E1       EQU   1                   NUMBER                               63900000
E2       EQU   2                   NUMBER                               64000000
E3       EQU   3                   NUMBER                               64100000
E4       EQU   4                   NUMBER                               64200000
E8       EQU   8                   NUMBER                               64300000
E25      EQU   25                  NUMBER                               64400000
         SPACE                                                          64500000
Z        EQU   C'Z'                MSG STREAM AREA ID                   64600000
A        EQU   C'A'                ID OF BOTTOMMOST AREA                64700000
F0       EQU   C'0'                EBCDIC 0                             64800000
F1       EQU   C'1'                EBCDIC 1                             64900000
XFF      EQU   X'FF'               TO TURN OFF BITS                     65000000
         SPACE                                                          65100000
         EJECT                                                          65200000
         IHACTM  CXSA                                                   65300000
         EJECT                                                          65400000
         IHACTM CQE                                           MB Y02958 65500000
         EJECT                                                          65600000
         IEECUCM FORMAT=NEW                                             65700000
         EJECT                                                          65800000
         IHAWQE  DSECT=YES                                              65900000
         EJECT                                                          66000000
         IEERDCM                                                        66100000
         EJECT                                                          66200000
         IEETDCM                                                        66300000
         EJECT                                                          66400000
         END                                                            66600000
./  ADD  SSI=32960801,NAME=IEECVFTN
IEECVFTN CSECT                                                          00050002
*D 069500-079500,101000,177500                                MB YM0664 00060002
*/*IEECVFTN: CHART */                                                   00100002
*    THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM     00150002
*    21002, OS RELEASE 21.                                              00200002
*/*HEADER                                                               00250002
*/*     CHART 6N  IEECVFTN - IGC6N07B - K D,H; K D,U; K D,F CONTROL     00300002
*/*COMMANDS FOR OUT-OF-LINE DISPLAYS */                                 00350002
         TITLE 'IEECVFTN STATUS DISPLAY INTERFACE 3'                    00400002
*********************************************************************** 00450002
*                                                                     * 00500002
* STATUS                                                              * 00550002
*    CHANGE LEVEL=0                                                   * 00600002
*                                                                     * 00650002
* FUNCTION                                                            * 00700002
*    TO HANDLE CONTROL (K) COMMANDS AFFECTING OUT-OF-LINE STATUS      * 00750002
*    DISPLAYS.   (K D,H K D,F K D,U)                                  * 00800002
*                                                                     * 00850002
* ENTRY POINT                                                         * 00900002
*    IEECVFTN (CSECT)                                                 * 00950002
*    IGC6N07B (LOAD MODULE NAME)                                      * 01000002
*                                                                     * 01050002
* INPUT                                                               * 01100002
*    REG 1 POINTS TO CXSA WHICH POINTS TO DCM  WHICH CONTAINS INDI-   * 01150002
*    CATORS.                                                          * 01200002
*    K COMMAND PARAMETER LIST POINTED TO IN THE DCM                   * 01250002
*    DCMADOPN POINTS TO OPERAND(S) IN PARAMETER LIST                  * 01300002
*                                                                     * 01350002
* OUTPUT                                                              * 01400002
*    ALTERATION OF THE CONTROL LINES OF OUT OF LINE DISPLAYS.         * 01450002
*    BIT SETTINGS IN DCM AND SACB FOR OTHER ROUTINES TO ANALYZE       * 01500002
*                                                                     * 01550002
* EXTERNAL REFERENCES                                                 * 01600002
*    SVC 34                                                           * 01650002
*    XCTL                                                             * 01700002
*                                                                     * 01750002
* EXITS,NORMAL                                                        * 01800002
*    I/O RTN    (DEVICE-DEPENDENT) TO OUTPUT A NEW CONTROL LINE       * 01850002
*                                                                     * 01900002
* EXITS,ERROR                                                         * 01950002
*    TO PROCCESOR 1 UPON INCORRECT COMMAND INPUT                      * 02000002
*                                                                     * 02050002
* ATTRIBUTES                                                          * 02100002
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC                              * 02150002
*                                                                     * 02200002
* TABLES/WORK AREAS                                                   * 02250002
*    UCM, RDCM, DCM, CXSA, WQE, SACB                                  * 02300002
*                                                                     * 02350002
*********************************************************************** 02400002
         EJECT                                                          02450002
*                                                                       02500002
*********************************************************************** 02550002
*    REGISTERS                                                          02600002
*                                                                       02650002
X1PARM   EQU   1                                                        02660002
XERTRN   EQU   14                                                       02662002
XFBRANCH EQU   15                                                       02670002
XF       EQU   15                  WORK REG                             02700002
X14      EQU   14                  RETURN REG                           02750002
RETURN   EQU   14                  RETURN REG                           02800002
XD       EQU   13                  WORK REG                             02850002
SACBPT   EQU   13                  SACB BASE REG                        02900002
XC       EQU   12                  THIS RTN'S BASE REG                  02950002
XB       EQU   11                  CXSA BASE REG                        03000002
XA       EQU   10                  UCM BASE REG                         03050002
X9       EQU   9                   TRANSIENT DCM BASE REG               03100002
XRDCM    EQU   8                   RESIDENT DCM BASE REG                03150002
LIST     EQU   7                   UCMLIST BASE REG                     03200002
X6       EQU   6                   WORK REG                             03250002
PARMREG  EQU   1                   PARAMETER LIST BASE REG              03300002
FLDADR   EQU   15                  MASKING FIELD POINTER                03350002
MAJWQER  EQU   4                   MAJOR WQE BASE REG                   03400002
X5       EQU   5                   WORK REG                             03450002
X4       EQU   4                   WORK REG                             03500002
X3       EQU   3                   WORK REG                             03550002
X2       EQU   2                   WORK REG                             03600002
X1       EQU   1                   WORK REG                             03650002
X0       EQU   0                   WORK REG                             03700002
R3       EQU   3                   WORK REG                             03750002
R4       EQU   4                   WORK REG                             03800002
R5       EQU   5                   WORK REG                             03850002
R6       EQU   6                   WORK REG                             03900002
********************************************************************    03950002
         EJECT                                                          04000002
********************************************************************    04050002
*     EQUATES                                                           04100002
********************************************************************    04150002
*                                                                       04200002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            04210002
ID2      EQU   C'N'                2ND CHARACTER OF CSECT ID            04220002
BLANK    EQU   X'40'                                                    04250002
********************************************************************    04300002
*              FIELD INCREMENTS                                         04350002
N0       EQU   0                                                        04400002
N1       EQU   1                                                        04450002
N2       EQU   2                                                        04500002
N3       EQU   3                                                        04550002
N4       EQU   4                                                        04600002
N5       EQU   5                                                        04650002
N6       EQU   6                                                        04700002
N7       EQU   7                                                        04750002
N8       EQU   8                                                        04800002
N9       EQU   9                                                        04850002
ND       EQU   13                  FIELD LENGTH                         04900002
N34      EQU   34                                                       04950002
N64      EQU   64                                                       05000002
N255     EQU   255                                                      05050002
CF0      EQU   X'F0'                                                    05100002
F0       EQU   X'F0'                                                    05150002
*********************************************************************** 05200002
         EJECT                                                          05250002
*/* E IEECVFTN */                                                       05300002
*                                                                       05350002
*    ESTABLISH ADDRESSABILITY                                           05400002
*                                                                       05450002
*/*%BASES: P (,%ANALYZ) ESTABLISH ADDRESSABILITY */                     05500002
         BALR  XC,N0               ESTABLISH ROUTINE'S                  05550002
         USING *,XC                BASE REGISTER                        05600002
         LR    XB,X1               ESTABLISH CXSA                       05650002
         USING CXSA,XB             ADDRESSABILITY                       05700002
         L     XA,CSACTLM          ESTABLISH UCM BASE                   05800002
         USING UCM,XA              ADDRESSABILITY                       05850002
         L     LIST,CSAUCM         LOAD UCM ENTRY ADDRESS               05900002
         USING UCMLIST,LIST        ESTABLISH UCME  ADDRESSABILITY       05950002
         L     XRDCM,UCMXB         GET POINTER TO RESIDENT DCM          06000002
         USING DCMTSRT,XRDCM          ESTABLISH RDCM BASE REG           06050002
         L     X9,N0(XRDCM)        LOAD TRANSIENT DCM PT                06100002
         USING DCMSTRT,X9         ESTABLISH TDCM BASE REG               06150002
         USING DCMACB,SACBPT       SACB BASE REG                        06200002
         USING KPARM,PARMREG       ESTABLISH PARAMETER BASE REG         06250002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      06260002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    06270002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      06280002
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           06290002
         LR    X1PARM,XB           PASS CXSA ADDRESS IN REG 1           06292002
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         06294002
*                                                                       06300002
*********************************************************************** 06350002
         EJECT                                                          06400002
*********************************************************************** 06450002
*                                                                       06500002
*                                                                       06550002
*/*%ANALYZ: P (,%P01) GET POINTER TO OPERANDS */                        06600002
*    ANALYZE COMMAND IN PARAMETER LIST                                  06650002
         L     PARMREG,DCMADOPN    LOAD POINTER TO OPERAND(S)           06700002
         SH    PARMREG,FOUR        DECREMENT POINTER BY 4               06750002
*/*%P01: S (,%P03) SACBINIT: FIND SACB TO MATCH AREA ID IN PARAM LIST   06800002
*/**/                                                                   06850002
         BAL   X14,SACBINIT        GO FIND SACB TO MATCH AREA ID        06900002
*/*%P03: P (,%COMP) BASE CONTROL LINE DSECT */                          07100002
         USING DCONTROL,X5         BASE CONTROL LINE DSECT              07150002
*                                                                       07200002
*/*%COMP: D (NO,%COMP2,YES,KDFRTN) IS COMMAND K D,F */                  07250002
         CLC   KOPN(N4),KDF        NO--IS COMMAND K D,F                 07300002
         BE    KDFRTN              YES-GO SET FORWARD FRAME BITS        07350002
*/*%COMP2: D (NO,%COMP3,YES,BLDLINE) IS COMMAND K D,H */                07400002
         CLC   KOPN(N4),KDH        NO--IS COMMAND K D,H                 07450002
         BE    BLDLINE              YES, UPDATE CONTROL LINE  MB Y02958 07500002
*/*%COMP3: D (NO,ERROR,YES,BLDLINE) IS COMMAND K D,U */                 07550002
         CLC   KOPN(N4),KDU        NO--IS COMMAND K D,U                 07600002
         BE    BLDLINE              YES, UPDATE CONTROL LINE  MB Y02958 07650002
*    IF NONE OF ABOVE, IT IS AN ERROR THAT SHOULD NEVER HAPPEN.         07700002
*    GO BACK TO PROCESSOR 1 SO THAT IT CAN CONTINUE PROCESSING          07750002
*    WITHOUT CAUSING POSSIBLE SYSTEM FAILURE.                           07800002
         SPACE 2                                                        07850002
*/*ERROR: P (,XCTL) GET PROCESSOR1 ADDRESS */                 MB Y02958 07900002
ERROR    EQU   *                                                        07950002
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  08000002
         B     XCTL                EXIT TO IEECVET1                     08050002
*                                                                       08100002
*********************************************************************** 08150002
         EJECT                                                          09350002
*/*KDFRTN: P (,FRAMEOFF) TURN OFF FRAME FULL BIT IN SACB */             09400002
KDFRTN   EQU   *                                                        09450002
*    ON A K D,F COMMAND THE FRAME FULL BITS IN THE MAJOR WQE FOR THE    09500002
*    DISPLAY AND IN THE SACB ARE TURNED OFF.                            09550002
*    THE OUT OF LINE DISPLAY PENDING BIT IS TURNED ON.                  09600002
*    THE SETTING OF THESE BITS CAUSES CONTROL TO LATER BE PASSED TO THE 09650002
*    STATUS DISPLAY INTERFACE 2 MODULE TO OUTPUT THE NEXT FRAME.        09700002
*    THE FRAME NUMBER IS THEN UPDATED AND THE CONTROL LINE IS REWRITTEN 09750002
         TM    DCMAFLG1,DCMAFULL   IS FRAME FULL BIT ON IN SACB         09800002
         BZ    FRAMEOFF            NO--IF ZERO                          09850002
         NI    DCMAFLG1,N255-DCMAFULL TURN OFF FRAME FULL BIT IN SACB   09900002
*                                  BIT                                  09950002
*/*FRAMEOFF: S (,%FRM01) MASKRTN: SET BIT IN WQE OFF */                 10000002
FRAMEOFF EQU   *                                                        10050002
         BAL   X14,MASKRTN         GO SET THE BIT IN WQE OFF            10100002
*/*%FRM01: P (,%FRM02) TURN ON OUT-OF-LINE DISP. PENDING BIT */         10200002
         OI    UCMSDS5,UCMSDS5C    TURN ON OUT-OF-LINE DISPLAY PENDING  10250002
*/*%FRM02: P (,BLDLINE) UPDATE FRAME NUMBER IN SACB */                  10300002
         IC    X2,DCMAFR+N1         LOAD FIRST DIGIT                    10350002
         SRDL  X2,N4               SHIFT OUT LOW NIBBLE                 10400002
         SR    X2,X2               CLEAR REG                            10450002
         SLDL  X2,N4               RESTORE LOW NIBBLE IN REG 2          10500002
         LA    X2,N1(X2)           BUMP NUMBER                          10550002
         C     X2,TEN              IS NUMBER = TO 10                    10600002
         BNL   NEXTBYTE            YES                                  10650002
         STC   X2,DCMAFR+N1        RESTORE NUMBER IN SACB               10700002
         OI    DCMAFR+N1,F0       RESTORE HIGH EBCDIC NIBBLE            10750002
         B     NORESET                                                  10800002
NEXTBYTE EQU   *                                                        10850002
         IC    X2,DCMAFR           LOAD SECOND DIGIT                    10900002
         SRDL  X2,N4               SHIFT OUT LOW NIBBLE                 10950002
         SR    X2,X2               CLEAR REG                            11000002
         SLDL  X2,N4               RESTORE LOW NIBBLE IN REG 2          11050002
         LA    X2,N1(X2)           BUMP NUMBER                          11100002
         C     X2,TEN              IS NUMBER = TO 10                    11150002
         BNL   ZEROIT              REACHED 99 VALUE                     11200002
         STC   X2,DCMAFR           RESTORE DIGIT                        11250002
         OI    DCMAFR,F0           RESTORE HIGH NIBBLE                  11300002
         B     RESETLOW                                                 11350002
ZEROIT   MVI   DCMAFR,F0           SET SECOND DIGIT TO ZERO             11400002
RESETLOW MVI   DCMAFR+N1,F0          SET FIRST DIGIT TO ZERO            11450002
NORESET  EQU   *                                                        11500002
         B     BLDLINE             GO BUILD LINE                        11550002
*                                                                       11600002
*********************************************************************** 11650002
         EJECT                                                          11700002
*/* E BLANKET */                                                        11750002
BLANKET  EQU   *                                                        11800002
*/*%BLNK01: P (,%BLNK02) BLANK ONE LINE                                 11850002
*/**/                                                                   11900002
* INPUT: REG X3 CONTAINS LENGTH TO BE BLANKED.                          11950002
* INPUT: REG X5 POINTS TO LINE OF DCM TO BE BLANKED.                    11960002
         MVI   N0(X5),BLANK        MOVE A BLANK CHAR                    12000002
         SH    X3,TWO              DECREMENT BY 2 (FOR MVI+EX)          12050002
         EX    X3,BLANKWRT         SPREAD BLANKS THROUGHOUT LINE        12100002
*/*%BLNK02: R RETURN TO CALLER */                                       12150002
         BR    XF                                                       12200002
SACBINIT EQU   *                                                        12250002
*/* E SACBINIT */                                                       12300002
*    SET UP SACB POINTERS                                               12350002
*/*%ACB1: P (,IDLOOP) LOAD SACB POINTER FROM RDCM */                    12400002
         L     SACBPT,DCMADSDS         LOAD SACB POINTER FROM RDCM      12450002
IDLOOP   EQU   *                                                        12500002
*/*IDLOOP: D (NO,ERROR,YES,%ACB2) VALID ADDRESS */                      12550002
         LTR   SACBPT,SACBPT       IS IT A VALID ADDR                   12600002
         BZ    ERROR               NO--GO BACK TO PROCESSOR 1           12650002
*/*%ACB2: D (YES,FOUNDID,NO,%ACB3) AREA ID'S MATCH */                   12700002
         CLC   KAID(N1),DCMAID    ARE AREA ID'S EQUAL                   12750002
         BE    FOUNDID            YES-                                  12800002
*/*%ACB3: P (,IDLOOP) LOAD NEXT SACB POINTER */                         12850002
         L     XD,N0(XD)          LOAD POINTER TO NEXT SACB             12900002
         B     IDLOOP                                                   12950002
FOUNDID  EQU   *                                                        13000002
*/*FOUNDID: R RETURN TO CALLER */                                       13050002
         BR    RETURN              RETURN TO CALLER                     13100002
*********************************************************************** 13150002
         EJECT                                                          13200002
BLDLINE  EQU   *                                                        13620002
*     THE FOLLOWING CODE BUILDS THE NEW CONTROL LINE IN THE DCM         13630002
*                                                                       13640002
*/*BLDLINE: P SET UP BYTE COUNT, LINE NO. FOR I/O */          MH  M2517 13642002
         MVC   DCMBYTCT(N2),DCMCORLN INDICATE WRITE 1 LINE    MH  M2517 13644002
         MVC   DCMLINEN(N1),DCMATOP INDIC. WRITE TOP LINE     MH  M2517 13646002
*/*%TESTSD: D (YES,%USESIB,NO,USEINSTR) CONSOLE USE = STATUS DISPLAY?   13648002
*/**/                                                                   13648402
         TM    UCMDISP,UCMDISPG    Q. STATUS DISPLAY CONSOLE  MF  M2057 13648802
         BNO   USEINSTR            NO, USE INSTRUCTION LINE   MF  M2057 13649202
* WRITE CONTROL LINE FROM SCREEN IMAGE BUFFER                 MF  M2057 13649602
*/*%USESIB: P (,IOPARM) INDICATE WRITE PARTIAL FROM SCREEN IMAGE BUFFER 13649702
*/**/                                                                   13649802
         SR    X5,X5               CLEAR REG                  MF  M2057 13649902
         IC    X5,DCMATOP          GET CONTROL LINE NUMBER    MF  M2057 13666602
         BCTR  X5,N0               SUBTRACT ONE               MF  M2057 13676602
         MH    X5,DCMCORLN         MULTIPLY BY LINE LENGTH    MF  M2057 13678602
         A     X5,DCMASCRN         ADD BEGINNING OF SCREEN    MF  M2057 13680602
*                                       IMAGE BUFFER          MF  M2057 13682602
         OI    DCMIOCM1,DCMWRPAR   INDICATE WRITE PARTIAL     MF  M2057 13683002
         B     MVCNTRL             GO SETUP CONTROL LINE      MH  M2517 13683102
USEINSTR EQU   *                                              MF  M2057 13683202
* WRITE CONTROL LINE FROM INSTRUCTION LINE                    MF  M2057 13688802
*/*USEINSTR: P INDICATE WRITE INFO DISPLAY FROM                         13690802
*/* INSTRUCTION LINE */                                                 13692802
         L     X5,DCMAINS          GET INSTRUCTION LINE ADDR  MF  M2057 13693202
         OI    DCMIOCM2,DCMWINFD   INDICATE WRITE INFO DISPLAYMF  M2057 13693602
*/*%P02: S (,%P03) BLANKET: BLANK LINE OF DCM FOR CONTROL LINE */       13694002
         LH    X3,DCMLGNTH         GET LENGTH OF A LINE       MF  M2057 13694102
         BAL   XF,BLANKET          GO BLANK LINE              MF  M2057 13694202
*/*%P03: P (,%BLD01) BASE CONTROL LINE DSECT */                         13694302
         USING DCONTROL,X5         BASE CONTROL LINE DSECT    MF  M2057 13708202
*/*%BLD01: D (YES,IMAGE,NO,%BLD02) TITLE LINE IN SCREEN IMAGE BUFFER */ 13950002
         TM    DCMADFLG,DCMACSIB       DYNAMIC DISPLAY CONTROL LINE     14000002
*              IN SRCEEN IMAGE BUFFER                                   14050002
         BO    IMAGE               YES -                                14100002
*/*%BLD02: P (,MVCNTRL) MOVE TITLE FROM WQE BLOCK */                    14150002
         SPACE 2                                                        14200002
         L     X4,DCMAMJWQ         LOAD CONSOLE OUTPUT Q PT             14250002
         L     MAJWQER,N0(X4)    LOAD MAJOR WQE ADDR                    14300002
         USING WMJM,MAJWQER         ESTABLISH MAJOR WQE BASE R          14350002
         LH    X3,WMJMTXTL          GET LENGTH OF TITLE                 14400002
         SH    X3,FIVE              DECREMENT BY 5                      14450002
         EX    X3,MVTITLE           MOVE TITLE TO LINE                  14500002
         B     DROPIT                                                   14550002
MVTITLE  MVC   TITLE(N0),WMJMTXT            CONTROL LINE TITLE MOVE     14600002
DROPIT   EQU   *                                                        14650002
         DROP  MAJWQER                                                  14700002
*/*MVCNTRL: P (,%BLD03) MOVE IN FIRST SET OF ASTERS AND FRAME NO. */    14750002
MVCNTRL  EQU   *                                                        14800002
         MVC   FRAME+N1(N5),CFRAME       MOVE FRAME WORD                14850002
         TM    DCMAFLG1,DCMADEND   Q. LAST FRAME ON SCREEN              14900002
         BO    LAST                YES- GO MOVE IN LAST                 14950002
         CLI   DCMAFR,CF0           Q. IS FIRST DIGIT OF FRAME          15000002
*                                     NUMBER ZERO                       15050002
         BE    ONEDIGIT            YES- BRANCH TO MOVE ONE DIGIT        15100002
         MVC   FRAME+N7(N2),DCMAFR  MOVE FRAME NUMBER INTO LINE         15150002
         B     BLD             GO BUILD LINE                            15200002
ONEDIGIT EQU   *                                                        15250002
         MVC   FRAME+N8(N1),DCMAFR+N1 MOVE ONLY ONE FRAME DIGIT IN      15300002
         B     BLD             GO BUILD LINE                            15350002
LAST     EQU   *                                                        15400002
         MVC   FRAME+N7(N4),CLAST                                       15450002
BLD      EQU   *                                                        15500002
         MVI   CNTRL2+N2,ASTERISK        PUT ASTERISK IN CONTROL 2      15550002
         MVI   CNTRL3+N2,ASTERISK        PUT ASTERISK IN CONTROL 2      15600002
*/*%BLD03: D (YES,CNTRLDD,NO,%BLD04) DYNAMIC DISPLAY */                 15650002
         TM    DCMADFLG,DCMADD    Q. DYNAMIC DISPLAY                    15700002
         BO    CNTRLDD             BR TO BUILD DYNAMIC LINE             15750002
*/*%BLD04: P (,MVAID) MOVE STATIC DISP. OPTIONS F AND E */              15800002
*    OPTIONS FOR STATIC DISPLAY ARE   *F   *E                           15850002
         MVI   CNTRL2+N3,FORWARD  PUT F OPT.   IN CONTROL 2             15900002
         MVI   CNTRL3+N3,ERASE    PUT E OPT.   IN CONTROL 3             15950002
         B     MVAID               BR TO MOVE IN AREA ID                16000002
CNTRLDD  EQU   *                                                        16050002
*/*CNTRLDD: D (YES,MVHOLD,NO,%BLD05) DYN. DISP. IN HOLD MODE */         16100002
         TM    DCMADFLG,DCMAHOLD   Q. DYNAMIC DISPLAY IN HOLD MODE      16150002
         BO    MVHOLD              BR TO MOVE HOLD OPTIONS              16200002
*    OPTIONS FOR DISPLAY IN UPDATE MODE ARE   *PT   *H                  16250002
*/*%BLD05: P (,MVAID) MOVE UPDATE OPTIONS PT AND H INTO LINE */         16300002
         MVI   CNTRL2+N3,PT1      PUT P OPT.   IN CONTROL 2             16350002
         MVI   CNTRL2+N4,PT2        PUT M OPT.   IN CONTROL 2           16400002
         MVI   CNTRL3+N3,HOLD     PUT H OPT.   IN CONTROL 2             16450002
         B     MVAID               BR TO MOVE IN AREA ID                16500002
*/*MVHOLD: P (,MVAID) MOVE HOLD MODE OPTIONS F AND U INTO LINE */       16550002
MVHOLD   EQU   *                                                        16600002
*    OPTIONS DYNAMIC SISPLAY IN HOLD MODE ARE   *F    *U                16650002
         MVI   CNTRL2+N3,FORWARD  PUT F OPT. IN CONTROL 2               16700002
         MVI   CNTRL2+N4,BLANK    MOVE IN BLANK               MH  M2517 16710002
         MVI   CNTRL3+N3,UPDATE   PUT U OPT.   IN CONTROL 2             16750002
MVAID    EQU   *                                                        16800002
*/*MVAID: P (,IODISP) CONVERT CONS. ID AND MOVE IT AND AREA ID INTO     16850002
*/*LINE */                                                              16900002
*   MOVE AREA ID IN -- CCA                                              16950002
*    THIS CODE WILL CONVERT HEX ID TO EBCDIC                            17000002
         SR    X4,X4               CLEAR REG                            17050002
         IC    X4,UCMID           GET CONSOLE ID (IN HEX)               17100002
         CVD   X4,DCMPACK         CONVERT TO PACKED DECIMAL             17150002
         UNPK  DCMPACK(N3),DCMPACK+N6(N2) UNPACK NUMBER                 17200002
         OI    DCMPACK+N2,CF0    FIX SIGN                               17250002
         CLI   DCMPACK+N1,CF0    IS FIRST DIGIT = TO ZERO               17300002
         BNE   MOVE               NO--                                  17350002
         MVI   DCMPACK+N1,BLANK  REPLACE ZERO WITH A BLANK              17400002
MOVE     EQU   *                                                        17450002
         MVC   AREAID+N1(N2),DCMPACK+N1 MOVE CC NO. TO CONTROL LINE     17500002
         MVC   AREAID+N3(N1),DCMAID MOVE AREA ID TO CONTROL LINE        17550002
         EJECT                                                          17600002
*********************************************************************** 17650002
IODISP   EQU   *                                                        17700002
*/*IODISP: P (,XCTL) INDICATE WRITE DISPLAY */                          17750002
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              17850002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     17860002
XCTL     EQU   *                                                        18050002
*/*XCTL: R RETURN */                                                    18100002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 18150002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             18200002
         SPACE 2                                                        18350002
*                                                                       18400002
*    THE FOLLOWING CODE MOVES CONTROL LINE TITLE FROM SCREEN IMAGE      18450002
IMAGE    EQU   *                                                        18500002
*/*IMAGE: P (,MVCNTRL) MOVE TITLE FROM SCREEN IMAGE BUFFER LINE */      18550002
         SR    X3,X3               CLEAR REG                            18600002
         IC    X3,DCMATOP          PICK UP TOP LINE NO.                 18650002
         BCTR  X3,N0               DECREMENT BY ONE                     18700002
         MH    X3,DCMCORLN       GET DISPLACE MENT INTO MSG AREA S21003 18750002
         A     X3,DCMASCRN         ADD MSG AREA START ADDR              18800002
         MVC   TITLE(L'TITLE),N0(X3) MOVE TITLE                         18850002
         B     MVCNTRL             CONTINUE                             18900002
*********************************************************************** 18950002
         EJECT                                                          19000002
*    THIS ROUTINE WILL TURN THE MAJOR WQE BIT OFF WHICH                 19050002
*    CORRESPONDS TO THE BIT NUMBER OF THE CONSOLE ID.                   19100002
*    TURNING THE BIT OFF WILL TELL OTHER ROUTINES TO DEQUEUE            19150002
*    THE WQE FROM THIS CONSOLE'S WQE OUTPUT QUEUE.                      19200002
*/* E MASKRTN */                                                        19250002
MASKRTN  EQU   *                                                        19300002
         L     X4,DCMAMJWQ         LOAD CONSOLE OUTPUT Q PT             19350002
*/*%MSK01: P (,%MSK02) LOAD OUTPUT QUEUE PT */                          19400002
         L     MAJWQER,N0(X4)    LOAD MAJOR WQE ADDR                    19450002
*/*%MSK02: P (,%MSK03) LOAD MAJOR WQE POINTER AND BASE IT */            19500002
         LA    MAJWQER,N0(MAJWQER) CLEAR HIGH BYTE                      19550002
         USING WMJM,MAJWQER        ESTABLISH MAJOR WQE BASE R           19600002
*/*%MSK03: P (,%MSK04) GET ADDR OF CONSOLE'S FRAME FULL DBL WRD */      19650002
         LA    FLDADR,WMJMCONS      GET CONSOLE'S  FRAME FULL BIT       19700002
         DROP  MAJWQER                                                  19750002
         SR    R4,R4              CLEAR REG                             19800002
         SR    R6,R6              CLEAR REG                             19850002
         IC    R6,UCMID           LOAD CONSOLE ID                       19900002
*/*%MSK04: P (,%MSK05) LOAD CONSOLE ID; LOAD 64 MAX. BIT NO. */         19950002
         LA    R3,N64             PRIME REG WITH MAXIMUM BIT NO.        20000002
*/*%MSK05: P (,%MSK06) SHIFT DOUBLE REG BY DIFFERENCE BET. MAX. BIT NO. 20050002
*/*AND CONS. ID */                                                      20100002
         LA    R5,N1              REG 5 = 1                             20150002
         SR    R3,R6              SUBTRACT ID BIT FROM MAXIMUM BIT NO.  20200002
*    NOTE: THIS DYNAMIC SHIFT INSTRUCTION SHIFTS REGS 4 AND 5 TO THE    20250002
*          LEFT BY THE NUMBER CONTAINED IN REG 3.                       20300002
         SLDL  R4,N0(R3)          SHIFT BIT BY REMAINDER IN REG 3       20350002
*/*%MSK06: D (YES,OK1,NO,NEXTREG) IS BIT IN FIRST 4 BYTES */            20400002
         N     R4,N0(FLDADR)      TEST FOR BIT IN FIELD 1               20450002
         BNZ   OK1                BRANCH IF FOUND TO BE ON              20500002
         N     R5,N4(FLDADR)      TEST FOR BIT IN FIELD 2               20550002
         BNZ   NEXTREG            BRANCH IF FOUND TO BE ON              20600002
NOTON    EQU   *                                                        20650002
         BR    RETURN              THE BIT IS NOT ON                    20700002
OK1      EQU   *                                                        20750002
*/*OK1: P (,%MSK07) TURN BIT OFF IN FIRST WORD */                       20800002
         ST    R4,DCMDSAV          STORE MASK                           20850002
         XC    N0(N4,FLDADR),DCMDSAV EXCLUSIVE OR BIT OFF               20900002
*/*%MSK07: R RETURN TO CALLER */                                        20950002
         BR    RETURN                                                   21000002
NEXTREG  EQU   *                                                        21050002
*/*NEXTREG: P (,%MSK07) TURN BIT OFF IN SECOND WORD */                  21100002
         ST    R5,DCMDSAV          STORE MASK                           21150002
         XC    N4(N4,FLDADR),DCMDSAV EXCLUSIVE OR BIT OFF               21200002
         BR    RETURN                                                   21250002
*                                                                       21300002
*********************************************************************** 21350002
         EJECT                                                          21400002
********************************************************************    21450002
*   EXECUTED INSTRUCTIONS                                               21500002
*                                                                       21550002
BLANKWRT MVC   N1(N0,X5),N0(X5) EXEC. FOR BLANKING WRITE AREA           21600002
*                                                                       21650002
********************************************************************    21700002
*       CONSTANTS                                                       21750002
********************************************************************    21800002
TEN      DC    F'10'               CONSTANT                             21850002
TWO      DC    H'2'                CONSTANT                             21900002
FOUR     DC    H'4'                CONSTANT                             21950002
FIVE     DC    H'5'                CONSTANT                             22000002
CLAST    DC    C'LAST'             LAST                                 22150002
KDF      DC    C'D,F '             CONSTANT FOR K D,F                   22200002
KDH      DC    C'D,H '             CONSTANT FOR K D,H                   22250002
KDU      DC    C'D,U '             CONSTANT FOR K D,U                   22300002
CFRAME   DC    C'FRAME'                                                 22450002
********************************************************************    22650002
         EJECT                                                          22700002
********************************************************************    22750002
*        DSECTS                                                         22800002
*    ALL DSECTS FOLLOW THIS POINT                                       22850002
*                                                                       22900002
DCONTROL DSECT                                                          22950002
* CONTROL LINE OF AN OUT OF LINE DISPLAY                                23000002
         DS    0XL74                                                    23050002
TITLE    DS    XL37                TITLE                                23100002
FRAME    DS    XL11                FRAME NUMBER                         23150002
CNTRL1   DS    XL7                 CONTROL CHARACTER 1                 X23200002
                                        (RESERVED FOR BACKWARD         X23250002
                                        FRAMING)                        23300002
ASTERISK EQU   C'*'                INDICATES DETECTABLE FIELD           23350002
CNTRL2   DS    XL8                 CONTROL CHARACTER 2                  23400002
FORWARD  EQU   C'F'                     FRAME FORWARD                   23450002
PT1      EQU   C'P'                     STOP                            23500002
PT2      EQU   C'T'                          TRACK                      23550002
CNTRL3   DS    XL7                 CONTROL CHARACTER 3                  23600002
ERASE    EQU   C'E'                     ERASE DISPLAY                   23650002
HOLD     EQU   C'H'                     HOLD DYNAMIC DISPLAY            23700002
UPDATE   EQU   C'U'                     UPDATE DYNAMIC DISPLAY          23750002
AREAID   DS    XL4                 AREA ID - CCA                        23800002
         EJECT                                                          23850002
         IEERDCM                                                        23900002
         EJECT                                                          24000002
         IHACTM  CXSA                                                   24250002
         EJECT                                                          24300002
         IEECUCM FORMAT=NEW                                             24400002
         EJECT                                                          24450002
         IEETDCM                                                        24500002
         EJECT                                                          24600002
KPARM    DSECT                                                          24650002
         IEECVMAP KPARAM                                                24700002
         EJECT                                                          24750002
         IHAWQE  DSECT=YES                                              24850002
*********************************************************************** 24900002
*/*IEECVFTN: END */                                                     24950002
         END                                                            25000002
./  ADD  SSI=70270974,NAME=IEECVFTO
         TITLE 'IEECVFTO -- STATUS DISPLAY INTERFACE 4'                 00100000
IEECVFTO CSECT                                                          00200000
         SPACE 2                                                        00500000
* THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM 21002, 00600000
*    OS RELEASE 21                                                      00700000
         SPACE 2                                                        00800000
*                                                                       00900000
* STATUS -- CHANGE LEVEL 0                                              01000000
*                                                                       01030000
* APARS FIXED --- ZA14992                                               01060000
*                                                                       01100000
* FUNCTION -- OUTPUT OF A DISPLAY WHICH OVERLAYS MESSAGES               01200000
*    1) MOVE 3 LINES AT A TIME OF A STATUS DISPLAY FROM THE             01300000
*    WQE'S INTO A WRITE AREA IN THE DISPLAY CONTROL MODULE (DCM),       01400000
*    FREE THE WQE'S, AND INDICATE TO THE I/O MODULES TO WRITE           01500000
*    THE DISPLAY TO THE SCREEN.                                         01600000
*    2) ON THE LAST FRAME OF A DISPLAY, BLANK THE REMAINDER OF          01700000
*    THE DISPLAY AREA ON THE SCREEN, 3 LINES AT A TIME.                 01800000
*                                                                       01900000
* ENTRY POINT -- IEECVFTO, FROM IEECVFTM                                02000000
*                                                                       02100000
* INPUT                                                                 02200000
*    1) REGISTER 1 - POINTER TO CXSA                                    02300000
*    2) REGISTER 7 - POINTER TO SACB                                    02400000
*                                                                       02500000
* OUTPUT                                                                02600000
*    1) REGISTER 1 - POINTER TO CXSA                                    02700000
*    2) WRITE AREA IN DCM SET UP FOR A WRITE INFORMATIONAL              02800000
*    DISPLAY BY THE I/O ROUTINE                                         02900000
*    3) FIELDS IN SACB AND SSCT TO REFLECT STATUS OF DISPLAY            03000000
*                                                                       03100000
* EXTERNAL REFERENCES -- NONE                                           03200000
*                                                                       03300000
* EXITS,NORMAL                                                          03400000
*    1) DEVICE DEPENDENT I/O MODULE                                     03500000
*                                                                       03600000
* EXITS,ERROR -- NONE                                                   03700000
*                                                                       03800000
* TABLES/WORK AREAS                                                     03900000
*    1) UNIT CONTROL MODULE - UCM                                       04000000
*    2) RESIDENT PORTION OF THE DISPLAY CONTROL MODULE - DCM            04100000
*    (INCLUDING SCREEN AREA CONTROL BLOCKS - SACB'S)                    04200000
*    3) TRANSIENT PORTION OF THE DISPLAY CONTROL MODULE                 04300000
*                                                                       04400000
* ATTRIBUTES -- REFRESHABLE, PRIVILEGED, TYPE 4 SVC                     04500000
*    DISABLED WHEN DECREMENTING USE COUNTS OF MINOR WQE'S               04600000
*                                                                       04700000
* CHARACTER CODE DEPENDENCY -- THE OPERATION OF THIS MODULE DOES        04800000
*    NOT DEPEND ON A PARTICULAR INTERNAL REPRESENTATION OF THE          04900000
*    EXTERNAL CHARACTER SET                                             05000000
*                                                                       05100000
         EJECT                                                          05200000
* REGISTER USAGE                                                        05300000
X1PARM   EQU   1                                                        05400000
XERTRN   EQU   14                                                       05500000
XFBRANCH EQU   15                                                       05600000
R0       EQU   0                   REG 0                                05700000
R1       EQU   1                   PARAMETER REGISTER                   05800000
WORKR    EQU   2                   WORK REG                             05900000
WORK1    EQU   3                   WORK REG                             06000000
EVEN     EQU   4                   WORK REG                             06100000
ODD      EQU   5                   WORK REG                             06200000
RDCMBASE EQU   6                   RESIDENT PORTION OF DCM BASE         06300000
SACBBASE EQU   7                   SCREEN AREA CONTROL BLOCK BASE       06400000
TDCMBASE EQU   8                   TRANSIENT PORTION OF DCM BASE        06500000
OUTQREG  EQU   9                   POINTER TO CONSOLE OUTPUT           X06600000
                                        QUEUE ENTRY                     06700000
UCMEBASE EQU   10                  UCM ENTRY BASE                       06800000
WQEBASE  EQU   11                  WQE BASE                             06900000
MYBASE   EQU   12                  BASE REGISTER FOR THIS MODULE        07000000
CXSABASE EQU   13                  CXSA BASE                            07100000
RETURNR  EQU   14                  RETURN REGISTER                      07200000
LINKR    EQU   14                  FIRST LEVEL LINK REG                 07300000
LINK1    EQU   15                  SECOND LEVEL LINK REGISTER           07400000
R15      EQU   15                                                       07500000
         EJECT                                                          07600000
* ESTABLISH ADDRESSABILITY                                              07700000
         SPACE 2                                                        07900000
         BALR  MYBASE,0                                                 08000000
         USING *,MYBASE            BASE THIS MODULE                     08100000
         B     BEGIN                                                    08200000
         DC    CL8'IEECVFTO'       MODULE NAME                 Y02958   08300000
         DC    CL8'&SYSDATE',CL56' '  DATE AND PATCH AREA      Y02958   08400000
BEGIN    EQU   *                                                        08500000
         LR    CXSABASE,R1         GET CXSA ADDRESS                     08600000
         USING CXSA,CXSABASE       BASE CXSA                            08700000
         L     UCMEBASE,CSAUCM     GET ADDRESS OF UCM ENTRY             08800000
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY                       08900000
         L     RDCMBASE,UCMXB      GET ADDRESS OF RESIDENT DCM          09000000
         USING DCMTSRT,RDCMBASE      BASE RESIDENT DCM                  09100000
         L     TDCMBASE,DCMADTRN   GET ADDRESS OF TRANSIENT DCM         09200000
         USING DCMSTRT,TDCMBASE      BASE TRANSIENT DCM                 09300000
*        SACBBASE IS PASSED FROM INTERFACE 2                            09400000
         USING DCMACB,SACBBASE     BASE SACB                            09500000
         USING WMJM,WQEBASE        BASE WQE'S                           09600000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      09700000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    09800000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      09900000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           10000000
         LR    X1PARM,CXSABASE     PASS  CXSA ADDRESS IN REG 1          10100000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         10200000
         SPACE 3                                                        10300000
* INITIALIZATION                                                        10400000
         SPACE 2                                                        10500000
         L     OUTQREG,DCMAMJWQ    GET POINTER TO CONSOLE OUTPUT       X10600000
                                        QUEUE ENTRY                     10700000
         USING CQE,OUTQREG         CONSOLE Q ADDRESSABILITY   MB Y02958 10800000
         XC    DCMBYTCT(E2),DCMBYTCT ZERO BYTE COUNT FOR OUTPUT         10900000
         EJECT                                                          11000000
         TM    DCMAFLG2,DCMARCON   Q. REWRITE CONTROL LINE              11200000
         BO    RCON                YES, BRANCH TO DO SO                 11300000
         TM    DCMAFLG1,DCMABL     Q. BLANK REST OF AREA                11500000
         BO    BLNKREST            YES, GO BLANK IT                     11600000
         TM    DCMAFLG2,DCMAWCON   Q. CONTROL LINE TO BE WRITTEN        11800000
         BNO   WRMIN               NO, BRANCH TO WRITE FROM            X11900000
                                        MINOR WQE'S                     12000000
         SPACE 2                                                        12100000
* PUT CONTROL LINE IN FIRST LINE OF WRITE AREA FIRST TIME THROUGH       12200000
         NI    DCMAFLG2,XFF-DCMAWCON TURN OFF WRITE CONTROL FLAG        12500000
         L     WORKR,DCMAINS       GET ADDRESS OF FIRST LINE OF        X12600000
                                        WRITE AREA (INSTRUCTION        X12700000
                                        LINE)                           12800000
         BAL   LINKR,BLDCNTRL      BUILD CONTROL LINE IN FIRST         X12900000
                                        LINE OF WRITE AREA              13000000
         SPACE                                                          13100000
*    INDICATE CONTROL LINE IN SSCT                                      13200000
         BAL   LINK1,FINDSSCT      GET SSCT ENTRY POINTER IN           X13400000
                                        WORKR                           13500000
         OI    E0(WORKR),DCMSECCL  INDICATE CONTROL LINE IN SSCT        13600000
         SPACE                                                          13700000
*    INCREMENT ROW IN SACB BY ONE                                       13800000
         BAL   LINK1,UPDTEROW      INCREMENT ROW NUMBER                 14000000
         SPACE                                                          14100000
         TM    WMJMLTYP,WMJMLTYD   Q. END INDICATED                     14300000
         BNO   TSTMIN              NO, LOOK FOR MINORS TO WRITE         14400000
         OI    DCMAFLG1,DCMADEND   INDICATE END IN SACB                 14500000
         B     END1                GO HANDLE END                        14600000
         DROP  WQEBASE                                                  14700000
         USING WMNM,WQEBASE         BASE WQE                            14800000
         SPACE                                                          14900000
TSTMIN   EQU   *                                                        15100000
         L     WQEBASE,DCMAMIN     GET POINTER TO NEXT MINOR TO        X15200000
                                        BE WRITTEN                      15300000
         LTR   WQEBASE,WQEBASE     ANY MINORS TO BE WRITTEN             15400000
         BZ    INFDEXIT            NO, OUTPUT CONTROL LINE              15500000
         B     LINE2               BRANCH TO FILL LINE 2 OF            X15600000
                                        WRITE AREA                      15700000
         EJECT                                                          15800000
WRMIN    EQU   *                                                        15900000
         MVC   DCMLINEN(E1),DCMAROW  INDICATE NEXT ROW TO              X16200000
                                        WRITE TO                        16300000
         L     WQEBASE,DCMAMIN     GET POINTER TO NEXT MINOR TO        X16400000
                                        BE WRITTEN                      16500000
         L     WORKR,DCMAINS       GET ADDRESS OF FIRST LINE OF        X16600000
                                        WRITE AREA (INSTRUCTION        X16700000
                                        LINE)                           16800000
         BAL   LINKR,MOVELINE      MOVE LINE INTO WRITE AREA            16900000
         SPACE 2                                                        17000000
LINE2    EQU   *                                                        17100000
         L     WQEBASE,DCMAMIN     GET POINTER TO NEXT MINOR TO        X17400000
                                        BE WRITTEN                      17500000
         L     WORKR,DCMAENTR      GET ADDRESS OF SECOND LINE OF       X17600000
                                        WRITE AREA (LINE 1 OF          X17700000
                                        ENTRY AREA)                     17800000
         BAL   LINKR,MOVELINE      MOVE LINE INTO WRITE AREA            17900000
         SPACE 2                                                        18000000
LINE3    EQU   *                                                        18100000
         L     WQEBASE,DCMAMIN     GET POINTER TO NEXT MINOR TO        X18400000
                                        BE WRITTEN                      18500000
         L     WORKR,DCMAENTR      GET ADDRESS OF ENTRY AREA            18600000
         AH    WORKR,DCMCORLN      ADD LENGTH OF A LINE TO GET         X18700000
                                        POINTER TO THIRD LINE OF       X18800000
                                        WRITE AREA                      18900000
*                                       (LINE 2 OF ENTRY AREA)          19000000
         BAL   LINKR,MOVELINE      MOVE LINE INTO WRITE AREA            19100000
         SPACE 2                                                        19200000
* WRITE AREA FULL                                                       19300000
*    AT THIS POINT THE WRITE AREA IS FULL AND THERE ARE MORE            19400000
* LINES OF THE DISPLAY ON THE QUEUE.  THE WRITE AREA IS OUTPUT          19500000
* AND CONTROL WILL BE RETURNED TO CONTINUE WRITING THE DISPLAY.         19600000
         SPACE                                                          19700000
         B     INFDEXIT            BRANCH TO ENABLE INTERRUPTS         X19800000
                                        AND EXIT TO I/O ROUTINE        X19900000
                                        TO WRITE 3 LINES                20000000
         EJECT                                                          20100000
*********************************************************************** 20200000
*                                                                     * 20300000
* MOVE LINE SUBROUTINE                                                * 20400000
*    MOVE TEXT FROM MINOR WQE TO INDICATED LINE OF WRITE AREA         * 20500000
* AND TAKE CARE OF ASSOCIATED HOUSEKEEPING.  FREE MINOR WQE.          * 20600000
*    INPUT - WORKR - POINTS TO LINE OF WRITE AREA                     * 20700000
*            WQEBASE - POINTS TO MINOR TO BE WRITTEN                  * 20800000
*            BASE REGS - SACBBASE, TDCMBASE, UCMEBASE, OUTQREG        * 20900000
*    OUTPUT - BIT SETTINGS IN SACB, SSCT                              * 21000000
*            LINE MOVED INTO WRITE AREA                               * 21100000
*            MINOR POINTER IN SACB                                    * 21200000
*            INCREMENTS DCMBYTCT BY LENGTH OF ONE LINE                * 21300000
*            UPDATES DCMAROW                                          * 21400000
*    EXITS - I/O MODULE IF ONE OF THE FOLLOWING:                      * 21500000
*              1) NO MINOR ON Q AFTER THE ONE JUST USED               * 21600000
*              2) FRAME FULL CONDITION IS REACHED                     * 21700000
*              3) END CONDITION IS FOUND (AND AT LEAST ONE LINE       * 21800000
*                 TO WRITE)                                           * 21900000
*            INTERFACE 2 - IF END IS FOUND AND ALL MINORS HAVE        * 22000000
*              ALREADY BEEN WRITTEN                                   * 22100000
*            RETURN - IF FRAME NOT FULL AND MORE MINORS ON QUEUE      * 22200000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 22300000
*                        WORKR,WORK1,LINK1                            * 22400000
*            LINKR - LINK REGISTER                                    * 22500000
*                                                                     * 22600000
*********************************************************************** 22700000
         SPACE 2                                                        22800000
MOVELINE EQU   *                                                        22900000
         CLI   WMNMTL1,E0          IS TEXT LENGTH ZERO                  23200000
         BNE   TEXT                NO, TEXT PRESENT - BRANCH            23300000
         TM    WMNMLT1,WMNMLT1D    Q. MINOR INDICATE END      MF        23400000
         BO    INDEND              YES, GO INDICATE END       MF        23500000
*     IF THE TEXT LENGTH IS ZERO AND THE MINOR DOES NOT       MF        23600000
*     INDICATE END, THEN THE MINOR IS STILL BEING BUILT AND   MF        23700000
*     MUST NOT BE USED.                                       MF        23800000
         NI    DCMAFLG2,XFF-DCMALMIN    TURN OFF LAST MINOR   MF       X23900000
                                        SAVED FLAG            MF        24000000
         B     INFDEXIT            EXIT                       MF        24100000
         SPACE                                                          24200000
TEXT     EQU   *                                                        24300000
*    MOVE TEXT FROM MINOR WQE TO WRITE AREA                             24400000
         BAL   LINK1,BLNKLINE      BLANK OUT LINE OF WRITE AREA         24600000
         SR    WORK1,WORK1         CLEAR REG                            24700000
         IC    WORK1,WMNMTL1       GET LENGTH OF TEXT                   24800000
         BCTR  WORK1,E0            DECREMENT BY ONE                     24900000
         EX    WORK1,MOVETEXT      MOVE TEXT FROM MINOR TO             X25000000
                                        WRITE AREA                      25100000
         B     SETSSCT             BRANCH TO SET SSCT FLAGS             25200000
MOVETEXT MVC   E0(E0,WORKR),WMNMTXT1  MOVE TEXT                         25300000
         SPACE 2                                                        25400000
SETSSCT  EQU   *                                                        25500000
*    INDICATE LABEL OR DATA LINE IN SSCT                                25600000
         BAL   LINK1,FINDSSCT      GET SSCT ENTRY POINTER IN           X25800000
                                        WORKR                           25900000
         NI    E0(WORKR),XFF-DCMSECBL   TURN OFF BLANK LINE FLAG        26000000
         TM    WMNMLT1,WMNMLT1B    Q. MINOR WQE FOR LABEL LINE          26100000
         BO    LABEL               YES, BRANCH TO INDICATE LABEL        26200000
         OI    E0(WORKR),DCMSECDL  INDICATE DATA LINE IN SSCT           26300000
         B     OVERLABL            BRANCH AROUND                        26400000
LABEL    EQU   *                                                        26500000
         OI    E0(WORKR),DCMSECLL  INDICATE LABEL LINE IN SSCT          26600000
OVERLABL EQU   *                                                        26700000
         SPACE 2                                                        26800000
*    INCREMENT ROW IN SACB BY ONE                                       27000000
         BAL   LINK1,UPDTEROW      INCREMENT ROW NUMBER AND SET        X27100000
                                        FLAG IF FULL FRAME              27200000
         SPACE 2                                                        27300000
*    ADD LENGTH OF ONE LINE TO BYTE COUNT FOR WRITE                     27400000
         LH    WORK1,DCMBYTCT      GET CURRENT BYTE COUNT               27500000
         AH    WORK1,DCMCORLN      ADD LENGTH OF ONE LINE               27600000
         STH   WORK1,DCMBYTCT      STORE BYTE COUNT                     27700000
         SPACE 2                                                        27800000
*    SAVE SOME INFORMATION BEFORE MINOR IS FREED                        27900000
         TM    WMNMLT1,WMNMLT1D    Q. MINOR INDICATE END                28200000
         BNO   SAVENEXT            NO, BRANCH TO SAVE ADDRESS          X28300000
                                        OF NEXT MINOR                   28400000
INDEND   EQU   *                                                        28500000
         OI    DCMAFLG1,DCMADEND   YES, INDICATE END OF DISPLAY         28700000
         B     FREEMIN             BRANCH TO FREE MINOR                 28800000
         SPACE 2                                                        28900000
SAVENEXT EQU   *                                                        29000000
*    TEST FOR MORE MINORS ON QUEUE AND SAVE POINTER TO MINOR            29100000
         L     WORK1,WMNMNX1-E1    GET POINTER TO NEXT MINOR            29300000
         LA    WORK1,E0(WORK1)     ZERO HIGH ORDER BYTE                 29400000
         LTR   WORK1,WORK1         Q. ANY MORE MINORS                   29500000
         BZ    NOMORMIN            NO, BRANCH TO SAVE POINTER          X29600000
                                        TO MINOR JUST USED              29700000
         NI    DCMAFLG2,N255-DCMALMIN TF LAST MIN PTR SAVED   @ZA14992  29800000
         ST    WORK1,DCMAMIN       SAVE POINTER TO NEXT MINOR           29900000
         B     FREEMIN             BRANCH TO FREE MINOR JUST           X30000000
                                        USED                            30100000
NOMORMIN EQU   *                                                        30200000
         OI    DCMAFLG2,DCMALMIN   INDICATE POINTER TO LAST            X30500000
                                        MINOR OUTPUT SAVED             X30600000
                                        (RATHER THAN NEXT ON Q)         30700000
         ST    WQEBASE,DCMAMIN     SAVE POINTER TO MINOR JUST          X30800000
                                        USED                            30900000
         SPACE 2                                                        31000000
FREEMIN  EQU   *                                                        31100000
*    FREE MINOR WQE                                                     31200000
         SR    WORK1,WORK1         CLEAR REG                            31400000
         IC    WORK1,WMNMUC1       GET USE COUNT FROM MINOR             31500000
         BCTR  WORK1,E0            DECREMENT USE COUNT BY ONE           31600000
         STC   WORK1,WMNMUC1       STORE NEW USE COUNT                  31700000
         LTR   WORK1,WORK1         Q. IS USE COUNT ZERO                 31800000
         BNZ   TESTEND             NO, BRANCH TO TEST FOR END           31900000
DEQ      EQU   *                                                        32000000
         OI    UCMSTS,UCMTB        INDICATE DEQUEUE WORK TO DO          32100000
         L     WORK1,CQEWQE        GET POINTER TO MAJOR WQE   MB Y02958 32200000
         DROP  WQEBASE              DROP OLD REG             Y02958     32300000
         USING WMJM,WORK1          BASE WQE                             32400000
         OI    WMJMMLW,WMJMMLWG    INDICATE IN MAJOR THAT MLWTO         32500000
*                                  CHAIN NEEDS SERVICING.               32600000
         DROP  WORK1                                                    32700000
         USING WMNM,WQEBASE        RESET BASE           Y02958          32800000
         SPACE 2                                                        32900000
TESTEND  EQU   *                                                        33000000
*     TEST FOR  END OF DISPLAY                                          33100000
         TM    DCMAFLG1,DCMADEND   Q. END OF DISPLAY FOUND              33300000
         BO    END1                YES, BRANCH TO HANDLE END            33400000
         SPACE                                                          33500000
*    TEST FOR FULL FRAME                                                33600000
         TM    DCMAFLG1,DCMAFULL   Q. FULL FRAME                        33800000
         BO    FRAMFUL1            YES, BRANCH TO HANDLE                33900000
         SPACE 2                                                        34000000
*    IF MORE MINORS ON Q, RETURN FROM SUBROUTINE, OTHERWISE             34100000
*    OUTPUT WHAT WE HAVE                                                34200000
         TM    DCMAFLG2,DCMALMIN   Q. POINTER TO LAST MINOR            X34400000
                                        SAVED (BECAUSE NO MORE         X34500000
                                        ON QUEUE)                       34600000
         BO    INFDEXIT            YES, OUTPUT WHAT WE HAVE             34700000
         BR    LINKR               MORE MINORS SO RETURN FROM          X34900000
                                        SUBROUTINE                      35000000
         EJECT                                                          35100000
FRAMFUL1 EQU   *                                                        35200000
* FRAME FULL                                                            35300000
         SPACE                                                          35400000
         BAL   LINK1,INDFRFL       INDICATE FRAME FULL IN MAJOR         35600000
         SPACE                                                          35700000
CONTFF   EQU   *                                                        35800000
         NI    DCMAFLG1,XFF-DCMAFRPR  TURN OFF FRAMING IN              X36000000
                                        PROGRESS FLAG                   36100000
         SPACE                                                          36200000
*    FIND FIRST LINE TO BE WRITTEN NEXT FRAME (FIRST DATA LINE)         36300000
         SR    WORK1,WORK1         CLEAR REG                            36600000
         IC    WORK1,DCMATOP       GET LINE NO. OF TOP LINE             36700000
         BCTR  WORK1,E0            SUBTRACT ONE                         36800000
         L     WORKR,DCMADSEC      GET ADDRESS OF SSCT                  36900000
         AR    WORKR,WORK1         WORKR NOW POINTS TO SSCT BYTE       X37000000
                                        FOR TOP LINE                    37100000
SRCHDATA EQU   *                                                        37200000
         LA    WORK1,E1(WORK1)     UPDATE LINE NO.                      37300000
         TM    E0(WORKR),DCMSECDL  Q. DATA LINE                         37400000
         BO    DATALFND            YES, SAVE LINE NO.                   37500000
         LA    WORKR,E1(WORKR)     POINT TO NEXT SSCT BYTE              37600000
         B     SRCHDATA            CONTINUE SEARCH (MUST ALWAYS        X37700000
                                        FIND ONE SINCE FRAME           X37800000
                                        FULL - AT LEAST 4 LINES-        37900000
*                                       CANNOT BE REACHED BY           X38000000
                                        CONTROL LINE AND 2 LABEL       X38100000
                                        LINES)                          38200000
DATALFND EQU   *                                                        38300000
         STC   WORK1,DCMAROW       STORE AS NEXT LINE TO BE            X38400000
                                        WRITTEN (NEXT FRAME)            38500000
         SPACE                                                          38600000
         B     INFDEXIT            EXIT TO I/O ROUTINE                  38700000
         EJECT                                                          38800000
END1     EQU   *                                                        38900000
* END OF DISPLAY FOUND                                                  39000000
         OI    DCMAFLG2,DCMARCON   INDICATE REWRITE CONTROL LINE        39200000
         TM    DCMAFLG1,DCMAFULL   Q. FRAME FULL                        39400000
         BO    TESTIO              YES, BRANCH TO TEST FOR I/O          39500000
         OI    DCMAFLG1,DCMABL     INDICATE IN SACB TO BLANK           X39700000
                                        REST OF AREA                    39800000
TESTIO   EQU   *                                                        39900000
         LH    WORK1,DCMBYTCT      GET BYTE COUNT FOR WRITE             40000000
         LTR   WORK1,WORK1         Q. BYTE COUNT ZERO                   40100000
         BZ    RCON                YES, NO I/O TO DO, SO BRANCH        X40200000
                                        TO REWRITE CONTROL LINE         40300000
         B     INFDEXIT            BRANCH TO ENABLE INTERRUPTS         X40400000
                                        AND EXIT TO I/O ROUTINE         40500000
         SPACE 5                                                        40600000
* END OF MOVELINE SUBROUTINE                                            40700000
         EJECT                                                          40800000
* BLANK REST OF AREA                                                    40900000
*    AFTER THE LAST (END) LINE OF THE DISPLAY HAS BEEN WRITTEN,         41000000
* THE REST OF THE LINES OF THE FRAME MUST BE BLANKED OUT.               41100000
         SPACE                                                          41200000
BLNKREST EQU   *                                                        41300000
         SPACE                                                          41400000
         MVC   DCMLINEN(E1),DCMAROW  INDICATE LINE TO WRITE TO          41700000
         L     WORKR,DCMAINS       GET ADDRESS OF FIRST LINE OF        X41800000
                                        WRITE AREA (INSTRUCTION        X41900000
                                        LINE)                           42000000
         BAL   LINKR,MOVEBLNK      MOVE BLANKS INTO LINE                42100000
         L     WORKR,DCMAENTR      GET ADDRESS OF SECOND LINE OF       X42400000
                                        WRITE AREA (LINE 1 OF          X42500000
                                        ENTRY AREA)                     42600000
         BAL   LINKR,MOVEBLNK      MOVE BLANKS INTO LINE                42700000
         L     WORKR,DCMAENTR      GET ADDRESS OF ENTRY AREA            43000000
         AH    WORKR,DCMCORLN      ADD LENGTH OF A LINE TO GET         X43100000
                                        POINTER TO THIRD LINE OF       X43200000
                                        WRITE AREA                      43300000
*                                       (LINE 2 OF ENTRY AREA)          43400000
         BAL   LINKR,MOVEBLNK      MOVE BLANKS INTO LINE                43500000
         SPACE                                                          43600000
*    AT THIS POINT THE WRITE AREA IS FULL OF BLANKS AND IS              43700000
* OUTPUT.                                                               43800000
         B     INFDEXIT            EXIT TO I/O ROUTINE TO OUTPUT       X43900000
                                        3 LINES OF BLANKS               44000000
         EJECT                                                          44100000
*********************************************************************** 44200000
*                                                                     * 44300000
* MOVE BLANK LINE INTO WRITE AREA                                     * 44400000
*    PARELLELS MOVE LINE SUBROUTINE BUT WRITES OUT BLANK LINES        * 44500000
* AT THE END OF THE LAST FRAME AND THEN FREES THE MAJOR WQE.          * 44600000
*    INPUT - WORKR - POINTS TO LINE OF WRITE AREA                     * 44700000
*            BASE REGS - SACBBASE, OUTQREG, TDCMBASE, UCMEBASE        * 44800000
*    OUTPUT - BLANK LINE IN WRITE AREA                                * 44900000
*            BIT SETTINGS IN SACB, SSCT                               * 45000000
*            INCREMENTS DCMBYTCT AND DCMAROW                          * 45100000
*    EXITS - I/O ROUTINE ON FULL FRAME                                * 45200000
*            RETURN WHEN NOT FULL FRAME                               * 45300000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 45400000
*                   LINK1, WORK1, WORKR                               * 45500000
*            LINKR - LINK REG                                         * 45600000
*                                                                     * 45700000
*********************************************************************** 45800000
         SPACE 2                                                        45900000
MOVEBLNK EQU   *                                                        46000000
         BAL   LINK1,BLNKLINE      BLANK OUT LINE OF WRITE AREA         46300000
         SPACE                                                          46400000
*    INDICATE BLANKED LINE IN SSCT                                      46500000
         BAL   LINK1,FINDSSCT      GET SSCT ENTRY POINTER IN           X46700000
                                        WORKR                           46800000
         OI    E0(WORKR),DCMSECBL  INDICATE BLANKED LINE IN SSCT        46900000
         SPACE                                                          47000000
*    INCREMENT ROW IN SACB BY ONE                                       47100000
         BAL   LINK1,UPDTEROW      INCREMENT ROW NO. AND SET           X47300000
                                        FLAG IF FULL FRAME              47400000
         SPACE                                                          47500000
*    ADD LENGTH OF ONE LINE TO BYTE COUNT FOR WRITE                     47600000
         LH    WORK1,DCMBYTCT      GET CURRENT BYTE COUNT               47700000
         AH    WORK1,DCMCORLN      ADD LENGTH OF ONE LINE               47800000
         STH   WORK1,DCMBYTCT      STORE BYTE COUNT                     47900000
         SPACE                                                          48000000
*    TEST FOR FRAME FULL                                                48100000
         TM    DCMAFLG1,DCMAFULL   Q. FULL FRAME                        48300000
         BNOR  LINKR               NO, RETURN FROM SUBROUTINE MB Y02958 48500000
         SPACE 2                                                        48600000
FRAMFUL2 EQU   *                                                        48700000
         NI    DCMAFLG1,XFF-DCMABL TURN OFF BLANK REST OF AREA         X48900000
                                        FLAG IN SACB                    49000000
FREEMAJ  EQU   *                                                        49100000
         NI    DCMAFLG1,XFF-DCMAFRPR  TURN OFF FRAMING IN              X49300000
                                        PROGRESS FLAG                   49400000
         SPACE                                                          49500000
         TM    DCMADFLG,DCMADD     Q. DYNAMIC DISPLAY                   49600000
         BO    ENDDD               YES, BRANCH TO HANDLE END OF        X49700000
                                        DYNAMIC DISPLAY                 49800000
         SPACE                                                          49900000
         OI    CQEFLAG,CQEAVAIL    INDICATE MAJOR WQE NO LONGER        X50100000
                                   NEEDED BY THIS CONSOLE     MB Y02958 50200000
         NI    CQEFLAG,XFF-CQEENTR TURN OFF ENTRY FLAG        MB Y02958 50300000
         OI    UCMSTS,UCMTB        INDICATE DEQUEUE WORK NEEDED         50400000
         OI    DCMAFLG2,DCMAMJFR   INDICATE MAJOR FREED                 50500000
         SPACE                                                          50600000
         B     INFDEXIT            EXIT TO I/O ROUTINE                  50700000
         SPACE 2                                                        50800000
ENDDD    EQU   *                                                        50900000
*      SINCE THIS MODULE HAS CONTROL AT THIS POINT, THE CONTROL         51000000
*    LINE IS NOT IN THE SCREEN IMAGE BUFFER AND THE MAJOR WQE           51100000
*    MUST BE SAVED FOR POSSIBLE USE BY K D,H OR K D,U TO REBUILD        51200000
*    THE CONTROL LINE.  THE FRAME FULL BIT IN THE MAJOR WQE IS          51300000
*    TURNED ON SO THAT INTERFACE 2 WILL IGNORE THE MAJOR WHILE          51400000
*    IT REMAINS ON THE QUEUE.                                           51500000
         BAL   LINK1,INDFRFL       TURN ON FRAME FULL BIT               51600000
         B     INFDEXIT            EXIT TO I/O ROUTINE                  51700000
         SPACE 2                                                        51800000
* END OF MOVEBLNK SUBROUTINE                                            51900000
         EJECT                                                          52000000
RCON     EQU   *                                                        52100000
* REWRITE CONTROL LINE                                                  52200000
         NI    DCMAFLG2,XFF-DCMARCON  TURN REWRITE FLAG OFF             52400000
         L     WORKR,DCMAINS       GET ADDRESS OF FIRST LINE OF        X52700000
                                        WRITE AREA (INSTRUCTION)       X52800000
                                        LINE)                           52900000
         BAL   LINKR,BLDCNTRL      BUILD CONTROL LINE IN FIRST         X53000000
                                        LINE OF WRITE AREA,             53100000
*                                       INDICATE WRITE ONE LINE,       X53200000
                                        INDICATE WRITE TO TOP          X53300000
                                        LINE OF AREA                    53400000
         TM    DCMAFLG1,DCMABL     Q. REENTRY REQUIRED TO BLANK        X53700000
                                        REST OF AREA                    53800000
         BO    INFDEXIT            YES, EXIT TO I/O ROUTINE             53900000
         B     FREEMAJ             NO, FREE MAJOR WQE                   54000000
         EJECT                                                          54100000
*********************************************************************** 54200000
*                                                                     * 54300000
* UPDATE ROW NUMBER                                                   * 54400000
*    THIS ROUTINE INCREMENTS THE NEXT ROW TO WRITE FIELD OF THE       * 54500000
* SACB AND TESTS FOR A FULL FRAME                                     * 54600000
*    INPUT - NONE OTHER THAN CONTROL BLOCKS AND BASE REGS             * 54700000
*    OUTPUT - DCMAROW - INCREMENTED BY ONE                            * 54800000
*             DCMAFLG1 - DCMAFULL FLAG IS TURNED ON IF UPDATED        * 54900000
*                        ROW NUMBER IS OUTSIDE AREA                   * 55000000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 55100000
*                        WORKR, WORK1                                 * 55200000
*              LINK1 - LINK REGISTER                                  * 55300000
*                                                                     * 55400000
*********************************************************************** 55500000
         SPACE 2                                                        55600000
UPDTEROW EQU   *                                                        55700000
*    INCREMENT ROW IN SACB BY ONE                                       55800000
         SR    WORK1,WORK1         CLEAR REG                            55900000
         IC    WORK1,DCMAROW       GET CURRENT ROW                      56000000
         LA    WORK1,E1(WORK1)     INCREMENT BY ONE                     56100000
         STC   WORK1,DCMAROW       STORE IN SACB                        56200000
         SPACE                                                          56300000
*    TEST FOR FULL FRAME                                                56400000
         SR    WORKR,WORKR         CLEAR REG                            56500000
         IC    WORKR,DCMATOP       GET NO. OF TOP ROW OF AREA           56600000
         AH    WORKR,DCMALN        ADD LENGTH OF AREA                  X56700000
                                        WORKR NOW CONTAINS NO.         X56800000
                                        OF FIRST ROW BELOW AREA.        56900000
*                                       WORK1 STILL CONTAINS           X57000000
                                        NO. OF NEXT ROW TO BE          X57100000
                                        WRITTEN                         57200000
         CR    WORK1,WORKR         Q. INSIDE AREA             MF        57300000
         BNER  LINK1               YES, RETURN FROM SUBROUTIN MB Y02958 57400000
         SPACE                                                          57500000
FRAMFUL3 EQU   *                                                        57600000
         OI    DCMAFLG1,DCMAFULL   INDICATE FULL FRAME                  57700000
         BR    LINK1               RETURN FROM SUBROUTINE               57800000
     EJECT                                                              57900000
*********************************************************************** 58000000
*                                                                     * 58100000
* INDICATE FRAME FULL IN MAJOR WQE                                    * 58200000
*    THE FRAME FULL BIT INDICATES TO THE QUEUEING ROUTINE THAT        * 58300000
* EVEN IF MORE MINOR WQE'S ARE QUEUED, OUT OF LINE OUTPUT SHOULD      * 58400000
* NOT BE INDICATED SINCE NO MORE CAN BE DISPLAYED.  IT ALSO           * 58500000
* CAUSES THE MAJOR WQE TO BE IGNORED BY INTERFACE 2 SINCE NO          * 58600000
* MORE OF THE DISPLAY CAN BE OUTPUT.                                  * 58700000
*    THE ALGORITHM MANIPULATES THE CONSOLE ID TO FIND THE             * 58800000
* CORRESPONDING BIT POSITION IN THE DOUBLE WORD FRAME FULL            * 58900000
* FIELD.                                                              * 59000000
*    INPUT - NONE OTHER THAN CONTROL BLOCKS AND BASE REGS             * 59100000
*    OUTPUT - FRAME FULL BIT TURNED ON IN MAJOR WQE                   * 59200000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 59300000
*                        WORKR, WORK1,ODD,EVEN,WQEBASE                * 59400000
*              LINK1 - LINK REGISTER                                  * 59500000
*                                                                     * 59600000
*********************************************************************** 59700000
         SPACE 2                                                        59800000
INDFRFL  EQU   *                                                        59900000
         SR    WORK1,WORK1         CLEAR REG                            60000000
         IC    WORK1,UCMID         GET CONSOLE ID                       60100000
         BCTR  WORK1,E0            REDUCE FOR ALGORITHM                 60200000
         SR    WORKR,WORKR         CLEAR REG                            60300000
         LA    ODD,E8              GET DIVISOR                          60400000
         DR    WORKR,ODD           DIVIDE ID                            60500000
*                                  WORKR IS BIT IN BYTE                 60600000
*                                  WORK1 IS BYTE IN FIELD               60700000
         LA    EVEN,E1             GET BIT                              60800000
         SRDL  EVEN,E25(WORKR)     CREATE MASK                          60900000
         DROP  WQEBASE                                                  61000000
         USING WMJM,WQEBASE        BASE WQE                             61100000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR WQE   MB Y02958 61200000
         LA    EVEN,WMJMCONS(WORK1) POINT TO FRAME FULL BITS     Y02958 61300000
         EX    ODD,INDFF           INDICATE FRAME FULL                  61400000
         BR    LINK1               RETURN FROM INDFRFL SUBROUTINE       61500000
         SPACE                                                          61600000
INDFF    OI    E0(EVEN),E0         INDICATE FRAME FULL                  61700000
         EJECT                                                          61800000
*********************************************************************** 61900000
*                                                                     * 62000000
* BUILD CONTROL LINE SUBROUTINE                                       * 62100000
*    THIS ROUTINE BUILDS THE CONTROL LINE IN THE DCM LINE             * 62200000
* INDICATED, INDICATES WRITE TO THE TOP LINE OF THE AREA, AND         * 62300000
* INDICATES WRITE ONE LINE.                                           * 62400000
*    INPUT - WORKR - POINTS TO THE DCM LINE IN WHICH THE CONTROL      * 62500000
*                   LINE IS TO BE BUILT                               * 62600000
*            BASE REGISTERS FOR MAJOR WQE, SACB, TDCM                 * 62700000
*    OUTPUT - CONTROL LINE BUILT WHERE INDICATED                      * 62800000
*            SETS FIELDS DCMBYTCT, DCMLINEN                           * 62900000
*    REGISTER USAGE - LINKR - LINK REGISTER                           * 63000000
*            DESTROYS CONTENTS OF FOLLOWING REGS: WORK1               * 63100000
*                                                                     * 63200000
*********************************************************************** 63300000
         SPACE 2                                                        63400000
BLDCNTRL EQU   *                                                        63500000
         MVC   DCMBYTCT(E2),DCMCORLN  INDICATE WRITE ONE LINE           63600000
         MVC   DCMLINEN(E1),DCMATOP  INDICATE WRITE TO TOP LINE        X63700000
                                        OF AREA                         63800000
         BAL   LINK1,BLNKLINE      BLANK OUT LINE IN WHICH             X63900000
                                        CONTROL LINE IS TO BE          X64000000
                                        BUILT                           64100000
         USING DCONTROL,WORKR      BASE CONTROL LINE DSECT              64200000
         L     WQEBASE,CQEWQE      BASE MAJOR WQE   MB Y02958           64300000
         LH    WORK1,WMJMTXTL      GET LENGTH OF TITLE                  64400000
         SH    WORK1,C5            SUBTRACT 4 FOR MLWTO ID AND         X64500000
                                        1 FOR EXECUTE                   64600000
         EX    WORK1,MOVTITLE      MOVE TITLE INTO CONTROL LINE         64700000
         SPACE                                                          64800000
MOVFRAME EQU   *                                                        64900000
         MVC   FRAME+E1(L'CFRAME),CFRAME  MOVE 'FRAME' IN               65000000
         TM    DCMAFLG1,DCMADEND   Q. LAST FRAME ON SCREEN              65100000
         BO    LAST                YES, BRANCH TO MOVE IN 'LAST'        65200000
         CLI   DCMAFR,F0           Q. IS FIRST DIGIT OF FRAME          X65300000
                                        NUMBER ZERO                     65400000
         BE    ONEDIGIT            YES, BRANCH TO MOVE ONE DIGIT        65500000
         MVC   FRAME+E7(E2),DCMAFR MOVE 2-DIGIT FRAME NUMBER IN         65600000
         B     MVCNTRL             BRANCH TO MOVE CONTROL CHAR          65700000
ONEDIGIT EQU   *                                                        65800000
         MVC   FRAME+E8(E1),DCMAFR+E1 MOVE 1-DIGIT FRAME NO. IN         65900000
         B     MVCNTRL             BRANCH TO MOVE CONTROL CHAR          66000000
LAST     EQU   *                                                        66100000
         MVC   FRAME+E7(L'CLAST),CLAST  MOVE 'LAST' IN                  66200000
         SPACE 2                                                        66300000
MVCNTRL  EQU   *                                                        66400000
         MVI   CNTRL2+E2,ASTERISK  PUT ASTERISK IN CONTROL 2            66500000
         MVI   CNTRL3+E2,ASTERISK  PUT ASTERISK IN CONTROL 3            66600000
         TM    DCMADFLG,DCMADD     Q. DYNAMIC DISPLAY                   66700000
         BO    CNTRLDD             BRANCH TO BUILD DYNAMIC             X66800000
                                        CONTROL CHARACTERS              66900000
*    STATIC DISPLAY -- MOVE IN 'F' AND 'E'                              67000000
         MVI   CNTRL2+E3,FORWARD   MOVE IN 'F' FOR FRAME FORWARD        67100000
         MVI   CNTRL3+E3,ERASE     MOVE IN 'E' FOR ERASE                67200000
         B     MVAID               BRANCH TO MOVE IN AREA ID            67300000
         SPACE                                                          67400000
CNTRLDD  EQU   *                                                        67500000
         TM    DCMADFLG,DCMAHOLD   Q. DYNAMIC DISPLAY IN               X67600000
                                        HOLD MODE                       67700000
         BO    MVHOLD              BRANCH TO MOVE HOLD OPTIONS          67800000
         SPACE                                                          67900000
*    DYNAMIC DISPLAY IN UPDATE MODE -- MOVE IN 'PT' AND 'H'   MB Y02958 68000000
         MVI   CNTRL2+E3,PT1       MOVE IN 'PT'               MB Y02958 68100000
         MVI   CNTRL2+E4,PT2            FOR STOPTR            MB Y02958 68200000
         MVI   CNTRL3+E3,HOLD      MOVE IN 'H' FOR HOLD                 68300000
         B     MVAID               BRANCH TO MOVE IN AREA ID            68400000
         SPACE                                                          68500000
MVHOLD   EQU   *                                                        68600000
*    DYNAMIC DISPLAY IN HOLD MODE -- MOVE IN 'F' AND 'U'                68700000
         MVI   CNTRL2+E3,FORWARD   MOVE IN 'F' FOR FRAME FORWARD        68800000
         MVI   CNTRL3+E3,UPDATE    MOVE IN 'U' FOR UPDATE               68900000
         SPACE 2                                                        69000000
MVAID    EQU   *                                                        69100000
* MOVE AREA ID IN -- CCA                                                69200000
*    GET CONSOLE ID -CC- AND CONVERT TO EBCDIC                          69300000
         SR    WORK1,WORK1         CLEAR REG                            69400000
         IC    WORK1,UCMID         GET CONSOLE ID                       69500000
         CVD   WORK1,DCMPACK       CONVERT IT TO DECIMAL                69600000
         UNPK  DCMPACK(E3),DCMPACK+E6(E2)  UNPACK IT                    69700000
         MVC   AREAID+E1(E2),DCMPACK+E1  MOVE IN THE CONSOLE ID         69800000
         OI    AREAID+E2,F0        CONVERT SIGN TO ZONE                 69900000
         CLI   AREAID+E1,F0        IS FIRST DIGIT ZERO                  70000000
         BNE   GETAID              NO, GET AREA ID                      70100000
         MVI   AREAID+E1,BLANK     YES, BLANK OUT ZERO                  70200000
GETAID   EQU   *                                                        70300000
*    GET AREA ID                                                        70400000
         MVC   AREAID+E3(E1),DCMAID  MOVE AREA ID IN                    70500000
         SPACE 2                                                        70600000
* RETURN FROM SUBROUTINE                                                70700000
         BR    LINKR               RETURN FROM SUBROUTINE               70800000
         SPACE 2                                                        70900000
* EXECUTED INSTRUCTION                                                  71000000
MOVTITLE MVC   TITLE(E0),WMJMTXT   MOVE TITLE INTO CONTROL LINE         71100000
         SPACE 2                                                        71200000
         DROP  WORKR                                                    71300000
         EJECT                                                          71400000
*********************************************************************** 71500000
*                                                                     * 71600000
* FINDSSCT SUBROUTINE                                                 * 71700000
*    COMPUTES ADDRESS OF SECONDARY SCREEN CONTROL TABLE (SSCT)        * 71800000
* ENTRY FOR LINE POINTED TO BY DCMAROW.                               * 71900000
*    INPUT - DCMAROW                                                  * 72000000
*            TDCMBASE                                                 * 72100000
*    OUTPUT- WORKR - POINTER TO SSCT ENTRY                            * 72200000
*    REGISTER USAGE - WORKR - REGISTER FOR OUTPUT                     * 72300000
*            LINK1 - LINK REGISTER                                    * 72400000
*                                                                     * 72500000
*********************************************************************** 72600000
         SPACE 2                                                        72700000
FINDSSCT EQU   *                                                        72800000
         SR    WORKR,WORKR         CLEAR REG                            72900000
         IC    WORKR,DCMAROW       GET LINE NUMBER                      73000000
         BCTR  WORKR,E0            SUBTRACT ONE                         73100000
         A     WORKR,DCMADSEC      ADD ADDRESS OF BEGINNING OF         X73200000
                                        SSCT                            73300000
         BR    LINK1                                                    73400000
         EJECT                                                          73500000
*********************************************************************** 73600000
*                                                                     * 73700000
* BLANK LINE                                                          * 73800000
*    THIS ROUTINE BLANKS ONE LINE OF THE SCREEN IMAGE BUFFER IN       * 73900000
* THE DCM                                                             * 74000000
*    INPUT - WORKR - ADDRESS OF LINE TO BE BLANKED                    * 74100000
*    OUTPUT - BLANKED LINE                                            * 74200000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 74300000
*                        WORK1                                        * 74400000
*             LINK1 - LINK REGISTER                                   * 74500000
*                                                                     * 74600000
*********************************************************************** 74700000
BLNKLINE EQU   *                                                        74800000
         MVI   E0(WORKR),BLANK     MOVE IN ONE BLANK                    74900000
         LH    WORK1,DCMLGNTH      GET LENGTH OF LINE                   75000000
         SH    WORK1,C2            DECREMENT LENGTH BY 2                75100000
         EX    WORK1,PROP          PROPAGATE BLANK                      75200000
         BR    LINK1               RETURN FROM SUBROUTINE               75300000
PROP     MVC   E1(E0,WORKR),E0(WORKR)  PROPAGATE CHARACTER              75400000
         EJECT                                                          75500000
*                             EXITS                                     75600000
         SPACE 2                                                        75700000
INFDEXIT EQU   *                                                        75800000
         OI    DCMIOCM2,DCMWINFD   INDICATE WRITE INFORMATIONAL        X76000000
                                        DISPLAY                         76100000
IOEXIT   EQU   *                                                        76200000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              76400000
         SPACE 2                                                        76500000
XCTL     EQU   *                                                        76600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 76700000
         BR    XFBRANCH            EXIT TO IEECVET(H,P,R, OR U)         76800000
         EJECT                                                          76900000
*********************************************************************** 77000000
*                                                                     * 77100000
*                             CONSTANTS                               * 77200000
*                                                                     * 77300000
*********************************************************************** 77400000
         SPACE 2                                                        77500000
C2       DC    H'2'                CONSTANT                             77600000
C5       DC    H'5'                CONSTANT                             77700000
CFRAME   DC    CL5'FRAME'          FRAME                                77800000
CLAST    DC    CL4'LAST'           LAST                                 77900000
         EJECT                                                          78000000
*********************************************************************** 78100000
*                                                                     * 78200000
*                             EQUATES                                 * 78300000
*                                                                     * 78400000
*********************************************************************** 78500000
         SPACE 2                                                        78600000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            78700000
ID2      EQU   C'O'                2ND CHARACTER OF CSECT ID            78800000
E0       EQU   0                   NUMBER                               78900000
E1       EQU   1                   NUMBER                               79000000
E2       EQU   2                   NUMBER                               79100000
E3       EQU   3                   NUMBER                               79200000
E4       EQU   4                   NUMBER                               79300000
E6       EQU   6                   NUMBER                               79400000
E8       EQU   8                   NUMBER                               79500000
E20      EQU   20                  NUMBER                               79600000
E25      EQU   25                  NUMBER                               79700000
E7       EQU   7                   NUMBER                               79800000
         SPACE                                                          79900000
Z        EQU   C'Z'                MSG STREAM AREA ID                   80000000
BLANK    EQU   C' '                BLANK                                80100000
F0       EQU   C'0'                EBCDIC 0                             80200000
F1       EQU   C'1'                EBCDIC 1                             80300000
XFF      EQU   X'FF'               TO TURN OFF BITS                     80400000
N255     EQU   255                                                      80450000
         SPACE                                                          80500000
* DESCRIPTOR CODES                                                      80600000
DC8      EQU   X'01'               OUT OF LINE CANDIDATE                80700000
DC9      EQU   X'80'               INFORMATION REQUESTED BY            X80800000
                                        DISPLAY OR MONITOR              80900000
         EJECT                                                          81000000
DCONTROL DSECT                                                          81100000
* CONTROL LINE OF AN OUT OF LINE DISPLAY                                81200000
         DS    0XL74                                                    81300000
TITLE    DS    XL37                TITLE                                81400000
FRAME    DS    XL11                FRAME NUMBER                         81500000
CNTRL1   DS    XL7                 CONTROL CHARACTER 1                 X81600000
                                        (RESERVED FOR BACKWARD         X81700000
                                        FRAMING)                        81800000
ASTERISK EQU   C'*'                INDICATES DETECTABLE FIELD           81900000
CNTRL2   DS    XL8                 CONTROL CHARACTER 2                  82000000
FORWARD  EQU   C'F'                     FRAME FORWARD                   82100000
PT1      EQU   C'P'                     STOP                            82200000
PT2      EQU   C'T'                          TRACK            MB Y02958 82300000
CNTRL3   DS    XL7                 CONTROL CHARACTER 3                  82400000
ERASE    EQU   C'E'                     ERASE DISPLAY                   82500000
HOLD     EQU   C'H'                     HOLD DYNAMIC DISPLAY            82600000
UPDATE   EQU   C'U'                     UPDATE DYNAMIC DISPLAY          82700000
AREAID   DS    XL4                 AREA ID - CCA                        82800000
         EJECT                                                          82900000
         IHACTM  CXSA                                                   83000000
         EJECT                                                          83100000
         IHACTM CQE                                           MB Y02958 83200000
         EJECT                                                          83300000
         IEECUCM FORMAT=NEW                                             83400000
         EJECT                                                          83500000
         IHAWQE  DSECT=YES                                              83600000
         EJECT                                                          83700000
         IEERDCM                                                        83800000
         EJECT                                                          83900000
         IEETDCM                                                        84000000
         EJECT                                                          84100000
         END                                                            84200000
./  ADD  SSI=70270975,NAME=IEECVFTP
IEECVFTP CSECT                                                          00100000
*A 118600,125100                                              MB YM2416 00200000
*    THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM     00400000
*    21002, OS RELEASE 21.                                              00500000
         TITLE 'IEECVFTP - K E,D AND PT A COMMANDS'                     00900000
*********************************************************************** 01000000
*                                                                     * 01100000
* STATUS                                                              * 01200000
*    CHANGE LEVEL=0                                                   * 01300000
*                                                                     * 01400000
* APARS FIXED --- ZA14992                                             * 01430000
*                                                                     * 01460000
* FUNCTION                                                            * 01500000
*    TO HANDLE CONTROL (K) COMMANDS AFFECTING OUT-OF-LINE STATUS      * 01600000
*    DISPLAYS. ( K E,D AND PM A.)                                     * 01700000
*    TO INDICATE IN THE SSCT THAT ALL LINES BELOW A DISPLAY HAVE      * 01800000
*    BEEN APPROPRIATELY BLANKED.                                      * 01900000
*                                                                     * 02000000
* ENTRY POINT                                                         * 02100000
*    IEECVFTP (CSECT NAME)                                            * 02200000
*                                                                     * 02300000
* INPUT                                                               * 02400000
*    REG 1 POINTS TO CXSA WHICH POINTS TO DCM  WHICH CONTAINS INDI-   * 02500000
*    CATORS.                                                          * 02600000
*    K COMMAND PARAMETER LIST POINTED TO IN THE DCM                   * 02700000
*    DCMADOPN POINTS TO OPERAND(S) IN PARAMETER LIST                  * 02800000
*                                                                     * 02900000
* OUTPUT                                                              * 03000000
*    BIT SETTINGS IN DCM AND SACB FOR OTHER ROUTINES TO ANALYZE AND   * 03100000
*    BLANKED DISPLAY OR WRITE UNVIEABLE MESSAGES TO SCREEN            * 03200000
*                                                                     * 03300000
* EXTERNAL REFERENCES                                                 * 03400000
*                                                                     * 03500000
* EXITS,NORMAL                                                        * 03600000
*    I/O RTN    (DEVICE-DEPENDENT) TO ERASE A STATUS DISPLAY          * 03700000
*    OR BLANK OUT MESSAGE AREAS BETWEEN  OR BELOW STATUS DISPLAYS.    * 03800000
*                                                                     * 03900000
* EXITS,ERROR                                                         * 04000000
*    TO PROCCESOR 1 UPON INCORRECT COMMAND INPUT                      * 04100000
*                                                                     * 04200000
* ATTRIBUTES                                                          * 04300000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC                              * 04400000
*                                                                     * 04500000
* TABLES/WORK AREAS                                                   * 04600000
*    UCM, DCM,CXSA, WQE, SACB                                         * 04700000
*                                                                     * 04800000
*                                                                     * 04900000
*********************************************************************** 05000000
         EJECT                                                          05100000
*********************************************************************** 05200000
*    REGISTERS                                                          05300000
*                                                                       05400000
********************************************************************    05500000
X1PARM   EQU   1                                                        05600000
XERTRN   EQU   14                                                       05700000
XFBRANCH EQU   15                                                       05800000
XF       EQU   15                  WORK REG                             05900000
X14      EQU   14                  RETURN REG                           06000000
RETURN   EQU   14                  RETURN REG                           06100000
XD       EQU   13                  WORK REG                             06200000
SACBPT   EQU   13                  SACB BASE REG                        06300000
XC       EQU   12                  THIS RTN'S BASE REG                  06400000
XB       EQU   11                  CXSA BASE REG                        06500000
XA       EQU   10                  UCM BASE REG                         06600000
X9       EQU   9                   TRANSIENT DCM BASE REG               06700000
XRDCM    EQU   8                   RESIDENT DCM BASE REG                06800000
LIST     EQU   7                   UCMLIST BASE REG                     06900000
X6       EQU   6                   WORK REG                             07000000
PARMREG  EQU   2                   PARAMETER LIST BASE REG              07100000
WQEBASE  EQU   4                   WQE BASE REG                         07200000
OUTQREG  EQU   1                   POINTER TO CONSOLE OUTPUT           X07300000
                                        QUEUE ENTRY                     07400000
X5       EQU   5                   WORK REG                             07500000
X4       EQU   4                   WORK REG                             07600000
X3       EQU   3                   WORK REG                             07700000
X1       EQU   1                   WORK REG                             07800000
X0       EQU   0                   WORK REG                             07900000
         EJECT                                                          08000000
********************************************************************    08100000
*     EQUATES                                                           08200000
********************************************************************    08300000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            08400000
ID2      EQU   C'P'                2ND CHARACTER OF CSECT ID            08500000
HEXTWO   EQU   X'02'               NO LONGER NEEDED BIT IN SUB Q        08600000
VALIDOFF EQU   255-1               VALID ENTRY BIT MASK-TO TURN OFF     08700000
TOPCHAIN EQU   X'10'               USE TOP MINOR ON CHAIN               08800000
E2       EQU   X'E2'                                                    08900000
ZERO     EQU   X'00'                                                    09000000
BLANK    EQU   X'40'                                                    09100000
N0       EQU   0                                                        09200000
N1       EQU   1                                                        09300000
N2       EQU   2                                                        09400000
N3       EQU   3                                                        09500000
N4       EQU   4                                                        09600000
N8       EQU   8                                                        09700000
NA       EQU   10                                                       09800000
NB       EQU   11                  FIELD INCREMENT                      09900000
NC       EQU   12                  FIELD INCREMENT                      10000000
ND       EQU   13                  FIELD INCREMENT                      10100000
N255     EQU   255                                                      10200000
NOMORE   EQU   8                                                        10300000
NOTTOPSW EQU   X'01'               NOT TOP DISPLAY SWITCH FLAG BIT      10400000
ONLYONE  EQU   X'02'               WORK ON 1 DISPLAY AREA ONLY          10500000
         EJECT                                                          10600000
********************************************************************    10700000
*                                                                       10800000
*    ESTABLISH ADDRESSABILITY                                           10900000
*                                                                       11000000
********************************************************************    11100000
         SPACE 2                                                        11300000
         BALR  XC,N0               ESTABLISH ROUTINE'S                  11500000
         USING *,XC                BASE REGISTER                        11600000
         B     BEGIN               BRANCH AROUND PATCH AREA             11700000
ICATCH   DC    CL8'IEECVFTP'      EYECATCHER AND FIELD MAINTENANCE      11800000
         DC    CL8'&SYSDATE',CL56' ' DATE AND PATCH AREA       Y02958   11900000
BEGIN    EQU   *                   END OF PATCH AREA                    12000000
         LR    XB,X1               ESTABLISH CXSA                       12100000
         USING CXSA,XB             ADDRESSABILITY                       12200000
         L     XA,CSACTLM          ESTABLISH UCM ADDRESS                12300000
         USING UCM,XA              ADDRESSABILITY                       12400000
         L     LIST,CSAUCM         LOAD UCM ENTRY ADDRESS               12500000
         USING UCMLIST,LIST        ESTABLISH UCM ENTRY  ADDRESSABILITY  12600000
         L     XRDCM,UCMXB            GET POINTER TO RESIDENT DCM       12700000
         USING DCMTSRT,XRDCM          ESTABLISH RDCM BASE REG           12800000
         L     X9,DCMADTRN        LOAD TRANSIENT DCM PT                 12900000
         USING DCMSTRT,X9           ESTABLISH TDCM BASE REG             13000000
         USING WMNM,WQEBASE        BASE WQE'S                           13100000
         USING DCMACB,SACBPT       SACB BASE REG                        13200000
         USING KPARM,PARMREG       ESTABLISH PARAMETER BASE REG         13300000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      13400000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    13500000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      13600000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           13700000
         LR    X1PARM,XB           PASS CXSA ADDRESS IN REG 1           13800000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         13900000
*                                                                       14000000
         EJECT                                                          14100000
*********************************************************************** 14200000
*    TEST IF BLANKING IS IN PROCESS                                     14300000
*                                                                       14400000
********************************************************************    14500000
         TM    DCMCOM2,DCMCMIN5    Q. RETURN  FROM I/O COMPLETE         14700000
         BO    BLANKRTN            YES-MORE BLANKING WORK TO DO         14800000
         SR    X0,X0               CLEAR REG                            14900000
         ST    X0,DCMDSAV+NC       INIT. SWITCH FIELDS TO 0             15000000
*                                                                       15100000
         TM    DCMCOM2,DCMCBLNK    N0--IS BLANKING FUNCTION REQUIRED    15300000
         BO    START               YES-GO CHECK WHAT'S TO BE BLANKED    15400000
********************************************************************    15500000
*                                                                       15600000
*    ANALYZE COMMAND                                                    15700000
         SPACE 2                                                        15900000
         L     PARMREG,DCMADOPN    LOAD PT TO OPERAND(S)                16000000
         SH    PARMREG,FOUR        DECREMENT POINTER BY FOUR            16100000
SACBINIT EQU   *                                                        16200000
         L     SACBPT,DCMADSDS         LOAD SACB POINTER FROM RDCM      16400000
         MVC   DCMDSAV(N4),DCMWTINT INIT. PT TO INSTRUCTION LINE        16500000
IDLOOP   EQU   *                                                        16700000
         LTR   SACBPT,SACBPT       IS IT A VALID ADDR                   16800000
         BZ    ERROR               NO--GO BACK TO PROCESSOR 1           16900000
         CLC   KAID(N1),DCMAID    ARE AREA ID'S EQUAL                   17100000
         BE    FOUNDID            YES-                                  17200000
         TM    DCMAFLG1,DCMADISP   IS A DISPLAY IN AREA                 17400000
         BNO   SKIPSAVE            NO - DONT SAVE THIS PT               17500000
         SR    X3,X3               CLEAR REG                            17700000
         IC    X3,DCMATOP          GET TOP LINE NO.                     17800000
         BCTR  X3,N0               DECREMENT BY 1                       17900000
         MH    X3,DCMCORLN         MULTIPLY BY LENGTH OF LINE           18000000
         A     X3,DCMASCRN         ADD START OF SCREEN IMAGE BUFF. ADDR 18100000
         ST    X3,DCMDSAV      SAVE ADDR OF SCREEN IMAGE BUFF. TOP LINE 18200000
         MVC   DCMDSAV+ND(N1),DCMAID SAVE NEXT LOWER AREA ID FOR LATER  18300000
SKIPSAVE EQU   *                                                        18400000
         L     XD,N0(XD)          LOAD POINTER TO NEXT SACB             18600000
         B     IDLOOP                                                   18700000
*                                                                       18800000
FOUNDID  EQU   *                                                        19000000
         MVC   DCMLINEN(N1),DCMATOP SAVE TOP LINE NO. FOR I/O RTN       19100000
*                                                                       19200000
********************************************************************    19300000
*                                                                       19400000
         TM    KFLGS,KPT           IS PT BIT ON                         19600000
         BO    PMARTN              YES-                                 19700000
         CLC   KOPN(N4),KED        IS COMMAND K E,D                     19900000
         BE    KEDRTN              YES-GO ERASE DISPLAY                 20000000
*                                                                       20100000
********************************************************************    20200000
*                                                                       20300000
*    IF NONE OF ABOVE, IT IS AN ERROR THAT SHOULD NEVER HAPPEN.         20400000
*    GO BACK TO PROCESSOR 1 SO THAT IT CAN CONTINUE PROCESSING          20500000
*    WITHOUT CAUSING POSSIBLE SYSTEM FAILURE.                           20600000
ERROR    EQU   *                                                        20800000
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  20900000
         B     XCTL            EXIT TO IEECVET1                         21000000
*                                                                       21100000
PMARTN   EQU   *                                                        21300000
*    PM A LOGIC FREES THE DYNAMIC DISPLAY AREA BY PROCESSING            21400000
*    AS FOR K E,D,                                                      21500000
*    EXCEPT TO TURN SCREEN FULL BIT OFF IN THE DCM.                     21600000
         NI    DCMR2FLG,N255-DCMRXSFL  TURN OFF SCREEN FULL BIT         21700000
         TM    DCMAFLG1,DCMADISP   Q.DISPLAY IN AREA                    21800000
         BO    KEDRTN              YES,GO ERASE DISPLAY                 21900000
*     IF THERE IS NO DISPLAY IN THE AREA, THE PM COMMAND                22000000
*     MUST HAVE BEEN ISSUED BEFORE THE FIRST DISPLAY WAS BUILT          22100000
         XC    DCMAROW(DCMCLRLN),DCMAROW     CLEAN UP SACB ONLY         22200000
         B     ERROR               GO TO PROCESSOR 1                    22300000
         EJECT                                                          22400000
KEDRTN   EQU   *                                                        22500000
*    ON A K E,D COMMAND--THE MAJOR AND MINOR WQE'S ARE FREED FROM THIS  22600000
*    CONSOLE'S OUTPUT QUEUE.                                            22700000
*    THE MODULE THEN XCTL'S TO  THE BLANKING RTN TO ERASE THE           22800000
*    DISPLAY FROM THE SCREEN IF IT IS NOT THE TOP DISPLAY.              22900000
*    IF IT IS THE TOP DISPLAY, THIS MODULE XCTL'S TO THE I/O RTN        23000000
*    TO WRITE OUT ANY MESSAGES THAT ARE UNDER THE DISPLAY, AND/ OR      23100000
*    TO BLANK THE DISPLAY LINES VISIBLE ON THE SCREEN.                  23200000
*                                                                       23300000
         L     OUTQREG,DCMAMJWQ    GET POINTER TO OUTPUT Q ENTRY        23500000
         USING CQE,OUTQREG         CONSOLE Q ADDRESSABILITY  Y02958     23600000
         TM    DCMAFLG2,DCMAMJFR   IS MAJOR FREED                       23700000
         BO    ERASING             YES - SKIP FREEING                   23800000
         TM    DCMAFLG1,DCMADEND   IS END OF DISPLAY ON SCREEN          24000000
         BO    FREEMAJ            YES, MINORS ALREADY FREED             24100000
         BAL   X14,FINDNEXT        GET POINTER TO NEXT MINOR            24400000
         LTR   WQEBASE,WQEBASE     ANY MORE MINORS                      24500000
         BZ    FREEMAJ             NO, GO FREE MAJOR                    24600000
         SPACE                                                          24700000
*    DECREMENT USE COUNTS OF ALL MINORS NOT OUTPUT                      24800000
FREEMIN  EQU   *                                                        24900000
         SR    X5,X5               CLEAR REG                            25000000
         IC    X5,WMNMUC1          GET USE COUNT FROM MINOR             25100000
         BCTR  X5,N0               DECREMENT USE COUNT BY 1             25200000
         STC   X5,WMNMUC1          STORE NEW USE COUNT                  25300000
         L     WQEBASE,WMNMNX1-N1  GET ADDRESS OF NEXT MINOR            25400000
         LA    WQEBASE,N0(WQEBASE) CLEAR HIGH ORDER BYTE                25500000
         LTR   WQEBASE,WQEBASE     ANY MORE MINORS ON Q                 25600000
         BNZ   FREEMIN             YES, BRANCH TO CONTINUE             X25700000
                                        DECREMENTING USE COUNTS         25800000
         SPACE                                                          25900000
FREEMAJ  EQU   *                                                        26200000
         OI    CQEFLAG,CQEAVAIL  SET NO LONGER NEEDED BIT IN    Y02958 X26300000
                                        SUBQ ELEMENT FLAG BYTE          26400000
         NI    CQEFLAG,N255-CQEENTR  TURN VALID ENTRY BIT OFF   Y02958  26500000
         OI    UCMSTS,UCMTB        SET DEQUEUE BIT ON IN UCME           26600000
********************************************************************    26700000
         EJECT                                                          26800000
ERASING  EQU   *                                                        26900000
         NI    DCMCOM3,N255-DCMCMIN7    TURN OFF INT 7 BLANK FLAG       27100000
         SR    X3,X3               CLEAR REG                            27200000
         IC    X3,DCMLINEN         LOAD LINE NO.                        27300000
*    REG 3 NOW HAS TOP ROW LINE NUMBER                                  27400000
         BCTR  X3,N0               SUBTR. 1 FOR 1-BASE TABLE            27500000
         STC   X3,DCMDSAV+NB       SAVE TOP LINE NO.                    27600000
         A     X3,DCMADSEC         ADD START OF SSCT ADDR TO ROW NUMBER 27700000
         LR    X6,X3               SAVE SSCT ADDRESS FOR NEXT LOOP      27800000
         LH    X5,DCMALN           PICK UP SACB LENGTH                  27900000
         LR    X4,X5               SAVE IT FOR LATER                    28000000
         STH   X4,DCMDSAV+N8       SAVE TOTAL LINE COUNT FOR BLANKING   28100000
         CLC   DCMTOPDS(N1),DCMAID IS THIS TOP DISPLAY                  28300000
         BE    LOOP             YES - DON'T SET FLAG BIT ON             28400000
         MVI   DCMDSAV+NC,NOTTOPSW SET SWITCH FLAG BIT ON               28600000
*                                    IF NOT TOP DISPLAY                 28700000
LOOP     EQU   *                                                        28900000
         TM    N0(X3),DCMSECST     Q. END OF SSCT OR BLANKED LINE       29000000
         BO    CHECKIT1            YES-                                 29100000
         TM    DCMDSAV+NC,NOTTOPSW THIS TOP DISPLAY                     29300000
         BNO   NOTTP               YES - ZERO OUT SCCT CONTROL BYTE     29400000
         MVI   N0(X3),DCMSECBL     TURN ON BLANKED BIT INTO SSCT BYTE   29500000
         B     BMP                 SKIP AROUND                          29600000
NOTTP    EQU   *                                                        29700000
         MVI   N0(X3),ZERO         NO-TURN OFF DISPLAY BITS IN SSCT     29800000
BMP      EQU   *                                                        29900000
         LA    X3,N1(X3)           BUMP SSCT POINTER                    30000000
         BCT   X5,LOOP         DECREMENT LENGTH COUNTER                 30200000
CHECKIT1 EQU   *                                                        30300000
         XC    DCMAROW(DCMCLRLN),DCMAROW CLEAR AREA WITH ZEROS          30500000
         SPACE 2                                                        30600000
*    ALL SSCT INDICATORS FOR THIS DISPLAY HAVE BEEN RESET,              30700000
*    PRIME ALL TABLE POINTERS FOR MESSAGE COUNTING RTN.                 30800000
         SR    X3,X3               CLEAR REG                            30900000
         IC    X3,DCMDSAV+NB       LOAD TOP LINE NO. OF DISP.           31000000
         LR    XF,X3               LOAD DISPLACEMENT NUMBER             31100000
         MH    XF,DCMCORLN         GET START ADDR IN MSG AREA           31200000
         A     XF,DCMASCRN         ADD START OF MSG AREA ADDR           31300000
         MH    X3,DCMSCTCN         DOUBLE THE NUMBER                    31400000
         A     X3,DCMAMTAB         ADD ADDR OF SCT TABLE                31500000
         TM    DCMDSAV+NC,NOTTOPSW THIS TOP DISPLAY                     31700000
         BO    NOTTOP             NO - DON'T CHANGE AREA ID OR WTBUF    31800000
* NOTE: IF NOT THE TOP DISPLAY, IT WILL BE BLANKED 3 LINES AT A TIME    31900000
*                                                                       32000000
********************************************************************    32100000
         EJECT                                                          32200000
         L     SACBPT,DCMDSAV      RESTORE PT TO PREVIOUS BLOCK         32400000
         CL    SACBPT,DCMWTINT      DOES A PREVIOUS BLOCK EXIST         32600000
         BE    SWTEST              NO -                                 32700000
         MVC   DCMTOPDS(N1),DCMDSAV+ND MOVEAREA ID BELOW THIS ONE       32900000
         B     NOSTDISP                                                 33000000
SWTEST   EQU   *                                                        33200000
         MVI   DCMTOPDS,ZERO       REINIT BYTE TO SAY NO DISPLAYS       33300000
* NOTE: IF NO DISPLAY EXISTS, THE ADDRESS OF THE INSTRUCTION LINE IS PT 33400000
NOSTDISP EQU   *                                                        33500000
         ST    SACBPT,DCMWTBUF     UPDATE TO REFLECT NEW STATUS ADDR    33700000
* NOTE: REG 6 CONTAINS ADDRESS OF TOP SSCT LINE OF DISPLAY              33900000
* NOTE2: REGS 0 AND 5 CONTAIN ZEROS                                     34000000
LOOP2    EQU   *                                                        34200000
         TM    N0(X3),DCMMSGIN    Q. MSG IN LINE                        34300000
         BO    OUTX               YES COUNT                             34400000
         AH    X0,ONE              ADD 1 TO BLANK LINE COUNT            34500000
         B     OUTBLK              ADD TO PTS                           34600000
OUTX     EQU   *                                                        34700000
         LA    X5,N1(X5)          BUMP REAL-MSG COUNTER                 34900000
         AH    XF,DCMCORLN         BUMP MSG AREA POINTER                35000000
OUTBLK   EQU   *                                                        35200000
         LA    X3,N2(X3)          BUMP SCT POINTER                      35300000
         LA    X6,N1(X6)           BUMP SSCT POINTER                    35400000
         TM    N0(X3),DCMMSGST    Q. END OF SCT TABLE                   35600000
         BO    OUT                STOP COUNT                            35700000
         BCT   X4,LOOP2            DECREMENT LINE COUNTER               35900000
         TM    DCMDSAV+NC,ONLYONE  WORK ON ONE AREA ONLY                36100000
         BO    OUT                 YES - DONT SEARCH MSGS FURTHER       36200000
         TM    N0(X6),E2     DISPLAY LINE                               36400000
         BNZ   OUT                STOP COUNTING                         36500000
         MVI   N0(X6),ZERO         CLEAN SSCT BYTE                      36600000
         LH    X4,ONE              PRIME REG                            36700000
         B     LOOP2               NO - CONT. TO ADD TO COUNTER         36800000
OUT      EQU   *                                                        37000000
         LR    X4,X0               PRIME BLANK LINE COUNTER             37100000
         AR    X0,X5               TOTAL LINE NUMBER FOR I/O AND SAVE   37200000
         LTR   X4,X4               ANY BLANKING TO DO                   37300000
         BZ    OUT2              NO - DO INLINE MSGS ONLY               37400000
         LR    X5,XF               LOAD ADDR OF MSG AREA SAVED ABOVE    37500000
         LR    X6,X3               SET UP NEW SCT POINTER               37600000
         SR    X6,X4               DECREMENT SCT POINTER TO FIRST LINE  37700000
         SR    X6,X4               DECREMENT AGAIN FOR SECOND BYTE      37800000
         LR    X3,X4               PRIME LOOP CONTROL REG               37900000
LOOPBLNK EQU   *                                                        38000000
         LH    X4,ONE              PRIME LINE COUNTER WITH ONE          38100000
         BAL   XF,BLANKET         BLANK AREA                            38300000
         NI    N0(X6),N255-DCMMSGJK TURN OFF JUNK LINE BIT              38400000
         LA    X6,N2(X6)           BUMP SCT POINTER                     38500000
         AH    X5,DCMCORLN         BUMP MESSAGE AREA POINTER            38600000
         BCT   X3,LOOPBLNK       DECREMENT COUNT AND LOOP IF NOT ZERO   38700000
OUT2     EQU   *                                                        38800000
         TM    DCMDSAV+NC,NOTTOPSW Q. WORKING ON TOP DISPLAY  MF        39000000
         BO    BYT                 NOT TOP DISPLAY - BRANCH   MF        39100000
*                                       AROUND RESETTING      MF        39200000
*                                       WARNING LINE          MF        39300000
         TM    N0(X6),DCMMSGIN     WAS A MESSAGE FOLLOWING IN MSG AREA  39500000
         BO    BYT                 YES - DON'T RESET WARNING LINE       39600000
         TM    DCMR2FLG,DCMRXUNV   Q. IS UNVIEW. MSG ON SCREEN          39800000
         BNO   BYT            NO - SKIP                                 39900000
         TM    DCMR2FLG,DCMRXSFL   YES - IS SCREEN FULL BIT ON          40100000
         BO    BYT            YES - SKIP                                40200000
         OI    DCMIOCM2,DCMBLWRR   BLANK RIT HALF OF WRN. LINE BIT ON   40400000
         OI    DCMIOCM1,DCMWRWRN   TURN ON WRITE WRN. LINE              40500000
BYT      EQU   *                                                        40700000
         MH    X0,DCMCORLN        MULT. COUNT BY NO. OF BYTES/LINE      40800000
         STH   X0,DCMBYTCT        SAVE FOR IO  RTN                      40900000
OUT3     EQU   *                                                        41100000
         OI    DCMIOCM1,DCMWRPAR   INDICATE WRITE PARTIAL MSG AREA      41200000
         B     IOEXIT             GO WRITE MSGS AND/OR BLANK LINES      41300000
*                                                                       41400000
********************************************************************    41500000
         EJECT                                                          41600000
********************************************************************    41700000
COMPREG  EQU   *                                                        41800000
         MVC   DCMLINEN(N1),DCMDSAV+NA MOVE TOP LINE NO.                42000000
         CH    X4,THREE            Q. MORE THAN 3 LINES TO BLANK        42100000
         BH    SAVECNT             YES-                                 42200000
         LTR   X4,X4               ANY LINES TO BLANK                   42400000
         BZ    ERROR                YES - END PROCESS                   42500000
         XC    DCMDSAV+N8(N2),DCMDSAV+N8  SET COUNTER TO NO LINES       42600000
CONTCNT  EQU   *                                                        42700000
         LR    X3,X4               SAVE NO. OF LINES                    42900000
         MH    X4,DCMCORLN         MULT. LINES BY LENGTH                43000000
         STH   X4,DCMBYTCT         SAVE BYTE COUNT FOR I/O RTN          43100000
         LH    X4,ONE              DO FIRST LINE OF BLANKS              43200000
         L     X5,DCMAINS          SET POINTER TO INSTRUCTION LINE      43300000
         BAL   XF,BLANKET          GO BLANK WRITE AREA                  43400000
         LR    X4,X3               RESTORE LINE COUNT                   43500000
         BCTR  X4,N0           DECREMENT FOR THE ONE JUST DONE          43600000
         LTR   X4,X4               ANY MORE TO BLANK                    43700000
         BNP   IODISP2             NO - STOP PROCESS OF BLANKING        43800000
         L     X5,DCMAENTR         LOAD ENTRY AREA                      43900000
         BAL   XF,BLANKET          GO BLANK WRITE AREA                  44000000
         B     IODISP2             GO TO I/O RTN TO WRITE OUT LINES     44100000
BLANKET  EQU   *                                                        44300000
         MH    X4,DCMLGNTH         MULT. LINE CNT BY LINE LENGTH        44500000
         MVI   N0(X5),BLANK        MOVE A BLANK CHAR                    44600000
         SH    X4,TWO              DECREMENT BY 2                       44700000
         EX    X4,BLANKWRT         SPREAD BLANKS THROUGHOUT LINE        44800000
         BR    XF                                                       45000000
SAVECNT  EQU   *                                                        45100000
         OI    DCMCOM2,DCMCMIN5    INDICATE RETURN TO THIS RTN          45300000
         SH    X4,THREE           DECREMENT LINE COUNT BY 3             45400000
         STH   X4,DCMDSAV+N8       SAVE LINE COUNT STILL TO BE DONE     45500000
         LH    X4,THREE            PRIME LINE COUNT                     45600000
         SR    X3,X3               CLEAR REG                            45700000
         IC    X3,DCMDSAV+NA       LOAD LINE NO.                        45800000
         AR    X3,X4               BUMP LINE NO. COUNT BY 3             45900000
         STC   X3,DCMDSAV+NA       SAVE FOR LATER                       46000000
         B     CONTCNT             GO BLANK LINES                       46100000
*                                                                       46200000
********************************************************************    46300000
         EJECT                                                          46400000
* NOTE: IF NOT TOP DISPLAY K E,D'D, THEN JUST BLANK IT                  46500000
*     IF THERE ARE NO MESSAGES IN THE MESSAGE AREA UNDER THE            46600000
*     DISPLAY, BLANKING WILL BE DONE USING THE MESSAGE AREA AND         46700000
*     A PARTIAL WRITE.  ELSE, LINES WILL BE BLANKED USING THE INSTR-    46800000
*     UCTION LINE AND ENTRY AREA, DOING I/O 3 LINES AT A TIME.          46900000
NOTTOP   EQU   *                                                        47000000
         OI    DCMDSAV+NC,ONLYONE  TURN ON ONE AREA SWITCH              47200000
         TM    N0(X3),DCMMSGIN    Q. MSG IN LINE                        47400000
         BNO   LOOP2              NO- GO BLANK FROM MSG AREA            47500000
         MVC   DCMDSAV+NA(N1),DCMLINEN SAVE TOP LINE NUMBER             47700000
         XC    DCMDSAV(N4),DCMDSAV SET WORD INDICATING BLANK ONLY       47800000
BLANKRTN EQU   *                                                        47900000
         NI    DCMCOM2,N255-DCMCMIN5 TURN BIT OFF                       48200000
         SR    X4,X4               CLEAR REG                            48300000
         LH    X4,DCMDSAV+N8       PICK UP LINES STILL TO BLANK         48400000
         B     COMPREG                                                  48500000
*                                                                       48600000
*                                                                       48700000
********************************************************************    48800000
         EJECT                                                          48900000
FINDNEXT EQU   *                                                        49100000
*FIND NEXT MINOR TO BE OUTPUT SO THAT FREEING WILL START THERE          49200000
         TM    CQEFLAG,CQEATTOP  SHOULD MINOR SEARCH BEGIN       Y02958X49400000
                                        AT TOP OF CHAIN                 49500000
         BO    GETFIRST            YES, BRANCH TO GET FIRST MINOR       49600000
         L     WQEBASE,DCMAMIN     GET MINOR POINTER SAVED              49700000
         TM    DCMAFLG2,DCMALMIN   Q. LAST MINOR OUTPUT SAVED           49800000
         BO    GETNEXT             YES, BRANCH TO GET NEXT MINOR        49900000
         LTR   WQEBASE,WQEBASE     Q. ZERO POINTER SAVED                50000000
         BZ    MINPTR0             YES, BRANCH TO HANDLE                50100000
         BR    X14                 RETURN WITH POINTER SAVED TO        X50200000
                                        NEXT MINOR                      50300000
         DROP  WQEBASE                                                  50400000
         USING WMJM,WQEBASE         BASE WQE                            50500000
         SPACE                                                          50600000
MINPTR0  EQU   *                                                        50700000
         L     WQEBASE,CQEWQE GET POINTER TO MAJOR WQE         Y02958   50800000
         TM    WMJMMLW,WMJMMLWH    Q. NULL MINOR ON QUEUE               50900000
         BNO   GETFIRST            NO, GET POINTER TO FIRST            X51000000
                                        MINOR                           51100000
         SR    WQEBASE,WQEBASE     INDICATE NO MINOR WAITING TO        X51200000
                                        BE OUTPUT                       51300000
         BR    X14                 RETURN                               51400000
         SPACE                                                          51500000
GETFIRST EQU   *                                                        51600000
         L     WQEBASE,CQEWQE GET POINTER TO MAJOR               Y02958 51700000
         L     WQEBASE,WMJMMIN     GET POINTER TO FIRST MINOR           51800000
         NI    CQEFLAG,N255-CQEATTOP TURN OFF TOP OF CHAIN       Y02958X51900000
                                        FLAG                            52000000
         NI    DCMAFLG2,N255-DCMALMIN TURN OFF LAST MINOR FLAG @ZA14992 52030000
         XC    DCMAMIN(X4),DCMAMIN  ZERO MINOR PTR IN SACB     @ZA14992 52060000
         BR    X14                 RETURN                               52100000
         SPACE                                                          52200000
GETNEXT  EQU   *                                                        52300000
* FIRST CHECK TO SEE IF LAST MINOR OUTPUT IS STILL ON QUEUE             52400000
         L     WQEBASE,CQEWQE GET POINTER TO MAJOR             Y02958   52500000
         L     WQEBASE,WMJMMIN     GET POINTER TO FIRST MINOR           52600000
LOOKNEXT EQU   *                                                        52700000
         LA    WQEBASE,N0(WQEBASE) CLEAR HIGH ORDER BYTE                52800000
         LTR   WQEBASE,WQEBASE     END OF MINOR QUEUE                   52900000
         BNZ   CHKEQ               NO, BRANCH TO SEE IF EQUAL TO       X53000000
                                        LAST OUTPUT                     53100000
** 1 LINE OF CODE MOVED FM HERE TO 4 INST AFTER LABEL GETFIRST @ZA14992 53200000
         B     GETFIRST            GET POINTER TO FIRST MINOR ON       X53300000
                                        QUEUE SINCE LAST MINOR         X53400000
                                        OUTPUT IS NO LONGER ON Q        53500000
CHKEQ    EQU   *                                                        53600000
         C     WQEBASE,DCMAMIN     MINOR POINTER EQUAL TO              X53700000
                                        POINTER TO LAST MINOR          X53800000
                                        OUTPUT                          53900000
         BE    LASTONQ             YES, LAST OUTPUT IS ON QUEUE         54000000
         L     WQEBASE,WMNMNX1-N1  NO, LOOK AT                          54100000
         B     LOOKNEXT                 NEXT MINOR ON QUEUE             54200000
* LAST MINOR OUTPUT IS STILL ON QUEUE - CONTINUE FROM THERE             54300000
LASTONQ  EQU   *                                                        54400000
         L     WQEBASE,WMNMNX1-N1  GET CHAIN FIELD OF LAST             X54500000
                                        MINOR OUTPUT                    54600000
         LA    WQEBASE,N0(WQEBASE) CLEAR HIGH ORDER BYTE                54700000
         LTR   WQEBASE,WQEBASE     Q. ANY MORE MINORS                   54800000
         BCR   NOMORE,X14          NO, RETURN                           54900000
         NI    DCMAFLG2,N255-DCMALMIN TURN OFF LAST MINOR FLAG          55000000
         BR    X14                 RETURN                               55100000
         EJECT                                                          55300000
********************************************************************    55400000
START    EQU   *                                                        55500000
         L     XFBRANCH,DCMNINT7   LOAD INTERFACE 7 ADDRESS             55700000
         B     XCTL                EXIT TO IEECVFTT                     55800000
*                                                                       55900000
IODISP2  EQU   *                                                        56100000
         OI    DCMIOCM2,DCMWINFD   INDICATE WRITE DISPLAY               56200000
IOEXIT   EQU   *                                                        56400000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              56500000
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     56600000
*                                                                       56800000
XCTL     EQU   *                                                        56900000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 57000000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             57100000
*                                                                       57200000
********************************************************************    57300000
*                                                                       57400000
BLANKWRT MVC   N1(N0,X5),N0(X5) EXEC. FOR BLANKING WRITE AREA           57500000
*                                                                       57600000
********************************************************************    57700000
ONE      DC    H'1'                CONSTANT                             57800000
TWO      DC    H'2'                CONSTANT                             57900000
THREE    DC    H'3'                CONSTANT                             58000000
FOUR     DC    H'4'                CONSTANT                             58100000
KED      DC    C'E,D '             CONSTANT FOR K E,D                   58200000
*                                                                       58300000
********************************************************************    58400000
         EJECT                                                          58500000
********************************************************************    58600000
*                                                                       58700000
*    ALL DSECTS FOLLOW THIS POINT                                       58800000
*                                                                       58900000
********************************************************************    59000000
         IEETDCM                                                        59100000
         EJECT                                                          59200000
         IHACTM  CXSA                                                   59300000
         EJECT                                                          59400000
         IHACTM  CQE                                                    59500000
         EJECT                                                          59600000
         IEECUCM FORMAT=NEW                                             59700000
         EJECT                                                          59800000
         IEERDCM                                                        59900000
KPARM    DSECT                                                          60000000
         IEECVMAP KPARAM                                                60100000
         EJECT                                                          60200000
         IHAWQE  DSECT=YES                                              60300000
*********************************************************************** 60400000
         END                                                            60600000
./  ADD  SSI=70270977,NAME=IEECVFTQ
         TITLE 'IEECVFTQ -- STATUS DISPLAY INTERFACE 6'                 00100000
IEECVFTQ CSECT                                                          00200000
*C 152100                                                     MB Y01958 00300000
*C 242800,242900                                             MC SA55716 00400000
*A 237820                                                    MC SA55716 00500000
         SPACE 2                                                        00800000
* THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM 21002, 00900000
*    OS RELEASE 21                                                      01000000
         SPACE 2                                                        01100000
*                                                                       01200000
* STATUS -- CHANGE LEVEL 0                                              01300000
*                                                                       01330000
* APARS FIXED --- ZA14992                                               01360000
*                                                                       01400000
* FUNCTION -- OUTPUT OF A DISPLAY WHICH DOES NOT OVERLAY MESSAGES       01500000
*    1) SET UP FOR OUTPUT OF AS MUCH AS POSSIBLE OF AN OUT OF           01600000
*    LINE MULTIPLE LINE WRITE TO OPERATOR (MLWTO), USING THE            01700000
*    MESSAGE AREA PORTION OF THE SCREEN IMAGE BUFFER AS THE             01800000
*    OUTPUT BUFFER.  ALL ASSOCIATED WQE'S ARE FREED                     01900000
*    2) ON THE LAST FRAME OF A DISPLAY, BLANK THE REMAINDER OF          02000000
*    THE DISPLAY AREA                                                   02100000
*                                                                       02200000
* ENTRY POINT -- IEECVFTQ, FROM IEECVFTM                                02300000
*                                                                       02400000
* INPUT                                                                 02500000
*    1) REGISTER 1 - POINTER TO CXSA                                    02600000
*    2) REGISTER 7 - POINTER TO SACB                                    02700000
*                                                                       02800000
* OUTPUT                                                                02900000
*    1) REGISTER 1 - POINTER TO CXSA                                    03000000
*    2) SCREEN IMAGE BUFFER AND COMMUNICATION FIELDS SET                03100000
*    FOR A WRITE PARTIAL BY THE I/O ROUTINE                             03200000
*    3) FIELDS IN THE SACB, SCT, SSCT TO REFLECT THE STATUS             03300000
*    OF THE DISPLAY                                                     03400000
*                                                                       03500000
* EXTERNAL REFERENCES -- NONE                                           03600000
*                                                                       03700000
* EXITS,NORMAL                                                          03800000
*    1) DEVICE-DEPENDENT I/O MODULE                                     03900000
*    2) IEECVFTM - STATUS DISPLAY INTERFACE 2, IF NO I/O                04000000
*    IS TO BE DONE                                                      04100000
*                                                                       04200000
* EXITS,ERROR                                                           04300000
*    NONE                                                               04400000
*                                                                       04500000
* TABLES/WORKAREAS                                                      04600000
*    1) UNIT CONTROL MODULE - UCM                                       04700000
*    2) TRANSIENT PORTION OF THE DISPLAY CONTROL MODULE - DCM           04800000
*    3) RESIDENT PORTION OF THE DISPLAY CONTROL MODULE                  04900000
*    (INCLUDING SCREEN AREA CONTROL BLOCK - SACB)                       05000000
*                                                                       05100000
* ATTRIBUTES -- REFRESHABLE, PRIVILEGED, TYPE 4 SVC                     05200000
*                                                                       05300000
* CHARACTER CODE DEPENDENCY -- THE OPERATION OF THIS MODULE DOES        05400000
*    NOT DEPEND ON A PARTICULAR INTERNAL REPRESENTATION OF              05500000
*    THE EXTERNAL CHARACTER SET                                         05600000
*                                                                       05700000
         EJECT                                                          05800000
* REGISTER USAGE                                                        05900000
X1PARM   EQU   1                                                        06000000
XERTRN   EQU   14                                                       06100000
XFBRANCH EQU   15                                                       06200000
R0       EQU   0                   REG 0                                06300000
R1       EQU   1                   PARAMETER REGISTER                   06400000
WORKR    EQU   2                   WORK REG                             06500000
WORK1    EQU   3                   WORK REG                             06600000
EVEN     EQU   4                   WORK REG                             06700000
SCTPTR   EQU   4                   ADDRESS OF SCT ENTRY                 06800000
ODD      EQU   5                   WORK REG                             06900000
SSCTPTR  EQU   5                   ADDRESS OF SSCT ENTRY                07000000
RDCMBASE EQU   6                   RESIDENT PORTION OF DCM BASE         07100000
SACBBASE EQU   7                   SCREEN AREA CONTROL BLOCK BASE       07200000
TDCMBASE EQU   8                   TRANSIENT PORTION OF DCM BASE        07300000
OUTQREG  EQU   9                   POINTER TO CONSOLE OUTPUT           X07400000
                                        QUEUE ENTRY                     07500000
UCMEBASE EQU   10                  UCM ENTRY BASE                       07600000
WQEBASE  EQU   11                  WQE BASE                             07700000
MYBASE   EQU   12                  BASE REGISTER FOR THIS MODULE        07800000
CXSABASE EQU   13                  CXSA BASE                            07900000
RETURNR  EQU   14                  RETURN REGISTER                      08000000
LINKR    EQU   14                  FIRST LEVEL LINK REG                 08100000
LINK1    EQU   15                  SECOND LEVEL LINK REGISTER           08200000
R15      EQU   15                                                       08300000
         EJECT                                                          08400000
* ESTABLISH ADDRESSABILITY                                              08500000
         SPACE 2                                                        08700000
         BALR  MYBASE,0                                                 08800000
         USING *,MYBASE            BASE THIS MODULE                     08900000
         B     BEGIN                                                    09000000
         DC    CL8'IEECVFTQ'        MODULE NAME                         09100000
         DC    CL8'&SYSDATE',CL56' ' DATE AND PATCH AREA         Y02958 09200000
BEGIN    EQU   *                                                        09300000
         LR    CXSABASE,R1         GET CXSA ADDRESS                     09400000
         USING CXSA,CXSABASE       BASE CXSA                            09500000
         L     UCMEBASE,CSAUCM     GET ADDRESS OF UCM ENTRY             09600000
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY                       09700000
         L     RDCMBASE,UCMXB      GET ADDRESS OF RESIDENT DCM          09800000
         USING DCMTSRT,RDCMBASE      BASE RESIDENT DCM                  09900000
         L     TDCMBASE,DCMADTRN   GET ADDRESS OF TRANSIENT DCM         10000000
         USING DCMSTRT,TDCMBASE      BASE TRANSIENT DCM                 10100000
*        SACBBASE IS PASSED FROM INTERFACE 2                            10200000
         USING DCMACB,SACBBASE     BASE SACB                            10300000
         USING WQE,WQEBASE         BASE WQE'S                           10400000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      10500000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    10600000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      10700000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           10800000
         LR    X1PARM,CXSABASE     PASS CXSA ADDRESS IN REG 1           10900000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         11000000
         SPACE 3                                                        11100000
* INITIALIZATION                                                        11200000
         SPACE 2                                                        11300000
         XC    DCMBYTCT(E2),DCMBYTCT ZERO BYTE COUNT FOR OUTPUT         11400000
         L     OUTQREG,DCMAMJWQ    GET POINTER TO CONSOLE OUTPUT       X11500000
                                        QUEUE ENTRY                     11600000
         USING CQE,OUTQREG         CONSOLE Q ADDRESSABILITY   MB Y02958 11700000
         EJECT                                                          11800000
* SET UP TO BEGIN OR PICK UP WHERE WE LEFT OFF                          11900000
         SPACE                                                          12100000
         MVC   DCMLINEN(E1),DCMAROW  INDICATE WHERE TO WRITE TO         12200000
         BAL   LINKR,FINDSCT       GET POINTER TO SCT AND SSCT         X12300000
                                        ENTRIES FOR NEXT ROW            12400000
*      COMPUTE ADDRESS OF SCREEN IMAGE BUFFER LINE TO USE               12500000
         SR    WORKR,WORKR         CLEAR REG                            12800000
         IC    WORKR,DCMAROW       GET LINE NO.                         12900000
         BCTR  WORKR,E0            SUBTRACT ONE                         13000000
         MH    WORKR,DCMCORLN      MULTIPLY BY LINE LENGTH              13100000
         A     WORKR,DCMASCRN      ADD ADDRESS OF BEGINNING OF         X13200000
                                        MSG AREA SCREEN IMAGE           13300000
         ST    WORKR,DCMDSAV+E8    SAVE POINTER TO SCREEN IMAGE        X13400000
                                        LINE TO START WITH              13500000
         SPACE 2                                                        13600000
* FIND OUT WHAT THERE IS TO DO                                          13700000
         SPACE                                                          13800000
         TM    DCMAFLG1,DCMABL     Q. BLANK REST OF AREA                14000000
         BO    BLNKREST            GO BLANK REST OF AREA                14100000
         TM    DCMAFLG2,DCMAWCON   Q. CONTROL LINE TO BE WRITTEN        14300000
         BNO   WRMIN               NO, GO WRITE FROM MINOR WQE'S        14400000
*                                  FALL THROUGH TO WRITE CONTROL        14500000
         EJECT                                                          14600000
WCON     EQU   *                                                        14700000
* FIRST TIME THROUGH, CONTROL LINE MUST BE HANDLED                      14800000
         SPACE                                                          14900000
*    BUILD CONTROL LINE IN FIRST LINE                                   15000000
         BAL   LINKR,BLDCNTRL      BUILD CONTROL LINE                   15300000
         SPACE                                                          15400000
         OI    E0(SCTPTR),DCMMSGJK INDICATE JUNK IN LINE IN SCT         15500000
         OI    E0(SSCTPTR),DCMSECCL INDICATE CONTROL LINE IN           X15600000
                                        SSCT                            15700000
         TM    DCMADFLG,DCMADD     Q. DYNAMIC DISPLAY                   15800000
         BNO   UPDTE               NO, BRANCH AROUND FLAG SET           15900000
         OI    DCMADFLG,DCMACSIB   INDICATE DYNAMIC DISPLAY            X16000000
                                        CONTROL LINE IN SCREEN         X16100000
                                        IMAGE BUFFER                    16200000
         SPACE                                                          16300000
UPDTE   EQU   *                                                         16400000
*    INCREMENT BYTE COUNT FOR WRITE BY LENGTH OF ONE LINE               16500000
*    INCREMENT SCT ENTRY, SSCT ENTRY, NEXT ROW IN SACB, AND LINE        16600000
*      IN SCREEN IMAGE BUFFER FIELDS FOR NEXT LINE                      16700000
         BAL   LINKR,NXTLINE       UPDATE DCMBYTCT, SCTPTR,            X16900000
                                        SSCTPTR, DCMAROW, AND          X17000000
                                        DCMDSAV+E8                      17100000
         SPACE                                                          17200000
         TM    WMJMLTYP,WMJMLTYD   Q.END INDICATED                      17400000
         BNO   TSTMIN              NO, LOOK FOR MINORS TO WRITE         17500000
         OI    DCMAFLG1,DCMADEND   INDICATE END IN SACB                 17600000
         B     END1                GO HANDLE END                        17700000
         SPACE                                                          17800000
TSTMIN   EQU   *                                                        18000000
         L     WQEBASE,DCMAMIN     GET POINTER TO MINOR                 18100000
         LTR   WQEBASE,WQEBASE     ANY MINORS TO BE WRITTEN             18200000
         BZ    WRPAREXT            NO, OUTPUT CONTROL LINE              18300000
         SPACE                                                          18400000
         EJECT                                                          18500000
WRMIN    EQU   *                                                        18600000
*    MOVE AS MANY LINES AS POSSIBLE FROM THE MINOR WQE'S TO THE         18700000
* SCREEN IMAGE IN THE DCM                                               18800000
         SPACE                                                          18900000
         SPACE 3                                                        19100000
WRMIN1   EQU   *                                                        19200000
         SPACE                                                          19300000
*    THIS IS THE BEGINNING OF A LOOP WHICH MOVES LINES FROM THE         19400000
* MINOR WQE'S TO THE SCREEN IMAGE BUFFER UNTIL EITHER THE FRAME         19500000
* IS FULL OR THE QUEUE IS EXHAUSTED.  EACH PASS THROUGH THIS            19600000
* LOOP MOVES TEXT FROM ONE MINOR WQE INTO THE SCREEN IMAGE              19700000
* BUFFER AND DOES THE ASSOCIATED HOUSEKEEPING, INCLUDING FREEING        19800000
* THE MINOR WQE.                                                        19900000
*    INPUT - DCMDSAV+E8 - POINTS TO THE LINE OF THE SCREEN IMAGE        20000000
*              TO BE USED                                               20100000
*            SCREEN AREA CONTROL BLOCK (SACB)                           20200000
*            SSCTPTR - ADDRESS OF ASSOCIATED SSCT ENTRY                 20300000
*            SCTPTR - ADDRESS OF ASSOCIATED SCT ENTRY                   20400000
*            BASEREGS - SACBBASE, TDCMBASE, UCMBEBASE, OUTQREG          20500000
*    OUTPUT - INPUT FIELDS UPDATED FOR NEXT LINE (EVEN AT END           20600000
*              AND FRAME FULL CONDITIONS)                               20700000
*            BIT SETTINGS IN SACB, SCT, SSCT                            20800000
*            LINE OF DISPLAY MOVED INTO SCREEN IMAGE BUFFER             20900000
*            INCREMENTS DCMBYTCT BY LENGTH OF ONE LINE                  21000000
*    EXITS FROM LOOP WHEN -                                             21100000
*            1) FRAME FULL CONDITION IS REACHED, OR                     21200000
*            2) END CONDITION IS FOUND, OR                              21300000
*            3) NO MINOR ON QUEUE AFTER THE ONE JUST MOVED              21400000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:              21500000
*                        WORKR, WORK1, SCTPTR, SSCTPTR, LINKR,          21600000
*                        LINK1                                          21700000
         SPACE 2                                                        21800000
         L     WORKR,DCMDSAV+E8    GET POINTER TO SCREEN IMAGE         X21900000
                                        BUFFER LINE TO BE USED          22000000
         DROP  WQEBASE                                                  22100000
         USING WMNM,WQEBASE         BASE WQE                            22200000
         L     WQEBASE,DCMAMIN     GET MINOR WQE POINTER                22300000
         CLI   WMNMTL1,E0          IS TEXT LENGTH ZERO                  22500000
         BNE   TEXT                NO, HANDLE TEXT            MF        22600000
         TM    WMNMLT1,WMNMLT1D    Q. MINOR INDICATE END      MF        22700000
         BO    INDEND              YES, GO INDICATE END       MF        22800000
*     IF THE TEXT LENGTH IS ZERO AND THE MINOR DOES NOT       MF        22900000
*     INDICATE END, THEN THE MINOR IS STILL BEING BUILT AND   MF        23000000
*     MUST NOT BE USED.                                       MF        23100000
         NI    DCMAFLG2,XFF-DCMALMIN    TURN OFF LAST MINOR   MF       X23200000
                                        SAVED FLAG            MF        23300000
         B     WRPAREXT            EXIT                       MF        23400000
         SPACE                                                          23500000
TEXT     EQU   *                                                        23600000
*    MOVE TEXT FROM MINOR WQE TO SCREEN IMAGE BUFFER                    23700000
         BAL   LINK1,BLNKLINE      BLANK OUT LINE OF SCREEN            X24000000
                                        IMAGE BUFFER                    24100000
         SR    WORK1,WORK1         CLEAR REG                            24200000
         IC    WORK1,WMNMTL1       GET LENGTH OF TEXT                   24300000
         BCTR  WORK1,E0            DECREMENT BY ONE                     24400000
         EX    WORK1,MOVETEXT      MOVE TEXT FROM MINOR TO             X24500000
                                        SCREEN IMAGE BUFFER             24600000
         B     SETSSCT             BRANCH TO SET SSCT FLAGS             24700000
MOVETEXT MVC   E0(E0,WORKR),WMNMTXT1  MOVE TEXT                         24800000
         SPACE 2                                                        24900000
SETSSCT  EQU   *                                                        25000000
*    INDICATE LABEL OR DATA LINE IN SSCT                                25100000
         NI    E0(SSCTPTR),XFF-DCMSECBL TURN OFF BLANK LINE FLAG        25300000
         TM    WMNMLT1,WMNMLT1B    Q. MINOR WQE FOR LABEL LINE          25400000
         BO    LABEL               YES, BRANCH TO INDICATE LABEL        25500000
         OI    E0(SSCTPTR),DCMSECDL  INDICATE DATA LINE IN SSCT         25600000
         B     OVERLABL            BRANCH AROUND                        25700000
LABEL    EQU   *                                                        25800000
         OI    E0(SSCTPTR),DCMSECLL  INDICATE LABEL LINE IN SSCT        25900000
OVERLABL EQU   *                                                        26000000
         SPACE 2                                                        26100000
*    INDICATE JUNK IN LINE IN SCT                                       26200000
         OI    E0(SCTPTR),DCMMSGJK INDICATE JUNK                        26400000
         SPACE 2                                                        26500000
*    INCREMENT BYTE COUNT FOR WRITE BY LENGTH OF ONE LINE               26600000
*    INCREMENT SCT ENTRY, SSCT ENTRY, NEXT ROW IN SACB, AND LINE        26700000
*      IN SCREEN IMAGE BUFFER FIELDS FOR NEXT LINE                      26800000
         BAL   LINKR,NXTLINE       UPDATE DCMBYTCT, SCTPTR,            X27000000
                                        SSCTPTR, DCMAROW, AND          X27100000
                                        DCMDSAV+E8                      27200000
         SPACE 2                                                        27300000
*    SAVE SOME INFORMATION BEFORE MINOR IS FREED                        27400000
         TM    WMNMLT1,WMNMLT1D    Q. MINOR INDICATE END                27600000
         BO    INDEND              YES, GO INDICATE END IN SACB         27700000
         SPACE                                                          27800000
SAVENEXT EQU   *                                                        27900000
*    TEST FOR MORE MINORS ON QUEUE AND SAVE POINTER TO MINOR            28000000
         L     WORK1,WMNMNX1-E1    GET POINTER TO NEXT MINOR            28100000
         LA    WORK1,E0(WORK1)     ZERO HIGH ORDER BYTE                 28200000
         LTR   WORK1,WORK1         Q. ANY MORE MINORS                   28400000
         BZ    NOMORMIN            NO, BRANCH TO SAVE POINTER          X28500000
                                        TO MINOR JUST USED              28600000
         NI    DCMAFLG2,N255-DCMALMIN  TF LAST MINOR SAVED    @ZA14992  28700000
         ST    WORK1,DCMAMIN       SAVE POINTER TO NEXT MINOR           28800000
         B     FREEMIN             BRANCH TO FREE MINOR JUST           X28900000
                                        USED                            29000000
NOMORMIN EQU   *                                                        29100000
         OI    DCMAFLG2,DCMALMIN   INDICATE POINTER TO LAST            X29400000
                                        MINOR OUTPUT SAVED             X29500000
                                        (RATHER THAN NEXT ON Q)         29600000
         ST    WQEBASE,DCMAMIN     SAVE POINTER TO MINOR JUST          X29700000
                                        USED                            29800000
         B     FREEMIN             GO FREE MINOR                        29900000
         SPACE 2                                                        30000000
INDEND   EQU   *                                                        30100000
         OI    DCMAFLG1,DCMADEND   INDICATE END OF DISPLAY              30300000
         SPACE                                                          30400000
FREEMIN  EQU   *                                                        30500000
*    FREE MINOR WQE                                                     30600000
         SR    WORK1,WORK1         CLEAR REG                            30800000
         IC    WORK1,WMNMUC1       GET USE COUNT FROM MINOR             30900000
         BCTR  WORK1,E0            DECREMENT USE COUNT BY ONE           31000000
         STC   WORK1,WMNMUC1       STORE NEW USE COUNT                  31100000
         LTR   WORK1,WORK1         Q. IS USE COUNT ZERO                 31200000
         BNZ   TESTEND             NO, BRANCH TO TEST FOR END           31300000
DEQ      EQU   *                                                        31400000
         OI    UCMSTS,UCMTB        INDICATE DEQUEUE WORK TO DO          31500000
         L     WORK1,CQEWQE        GET POINTER TO MAJOR WQE   MB Y02958 31600000
         DROP  WQEBASE                                           Y02958 31700000
         USING WMJM,WORK1          BASE WQE                   MB Y01958 31800000
         OI    WMJMMLW,WMJMMLWG    INDICATE IN MAJOR THAT MLWTO         31900000
*                                  CHAIN NEEDS SERVICING.               32000000
         DROP  WORK1                                                    32100000
         USING WMJM,WQEBASE                                      Y01958 32200000
         SPACE 2                                                        32300000
TESTEND  EQU   *                                                        32400000
*     TEST FOR  END OF DISPLAY                                          32500000
         TM    DCMAFLG1,DCMADEND   Q. END OF DISPLAY FOUND              32700000
         BO    END1                YES, BRANCH TO HANDLE END            32800000
         SPACE                                                          32900000
*    TEST FOR FULL FRAME                                                33000000
         TM    DCMAFLG1,DCMAFULL   Q. FULL FRAME                        33200000
         BO    FRAMFUL1            YES, BRANCH TO HANDLE                33300000
         SPACE 2                                                        33400000
*    IF NO MORE MINORS ON QUEUE, OUTPUT WHAT WE HAVE.                   33500000
*    IF MORE MINORS, GO BACK TO PROCESS NEXT ONE.                       33600000
         TM    DCMAFLG2,DCMALMIN   Q. POINTER TO LAST MINOR            X33800000
                                        SAVED (BECAUSE NO MORE         X33900000
                                        ON QUEUE)                       34000000
         BO    WRPAREXT            YES, OUTPUT WHAT WE HAVE             34100000
         B     WRMIN1              NO, GO PROCESS NEXT MINOR            34200000
         EJECT                                                          34300000
FRAMFUL1 EQU   *                                                        34400000
         BAL   LINK1,INDFRFL       GO INDICATE FRAME FULL     MF  M2073 34600000
         SPACE                                                          34700000
CONTFF   EQU   *                                                        34800000
         NI    DCMAFLG1,XFF-DCMAFRPR  TURN OFF FRAMING IN              X35000000
                                        PROGRESS FLAG                   35100000
         SPACE                                                          35200000
*    FIND FIRST LINE TO BE WRITTEN NEXT FRAME (FIRST DATA LINE)         35300000
         SR    WORK1,WORK1         CLEAR REG                            35500000
         IC    WORK1,DCMATOP       GET LINE NO. OF TOP LINE             35600000
         BCTR  WORK1,E0            SUBTRACT ONE                         35700000
         L     WORKR,DCMADSEC      GET ADDRESS OF SSCT                  35800000
         AR    WORKR,WORK1         WORKR NOW POINTS TO SSCT BYTE       X35900000
                                        FOR TOP LINE                    36000000
SRCHDATA EQU   *                                                        36100000
         LA    WORK1,E1(WORK1)     UPDATE LINE NO.                      36200000
         TM    E0(WORKR),DCMSECDL  Q. DATA LINE                         36300000
         BO    DATALFND            YES, SAVE LINE NO.                   36400000
         LA    WORKR,E1(WORKR)     POINT TO NEXT SSCT BYTE              36500000
         B     SRCHDATA            CONTINUE SEARCH (MUST ALWAYS        X36600000
                                        FIND ONE SINCE FRAME           X36700000
                                        FULL - AT LEAST 4 LINES-        36800000
*                                       CANNOT BE REACHED BY           X36900000
                                        CONTROL LINE AND 2 LABEL       X37000000
                                        LINES)                          37100000
DATALFND EQU   *                                                        37200000
         STC   WORK1,DCMAROW       STORE AS NEXT LINE TO BE            X37300000
                                        WRITTEN (NEXT FRAME)            37400000
         SPACE                                                          37500000
         B     WRPAREXT            EXIT TO I/O ROUTINE                  37600000
         EJECT                                                          37700000
END1     EQU   *                                                        37800000
* END OF DISPLAY FOUND                                                  37900000
         SPACE                                                          38000000
*    CONTROL LINE MUST BE MARKED FRAME LAST                             38100000
         TM    DCMAFLG2,DCMAWCON   WAS CONTROL LINE BUILT ON           X38300000
                                        THIS ENTRY TO MODULE            38400000
         BO    MARKLAST            YES, INDICATE FRAME LAST             38500000
         TM    UCMDISP,UCMDISPG    IS THIS A STATUS DISPLAY ONLY       X38600000
                                        CONSOLE                         38700000
         BO    MARKLAST            YES, INDICATE FRAME LAST             38800000
         TM    DCMADFLG,DCMACSIB   Q. DYNAMIC DISPLAY WHOSE            X38900000
                                        CONTROL LINE IS IN             X39000000
                                        SCREEN IMAGE BUFFER             39100000
         BO    MARKLAST            YES, INDICATE FRAME LAST             39200000
         OI    DCMAFLG2,DCMARCON   OTHERWISE, INDICATE REWRITE         X39400000
                                        CONTROL LINE LATER              39500000
         B     BLNKREST            BRANCH TO BLANK REST OF AREA         39600000
         SPACE                                                          39700000
MARKLAST EQU   *                                                        39800000
*      THE CONTROL LINE IS STILL IN THE DCM, SO JUST MARK LAST          39900000
*      AND INDICATE WRITE FROM BEGINNING OF FRAME                       40000000
         SR    WORKR,WORKR         CLEAR REG                            40200000
         IC    WORKR,DCMATOP       GET NO. OF TOP LINE OF AREA          40300000
         BCTR  WORKR,E0            SUBTRACT ONE                         40400000
         MH    WORKR,DCMCORLN      MULTIPLY BY LINE LENGTH              40500000
         A     WORKR,DCMASCRN      ADD ADDRESS OF BEGINNING OF         X40600000
                                        MSG AREA SCREEN IMAGE           40700000
         BAL   LINKR,MOVFRAME      REBUILD CONTROL LINE                 40800000
         SPACE                                                          40900000
         SR    WORK1,WORK1         CLEAR REG                            41100000
         SR    WORKR,WORKR         CLEAR REG                            41200000
         IC    WORK1,DCMATOP       GET TOP ROW NO.                      41300000
         IC    WORKR,DCMAROW       GET NO. OF ROW TO BE WRITTEN        X41400000
                                        NEXT                            41500000
         SR    WORKR,WORK1         FIND NO. OF LINES FROM TITLE        X41600000
                                        TO (AND INCLUDING) END          41700000
         MH    WORKR,DCMCORLN      MULTIPLY BY LENGTH OF LINE           41800000
         STH   WORKR,DCMBYTCT      STORE AS BYTE COUNT FOR WRITE        41900000
         MVC   DCMLINEN(E1),DCMATOP INDICATE WRITE FROM TOP LINE        42000000
*                                  FALL THROUGH TO BLNKREST             42100000
         EJECT                                                          42200000
* BLANK REST OF AREA                                                    42300000
*    AFTER THE LAST (END) LINE OF THE DISPLAY HAS BEEN WRITTEN,         42400000
* THE REST OF THE LINES OF THE FRAME MUST BE BLANKED OUT                42500000
* (DCMAROW, DCMDSAV+E8, SSCTPTR, AND SCTPTR ARE SET UP FOR THE          42600000
* FIRST LINE TO BE BLANKED)                                             42700000
         SPACE                                                          42800000
BLNKREST EQU   *                                                        42900000
         TM    DCMAFLG1,DCMAFULL   Q. FULL FRAME                        43100000
         BO    HNDLFF              YES, GO FINISH UP                    43200000
         SPACE                                                          43300000
         L     WORKR,DCMDSAV+E8    GET POINTER TO NEXT LINE TO         X43500000
                                        BE BLANKED                      43600000
         BAL   LINK1,BLNKLINE      BLANK OUT LINE                       43700000
         SPACE                                                          43800000
*    INDICATE BLANKED LINE IN SSCT                                      43900000
         OI    E0(SSCTPTR),DCMSECBL  INDICATE BLANKED LINE              44100000
*    TURN OFF JUNK IN LINE BIT IN SCT                                   44200000
         NI    E0(SCTPTR),XFF-DCMMSGJK  INDICATE NO MORE JUNK           44300000
         SPACE                                                          44400000
*    INCREMENT BYTE COUNT FOR WRITE BY LENGTH OF ONE LINE               44500000
*    INCREMENT SCT ENTRY, SSCT ENTRY, NEXT ROW IN SACB, AND LINE        44600000
*      IN SCREEN IMAGE BUFFER FIELDS FOR NEXT LINE                      44700000
         BAL   LINKR,NXTLINE       UPDATE DCMBYTCT, SCTPTR,            X44900000
                                        SSCTPTR, DCMAROW, AND          X45000000
                                        DCMDSAV+E8                      45100000
         B     BLNKREST            CONTINUE BLANKING                    45200000
         SPACE                                                          45300000
HNDLFF   EQU   *                   HANDLE FULL FRAME                    45400000
         TM    DCMAFLG2,DCMARCON   Q. REWRITE CONTROL LINE             X45600000
                                        NEEDED                          45700000
         BO    WRPAREXT            YES, DO NOT FREE MAJOR YET           45800000
         NI    DCMAFLG1,XFF-DCMAFRPR  TURN OFF FRAMING IN     MF  M2073X46000000
                                        PROGRESS FLAG         MF  M2073 46100000
*    FREE MAJOR WQE                                                     46200000
FREEMAJ  EQU   *                                                        46300000
         TM    DCMADFLG,DCMADD     Q. DYNAMIC DISPLAY         MF  M2073 46500000
         BO    ENDDD               YES, BRANCH TO HANDLE END  MF  M2073X46600000
                                        OF DYNAMIC DISPLAY    MF  M2073 46700000
FREEMAJ2 EQU   *                   NOT A DYNAMIC DISPLAY     MC SA55716 46800000
         OI    CQEFLAG,CQEAVAIL    INDICATE MAJOR WQE NOT              X46900000
                                   NEEDED BY THIS CONSOLE     MB Y02958 47000000
         NI    CQEFLAG,XFF-CQEENTR TURN OFF ENTRY FLAG        MB Y02958 47100000
         OI    UCMSTS,UCMTB        INDICATE DEQUEUE WORK NEEDED         47200000
         SPACE                                                          47300000
         OI    DCMAFLG2,DCMAMJFR   INDICATE MAJOR FREED                 47400000
         B     WRPAREXT            EXIT TO I/O ROUTINE                  47500000
         SPACE                                                          47600000
ENDDD    EQU   *                                              MF  M2073 47700000
         TM    DCMADFLG,DCMACSIB   Q. IS CONTROL LINE IN SIB MC SA55716 47800000
         BO    FREEMAJ2            YES, GO FREE MAJOR        MC SA55716 47900000
*      MAJOR WQE CANNOT BE FREED UNTIL THERE IS A COPY OF THE MF  M2073 48000000
*   TITLE IN CORE FOR POSSIBLE USE BY K D,H AND K D,U TO      MF  M2073 48100000
*   REBUILD THE CONTROL LINE.  THE FRAME FULL BIT IN THE      MF  M2073 48200000
*   MAJOR WQE IS TURNED ON SO THAT INTERFACE 2 WILL IGNORE    MF  M2073 48300000
*   THE MAJOR WHILE IT REMAINS ON THE QUEUE.                  MF  M2073 48400000
         BAL   LINK1,INDFRFL       TURN ON FRAME FULL BIT     MF  M2073 48500000
         B     WRPAREXT            EXIT TO I/O ROUTINE        MF  M2073 48600000
         EJECT                                                          48700000
*********************************************************************** 48800000
*                                                                     * 48900000
* NEXT LINE SUBROUTINE                                                * 49000000
*    INCREMENT BYTE COUNT FOR WRITE BY LENGTH OF ONE LINE             * 49100000
*    INCREMENT DCMAROW, SCTPTR, SSCTPTR, AND DCMDSAV+E8 TO            * 49200000
* INFORMATION FOR NEXT LINE                                           * 49300000
*    INPUT - DCMBYTCT - BYTE COUNT FOR WRITE, NOT INCLUDING LINE      * 49400000
*              JUST HANDLED                                           * 49500000
*            DCMAROW, SCTPTR, SSCTPTR, AND DCMDSAV+E8 SET UP FOR      * 49600000
*              LINE JUST HANDLED                                      * 49700000
*    OUTPUT- DCMBYTCT - BYTE COUNT FOR WRITE, INCLUDING LINE          * 49800000
*              JUST HANDLED                                           * 49900000
*            DCMAROW, SCTPTR, SSCTPTR, AND DCMDSAV+E8                 * 50000000
*              INCREMENTED FOR NEXT LINE                              * 50100000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 50200000
*                   SCTPTR, SSCTPTR, WORKR, WORK1, LINK1              * 50300000
*              LINKR - LINK REGISTER                                  * 50400000
*                                                                     * 50500000
*********************************************************************** 50600000
         SPACE 2                                                        50700000
NXTLINE  EQU   *                                                        50800000
         LH    WORK1,DCMBYTCT      GET CURRENT BYTE COUNT               50900000
         AH    WORK1,DCMCORLN           ADD LENGTH OF ONE LINE          51000000
         STH   WORK1,DCMBYTCT           STORE BYTE COUNT                51100000
         BAL   LINK1,UPDTEROW      INCREMENT ROW NUMBER AND SET        X51200000
                                        FLAG IF FULL FRAME              51300000
         AH    SCTPTR,DCMSCTCN     UPDATE SET POINTER BY LENGTH        X51400000
                                        OF AN SCT ENTRY                 51500000
         LA    SSCTPTR,E1(SSCTPTR) INCREMENT SSCT POINTER BY ONE        51600000
         L     WORKR,DCMDSAV+E8    ADD LENGTH OF ONE LINE TO            51700000
         AH    WORKR,DCMCORLN           POINT TO NEXT LINE IN           51800000
         ST    WORKR,DCMDSAV+E8         SCREEN IMAGE BUFFER             51900000
         BR    LINKR                                                    52000000
         EJECT                                                          52100000
*********************************************************************** 52200000
*                                                                     * 52300000
* FINDSCT SUBROUTINE                                                  * 52400000
*    COMPUTES ADDRESS OF SCREEN CONTROL TABLE (SCT) AND               * 52500000
* SECONDARY SCREEN CONTROL TABLE (SSCT) ENTRIES FOR LINE POINTED      * 52600000
* TO BE DCMAROW.                                                      * 52700000
*    INPUT - DCMAROW                                                  * 52800000
*            TDCMBASE                                                 * 52900000
*    OUTPUT - SCTPTR - ADDRESS OF SCT ENTRY                           * 53000000
*             SSCTPTR - ADDRESS OF SSCT ENTRY                         * 53100000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 53200000
*                   SCTPTR, SSCTPTR                                   * 53300000
*                                                                     * 53400000
*********************************************************************** 53500000
         SPACE 2                                                        53600000
FINDSCT  EQU   *                                                        53700000
         SR    SSCTPTR,SSCTPTR     CLEAR REG                            53800000
         IC    SSCTPTR,DCMAROW     GET LINE NO.                         53900000
         BCTR  SSCTPTR,E0          SUBTRACT ONE                         54000000
         LR    SCTPTR,SSCTPTR      SAVE FOR FURTHER USE                 54100000
         A     SSCTPTR,DCMADSEC    ADD ADDRESS OF SSCT                  54200000
*    SSCTPTR NOW POINTS TO SSCT ENTRY                                   54300000
         SPACE                                                          54400000
         MH    SCTPTR,DCMSCTCN     MULTIPLY BY LENGTH OF ONE           X54500000
                                        SCT ENTRY                       54600000
         A     SCTPTR,DCMAMTAB     ADD ADDRESS OF SCT                   54700000
*    SCTPTR NOW POINTS TO SCT ENTRY                                     54800000
         BR    LINKR               RETURN FROM FINDSCT                  54900000
         EJECT                                                          55000000
*********************************************************************** 55100000
*                                                                     * 55200000
* UPDATE ROW NUMBER                                                   * 55300000
*    THIS ROUTINE INCREMENTS THE NEXT ROW TO WRITE FIELD OF THE       * 55400000
* SACB AND TESTS FOR A FULL FRAME                                     * 55500000
*    INPUT - NONE OTHER THAN CONTROL BLOCKS AND BASE REGS             * 55600000
*    OUTPUT - DCMAROW - INCREMENTED BY ONE                            * 55700000
*             DCMAFLG1 - DCMAFULL FLAG IS TURNED ON IF UPDATED        * 55800000
*                        ROW NUMBER IS OUTSIDE AREA                   * 55900000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 56000000
*                        WORKR, WORK1                                 * 56100000
*              LINK1 - LINK REGISTER                                  * 56200000
*                                                                     * 56300000
*********************************************************************** 56400000
         SPACE 2                                                        56500000
UPDTEROW EQU   *                                                        56600000
*    INCREMENT ROW IN SACB BY ONE                                       56700000
         SR    WORK1,WORK1         CLEAR REG                            56800000
         IC    WORK1,DCMAROW       GET CURRENT ROW                      56900000
         LA    WORK1,E1(WORK1)     INCREMENT BY ONE                     57000000
         STC   WORK1,DCMAROW       STORE IN SACB                        57100000
         SPACE                                                          57200000
*    TEST FOR FULL FRAME                                                57300000
         SR    WORKR,WORKR         CLEAR REG                            57400000
         IC    WORKR,DCMATOP       GET NO. OF TOP ROW OF AREA           57500000
         AH    WORKR,DCMALN        ADD LENGTH OF AREA                  X57600000
                                        WORKR NOW CONTAINS NO.         X57700000
                                        OF FIRST ROW BELOW AREA.        57800000
*                                       WORK1 STILL CONTAINS           X57900000
                                        NO. OF NEXT ROW TO BE          X58000000
                                        WRITTEN                         58100000
         CR    WORK1,WORKR         Q. OUTSIDE OF AREA                   58200000
         BE    FRAMFUL3            YES, BRANCH TO INDICATE FULL        X58300000
                                        FRAME                           58400000
         BR    LINK1               RETURN FROM SUBROUTINE               58500000
         SPACE                                                          58600000
FRAMFUL3 EQU   *                                                        58700000
         OI    DCMAFLG1,DCMAFULL   INDICATE FULL FRAME                  58800000
         BR    LINK1               RETURN FROM SUBROUTINE               58900000
         EJECT                                                          59000000
*********************************************************************** 59100000
*                                                                     * 59200000
* BUILD CONTROL LINE SUBROUTINE                                       * 59300000
*    THIS ROUTINE BUILDS THE CONTROL LINE IN THE DCM LINE             * 59400000
* INDICATED                                                           * 59500000
*    INPUT - WORKR - POINTS TO THE DCM LINE IN WHICH THE CONTROL      * 59600000
*                   LINE IS TO BE BUILT                               * 59700000
*            BASE REGISTERS FOR MAJOR WQE, SACB, TDCM                 * 59800000
*    OUTPUT - CONTROL LINE BUILT WHERE INDICATED                      * 59900000
*    REGISTER USAGE - LINKR - LINK REGISTER                           * 60000000
*            DESTROYS CONTENTS OF FOLLOWING REGS: WORK1               * 60100000
*                                                                     * 60200000
*********************************************************************** 60300000
         SPACE 2                                                        60400000
BLDCNTRL EQU   *                                                        60500000
         BAL   LINK1,BLNKLINE      BLANK OUT LINE IN WHICH             X60600000
                                        CONTROL LINE IS TO BE          X60700000
                                        BUILT                           60800000
         USING DCONTROL,WORKR      BASE CONTROL LINE DSECT              60900000
         DROP  WQEBASE                                                  61000000
         USING WMJM,WQEBASE        BASE WQE                             61100000
         L     WQEBASE,CQEWQE      BASE MAJOR WQE             MB Y02958 61200000
         LH    WORK1,WMJMTXTL      GET LENGTH OF TITLE                  61300000
         SH    WORK1,C5            SUBTRACT 4 FOR MLWTO ID AND         X61400000
                                        1 FOR EXECUTE                   61500000
         EX    WORK1,MOVTITLE      MOVE TITLE INTO CONTROL LINE         61600000
         SPACE                                                          61700000
MOVFRAME EQU   *                                                        61800000
         MVC   FRAME+E1(L'CFRAME),CFRAME  MOVE 'FRAME' IN               61900000
         TM    DCMAFLG1,DCMADEND   Q. LAST FRAME ON SCREEN              62000000
         BO    LAST                YES, BRANCH TO MOVE IN 'LAST'        62100000
         CLI   DCMAFR,F0           Q. IS FIRST DIGIT OF FRAME          X62200000
                                        NUMBER ZERO                     62300000
         BE    ONEDIGIT            YES, BRANCH TO MOVE ONE DIGIT        62400000
         MVC   FRAME+E7(E2),DCMAFR MOVE 2-DIGIT FRAME NUMBER IN         62500000
         B     MVCNTRL             BRANCH TO MOVE CONTROL CHAR          62600000
ONEDIGIT EQU   *                                                        62700000
         MVC   FRAME+E8(E1),DCMAFR+E1 MOVE 1-DIGIT FRAME NO. IN         62800000
         B     MVCNTRL             BRANCH TO MOVE CONTROL CHAR          62900000
LAST     EQU   *                                                        63000000
         MVC   FRAME+E7(L'CLAST),CLAST  MOVE 'LAST' IN                  63100000
         SPACE 2                                                        63200000
MVCNTRL  EQU   *                                                        63300000
         MVI   CNTRL2+E2,ASTERISK  PUT ASTERISK IN CONTROL 2            63400000
         MVI   CNTRL3+E2,ASTERISK  PUT ASTERISK IN CONTROL 3            63500000
         TM    DCMADFLG,DCMADD     Q. DYNAMIC DISPLAY                   63600000
         BO    CNTRLDD             BRANCH TO BUILD DYNAMIC             X63700000
                                        CONTROL CHARACTERS              63800000
*    STATIC DISPLAY -- MOVE IN 'F' AND 'E'                              63900000
         MVI   CNTRL2+E3,FORWARD   MOVE IN 'F' FOR FRAME FORWARD        64000000
         MVI   CNTRL3+E3,ERASE     MOVE IN 'E' FOR ERASE                64100000
         B     MVAID               BRANCH TO MOVE IN AREA ID            64200000
         SPACE                                                          64300000
CNTRLDD  EQU   *                                                        64400000
         TM    DCMADFLG,DCMAHOLD   Q. DYNAMIC DISPLAY IN               X64500000
                                        HOLD MODE                       64600000
         BO    MVHOLD              BRANCH TO MOVE HOLD OPTIONS          64700000
         SPACE                                                          64800000
*    DYNAMIC DISPLAY IN UPDATE MODE -- MOVE IN 'PT' AND 'H'   MB Y02958 64900000
         MVI   CNTRL2+E3,PT1       MOVE IN 'PT'               MB Y02958 65000000
         MVI   CNTRL2+E4,PT2            FOR STOPTR            MB Y02958 65100000
         MVI   CNTRL3+E3,HOLD      MOVE IN 'H' FOR HOLD                 65200000
         B     MVAID               BRANCH TO MOVE IN AREA ID            65300000
         SPACE                                                          65400000
MVHOLD   EQU   *                                                        65500000
*    DYNAMIC DISPLAY IN HOLD MODE -- MOVE IN 'F' AND 'U'                65600000
         MVI   CNTRL2+E3,FORWARD   MOVE IN 'F' FOR FRAME FORWARD        65700000
         MVI   CNTRL2+E4,BLANK     MOVE IN BLANK (NEEDED IF            X65800000
                                          ENTRY IS TO MOVFRAME)         65900000
         MVI   CNTRL3+E3,UPDATE    MOVE IN 'U' FOR UPDATE               66000000
         SPACE 2                                                        66100000
MVAID    EQU   *                                                        66200000
* MOVE AREA ID IN -- CCA                                                66300000
*    GET CONSOLE ID -CC- AND CONVERT TO EBCDIC                          66400000
         SR    WORK1,WORK1         CLEAR REG                            66500000
         IC    WORK1,UCMID         GET CONSOLE ID                       66600000
         CVD   WORK1,DCMPACK       CONVERT IT TO DECIMAL                66700000
         UNPK  DCMPACK(E3),DCMPACK+E6(E2)  UNPACK IT                    66800000
         MVC   AREAID+E1(E2),DCMPACK+E1  MOVE IN THE CONSOLE ID         66900000
         OI    AREAID+E2,F0        CONVERT SIGN TO ZONE                 67000000
         CLI   AREAID+E1,F0        IS FIRST DIGIT ZERO                  67100000
         BNE   GETAID              NO, GET AREA ID                      67200000
         MVI   AREAID+E1,BLANK     YES, BLANK OUT ZERO                  67300000
GETAID   EQU   *                                                        67400000
*    GET AREA ID                                                        67500000
         MVC   AREAID+E3(E1),DCMAID  MOVE AREA ID IN                    67600000
         SPACE 2                                                        67700000
* RETURN FROM SUBROUTINE                                                67800000
         BR    LINKR               RETURN FROM SUBROUTINE               67900000
         SPACE 2                                                        68000000
* EXECUTED INSTRUCTION                                                  68100000
MOVTITLE MVC   TITLE(E0),WMJMTXT   MOVE TITLE INTO CONTROL LINE         68200000
         SPACE 2                                                        68300000
         DROP  WORKR                                                    68400000
         EJECT                                                          68500000
*********************************************************************** 68600000
*                                                                     * 68700000
* BLANK LINE                                                          * 68800000
*    THIS ROUTINE BLANKS ONE LINE OF THE SCREEN IMAGE BUFFER IN       * 68900000
* THE DCM                                                             * 69000000
*    INPUT - WORKR - ADDRESS OF LINE TO BE BLANKED                    * 69100000
*    OUTPUT - BLANKED LINE                                            * 69200000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 69300000
*                        WORK1                                        * 69400000
*             LINK1 - LINK REGISTER                                   * 69500000
*                                                                     * 69600000
*********************************************************************** 69700000
BLNKLINE EQU   *                                                        69800000
         MVI   E0(WORKR),BLANK     MOVE IN ONE BLANK                    69900000
         LH    WORK1,DCMLGNTH      GET LENGTH OF LINE                   70000000
         SH    WORK1,C2            DECREMENT LENGTH BY 2                70100000
         EX    WORK1,PROP          PROPAGATE BLANK                      70200000
         BR    LINK1               RETURN FROM SUBROUTINE               70300000
PROP     MVC   E1(E0,WORKR),E0(WORKR)  PROPAGATE CHARACTER              70400000
     EJECT                                                              70500000
*********************************************************************** 70600000
*                                                                     * 70700000
* INDICATE FRAME FULL IN MAJOR WQE                                    * 70800000
*    THE FRAME FULL BIT INDICATES TO THE QUEUEING ROUTINE THAT        * 70900000
* EVEN IF MORE MINOR WQE'S ARE QUEUED, OUT OF LINE OUTPUT SHOULD      * 71000000
* NOT BE INDICATED SINCE NO MORE CAN BE DISPLAYED.  IT ALSO           * 71100000
* CAUSES THE MAJOR WQE TO BE IGNORED BY INTERFACE 2 SINCE NO          * 71200000
* MORE OF THE DISPLAY CAN BE OUTPUT.                                  * 71300000
*    THE ALGORITHM MANIPULATES THE CONSOLE ID TO FIND THE             * 71400000
* CORRESPONDING BIT POSITION IN THE DOUBLE WORD FRAME FULL            * 71500000
* FIELD.                                                              * 71600000
*    INPUT - NONE OTHER THAN CONTROL BLOCKS AND BASE REGS             * 71700000
*    OUTPUT - FRAME FULL BIT TURNED ON IN MAJOR WQE                   * 71800000
*    REGISTER USAGE - DESTROYS CONTENTS OF FOLLOWING REGS:            * 71900000
*                        WORKR, WORK1,WQEBASE                         * 72000000
*              LINK1 - LINK REGISTER                                  * 72100000
*    ALSO DESTROYS FIRST TWO WORDS OF DCMDSAV                         * 72200000
*                                                                     * 72300000
*********************************************************************** 72400000
         SPACE 2                                                        72500000
INDFRFL  EQU   *                                              MF  M2073 72600000
         STM   EVEN,ODD,DCMDSAV    SAVE CONTENTS OF EVEN/ODD           X72700000
                                        REG PAIR                        72800000
         SR    WORK1,WORK1         CLEAR REG                            72900000
         IC    WORK1,UCMID         GET CONSOLE ID                       73000000
         BCTR  WORK1,E0            REDUCE FOR ALGORITHM                 73100000
         SR    WORKR,WORKR         CLEAR REG                            73200000
         LA    ODD,E8              GET DIVISOR                          73300000
         DR    WORKR,ODD           DIVIDE ID                            73400000
*                                  WORKR IS BIT IN BYTE                 73500000
*                                  WORK1 IS BYTE IN FIELD               73600000
         LA    EVEN,E1             GET BIT                              73700000
         SRDL  EVEN,E25(WORKR)     CREATE MASK                          73800000
         L     WQEBASE,CQEWQE      GET POINTER TO MAJOR WQE   MB Y02958 73900000
         LA    EVEN,WMJMCONS       POINT TO FRAME FULL BITS             74000000
         AR    EVEN,WORK1          POINT TO BYTE                        74100000
         EX    ODD,INDFF           INDICATE FRAME FULL                  74200000
         LM    EVEN,ODD,DCMDSAV    RESTORE CONTENTS OF EVEN/ODD        X74300000
                                        REG PAIR                        74400000
         BR    LINK1               RETURN FROM INDFRFL        MF  M2073 74500000
         SPACE 2                                                        74600000
INDFF    OI    E0(EVEN),E0         INDICATE FRAME FULL IN WQE           74700000
         EJECT                                                          74800000
INT2EXIT EQU   *                                                        74900000
         L     XFBRANCH,DCMNINT2   LOAD INTERFACE 2 ADDRESS             75100000
         B     XCTL                EXIT TO IEECVFTM                     75200000
         SPACE                                                          75300000
WRPAREXT EQU   *                                                        75400000
         NI    DCMAFLG1,XFF-DCMABL TURN OFF BLANK REST FLAG             75500000
         LH    WORK1,DCMBYTCT      GET BYTE COUNT FOR WRITE             75700000
         LTR   WORK1,WORK1         Q. ZERO                              75800000
         BZ    INT2EXIT            YES. EXIT TO INTERFACE 2             75900000
         OI    DCMIOCM1,DCMWRPAR   INDICATE WRITE PARTIAL              X76100000
                                        MESSAGE AREA                    76200000
         NI    DCMAFLG2,XFF-DCMAWCON  TURN OFF WRITE CONTROL           X76300000
                                        LINE FLAG                       76400000
IOEXIT   EQU   *                                                        76500000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              76700000
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     76800000
         SPACE 2                                                        76900000
XCTL     EQU   *                                                        77000000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 77100000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             77200000
         EJECT                                                          77300000
*********************************************************************** 77400000
*                                                                     * 77500000
*                             CONSTANTS                               * 77600000
*                                                                     * 77700000
*********************************************************************** 77800000
         SPACE 2                                                        77900000
C2       DC    H'2'                CONSTANT                             78000000
C5       DC    H'5'                CONSTANT                             78100000
CFRAME   DC    CL5'FRAME'          FRAME                                78200000
CLAST    DC    CL4'LAST'           LAST                                 78300000
         EJECT                                                          78400000
*********************************************************************** 78500000
*                                                                     * 78600000
*                             EQUATES                                 * 78700000
*                                                                     * 78800000
*********************************************************************** 78900000
         SPACE 2                                                        79000000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            79100000
ID2      EQU   C'Q'                2ND CHARACTER OF CSECT ID            79200000
E0       EQU   0                   NUMBER                               79300000
E1       EQU   1                   NUMBER                               79400000
E2       EQU   2                   NUMBER                               79500000
E3       EQU   3                   NUMBER                               79600000
E4       EQU   4                   NUMBER                               79700000
E6       EQU   6                   NUMBER                               79800000
E8       EQU   8                   NUMBER                               79900000
E25      EQU   25                  NUMBER                               80000000
E7       EQU   7                   NUMBER                               80100000
BLANK    EQU   C' '                BLANK                                80200000
F0       EQU   C'0'                EBCDIC 0                             80300000
XFF      EQU   X'FF'               TO TURN OFF BITS                     80400000
N255     EQU   255                                                      80450000
         EJECT                                                          80500000
DCONTROL DSECT                                                          80600000
* CONTROL LINE OF AN OUT OF LINE DISPLAY                                80700000
         DS    0XL74                                                    80800000
TITLE    DS    XL37                TITLE                                80900000
FRAME    DS    XL11                FRAME NUMBER                         81000000
CNTRL1   DS    XL7                 CONTROL CHARACTER 1                 X81100000
                                        (RESERVED FOR BACKWARD         X81200000
                                        FRAMING)                        81300000
ASTERISK EQU   C'*'                INDICATES DETECTABLE FIELD           81400000
CNTRL2   DS    XL8                 CONTROL CHARACTER 2                  81500000
FORWARD  EQU   C'F'                     FRAME FORWARD                   81600000
PT1      EQU   C'P'                     STOP                  MB Y02958 81700000
PT2      EQU   C'T'                          TRACK            MB Y02958 81800000
CNTRL3   DS    XL7                 CONTROL CHARACTER 3                  81900000
ERASE    EQU   C'E'                     ERASE DISPLAY                   82000000
HOLD     EQU   C'H'                     HOLD DYNAMIC DISPLAY            82100000
UPDATE   EQU   C'U'                     UPDATE DYNAMIC DISPLAY          82200000
AREAID   DS    XL4                 AREA ID - CCA                        82300000
         EJECT                                                          82400000
         IHACTM  CXSA                                                   82500000
         EJECT                                                          82600000
         IHACTM CQE                                           MB Y02958 82700000
         EJECT                                                          82800000
         IEECUCM FORMAT=NEW                                             82900000
         EJECT                                                          83000000
         IHAWQE  DSECT=YES                                              83100000
         EJECT                                                          83200000
         IEERDCM                                                        83300000
         EJECT                                                          83400000
         IEETDCM                                                        83500000
         EJECT                                                          83600000
         END                                                            83800000
./  ADD  SSI=31380921,NAME=IEECVFTR
* /* START OF SPECIFICATIONS ****                                       00050002
*02*  PROCESSOR = ASSEMBLER;                                            00100002
**** END OF SPECIFICATIONS ***/                                         00150002
IEECVFTR CSECT                                                          00200002
*/*IEECVFTR: CHART */                                                   00250002
*/*HEADER                                                               00300002
*/*        CHART ??     IEECVFTR  IGC6R07B                    DIDOCS */ 00350002
*/*2260 I/O ROUTINE 2                               PAGE #    */        00400002
*/* E IEECVFTR */                                                       00450002
         TITLE 'IEECVFTR IGC6R07B 2260 IO 2'                            00500002
*                                                                     * 00550002
*  STATUS                                                               00600002
*     CHANGE LEVEL 0                                                    00650002
*     CREATED FOR O/S RELEASE 21, LINE ITEM S21003                      00700002
*                                                                       00750002
* FUNCTION                                                              00800002
*    PERFORMS A STATUS SWITCH BY MODIFYING FIELDS IN THE                00850002
*     DISPLAY CONTROL MODULE                                            00900002
*                                                                       00950002
* ENTRY POINTS                                                          01000002
*         IEECVFTR FOR ALL FUNCTIONS                                    01050002
*                                                                       01100002
* INPUT                                                                 01150002
*    REGISTER 1 - POINTER TO CSCB XSA                                   01200002
*                                                                       01250002
* OUTPUT                                                                01300002
*    MODIFIED DISPLAY CONTROL MODULE                                    01350002
*                                                                       01400002
* EXTERNAL REFERENCES                                                   01450002
*         XCTL - FOR EXIT                                               01500002
*                                                                       01550002
* EXITS,NORMAL                                                          01600002
*         IEECVFTG - CLEANUP MODULE ON FIRST PASS                       01650002
*         IEECVETK - TIMER/INTERPRETER ON 2ND PASS MESSAGE STREAM       01700002
*         IEECVETR - 2260 I/O 1 ON 2ND PASS NON MESSAGE STREAM          01750002
*                                                                       01800002
* EXITS,ERROR                                                           01850002
*         IEECVET1 - PROCESSOR 1 ON INVALID ENTRY                       01900002
*                                                                       01950002
* TABLES/WORK AREAS                                                     02000002
*    RESIDENT AND TRANSIENT DCMS AND UCM.  SEE DSECTS AT                02050002
*     END OF MODULE                                                     02100002
*                                                                       02150002
* ATTRIBUTES                                                            02200002
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC                                02250002
*                                                                       02300002
* CHARACTER CODE DEPENDENCY                                             02350002
*    NONE                                                               02400002
*                                                                       02450002
* NOTES                                                                 02500002
*    THE FOLLOWING FLAG BITS ARE USED:                                  02550002
*     THE ACTION CULUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF OR  02600002
*     JUST TESTED BY THIS MODULE                                        02650002
*                                                                       02700002
*      NAME       ACTION            FUNCTION                            02750002
*                                                                       02800002
*    DCMCMSG3                                                           02850002
*     DCMCMRLL      ON          WRITE ROLL MODE MESSAGE                 02900002
*                                                                       02950002
*    DCMFLG1                                                            03000002
*     DCMOUTPT  ON/OFF/TEST     INDICATES SECOND PASS THROUGH MODULE    03050002
*                                                                       03100002
*    DCMOPTST                                                           03150002
*     DCMOPRLL      ON          ROLL MODE                               03200002
*     DCMOPTAD      OFF         AUTO DELETE                             03250002
*                                                                       03300002
*    DCMR3FLG                                                           03350002
*     DCMSTSWT    OFF/TEST      STATUS SWITCH REQUIRED                  03400002
*                                                                       03450002
*    DCMTIMES                                                           03500002
*     DCMOPTTI      ON          DUMMY ROUTE FROM OPTIONS TO TIM/INT     03550002
*     DCMOTTMM      ON          ROUTE FROM TIM/INT TO MESSAGE MODULE    03600002
*                                                                       03650002
*    UCMDISP                                                            03700002
*     UCMDISPE     TEST         FULL CAPABILITY CONSOLE                 03750002
*     UCMDISPF     TEST         MESSAGE STREAM CONSOLE                  03800002
*                                                                       03850002
         EJECT                                                          03900002
**                                                                   ** 03950002
*                        REGISTER EQUATES                             * 04000002
**                                                                   ** 04050002
X1PARM   EQU   1                                                        04060002
XFBRANCH EQU   15                                                       04070002
PARM     EQU   1             HOLDS CXSA ADDRESS                         04100002
RBASE    EQU   4             RES DCM BASE REG                           04150002
RWTINT   EQU   5             END OF MESG AREA                           04200002
RLSCRN   EQU   6             LAST MESG LINE PTR                         04250002
RMSGAL   EQU   7             NO. OF MESSAGE LINES                       04300002
RADDRL   EQU   8             ADDR OF LAST SCT                           04350002
UCMBASE  EQU   9             UCM BASE                                   04400002
DCMBASE  EQU   10            DCM BASE                                   04450002
PBASE    EQU   11            PROGRAM BASE                               04500002
PXSA     EQU   12            CXSA ADDRESS                               04550002
UCMENTRY EQU   13            UCMENTRY BASE                              04600002
RETURN   EQU   14            RETURN REGISTER                            04650002
         EJECT                                                          04700002
**                                                                   ** 04750002
*              INITIALIZE PROGRAM                                     * 04800002
**                                                                   ** 04850002
         BALR  PBASE,N0            SET UP                               04900002
         USING *,PBASE             ADDRESSABILITY                       04950002
         B     ICATCH              BRANCH AROUND EYECATCHER             05000002
         DC    C'   MODULE IGC6R07B, FICHE IEECVFTR  ' EYECATCHER AND   05050002
ZAPAREA  DC    12C'ZAP'               RESERVED FOR FIELD MODIFICATION   05100002
ICATCH   LR    PXSA,PARM           SAVE CXSA ADDRESS                    05150002
         USING CXSA,PXSA           DECLARE CXSA ADDRESS                 05200002
         L     UCMENTRY,CSAUCM     GET UCM ENTRY ADDRESS                05300002
         USING UCMLIST,UCMENTRY    DECLARE UCMENTRY BASE                05350002
         L     RBASE,UCMXB         LOAD RES DCM BASE                    05400002
         USING DCMTSRT,RBASE          ESTABLISH ADDRESSABILITY          05450002
         L     DCMBASE,DCMADTRN   LOAD TRANSIENT DCM BASE               05500002
         USING DCMSTRT,DCMBASE       DECLARE DCM BASE                   05550002
         L     UCMBASE,CSACTLM     GET UCM POINTER                      05600002
         USING UCM,UCMBASE         DECLARE UCM BASE                     05650002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      05700002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    05710002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      05720002
         EJECT                                                          05750002
**                                                                   ** 05800002
*       TEST REASON FOR ENTRY AND TAKE APPROIATE ACTION               * 05850002
**                                                                   ** 05900002
*/* D (YES,%TEST2,NO,PROCEXIT) IS STATUS SWITCH REQUIRED? */            05950002
*************************************************************           06000002
TESTXX   TM    DCMR3FLG,DCMSTSWT   IS STATUS SWITCH REQUIRED            06050002
         BNO   PROCEXIT             NO, CONTINUE WITH NEXT TEST         06100002
         SPACE 4                                                        06150002
*/*%TEST2: D (NO,TESTEXIT,YES,TYPE) IS REOPEN BIT ON? */                06200002
*************************************************************           06250002
         TM    DCMCS,DCMCSO        IS REOPEN BIT ON                     06300002
         BNO   TESTEXIT             NO, TEST FOR SECOND PASS            06350002
         SPACE 4                                                        06400002
*/*TYPE: D (NO,OUTONLY,YES,) CHANGING TO FULL CAPACITY? */              06450002
*************************************************************           06500002
TYPE     TM    UCMDISP,UCMDISPE    ARE WE CHANGING TO FULL CAP          06550002
         BNO   OUTONLY              NO, SET FOR OUTPUT ONLY             06600002
         SPACE 4                                                        06650002
*/* P (,COMMON) SET UP FULL CAPACITY PARAMETERS */                      06700002
*************************************************************           06750002
         LA    RMSGAL,N8           SET PARMS FOR FULL CAP               06800002
         LA    RADDRL,DCMMSG8      LAST MESSAGE LINE SCT                06850002
         LA    RWTINT,DCMINSTR     LAST MESSAGE LINE + 1                06900002
         LA    RLSCRN,DCMMLAST     LAST LINE ON SCREEN                  06950002
         MVI   DCMSEC9,DCMMSGST    STOP SECONDARY SCT                   07000002
         B     COMMON              GO TO INSERT VALUES                  07050002
         SPACE 4                                                        07100002
*/*OUTONLY: P (,COMMON) SET UP OUTPUT ONLY PARAMETERS */                07150002
*************************************************************           07200002
OUTONLY  LA    RMSGAL,N11          NUMBER OF MESSAGE LINES              07250002
         LA    RADDRL,DCMMSG11     LAST MESSAGE LINE SCT                07300002
         LA    RWTINT,DCMWARN      LAST MESSAGE LINE + 1                07350002
         LA    RLSCRN,DCMENTR2     LAST LINE ON SCREEN                  07400002
         MVI   DCMSEC11+N1,DCMMSGST STOP SECONDARY SCT                  07450002
         MVI   DCMSEC9,N0          REMOVE OLD STOPPER                   07500002
         MVI   DCMMSG9,N0          REMOVE OLD SCT STOPPER               07550002
         EJECT                                                          07600002
*/*COMMON: P PUT PARAMETERS IN DCM */                                   07650002
*************************************************************           07700002
COMMON   STH   RMSGAL,DCMMSGAL     UPDATE NO. OF MSG LINES              07750002
         MVC   DCMRMSAL(N2),DCMMSGAL       IN BOTH DCMS                 07800002
         ST    RADDRL,DCMADDRL     UPDATE ADDR OF LAST SCT              07850002
         ST    RWTINT,DCMWTINT     END OF FULL SCREEN WRITE             07900002
         ST    RLSCRN,DCMLSCRN     UPDATE LAST MESG LINE                07950002
         MVI   N2(RADDRL),DCMMSGST STOP SCT TABLE                       08000002
         SPACE 5                                                        08050002
*/* P INDICATE REOPEN AND SECOND PASS */                                08100002
*************************************************************           08150002
         OI    DCMCS,DCMCSO        INDICATE REOPEN                      08200002
         OI    DCMFLG1,DCMOUTPT    INDICATE SECOND PASS                 08250002
         SPACE 5                                                        08300002
*/* P (,EXIT) SET EXIT TO CLEANUP (IEECVFTG) */                         08350002
*************************************************************           08400002
         L     XFBRANCH,DCMNCLN    LOAD CLEANUP ROUTINE ADDRESS         08450002
*                                  FOR EXIT TO IEECVFTG                 08500002
         SPACE 4                                                        08550002
**                                                                   ** 08600002
*                     EXIT PROCEEDURE                                 * 08650002
**                                                                   ** 08700002
*/*EXIT: R XCTL */                                                      08750002
*************************************************************           08800002
EXIT     EQU   *                       INITIALIZE FOR EXIT              08850002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 08900002
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             08950002
         SPACE 4                                                        09050002
*/*PROCEXIT: P (,EXIT) SET EXIT TO PROC 1 (IEECVET1) */                 09100002
*************************************************************           09150002
PROCEXIT L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  09200002
         B     EXIT                EXIT TO IEECVET1                     09250002
         EJECT                                                          09300002
*/*TESTEXIT: D (NO,TYPE,YES,) IS THIS SECOND PASS? */                   09350002
*************************************************************           09400002
TESTEXIT TM    DCMFLG1,DCMOUTPT    IS THIS SECOND PASS                  09450002
         BNO   TYPE                 NO, MODIFY DCM                      09500002
         SPACE 4                                                        09550002
*/* P TURN OFF STATUS SWITCH AND SECOND PASS */                         09600002
*************************************************************           09650002
         NI    DCMR3FLG,X'FF'-DCMSTSWT  TURN OFF STATUS SW. BIT         09700002
         NI    DCMFLG1,X'FF'-DCMOUTPT   TURN OFF SECOND PASS SWITCH     09750002
         SPACE 4                                                        09800002
*/* D (NO,,YES,TIMEXIT) IS CONSOLE NOW MESSAGE STREAM? */               09850002
*************************************************************           09900002
         TM    UCMDISP,UCMDISPF    IS IT NOW MESSAGE STREAM             09950002
         SPACE 4                                                        10000002
*/* P (,EXIT) SET EXIT FOR 2260 I/O 1 (IEECVETR) */                     10050002
*************************************************************           10100002
         BO    TIMEXIT                                                  10110002
         L     XFBRANCH,DCMIORTN                                        10120002
         B     EXIT                 RETURN TO I/O 1                     10150002
         SPACE 4                                                        10200002
*/*TIMEXIT: P SET ROLL DELETE MODE */                                   10250002
*************************************************************           10300002
TIMEXIT  MVC   DCMDEL(N2),RD       FORCE ROLL DELETE MODE               10350002
         OI    DCMOPTST,DCMOPRLL   TURN ON ROLL BIT                     10400002
         NI    DCMOPTST,X'FF'-DCMOPTAD   AUTO DELETE BIT OFF            10450002
         OI    DCMTIMES,DCMOTTMM+DCMOPTTI   GO FROM T/I TO MESG         10500002
         OI    DCMCMSG3,DCMCMRLL   WRITE ROLL MODE MESG                 10550002
         SPACE 5                                                        10600002
*/* P (,EXIT) SET EXIT TO TIMER/ INTERPRETER (IEECVETK) */              10650002
*************************************************************           10700002
         L     XFBRANCH,DCMNTIMR   LOAD TIMER INTERPRETER ADDRESS       10750002
         B     EXIT                EXIT TO IEECVETK                     10800002
         EJECT                                                          10850002
RD       DC    C'RD'               ROLL DELETABLE MODE                  10900002
**                                                                   ** 10950002
*              MISC  EQUATES                                          * 11000002
**                                                                   ** 11050002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            11060002
ID2      EQU   C'R'                2ND CHARACTER OF CSECT ID            11070002
N0       EQU   0                       NUMBER                           11100002
N1       EQU   1                       NUMBER                           11150002
N2       EQU   2                       NUMBER                           11200002
N3       EQU   3                       NUMBER                           11250002
N4       EQU   4                       NUMBER                           11300002
N8       EQU   8                       NUMBER                           11350002
N11      EQU   11                      NUMBER                           11400002
         SPACE 5                                                        11500002
*/*IEECVFTR: END */                                                     11550002
         EJECT                                                          11600002
         IHACTM  CXSA                                                   11700002
         EJECT                                                          11750002
         IEECUCM FORMAT=NEW                                             11850002
         EJECT                                                          11900002
         IEERDCM                                                        11950002
         EJECT                                                          12000002
DCMSTRT  DSECT                                                          12050002
         IEECDCM DEVICE=C                                               12100002
         END                                                            12150002
./  ADD  SSI=62050088,NAME=IEECVFTT
IEECVFTT CSECT                                                          00300000
*C081000,084500,114000                                        MH Y01565 00600000
*D107000,107500,137000-142000                                 MH Y01565 00900000
* C 080500-081000,084000-084500,093500-094000                 MB YM6838 01200000
*    THIS ROUTINE WAS CREATED FOR STATUS DISPLAY SUPPORT, LINE ITEM     01500000
*    21002, OS RELEASE 21.                                              01800000
         TITLE 'IEECVFTT - STATUS DISPLAY BLANKING FUNCTION'            02100000
*********************************************************************** 02400000
*                                                                     * 02700000
* STATUS                                                              * 03000000
*    CHANGE LEVEL=0                                                   * 03300000
*                                                                     * 03600000
* APARS FIXED ZA10060                                                 * 03900000
*                                                                     * 04200000
* FUNCTION                                                            * 04500000
*    TO OVERLAY WITH BLANKS ANY MESSAGE THAT IS BELOW  OR             * 04800000
*    BETWEEN  A   DISPLAY.                                            * 05100000
*    TO INDICATE IN THE SSCT THAT ALL LINES BELOW A DISPLAY HAVE      * 05400000
*    BEEN APPROPRIATELY BLANKED.                                      * 05700000
*                                                                     * 06000000
* ENTRY POINT                                                         * 06300000
*    IEECVFTT (CSECT NAME)                                            * 06600000
*                                                                     * 06900000
* INPUT                                                               * 07200000
*    REG 1 POINTS TO CXSA WHICH POINTS TO DCM  WHICH CONTAINS INDI-   * 07500000
*    CATORS.                                                          * 07800000
*    K COMMAND PARAMETER LIST POINTED TO IN THE DCM                   * 08100000
*    DCMADOPN POINTS TO OPERAND(S) IN PARAMETER LIST                  * 08400000
*                                                                     * 08700000
* OUTPUT                                                              * 09000000
*    BIT SETTINGS IN DCM AND SACB FOR OTHER ROUTINES TO ANALYZE       * 09300000
*    BLANKED SCREEN AREAS BELOW OR BETWEEN DISPLAYS                   * 09600000
*                                                                     * 09900000
* EXTERNAL REFERENCES                                                 * 10200000
*    SVC 34                                                           * 10500000
*                                                                     * 10800000
* EXITS,NORMAL                                                        * 11100000
*    I/O RTN    (DEVICE-DEPENDENT)                                    * 11400000
*    TO BLANK OUT MESSAGE AREAS BETWEEN  OR BELOW STATUS DISPLAYS.    * 11700000
*                                                                     * 12000000
* EXITS,ERROR                                                         * 12300000
*    TO PROCCESOR 1 UPON INCORRECT COMMAND INPUT                      * 12600000
*                                                                     * 12900000
* ATTRIBUTES                                                          * 13200000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC                              * 13500000
*                                                                     * 13800000
* TABLES/WORK AREAS                                                   * 14100000
*    UCM, DCM,CXSA, WQE, SACB                                         * 14400000
*                                                                     * 14700000
*                                                                     * 15000000
*********************************************************************** 15300000
         EJECT                                                          15600000
*/*IEECVFTT: CHART */                                                   15900000
*/* E IEECVFTT */                                                       16200000
*/*	BASES: P (,TSTBIT1) ESTABLISH ADDESSABILITY */                      16500000
*/*TSTBIT1: D (YES,BLANKRTN,NO,TSTBIT2) RETURN FROM I/O COMPLETE */     16800000
*/*TSTBIT2: D (YES,START,NO,ERROR) BLANKING FUNCTION REQUESTED */       17100000
*/*ERROR: P (,XCTL) MOVE IN PROCESSOR 1 NAME */                         17400000
*/*START: P (,VIEWABLE) TURN BLANKING FUNCTION BIT OFF */               17700000
*/*VIEWABLE: P (,DISPLAY) FIND TOP DISPLAY'S FIRST LINE */              18000000
*/*DISPLAY: P (,DISPLAY2) FIND FIRST LINE BELOW TOP DISPLAY */          18300000
*/*DISPLAY2: P (,BLANKIT2) FIND ZERO SSCT BYTE */                       18600000
*/* BLANKIT2: D (YES,BLANKIO,NO,SKIPBLNK) LINE ALREADY BLANKED */       18900000
*/*SKIPBLNK: D (YES,BLANKIO,NO,TSTMSGIN) END OF SSCT */                 19200000
*/*TSTMSGIN: D (YES,BLNKONLY,NO,	BLNK1) IS A MSG UNDERNEATH */          19500000
*/*	BLNK1: P (,BLNKONLY) BUMP BLANK LINE COUNTER */                     19800000
*/*BLNKONLY: P (,	SKP01) SET BLANK INDIC ON IN SSCT */                  20100000
*/*	SKP01: D (YES,BLANKIO,NO,BLANKIT2) DISPLAY LINE */                  20400000
*/*BLANKIO: P (,COMPREG) SAVE TABLE POINTERS */                         20700000
*/*COMPREG: D (YES,SAVECNT,NO,	CMP1) MORE THAN 3 LINES TO BLANK */      21000000
*/*	CMP1: D (YES,CONTCNT,NO,FINISHED) ANY LINES TO BLANK */             21300000
*/*CONTCNT: P (,IODISP2) BLANK ENTRY AREA AND INSTR. LINE */            21600000
*/* E BLANKET */                                                        21900000
*/*	B1: P (,	B2) BLANK A LINE */                                        22200000
*/*	B2: R RETURN TO CALLER */                                           22500000
*/*SAVECNT: P (,CONTCNT) SAVE LINE COUNT MINUS 3 FOR NEXT ROUND */      22800000
*/*BLANKRTN: P (,COMPREG) TURN DCMCMIN5 OFF; GET LINE COUNT TO BLANK    23100000
*/**/                                                                   23400000
*/*IODISP2: P (,IOEXIT) INDICATE TO I/O TO WRITE DISPLAY */             23700000
*/*IOEXIT: P (,XCTL) MOVE IN I/O NAME */                                24000000
*/*XCTL: R RETURN */                                                    24300000
*/*IEECVFTT: END */                                                     24600000
        EJECT                                                           24900000
*********************************************************************** 25200000
*    REGISTERS                                                          25500000
*                                                                       25800000
********************************************************************    26100000
X1PARM   EQU   1                                                        26400000
XERTRN   EQU   14                                                       26700000
XFBRANCH EQU   15                                                       27000000
XF       EQU   15                  WORK REG                             27300000
X14      EQU   14                  RETURN REG                           27600000
RETURN   EQU   14                  RETURN REG                           27900000
XD       EQU   13                  WORK REG                             28200000
SACBPT   EQU   13                  SACB BASE REG                        28500000
XC       EQU   12                  THIS RTN'S BASE REG                  28800000
XB       EQU   11                  CXSA BASE REG                        29100000
XA       EQU   10                  UCM BASE REG                         29400000
X9       EQU   9                   TRANSIENT DCM BASE REG               29700000
XRDCM    EQU   8                   RESIDENT DCM BASE REG                30000000
LIST     EQU   7                   UCMLIST BASE REG                     30300000
X6       EQU   6                   WORK REG                             30600000
X5       EQU   5                   WORK REG                             30900000
X4       EQU   4                   WORK REG                             31200000
X3       EQU   3                   WORK REG                             31500000
X2       EQU   2                   WORK REG                             31800000
X1       EQU   1                   WORK REG                             32100000
X0       EQU   0                   WORK REG                             32400000
         EJECT                                                          32700000
********************************************************************    33000000
*     EQUATES                                                           33300000
********************************************************************    33600000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            33900000
ID2      EQU   C'T'                2ND CHARACTER OF CSECT ID            34200000
E2       EQU   X'E2'               NUMBER                               34500000
ZERO     EQU   X'00'               NUMBER                               34800000
C0       EQU   X'C0'               NUMBER                               35100000
BLANK    EQU   X'40'               NUMBER                               35400000
N0       EQU   0                   NUMBER                               35700000
N1       EQU   1                   NUMBER                               36000000
N2       EQU   2                   NUMBER                               36300000
N3       EQU   3                   NUMBER                               36600000
N4       EQU   4                   NUMBER                               36900000
NC       EQU   12                  NUMBER                               37200000
NE       EQU   14                  NUMBER                               37500000
N255     EQU   255                 NUMBER                               37800000
EIGHT    EQU   X'80'               CONTROL LINE OF DISPLAY              38100000
         EJECT                                                          38400000
********************************************************************    38700000
*                                                                       39000000
*    ESTABLISH ADDRESSABILITY                                           39300000
*                                                                       39600000
********************************************************************    39900000
         SPACE 2                                                        40200000
         BALR  XC,N0               ESTABLISH ROUTINE'S                  40500000
         USING *,XC                BASE REGISTER                        40800000
         B     BEGIN               BRANCH AROUND PATCH AREA             41100000
ICATCH   DC    CL8'IEECVFTT'      EYECATCHER AND FIELD MAINTENANCE      41400000
         DC    CL8'&SYSDATE',CL56' ' DATE AND PATCH AREA       Y02958   41700000
BEGIN    EQU   *                   END OF PATCH AREA                    42000000
         LR    XB,X1               ESTABLISH CXSA                       42300000
         USING CXSA,XB             ADDRESSABILITY                       42600000
         L     XA,CSACTLM          ESTABLISH UCM ADDRESS                42900000
         USING UCM,XA              ADDRESSIBILITY                       43200000
         L     LIST,CSAUCM         LOAD UCM ENTRY ADDRESS               43500000
         USING UCMLIST,LIST        ESTABLISH UCM ENTRY  ADDRESSABILITY  43800000
         L     XRDCM,UCMXB         GET POINTER TO RESIDENT DCM          44100000
         USING DCMTSRT,XRDCM          ESTABLISH R DCM ADDRESSABILITY    44400000
         L     X9,DCMADTRN         LOAD TRANSIENT DCM PT                44700000
         USING DCMSTRT,X9         ESTABLISH TDCM BASE REG               45000000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      45300000
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    45600000
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      45900000
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          46200000
         LR    X1PARM,XB           PASS CXSA ADDRESS IN REG 1           46500000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        46800000
*********************************************************************** 47100000
*    TEST IF BLANKING IS IN PROCESS                                     47400000
********************************************************************    47700000
         TM    DCMCOM3,DCMCMIN7    Q. RETURN  FROM I/O COMPLETE         48000000
         BO    BLANKRTN            YES-MORE BLANKING WORK TO DO         48300000
         TM    DCMCOM2,DCMCBLNK    N0--IS BLANKING FUNCTION REQUIRED    48600000
         BO    START               YES-GO CHECK WHAT'S TO BE BLANKED    48900000
********************************************************************    49200000
*    IF NONE OF ABOVE, IT IS AN ERROR THAT SHOULD NEVER HAPPEN.         49500000
*    GO BACK TO PROCESSOR 1 SO THAT IT CAN CONTINUE PROCESSING          49800000
*    WITHOUT CAUSING POSSIBLE SYSTEM FAILURE.                           50100000
********************************************************************    50400000
ERROR    EQU   *                                                        50700000
         L     XFBRANCH,DCMNPROC       LOAD PROC 1 ADDRESS              51000000
         B     XCTL                    EXIT TO IEECVET1                 51300000
START    EQU   *                                                        51600000
         NI    DCMCOM2,N255-DCMCBLNK TURN OFF BLANKING FUNCTION BIT     51900000
         SR    X0,X0               CLEAR REG                            52200000
         L     X3,DCMADSEC         LOAD SSCT ADDR                       52500000
         L     X4,DCMAMTAB         LOAD SCT POINTER                     52800000
********************************************************************    53100000
*    THE FOLLOWING CODE SKIPS VIEWABLE MSGS                             53400000
********************************************************************    53700000
VIEWABLE EQU   *                                                        54000000
         TM    N0(X3),EIGHT       DOES THE LINE CONTAIN A DISPLAY       54300000
         BO    DISPLAY             YES-                                 54600000
         C     X4,DCMADDRL         END OF SCREEN              MB YM6838 54900000
         BH    ERROR               YES, NOTHING TO DO         MB YM6838 55200000
         LA    X3,N1(X3)           NO--BUMP SSCT POINTER                55500000
         LA    X4,N2(X4)           BUMP SCT POINTER                     55800000
         B     VIEWABLE                                                 56100000
********************************************************************    56400000
*    THE FOLLOWING CODE SKIPS THE FIRST DISPLAY                         56700000
********************************************************************    57000000
DISPCNT  EQU   *                                                        57300000
         C     X4,DCMADDRL         END OF SCREEN              MB YM6838 57600000
         BH    ERROR               YES, NOTHING TO DO         MB YM6838 57900000
DISPLAY  EQU   *                                                        58200000
         LA    X3,N1(X3)          BUMP SSCT TABLE POINTER               58500000
         LA    X4,N2(X4)           BUMP SCT POINTER                     58800000
         EJECT                                                          59100000
DISPLAY2 EQU   *                                                        59400000
         CLI   N0(X3),ZERO        Q. IS THERE A DISPLAY IN THIS LINE    59700000
*                                 OR IS THE LINE ALREADY BLANKED        60000000
         BNE   DISPCNT             YES-                                 60300000
BLANKIT1 EQU   *                                                        60600000
         SR    X0,X0               CLEAR REG                            60900000
         LR    X2,X3               PRIME BLANKING STOP ADDR REG         61200000
BLANKIT2 EQU   *                                                        61500000
         TM    N0(X3),DCMSECBL     WAS THIS LINE ALREADY BLANKED        61800000
         BO    BLANKIO            YES-DON'T COUNT IT                    62100000
         C     X4,DCMADDRL         END OF SCREEN              MB YM6838 62400000
         BNH   TSTMSGIN            NO, SEE IF MSG UNDERNEATH  MB YM6838 62700000
         LR    X3,X2               RESET TO SSCT STOP BLANKING ADDR     63000000
         B     BLANKIO2            YES -                                63300000
TSTMSGIN EQU   *                                                        63600000
         TM    N0(X4),DCMMSGIN     IS A MSG LINE UNDERNEATH             63900000
         BNO   BLNKONLY           NO - STOP BLANK LINE COUNT            64200000
         AH    X0,ONE              BUMP COUNTER                         64500000
         LA    X2,N1(X3)           BUMP BLANKING STOP ADDR              64800000
BLNKONLY EQU   *                                                        65100000
         OI    N0(X3),DCMSECBL     SET BLANK LINE INDIC. ON IN SSCT     65400000
SKIPBLNK EQU   *                                                        65700000
         LA    X3,N1(X3)           BUMP SSCT POINTER                    66000000
         LA    X4,N2(X4)           BUMP SCT POINTER                     66300000
         TM    N0(X3),E2           DOES THIS LINE HAVE A DISPLAY IN IT  66600000
         BZ    BLANKIT2            NO--INCLUDE IT IN THE BLANKING COUNT 66900000
         LR    X3,X2               RESET SSCT PT TO STOP BLANK ADDR     67200000
         BCTR  X3,N0               DECR. BY ONE FOR FALLING THRU        67500000
*                                  NEXT INSTRUCTION                     67800000
BLANKIO  EQU   *                                                        68100000
         LA    X3,N1(X3)           BUMP PT BY ONE FOR ALGORITHM FOLLOWS 68400000
BLANKIO2 EQU   *                                                        68700000
         S     X3,DCMADSEC         ISOLATE SSCT LINE NO.                69000000
         LA    X3,N1(X3)           BUMP BY 1 FOR 0 BASE                 69300000
         SR    X3,X0               SUBTR. COUNT TO BLANK                69600000
         STC   X3,DCMDSAV+NE       SAVE FOR LATER              @ZA10060 69900000
         LR    X4,X0               LOAD BLANK LINE COUNT                70200000
COMPREG  EQU   *                                                        70500000
         MVC   DCMLINEN(N1),DCMDSAV+NE MOVE TOP LINE NO.       @ZA10060 70800000
         CH    X4,THREE            Q. MORE THAN 3 LINES TO BLANK        71100000
         BH    SAVECNT             YES-                                 71400000
         LTR   X4,X4               ANY LINES TO BLANK                   71700000
         BNP   START           NO--THEN JOB IS FINISHED       MH Y01565 72000000
         XC    DCMDSAV+NC(N2),DCMDSAV+NC  SET CNTR TO NO LINES @ZA10060 72300000
CONTCNT  EQU   *                                                        72600000
         LR    X3,X4               SAVE NO. OF LINES                    72900000
         MH    X4,DCMCORLN         MULT. LINES BY LENGTH                73200000
         STH   X4,DCMBYTCT         SAVE BYTE COUNT FOR I/O RTN          73500000
         LH    X4,ONE              DO FIRST LINE OF BLANKS              73800000
         L     X5,DCMAINS          SET POINTER TO INSTRUCTION LINE      74100000
         BAL   XF,BLANKET          GO BLANK WRITE AREA                  74400000
         LR    X4,X3               RESTORE LINE COUNT                   74700000
         BCTR  X4,N0               DECREMENT FOR THE ONE JUST DONE      75000000
         LTR   X4,X4               ANY MORE TO BLANK                    75300000
         BNP   IODISP2             NO - STOP PROCESS OF BLANKING        75600000
         L     X5,DCMAENTR         LOAD ENTRY AREA                      75900000
         BAL   XF,BLANKET          GO BLANK WRITE AREA                  76200000
         B     IODISP2             GO TO I/O RTN TO WRITE OUT LINES     76500000
BLANKET  EQU   *                                                        76800000
         MH    X4,DCMLGNTH         MULT. LINE CNT BY LINE LENGTH        77100000
         MVI   N0(X5),BLANK        MOVE A BLANK CHAR                    77400000
         SH    X4,TWO              DECREMENT BY 2                       77700000
         EX    X4,BLANKWRT         SPREAD BLANKS THROUGHOUT LINE        78000000
         BR    XF                                                       78300000
SAVECNT  EQU   *                                                        78600000
         OI    DCMCOM3,DCMCMIN7    INDICATE RETURN TO THIS RTN          78900000
         SH    X4,THREE            DECREMENT LINE COUNT BY 3            79200000
         STH   X4,DCMDSAV+NC       SAVE LINE CNT TO BE DONE    @ZA10060 79500000
         LH    X4,THREE            PRIME LINE COUNT                     79800000
         SR    X3,X3               CLEAR REG                            80100000
         IC    X3,DCMDSAV+NE       LOAD LINE NO.               @ZA10060 80400000
         AR    X3,X4               BUMP LINE NO. COUNT BY 3             80700000
         STC   X3,DCMDSAV+NE       SAVE FOR LATER              @ZA10060 81000000
         B     CONTCNT             GO BLANK LINES                       81300000
BLANKRTN EQU   *                                                        81600000
         NI    DCMCOM3,N255-DCMCMIN7 TURN BIT OFF                       81900000
         SR    X4,X4               CLEAR REG                            82200000
         LH    X4,DCMDSAV+NC       PICK UP LINES TO BLANK      @ZA10060 82500000
         B     COMPREG                                                  82800000
IODISP2  EQU   *                                                        83100000
         OI    DCMIOCM2,DCMWINFD   INDICATE WRITE DISPLAY               83400000
IOEXIT   EQU   *                                                        83700000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              84000000
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     84300000
XCTL     EQU   *                                                        84600000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 84900000
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             85200000
BLANKWRT MVC   N1(N0,X5),N0(X5) EXEC. FOR BLANKING WRITE AREA           85500000
********************************************************************    85800000
ONE      DC    H'1'                CONSTANT                             86100000
TWO      DC    H'2'                                                     86400000
THREE    DC    H'3'                                                     86700000
FOUR     DC    H'4'                                                     87000000
********************************************************************    87300000
         EJECT                                                          87600000
********************************************************************    87900000
*                                                                       88200000
*    ALL DSECTS FOLLOW THIS POINT                                       88500000
*                                                                       88800000
********************************************************************    89100000
         IHACTM  CXSA                                                   89400000
         EJECT                                                          89700000
         IEECUCM  FORMAT=NEW                                            90000000
         EJECT                                                          90300000
         IEERDCM                                                        90600000
         EJECT                                                          90900000
         IEETDCM                                                        91200000
*********************************************************************** 91500000
         END                                                            91800000
./  ADD  SSI=32960805,NAME=IEECVFT1
IEECVFT1 CSECT                                                          00050002
*C 042500                                                     ME YM3236 00060002
*A 121100                                                     ME YM3236 00070002
         TITLE  'IEECVFT1  PROCESSOR ZERO.'                             00100002
*                                                                       00150002
* CHART ID.    F1                                                       00300002
*                                                                       00350002
* FUNCTION.    TO INITIATE THE DIRECT ACCESS WRITE NECESSARY TO         00400002
*              UPDATE THE PFK DEFINATIONS ON SYS1.DCMLIB AND TO         00450002
*              PROCESS THE ASSOCIATED I/O COMPLETES.                    00500002
*                                                                       00550002
* ATTRIBUTES.  REFRESHABLE,PRIVILEGED,TYPE 4 SVC                        00600002
*                                                                       00650002
* ENTRY POINTS.          ONLY AT CSECT LABEL, IEECVFT1                  00700002
*                                                                       00750002
* OPERATION.   THIS ROUTINE GAINS CONTROL FROM PFK ROUTINE 2            00800002
*              (IEECVFTB) WHEN A PFK DEFINATION HAS BEEN MADE           00850002
*              BY MEANS OF THE K N,PFK COMMAND. IT CONSTRUCTS           00900002
*              THE CHANNEL PROGRAM NECESSARY TO INITIATE THE            00950002
*              WRITE AND EXITS TO PROCESSOR ONE (IEECVET1).             01000002
*              PROCESSOR ONE GIVES CONTROL TO THIS ROUTINE UPON         01050002
*              COMPLETION OF A PFK UPDATE WRITE. THIS ROUTINE           01100002
*              DETERMINES WHETHER THE ENTIRE PFK AREA HAS BEEN          01150002
*              WRITTEN OUT, AND IF NOT, UPDATES THE CHANNEL PROGRAM     01200002
*              AND INITIATES THE NEXT WRITE. IF I/O CANNOT BE           01250002
*              STARTED, EXIT IS MADE TO THE DEVICE I/O ROUTINE          01300002
*              TO BLANK THE ENTRY AREA.                                 01310002
*                                                                       01350002
* EXITS ( ERROR ).       NONE.                                          01400002
*                                                                       01450002
* EXITS ( NORMAL ).      PROCESSOR ONE (IGC5107B), IF I/O IS STARTED.   01500002
*                        OTHERWISE, TO THE DEVICE I/O ROUTINE.          01510002
*                                                                       01550002
* INPUT.       REGISTER ONE CONTAINS A POINTER TO CXSA. IT IS ASSUMED   01600002
*              UPON ENTRY THAT A PFK UPDATE IS IN PROCESS OR DESIRED.   01650002
*                                                                       01700002
* EXTERNAL REFERENCES.   WTO (SVC 35).                                  01750002
*                                                                       01800002
* ERROR CONDITIONS.      DIRECT ACCESS I/O ERRORS ARE DETECTED AND AN   01850002
*                        APPROIATE MESSAGE IS PASSED TO THE OPERATOR.   01900002
*                                                                       01950002
* TABLES AND WORK AREAS.           DCM AND A RESIDENT AREA CONTAINING   02000002
*                                  CONTROL BLOCKS FOR DISK I/O.         02050002
*                                                                       02100002
* RESTRICTIONS.          NONE.                                          02150002
         EJECT                                                          02200002
*********************************************************************** 02250002
*        PROGRAM INITIALIZATION                                       * 02300002
*********************************************************************** 02350002
*/*IEECVFT1: CHART */                                                   02400002
*/*%A: E (,START) IEECVFT1 */                                           02450002
*/*START: P (,PFKTEST) PROGRAM INITIALIZATION */                        02500002
*************************************************************           02550002
START    BALR  RBASE,N0            ESTABLISH                  MC        02600002
         USING *,RBASE             PROGRAM ADDRESSABILITY     MC        02650002
         B     BEGIN               BRANCH AROUND PATCH AREA             02660002
ICATCH   DC    CL72'IEECVFT1'      EYECATCHER AND FIELD MAINTENANCE     02670002
BEGIN    EQU   *                   END OF PATCH AREA                    02680002
         LR    RCXSA,P1            ESTABLISH                  MC        02700002
         USING CXSA,RCXSA          CXSA ADDRESSABILITY        MC        02750002
         L     RENTRY,CSAUCM       ESTABLISH                  MC        02850002
         USING UCMLIST,RENTRY      UCMENTRY ADDRESSABILITY    MC        02900002
         L     RRDCM,UCMXB         ESTABLISH                  MC        02950002
         USING DCMTSRT,RRDCM      R DCM ADDRESSABILITY       MC         03000002
         L     RTDCM,DCMADTRN      ESTABLISH                  MC        03050002
         USING DCMSTRT,RTDCM       T DCM ADDRESSABILITY       MC        03100002
         L     RSUB,DCMSUBAD       ESTABLISH                  MC        03150002
         USING IEECVSUB,RSUB       SUB ADDRESSABILITY         MC        03200002
         L     RDCB,SUBBLK         LOAD DCB BASE REGISTER     MC        03250002
         USING SUBDCB,RDCB         ESTABLISH ADDRESSABILITY   MC        03300002
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD TRACE ENTRIES      03310002
         MVI   DCMTREN1,ID1        PUT CSECT ID INTO                    03320002
         MVI   DCMTREN2,ID2        NEW TRACE ENTRY                      03330002
         L     XFBRANCH,CSAXC      ADDRESS FREELOCK SUBROUTINE          03340002
         LR    X1PARM,RCXSA        PASS CXSA ADDRESS IN REG 1           03342002
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS                        03344002
         EJECT                                                          03350002
*********************************************************************** 03400002
*        ROUTE CONTROL TO PFK UPDATE, I/O COMPLETE, OR EXIT.          * 03450002
*********************************************************************** 03500002
*/*PFKTEST: D (YES,%B,NO,IOTEST) IS PFK UPDATE DESIRED */               03550002
*************************************************************           03600002
PFKTEST  TM    DCMCOM3,DCMPFKWR    UPDATE PFK MEMBER          MC        03650002
         BZ    IOTEST              NO, BRANCH                 MC        03700002
         NI    DCMCOM3,N255-DCMPFKWR    SET OFF FLAG          MC        03750002
         TM    SUBFLGS,SUBPKLIB    ARE PFKS SUPPORTED         MC        03800002
         BZ    EXIT                NO, IGNORE UPDATE REQUEST  MC        03850002
         OI    SUBFLGS,SUBPFKWR    SET ON SUB FLAG            MC        03860002
         SPACE 3                                                        03900002
*/*%B: D (YES,EXIT,NO,PFKRTN) IS I/O ROUTINE BUSY */                    03950002
*************************************************************           04000002
         TM    SUBDAIO,SUBIOUSE    IS I/O ROUTINE BUSY        MC        04050002
         BZ    PFKRTN              NO, BRANCH                           04060002
         SPACE 3                                                        04100002
*/*EXIT: P (,EXIT2) INIT FOR I/O ROUTINE EXIT */                        04110002
*************************************************************           04120002
EXIT     L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              04130002
*                                  FOR EXIT TO IEECVET(H,P,R, OR U)     04132002
         SPACE 3                                                        04140002
*/*EXIT2: P (,%P) ZERO ECB AND INIT FOR EXIT */                         04140402
*************************************************************           04144002
EXIT2    MVI   UCMECB,N0           ZERO ECB                   MC        04146002
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 04148002
         SPACE 3                                                        04148902
*/*%P: R XCTL */                                                        04149002
*************************************************************           04149102
         BR    XFBRANCH            EXIT ADDRESS ALREADY SET             04149202
         EJECT                                                          04149602
*/*PFKRTN: P (,%F) INITIALIZE POINTERS AND FLAGS */                     04149702
*************************************************************           04149802
PFKRTN   NI    SUBFLGS,N255-SUBPFKWR  SET OFF UPDATE REQUEST  MC        04149902
         L     RB,SUBPFKAD         LOAD DATA ADDRESS          MC        04166602
         LA    RA,N4(RB)           POINT TO ELEMENT           MC        04176602
         ST    RA,SUBRLPTR         SAVE ELEMENT POINTER       MC        04178602
         SPACE 3                                                        04180602
*/*%F: P (,EXCP) BUILD CHANNEL PROGRAM */                               04182602
*************************************************************           04183002
         ST    RB,TYPE             STORE DATA POINTER         MC        04183102
         MVI   TYPE,ND             SET CCW WRITE CODE         MC        04183202
         MVC   LENGTH(N2),N0(RA)   MOVE LENGTH TO CCW         MC        04188802
         NI    LENGTH,NOSTOP       ZERO POSSIBLE STOPPER      MC        04190802
         MVC   SEEK(N8),N2(RA)     MOVE TTR TO IOB            MC        04192802
         ST    RENTRY,IOB+N4       STORE ECB POINTER          MC        04193202
         SPACE 3                                                        04193602
*/*EXCP: P (,%G) SET ON BUSY FLAGS */                                   04194002
*************************************************************           04194102
EXCP     OI    UCMSTS,UCMBF        SET ON BUSY FLAG           MC        04194202
         OI    SUBDAIO,SUBIOUSE    IND I/O ROUTINE IS BUSY    MC        04194302
         OI    DCMR3FLG,DCMR3PKA   IND DA I/O COMPLETE        MC        04208202
         SPACE 3                                                        04218202
*/*%G: S (,EXIT2) EXCP: EXECUTE CHANNEL PROGRAM */                      04220202
*************************************************************           04220602
         LA    P1,IOB              LOAD IOB POINTER           MC        04221002
         SVC   0                   EXECUTE CHANNEL PROGRAM    MC        04221402
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  04221502
*                                  FOR EXIT TO IEECVET1                 04221602
         B     EXIT2               RETURN                     MC        04221802
         EJECT                                                          04221902
*********************************************************************** 04222002
*        PROCESS I/O COMPLETE AND START NEXT PORTION IF NECESSARY     * 04222102
*********************************************************************** 04226702
*/*IOTEST: D (YES,%E,NO,EXIT2) I/O COMPLETE POSTED */                   04231502
*************************************************************           04236102
IOTEST   TM    UCMECB,IOCOMP       IS THERE AN I/O COMPLETE   ME YM3236 04250002
         BNZ   IODONE              YES, LOOK AT IT                      04300002
         L     XFBRANCH,DCMNPROC   LOAD PROC 1 ADDRESS                  04310002
         B     EXIT2               EXIT TO IEECVET1                     04320002
         SPACE 3                                                        04350002
*/*%E: P (,%N) INITIALIZE POINTERS AND FLAGS */                         04360002
*************************************************************           04370002
IODONE   NI    SUBDAIO,N255-SUBIOUSE    SET OFF I/O RTN BUSY            04380002
         NI    UCMSTS,N255-UCMBF        SET OFF BUSY FLAG     MC        04390002
         L     RA,SUBRLPTR              POINT TO TTR ELEMENT  MC        04392002
         NI    UCMDEVC,N255-UCMDEVE     SET OFF I/O COMP FLG  MC        04394002
         SPACE 3                                                        04396002
*/*%N: D (YES,%C,NO,ERROR) WAS I/O GOOD */                              04398002
*************************************************************           04398402
GOODIO   CLI   UCMECB,GOOD         WAS I/O SUCCESSFUL         MC        04398802
         BNE   ERROR               NO, BRANCH                 MC        04399202
         SPACE 3                                                        04399702
*/*%C: D (YES,CLEAR,NO,%D) WAS WRITE FINISHED */                        04399802
*************************************************************           04399902
         TM    N0(RA),STOP         WAS WRITE FINISHED         MC        04416602
         BO    CLEAR               YES, BRANCH                MC        04426602
         SPACE 2                                                        04428602
*/*%D: P (,EXCP) UPDATE CHANNEL PROGRAM */                              04430602
*************************************************************           04432602
         L     RX,TYPE             LOAD DATA ADDRESS          MC        04433002
         AH    RX,LENGTH           ADD LENGTH WRITTEN         MC        04433102
         ST    RX,TYPE             STORE UPDATED ADDRESS      MC        04433202
         LA    RA,N10(RA)          UPDATE TTR POINTER         MC        04438802
         ST    RA,SUBRLPTR         SAVE POINTER               MC        04440802
         MVC   LENGTH(N2),N0(RA)   MOVE LENGTH TO CCW         MC        04442802
         NI    LENGTH,NOSTOP       ENSURE STOPPER IS OFF      MC        04443202
         MVC   SEEK(N8),N2(RA)     TTR DATA TO IOB            MC        04443602
         B     EXCP                BRANCH                     MC        04444002
         SPACE 2                                                        04447602
*/*CLEAR: D (YES,PFKRTN,NO,EXIT) ANOTHER UPDATE REQUESTED */            04451202
*************************************************************           04454702
CLEAR    TM    SUBFLGS,SUBPFKWR    UPDATE PF KEYS             MC        04458202
         BO    PFKRTN              YES, BRANCH                MC        04468202
         B     EXIT                NO, BRANCH                 MC        04478202
         EJECT                                                          04480202
*********************************************************************** 04482202
*        OUTPUT ERROR MESSAGE                                         * 04482602
*********************************************************************** 04484202
*/*ERROR: S (,NOMSG) WTO: PFK UPDATE FAILED */                          04484602
*************************************************************           04485002
ERROR    GETMAIN  R,SP=255,LV=48                              MC        04485402
         LTR   REPT,REPT           WAS GETMAIN SUCCESSFUL     MC        04485802
         BNZ   NOMSG               NO, BRANCH                 MC        04485902
         LR    P2,P1               SAVE GETMAIN ADDRESS       MC        04486002
         MVC   N0(N48,P2),WTO+N4   MOVE MSG TO GETMAIN AREA   MC        04490602
         SVC   35                  ISSUE MESSAGE              MC        04492602
         LR    P1,P2               RESTORE GETMAIN PARAMETER  MC        04494602
         FREEMAIN  R,LV=48,A=(1),SP=255                       MC        04495002
         SPACE 2                                                        04495102
*/*NOMSG: P (,EXIT) SET OFF SUPPORT AND UPDATE FLAGS */                 04495202
*************************************************************           04495302
NOMSG    NI    SUBFLGS,N255-SUBPKLIB    NO LONGER UPDATE PFK  MC        04495402
         NI    SUBFLGS,N255-SUBPFKWR    SET OFF REQUEST FLAG  MC        04521402
         B     EXIT                EXIT                       MC        04531402
         SPACE 2                                                        04541402
WTO      WTO   'IEE934I PFK UPDATE FAILED',ROUTCDE=(1)        MC        04543402
         SPACE 2                                                        04545402
*/*IEECVFT1: END */                                                     04547402
*************************************************************           04547502
         EJECT                                                          07950002
*********************************************************************** 10000002
*        REGISTER EQUATES                                             * 10050002
*********************************************************************** 10100002
X1PARM   EQU   1                                                        10150002
XERTRN   EQU   14                                                       10160002
XFBRANCH EQU   15                                                       10200002
P1       EQU   1                   PARAMETER REGISTER                   10250002
P2       EQU   2                   WORK REGISTER                        10300002
RBASE    EQU   3                   PROGRAM BASE                         10350002
RSUB     EQU   4                   SUB BASE REGISTER                    10400002
RENTRY   EQU   5                   UCMENTRY BASE REGISTER               10450002
RRDCM    EQU   6                   R DCM BASE REGISTER                  10500002
RTDCM    EQU   7                   T DCM BASE REGISTER                  10550002
RCXSA    EQU   9                   CXSA BASE REGISTER                   10650002
RDCB     EQU   10                  TEMP BASE DURING EXCP ROUTINE        10700002
RA       EQU   11                  WORK REGISTER                        10750002
RB       EQU   12                  WORK REGISTER                        10800002
RX       EQU   13                  WORK REGISTER                        10850002
RRTN     EQU   14                  CXSA BASE                            10950002
REPT     EQU   15                  ENTRY POINT REGISTER                 11000002
         SPACE 4                                                        11050002
*********************************************************************** 11100002
*        MISC PROGRAM EQUATES                                         * 11150002
*********************************************************************** 11200002
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            11210002
ID2      EQU   C'1'                2ND CHARACTER OF CSECT ID            11220002
N0       EQU   0                   NUMBER                               11250002
N1       EQU   1                   NUMBER                               11300002
N2       EQU   2                   NUMBER                               11350002
N3       EQU   3                   NUMBER                               11400002
N4       EQU   4                   NUMBER                               11450002
N8       EQU   8                   NUMBER                               11500002
N10      EQU   10                  NUMBER                               11550002
N48      EQU   48                  NUMBER                               11800002
N255     EQU   X'FF'               NUMBER                               11900002
ND       EQU   X'0D'               NUMBER                               11950002
NOSTOP   EQU   X'7F'               UNSTOPPER FLAG                       12000002
GOOD     EQU   X'7F'               GOOD I/O INDICATOR                   12050002
STOP     EQU   X'80'               STOPPER FLAG                         12100002
IOCOMP   EQU   X'40'               I/O COMPLETE BIT           ME YM3236 12110002
         EJECT                                                          12150002
*********************************************************************** 12200002
*        PROGRAM DSECT AREA                                           * 12250002
*********************************************************************** 12300002
         IHACTM  CXSA                                                   12400002
         EJECT                                                          12450002
         IEECUCM FORMAT=NEW                                             12550002
         EJECT                                                          12560002
         IEERDCM                                                        12600002
         EJECT                                                          12700002
         IEETDCM                                                        12800002
         EJECT                                                          12850002
IEECVSUB DSECT                                                          12900002
         IEECSUB  Y,N,N,N,Y,Y                                           12950002
         END                                                            13000002
./  ADD  SSI=41210086,NAME=IEECVFT2
* /* START OF SPECIFICATIONS ****************************************** 00050000
*                                                                       00100000
*01*  MODULE-NAME = IEECVFT2                                            00150000
*                                                                       00200000
*01*  DESCRIPTIVE-NAME = DISPLAY 3 ROUTINE                              00250000
*                                                                       00300000
*01*  COPYRIGHT = NONE                                                  00350000
*                                                                       00400000
*01*  STATUS = CHANGE LEVEL 1 FOR VS2 RELEASE 2                         00450000
*                                                                       00500000
* D 165500-168000                                             JE YM6828 00510003
* A 125100-125484,170600-170980,189500                        JE YM6828 00520003
* C 214500                                                    JE YM6828 00530003
*01*  FUNCTION = TO MOVE THE TEXT OF MESSAGES FOUND ON THE CONSOLE      00550000
*     QUEUE INTO THE SCREEN IMAGE BUFFER LINES OF THE DCM ALONG WITH    00600000
*     THE APPROPRIATE MESSAGE FLAGGING. WHEN AN IN-LINE MLWTO IS FOUND  00650000
*     ON THE QUEUE, CONTROL IS PASSED TO IEECVFTL TO HANDLE IT. WHEN    00700000
*     THE SCREEN IS FULL, OR NO MORE MESSAGES REMAIN ON THE QUEUE,      00750000
*     CONTROL IS RETURNED TO IEECVET2, DISPLAY 1, TO CONTROL FURTHER    00800000
*     PROCESSING.                                                       00850000
*                                                                       00900000
*01*  NOTES = LOCAL AND CROSS-MEMORY LOCKS ARE OBTAINED ON ENTRY VIA    00950000
*     THE GETLOCK SUBROUTINE ADDRESSED IN THE CXSA (CSAXB).             01000000
*                                                                       01050000
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01100000
*                                                                       01150000
*02*    DEPENDENCIES = NONE                                             01200000
*                                                                       01250000
*02*    RESTRICTIONS = NONE                                             01300000
*                                                                       01350000
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES                     01400000
*                                                                       01450000
*02*    PATCH-LABEL = ICATCH A DC STATEMENT                             01500000
*                                                                       01550000
*01*  MODULE-TYPE = MODULE                                              01600000
*                                                                       01650000
*02*    PROCESSOR = ASSEMF-370R                                         01700000
*                                                                       01750000
*02*    MODULE-SIZE = X'3D8' BYTES                                      01800000
*                                                                       01850000
*02*    ATTRIBUTES = REENTERABLE                                        01900000
*                                                                       01950000
*01*  ENTRY-POINT = IEECVFT2                                            02000000
*                                                                       02050000
*02*    PURPOSE = THIS IS THE ONLY ENTRY POINT TO PERFORM ALL FUNCTIONS 02100000
*                                                                       02150000
*02*    LINKAGE = BALR                                                  02200000
*                                                                       02250000
*02*    INPUT = REGISTER 1 ADDRESSES THE CXSA                           02300000
*       SEE ALSO CONTROL BLOCKS USAGE                                   02350000
*                                                                       02400000
*02*    OUTPUT = REGISTER 1 ADDRESSES THE CXSA                          02450000
*       SEE ALSO CONTROL BLOCKS USAGE AND EXITS                         02500000
*                                                                       02550000
*02*    EXIT-NORMAL = IEECVET2 - DISPLAY ROUTINE 1                      02600000
*                                                                       02650000
*02*    EXIT-NORMAL = IEECVFTL - IN-LINE MLWTO DISPLAY ROUTINE          02700000
*                                                                       02750000
*02*    EXIT-ERROR = NONE                                               02800000
*                                                                       02850000
*01*  EXTERNAL-REFERENCES = NONE                                        02900000
*                                                                       02950000
*02*    ROUTINES = GETLOCK SUBROUTINE - DEFINED IN IEECVET1, AND        03000000
*       ADDRESSED BY WORD CSAXB OF THE CXSA ON ENTRY.                   03050000
*                                                                       03100000
*02*    DATA-SETS = NONE                                                03150000
*                                                                       03200000
*02*    DATA-AREA = NONE                                                03250000
*                                                                       03300000
*02*    CONTROL-BLOCKS = CXSA,UCM,WQE,CQE,RDCM,TDCM                     03350000
*                                                                       03400000
*01*  TABLES = NONE                                                     03450000
*                                                                       03500000
*01*  MACROS = EXECUTABLE - NONE                                        03550000
*              MAPPING - IHAWQE  WQE DSECT                              03600000
*                        IHACTM  CXSA DSECT                             03650000
*                        IHACTM  CQE DSECT                              03700000
*                        IEECUCM UCM DSECT                              03750000
*                        IEERDCM RESIDENT DCM DSECT                     03800000
*                        IEETDCM PAGEABLE DCM DSECT                     03850000
*                                                                       03900000
*02*    ROUTINES = GETLOCK SUBROUTINE - DEFINED IN IEECVET1, AND        03950000
*       ADDRESSED BY WORD CSAXB OF THE CXSA ON ENTRY.                   04000000
*                                                                       04050000
**** END OF SPECIFICATIONS *******************************************/ 04100000
         TITLE 'IEECVFT2 DISPLAY 3 '                                    04150000
*/*IEECVFT2:     CHART */                                               04200000
*/*              HEADER                                                 04250000
*/*          IEECVFT2                   DISPLAY 3                       04300000
*/*           CHART F2           PAGE #    */                           04350000
*/*      E     IEECVFT2  */                                             04360000
IEECVFT2 CSECT                                                          04400000
*********************************************************************** 04450000
*        REGISTER EQUATES                                               04500000
*********************************************************************** 04550000
*                                                                       04600000
XFBRANCH EQU   15        BRANCH EXIT TO OTHER ROUTINES                  04650000
XFQUOTEN EQU   15        ODD REG FOR DIVISION                           04700000
XEMVC    EQU   14        TO ADDRESS EXECUTED MOVE INSTRUCTIONS          04750000
XERTRN   EQU   14        RETURN BRANCH REG                              04800000
XEREMAIN EQU   14        EVEN REG FOR DIVISION                          04850000
XDWORK   EQU   13        TEMPORARY WORK REGISTER                        04900000
XCPBASE  EQU   12        PROGRAM BASE REG                               04950000
XBTDCM   EQU   11        PAGEABLE DCM BASE REG                          05000000
XARDCM   EQU   10        RESIDENT DCM BASE REG                          05050000
X9SCNSRT EQU   9         TO BACKSCAN TEXT FOR SPLIT POINTS              05100000
X9UCM    EQU   9         UCM BASE REG                                   05150000
X8UCME   EQU   8         UCM ENTRY BASE REG                             05200000
X7WQE    EQU   7         WQE BASE                                       05250000
X7CQE    EQU   7         CQE BASE                                       05300000
X6DOM    EQU   6         DOM TABLE ENTRY POINTER                        05350000
X5SCT    EQU   5         SCT ENTRY POINTER                              05400000
X4MSG    EQU   4         MESSAGE AREA TEXT POINTER                      05450000
X3PADS   EQU   3         NUMBER OF CONTINATION LINES PASSED TO ET3      05500000
X2START  EQU   2         START POINT FOR MOVING MESSAGE TEXT            05550000
X2WORK   EQU   2         WORK REG                                       05600000
X1PARM   EQU   1         CXSA ADDRESS ON ENTRY AND EXIT                 05650000
X0WORK   EQU   0         TEMPORARY WORK REGISTER                        05750000
         EJECT                                                          05750100
*********************************************************************** 05800000
*    INITIALIZE PROGRAM                                                 05850000
*                                                                       05900000
*********************************************************************** 05950000
         BALR  XCPBASE,N0          LOAD PROGRAM BASE REGISTER           06000000
         USING *,XCPBASE           ESTABLISH PROG ADDRESSABILITY        06050000
         B     BEGIN               BRANCH AROUND PATCH AREA             06100000
ICATCH   DC    CL72'IEECVFT2'      EYECATCHER AND FIELD MAINTENANCE     06150000
BEGIN    EQU   *                   END OF PATCH AREA                    06200000
         USING CXSA,X1PARM         ESTABLISH CXSA ADDRESSABILITY        06250000
         USING UCMLIST,X8UCME      ESTABLISH UCMENTRY ADDRESSABILITY    06300000
         USING UCM,X9UCM           ESTABLISH UCM ADDRESSABILITY         06350000
         USING DCMTSRT,XARDCM      ESTABLISH R DCM ADDRESSABILITY       06400000
         USING DCMSTRT,XBTDCM      ESTABLISH DCM ADDRESS                06450000
         L     X8UCME,CSAUCM       UCM ENTRY BASE                       06500000
         L     X9UCM,CSACTLM        UCM BASE                            06550000
         L     XARDCM,UCMXB        RESIDENT DCM BASE                    06600000
         L     XBTDCM,DCMADTRN     PAGEABLE DCM BASE                    06650000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD ENTRIES            07050000
         MVI   DCMTREN1,ID1        MOVE IN CSECT ID OF                  07100000
         MVI   DCMTREN2,ID2        'F2' FOR IEECVFT2                    07150000
         SPACE 2                                                        07152000
*/*      S     GETLOCK: OBTAIN LOCAL AND CROSS-MEMORY LOCKS  */         07154000
*********************************************************************** 07154400
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           07155000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         07160000
         SPACE 3                                                        07350000
*/*     D (YES,,NO,NONIP) IS THIS FIRST MESSAGE */                      07350100
*********************************************************************** 07400000
*        ADJUSTMENTS FOR FIRST WRITE OF IPL'ED CONSOLE                * 07410000
*********************************************************************** 07420000
         CLI   DCMLINEN,N0         IS THIS FIRST MSG.                   07430000
         BNZ   NONIP               NO,BRANCH                            07440000
         TM    DCMRFLGS,DCMNIPP    THIS DCM USED BY NIP                 07446000
         BZ    NONIP               NO, BRANCH                           07448000
         NI    DCMRFLGS,N255-DCMNIPP    SET OFF NIP USE FLAG            07448400
         MVI   DCMLINEN,N1         INITIALIZE POINTER                   07449200
         LA    X2WORK,N8           GET NUMBER OF NIPS MSGS.             07449600
         MH    X2WORK,DCMCORLN     MULTIPLY BY LINE LENGTH              07449700
         AH    X2WORK,DCMBYTCT     ADD WRITE BYTE COUNT                 07449800
         STH   X2WORK,DCMBYTCT     UPDATE WRITE COUNT                   07449900
         EJECT                                                          07460000
*/*NONIP: D    (NO,,YES,INTFACE1)  WORKING ON MLWTO  */                 07462000
*********************************************************************** 07464000
NONIP    EQU   *                   CONTINUE NORMAL PROCESSING           07466600
         LA    X1PARM,N1           BEGIN LINE COUNT                     07500000
         L     X5SCT,DCMAMTAB      POINT TO SCT                         07550000
         L     X6DOM,DCMDOMPK      POINT TO DOM TABLE                   07600000
         L     X4MSG,DCMASCRN      POINT TO SIB                         07650000
         TM    UCMSTS,UCMTC        IF BIT IS ON THEN MLWTO WRITE        07750000
         BO    INTFACE1            FOR INT1 IS NOT FINISHRD             07800000
         SPACE 2                                                        07850000
*/*      D     (YES,,NO,MSGTEST)   RETURN FROM MLWTO HANDLING  */       07860000
*********************************************************************** 07870000
         TM    DCMCOM3,DCMXINT1    RETURN FROM INTERFACE 1 RTN          07900000
         BNO   MSGTST              NO--SKIP                             07950000
         NI    DCMCOM3,N255-DCMXINT1 TURN OFF FLAG BIT FOR INT1         08000000
         SPACE 2                                                        08010000
*/*      P     (,STARTEST)         GET NEXT CQE  */                     08020000
*********************************************************************** 08030000
         L     X7CQE,UCMWLAST      YES-LOAD ADDR OF NEXT CQE TO         08050000
         USING CQE,X7CQE           DECLARE CQE BASE                     08060000
         B     STARTEST            START WORKING ON                     08070000
         EJECT                                                          08120000
*/*MSGTEST: D  (NO,,YES,STARTEST)  ANY MESSAGES ON CONSOLE Q  */        08550000
*********************************************************************** 08560000
MSGTST   EQU   *                                                        08600000
         L     X7CQE,UCMOUTQ       CONSOLE Q POINTER                    08650000
         LA    X7CQE,N0(X7CQE)     CLEAR HIGH ORDER BYTE                08700000
         LTR   X7CQE,X7CQE         VALID ADDRESS                        08750000
         BNZ   STARTEST            YES, START PROCESSING MESSAGES       08800000
         SPACE 2                                                        08802000
*/*FINISH: P   TURN OFF OUTPUT PENDING IN UCM ENTRY  */                 08804000
*********************************************************************** 08806000
FINISH   EQU   *                                                        08810000
         NI    UCMSDS5,N255-UCMSDS5B TURN OFF OUTPUT FLAG               08820000
         SPACE 2                                                        08822000
*/*DISP1: R    BRANCH IEECVET2  */                                      08824000
*********************************************************************** 08826000
DISP1    EQU   *                                                        08830000
         OI    DCMCOM3,DCMCDSP3    INDICATE ENTRY IS FROM HERE          08832000
         L     XFBRANCH,DCMNDSP1   LOAD DISPLAY 1 ADDRESS               08840000
         L     X1PARM,DCMCXSVE     PASS CXSA ADDRESS IN REG 1           08842000
         BR    XFBRANCH            EXIT TO IEECVET2                     08844000
         SPACE 2                                                        08846000
*/*STARTEST: D (YES,,NO,TESTDISP)  END OF THIS CQE BLOCK  */            08848000
*********************************************************************** 08848400
STARTEST EQU   *                                                        08850000
         TM    CQEFLAG,CQEEOB      IS THIS A POINTER TO A NEW BLK       08900000
         BNO   TESTDISP            NO TEST FOR DISPLAY                  08950000
         SPACE 2                                                        08960000
*/*      P     GET NEXT BLOCK OF CQES  */                               08970000
*********************************************************************** 08980000
         L     X7CQE,CQEWQE        PICK UP NEXT BLOCK PTR               09000000
         B     STARTEST            RETRY                                09050000
         SPACE 2                                                        09060000
*/*TESTDISP: D (NO,,YES,INSRT)     THIS CQE TO BE SERVICED  */          09070000
*********************************************************************** 09080000
TESTDISP EQU   *                                                        09100000
         TM    CQEFLAG,CQEENTR     ENTRY TO BE SERVICED                 09150000
         BO    INSRT               YES, SEE IF PURGE BIT IS ON          09200000
         SPACE 2                                                        09210000
*/*ENDLIST: D  (NO,,YES,FINISH)    END OF CONSOLE Q  */                 09220000
*********************************************************************** 09230000
ENDLIST  EQU   *                                                        09250000
         TM    CQEFLAG,CQEEOQ      END OF LIST                          09300000
         BO    FINISH              YES, EXIT                            09350000
         SPACE 2                                                        09360000
*/*      P     (,STARTEST)         GET POINTER TO NEXT MESSAGE  */      09370000
*********************************************************************** 09380000
         LA    X7CQE,N4(X7CQE)     NO, GET NEXT WORD                    09400000
         B     STARTEST            RESTART                              09450000
INSRT    EQU   *                                                        09500000
         ST    X7CQE,UCMWLAST      SAVE LIST PT                         09550000
         TM    CQEFLAG,CQEMAJOR    START OF MLWTO                       09700000
         BO    MLWTO               YES-HANDLE MLWTO                     09750000
         L     X7WQE,CQEWQE        ADDRESS THIS WQE                     09800000
         USING WQE,X7WQE           DECLARE WQE BASE                     09810000
PURGCONT EQU   *                                                        09850000
         TM    WQEXA,WQEPURGE+WQEDOM IS WQE PURGE OR DOM ON             09900000
         BZ    ROOM                NO,FIND ROOM ON SCREEN               09950000
MARK     EQU   *                   FLAG AS NO LONGER NEEDED             10100000
         L     X7CQE,UCMWLAST      GET POINTER TO ACTIVE CQE            10150000
         USING CQE,X7CQE           DECLARE CQE BASE                     10160000
         OI    UCMSTS,UCMTB        INDICATE DEQUE WQE                   10200000
         NI    CQEFLAG,N255-CQEENTR TURN OFF ENTRY ACTIVE               10250000
         OI    CQEFLAG,CQEAVAIL    INDICATE NO LONGER NEEDED            10260000
         B     ENDLIST             SEE IF THERE ARE MORE                10300000
MLWTO    EQU   *                                                        10350000
*    IF MLWTO HAS BOTH DESCRIPTOR CODES 8 AND 9, AND THE TARGET         10400000
*    AREA IS NOT Z (FOR INLINE), THEN IT WILL GO OUT OF LINE            10450000
*    AND THIS ROUTINE IGNORES IT.  OTHERWISE, PASS CONTROL TO           10500000
*    INTERFACE 1 TO PUT THE MLWTO INLINE.                               10550000
         L     X7WQE,CQEWQE        GET WQE ADDRESS                      10600000
         USING WQE,X7WQE           DECLARE WQE BASE                     10610000
         TM    WQEMCSF,WQEMCSA     DO DESCRIPTOR CODES EXIST            10650000
         BNO   INTFACE1            NO, GO TO INTERFACE 1                10700000
         TM    WQEDESCD,WQEDCH     DESCRIPTOR CODE 8                    10750000
         BNO   INTFACE1            NO, GO TO INTERFACE 1                10800000
         TM    WQEDC2,WQEDCI       DESCRIPTOR CODE 9                    10850000
         BNO   INTFACE1            NO, GO TO INTERFACE 1                10900000
         CLI   WMJMAREA,Z          AREA ID = Z                          10950000
         BE    INTFACE1            YES-GO TO INTERFACE 1                11000000
         L     X7CQE,UCMWLAST       GET LIST PT OF ACTIVE WQE           11050000
         B     ENDLIST             IGNORE MLWTO, CONTINUE SEARCH        11100000
INTFACE1 EQU   *                                                        11150000
*    EXIT TO THE INTERFACE MODULE 1 TO DISPLAY IT INLINE                11200000
*                                                                       11250000
         L     XFBRANCH,DCMNINT1   LOAD IN-LINE DISPLAY ADDRESS         11300000
         L     X1PARM,DCMCXSVE     PASS CXSA ADDRESS IN REG 1           11305000
         BR    XFBRANCH            EXIT TO IEECVFTN                     11350000
*                                                                       11400000
ROOM     EQU   *                                                        11450000
         TM    N0(X5SCT),DCMMSGST  END OF TABLE                         11460000
         BO    FULTST              YES,NO MORE ROOM                     11470000
         TM    N0(X5SCT),DCMMSGIN  IS THIS LINE FREE                    11500000
         BNO   NOTFULL             YES, INSERT WQE                      11550000
         AH    X5SCT,DCMSCTCN      NO, GET NEXT SCT ENTRY               11600000
         LA    X6DOM,DCMDOMLN(X6DOM) GET NEXT DOM ENTRY                 11650000
         AH    X4MSG,DCMCORLN      GET NEXT LINE                        11700000
         LA    X1PARM,N1(X1PARM)   AND NEXT LINE NUMBER                 11750000
         CH    X1PARM,DCMMSGAL     STILL IN MSG AREA                    11760000
         BNH   ROOM                YES, CHECK FOR A FREE LINE           11770000
FULTST   EQU   *                                                        11800000
         OI    DCMR2FLG,DCMRXSFL   SET ON R DCM SCREEN FULL             11850000
         OI    UCMDEVC,UCMDEVA       INDICATE THAT SCREEN IS FULL       11900000
         CLI   DCMDEL,R            IS DEVICE IN ROLL MODE               11950000
         BE    DISP1               YES DO NOT WRITE MESSAGE WAITIND     12000000
         OI    DCMCMSG1,DCMMSGWT   INDICATE WRITE MESSAGE WAITING BIT   12050000
         OI    DCMIOCM1,DCMWRWRN   WRITE WARNING LINE                   12100000
         B     DISP1                                                    12350000
NOTFULL  EQU   *                                                        12400000
         LH    XFQUOTEN,WQENBR+N2  GET TEXT LENGTH                      12500000
         TM    UCMDISP2,UCMDISPI   TIME STAMP REQ'D           JE YM6828 12510003
         BZ    TSTDISPJ            NO, TEST FOR JOBID         JE YM6828 12520003
         LA    XFQUOTEN,19(0,XFQUOTEN) INCR LENGTH FOR TIME   JE YM6828 12530003
         B     FULTST1             CONTINUE                   JE YM6828 12542003
TSTDISPJ TM    UCMDISP2,UCMDISPJ   JOBID REQ'D                JE YM6828 12544003
         BZ    FULTST1             NO, CONTINUE               JE YM6828 12546003
         LA    XFQUOTEN,10(0,XFQUOTEN) INCR LENGTH FOR JOBID  JE YM6828 12548003
FULTST1  DS    0H                                             JE YM6828 12548400
         LH    X3PADS,DCMAXLGN     GET MAX TEXT/LINE                    12550000
         SR    XFQUOTEN,X3PADS     SUB LENGTH OF 1ST LINE               12600000
         BNP   ONELINE             NOTHING LEFT, NO CONT.               12650000
         BCTR  X3PADS,N0           REDUCE BECAUSE CONT.                 12700000
         BCTR  X3PADS,N0           LINES ARE SHORTER                    12750000
         SR    XEREMAIN,XEREMAIN   CLEAR EVEN REG FOR DIVIDE            12800000
         DR    XEREMAIN,X3PADS     DIVIDE BY LINE LENGTH                12850000
         LTR   XEREMAIN,XEREMAIN   IS THERE A REMAINDER                 12900000
         BZ    NOPAD               NO, QUOTIENT IS CORRECT              12950000
         LA    XFQUOTEN,N1(XFQUOTEN) YES, NEED ANOTHER LINE             13000000
         SR    X3PADS,XEREMAIN     # PAD CHARS AVAIL FOR SPLIT          13010000
         B     LONG                SEE IF CONTINUED LINES FIT           13050000
ONELINE  EQU   *         MESSAGE WILL NOT BE CONTINUED        MB YM6340 13060000
         LR    XFQUOTEN,X5SCT      SCT FOR LINE TO DISPLAY    MB YM6340 13070000
         B     DYNTEST             SEE IF IT FITS             MB YM6340 13080000
NOPAD    EQU   *                                                        13100000
         SR    X3PADS,X3PADS       NO PAD CHARS AVAILABLE               13150000
LONG     EQU   *                                                        13200000
         MH    XFQUOTEN,DCMSCTCN   MULT BY SCT ENTRY LENGTH             13250000
         AR    XFQUOTEN,X5SCT      ADD TO CURRENT POINTER               13300000
DYNTEST  EQU   *          BE SURE MESSAGE WILL FIT            MB YM6340 13310000
         C     XFQUOTEN,DCMADDRL   HAVE WE EXCEEDED SCREEN SIZE         13350000
         BH    FULTST               YES, TEST FOR AUTO DELETE           13400000
*    IF THE MESSAGE AREA LINE ADDR IS EQUAL TO DYNAMIC DISPLAY          13450000
*    START ADDR SAVED ABOVE, CONSIDER FULL SCREEN CONDITION             13500000
         NC    DCMDSAV+N16(N4),DCMDSAV+N16   DOES A                     13550000
*                                     DYNAMIC DISPLAY EXIST             13600000
         BZ    NOTBAD               NO, CONTINUE                        13650000
         C     XFQUOTEN,DCMDSAV+N16 DOES LINE ADDR = DYN ADDR           13700000
         BNL   FULTST              YES, DON'T INSERT WQE                13750000
NOTBAD   EQU   *                                                        14050000
         OI    WQEAVAIL,WQEBUFC    FLAG AS READY FOR HARDCOPY           14060000
         MVI   N2(X4MSG),BLANK     INITIALIZE MESSAGE FLAGS             14100000
         TM    WQEDESCD,WQEDCG     IS THIS CODE 7             MB YM6340 14150000
         BNO   NOT7                NO, CONTINUE CHECKING      MB YM6340 14200000
         OI    N1(X5SCT),DCMMSGC7  FLAG AS DESC CODE 7        MB YM6340 14250000
NOT7     EQU   *                                              MB YM6340 14300000
         TM    WQEXA,WQEWTOR       IS THIS A WTOR                       14350000
         BNO   DESCTST             NO, TEST DESCRIPTOR CODES            14400000
         OI    N0(X5SCT),DCMMSGWR  MARK MSG AS A WTOR                   14450000
         OI    N1(X5SCT),DCMMSGC7  INDICATE WTOR                        14500000
         B     ACTION1             FLAG WTORS AS ACTION MESSAGES        14550000
DESCTST  EQU   *                                                        14600000
         TM    WQEDESCD,WQEDCA+WQEDCB IS THIS AN ACTION MSG   MB YM6340 14850000
         BNZ   ACTION1             YES FLAG IT                MB YM6340 14860000
         TM    WQEDESCD,WQEDCC+WQEDCD+WQEDCE CODE 3,4,OR 5    MB YM6340 14870000
         BNZ   MOVE                YES, LEAVE FLAG BLANK      MB YM6340 14880000
INFOMSG  EQU   *                                                        14900000
         MVI   N2(X4MSG),ISDASH    FLAG MSG                             14950000
         OI    N0(X5SCT),DCMMSGIF  UPDATE SCT                           15000000
         B     MOVE                READY TO MOVE MESSAGE IN             15050000
ACTION1  EQU   *                                                        15100000
         OI    N1(X5SCT),DCMMSGAC  INDICATE ACTION MSG IN LINE          15150000
         OI    DCMIOCM1,DCMSOUND   INDICATE SOUND ALARM                 15200000
         CLI   WQETXT,ACTMSG       IS THIS A SYSTEM ACTION MESSAGE      15250000
         BE    VISTST              YES, NOT FROM PROBLEM PROGRAM        15300000
         OI    N1(X5SCT),DCMMSGPP  SET PP ACTION MESSAGE                15350000
VISTST   EQU   *                                                        16500000
MOVE     EQU   *                                                        16850000
         MVC   N0(N2,X6DOM),WQEASID    MEMORY ID TO DOM TABLE           16900000
         MVC   N2(N3,X6DOM),WQEJSTCB+N1 MOVE TCB ADDRESS INTO          *16950000
                                   DCM DOM TABLE              MB Y02958 16960000
         MVC   N5(N3,X6DOM),WQESEQN    MOVE SEQ NO. TO DOM TAB          17000000
         LA    X2START,WQETXT      POINT TO START OF TEXT               17050000
         TM    UCMDISP2,UCMDISPI   TIME STAMP REQ'D           JE YM6828 17060003
         BZ    TSTDJ2              NO, TEST FOR JOBID         JE YM6828 17070003
         LA    X2START,WQEPAD      POINT TO TIME              JE YM6828 17080003
         B     MOVE1               CONTINUE                   JE YM6828 17090003
TSTDJ2   TM    UCMDISP2,UCMDISPJ   JOBID REQ'D                JE YM6828 17092003
         BZ    MOVE1               NO, CONTINUE               JE YM6828 17094003
         LA    X2START,WQEPAD1     POINT TO JOBID             JE YM6828 17096003
MOVE1    DS    0H                                             JE YM6828 17098003
         LA    XEMVC,MSG1          POINT TO FIRST MVC                   17100000
         LR    X9SCNSRT,X2START    SETUP TO CALCULATE BACKSCAN          17150000
BIGLOOP  EQU   *                                                        17200000
         AH    X9SCNSRT,DCMAXLGN   BUMP SCAN START ADDRESS              17250000
         BCTR  X9SCNSRT,N0         POINT TO LAST CHARACTER              17300000
         LA    X0WORK,WQETXT-N1    GET TEXT START ADDRESS     MB YM6340 17350000
         AH    X0WORK,WQENBR+N2    ADD TEXT LENGTH                      17400000
         CR    X0WORK,X9SCNSRT     END OF TEXT PAST SCAN START          17450000
         BNH   LASTLINE            NO, MOVE TO END OF TEXT              17500000
         OI    N0(X5SCT),DCMMSGCN  INDICATE CONTINUED LINE              17550000
         LTR   XDWORK,X3PADS       SAVE NUMBER OF PAD CHARS             17600000
         BZ    SPLIT               IF NONE LEFT, SPLIT AT MAX           17650000
         LR    X0WORK,X9SCNSRT     SAVE SCAN START POINT                17700000
SPLTLOOP EQU   *                                                        17750000
         CLI   N0(X9SCNSRT),BLANK  IS THIS CHAR A BLANK                 17800000
         BE    SPLIT               YES HOLD SPLIT POINT                 17850000
         CLI   N0(X9SCNSRT),COMMA  IS IT A COMMA                        17900000
         BE    SPLIT               YES HOLD SPLIT POINT                 17950000
         BCTR  X9SCNSRT,N0         GO BACK ONE BYTE                     18000000
         BCT   X3PADS,SPLTLOOP     LOOP TILL ZERO                       18050000
         LR    X3PADS,XDWORK       NO PAD CHARS USED                    18100000
LASTLINE EQU   *                                                        18150000
         LR    X9SCNSRT,X0WORK     NO SPLITTING DONE                    18200000
*                                  MOVE TO END OF TEXT OR MAX           18250000
SPLIT    EQU   *                                                        18300000
         SR    X9SCNSRT,X2START    CALCULATE MOVE LENGTH                18350000
         OI    N0(X5SCT),DCMMSGIN  INDICATE LINE IS IN USE              18400000
         NI    N0(X5SCT),N255-DCMMSGJK                                  18450000
         MVI   N3(X4MSG),BLANK     BLANK OUT LINE                       18500000
         LH    XDWORK,DCMAXLGN     LOAD FULL LENGTH OF LINE             18550000
         BCTR  XDWORK,N0           REDUCE ONE FOR EXECUTE               18600000
         BCTR  XDWORK,N0           ONE MORE FOR ONE THATS THERE         18650000
         EX    XDWORK,BLKTXT       SPREAD BLANKS IN MSG LINE            18800000
         EX    X9SCNSRT,N0(XEMVC)  MOVE TEXT INTO DCM                   18900000
         MVC   N3(N1,X4MSG),WQETXT COPY ACTION CODE           JE YM6828 18950003
         LA    X2START,N1(X9SCNSRT,X2START) START FOR NEXT MOVE         19000000
         TM    DCMDSTAT,DCMDSTNM   ARE MESSAGES NUMBERED                19050000
         BZ    NONUM               NO, CHECK FOR STATUS DISPLAY         19100000
         STH   X1PARM,DCMADNUM     STORE LINE NUMBER                    19150000
         CVD   X1PARM,DCMPACK      CONVERT TO DECIMAL                   19200000
         UNPK  DCMCVBIN+N2(N2),DCMCVBIN+N2(N2) UNPACK                   19250000
         OI    DCMCVBIN+N3,CF0     MAKE IT EBCDIC                       19300000
         CLI   DCMCVBIN+N2,CF0     IS FIRST CHARACTER A ZERO            19350000
         BNE   MOVEALL             NO, MOVE IN AS IS                    19400000
         MVI   DCMCVBIN+N2,BLANK   REPLACE ZERO WITH A BLANK            19450000
MOVEALL  EQU   *                                                        19500000
         MVC   N0(N2,X4MSG),DCMCVBIN+N2 MOVE NUMBER ON SCREEN           19550000
NONUM    EQU   *                                                        19600000
         LR    XDWORK,X1PARM        GET LINE NUMBER                     19650000
         BCTR  XDWORK,N0            ZERO ORIGIN                         19700000
         A     XDWORK,DCMADSEC      INDEX INTO SSCT                     19750000
         TM    N0(XDWORK),DCMSECCL+DCMSECLL+DCMSECDL+DCMSECBL           19800000
         BZ    NODISP               LINE NOT UNDER A STATUS DISPLAY     19850000
         OI    DCMCMSG1,DCMUNMSG   TURN ON WRITE UNVIEWABLE MSG         19900000
         B     CONTCHK              TEST FOR A CONTINUATION LINE        19950000
NODISP   EQU   *                                                        20000000
         CLI   DCMLINEN,N0         IS THIS FIRST MSG.                   20050000
         BNZ   VISA                NO, DONT SAVE LINE NUMBER            20100000
         STC   X1PARM,DCMLINEN     WRITE PARTIAL START LINE             20150000
VISA     EQU   *                                                        20200000
         OI    DCMIOCM1,DCMWRPAR   WRITE PARTIAL MSG AREA               20250000
         LH    XDWORK,DCMBYTCT     GET CURRENT BYTE COUNT               20300000
         AH    XDWORK,DCMCORLN     ADD LENGTH OF A LINE                 20350000
         STH   XDWORK,DCMBYTCT     SAVE NEW LENGTH                      20400000
CONTCHK  EQU   *                                                        20450000
         SR    XDWORK,XDWORK       CLEAR FOR COPYING LINE FLAG          20460000
         TM    N0(X5SCT),DCMMSGCN  IS THIS LINE CONTINUED               20500000
         BNO   BUMPEM              NO, DONT COPY FLAGGING               20550000
         IC    XDWORK,N2(X4MSG)    PICK UP DIDOCS LINE FLAG             20560000
         MVC   DCMDOMLN(DCMDOMLN,X6DOM),N0(X6DOM) COPY DOM INFO         20600000
         MVC   N2(N2,X5SCT),N0(X5SCT) COPY SCT ENTRY                    20650000
         OI    N3(X5SCT),DCMMSGCT  THIS IS CONTINUATION LINE            20700000
         NI    N2(X5SCT),N255-DCMMSGCN THIS ONE MAY NOT BE CONTINUED    20710000
BUMPEM   AH    X5SCT,DCMSCTCN      POINT TO NEXT SCT ENTRY              20750000
         LA    X6DOM,DCMDOMLN(X6DOM)  POINT TO NEXT DOM ENTRY           20800000
         AH    X4MSG,DCMCORLN      POINT TO NEXT LINE                   20850000
         LA    X1PARM,N1(X1PARM)   GET NEXT LINE NUMBER                 20900000
         LTR   XDWORK,XDWORK       ARE WE CONTINUING LINES              20950000
         BZ    MARK                NO,GET NEXT CQE                      21000000
         STC   XDWORK,N2(X4MSG)    COPY DIDOCS LINE FLAG                21010000
         LR    X9SCNSRT,X2START    PRIME SCAN START POINT               21100000
         BCTR  X9SCNSRT,N0         CONTINUATION LINES ARE               21150000
         BCTR  X9SCNSRT,N0         2 CHARACTERS SHORTER                 21200000
         LA    XEMVC,MSG2          POINT TO 2ND MVC                     21250000
         B     BIGLOOP             LOOP UNTIL DONE                      21300000
BLKTXT   MVC   N4(N0,X4MSG),N3(X4MSG) BLANK OUT LINE                    21350000
MSG1     EQU   *                                                        21400000
         MVC   N3(N0,X4MSG),N0(X2START) MOVE FOR FIRST HALF MSG  YM6828 21450003
MSG2     EQU   *                                                        21500000
         MVC   N5(N0,X4MSG),N0(X2START) MOVE FOR 2ND HALF MSG           21550000
*********************************************************************** 21950000
**                                                                   ** 22000000
***                        CONSTANTS                                *** 22050000
****                                                               **** 22100000
*********************************************************************** 22150000
TWODIV   DC    F'2'                CONSTANT                             22200000
FOUR     DC    H'4'                CONSTANT                             22250000
SIX      DC    H'6'                DOM TABLE INCREMENT                  22300000
CHARINCR DC    H'1'                INCREMENT OF ONE BYTE                22350000
INTVRQ   DC    C'IEA000A '         ID NUMBER FOR INTERVENTION REQ'D MSG 22400000
*********************************************************************** 22600000
         EJECT                                                          22650000
*********************************************************************** 22660000
***                        EQUATES                                   ** 22670000
****                                                               **** 22680000
*********************************************************************** 22690000
ID1      EQU   C'F'                1ST CHARACTER OF CSECT ID            22692000
ID2      EQU   C'2'                2ND CHARACTER OF CSECT ID            22694000
Z        EQU   C'Z'                CONSTANT                             22696000
N0       EQU   0                   FIELD INCREMENT                      22698000
N1       EQU   1                   FIELD INCREMENT                      22698400
N2       EQU   2                   FIELD INCREMENT                      22698800
N3       EQU   3                   FIELD INCREMENT                      22699200
N4       EQU   4                   FIELD INCREMENT                      22699600
N5       EQU   5                                                        22699700
N8       EQU   8                   FIELD INCR                           22699800
N12      EQU   12                  FIELD INCREMENT                      22699900
N16      EQU   16                  FIELD INCR                           22716600
N28      EQU   28                  FIELD INCR                           22726600
N255     EQU   255                 USED TO TURN OFF SELECTED BITS       22728600
ACTMSG   EQU   C'*'                ASTERISK   *                         22730600
BLANK    EQU   C' '                BLANK COMPARAND                      22732600
COMMA    EQU   C','                                                     22733000
ISDASH   EQU   C'-'                DASH COMPARAND                       22733100
Y        EQU   C'Y'                CHARACTER FOR COMPARE                22733200
R        EQU   C'R'                R COMPARAND                          22738800
TWO      EQU   2                   SCT INCREMENT FOR TM AND OI          22740800
X0A      EQU   X'0A'               MASK                                 22742800
X04      EQU   X'04'               MASK                                 22743200
X20      EQU   X'20'               MASK                                 22743600
X0C      EQU   X'0C'               MASK                                 22744000
PPACT    EQU   C'@'                PROBLEM PROGRAM ACTION MESSAGE       22744100
DCMDOMLN EQU   8                                                        22744200
         EJECT                                                          22744300
*********************************************************************** 22744400
*        FLOW CHART STATEMENTS                                        * 22750000
*********************************************************************** 22800000
*/*IEECVFT2: CHART */                                                   22850000
*/*%A: E (,%B) ENTRY POINT */                                           22900000
*/*%B: P (,%CC) PROGRAM INITIALIZATION */                               22950000
*/*%DD: D (YES,%EE,NO,%C) THIS DCM USED BY NIP */                       23050000
*/*%EE: P (,%C) ADJUST LINE NUMBER AND BYTE COUNT FIRST TIME */         23100000
*/*%C: P (,%D) INITIALIZE POINTERS */                                   23150000
*/*%D: D (YES,%E,NO,INTFACE1) IS MLWTO WRITE FINISHED */                23200000
*/*%E: D (YES,%F,NO,SPLITCHK) RETURN FROM INTERFACE 1 ROUTINE */        23250000
*/*%F: P (,STARTEST) GET POINTER TO NEXT WQE */                         23300000
*/*SPLITCHK: D (YES,%G,NO,MSGTST) RETURN FROM SPLIT */                  23350000
*/*%G: P (,NOTBAD) PICK UP SAVED REGISTERS */                           23400000
*/*MSGTST: D (YES,STARTEST,NO,FINISH) VALID ADDRESS */                  23450000
*/*STARTEST: D (YES,%H,NO,TESTDISP) IS THIS A POINTER TO A NEW BLOCK */ 23500000
*/*%H: P (,STARTEST) PICK UP NEXT BLOCK POINTER */                      23550000
*/*TESTDISP: D (YES,INSRT,NO,ENDLIST) HAS MESSAGE BEEN DISPLAYED */     23600000
*/*ENDLIST: D (YES,FINISH,NO,%I) END OF LIST */                         23650000
*/*%I: P (,STARTEST) GET NEXT WORD */                                   23700000
*/*INSRT: D (YES,INTFACE1,NO,%J) MLWTO FOR HARDCOPY */                  23750000
*/*%J: D (YES,MLWTO,NO,PURGCONT) OTHER MLWTO */                         23800000
*/*PURGCONT: D (YES,%K,NO,ROOM) IS THE PURGE BIT ON */                  23850000
*/*%K: D (YES,MARK,NO,ROOM) IS AUTO DELETE REQUIRED */                  23900000
*/*MARK: P (,ENDLIST) SET ON DISPLAY FLAG */                            23950000
*/*MLWTO: D (YES,ENDLIST,NO,INTFACE1) ARE DESCRIPTOR CODES 8 OR 9 */    24000000
*/*INTFACE1: P (,PEXIT2) INIT FOR INTERFACE 1 EXIT */                   24050000
*/*ROOM: D (YES,NOTFULL,NO,%L) IS THERE A FREE LINE */                  24100000
*/*%L: P (,ROOM) ADJUST POINTERS */                                     24150000
*/*FULTST: P (,%M) SET ON FULL SCREEN INDICATORS */                     24200000
*/*%M: D (YES,DISPTST,NO,%N) IS DEVICE IN ROLL MODE */                  24250000
*/*%N: P (,DISPTST) SET WRITE MESSAGE WAITING FLAG */                   24300000
*/*DISPTST: D (YES,DISP1,NO,MSGTST) IS SCREEN FULL */                   24350000
*/*NOTFULL: D (YES,FULTST,NO,%O) USED BY DYNAMIC DISPLAY */             24400000
*/*%O: P (,NOTBAD) MOVE IN MESSAGE AND MARK DOM AND SCT */              24450000
*/*NOTBAD: P (,REPLY) EXAMINE MESSAGE TYPE AND MARK ACCORDINGLY */      24500000
*/*REPLY: D (YES,%P,NO,VISTST) IS THIS AN ACCEPTED REPLY */             24550000
*/*%P: P (,VISTST) INDICATE ACCEPTED REPLY */                           24600000
*/*VISTST: D (YES,%Q,NO,GOON) INTERVENTION REQUIRED MSG */              24650000
*/*%Q: P (,GOON) MARK SCT AND INCREMENT COUNTER */                      24700000
*/*GOON: P (,%R) COMPUTE LINE NUMBER */                                 24750000
*/*%R: D (YES,STATCHK,NO,NODISP) DYNAMIC DISPLAY IN AREA */             24800000
*/*NODISP: D (YES,%S,NO,VISA) IS THIS FIRST MESSAGE */                  24850000
*/*%S: P (,VISA) COMPUTE LINE NUMBER */                                 24900000
*/*VISA: P (,CONTCHK) COMPUTE AND SAVE NEW LENGTH */                    24950000
*/*STATCHK: P (,CONTCHK) SET ON WRITE UNVIEWABLE MESSAGE FLAG */        25000000
*/*CONTCHK: D (YES,%U,NO,MARK) IS THIS MESSAGE LINE CONT. */            25050000
*/*%U: P (,NOTBAD) ADJUST POINTERS */                                   25100000
*/*PEXIT: P (,PEXIT2) INIT FOR XCTL */                                  25150000
*/*PEXIT2: R XCTL TO PROPER DIDOCS MODULE */                            25200000
*/*FINISH: P (,DISP1) TURN OFF OUTPUT FLAG */                           25250000
*/*DISP1: P (,PEXIT) INIT FOR DISPLAY 2 XCTL */                         25300000
*/*IEECVFT2: END */                                                     25350000
         EJECT                                                          25400000
*********************************************************************** 25450000
*     ALL DSECTS FOLLOW THIS POINT:                                     25500000
*********************************************************************** 25550000
         IEERDCM                                                        25600000
         EJECT                                                          25700000
         IEETDCM                                                        25750000
         EJECT                                                          26500000
         IHAWQE  DSECT=YES                                              26600000
         EJECT                                                          26700000
         IHACTM  CXSA                                                   26800000
         EJECT                                                          26900000
         IHACTM  CQE                                                    26950000
         IHADOMC                                                        26954000
         EJECT                                                          26960000
         IEECUCM FORMAT=NEW                                             27000000
         EJECT                                                          27050000
         IEZIOB                                                         27060000
SLASH    EQU   C'|'                AUTO DELETE BAR                      27500000
X80      EQU   X'80'               END OF LIST FLAG                     27550000
X01      EQU   X'01'               NOT DISPLAYED FLAG                   27600000
C0       EQU   X'C0'               POINTER TO NEW LIST                  27650000
X03      EQU   X'03'               MASK                                 27900000
CF0      EQU   C'0'                F0                                   27950000
         SPACE 5                                                        28250000
         END                                                            28300000
./  ADD  SSI=81390132,NAME=IEECVGCI
* /* START OF SPECIFICATIONS ****************************************** 00100000
*                                                                       00200000
*01*  MODULE-NAME = IEECVGCI                                            00300000
*                                                                       00400000
*01*  DESCRIPTIVE-NAME = GRAPHIC CONSOLES INITIALIZATION ROUTINE        00500000
*                                                                       00600000
*01*  COPYRIGHT = NONE                                                  00700000
*                                                                       00800000
*01*  STATUS = VS/2 MVS 3033 PROCESSOR SUPPORT (SCP)           @G51AK02 00900000
*                                                                       01000000
*          APARS FIXED ZA02819,ZA04664,ZA17730,ZA18574                  01100000
* A 100100-100800, 529400-529800                               @ZA18574 01130000
*01*  FUNCTION = OPEN THE SYS1.DCMLIB DATA SET, READ PFK DEFINITIONS    01200000
*     INTO THE NUCLEUS PFK AREA, AND IF A GRAPHIC CONSOLE WAS USED      01300000
*     DURING NIP, MARK THAT CONSOLE'S RESIDENT DCM ACCORDINGLY FOR THE  01400000
*     DIDOCS DISPLAY ROUTINES.                                          01500000
*                                                                       01600000
*01*  NOTES =                                                           01700000
*                                                                       01800000
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01900000
*                                                                       02000000
*02*    DEPENDENCIES = NONE                                             02100000
*                                                                       02200000
*02*    RESTRICTIONS = NONE                                             02300000
*                                                                       02400000
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES                     02500000
*                                                                       02600000
*02*    PATCH-LABEL = ZAPAREA                                  @ZA18574 02700000
*                                                                       02800000
*01*  MODULE-TYPE = MODULE                                              02900000
*                                                                       03000000
*02*    PROCESSOR = ASSEMF-370R                                         03100000
*                                                                       03200000
*02*    MODULE-SIZE = X'592' BYTES                                      03300000
*                                                                       03400000
*02*    ATTRIBUTES = REUSABLE                                           03500000
*                                                                       03600000
*01*  ENTRY-POINT = IEECVGCI                                            03700000
*                                                                       03800000
*02*    PURPOSE = THIS IS THE ONLY ENTRY POINT TO PERFORM ALL FUNCTIONS 03900000
*                                                                       04000000
*02*    LINKAGE = LINKED TO BY IEEVIPL DURING COMMUNICATIONS TASK       04100000
*       INITIALIZATION                                                  04200000
*                                                                       04300000
*02*    INPUT = REGISTER 1 ADDRESSES THE TIOT                           04400000
*       SEE ALSO CONTROL BLOCKS USAGE                                   04500000
*                                                                       04600000
*02*    OUTPUT = OPEN DCB FOR SYS1.DCMLIB, AND INITIALIZED PFK AREAS IN 04700000
*       THE NUCLEUS.                                                    04800000
*                                                                       04900000
*02*    EXIT-NORMAL = IEEVIPL VIA BR 14.                                05000000
*                                                                       05100000
*02*    EXIT-ERROR = NONE                                               05200000
*                                                                       05300000
*01*  EXTERNAL-REFERENCES = NONE                                        05400000
*                                                                       05500000
*02*    ROUTINES = NONE                                                 05600000
*                                                                       05700000
*02*    DATA-SETS = SYS1.DCMLIB                                         05800000
*                                                                       05900000
*02*    DATA-AREA = IEEPFKEY, IN THE NUCLEUS                            06000000
*                                                                       06100000
*02*    CONTROL-BLOCKS = DCB,TIOT,RDCM,TDCM                             06200000
*                                                                       06300000
*01*  TABLES = NONE                                                     06400000
*                                                                       06500000
*01*  MACROS = EXECUTABLE - OPEN,GETMAIN,FREEMAIN,LOCATE,EXCP,WAIT      06600000
*              MAPPING - IEECUDX CONSOLE I/O CONTROL BLOCKS             06700000
*                        IEECUCM UCM DSECT                              06800000
*                        IEERDCM RESIDENT DCM DSECT                     06900000
*                        IEECSUB DIDOCS STORAGE UTILIZATION BLOCK       07000000
*                        IEETDCM TRANSIENT DCM DSECT           @ZA18574 07100000
*                                                                       07130000
*01*  CHANGE ACTIVITY = ZA02819,ZA04664,ZA17730,ZA24414,ZA18574@G51AK02 07160000
*                                                                       07230000
**** END OF SPECIFICATIONS *******************************************/ 07260000
         TITLE 'IEECVGCI - GRAPHIC CONSOLES INITIALIZATION'             07290000
IEECVGCI CSECT                                                          07320000
* A (EXPON) APPROX 371500 - NUCLEUS OVERLAY                    @ZA24414 07350000
* A (ICATCH) APPROX 100000 - EQUIP. CHECK                      @ZA18574 07380000
* A (SEARCH) APPROX 152700                                     @G51AK02 07400000
* A (N3036) APPROX 464700                                      @G51AK02 07420000
* A (TLOAD) APPROX 125000                                      @ZA18574 07440000
* A (SDSYES) APPROX 160000                                     @ZA18574 07460000
         EJECT                                                          07500000
*********************************************************************** 07600000
*        PROGRAM INITIALIZATION                                       * 07700000
*********************************************************************** 07800000
*************************************************************           08200000
START    STM   R14,R12,N12(R13)    SAVE REGISTERS                       08300000
         BALR  RBASE,N0            ESTABLISH PROGRAM                    08400000
         USING *,RBASE             ADDRESSABILITY                       08500000
         B     ICATCH              BRANCH AROUND EYECATCHER             08600000
         DC    C'00 MODULE IEECVGCI, FICHE IEECVGCI  ' EYECATCHER AND   08700000
         DC    XL2'4211'           JULIAN DATE LAST CHANGE              08800000
         DC    CL8'&SYSDATE'       DATE OF LAST ASSEMBLY                08900000
         DC    S(*)                BASE/DISPL OF PATCH AREA             09000000
ZAPAREA  DC    12C'ZAP'            RESERVED FOR FIELD MODIFICATION      09100000
ICATCH   LA    R12,SAVEAREA        LOAD SAVE AREA POINTER               09200000
         ST    R12,N8(R13)         SAVE IN CALLERS AREA                 09300000
         ST    R13,SAVEAREA+N4     SAVE POINTER TO CALLERS SAVE AREA    09400000
         LR    R13,R12             LOAD SAVE AREA POINTER               09500000
         ST    RA,ADRDSAB          SAVE DCMLIB DSAB ADDR      MB Y02958 09600000
         L     RCVT,CVTPTR         LOAD CVT ADDRESS                     09700000
         USING CVT,RCVT            ESTABLISH ADDRESSABILITY             09800000
         L     RUCM,CVTCUCB        LOAD UCM ADDRESS                     09900000
         USING UCM,RUCM            UCM BASE                             10000000
         L     RSUB,CVTIXAVL       GET IOCOM ADDRESS           @ZA18574 10010000
         USING IOCOM,RSUB                                      @ZA18574 10020000
         L     RSUB,IOCATTBL       GET ATTEN TABLE ADDR        @ZA18574 10030000
         DROP  RSUB                                            @ZA18574 10040000
         USING ATB,RSUB                                        @ZA18574 10050000
         LA    RSUB,N8(RSUB)       GET SECOND ENTRY            @ZA18574 10060000
         OI    ATBFLA,ATBITF       TURN ON INTERCEPT BIT       @ZA18574 10070000
         DROP  RSUB                                            @ZA18574 10080000
         SR    RSUB,RSUB           ZERO SUB BASE REGISTER               10100000
         DROP  RCVT                DROB ADDRESSABILITY                  10200000
         SPACE 3                                                        10300000
*************************************************************           10500000
GETCONS  LM    RENTRY,RLAST,UCMVEA LOAD BXLE REGISTERS                  10600000
         USING UCMLIST,RENTRY      UCMENTRY BASE                        10700000
         SPACE 3                                                        10800000
*************************************************************           11000000
LOOPA    TM    UCMDISP,UCMDISPC    GRAPHICS CONSOLE                     11100000
         BZ    NEXTCON             NO, BRANCH                           11200000
         SPACE 3                                                        11300000
*************************************************************           11500000
         L     RUCB,UCMUCB         GET UCB ADDRESS                      11600000
         LTR   RUCB,RUCB           VALID UCB ADDRESS                    11700000
         BZ    BADCON              NO, INACTIVATE CONSOLE               11800000
         USING UCBBLK,RUCB         ESTABLISH ADDRESSABILITY             11900000
         L     RRDCM,UCMXB         LOAD R DCM BASE                      12000000
         LTR   RRDCM,RRDCM         VALID RDCM ADDRESS         MB Y02958 12100000
         BZ    BADCON              NO, INACTIVE CONSOLE       MB Y02958 12200000
         USING DCMTSRT,RRDCM       R DCM BASE                  @ZA18574 12300000
         EJECT                                                          12350000
*************************************************************           12400000
TLOAD    L     RTDCM,DCMADTRN      LOAD T DCM ADDRESS                   12450000
         USING DCMSTRT,RTDCM       ESTABLISH ADDRESSABILITY    @ZA18574 12500000
         LTR   RTDCM,RTDCM         IS ADDRESS VALID                     12900000
         BNZ   GOODADDR            YES, BRANCH                          13000000
         SPACE 2                                                        13100000
*************************************************************           13300000
BADCON   MVI   UCMATR,N0           ZERO CONSOLE SUPPORT FLAGS           13400000
         MVI   UCMSTS,N0           ZERO WORK FLAGS            MB YM6335 13500000
         B     NEXTCON             GET NEXT CONSOLE                     13600000
         SPACE 2                                                        13700000
*************************************************************           13900000
GOODADDR L     RA,DCMADPFK         LOAD POINTER TO PFK AREA             14000000
         LTR   RA,RA               VALID ADDRESS                        14100000
         BZ    SEARCH              NO, BRANCH                           14200000
         SPACE 2                                                        14300000
*************************************************************           14500000
         L     RSUB,DCMSUBAD       LOAD SUB BASE REGISTER               14600000
         USING SUB,RSUB            SUB BASE                             14700000
         SPACE 3                                                        14800000
*************************************************************           15000000
SEARCH   CLI   UCBTBYT4,N2260      IS CONSOLE A 2260                    15100000
         BE    SDYES               YES, BRANCH                          15200000
         CLI   UCBTBYT4,N3158      IS THIS A 3158 CONSOLE      @ZA17730 15230000
         BE    SDYES               YES, BRANCH                 @ZA17730 15260000
         CLI   UCBTBYT4,N3036      IS CONSOLE A 3036           @G51AK02 15270000
         BE    SDYES               YES, BRANCH                 @G51AK02 15280000
         CLI   UCBTBYT4,N3277      IS CONSOLE A 3277                    15300000
         BNE   SDNO                NO, BRANCH                           15400000
         TM    UCBTBYT1,MOD1       IS 3277 A MOD ONE                    15500000
         BNO   SDYES               NO, BRANCH                           15600000
SDNO     OI    DCMDEVTY,DCMTY50    NOT USABLE FOR SD                    15700000
         B     SDSYES              BRANCH                               15800000
SDYES    OI    DCMDEVTY,DCMTY60    IS USABLE FOR SD                     15900000
SDSYES   MVC   DCMLEN(N2),DCMSTRT       SAVE DCM LENGTH        @ZA18574 16000000
         MVC   DCMRMSAL(N2),DCMMSGAL    SAVE NUMBER MSG LINES           16100000
         SPACE 2                                                        16200000
*************************************************************           16400000
NIPTEST  L     RB,DCMMSGSV         POINT TO GETMAIN AREA                16500000
         LTR   RB,RB               THIS CONSOLE USED BY NIP?            16600000
         BZ    NEXTCON             NO, BRANCH                           16700000
         OI    DCMRFLGS,DCMNIPP    IND DCM USED BY NIP                  16800000
         EJECT                                                          16900000
*************************************************************           17100000
         L     RA,N4(RB)           POINT TO FIRST SAVED MESSAGE         17200000
         LA    RX,N8               LOAD BCT COUNT                       17300000
         LH    RY,DCMLGNTH         LOAD LINE LENGTH                     17400000
         BCTR  RY,N0               DECREMENT FOR EXECUTE MOVE           17500000
         L     RZ,DCMASCRN         DCM MESSAGE AREA                     17600000
LOOPER   EX    RY,MOVER            MOVE IN MESSAGE                      17700000
         AH    RA,DCMLGNTH         BUMP FROM POINTER          MB YM2531 17800000
         AH    RZ,DCMCORLN         BUMP TO POINTER                      17900000
         BCT   RX,LOOPER           LOOP FOR MORE                        18000000
         L     RA,N16(RB)          POINT TO SAVED SCT'S                 18100000
         L     RZ,DCMAMTAB         DCM SCT POINTER                      18200000
         MVC   N0(N16,RZ),N0(RA)   RESTORE SAVED SCT'S                  18300000
         LA    P0,N255             LOAD SUBPOOL VALUE         MB YM2531 18400000
         SLL   P0,N24              SHIFT TO HI-ORDER BYTE     MB YM2531 18500000
         L     P1,DCMMSGSV         POINT TO GETMAIN AREA      MB YM2531 18600000
         L     R2,N20(P1)          POINT TO LAST SCT          MB YM2531 18700000
         LA    R2,N3(R2)           POINT JUST BEYOND STOPPER  MB YM2531 18800000
         SR    R2,P1               COMPUTE LENGTH FOR FREEING MB YM2531 18900000
         OR    P0,R2               SUBPOOL AND LENGTH IN REG  MB YM2531 19000000
         FREEMAIN  R,LV=(0),A=(1)                             MB YM2531 19100000
         SPACE 3                                                        19200000
*************************************************************           19400000
NEXTCON  BXLE  RENTRY,RLEN,LOOPA   GET NEXT ENTRY                       19500000
         DROP  RTDCM               DROP T DCM ADDRESSABILITY            19600000
         SPACE 3                                                        19700000
*************************************************************           19900000
         LTR   RSUB,RSUB           ANY PFK'S IN SYSTEM                  20000000
         BNZ   LOCATE              YES, BRANCH                          20100000
         SPACE 3                                                        20200000
*************************************************************           20400000
RETURN   L     R13,SAVEAREA+N4     LOAD CALLERS SAVE AREA               20500000
         LM    14,12,12(13)        RESTORE REGISTERS                    20600000
         BR    14                  RETURN TO CALLER                     20700000
         EJECT                                                          20800000
*********************************************************************** 20900000
*        EXECUTE A LOCATE TO DETERMINE IF SYS1.DCMLIB IS PRESENT      * 21000000
*        AND IF SO, WHERE. ATTEMPT OPEN.                              * 21100000
*********************************************************************** 21200000
*************************************************************           21400000
LOCATE   L     RDCB,SUBBLK         LOAD CONTROL BLOCK BASE              21500000
         USING SUBDCB,RDCB         CONTROL BLOCK ADDRESSABILITY         21600000
         LOCATE  INDAB                                                  21700000
         LTR    R15,R15            WAS LIBRARY MOUNTED                  21800000
         BNZ   ERROR1              NO,  BRANCH                          21900000
         SPACE 3                                                        22000000
*************************************************************           22200000
OPEN     MVC   SUBVOL(N6),SYSVOL   STORE VOLID IN JFCB                  22300000
         L     RCVT,CVTPTR         LOAD CVT BASE                        22400000
         USING CVT,RCVT            ESTABLISH ADDRESSABILITY             22500000
         SPACE 3                                                        22600000
*************************************************************           22800000
         L     RX,CVTILK2          GET UCB                    MC  M2522 22900000
LOOP     DS    0H                                              @Z30AAJE 23000000
         SR    RY,RY               CLEAR REGISTER              @Z30AAJE 23100000
         ICM   RY,3,N0(RX)           ADDRESS                   @Z30AAJE 23200000
         BZ    BUMP                NULL ENTRY GET NEXT         @Z30AAJE 23300000
         CLM   RY,3,TABEND           REACHED END OF TABLE      @Z30AAJE 23400000
         BE    ERROR1              YES, BRANCH TO ERROR       MC  M1984 23500000
         CLC   N28(N6,RY),SUBVOL   VOLID SAME AS IN TIOT      MB Y02958 23600000
         BE    FOUND               YES, UCB FOR DCMLIB FOUND  MB Y02958 23700000
BUMP     LA    RX,N2(RX)           GET NEXT UCB ADDRESS       MB Y02958 23800000
         B     LOOP                CHECK FOR END OF UCBS      MB Y02958 23900000
FOUND    EQU   *                                                        24000000
         L     RC,ADRDSAB          LOCATE DSAB FOR DCMLIB     MB Y02958 24100000
         USING DSAB,RC             DSAB ADDRESSABILITY        MB Y02958 24200000
         L     RC,DSABTIOT         TIOT ENTRY FOR DCMLIB      MB Y02958 24300000
         USING TIOENTRY,RC         TIOT ENTRY ADDRESSABILITY  MB Y02958 24400000
         STCM  RY,N7,TIOEFSRT      POINT TIOT ENTRY TO UCB    MB Y02958 24500000
         L     RB,UCMPXA           COMM TASK TCB              MB Y02958 24600000
         USING TCB,RB              TCB ADDRESSABILITY         MB Y02958 24700000
         MVC   COMTIOT,TCBTIO      COMM TASK TIOT             MB Y02958 24800000
         L     RC,TCBJSCB          COMM TASK JSCB             MB Y02958 24900000
         USING IEZJSCB,RC          JSCB ADDRESSABILITY        MB Y02958 25000000
         MVC   COMQDB(N4),JSCDSABQ COMM TASK DSAB QUEUE       MB Y02958 25100000
         L     RB,CVTTCBP          CURRENT TCB POINTER        MB Y02958 25200000
         L     RB,N0(RB)           MASTER TCB ADDRESS         MB Y02958 25300000
         L     RC,TCBJSCB          MASTER JSCB ADDRESS        MB Y02958 25400000
         MVC   MSTRTIOT,TCBTIO     SAVE MASTER TIOT ADDRESS   MB Y02958 25500000
         MVC   TCBTIO,COMTIOT      SET COMM TASK TIOT         MB Y02958 25600000
         MVC   MSTRQDB,JSCDSABQ    SAVE MASTER DSAB QDB       MB Y02958 25700000
         MVC   JSCDSABQ,COMQDB     SET COMM TASK QDB FOR OPEN MB Y02958 25800000
         SPACE 3                                                        25900000
*************************************************************           26100000
         LA    RA,PNXLST           SET UP DCB EXLST           MB Y02958 26200000
         STCM  RA,N7,N37(RDCB)     LEAVE HI BYTE ALONE        MB Y02958 26300000
         SPACE 3                                                        26400000
*************************************************************           26600000
         MVC   CVTDATE(N4),DATE    PUT DATE INTO CVT                    26700000
         OI    JSCBSWT1,JSCBPASS                              MB Y02958 26800000
         OI    PNJEF,STOPPER       LAST ENTRY                 MB YM3194 26900000
         SPACE 3                                                        27000000
*************************************************************           27200000
         OPEN  ((RDCB),INOUT),TYPE=J,MF=(E,PNJEF)                       27300000
         MVC   TCBTIO,MSTRTIOT     RESTORE TIOT ADDRESS       MB Y02958 27400000
         MVC   JSCDSABQ,MSTRQDB    RESTORE DSAB QDB           MB Y02958 27500000
         NI    JSCBSWT1,N255-JSCBPASS REINSTATE PASSWORD CHECKING       27600000
         DROP  RC                  DROP JSCB ADDRESSABILITY   MB Y02958 27700000
         DROP  RB                  DROP TCB ADDRESSABILITY    MB Y02958 27800000
         SPACE 3                                                        27900000
*************************************************************           28100000
OPENOK   TM    N48(RDCB),OFLAG     IS DCB OPEN                          28200000
         BZ    ERROR1              NO, BRANCH                           28300000
         EJECT                                                          28400000
*********************************************************************** 28500000
*        READ IN COPY OF PFK DEFINITIONS FROM SYS1.DCMLIB             * 28600000
*********************************************************************** 28700000
*************************************************************           28900000
         L     P1,SUBBLK           LOAD DCB ADDRESS                     29000000
         BLDL  (1),LIST            ISSUE BLDL FOR PFK MEMBER            29100000
         LTR   R15,R15             WAS IT FOUND                         29200000
         BNZ   ERROR2              NO, BRANCH                           29300000
         SPACE 3                                                        29400000
*************************************************************           29600000
         LA    RA,SUBECB           GET ECB ADDRESS                      29700000
         ST    RA,IOB+N4           STORE IT IN IOB                      29800000
         L     R2,SUBPFKAD         LOAD PFK AREA POINTER                29900000
         L     RX,N0(R2)           POINT TO DEFINATIONS                 30000000
         ST    RX,DEFSAVE          SAVE DEFINATION POINTER              30100000
         LA    R2,N4(R2)           POINT TO ELEMENT                     30200000
         MVC   LENGTH(N2),N0(RX)   MOVE LENGTH TO CCW                   30300000
         MVI   TYPE,NE             SET CCW READ CODE                    30400000
         MVC   DATA(N3),SUBPFKAD+N1    STORE DATA ADDR IN CCW           30500000
         SPACE 3                                                        30600000
*************************************************************           30800000
TEE      STM   R14,R12,SAVEAREA+N12    SAVE REGISTERS                   30900000
         L     P0,TTR              GET RELATIVE TTR                     31000000
         L     P1,SUBBLK           GET DCB ADDRESS                      31100000
         L     P1,N44(P1)          GET DEB ADDRESS                      31200000
         LA    R2,SEEK             WHERE TO PUT CONVERSION              31300000
         L     R15,CVTPCNVT        GET POINTER TO CONVERT ROUTINE       31400000
         BALR  R14,R15             BRANCH TO CONVERT ROUTINE            31500000
         LM    R14,R12,SAVEAREA+N12     RESTORE REGISTERS               31600000
         SPACE 3                                                        31700000
*************************************************************           31900000
         LA    P1,IOB              LOAD IOB ADDRESS                     32000000
         SVC   0                   ISSUE EXCP                           32100000
         WAIT  ECB=SUBECB          WAIT FOR I/O COMPLETE                32200000
         SPACE 3                                                        32300000
*************************************************************           32500000
         TM    IOBSEN,IOBNR        WAS RECORD FOUND                     32600000
         BO    NOREC               NO, BRANCH                           32700000
         SPACE 3                                                        32800000
*************************************************************           33000000
         CLI   SUBECB,GOODIO       WAS I/O GOOD                         33100000
         BNE   ERROR2              NO, BRANCH                           33200000
         SPACE 3                                                        33300000
*************************************************************           33500000
         MVI   SUBECB,N0           CLEAR ECB                            33600000
         TM    SUBDAIO,SUBEXP      CONTROL RECORD EXPECTED              33700000
         BZ    EXPON               NO, BRANCH                           33800000
         SPACE 3                                                        33900000
*************************************************************           34100000
         L     RA,TYPE             LOAD DATA ADDRESS                    34200000
         LA    RA,N0(RA)           CLEAR HIGH BYTE                      34300000
         TM    N0(RA),CONTROL      CONTROL RECORD                       34400000
         BZ    BUMPER              NO, BRANCH                           34500000
         SPACE 3                                                        34600000
*************************************************************           34800000
         NI    SUBDAIO,N255-SUBEXP SET OFF EXPECT FLAG                  34900000
         SPACE 3                                                        35000000
*************************************************************           35200000
BUMPER   IC    RA,TTR+N2           GET R OF TTR                         35300000
         LA    RA,N1(RA)           BUMP BY ONE                          35400000
         STC   RA,TTR+N2           STORE UPDATED VALUE                  35500000
         B     TEE                 BRANCH                               35600000
         EJECT                                                          35700000
*************************************************************           35900000
NOREC    LH    RA,TTR              GET TT OF TTR                        36000000
         LA    RA,N1(RA)           BUMP BY ONE                          36100000
         STH   RA,TTR              STORE UPDATED VALUE                  36200000
         MVI   TTR+N2,N1           SET R OF TTR TO ONE                  36300000
         B     TEE                 BRANCH                               36400000
         SPACE 3                                                        36500000
*************************************************************           36700000
EXPON    MVC   N2(N8,R2),SEEK      MOVE TTR TO ELEMENT                  36800000
         LH    RA,RESCNT           LOAD RESIDUAL COUNT                  36900000
         LH    RX,LENGTH           LOAD CCW COUNT                       37000000
         N     RX,MASK1            CLEAR UNWANTED BITS      JE @ZA02819 37100000
         N     RA,MASK1            CLEAR UNWANTED BITS         @ZA24414 37150000
         SR    RX,RA               COMPUTE LENGTH READ                  37200000
         STH   RX,N0(R2)           STORE IN ELEMENT                     37300000
         SPACE 3                                                        37400000
*************************************************************           37600000
         LTR   RA,RA               IS RESIDUAL COUNT ZERO               37700000
         BNZ   COMPUT              NO, BRANCH                           37800000
         SPACE 3                                                        37900000
*************************************************************           38100000
         OI    N0(R2),STOPPER      SET ELEMENT STOPPER                  38200000
         OI    SUBFLGS,SUBPKLIB    IND PFKS ARE SUPPORTED               38300000
         L     R2,SUBPFKAD         LOAD PFK AREA ADDRESS                38400000
         L     RX,DEFSAVE          LOAD SAVED POINTER                   38500000
         ST    RX,N0(R2)           RESTORE DEFINATION POINTER           38600000
         B     RETURN              EXIT                                 38700000
         SPACE 3                                                        38800000
*************************************************************           39000000
COMPUT   STH   RA,LENGTH           STORE NEW LENGTH IN CCW              39100000
         L     RA,TYPE             LOAD DATA ADDRESS                    39200000
         AR    RA,RX               ADD LENGTH READ                      39300000
         ST    RA,TYPE             STORE UPDATED DATA ADDRESS           39400000
         LA    R2,N10(R2)          UPDATE ELEMENT POINTER               39500000
         OI    SUBDAIO,SUBEXP      SET ON EXPECT FLAG                   39600000
         B     BUMPER              BRANCH                               39700000
         EJECT                                                          39800000
*************************************************************           40000000
ERROR1   WTO   'IEE933I DCMLIB OPEN FAILED',ROUTCDE=(1)                 40100000
         B     RETURN              EXIT                                 40200000
         SPACE 3                                                        40300000
*************************************************************           40500000
ERROR2   WTO   'IEE934I PFK UPDATE FAILED',ROUTCDE=(1)                  40600000
         B     RETURN              EXIT                                 40700000
         SPACE 3                                                        40800000
*************************************************************           41000000
         EJECT                                                          41100000
*********************************************************************** 41200000
*        REGISTER EQUATES                                             * 41300000
*********************************************************************** 41400000
P0       EQU   0                   REGISTER                             41500000
P1       EQU   1                   PARAMETER REGISTER                   41600000
RA       EQU   1                   WORK REGISTER                        41700000
R2       EQU   2                   REGISTER                             41800000
RB       EQU   2                   WORK REGISTER                        41900000
RENTRY   EQU   3                   UCMENTRY BASE                        42000000
RC       EQU   3                   WORK REG                   MB Y02958 42100000
RLEN     EQU   4                   ENTRY LENGTH FOR BXLE                42200000
RLAST    EQU   5                   LAST ENTRY FOR BXLE                  42300000
RBASE    EQU   6                   PROGRAM BASE                         42400000
RUCB     EQU   7                   UCB POINTER                          42500000
RDCB     EQU   8                   CONTROL BLOCK BASE                   42600000
RRDCM    EQU   9                   R DCM BASE                           42700000
RCVT     EQU   10                  CVT BASE REGISTER                    42800000
RTDCM    EQU   10                  T DCM BASE                           42900000
RSUB     EQU   11                  SUB BASE                             43000000
RUCM     EQU   12                  UCM BASE                             43100000
R12      EQU   12                  WORK REGISTER                        43200000
R13      EQU   13                  SAVE AREA POINTER                    43300000
RZ       EQU   13                  WORK REGISTER                        43400000
RX       EQU   14                  WORK REGISTER                        43500000
RY       EQU   15                  WORK REGISTER                        43600000
         EJECT                                                          43700000
*********************************************************************** 43800000
*        MISC PROGRAM EQUATES                                         * 43900000
*********************************************************************** 44000000
N0       EQU   0                   NUMBER                               44100000
N1       EQU   1                   NUMBER                               44200000
N2       EQU   2                   NUMBER                               44300000
N3       EQU   3                   NUMBER                               44400000
N4       EQU   4                   NUMBER                               44500000
N6       EQU   6                   NUMBER                               44600000
N7       EQU   7                   NUMBER                     MB Y02958 44700000
N8       EQU   8                   NUMBER                               44800000
N10      EQU   10                  NUMBER                               44900000
N12      EQU   12                  NUMBER                               45000000
N16      EQU   16                  NUMBER                               45100000
N20      EQU   20                  NUMBER                     MB YM2531 45200000
N24      EQU   24                  NUMBER                     MB YM2531 45300000
N28      EQU   28                  NUMBER                               45400000
N37      EQU   37                  NUMBER                     MB Y02958 45500000
N44      EQU   44                  NUMBER                               45600000
N48      EQU   48                  NUMBER                               45700000
N64      EQU   64                  NUMBER                               45800000
N148     EQU   148                 DEB MOVE LENGTH                      45900000
N255     EQU   255                 NUMBER                               46000000
OFLAG    EQU   X'10'               NUMBER                               46100000
UCMPT    EQU   100                 DISPLACEMENT OF UCM ADDR IN CVT      46200000
N2260    EQU   X'03'               2260 DEVICE TYPE                     46300000
N3277    EQU   X'09'               3277 DEVICE BYTE                     46400000
N3158    EQU   X'0C'               3158 DEVICE TYPE FLAG       @ZA17730 46450000
N3036    EQU   X'0D'               3036 DEVICE TYPE FLAG       @G51AK02 46470000
MOD1     EQU   X'01'               3277 MODEL ONE FLAG                  46500000
NE       EQU   X'0E'               READ CODE                            46600000
CONTROL  EQU   X'01'               CONTROL RECORD IDENTIFIER            46700000
STOPPER  EQU   X'80'               ELEMENT STOPPER                      46800000
GOODIO   EQU   X'7F'               GOOD I/O INDICATION                  46900000
         EJECT                                                          47000000
*********************************************************************** 47100000
*        MISC PROGRAM CONSTANTS                                       * 47200000
*********************************************************************** 47300000
         CNOP  2,4                                                      47400000
LIST     DC    H'1'                                                     47500000
         DC    H'22'                                                    47600000
         DC    C'IEE'                                                   47700000
         DC    CL5'PFKEY'                                     MB Y02958 47800000
         DC    XL6'0'                                                   47900000
TTR      DC    XL8'0'                                                   48000000
SAVEAREA DS    18F                 REGISTER SAVE AREA                   48100000
INDAB    CAMLST  NAME,AB,,LOCAREA                                       48200000
AB       DC    CL44'SYS1.DCMLIB'                                        48300000
LOCAREA  DS    0D                                                       48400000
         DS    6C                                                       48500000
SYSVOL   DS    253C                                                     48600000
NEEDED   DS    6C                                                       48700000
DEFSAVE  DS    F                   PFK DEFINITION POINTER     MB Y02958 48800000
COMTIOT  DS    F                   ADDRESS COMM TASK TCB      MB Y02958 48900000
COMQDB   DS    F                   COMM TASK DSAB QDB ADDRESS MB Y02958 49000000
MSTRTIOT DS    F                   MASTER TIOT ADDRESS        MB Y02958 49100000
MSTRQDB  DS    F                   MASTER DSAB QDB ADDRESS    MB Y02958 49200000
ADRDSAB  DS    F                   DSAB FOR DCMLIB            MB Y02958 49300000
DATE     DC    X'0099366F'         DATE IN PACKED DECIMAL               49400000
SUBECB   DC    F'0'                SPECIAL ECB FOR PFK READ             49500000
MASK1    DC    XL4'0000FFFF'                                JE @ZA04664 49600000
TABNULL  DC    H'0'                UCB TABLE NULL ENTRY       MC  M1984 49700000
TABEND   DC    X'FFFF'             UCB TABLE END INDICATOR     @Z30AAJE 49800000
MOVER    MVC   N0(N0,RZ),N0(RA)    RESTORE NIPS MESSAGES                49900000
         EJECT                                                          50000000
*********************************************************************** 50100000
*        PROGRAM DSECT AREA                                           * 50200000
*********************************************************************** 50300000
         CVT        DSECT=YES                                           50400000
         EJECT                                                          50500000
UCBBLK   DSECT                                                          50600000
         IEFUCBOB                                                       50700000
         EJECT                                                          50800000
         IEFTIOT1                                                       50900000
         EJECT                                                          51000000
         IHADSAB                                                        51100000
         EJECT                                                          51200000
         IEZJSCB                                                        51300000
         EJECT                                                          51400000
         IKJTCB                                                         51500000
         EJECT                                                          51600000
         IEECUCM  FORMAT=NEW                                            51700000
         EJECT                                                          51800000
         IHAPSA                                                         51900000
         EJECT                                                          52000000
         IEERDCM                                                        52100000
         EJECT                                                          52150000
         IEETDCM                                                        52200000
         EJECT                                                          52250000
SUB      DSECT                                                          52300000
         IEECSUB Y,Y,N,N,Y,Y                                            52900000
         EJECT                                                          52920000
         IECDIOCM                                              @ZA18574 52940000
         EJECT                                                          52960000
         IECDATB                                               @ZA18574 52980000
         END                                                            53000000
./  ADD  SSI=31871459,NAME=IEE10110
         TITLE 'D C,K HANDLER-LOAD 1                                 '  00001000
IEE10110 CSECT ,                                                   0001 00002000
@PROLOG  BALR  @12,0                                               0001 00003000
@PSTART  DS    0H                                                  0001 00004000
         USING @PSTART,@12                                         0001 00005000
*        REG14SAV = R14;           /*SAVE RETURN REGISTER            */ 00006000
         LA    @15,CHASM(,R2)                                      0025 00007000
         ST    R14,REG14SAV(,@15)                                  0025 00008000
*RESPECIFY (R14) UNRESTRICTED;                                     0026 00009000
*        R3 = R1 ;                 /*BASE XSA                        */ 00010000
         LR    R3,R1                                               0027 00011000
*        REG0PARM = 0 ;            /*PUT RECEIVING CONSOLE ID IN     */ 00012000
         SR    @04,@04                                             0028 00013000
         ST    @04,@TF00001                                        0028 00014000
         MVC   REG0PARM(4,@15),@TF00001                            0028 00015000
*        CONID = CHCNID ;          /*   WORD TO BE PUT IN REG 0      */ 00016000
         MVC   CONID(1,@15),CHCNID(R2)                             0029 00017000
*/*SET UP TO ISSUE CONTROL LINE                                      */ 00018000
*/*%CLSETUP: P BUILD CONTROL LINE AND SVC 35 PARAMETER LIST */     0030 00019000
*        WTOPARM = CNTRLINE ;      /*MOVE CONTROL LINE INFO INTO   0030 00020000
*                                       PARAMETER LIST               */ 00021000
         MVI   WTOPARM+43(@15),C' '                                0030 00022000
         MVC   WTOPARM+44(39,@15),WTOPARM+43(@15)                  0030 00023000
         MVC   WTOPARM(43,@15),CNTRLINE                            0030 00024000
*        GEN(TIME DEC);            /*ISSUE TIME MACRO                */ 00025000
         TIME DEC                                                       00026000
*        TIME2 = R0 ;              /*TIME IN PACKED FORM             */ 00027000
         LA    @04,CHASM(,R2)                                      0032 00028000
         LA    @04,TIME1(,@04)                                     0032 00029000
         ST    R0,TIME2(,@04)                                      0032 00030000
*/* GENERATE STATEMENT CHANGED FOR PLS/2 COMPILER           ME Y01958*/ 00031000
*     GEN (UNPK CHASM-CSCBWORK+TIME1(7,R2),CHASM-CSCBWORK+TIME1(4,R2)); 00032000
         UNPK CHASM-CSCBWORK+TIME1(7,R2),CHASM-CSCBWORK+TIME1(4,R2)     00033000
*        HH = HRS ;                /*PUT                             */ 00034000
         LA    @04,CHASM(,R2)                                      0034 00035000
         LA    @15,TEXT(,@04)                                      0034 00036000
         MVC   HH(2,@15),HRS(@04)                                  0034 00037000
*        MM = MIN ;                /*    TIME STAMP IN               */ 00038000
         MVC   MM(2,@15),MIN(@04)                                  0035 00039000
*        SS = SEC ;                /*          PARAMETER LIST        */ 00040000
         MVC   SS(2,@15),SEC(@04)                                  0036 00041000
*        WTOPARM(CNTRLLEN+7)=CHARID; /*PUT AREA ID IN PARAMETER LIST */ 00042000
         LH    @15,CNTRLLEN                                        0037 00043000
         ALR   @15,@04                                             0037 00044000
         MVC   WTOPARM+6(1,@15),CHARID(R2)                         0037 00045000
*        R0 = REG0PARM;            /*SET UP REG 0                    */ 00046000
         MVC   @TF00001(4),REG0PARM(@04)                           0038 00047000
         L     R0,@TF00001                                         0038 00048000
*        R1 = ADDR(WTOPARM);       /*POINT REG 1 TO PARAMETER LIST   */ 00049000
         LA    R1,WTOPARM(,@04)                                    0039 00050000
*/*%CLMLWTO: S SVC 35: ISSUE MLWTO FOR CONTROL LINE */             0040 00051000
*        GEN (SVC 35);             /* ISSUE MLWTO FOR CONTROL LINE   */ 00052000
         SVC 35                                                         00053000
*/*%SAVID: P SAVE MLWTO ID */                                      0041 00054000
*        TEMPARM = R1 ;            /*SAVE MLWTO ID, USING WORK AREA  */ 00055000
         LA    @04,CHASM(,R2)                                      0041 00056000
         ST    R1,@TF00001                                         0041 00057000
         MVC   TEMPARM(4,@04),@TF00001                             0041 00058000
*        MLWTO = TEMMLWTO;         /*   TO AVOID COMPILER TEMPORARY  */ 00059000
         MVC   MLWTO(3,@04),TEMMLWTO(@04)                          0042 00060000
*/*ISSUE DATA LINES                                                  */ 00061000
*        MSGPOINT = ADDR(WTOP1) ;      /*INITIALIZE MSG POINTER      */ 00062000
         LA    MSGPOINT,WTOP1                                      0043 00063000
*        DO I=1 TO 12 ;                /*LOOP TO ISSUE LINES         */ 00064000
         LA    I,1                                                 0044 00065000
@DL00044 DS    0H                                                  0045 00066000
*/*   BUILD PARAMETER LIST IN CSCB                                   */ 00067000
*/*%DLSETUP: P BUILD PARAMETER LIST FOR ONE DATA LINE */           0045 00068000
*        PARMLEN = LENGTH(I) + 4 ;  /*LENGTH OF MSG + FIRST WORD     */ 00069000
         LA    @04,CHASM(,R2)                                      0045 00070000
         LR    @15,I                                               0045 00071000
         AR    @15,@15                                             0045 00072000
         LH    @15,LENGTH-2(@15)                                   0045 00073000
         LA    @14,4                                               0045 00074000
         AR    @14,@15                                             0045 00075000
         STH   @14,PARMLEN(,@04)                                   0045 00076000
*        LEN = LENGTH(I);           /*LENGTH OF MSG FOR MOVE         */ 00077000
         LR    LEN,@15                                             0046 00078000
*        TEXT(1:LEN) = MSGPOINT->WTOP2; /* MOVE TEXT IN              */ 00079000
         LR    @15,LEN                                             0047 00080000
         BCTR  @15,0                                               0047 00081000
         EX    @15,@SM00357                                        0047 00082000
*        TEXT(LEN+1:LEN+8) = CODES ;    /*DESCRIPTOR, ROUTING CODES  */ 00083000
         LR    @15,@04                                             0048 00084000
         ALR   @15,LEN                                             0048 00085000
         MVC   TEXT(8,@15),CODES                                   0048 00086000
*        TEXT(LEN+5) = '20'X ;          /*INDICATE DATA LINE         */ 00087000
         LR    @15,@04                                             0049 00088000
         ALR   @15,LEN                                             0049 00089000
         MVI   TEXT+4(@15),X'20'                                   0049 00090000
*        R1 = ADDR(WTOPARM) ;      /*POINT REG 1 TO PARAMETER LIST   */ 00091000
         LA    R1,WTOPARM(,@04)                                    0050 00092000
*        R0 = REG0PARM ;           /*SET UP REG 0                    */ 00093000
         MVC   @TF00001(4),REG0PARM(@04)                           0051 00094000
         L     R0,@TF00001                                         0051 00095000
*/*%DLMLWTO: S SVC 35: ISSUE MLWTO FOR ONE DATA LINE */            0052 00096000
*        GEN (SVC 35) ;            /*ISSUE SVC 35 FOR MLWTO          */ 00097000
         SVC 35                                                         00098000
*RESPECIFY (R15) RESTRICTED;                                       0053 00099000
*/*TSTCAN: D (YES,QUIT,NO,) HAS DISPLAY BEEN CANCELLED */          0054 00100000
*IF R15 ¬= 0 THEN GO TO QUIT; /* IF DISPLAY CANCELED,EXIT           */  00101000
         LTR   R15,R15                                             0054 00102000
         BNZ   @RT00054                                            0054 00103000
*RESPECIFY (R15) UNRESTRICTED;                                     0056 00104000
*        MSGPOINT = MSGPOINT + LENGTH(I) ; /*UPDATE MSG POINTER      */ 00105000
         LR    @04,I                                               0057 00106000
         AR    @04,@04                                             0057 00107000
         AH    MSGPOINT,LENGTH-2(@04)                              0057 00108000
*/*%TSTDONE: D (YES,%DLSETUP,NO,%EXIT)MORE DATA LINES FOR THIS LOAD  */ 00109000
*        END;                      /*END OF DO LOOP                  */ 00110000
         AH    I,@CH00048                                          0058 00111000
         CH    I,@CH00277                                          0058 00112000
         BNH   @DL00044                                            0058 00113000
*/*%EXIT: R IEE11110 */                                            0059 00114000
*        XAX(5) = '1' ;       /* CHANGE XCTL NAME TO SECOND LOAD     */ 00115000
         MVI   XAX+4(R3),C'1'                                      0059 00116000
*RESPECIFY (R15) RESTRICTED;                                       0060 00117000
*OUT:    R15 = R3;            /*POINT REG 15 TO XCTL PARAMETER LIST  */ 00118000
OUT      LR    R15,R3                                              0061 00119000
*        GEN ( XCTL SF=(E,(15)) ); /*XCTL                            */ 00120000
          XCTL SF=(E,(15))                                              00121000
*RESPECIFY (R15) UNRESTRICTED;                                     0063 00122000
*/*QUIT: R IEE00110 */                                             0064 00123000
*QUIT: XAX(4:5)='00'; /*CHANGE XCTL NAME TO SVC 110 ROUTER           */ 00124000
QUIT     MVC   XAX+3(2,R3),@CC00354                                0064 00125000
*R14 = REG14SAV;                                                   0065 00126000
         LA    @04,CHASM(,R2)                                      0065 00127000
         L     R14,REG14SAV(,@04)                                  0065 00128000
*GO TO OUT;                                                        0066 00129000
         B     OUT                                                 0066 00130000
*/*IEE10110: END */                                                0067 00131000
*        END                                                       0067 00132000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 00133000
*/*%INCLUDE SYSLIB  (IEECHAIN)                                        * 00134000
*/*%INCLUDE SYSLIB  (IEEXSA  )                                        * 00135000
*;                                                                 0067 00136000
@EL00001 DS    0H                                                  0067 00137000
@EF00001 DS    0H                                                  0067 00138000
@ER00001 BR    @14                                                 0067 00139000
@DATA    DS    0H                                                       00140000
@CH00048 DC    H'1'                                                     00141000
@CH00277 DC    H'12'                                                    00142000
@SM00357 MVC   TEXT(0,@04),WTOP2(MSGPOINT)                              00143000
         DS    0F                                                       00144000
@TF00001 DS    F                                                        00145000
         DS    0F                                                       00146000
         DS    0D                                                       00147000
@CC00354 DC    C'00'                                                    00148000
CNTRLINE DS    CL43                                                     00149000
         ORG   CNTRLINE                                                 00150000
CNTRLLEN DC    H'35'                                                    00151000
FLAGS    DC    X'E040'                                                  00152000
TITLE    DS    CL31                                                     00153000
         ORG   TITLE                                                    00154000
MSGID    DC    CL10'IEE162I   '                                         00155000
TIMESTMP DS    CL8                                                      00156000
         ORG   TIMESTMP                                                 00157000
HHI      DS    CL2                                                      00158000
PER1     DC    CL1'.'                                                   00159000
MMI      DS    CL2                                                      00160000
PER2     DC    CL1'.'                                                   00161000
SSI      DS    CL2                                                      00162000
         ORG   TITLE+18                                                 00163000
REST     DC    CL13'   K COMMAND'                                       00164000
         ORG   CNTRLINE+35                                              00165000
CODES    DS    CL8                                                      00166000
         ORG   CODES                                                    00167000
DESCOD   DC    X'0980'                                                  00168000
ROUCOD   DC    X'0000'                                                  00169000
LINTYP   DC    X'8000'                                                  00170000
AREAID   DS    CL1                                                      00171000
MULINE   DC    AL1(1)                                                   00172000
         ORG   CNTRLINE+43                                              00173000
         DS    CL3                                                      00174000
WTOP1    DS    CL557                                                    00175000
         ORG   WTOP1                                                    00176000
LINE01   DC    CL58'K D,N        NUMBER MESSAGE LINES UNTIL DELETION REC00177000
               QUESTED'                                                 00178000
LINE02   DC    CL46'   ,N,HOLD   NUMBER MESSAGE LINES ALL THE TIME'     00179000
LINE03   DC    CL50'   ,F        MOVE STATUS DISPLAY FORWARD ONE FRAME' 00180000
LINE04   DC    CL49'   ,H        HOLD DYNAMIC DISPLAY - DO NOT UPDATE'  00181000
LINE05   DC    CL35'   ,U        UPDATE DYNAMIC DISPLAY'                00182000
LINE06   DC    CL46'   ,PFK      DISPLAY PROGRAM FUNCTION KEY LINE'     00183000
LINE07   DC    CL59'K E,SEG      ERASE MESSAGE LINES SPECIFIED IN SEG=NC00184000
               N OPTION'                                                00185000
LINE08   DC    CL51'   ,NN,NN    ERASE MESSAGE LINE NN OR NN THROUGH NNC00186000
               '                                                        00187000
LINE09   DC    CL35'   ,F        ERASE FLAGGED MESSAGES'                00188000
LINE10   DC    CL45'   ,D        ERASE OUT-OF-LINE STATUS DISPLAY'      00189000
LINE11   DC    CL39'   ,N        ERASE MESSAGE LINE NUMBERS'            00190000
LINE12   DC    CL44'   ,PFK      ERASE PROGRAM FUNCTION KEY LINE'       00191000
         ORG   WTOP1+557                                                00192000
         DS    CL1                                                      00193000
LENGTH   DC    H'58'                                                    00194000
         DC    H'46'                                                    00195000
         DC    H'50'                                                    00196000
         DC    H'49'                                                    00197000
         DC    H'35'                                                    00198000
         DC    H'46'                                                    00199000
         DC    H'59'                                                    00200000
         DC    H'51'                                                    00201000
         DC    H'35'                                                    00202000
         DC    H'45'                                                    00203000
         DC    H'39'                                                    00204000
         DC    H'44'                                                    00205000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00206000
@01      EQU   01                                                       00207000
@02      EQU   02                                                       00208000
@03      EQU   03                                                       00209000
@04      EQU   04                                                       00210000
@05      EQU   05                                                       00211000
@06      EQU   06                                                       00212000
@07      EQU   07                                                       00213000
@08      EQU   08                                                       00214000
@09      EQU   09                                                       00215000
@10      EQU   10                                                       00216000
@11      EQU   11                                                       00217000
@12      EQU   12                                                       00218000
@13      EQU   13                                                       00219000
@14      EQU   14                                                       00220000
@15      EQU   15                                                       00221000
R0       EQU   @00                                                      00222000
R1       EQU   @01                                                      00223000
R2       EQU   @02                                                      00224000
R3       EQU   @03                                                      00225000
MSGPOINT EQU   @05                                                      00226000
I        EQU   @06                                                      00227000
LEN      EQU   @07                                                      00228000
R14      EQU   @14                                                      00229000
R15      EQU   @15                                                      00230000
CHAIN    EQU   0                                                        00231000
CHFLG    EQU   CHAIN+4                                                  00232000
CHSTS    EQU   CHFLG+2                                                  00233000
CHACT    EQU   CHFLG+3                                                  00234000
CHKEY    EQU   CHAIN+8                                                  00235000
CHPKE    EQU   CHAIN+28                                                 00236000
CHTJID   EQU   CHAIN+30                                                 00237000
CHACT1   EQU   CHAIN+35                                                 00238000
CHASM    EQU   CHAIN+40                                                 00239000
CHCIBP   EQU   CHASM+4                                                  00240000
CHRGNSZ  EQU   CHASM+8                                                  00241000
CHSHORT  EQU   CHASM+24                                                 00242000
CHSWT    EQU   CHSHORT                                                  00243000
XSAMAP   EQU   0                                                        00244000
XASVRB   EQU   XSAMAP                                                   00245000
XSA      EQU   XASVRB                                                   00246000
XAX      EQU   XASVRB+8                                                 00247000
@NM00005 EQU   XASVRB+16                                                00248000
@NM00006 EQU   XASVRB+20                                                00249000
XAS      EQU   XASVRB+32                                                00250000
EEXSAS01 EQU   0                                                        00251000
EEXSAS02 EQU   0                                                        00252000
XASDS    EQU   EEXSAS02+2                                               00253000
@NM00011 EQU   EEXSAS02+4                                               00254000
EEXSAS03 EQU   0                                                        00255000
XAXMASK  EQU   EEXSAS03                                                 00256000
CSCBWORK EQU   0                                                        00257000
REG14SAV EQU   CSCBWORK                                                 00258000
REG0PARM EQU   CSCBWORK+4                                               00259000
MLWTO    EQU   REG0PARM                                                 00260000
CONID    EQU   REG0PARM+3                                               00261000
TEMPARM  EQU   CSCBWORK+8                                               00262000
TEMMLWTO EQU   TEMPARM+1                                                00263000
TIME1    EQU   CSCBWORK+12                                              00264000
HRS      EQU   TIME1                                                    00265000
MIN      EQU   TIME1+2                                                  00266000
SEC      EQU   TIME1+4                                                  00267000
WTOPARM  EQU   CSCBWORK+20                                              00268000
PARMLEN  EQU   WTOPARM                                                  00269000
TEXT     EQU   WTOPARM+4                                                00270000
TIME2    EQU   0                                                        00271000
DUMTITLE EQU   0                                                        00272000
DTIME    EQU   DUMTITLE+10                                              00273000
HH       EQU   DTIME                                                    00274000
MM       EQU   DTIME+3                                                  00275000
SS       EQU   DTIME+6                                                  00276000
WTOP2    EQU   0                                                        00277000
CHAINS01 EQU   CHASM                                                    00278000
CHTYPE   EQU   CHAINS01+124                                             00279000
CHTRSTAT EQU   CHAINS01+125                                             00280000
CHCNID   EQU   CHAINS01+126                                             00281000
CHARID   EQU   CHAINS01+127                                             00282000
CHCSYSO  EQU   CHAINS01+134                                             00283000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00284000
CHLAST   EQU   CHAINS01+136                                             00285000
CHSPA    EQU   CHAINS01+135                                             00286000
CHUSERID EQU   CHCSYSO                                                  00287000
CHJB     EQU   CHCSYSO                                                  00288000
CHDUMP   EQU   CHCSYSO                                                  00289000
CHQUE    EQU   CHCSYSO                                                  00290000
CHHOLD   EQU   CHCSYSO                                                  00291000
CHOUT    EQU   CHCSYSO                                                  00292000
CHINN    EQU   CHCSYSO                                                  00293000
CHALL    EQU   CHCSYSO                                                  00294000
CHINC    EQU   CHAINS01+132                                             00295000
CHPEND   EQU   CHAINS01+128                                             00296000
@NM00004 EQU   CHTRSTAT                                                 00297000
CHTSL    EQU   CHTRSTAT                                                 00298000
CHTS     EQU   CHTRSTAT                                                 00299000
CHINITL  EQU   CHTRSTAT                                                 00300000
CHINIT   EQU   CHTRSTAT                                                 00301000
CHJOBSL  EQU   CHTRSTAT                                                 00302000
CHJOBS   EQU   CHTRSTAT                                                 00303000
CHDEF    EQU   CHTYPE                                                   00304000
CHHIAR   EQU   CHTYPE                                                   00305000
CHARSV29 EQU   CHTYPE                                                   00306000
CHARSV28 EQU   CHTYPE                                                   00307000
CHARSV27 EQU   CHTYPE                                                   00308000
CHARSV26 EQU   CHTYPE                                                   00309000
CHARSV25 EQU   CHTYPE                                                   00310000
CHDSTAT  EQU   CHTYPE                                                   00311000
CHBUF    EQU   CHAINS01                                                 00312000
@NM00015 EQU   DTIME+5                                                  00313000
@NM00014 EQU   DTIME+2                                                  00314000
DMSGID   EQU   DUMTITLE                                                 00315000
MCSFLAGS EQU   WTOPARM+2                                                00316000
STC      EQU   TIME1+6                                                  00317000
HIGH     EQU   TEMPARM                                                  00318000
XAXSACB  EQU   EEXSAS03+4                                               00319000
XAXUTME  EQU   EEXSAS03+2                                               00320000
XAXFREE  EQU   EEXSAS03+1                                               00321000
@NM00013 EQU   XAXMASK                                                  00322000
XAXTSL   EQU   XAXMASK                                                  00323000
XAXTS    EQU   XAXMASK                                                  00324000
@NM00012 EQU   XAXMASK                                                  00325000
XAXJOBSL EQU   XAXMASK                                                  00326000
XAXJOBS  EQU   XAXMASK                                                  00327000
XASOPTR  EQU   @NM00011+1                                               00328000
XASTSAVE EQU   @NM00011                                                 00329000
XASPLS3  EQU   EEXSAS02+3                                               00330000
@NM00010 EQU   XASDS                                                    00331000
XASSDS5  EQU   XASDS                                                    00332000
XASSDS4  EQU   XASDS                                                    00333000
XASSDS3  EQU   XASDS                                                    00334000
XASSDS2  EQU   XASDS                                                    00335000
XASSDS   EQU   XASDS                                                    00336000
XASDID   EQU   EEXSAS02+1                                               00337000
XASCID   EQU   EEXSAS02                                                 00338000
@NM00009 EQU   EEXSAS01+44                                              00339000
XAT      EQU   EEXSAS01+20                                              00340000
XAF      EQU   EEXSAS01+12                                              00341000
XAI      EQU   EEXSAS01+4                                               00342000
XAH      EQU   EEXSAS01                                                 00343000
XASAVSTD EQU   XSAMAP+64                                                00344000
XASAVLOC EQU   XSAMAP+48                                                00345000
@NM00008 EQU   XASVRB+44                                                00346000
XAA      EQU   XASVRB+42                                                00347000
@NM00007 EQU   XASVRB+41                                                00348000
XAU      EQU   XASVRB+40                                                00349000
XAV      EQU   XASVRB+24                                                00350000
XAL      EQU   @NM00006+1                                               00351000
XAN      EQU   @NM00006                                                 00352000
XAR      EQU   @NM00005+1                                               00353000
XAE      EQU   @NM00005                                                 00354000
XAD      EQU   XSA+4                                                    00355000
XAP      EQU   XSA                                                      00356000
CHARSV16 EQU   CHSHORT+108                                              00357000
CHARSV15 EQU   CHSHORT+104                                              00358000
CHJSCBVS EQU   CHSHORT+100                                              00359000
CHUSCVS  EQU   CHSHORT+96                                               00360000
@NM00003 EQU   CHSHORT+92                                               00361000
@NM00002 EQU   CHSHORT+88                                               00362000
CHSQA    EQU   CHSHORT+52                                               00363000
CHQPA    EQU   CHSHORT+16                                               00364000
CHJCL    EQU   CHSHORT+12                                               00365000
CHSPC    EQU   CHSHORT+8                                                00366000
CHSPB    EQU   CHSHORT+4                                                00367000
CHTCB    EQU   CHSHORT+1                                                00368000
CHARSV23 EQU   CHSWT                                                    00369000
CHARSV22 EQU   CHSWT                                                    00370000
CHARSV21 EQU   CHSWT                                                    00371000
CHAC     EQU   CHSWT                                                    00372000
CHPSF    EQU   CHSWT                                                    00373000
CHPSD    EQU   CHSWT                                                    00374000
CHJCT    EQU   CHSWT                                                    00375000
CHARSV20 EQU   CHSWT                                                    00376000
CHCECB   EQU   CHASM+20                                                 00377000
CHECB    EQU   CHASM+16                                                 00378000
CHRGNAD  EQU   CHASM+12                                                 00379000
CHARSV18 EQU   CHRGNSZ+1                                                00380000
CHRPRTY  EQU   CHRGNSZ                                                  00381000
@NM00001 EQU   CHCIBP                                                   00382000
CHEND    EQU   CHCIBP                                                   00383000
CHECBP   EQU   CHASM                                                    00384000
CHDER    EQU   CHAIN+36                                                 00385000
CHARSV10 EQU   CHACT1                                                   00386000
CHARSV09 EQU   CHACT1                                                   00387000
CHARSV08 EQU   CHACT1                                                   00388000
CHARSV07 EQU   CHACT1                                                   00389000
CHARSV06 EQU   CHACT1                                                   00390000
CHARSV05 EQU   CHACT1                                                   00391000
CHARSV04 EQU   CHACT1                                                   00392000
CHRDWTR  EQU   CHACT1                                                   00393000
CHARSV30 EQU   CHAIN+34                                                 00394000
CHQID    EQU   CHAIN+32                                                 00395000
CHASID   EQU   CHTJID                                                   00396000
CHUCMP   EQU   CHAIN+29                                                 00397000
CHTRKID  EQU   CHPKE                                                    00398000
CHCIBCTR EQU   CHAIN+27                                                 00399000
CHUNIT   EQU   CHAIN+24                                                 00400000
CHCLS    EQU   CHAIN+16                                                 00401000
CHPARM   EQU   CHKEY                                                    00402000
CHIFY    EQU   CHACT                                                    00403000
CHAIFX   EQU   CHACT                                                    00404000
CHCLD    EQU   CHACT                                                    00405000
CHCL     EQU   CHACT                                                    00406000
CHDSI    EQU   CHACT                                                    00407000
CHDISC   EQU   CHACT                                                    00408000
CHTERM   EQU   CHACT                                                    00409000
CHSWAP   EQU   CHACT                                                    00410000
CHABTERM EQU   CHSTS                                                    00411000
CHFC     EQU   CHSTS                                                    00412000
CHDL     EQU   CHSTS                                                    00413000
CHAD     EQU   CHSTS                                                    00414000
CHQSPC   EQU   CHSTS                                                    00415000
CHSOUT   EQU   CHSTS                                                    00416000
CHSYS    EQU   CHSTS                                                    00417000
CHAP     EQU   CHSTS                                                    00418000
CHSZE    EQU   CHFLG+1                                                  00419000
CHVCD    EQU   CHFLG                                                    00420000
CHPTR    EQU   CHAIN                                                    00421000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00422000
@RT00054 EQU   QUIT                                                     00423000
@ENDDATA EQU   *                                                        00424000
         END   IEE10110,(C'PL/S-II',0402,73187)                         00425000
./  ADD  SSI=31871462,NAME=IEE11110
         TITLE 'D C,K HANDLER-LOAD 2                                 '  00001000
IEE11110 CSECT ,                                                   0001 00002000
@PROLOG  BALR  @12,0                                               0001 00003000
@PSTART  DS    0H                                                  0001 00004000
         USING @PSTART,@12                                         0001 00005000
*/*ISSUE DATA LINES                                                  */ 00006000
*        MCSFLAGS = FLAGS ;            /*MOVE IN MCS FLAGS           */ 00007000
         LA    @04,CHASM(,R2)                                      0022 00008000
         MVC   MCSFLAGS(2,@04),FLAGS                               0022 00009000
*        MSGPOINT = ADDR(WTOP1) ;      /*INITIALIZE MSG POINTER      */ 00010000
         LA    MSGPOINT,WTOP1                                      0023 00011000
*        DO I=1 TO 14 ;                /*LOOP TO ISSUE LINES         */ 00012000
         LA    I,1                                                 0024 00013000
@DL00024 DS    0H                                                  0025 00014000
*/*   BUILD PARAMETER LIST IN CSCB                                   */ 00015000
*/*%DLSETUP: P BUILD PARAMETER LIST FOR ONE DATA LINE */           0025 00016000
*        PARMLEN = LENGTH(I) + 4 ;                                 0025 00017000
         LA    @04,CHASM(,R2)                                      0025 00018000
         LR    @15,I                                               0025 00019000
         AR    @15,@15                                             0025 00020000
         LH    @15,LENGTH-2(@15)                                   0025 00021000
         LA    @14,4                                               0025 00022000
         AR    @14,@15                                             0025 00023000
         STH   @14,PARMLEN(,@04)                                   0025 00024000
*        LEN = LENGTH(I);                                          0026 00025000
         LR    LEN,@15                                             0026 00026000
*        TEXT(1:LEN) = MSGPOINT->WTOP2; /* MOVE TEXT IN              */ 00027000
         LR    @15,LEN                                             0027 00028000
         BCTR  @15,0                                               0027 00029000
         EX    @15,@SM00343                                        0027 00030000
*        TEXT(LEN+1:LEN+8) = CODES ;    /*DESCRIPTOR, ROUTING CODES  */ 00031000
         LR    @15,@04                                             0028 00032000
         ALR   @15,LEN                                             0028 00033000
         MVC   TEXT(8,@15),CODES                                   0028 00034000
*        R1 = ADDR(WTOPARM) ;      /*POINT REG 1 TO PARAMETER LIST   */ 00035000
         LA    R1,WTOPARM(,@04)                                    0029 00036000
*        R0 = REG0PARM ;           /*SET UP REG 0                    */ 00037000
         MVC   @TF00001(4),REG0PARM(@04)                           0030 00038000
         L     R0,@TF00001                                         0030 00039000
*/*%DLMLWTO: S SVC 35: ISSUE MLWTO FOR ONE DATA LINE */            0031 00040000
*        GEN (SVC 35) ;                                            0031 00041000
         SVC 35                                                         00042000
*RESPECIFY (R15) RESTRICTED;                                       0032 00043000
*/*TSTCAN: D (YES,QUIT,NO,) HAS DISPLAY BEEN CANCELLED */          0033 00044000
*IF R15 ¬= 0 THEN GO TO QUIT; /* IF DISPLAY CANCELED,EXIT           */  00045000
         LTR   R15,R15                                             0033 00046000
         BNZ   @RT00033                                            0033 00047000
*RESPECIFY (R15) UNRESTRICTED;                                     0035 00048000
*        MSGPOINT = MSGPOINT + LENGTH(I) ;                         0036 00049000
         LR    @04,I                                               0036 00050000
         AR    @04,@04                                             0036 00051000
         AH    MSGPOINT,LENGTH-2(@04)                              0036 00052000
*/*%TSTDONE: D (YES,%DLSETUP,NO,%EXIT) MORE DATA LINES FOR THIS LOAD */ 00053000
*        END;                                                      0037 00054000
         AH    I,@CH00048                                          0037 00055000
         CH    I,@CH00250                                          0037 00056000
         BNH   @DL00024                                            0037 00057000
*/*%EXIT: R IEE12110 */                                            0038 00058000
*        XAX(5) = '2' ;       /* CHANGE XCTL NAME TO THIRD LOAD      */ 00059000
         MVI   XAX+4(R3),C'2'                                      0038 00060000
*RESPECIFY (R15) RESTRICTED;                                       0039 00061000
*OUT:    R15 = R3;                                                 0040 00062000
OUT      LR    R15,R3                                              0040 00063000
*        GEN ( XCTL SF=(E,(15)) );                                 0041 00064000
          XCTL SF=(E,(15))                                              00065000
*RESPECIFY (R15) UNRESTRICTED;                                     0042 00066000
*/*QUIT: R IEE00110 */                                             0043 00067000
*QUIT: XAX(4:5)='00'; /*CHANGE XCTL NAME TO SVC 110 ROUTER           */ 00068000
QUIT     MVC   XAX+3(2,R3),@CC00341                                0043 00069000
*R14 = REG14SAV;              /*RESTORE RETURN ADDRESS     ME YM4103 */ 00070000
         LA    @04,CHASM(,R2)                                      0044 00071000
         L     R14,REG14SAV(,@04)                                  0044 00072000
*GO TO OUT;                                                        0045 00073000
         B     OUT                                                 0045 00074000
*/*IEE11110: END */                                                0046 00075000
*  END                                                             0046 00076000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 00077000
*/*%INCLUDE SYSLIB  (IEECHAIN)                                        * 00078000
*/*%INCLUDE SYSLIB  (IEEXSA  )                                        * 00079000
*;                                                                 0046 00080000
@EL00001 DS    0H                                                  0046 00081000
@EF00001 DS    0H                                                  0046 00082000
@ER00001 BR    @14                                                 0046 00083000
@DATA    DS    0H                                                       00084000
@CH00048 DC    H'1'                                                     00085000
@CH00250 DC    H'14'                                                    00086000
@SM00343 MVC   TEXT(0,@04),WTOP2(MSGPOINT)                              00087000
         DS    0F                                                       00088000
@TF00001 DS    F                                                        00089000
         DS    0F                                                       00090000
         DS    0D                                                       00091000
@CC00341 DC    C'00'                                                    00092000
PARAMS   DS    CL10                                                     00093000
         ORG   PARAMS                                                   00094000
FLAGS    DC    X'E040'                                                  00095000
CODES    DS    CL8                                                      00096000
         ORG   CODES                                                    00097000
DESCOD   DC    X'0980'                                                  00098000
ROUCOD   DC    X'0000'                                                  00099000
LINTYP   DC    X'2000'                                                  00100000
AREAID   DS    CL1                                                      00101000
MULINE   DC    AL1(1)                                                   00102000
         ORG   PARAMS+10                                                00103000
WTOP1    DS    CL665                                                    00104000
         ORG   WTOP1                                                    00105000
LINE13   DC    CL45'K S,REF      DISPLAY ALL SPECIFICATION VALUES'      00106000
LINE14   DC    CL42'   ,DEL=Y    DELETE MESSAGES AUTOMATICALLY'         00107000
LINE15   DC    CL49'   ,DEL=N    DO NOT DELETE MESSAGES AUTOMATICALLY'  00108000
LINE16   DC    CL30'   ,DEL=R    ROLL ALL MESSAGES'                     00109000
LINE17   DC    CL41'   ,DEL=RD   ROLL ONLY DELETABLE MESSAGES'          00110000
LINE18   DC    CL46'   ,CON=Y    DELETE MESSAGES WITH VERIFICATION'     00111000
LINE19   DC    CL49'   ,CON=N    DELETE MESSAGES WITHOUT VERIFICATION'  00112000
LINE20   DC    CL52'   ,SEG=NN   DELETE NN LINES WHEN K E,SEG IS ENTEREC00113000
               D'                                                       00114000
LINE21   DC    CL43'   ,RNUM=NN  ROLL NN MESSAGES (DEL=R OR RD)'        00115000
LINE22   DC    CL58'   ,RTME=NNN ROLL MESSAGES EVERY NNN SECONDS (DEL=RC00116000
                OR RD)'                                                 00117000
LINE23   DC    CL47'K C,D,ID     CANCEL IN-LINE DISPLAY NUMBERED ID'    00118000
LINE24   DC    CL61'K T,REF      DISPLAY TIME INTERVAL FOR DYNAMIC DISPC00119000
               LAY UPDATE'                                              00120000
LINE25   DC    CL53'   ,UTME=NNN UPDATE DYNAMIC DISPLAY EVERY NNN SECONC00121000
               DS'                                                      00122000
LINE26   DC    CL49'K A,REF      DISPLAY ALL DISPLAY AREA DEFINITIONS'  00123000
         ORG   WTOP1+665                                                00124000
         DS    CL1                                                      00125000
LENGTH   DC    H'45'                                                    00126000
         DC    H'42'                                                    00127000
         DC    H'49'                                                    00128000
         DC    H'30'                                                    00129000
         DC    H'41'                                                    00130000
         DC    H'46'                                                    00131000
         DC    H'49'                                                    00132000
         DC    H'52'                                                    00133000
         DC    H'43'                                                    00134000
         DC    H'58'                                                    00135000
         DC    H'47'                                                    00136000
         DC    H'61'                                                    00137000
         DC    H'53'                                                    00138000
         DC    H'49'                                                    00139000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00140000
@01      EQU   01                                                       00141000
@02      EQU   02                                                       00142000
@03      EQU   03                                                       00143000
@04      EQU   04                                                       00144000
@05      EQU   05                                                       00145000
@06      EQU   06                                                       00146000
@07      EQU   07                                                       00147000
@08      EQU   08                                                       00148000
@09      EQU   09                                                       00149000
@10      EQU   10                                                       00150000
@11      EQU   11                                                       00151000
@12      EQU   12                                                       00152000
@13      EQU   13                                                       00153000
@14      EQU   14                                                       00154000
@15      EQU   15                                                       00155000
R0       EQU   @00                                                      00156000
R1       EQU   @01                                                      00157000
R2       EQU   @02                                                      00158000
R3       EQU   @03                                                      00159000
MSGPOINT EQU   @05                                                      00160000
I        EQU   @06                                                      00161000
LEN      EQU   @07                                                      00162000
R14      EQU   @14                                                      00163000
R15      EQU   @15                                                      00164000
CHAIN    EQU   0                                                        00165000
CHFLG    EQU   CHAIN+4                                                  00166000
CHSTS    EQU   CHFLG+2                                                  00167000
CHACT    EQU   CHFLG+3                                                  00168000
CHKEY    EQU   CHAIN+8                                                  00169000
CHPKE    EQU   CHAIN+28                                                 00170000
CHTJID   EQU   CHAIN+30                                                 00171000
CHACT1   EQU   CHAIN+35                                                 00172000
CHASM    EQU   CHAIN+40                                                 00173000
CHCIBP   EQU   CHASM+4                                                  00174000
CHRGNSZ  EQU   CHASM+8                                                  00175000
CHSHORT  EQU   CHASM+24                                                 00176000
CHSWT    EQU   CHSHORT                                                  00177000
XSAMAP   EQU   0                                                        00178000
XASVRB   EQU   XSAMAP                                                   00179000
XSA      EQU   XASVRB                                                   00180000
XAX      EQU   XASVRB+8                                                 00181000
@NM00005 EQU   XASVRB+16                                                00182000
@NM00006 EQU   XASVRB+20                                                00183000
XAS      EQU   XASVRB+32                                                00184000
EEXSAS01 EQU   0                                                        00185000
EEXSAS02 EQU   0                                                        00186000
XASDS    EQU   EEXSAS02+2                                               00187000
@NM00011 EQU   EEXSAS02+4                                               00188000
EEXSAS03 EQU   0                                                        00189000
XAXMASK  EQU   EEXSAS03                                                 00190000
CSCBWORK EQU   0                                                        00191000
REG14SAV EQU   CSCBWORK                                                 00192000
REG0PARM EQU   CSCBWORK+4                                               00193000
TEMPARM  EQU   CSCBWORK+8                                               00194000
TIME1    EQU   CSCBWORK+12                                              00195000
WTOPARM  EQU   CSCBWORK+20                                              00196000
PARMLEN  EQU   WTOPARM                                                  00197000
MCSFLAGS EQU   WTOPARM+2                                                00198000
TEXT     EQU   WTOPARM+4                                                00199000
WTOP2    EQU   0                                                        00200000
CHAINS01 EQU   CHASM                                                    00201000
CHTYPE   EQU   CHAINS01+124                                             00202000
CHTRSTAT EQU   CHAINS01+125                                             00203000
CHCSYSO  EQU   CHAINS01+134                                             00204000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00205000
CHLAST   EQU   CHAINS01+136                                             00206000
CHSPA    EQU   CHAINS01+135                                             00207000
CHUSERID EQU   CHCSYSO                                                  00208000
CHJB     EQU   CHCSYSO                                                  00209000
CHDUMP   EQU   CHCSYSO                                                  00210000
CHQUE    EQU   CHCSYSO                                                  00211000
CHHOLD   EQU   CHCSYSO                                                  00212000
CHOUT    EQU   CHCSYSO                                                  00213000
CHINN    EQU   CHCSYSO                                                  00214000
CHALL    EQU   CHCSYSO                                                  00215000
CHINC    EQU   CHAINS01+132                                             00216000
CHPEND   EQU   CHAINS01+128                                             00217000
CHARID   EQU   CHAINS01+127                                             00218000
CHCNID   EQU   CHAINS01+126                                             00219000
@NM00004 EQU   CHTRSTAT                                                 00220000
CHTSL    EQU   CHTRSTAT                                                 00221000
CHTS     EQU   CHTRSTAT                                                 00222000
CHINITL  EQU   CHTRSTAT                                                 00223000
CHINIT   EQU   CHTRSTAT                                                 00224000
CHJOBSL  EQU   CHTRSTAT                                                 00225000
CHJOBS   EQU   CHTRSTAT                                                 00226000
CHDEF    EQU   CHTYPE                                                   00227000
CHHIAR   EQU   CHTYPE                                                   00228000
CHARSV29 EQU   CHTYPE                                                   00229000
CHARSV28 EQU   CHTYPE                                                   00230000
CHARSV27 EQU   CHTYPE                                                   00231000
CHARSV26 EQU   CHTYPE                                                   00232000
CHARSV25 EQU   CHTYPE                                                   00233000
CHDSTAT  EQU   CHTYPE                                                   00234000
CHBUF    EQU   CHAINS01                                                 00235000
STC      EQU   TIME1+6                                                  00236000
SEC      EQU   TIME1+4                                                  00237000
MIN      EQU   TIME1+2                                                  00238000
HRS      EQU   TIME1                                                    00239000
TEMMLWTO EQU   TEMPARM+1                                                00240000
HIGH     EQU   TEMPARM                                                  00241000
CONID    EQU   REG0PARM+3                                               00242000
MLWTO    EQU   REG0PARM                                                 00243000
XAXSACB  EQU   EEXSAS03+4                                               00244000
XAXUTME  EQU   EEXSAS03+2                                               00245000
XAXFREE  EQU   EEXSAS03+1                                               00246000
@NM00013 EQU   XAXMASK                                                  00247000
XAXTSL   EQU   XAXMASK                                                  00248000
XAXTS    EQU   XAXMASK                                                  00249000
@NM00012 EQU   XAXMASK                                                  00250000
XAXJOBSL EQU   XAXMASK                                                  00251000
XAXJOBS  EQU   XAXMASK                                                  00252000
XASOPTR  EQU   @NM00011+1                                               00253000
XASTSAVE EQU   @NM00011                                                 00254000
XASPLS3  EQU   EEXSAS02+3                                               00255000
@NM00010 EQU   XASDS                                                    00256000
XASSDS5  EQU   XASDS                                                    00257000
XASSDS4  EQU   XASDS                                                    00258000
XASSDS3  EQU   XASDS                                                    00259000
XASSDS2  EQU   XASDS                                                    00260000
XASSDS   EQU   XASDS                                                    00261000
XASDID   EQU   EEXSAS02+1                                               00262000
XASCID   EQU   EEXSAS02                                                 00263000
@NM00009 EQU   EEXSAS01+44                                              00264000
XAT      EQU   EEXSAS01+20                                              00265000
XAF      EQU   EEXSAS01+12                                              00266000
XAI      EQU   EEXSAS01+4                                               00267000
XAH      EQU   EEXSAS01                                                 00268000
XASAVSTD EQU   XSAMAP+64                                                00269000
XASAVLOC EQU   XSAMAP+48                                                00270000
@NM00008 EQU   XASVRB+44                                                00271000
XAA      EQU   XASVRB+42                                                00272000
@NM00007 EQU   XASVRB+41                                                00273000
XAU      EQU   XASVRB+40                                                00274000
XAV      EQU   XASVRB+24                                                00275000
XAL      EQU   @NM00006+1                                               00276000
XAN      EQU   @NM00006                                                 00277000
XAR      EQU   @NM00005+1                                               00278000
XAE      EQU   @NM00005                                                 00279000
XAD      EQU   XSA+4                                                    00280000
XAP      EQU   XSA                                                      00281000
CHARSV16 EQU   CHSHORT+108                                              00282000
CHARSV15 EQU   CHSHORT+104                                              00283000
CHJSCBVS EQU   CHSHORT+100                                              00284000
CHUSCVS  EQU   CHSHORT+96                                               00285000
@NM00003 EQU   CHSHORT+92                                               00286000
@NM00002 EQU   CHSHORT+88                                               00287000
CHSQA    EQU   CHSHORT+52                                               00288000
CHQPA    EQU   CHSHORT+16                                               00289000
CHJCL    EQU   CHSHORT+12                                               00290000
CHSPC    EQU   CHSHORT+8                                                00291000
CHSPB    EQU   CHSHORT+4                                                00292000
CHTCB    EQU   CHSHORT+1                                                00293000
CHARSV23 EQU   CHSWT                                                    00294000
CHARSV22 EQU   CHSWT                                                    00295000
CHARSV21 EQU   CHSWT                                                    00296000
CHAC     EQU   CHSWT                                                    00297000
CHPSF    EQU   CHSWT                                                    00298000
CHPSD    EQU   CHSWT                                                    00299000
CHJCT    EQU   CHSWT                                                    00300000
CHARSV20 EQU   CHSWT                                                    00301000
CHCECB   EQU   CHASM+20                                                 00302000
CHECB    EQU   CHASM+16                                                 00303000
CHRGNAD  EQU   CHASM+12                                                 00304000
CHARSV18 EQU   CHRGNSZ+1                                                00305000
CHRPRTY  EQU   CHRGNSZ                                                  00306000
@NM00001 EQU   CHCIBP                                                   00307000
CHEND    EQU   CHCIBP                                                   00308000
CHECBP   EQU   CHASM                                                    00309000
CHDER    EQU   CHAIN+36                                                 00310000
CHARSV10 EQU   CHACT1                                                   00311000
CHARSV09 EQU   CHACT1                                                   00312000
CHARSV08 EQU   CHACT1                                                   00313000
CHARSV07 EQU   CHACT1                                                   00314000
CHARSV06 EQU   CHACT1                                                   00315000
CHARSV05 EQU   CHACT1                                                   00316000
CHARSV04 EQU   CHACT1                                                   00317000
CHRDWTR  EQU   CHACT1                                                   00318000
CHARSV30 EQU   CHAIN+34                                                 00319000
CHQID    EQU   CHAIN+32                                                 00320000
CHASID   EQU   CHTJID                                                   00321000
CHUCMP   EQU   CHAIN+29                                                 00322000
CHTRKID  EQU   CHPKE                                                    00323000
CHCIBCTR EQU   CHAIN+27                                                 00324000
CHUNIT   EQU   CHAIN+24                                                 00325000
CHCLS    EQU   CHAIN+16                                                 00326000
CHPARM   EQU   CHKEY                                                    00327000
CHIFY    EQU   CHACT                                                    00328000
CHAIFX   EQU   CHACT                                                    00329000
CHCLD    EQU   CHACT                                                    00330000
CHCL     EQU   CHACT                                                    00331000
CHDSI    EQU   CHACT                                                    00332000
CHDISC   EQU   CHACT                                                    00333000
CHTERM   EQU   CHACT                                                    00334000
CHSWAP   EQU   CHACT                                                    00335000
CHABTERM EQU   CHSTS                                                    00336000
CHFC     EQU   CHSTS                                                    00337000
CHDL     EQU   CHSTS                                                    00338000
CHAD     EQU   CHSTS                                                    00339000
CHQSPC   EQU   CHSTS                                                    00340000
CHSOUT   EQU   CHSTS                                                    00341000
CHSYS    EQU   CHSTS                                                    00342000
CHAP     EQU   CHSTS                                                    00343000
CHSZE    EQU   CHFLG+1                                                  00344000
CHVCD    EQU   CHFLG                                                    00345000
CHPTR    EQU   CHAIN                                                    00346000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00347000
@RT00033 EQU   QUIT                                                     00348000
@ENDDATA EQU   *                                                        00349000
         END   IEE11110,(C'PL/S-II',0402,73187)                         00350000
./  ADD  SSI=31871463,NAME=IEE12110
         TITLE 'D C,K HANDLER-LOAD 3                                 '  00001000
IEE12110 CSECT ,                                                   0001 00002000
@PROLOG  BALR  @12,0                                               0001 00003000
@PSTART  DS    0H                                                  0001 00004000
         USING @PSTART,@12                                         0001 00005000
*/*ISSUE DATA LINES                                                  */ 00006000
*        MCSFLAGS = FLAGS ;            /*MOVE IN MCS FLAGS           */ 00007000
         LA    @04,CHASM(,R2)                                      0022 00008000
         MVC   MCSFLAGS(2,@04),FLAGS                               0022 00009000
*        MSGPOINT = ADDR(WTOP1) ;      /*INITIALIZE MSG POINTER      */ 00010000
         LA    MSGPOINT,WTOP1                                      0023 00011000
*        DO I=1 TO 12 ;                /*LOOP TO ISSUE LINES         */ 00012000
         LA    I,1                                                 0024 00013000
@DL00024 DS    0H                                                  0025 00014000
*/*   BUILD PARAMETER LIST IN CSCB                                   */ 00015000
*/*%DLSETUP: P BUILD PARAMETER LIST FOR ONE DATA LINE */           0025 00016000
*        PARMLEN = LENGTH(I) + 4 ;                                 0025 00017000
         LA    @04,CHASM(,R2)                                      0025 00018000
         LR    @15,I                                               0025 00019000
         AR    @15,@15                                             0025 00020000
         LH    @15,LENGTH-2(@15)                                   0025 00021000
         LA    @14,4                                               0025 00022000
         AR    @14,@15                                             0025 00023000
         STH   @14,PARMLEN(,@04)                                   0025 00024000
*        LEN = LENGTH(I);                                          0026 00025000
         LR    LEN,@15                                             0026 00026000
*        TEXT(1:LEN) = MSGPOINT->WTOP2; /* MOVE TEXT IN              */ 00027000
         LR    @15,LEN                                             0027 00028000
         BCTR  @15,0                                               0027 00029000
         EX    @15,@SM00331                                        0027 00030000
*        TEXT(LEN+1:LEN+8) = CODES ;    /*DESCRIPTOR, ROUTING CODES  */ 00031000
         LR    @15,@04                                             0028 00032000
         ALR   @15,LEN                                             0028 00033000
         MVC   TEXT(8,@15),CODES                                   0028 00034000
*/*%TSTEND: D (YES,%END,NO,%DLMLWTO) LAST LINE BEING BUILT */      0029 00035000
*/*%END: P (,%DLMLWTO) INDICATE END */                             0029 00036000
*        IF I=12 THEN TEXT(LEN+5)='30'X;      /* INDICATE DATA END 0029 00037000
*                                                ON LAST LINE        */ 00038000
         CH    I,@CH00250                                          0029 00039000
         BNE   @RF00029                                            0029 00040000
         ALR   @04,LEN                                             0030 00041000
         MVI   TEXT+4(@04),X'30'                                   0030 00042000
*        R1 = ADDR(WTOPARM) ;      /*POINT REG 1 TO PARAMETER LIST   */ 00043000
@RF00029 LA    R1,CHASM(,R2)                                       0031 00044000
         LA    @04,WTOPARM(,R1)                                    0031 00045000
         ST    R1,@TF00001                                         0031 00046000
         LR    R1,@04                                              0031 00047000
*        R0 = REG0PARM ;           /*SET UP REG 0                    */ 00048000
         L     @04,@TF00001                                        0032 00049000
         MVC   @TF00001(4),REG0PARM(@04)                           0032 00050000
         L     R0,@TF00001                                         0032 00051000
*/*%DLMLWTO: S SVC 35: ISSUE MLWTO FOR ONE DATA LINE */            0033 00052000
*        GEN (SVC 35) ;                                            0033 00053000
         SVC 35                                                         00054000
*/*TSTCAN: D (YES,EXIT,NO,) HAS DISPLAY BEEN CANCELLED */          0034 00055000
*RESPECIFY (R15) RESTRICTED;                                       0034 00056000
*IF R15 ¬= 0 THEN GO TO EXIT; /* IF DISPLAY CANCELED,EXIT           */  00057000
         LTR   R15,R15                                             0035 00058000
         BNZ   @RT00035                                            0035 00059000
*RESPECIFY (R15) UNRESTRICTED;                                     0037 00060000
*        MSGPOINT = MSGPOINT + LENGTH(I) ;                         0038 00061000
         LR    @04,I                                               0038 00062000
         AR    @04,@04                                             0038 00063000
         AH    MSGPOINT,LENGTH-2(@04)                              0038 00064000
*/*%TSTDONE: D (YES,%DLSETUP,NO,EXIT) ANY MORE DATA LINES */       0039 00065000
*        END;                                                      0039 00066000
         AH    I,@CH00048                                          0039 00067000
         CH    I,@CH00250                                          0039 00068000
         BNH   @DL00024                                            0039 00069000
*/*EXIT: R IEE00110 SVC 110 ROUTER */                              0040 00070000
*EXIT:   XAX(4:5) = '00'; /* CHANGE XCTL NAME TO SVC 110 ROUTER      */ 00071000
EXIT     MVC   XAX+3(2,R3),@CC00329                                0040 00072000
*RESPECIFY (R14) RESTRICTED;                                       0041 00073000
*        R14 = REG14SAV;                                           0042 00074000
         LA    @04,CHASM(,R2)                                      0042 00075000
         L     R14,REG14SAV(,@04)                                  0042 00076000
*RESPECIFY (R14) UNRESTRICTED;                                     0043 00077000
*RESPECIFY (R15) RESTRICTED;                                       0044 00078000
*        R15 = R3;                                                 0045 00079000
         LR    R15,R3                                              0045 00080000
*        GEN ( XCTL SF=(E,(15)) );                                 0046 00081000
          XCTL SF=(E,(15))                                              00082000
*RESPECIFY (R15) UNRESTRICTED;                                     0047 00083000
*/*IEE12110: END */                                                0048 00084000
*  END                                                             0048 00085000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 00086000
*/*%INCLUDE SYSLIB  (IEECHAIN)                                        * 00087000
*/*%INCLUDE SYSLIB  (IEEXSA  )                                        * 00088000
*;                                                                 0048 00089000
@EL00001 DS    0H                                                  0048 00090000
@EF00001 DS    0H                                                  0048 00091000
@ER00001 BR    @14                                                 0048 00092000
@DATA    DS    0H                                                       00093000
@CH00048 DC    H'1'                                                     00094000
@CH00250 DC    H'12'                                                    00095000
@SM00331 MVC   TEXT(0,@04),WTOP2(MSGPOINT)                              00096000
         DS    0F                                                       00097000
@TF00001 DS    F                                                        00098000
         DS    0F                                                       00099000
         DS    0D                                                       00100000
@CC00329 DC    C'00'                                                    00101000
PARAMS   DS    CL10                                                     00102000
         ORG   PARAMS                                                   00103000
FLAGS    DC    X'E040'                                                  00104000
CODES    DS    CL8                                                      00105000
         ORG   CODES                                                    00106000
DESCOD   DC    X'0980'                                                  00107000
ROUCOD   DC    X'0000'                                                  00108000
LINTYP   DC    X'2000'                                                  00109000
AREAID   DS    CL1                                                      00110000
MULINE   DC    AL1(1)                                                   00111000
         ORG   PARAMS+10                                                00112000
WTOP1    DS    CL634                                                    00113000
         ORG   WTOP1                                                    00114000
LINE27   DC    CL48'   ,NONE     DELETE ALL DISPLAY AREA DEFINITIONS'   00115000
LINE28   DC    CL45'   ,LL       DEFINE DISPLAY AREA OF LENGTH LL'      00116000
LINE29   DC    CL51'K N,PFK=(NN,CMD=''TEXT'')    DEFINE PFK NN AS COMMAC00117000
               ND'                                                      00118000
LINE30   DC    CL56'   ,PFK=(NN,KEY=NN,NN,...) DEFINE PFK NN AS LIST OFC00119000
                KEYS'                                                   00120000
LINE31   DC    CL60'                         ,CON=Y DEFINE PFK AS CONVEC00121000
               RSATIONAL'                                               00122000
LINE32   DC    CL64'                         ,CON=N DEFINE PFK AS NON-CC00123000
               ONVERSATIONAL'                                           00124000
LINE33   DC    CL48'K V,USE=FC VARY USE OF DEVICE TO FULL CAPABILITY'   00125000
LINE34   DC    CL47'   ,USE=SD VARY USE OF DEVICE TO STATUS DISPLAY'    00126000
LINE35   DC    CL47'   ,USE=MS VARY USE OF DEVICE TO MESSAGE STREAM'    00127000
LINE36   DC    CL68'   THE ROUTING OPERAND L=CCA IS ADDED TO A K COMMANC00128000
               D TO DEFINE AREAS'                                       00129000
LINE37   DC    CL65'   ON ANOTHER CONSOLE, TO CONTROL A DISPLAY IN A PAC00130000
               RTICULAR AREA,'                                          00131000
LINE38   DC    CL35'   OR TO VARY THE USE OF A CONSOLE.'                00132000
         ORG   WTOP1+634                                                00133000
LENGTH   DC    H'48'                                                    00134000
         DC    H'45'                                                    00135000
         DC    H'51'                                                    00136000
         DC    H'56'                                                    00137000
         DC    H'60'                                                    00138000
         DC    H'64'                                                    00139000
         DC    H'48'                                                    00140000
         DC    H'47'                                                    00141000
         DC    H'47'                                                    00142000
         DC    H'68'                                                    00143000
         DC    H'65'                                                    00144000
         DC    H'35'                                                    00145000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00146000
@01      EQU   01                                                       00147000
@02      EQU   02                                                       00148000
@03      EQU   03                                                       00149000
@04      EQU   04                                                       00150000
@05      EQU   05                                                       00151000
@06      EQU   06                                                       00152000
@07      EQU   07                                                       00153000
@08      EQU   08                                                       00154000
@09      EQU   09                                                       00155000
@10      EQU   10                                                       00156000
@11      EQU   11                                                       00157000
@12      EQU   12                                                       00158000
@13      EQU   13                                                       00159000
@14      EQU   14                                                       00160000
@15      EQU   15                                                       00161000
R0       EQU   @00                                                      00162000
R1       EQU   @01                                                      00163000
R2       EQU   @02                                                      00164000
R3       EQU   @03                                                      00165000
MSGPOINT EQU   @05                                                      00166000
I        EQU   @06                                                      00167000
LEN      EQU   @07                                                      00168000
R14      EQU   @14                                                      00169000
R15      EQU   @15                                                      00170000
CHAIN    EQU   0                                                        00171000
CHFLG    EQU   CHAIN+4                                                  00172000
CHSTS    EQU   CHFLG+2                                                  00173000
CHACT    EQU   CHFLG+3                                                  00174000
CHKEY    EQU   CHAIN+8                                                  00175000
CHPKE    EQU   CHAIN+28                                                 00176000
CHTJID   EQU   CHAIN+30                                                 00177000
CHACT1   EQU   CHAIN+35                                                 00178000
CHASM    EQU   CHAIN+40                                                 00179000
CHCIBP   EQU   CHASM+4                                                  00180000
CHRGNSZ  EQU   CHASM+8                                                  00181000
CHSHORT  EQU   CHASM+24                                                 00182000
CHSWT    EQU   CHSHORT                                                  00183000
XSAMAP   EQU   0                                                        00184000
XASVRB   EQU   XSAMAP                                                   00185000
XSA      EQU   XASVRB                                                   00186000
XAX      EQU   XASVRB+8                                                 00187000
@NM00005 EQU   XASVRB+16                                                00188000
@NM00006 EQU   XASVRB+20                                                00189000
XAS      EQU   XASVRB+32                                                00190000
EEXSAS01 EQU   0                                                        00191000
EEXSAS02 EQU   0                                                        00192000
XASDS    EQU   EEXSAS02+2                                               00193000
@NM00011 EQU   EEXSAS02+4                                               00194000
EEXSAS03 EQU   0                                                        00195000
XAXMASK  EQU   EEXSAS03                                                 00196000
CSCBWORK EQU   0                                                        00197000
REG14SAV EQU   CSCBWORK                                                 00198000
REG0PARM EQU   CSCBWORK+4                                               00199000
TEMPARM  EQU   CSCBWORK+8                                               00200000
TIME1    EQU   CSCBWORK+12                                              00201000
WTOPARM  EQU   CSCBWORK+20                                              00202000
PARMLEN  EQU   WTOPARM                                                  00203000
MCSFLAGS EQU   WTOPARM+2                                                00204000
TEXT     EQU   WTOPARM+4                                                00205000
WTOP2    EQU   0                                                        00206000
CHAINS01 EQU   CHASM                                                    00207000
CHTYPE   EQU   CHAINS01+124                                             00208000
CHTRSTAT EQU   CHAINS01+125                                             00209000
CHCSYSO  EQU   CHAINS01+134                                             00210000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00211000
CHLAST   EQU   CHAINS01+136                                             00212000
CHSPA    EQU   CHAINS01+135                                             00213000
CHUSERID EQU   CHCSYSO                                                  00214000
CHJB     EQU   CHCSYSO                                                  00215000
CHDUMP   EQU   CHCSYSO                                                  00216000
CHQUE    EQU   CHCSYSO                                                  00217000
CHHOLD   EQU   CHCSYSO                                                  00218000
CHOUT    EQU   CHCSYSO                                                  00219000
CHINN    EQU   CHCSYSO                                                  00220000
CHALL    EQU   CHCSYSO                                                  00221000
CHINC    EQU   CHAINS01+132                                             00222000
CHPEND   EQU   CHAINS01+128                                             00223000
CHARID   EQU   CHAINS01+127                                             00224000
CHCNID   EQU   CHAINS01+126                                             00225000
@NM00004 EQU   CHTRSTAT                                                 00226000
CHTSL    EQU   CHTRSTAT                                                 00227000
CHTS     EQU   CHTRSTAT                                                 00228000
CHINITL  EQU   CHTRSTAT                                                 00229000
CHINIT   EQU   CHTRSTAT                                                 00230000
CHJOBSL  EQU   CHTRSTAT                                                 00231000
CHJOBS   EQU   CHTRSTAT                                                 00232000
CHDEF    EQU   CHTYPE                                                   00233000
CHHIAR   EQU   CHTYPE                                                   00234000
CHARSV29 EQU   CHTYPE                                                   00235000
CHARSV28 EQU   CHTYPE                                                   00236000
CHARSV27 EQU   CHTYPE                                                   00237000
CHARSV26 EQU   CHTYPE                                                   00238000
CHARSV25 EQU   CHTYPE                                                   00239000
CHDSTAT  EQU   CHTYPE                                                   00240000
CHBUF    EQU   CHAINS01                                                 00241000
STC      EQU   TIME1+6                                                  00242000
SEC      EQU   TIME1+4                                                  00243000
MIN      EQU   TIME1+2                                                  00244000
HRS      EQU   TIME1                                                    00245000
TEMMLWTO EQU   TEMPARM+1                                                00246000
HIGH     EQU   TEMPARM                                                  00247000
CONID    EQU   REG0PARM+3                                               00248000
MLWTO    EQU   REG0PARM                                                 00249000
XAXSACB  EQU   EEXSAS03+4                                               00250000
XAXUTME  EQU   EEXSAS03+2                                               00251000
XAXFREE  EQU   EEXSAS03+1                                               00252000
@NM00013 EQU   XAXMASK                                                  00253000
XAXTSL   EQU   XAXMASK                                                  00254000
XAXTS    EQU   XAXMASK                                                  00255000
@NM00012 EQU   XAXMASK                                                  00256000
XAXJOBSL EQU   XAXMASK                                                  00257000
XAXJOBS  EQU   XAXMASK                                                  00258000
XASOPTR  EQU   @NM00011+1                                               00259000
XASTSAVE EQU   @NM00011                                                 00260000
XASPLS3  EQU   EEXSAS02+3                                               00261000
@NM00010 EQU   XASDS                                                    00262000
XASSDS5  EQU   XASDS                                                    00263000
XASSDS4  EQU   XASDS                                                    00264000
XASSDS3  EQU   XASDS                                                    00265000
XASSDS2  EQU   XASDS                                                    00266000
XASSDS   EQU   XASDS                                                    00267000
XASDID   EQU   EEXSAS02+1                                               00268000
XASCID   EQU   EEXSAS02                                                 00269000
@NM00009 EQU   EEXSAS01+44                                              00270000
XAT      EQU   EEXSAS01+20                                              00271000
XAF      EQU   EEXSAS01+12                                              00272000
XAI      EQU   EEXSAS01+4                                               00273000
XAH      EQU   EEXSAS01                                                 00274000
XASAVSTD EQU   XSAMAP+64                                                00275000
XASAVLOC EQU   XSAMAP+48                                                00276000
@NM00008 EQU   XASVRB+44                                                00277000
XAA      EQU   XASVRB+42                                                00278000
@NM00007 EQU   XASVRB+41                                                00279000
XAU      EQU   XASVRB+40                                                00280000
XAV      EQU   XASVRB+24                                                00281000
XAL      EQU   @NM00006+1                                               00282000
XAN      EQU   @NM00006                                                 00283000
XAR      EQU   @NM00005+1                                               00284000
XAE      EQU   @NM00005                                                 00285000
XAD      EQU   XSA+4                                                    00286000
XAP      EQU   XSA                                                      00287000
CHARSV16 EQU   CHSHORT+108                                              00288000
CHARSV15 EQU   CHSHORT+104                                              00289000
CHJSCBVS EQU   CHSHORT+100                                              00290000
CHUSCVS  EQU   CHSHORT+96                                               00291000
@NM00003 EQU   CHSHORT+92                                               00292000
@NM00002 EQU   CHSHORT+88                                               00293000
CHSQA    EQU   CHSHORT+52                                               00294000
CHQPA    EQU   CHSHORT+16                                               00295000
CHJCL    EQU   CHSHORT+12                                               00296000
CHSPC    EQU   CHSHORT+8                                                00297000
CHSPB    EQU   CHSHORT+4                                                00298000
CHTCB    EQU   CHSHORT+1                                                00299000
CHARSV23 EQU   CHSWT                                                    00300000
CHARSV22 EQU   CHSWT                                                    00301000
CHARSV21 EQU   CHSWT                                                    00302000
CHAC     EQU   CHSWT                                                    00303000
CHPSF    EQU   CHSWT                                                    00304000
CHPSD    EQU   CHSWT                                                    00305000
CHJCT    EQU   CHSWT                                                    00306000
CHARSV20 EQU   CHSWT                                                    00307000
CHCECB   EQU   CHASM+20                                                 00308000
CHECB    EQU   CHASM+16                                                 00309000
CHRGNAD  EQU   CHASM+12                                                 00310000
CHARSV18 EQU   CHRGNSZ+1                                                00311000
CHRPRTY  EQU   CHRGNSZ                                                  00312000
@NM00001 EQU   CHCIBP                                                   00313000
CHEND    EQU   CHCIBP                                                   00314000
CHECBP   EQU   CHASM                                                    00315000
CHDER    EQU   CHAIN+36                                                 00316000
CHARSV10 EQU   CHACT1                                                   00317000
CHARSV09 EQU   CHACT1                                                   00318000
CHARSV08 EQU   CHACT1                                                   00319000
CHARSV07 EQU   CHACT1                                                   00320000
CHARSV06 EQU   CHACT1                                                   00321000
CHARSV05 EQU   CHACT1                                                   00322000
CHARSV04 EQU   CHACT1                                                   00323000
CHRDWTR  EQU   CHACT1                                                   00324000
CHARSV30 EQU   CHAIN+34                                                 00325000
CHQID    EQU   CHAIN+32                                                 00326000
CHASID   EQU   CHTJID                                                   00327000
CHUCMP   EQU   CHAIN+29                                                 00328000
CHTRKID  EQU   CHPKE                                                    00329000
CHCIBCTR EQU   CHAIN+27                                                 00330000
CHUNIT   EQU   CHAIN+24                                                 00331000
CHCLS    EQU   CHAIN+16                                                 00332000
CHPARM   EQU   CHKEY                                                    00333000
CHIFY    EQU   CHACT                                                    00334000
CHAIFX   EQU   CHACT                                                    00335000
CHCLD    EQU   CHACT                                                    00336000
CHCL     EQU   CHACT                                                    00337000
CHDSI    EQU   CHACT                                                    00338000
CHDISC   EQU   CHACT                                                    00339000
CHTERM   EQU   CHACT                                                    00340000
CHSWAP   EQU   CHACT                                                    00341000
CHABTERM EQU   CHSTS                                                    00342000
CHFC     EQU   CHSTS                                                    00343000
CHDL     EQU   CHSTS                                                    00344000
CHAD     EQU   CHSTS                                                    00345000
CHQSPC   EQU   CHSTS                                                    00346000
CHSOUT   EQU   CHSTS                                                    00347000
CHSYS    EQU   CHSTS                                                    00348000
CHAP     EQU   CHSTS                                                    00349000
CHSZE    EQU   CHFLG+1                                                  00350000
CHVCD    EQU   CHFLG                                                    00351000
CHPTR    EQU   CHAIN                                                    00352000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00353000
@RT00035 EQU   EXIT                                                     00354000
@ENDDATA EQU   *                                                        00355000
         END   IEE12110,(C'PL/S-II',0402,73187)                         00356000
./  ADD  SSI=50130937,NAME=IEE20110
         TITLE 'IEE20110  UNIT STATUS ONE, PART OF SVC 110'             00050000
IEE20110 CSECT                                                          00100000
*********************************************************************** 00200000
*                                                                     * 00250000
* STATUS                                                              * 00300000
*    CHANGE LEVEL=0 VS 2 RELEASE 3                                      00350000
*        APARS FIXED ZA02348                                            00360023
*                                                                     * 00400000
* FUNCTION                                                            * 00450000
*    GET CORE FOR WORKAREA                                            * 00500000
*    SYNTAX CHECK COMMAND                                             * 00550000
*    ESTABLISH COMMAND REQUIREMENTS                                   * 00600000
*    FIND STARTING UCB                                                * 00650000
*                                                                     * 00700000
* ENTRY POINTS                                                        * 00750000
*         IEE20110                                                    * 00800000
*                                                                     * 00850000
* INPUT                                                               * 00900000
*    REG 2 CONTAINS THE CSCB ADDRESS WHICH CONTAINS THE COMMAND       * 00950000
*                                                                     * 01000000
* OUTPUT                                                              * 01050000
*    NONE                                                             * 01100000
*                                                                     * 01150000
* EXTERNAL REFERENCES                                                 * 01200000
*         SVC 10   (GETMAIN)                                          * 01250000
*                                                                     * 01300000
* EXITS,NORMAL                                                        * 01350000
*         IEE23110 TO FIND MORE UCB'S                                 * 01400000
*                                                                     * 01450000
* EXITS,ERROR                                                         * 01500000
*         IEE22110 TO ISSUE ERROR MESSAGES                            * 01550000
*                                                                     * 01600000
* TABLES/WORKAREAS                                                    * 01650000
*    CSCB                                                             * 01700000
*    XSA                                                              * 01750000
*    WORKAREA                                                         * 01800000
*    CVT                                                              * 01850000
*    UCB                                                              * 01900000
*                                                                     * 01950000
* ATTRIBUTES                                                          * 02000000
*    TYPE IV SVC, PRIVILEGED, RE-ENTRANT                         A36790 02050000
*                                                                     * 02100000
* CHARACTER CODE DEPENDENCY                                           * 02150000
*    NONE                                                             * 02200000
*                                                                     * 02250000
* NOTES                                                               * 02300000
*    NONE                                                             * 02350000
*                                                                     * 02400000
*********************************************************************** 02450000
         EJECT                                                          02500000
*/*IEE20110: CHART */                                                   02550000
*/* E IEE20110 */                                                       02600000
*/* P ESTABLISH ADDRESSABILITY */                                       02650000
*/* S GETMAIN SVC 10:GET WORKAREA SP=255, LENGTH=136 */                 02700000
*/* P PREPARE WORK AREA */                                              02750000
*/*START: D (NO,,YES,UCOM) COMMAND = 'U,' ? */                          02800000
*/* D (NO,,YES,ALLDEFLT) COMMAND = 'UBLANK' ? */                        02850000
*/*ERROR1: P (,ERRWRITE) INDICATE INVALID OPERAND */                    02900000
*/*ALLDEFLT: P INDICATE DISPLAY ALL DEVICE TYPES */                     02950000
*/* P (,SCANSET) INDICATE DISPLAY ALL DEVICE STATUS */                  03000000
*/*UCOM: P POINT TO FIRST OPERAND (DEVICE TYPE) */                      03050000
*/* D (NO,,YES,DEFALL1) IS IT DEFAULTED (=',') */                       03100000
*/* P POINT TO DEVICE TYPE TABLE */                                     03150000
*/* S SCAN RTN:BAL TO FIND DEVICE TYPE */                               03200000
*/* D (NO,,YES,UCOM1) ANY MORE OPERANDS ? */                            03250000
*/* D (NO,ERROR1,YES,) BLANK DELIMITING COMMAND ? */                    03300000
*/* P INDICATE USE THE DEFAULT STATUS */                                03350000
*/* P (,ENDCOMM) SET NUMBER OF DEVICES TO 100 */                        03400000
*/*DEFALL1: P INDICATE ALL DEVICE TYPES TO BE DISPLAYED */              03450000
*/*UCOM1: D (NO,,YES,STATDEF) DEVICE STATUS DEFAULTED ? */              03500000
*/* P POINT TO STATUS TABLE */                                          03550000
*/* S SCAN RTN:GO FIND STATUS WANTED */                                 03600000
*/* D (NO,,YES,UCOM2) ANY MORE OPERANDS */                              03650000
*/* D (NO,ERROR1,YES,) BLANK DELIMIT COMMAND ? */                       03700000
*/* P (,ENDCOMM) SET NUMBER OF DEVICES TO 100 */                        03750000
*/*STATDEF: P INDICATE STATUS DEFAULT TO ALL */                         03800000
*/*UCOM2: D (NO,UCOM2A,YES,) DEVICE ADDRESS DEFAULTED */                03850000
*/* P (,UCOM3) REMEMBER THAT FACT */                                    03900000
*/*UCOM2A: D (NO,ERROR1,YES,) ADDRESS A HEX NUMBER ? */                 03950000
*/* D (NO,,YES,UCOM3) ANY MORE OPERANDS ? */                            04000000
*/* D (NO,ERROR1,YES,) COMMAND TERMINATED BY BLANK */                   04050000
*/* P (,ENDCOMM) SET NUMBER OF DEVICES TO 100 */                        04100000
*/*UCOM3: D (NO,,YES,ERROR1) IS NEXT OPERAND A BLANK */                 04150000
*/* P PREPARE TO CHECK FOR VALID NUMBER */                              04200000
*/* P POINT TO FIRST CHARACTER IN NUMBER */                             04250000
*/*LOOPER: D (NO,CHKBLANK,YES,) IS CHARACTER A NUMBER ? */              04300000
*/* D (NO,CHKBLANK,YES,LOOPER) MORE CHARACTERS TO CHECK ? */            04350000
*/*CHKBLANK: D (NO,ERROR1,YES,) IS CHARACTER A BLANK ? */               04400000
*/* P CONVERT NUMBER TO BINARY */                                       04450000
*/* D (NO,,YES,ERROR1) IS NUMBER = 0 ? */                               04500000
*/* P INDICATE LINE DEFAULT NOT TAKEN */                                04550000
*/*ENDCOMM: D (NO,SCANSET,YES,) REQUEST FOR ONE DEVICE ? */             04600000
*/* P INDICATE THAT FACT */                                             04650000
*/* P SET UP FOR SEVEN UNITS PER LINE */                                04700000
*/*SCANSET: D (NO,,YES,SCANSET0) OFFLINE DISPLAY ? */                   04750000
*/* P SET UP FOR 2 UNITS PER LINE */                                    04800000
*/*SCANSET0: P GET DEVICE ADDRESS FROM COMMAND */                       04850000
*/*SCANSET1: P POINT TO LOOK UP TABLE */                                04900000
*/* S SCAN1 RTN:GO FIND DEVICE IN TABLE */                              04950000
*/* D (NO,,YES,SCANEXIT) DEVICE FOUND ? */                              05000000
*/* D (NO,SCAN3,YES,) SINGLE DEVICE REQUEST */                          05050000
*/* D (NO,,YES,SCAN3) NUMBER DEFAULTED TO 100 */                        05100000
*/* P (,ERRWRIT1) INDICATE ERROR */                                     05150000
*/*SCAN3: P POINT TO UCB ADDRESS TABLE */                               05200000
*/*SCAN3A: P GET A UCB ADDRESS */                                       05250000
*/* D (NO,SCAN3C,YES,SCANEXI2) END OF TABLE ? */                        05300000
*/*SCAN3B: P (,SCAN3A) GO TO NEXT UCB ADDRESS */                        05350000
*/*SCAN3C: S COMPSET:CHANGE ADDRESS TO BINARY */                        05400000
*/* D (NO,SCAN3B,YES,) NEW ADDR OVER LAST ADDR ? */                     05450000
*/* D (NO,,YES,SCAN3E) ANY PREVIOUS LOW ? */                            05500000
*/*SCAN3D: P (,SCAN3B) SET NEW LOW */                                   05550000
*/*SCAN3E: S COMPSET:CHANGE ADDRESSES FOR COMPARE */                    05600000
*/* D (NO,SCAN3B,YES,SCAN3D) NEW ADDR LESS THAN OLD LOW ? */            05650000
*/* E SCAN1 */                                                          05700000
*/*SCAN1: P GET A UCB ADDRESS */                                        05750000
*/* D (NO,SCAN1B,YES,SCAN1C) END OF TABLE ? */                          05800000
*/*SCAN1A: P (,SCAN1) BUMP TO NEXT ADDRESS */                           05850000
*/*SCAN1B: D (NO,SCAN1A,YES,SCAN1D) THIS THE UCB SEARCHED FOR ? */      05900000
*/*SCAN1C: P INDICATE UCB NOT FOUND */                                  05950000
*/*SCAN1D: R BR 14 */                                                   06000000
*/*COMPSET: E COMPSET */                                                06050000
*/*COMPSET1: P PREPARE FOR LOOP */                                      06100000
*/*COMPSET2: D (NO,,YES,COMPSET5) NUMBER 0 TO 9 ? */                    06150000
*/* D (NO,ERROR1,YES,) LETTER A TO F ? */                               06200000
*/* D (NO,,YES,ERROR1) DIGIT GREATER THAN 'F' ? */                      06250000
*/* P ADD NINE (9) TO DIGIT AND SAVE ?*/                                06300000
*/*COMPSET3: P POINT TO NEXT DIGIT */                                   06350000
*/* D (NO,COMPSET2,YES,) LAST DIGIT DONE? */                            06400000
*/* D (NO,COMPSET4,YES,) FIRST TIME THRU ? */                           06450000
*/* D (NO,,YES,SCANEXI4) THIS ADDR OUT OF SYSTEM ? */                   06500000
*/* P INDICATE NOT FIRST TIME THRU */                                   06550000
*/* P (,COMPSET1) POINT TO ADDRESS IN UCB */                            06600000
*/*COMPSET4: P SAVE CONVERTED ADDRESSES */                              06650000
*/* R BR 14 */                                                          06700000
*/*COMPSET5: P (,COMPSET3) GET THE DIGIT */                             06750000
*/* E SCAN */                                                           06800000
*/*SCAN: P GET PARAMETER LENGTH */                                      06850000
*/* D (NO,,YES,ERROR1) END OF TABLE ? */                                06900000
*/* D (NO,,YES,HIT) THIS THE OPERAND ? */                               06950000
*/* P (,SCAN) GO TO NEXT ENTRY IN TABLE */                              07000000
*/*HIT: P GO TO NEXT OPERAND IN COMMAND */                              07050000
*/* R BR 14 */                                                          07100000
*/*SCANEXI2: D (NO,,YES,SCANEXI3) ADDR IN COMMAND HIGHER THAN SYSTEM ?  07150000
*/**/                                                                   07200000
*/*SCANEXI4: P (,ERRWRIT1) INDICATE ERROR MSG TO BE WRITTEN */          07250000
*/*ERRWRITE:  P HOLD 'FROM' CONSOLE ID */                               07300000
*/*ERRWRIT1: P (,XCTL) PREPARE FOR XCTL TO IGC22110 */                  07350000
*/*SCANEXI3: P HOLD UCB POINTER */                                      07400000
*/*SCANEXIT: P SET FIRST ENTRY FLAG FOR UNIT 2 */                       07450000
*/* P SET XCTL TO IGC23110 */                                           07500000
*/*XCTL: P SET UP XCTL PARM LIST */                                     07550000
*/* R NEXT LOAD */                                                      07600000
*/*IEE20110: END */                                                     07650000
         EJECT                                                          07700000
         BALR  R10,R0                                                   07750000
         USING *,R10                                                    07800000
         B     ICATCH              BRANCH AROUND EYECATCHER   MB YM1902 07810000
         DC    C'01 MODULE IGC20110, FICHE IEE20110  '        MB YM1902 07820000
         DC    XL2'4211'           JULIAN DATE LAST CHANGE              07822000
         DC    CL8'&SYSDATE'       DATE OF LAST ASSEMBLY                07824000
         DC    S(*)                BASE/DISPL OF PATCH AREA             07826000
ZAPAREA  DC    12C'ZAP'  RESERVED FOR FIELD MODIFICATION      MB YM1902 07830000
ICATCH   EQU   *                                              MB YM1902 07840000
         LR    R11,R2                                                   07850000
         USING CSCB,R11                                                 07900000
         SPACE 2                                                        07950000
*********************************************************************** 08000000
*                                                                     * 08050000
*     OBTAIN WORKAREA AND INITIALIZE                                  * 08100000
*                                                                     * 08150000
*********************************************************************** 08200000
         LA    R1,SPN              SUBPOOL NUMBER                       08250000
         SLL   R1,HIGH             SET IN HIGH ORDER BYTE               08300000
         LA    R0,WAL              WORKAREA LENGTH                      08350000
         OR    R0,R1               COMBINE IN REG 0                     08400000
         GETMAIN R,LV=(0)          OBTAIN WORKAREA CORE                 08450000
         LR    R12,R1              SAVE CORE POINTER                    08500000
         USING WORKAREA,R12                                             08550000
         XC    WORKAREA(WAL),WORKAREA   ZERO OUT WORKAREA               08600000
         MVI   UNIT1,NUMERIC       SET DEFAULT ADDRESS (UNIT2) AND      08650000
         MVC   UNIT1+ONE(L11),UNIT1     INITIALIZE OTHERS               08700000
         LA    R15,ADCVT           POINT TO CVT ADDRESS                 08750000
         L     R15,ZERO(R15)       GET CVT ADDRESS                      08800000
         USING CVT,R15                                                  08850000
         STM   R13,R14,SWORD      SAVE REGS FOR MFT RETURN              08900000
         MVC   HOLD2+L2(L1),CHUCMP  SAVE ROUTINE FROM ID                08950000
         MVC   HOLD2+L3(L1),CHCNID   SAVE ROUTE TO ID                   09000000
         MVC   IDFLD(L1),CHARID    SAVE CONSOLE AREA ID                 09050000
         MVI   PACKWORD,NUMERIC    SET TO C'0' FOR                      09100000
         MVC   PACKWORD+L1(L3),PACKWORD   PACKING OPERATIONS            09150000
         MVI   TEXT,BLANK          BLANK TEXT AREA                      09200000
         MVC   TEXT+L1(L71),TEXT   PROPAGATE BLANKS                     09250000
         SPACE 2                                                        09300000
*********************************************************************** 09350000
*                                                                     * 09400000
*     OBTAIN COMMAND INPUT FROM CSCB AND CHECK SYNTAX                 * 09450000
*                                                                     * 09500000
*********************************************************************** 09550000
START    EQU   *                                                        09600000
         LA    R3,CHBUF+ONE        ADDRESS OF SECOND CHARACTER. IT IS   09650000
*                                  ASSUMED THAT THE FIRST IS A 'U'      09700000
         CLI   ZERO(R3),COMMA      U,                                   09750000
         BE    UCOM                YES                                  09800000
         CLI   ZERO(R3),BLANK      U BLANK                              09850000
         BE    ALLDEFLT            YES SET ON DEFAULT SWITCHES          09900000
ERROR1   EQU   *                                                        09950000
         MVI   FLAG4,MSG3          INVALID OPERAND                      10000000
         B     ERRWRITE            ISSUE MESSAGE                        10050000
ERROR2   DS    0H                                           JE @ZA02348 10060023
         MVI   FLAG4,MSG3          INVALID OPERAND MSG      JE @ZA02348 10070023
         B     ERRWRIT1            ISSUE MSG, CONSOLE ID IN FROMID      10080023
*                                                           JE @ZA02348 10090023
ALLDEFLT EQU   *                                                        10100000
         OI    FLAG1,ALLTYPE       INDICATE DISPLAY ALL TYPES           10150000
         OI    FLAG2,ALLS          INDICATE DISPLAY ANL STATUS          10200000
         MVI   NODEVICS+ONE,NODEVDEF MOVE IN DEFAULT VALUE              10250000
         B     SCANSET             SET UP FOR UCB SCAN                  10300000
UCOM     EQU   *                                                        10350000
         LA    R3,ONE(R3)          BUMP PAST POINTER                    10400000
         CLI   ZERO(R3),COMMA      FIRST VALUE DEFAULTED                10450000
         BE    DEFALL1             YES HANDLE ALL                       10500000
         LA    R2,TYPELIST         POINT TO CORRECT LIST                10550000
         LA    R6,FLAG1            POINT TO CORRECT FLAG BYTE           10600000
         BAL   R14,SCAN            FIND PARAMETER                       10650000
         CLI   ZERO(R3),COMMA      MORE PARAMETERS                      10700000
         BE    UCOM1               YES HANDLE                           10750000
         CLI   ZERO(R3),BLANK      BLANK DELIMIT COMMAND                10800000
         BNE   ERROR1              NO ERROR                             10850000
         OI    FLAG2,ALLS          INDICATE STATUS DEFAULT              10900000
         MVI   NODEVICS+ONE,NODEVDEF SET NUMBER DEFAULT                 10950000
         B     ENDCOMM             CHECK DIDOCS                         11000000
DEFALL1  EQU   *                                                        11050000
         OI    FLAG1,ALLTYPE       INDICATE ALL TYPES TO BE DISPLAYED   11100000
UCOM1    EQU   *                                                        11150000
         LA    R3,ONE(R3)          BUMP PAST COMMA                      11200000
         CLI   ZERO(R3),COMMA      STATUS DEFAULT                       11250000
         BE    STATDEF             YES HANDLE                           11300000
         LA    R2,STATPARM         POINT TO CORRECT LIST                11350000
         LA    R6,FLAG2            POINT TO CORRECT FLAG BYTE           11400000
         BAL   R14,SCAN            FIND OPERAND                         11450000
         CLI   ZERO(R3),COMMA      MORE OF COMMAND                      11500000
         BE    UCOM2               YES HANDLE                           11550000
         CLI   ZERO(R3),BLANK      BLANK DELINEATE COMMAND              11600000
         BNE   ERROR1              NO ERROR                             11650000
         MVI   NODEVICS+ONE,NODEVDEF INDICATE DEFAULT VALUE             11700000
         B     ENDCOMM             CHECK FOR DIDOCS                     11750000
STATDEF  EQU   *                                                        11800000
         OI    FLAG2,ALLS          INDICATE STATUS DEFAULT TO ALL       11850000
UCOM2    EQU   *                                                        11900000
         LA    R3,ONE(R3)          KICK PAST COMMA                      11950000
         CLI   ZERO(R3),COMMA      DEVICE ADDRESS DEFAULTED             12000000
         BNE   UCOM2A              NO, CHECK ADDRESS                    12050000
         OI    FLAG3,DEVDEF        YES, REMEMBER                        12100000
         B     UCOM3               CHECK NEXT OPERAND                   12150000
UCOM2A   EQU   *                                                        12200000
         CLI   ZERO(R3),BLANK      SHOULD BE A HEX NUMBER               12250000
         BE    ERROR1              IS NOT, ERROR CONDITION              12300000
         MVC   UNIT2+ONE(L3),ZERO(R3)   MOVE ADDRESS INTO WORK AREA     12350000
         LA    R3,L3(R3)           POINT PAST ADDRESS                   12400000
         CLI   ZERO(R3),COMMA      MORE OPERANDS                        12450000
         BE    UCOM3               YES HANDLE                           12500000
         CLI   ZERO(R3),BLANK      IS COMMAND STOPPED BY A BLANK        12550000
         BNE   ERROR1              NO ERROR MSG                         12600000
         MVI   NODEVICS+1,NODEVDEF      SET NO. DEVICES TO 100          12650000
         B     ENDCOMM             YES END OF COMMAND                   12700000
UCOM3    EQU   *                                                        12750000
         LA    R3,ONE(R3)          BUMP PAST COMMA                      12800000
         CLI   ZERO(R3),BLANK      IS THIS CHARACTER A BLANK            12850000
         BE    ERROR1              YES THIS MUST BE A NUMBER-ERROR MSG  12900000
         LR    R2,R3               SAVE CHAR POINTER IN COMMAND         12950000
         SR    R6,R6               CLEAR REG                            13000000
         LH    R5,FOUR            GET BYTE STOP              @Z30AAJE   13050003
LOOPER   EQU   *                                                        13100000
         TM    ZERO(R2),NUMERIC     IS THIS CHARACTER A NUMBER          13150000
         BNO   CHKBLANK            NO SEE IF BLANK DELIMITS COMMAND     13200000
         LA    R2,ONE(R2)          POINT TO NEXT CHARACTER              13250000
         LA    R6,ONE(R6)          UP COUNT                             13300000
         BCT   R5,LOOPER           CHECK FOUR NUMBERS        @Z30AAJE   13350003
CHKBLANK EQU   *                                                        13400000
         CLI   ZERO(R2),BLANK      BLANK CHARACTER                      13450000
         BNE   ERROR1              NO ERROR MSG                         13500000
*                                  NUMBER IS VALID. THE FOLLOWING CODE  13550000
*                                  CONVERTS IT TO BINARY.               13600000
         LA    R4,PACKWORD         POINT TO MOVE PLACE                  13700000
         BCTR  R6,R0               DECREMENT LENGTH BY ONE              13750000
         AR    R5,R4               POINT TO CORRECT MOVE POINT          13800000
         EX    R6,MOVE             MOVE NUMBER                          13850000
         PACK  CVBWORD(L4),PACKWORD(L4)   PACK EBCDIC TO HEX            13900000
         XC    PACKWORD(L4),PACKWORD    ZERO OUT FIRST WORD             13950000
         LR    R5,R6               SAVE LENGTH                          14000000
         CVB   R6,PACKWORD         CONVERT TO HEX WITHOUT SIGN          14050000
         LTR   R6,R6               IS NUMBER ZERO                       14100000
         BZ    ERROR1              YES ERROR                            14150000
         OI    FLAG5,NODEF         LINE DEFAULT NOT TAKEN               14200000
         STH   R6,NODEVICS         SAVE IN WORKAREA                     14250000
ENDCOMM  EQU   *                                                        14300000
         CLI   NODEVICS+L1,L1      SINGLE REQUEST                       14350000
         BNE   SCANSET             NO                                   14400000
         OI    FLAG2,SINGLE        YES, INDICATE SINGLE SEARCH          14450000
         SPACE 2                                                        14500000
*********************************************************************** 14550000
*                                                                     * 14600000
*     SET UP FOR SCAN TO PRODUCE DISPLAY LINES                        * 14650000
*                                                                     * 14700000
*********************************************************************** 14750000
SCANSET  EQU   *                                                        14800000
         XC    WORKING(L104),WORKING    ZERO OUT CSCB WORK AREA         14850000
         MVC   FROMID(L1),HOLD2+L2   SAVE FROM ID                       14900000
         XC    HOLD2(L3),HOLD2     ZERO OUT MLWTO NUMBER                14950000
         MVI   DEVNOLN+ONE,LONGLINE    SEVEN UNITS PER LINE             15000000
         TM    FLAG2,OFFLNS        OFFLINE DISPLAY                      15050000
         BO    SCANSET0            YES                                  15100000
         MVI   DEVNOLN+ONE,REGLINE    TWO UNITS PER LINE                15150000
SCANSET0 EQU   *                                                        15200000
         USING UCB,R9                                                   15250000
         L     R8,CVTILK2          POINT TO LOOK UP TABLE               15400000
SCAN1    EQU   *                                              MG YM3885 15496000
         SR    R9,R9               CLEAR REGISTER             JE YM6838 15496400
         ICM   R9,3,ZERO(R8)       GET ADDRESS                JE YM6838 15496500
         BZ    SCAN1A              BRANCH IF ADDR NULL        JE YM6838 15496600
         CLM   R9,3,FOXFOX         END OF UCB TABLE            @Z30AAJE 15496800
         BE    SCAN3               YES                        JE YM6838 15497200
         B     SCAN1B                                          @Z30AAJE 15497600
SCAN1A   EQU   *                                              MG YM3885 15498400
         LA    R8,L2(R8)           BUMP TO NEXT ADDRESS       MG YM3885 15499700
         B     SCAN1               LOOK AT IT                 MG YM3885 15499800
SCAN1B   EQU   *                                              MG YM3885 15499900
         N     R9,FOXAND           CLEAR TOP HALF OF REG      MG YM3885 15516600
         LA    R13,UNIT2+ONE       POINT TO DEV ADDR          MG YM3885 15518600
         BAL   R14,COMPSET         CONVERT EBCDIC TO HEX      MG YM3885 15520600
         STC   R5,UNITADDA         STORE CONVERTED ADDRESS    MH Y02139 15522603
         NI    UNITADDA,ZEROFOX    ZERO SUBCHANNEL PORTION    MH Y02139 15523003
         MVC   UNITADDB(L1),UCBUA  STORE HEX ADDRESS          MH Y02139 15523403
         NI    UNITADDB,ZEROFOX    ZERO SUBCHANNEL PORTION    MH Y02139 15523803
         CLC   UNITADDA(L1),UNITADDB    COMPARE ADDRESS       MH Y02139 15524203
         BNE   SCAN1A              NOT EQUAL, NOT BASE UCB    MG YM3885 15524600
         CLC   UNIT2+L1(L3),UCBNAME   RIGHT UCB               MG YM3885 15526600
         BE    SCANEXIT            YES                        MG YM3885 15528600
         B     SCAN1A              NO, FIND ANOTHER           MG YM3885 15530600
**********************************************************************  15900000
*         THIS CODE IS USED AS A SUBROUTINE TO FIND THE NEXT            15950000
*         HIGHEST DEVICE ADDRESS THAT EXISTS IN THE SYSTEM              16000000
*********************************************************************** 16050000
SCAN3    EQU   *                                                        16100000
         L     R8,CVTILK2          UCB ADDR LIST                        16150000
SCAN3A   EQU   *                                                        16250000
         SR    R9,R9               CLEAR REGISTER             JE YM6838 16260000
         ICM   R9,3,ZERO(R8)         GET UCB ADDR             JE YM6838 16262000
         BZ    SCAN3B              BRANCH IF ADDR NULL        JE YM6838 16264000
         CLM   R9,3,FOXFOX         END OF UCB TABLE            @Z30AAJE 16270000
         BE    SCANEXI2            YES                        JE YM6838 16280003
         B     SCAN3C              GO LOOK AT UCB              @Z30AAJE 16330000
SCAN3B   EQU   *                                                        16500000
         LA    R8,L2(R8)           BUMP TO NEXT ADDR                    16550000
         B     SCAN3A              TRY NEXT                             16600000
SCAN3C   EQU   *                                                        16650000
         N     R9,FOXAND           CLEAR TOP HALF OF REGISTER           16700000
         LA    R13,UNIT2+ONE       WHICH ADDRESS TO COMPARE             16750000
         BAL   R14,COMPSET         CHANGE ADDRESSES FOR COMPARE         16800000
         STC   R5,UNITADDA         STORE CONVERTED ADDRESS    MH Y02139 16810003
         NI    UNITADDA,ZEROFOX    ZERO SUBCHANNEL PORTION    MH Y02139 16812003
         MVC   UNITADDB(L1),UCBUA  STORE HEX ADDRESS          MH Y02139 16814003
         NI    UNITADDB,ZEROFOX    ZERO SUBCHANNEL PORTION    MH Y02139 16816003
         CLC   UNITADDA(L1),UNITADDB    COMPARE ADDRESS       MH Y02139 16818003
         BNE   SCAN3B              NOT EQUAL, NOT BASE UCB    MG YM3885 16820000
         CLR   R4,R5               NEW ADDRESS GREATER                  16850000
         BH    SCAN3B              NO                                   16900000
         CLI   UNIT3,NUMERIC       ANY PREVIOUS LOW                     16950000
         BNE   SCAN3E              YES                                  17000000
         MVI   UNIT3,ZERO          CLEAR FLAG FROM FIRST BYTE           17050000
SCAN3D   EQU   *                                                        17100000
         MVC   UNIT3+ONE(L3),UCBNAME    NEW LOW ABOVE ORIGINAL ADDRESS  17150000
         LR    R0,R9              SHIFT UCB POINTER                     17200000
         B     SCAN3B              GET ANOTHER                          17250000
SCAN3E   EQU   *                                                        17300000
         LA    R13,UNIT3+ONE       WHICH ADDRESS TO COMPARE             17350000
         BAL   R14,COMPSET         CHANGE ADDRESSES FOR COMPARE         17400000
         CLR   R4,R5               NEW ADDR LESS THAN OLD LOW           17450000
         BNH   SCAN3B              NO                                   17500000
         B     SCAN3D              YES, SAVE IT                         17550000
*********************************************************************** 18850000
* THE FOLLOWING CODE CONVERTS EBCDIC REPRESENTATION OF HEX UNIT       * 18900000
* ADDRESSES INTO BINARY NUMBERS THAT CAN BE USED IN A COMPARE LOGICAL * 18950000
* REGISTER STATEMENT FOLLOWED BY A BRANCH HIGH, LOW OR EQUAL.         * 19000000
* ON ENTRY R13 POINTS TO EITHER UNIT1, UNIT2 OR UNIT3. THE CONVERTED  * 19050000
* ADDRESS FROM THIS LOCATION IS PLACED IN R4.                         * 19100000
* THE OTHER ADDRESS ALWAYS COMES FROM THE UCBNAME FIELD OF THE UCB    * 19150000
* POINTED TO BY R9. THIS CONVERTED ADDRESS IS PLACED IN R5.           * 19200000
* THE CONTENTS OF R1 THROUGH R5 ARE DESTROYED.                        * 19250000
* RETURN IS VIA A BR R14.                                             * 19300000
* IF ANY ADDRESS IS FOUND WHICH IS NOT A VALID HEX NUMBER (0-9,A-F),  * 19350000
* AN ERROR CONDITION EXISTS AND CONTROL IS PASSED TO ERROR1.          * 19400000
*********************************************************************** 19450000
COMPSET  EQU   *                                                        19500000
         SR    R3,R3               CLEAR REGISTER                       19550000
COMPSET1 EQU   *                                                        19600000
         SR    R1,R1               CLEAR REGISTER                       19650000
         LA    R1,L3(R1)           BCT LOOP CONTROL                     19700000
         SR    R2,R2               CLEAR WORK REGISTER                  19750000
COMPSET2 EQU   *                                                        19800000
         TM    ZERO(R13),NUMERIC   HEX NUMERAL (0-9)                    19850000
         BO    COMPSET5            YES                                  19900000
         TM    ZERO(R13),CMASK     HEX DIGIT (A-F)                      19950000
         BNO   ERROR2              NEITHER, ERROR CONDITION             20000023
*                                                           JE @ZA02348 20010023
         CLI   ZERO(R13),C6        DIGIT CANNOT BE GREATER THAN HEX F   20050000
         BH    ERROR2              IT IS, THEREFORE ERROR CONDITION     20100023
*                                                           JE @ZA02348 20110023
         IC    R3,ZERO(R13)        OBTAIN DIGIT                         20150000
         LA    R3,L9(R3)           ADD NINE                             20200000
COMPSET3 EQU   *                                                        20250000
         SLL   R3,L28              SHIFT TO                             20300000
         SLDL  R2,L4               LOW ORDER OF R2                      20350000
         SR    R3,R3               CLEAR REG                            20400000
         LA    R13,ONE(R13)        POINT TO NEXT DIGIT                  20450000
         BCT   R1,COMPSET2         CONVERT NEXT DIGIT                   20500000
         TM    FLAG2,R13UCBNM      FIRST PASS                           20550000
         BO    COMPSET4            NO                                   20600000
         CH    R2,HIADDR           THE HIGHEST SYSTEM ADDRESS IS BFF,   20650000
*                                  AS OF RELEASE 19                     20700000
         BH    SCANEXI4            ADDRESS IS HIGHER, ERROR             20750000
         OI    FLAG2,R13UCBNM      TURN ON FLAG                         20800000
         LR    R4,R2               SAVE CONVERTED ADDRESS               20850000
         LA    R13,UCBNAME         POINT TO ADDRESS IN UCB              20900000
         B     COMPSET1                 CONVERT IT                      20950000
COMPSET4 EQU   *                                                        21000000
         LR    R5,R2                    SAVE CONVERTED ADDRESS          21050000
         NI    FLAG2,L255-R13UCBNM      TURN OFF BIT                    21100000
         BR    R14                      RETURN TO CALLER                21150000
COMPSET5 EQU   *                                                        21200000
         IC    R3,ZERO(R13)        OBTAIN DIGIT                         21250000
         B     COMPSET3            ISOLATE NUMBER                       21300000
         SPACE 2                                                        21350000
*********************************************************************** 21400000
*  THE FOLLOWING CODE COMPARES A PARAMETER TO A LIST OF VALID         * 21450000
*  PARAMETERS.  IF NOT FOUND EXIT IS TO LABEL 'ERROR1'.  IF FOUND,    * 21500000
*  THE MASK IN THE TABLE ENTRY IS USED TO SET BIT(S) IN THE           * 21550000
*  APPROPRIATE FLAG FIELD  AND THE PARAMETER POINTER IS UPDATED TO    * 21600000
*  POINT TO THE ADDRESS OF THE CHARACTER FOLLOWING THE PARAMETER.     * 21650000
*                                                                     * 21700000
*  UPON ENTRY REGS MUST BE PRIMED AS FOLLOWS:                         * 21750000
*  R3= POINTER TO PARAM TO BE VALIDITY CHECKED                        * 21800000
*  R2= POINTER TO CORRECT TABLE OF VALID PARAMETERS                   * 21850000
*  R6= POINTER TO FLAG FIELD TO BE OR'ED                              * 21900000
*  R4= RETURN ADDRESS                                                 * 21950000
*  R2 AND R5 ARE DESTROYED, R3 IS UPDATED AS ABOVE                    * 22000000
*********************************************************************** 22050000
SCAN     EQU   *                                                        22100000
         SR    R5,R5               CLEAR REG FOR PARAMETER LENGTH       22150000
         IC    R5,ZERO(R2)         GET PARAMETER LENGTH                 22200000
         LTR   R5,R5               TEST FOR END OF TABLE (LENGTH=0)     22250000
         BZ    ERROR1              END OF TABLE - PARAM NOT VALID       22300000
         EX    R5,COMPR            EXECUTE COMPARE OF PARM              22350000
         BE    HIT                 FOUND GOOD PARAMETER - SET FLAG      22400000
         LA    R5,L3(R5)           GO TO NEXT                           22450000
         AR    R2,R5               ENTRY IN PARAMETER TABLE             22500000
         B     SCAN                LOOP TO TEST NEXT ENTRY              22550000
HIT      EQU   *                                                        22600000
         OC    ZERO(L1,R6),L1(R2)  OR MASK INTO CORRECT FLAGS (R6)      22650000
         LA    R5,L1(R5)           CORRECT LENGTH OF PARAMETER          22700000
         AR    R3,R5               BUMP COMMAND PTR PAST FOUND PARAM    22750000
         BR    R14                 RETURN TO CALLER                     22800000
         SPACE 2                                                        22850000
*********************************************************************** 22900000
*                                                                     * 22950000
*        EXITS TO UNIT4 OR UNIT3 FOR ERROR                            * 23000000
*                                                                     * 23050000
*********************************************************************** 23100000
SCANEXI2 EQU   *                                                        23150000
         CLI   UNIT3,NUMERIC       IF UNIT3 HAS NEVER BEEN CHANGED THEN 23200000
         BNE   SCANEXI3            ADDRESS IN COMMAND IS HIGHER THAN    23250000
*                                  HIGHEST SYSTEM ADDRESS.              23300000
SCANEXI4 EQU   *                                                        23350000
         MVI   FLAG4,MSG1         ERROR MESSAGE                         23400000
         B     ERRWRIT1           ID ALREADY IN FROMID                  23450000
ERRWRITE EQU   *                                                        23500000
         MVC   FROMID(L1),HOLD2+L2   STORE FROM CONSOLE ID              23550000
ERRWRIT1 EQU   *                                                        23600000
         MVC   XAX(L8),XCTLNAME   PUT IN NAME FOR XCTL                  23650000
         MVI   XAX+L4,F2          NAME FOR ERROR XCTL                   23700000
         B     XCTL                EXIT TO IEEUNIT3                     23750000
SCANEXI3 EQU   *                                                        23800000
         LR    R9,R0              SHIFT UCB POINTER BACK                23850000
SCANEXIT EQU   *                                                        23900000
         OI    FLAG5,INITUNT2      FIRST ENTRY FOR UNIT2                23950000
         OI    FLAG5,INITENT       TELL IEEUNIT4 ABOUT IEEUNIT1 ENTRY   24000000
         MVC   XAX(L8),XCTLNAME   PUT IN NAME FOR XCTL                  24050000
XCTL     EQU   *                                                        24100000
         ST    R12,XAL             SAVE WORKAREA ADDRESS                24150000
         STH   R9,SWORD+L8                                              24200000
         SR    R4,R4               CREATE ZEROS                         24250000
         ST    R4,XAD              NO DCB PTR                           24300000
         LA    R4,XAX              POINTER TO XCTL NAME                 24350000
         ST    R4,XAP              POINTER TO XCTL NAME                 24400000
         LA    R15,XSA             POINT TO PARA LIST                   24450000
         XCTL  SF=(E,(R15))        TRANSFER CONTROL                     24500000
         EJECT                                                          24550000
*********************************************************************** 24600000
*                                                                     * 24650000
*     EQUATES                                                         * 24700000
*                                                                     * 24750000
*********************************************************************** 24800000
R0       EQU   0                   GENERAL REGISTER NOTATION            24850000
R1       EQU   1                   *                       *            24900000
R2       EQU   2                   *                       *            24950000
R3       EQU   3                   *                       *            25000000
R4       EQU   4                   *                       *            25050000
R5       EQU   5                   *                       *            25100000
R6       EQU   6                   *                       *            25150000
R7       EQU   7                   *                       *            25200000
R8       EQU   8                   *                       *            25250000
R9       EQU   9                   *                       *            25300000
R10      EQU   10                  *                       *            25350000
R11      EQU   11                  *                       *            25400000
R12      EQU   12                  *                       *            25450000
R13      EQU   13                  *                       *            25500000
R14      EQU   14                  *                       *            25550000
R15      EQU   15                  *                       *            25600000
*                                  THE FOLLOWING STATEMENTS DEFINE      25650000
*                                  LENGTHS AND NUMBERS USED IN THIS     25700000
*                                  SUPPORT.                             25750000
L1       EQU   1                   *             *         *            25800000
L2       EQU   2                   *             *         *            25850000
L3       EQU   3                   *             *         *            25900000
L4       EQU   4                   *             *         *            25950000
L5       EQU   5                   *             *         *            26000000
L7       EQU   7                   *             *         *            26050000
L8       EQU   8                   *             *         *            26100000
L9       EQU   9                   *             *         *            26150000
L24      EQU   24                  *             *         *     A36165 26200000
L11      EQU   11                  *             *         *            26250000
L12      EQU   12                  *             *         *            26300000
L28      EQU   28                  *             *         *            26350000
L32      EQU   32                  *             *         *            26400000
L71      EQU   71                  *             *         *            26450000
L104     EQU   104                 *             *         *            26500000
L255     EQU   255                 *             *         *            26550000
ZERO     EQU   0                   *             *         *            26600000
ONE      EQU   1                   *             *         *            26650000
ADCVT    EQU   16                  LOCATION OF CVT ADDRESS              26700000
HIGH     EQU   24                  USED FOR REGISTER SHIFTING           26750000
CMASK    EQU   X'C0'               CHARACTER ZONE                       26800000
SPN      EQU   X'FF'               SUBPOOL NUMBER 255                   26850000
XFF      EQU   X'FF'               END OF UCB TABLE INDICATOR JE YM6838 26860000
TWENT    EQU   X'20'               MFT MASK                             26900000
F1       EQU   C'1'                UNIT STATUS TWO NAME, IGC21110       26950000
F2       EQU   C'2'                UNIT STATUS THREE NAME, IGC22110     27000000
BLANK    EQU   C' '                BLANK DELIMETER                      27050000
COMMA    EQU   C','                FOR SYNTAX CHECK                     27100000
NUMERIC  EQU   C'0'                FIRST EBCDIC NUMERAL                 27150000
REGLINE  EQU   X'02'               TWO UNITS PER LINE                   27200000
LONGLINE EQU   X'07'               SEVEN UNITS PER LINE                 27250000
C6       EQU   C'F'                HIGHEST ADDRESS DIGIT, HEX F         27300000
ZEROFOX  EQU   X'0F'               MASK TO ZERO SUBCHANNEL    MH Y02139 27310003
         SPACE 3                                                        27350000
*********************************************************************** 27400000
*                                                                     * 27450000
*     EXECUTED STATEMENTS                                             * 27500000
*                                                                     * 27550000
*********************************************************************** 27600000
         DS    0H                  FORCE HALF WORD BOUNDRY              27650000
MOVE     EQU   *                                                        27700000
         MVC   ZERO(R0,R5),ZERO(R3)  EXECUTED MOVE FOR CVB              27750000
COMPR    EQU   *                                                        27800000
         CLC   ZERO(ZERO,R3),L2(R2)     USED BY SCAN ROUTINE            27850000
COMPUNIT EQU   *                                              MG YM3885 27860000
         CLI   UCBUA,ZERO          COMP DEV ADDR LESS CHANNEL MG YM3885 27870000
         EJECT                                                          27900000
*********************************************************************** 27950000
*                                                                     * 28000000
*     CONSTANTS                                                       * 28050000
*                                                                     * 28100000
*********************************************************************** 28150000
         DS    0F                                                       28200000
FOXAND   DC    XL4'0000FFFF'       USED TO AND REGISTERS                28250000
HIADDR   DC    H'3071'             HIGHEST POSSIBLE ADDRESS, HEX BFF    28300000
FOUR     DC    H'4'                LOOP COUNT NUMBER         @Z30AAJE   28350003
FOXFOX   DC    XL2'FFFF'           END OF UCB TABLE INDICATOR  @Z30AAJE 28360000
XCTLNAME DC    C'IGC23110'        STANDARD XCTL NAME                    28400000
         SPACE 1                                                        28450000
STATPARM EQU   *                   TABLE OF STATUS OPERANDS             28500000
         DC    AL1(ON2-ON1-ONE)    LENGTH OF ENTRY LESS ONE             28550000
         DC    AL1(ONLINS)         ONLINE DEVICES MASK                  28600000
ON1      EQU   *                                                        28650000
         DC    C'ONLINE'           OPERAND                              28700000
*                                                                       28750000
ON2      EQU   *                                                        28800000
         DC    AL1(OFF2-OFF1-ONE)      LENGTH OF WORD LESS ONE          28850000
         DC    AL1(OFFLNS)         OFFLINE DEVICES MASK                 28900000
OFF1     EQU   *                                                        28950000
         DC    C'OFFLINE'          OPERAND                              29000000
OFF2     EQU   *                                                        29050000
*                                                                       29100000
         DC    AL1(ALL4-ALL3-ONE)   LENGTH OF ENTRY LESS ONE            29150000
         DC    AL1(ALLS)           ALL STATUS MASK                      29200000
ALL3     EQU   *                                                        29250000
         DC    C'ALL'              OPERAND                              29300000
ALL4     EQU   *                                                        29350000
         DC    AL1(0)              END OF TABLE                         29400000
         SPACE 1                                                        29450000
TYPELIST EQU   *                   TABLE OF DEVICE TYPE OPERANDS        29500000
         DC    AL1(ALL2-ALL1-1)    LENGTH OF PARAMETER MINUS ONE        29550000
         DC    AL1(ALLTYPE)        ALLDEVICE TYPES MASK                 29600000
ALL1     EQU   *                                                        29650000
         DC    C'ALL'              PARAMETER                            29700000
ALL2     EQU   *                                                        29750000
*                                                                       29800000
         DC    AL1(TP2-TP1-ONE)    LENGTH OF ENTRY LESS ONE             29850000
         DC    AL1(TPTYPE)         TELEPROCESSING DEVICES MASK          29900000
TP1      EQU   *                                                        29950000
         DC    C'TP'               OPERAND                              30000000
TP2      EQU   *                                                        30050000
*                                                                       30100000
         DC    AL1(GRPH2-GRPH1-ONE)   LENGTH OF ENTRY LESS ONE          30150000
         DC    AL1(GRTYPE)         GRAPHIC DEVICES MASK                 30200000
GRPH1    EQU   *                                                        30250000
         DC    C'GRAPHIC'          OPERAND                              30300000
GRPH2    EQU   *                                                        30350000
*                                                                       30400000
         DC    AL1(DA2-DA1-ONE)    LENGTH OF ENTRY LESS ONE             30450000
         DC    AL1(DATYPE)         DIRECT ACCESS DEVICE TYPE MASK       30500000
DA1      EQU   *                                                        30550000
         DC    C'DASD'             OPERAND                              30600000
DA2      EQU   *                                                        30650000
*                                                                       30700000
         DC    AL1(TA2-TA1-ONE)    LENGTH OF ENTRY LESS ONE             30750000
         DC    AL1(TATYPE)         TAPE DEVICE TYPE MASK                30800000
TA1      EQU   *                                                        30850000
         DC    C'TAPE'             OPERAND                              30900000
TA2      EQU   *                                                        30950000
*                                                                       31000000
         DC    AL1(UR2-UR1-ONE)    LENGTH OF ENTRY LESS ONE             31050000
         DC    AL1(URTYPE)         UNIT RECORD DEVICE TYPE MASK         31100000
UR1      EQU   *                                                        31150000
         DC    C'UR'               OPERAND                              31200000
UR2      EQU   *                                                        31250000
         DC    AL1(0)              END OF TABLE                         31300000
*                                                                       31350000
*                                                                       31400000
         EJECT                                                          31450000
*********************************************************************** 31500000
*                                                                     * 31550000
*     DSECTS                                                          * 31600000
*                                                                     * 31650000
*********************************************************************** 31700000
CSCB     DSECT                                                          31750000
         IEECHAIN                                                       31800000
         ORG   CHAIN+L32                                                31850000
         IEEXSA                                                         31900000
         ORG   XSA+L24                                           A36165 31950000
         DS    0F                                                       32000000
WORKING  DS    5F                  WORKING STORAGE                      32050000
DEVNOLN  EQU   WORKING+L8          NUMBER OF DEVICES PER LINE           32100000
DEVSPRE  EQU   DEVNOLN+L2          NUMBER OF DEVICES DISPLAYED          32150000
LASTUCB  EQU   DEVSPRE+L3          STARTING UCB ADDRESS/BIN NUMBER      32200000
FROMID   EQU   LASTUCB+L4          REQUESTING CONSOLE ID                32250000
SAVE     DS    21F                 SAVE AREA BETWEEN MODULES            32300000
UNITADDA DS    C                   DEVICE ADDRESS FROM EBCDIC MH Y02139 32310003
UNITADDB DS    C                   DEVICE ADDRESS FROM HEX    MH Y02139 32320003
         ORG   SAVE+L12                                                 32350000
PACKWORD DS    F                   USED BY SYNTAX CHECKER               32400000
CVBWORD  DS    F                   FOR PACKING AND CONVERTING           32450000
         EJECT                                                          32500000
UCB      DSECT                                                          32550000
         IEFUCBOB                                                       32600000
         EJECT                                                          32650000
CVT      DSECT                                                          32700000
         CVT                                                            32750000
         EJECT                                                          32800000
WORKAREA DSECT                                                          32850000
         SPACE 2                                                        32900000
         DS    0D                                                       32950000
UCBADDRA DS    7H                  STORAGE FOR UCB ADDRESSES            33000000
UCBADDRB DS    H                   FOUND BY UNIT4                       33050000
SWORD    DS    3F                  SAVE AREA ACROSS MODULES             33100000
UNIT1    DS    F                   HOLD ADDRESS ONE                     33150000
UNIT2    DS    F                   HOLD ADDRESS TWO                     33200000
UNIT3    DS    F                   HOLD ADDRESS THREE                   33250000
         SPACE 4                                                        33300000
FLAG2    DC    X'00'               COMMUNICATIONS BYTE                  33350000
ONLINS   EQU   128                 DISPLAY ONLINE DEVICES               33400000
OFFLNS   EQU   64                  DISPLAY OFFLINE DEVICES              33450000
ALLS     EQU   32                  DISPLAY OFFLINE + ONLINE DEVICES     33500000
SUFEXIST EQU   16                  REQUESTING CONSOLE IS A CRT DEVICE   33550000
SINGLE   EQU   8                   SINGLE DEVICE REQUEST                33600000
COREGOT  EQU   4                   CORE GOTTEN FOR REGION               33650000
OPEN22   EQU   2                   OPEN FLAG                            33700000
R13UCBNM EQU   1                   FLAG FOR COMPSET ROUTINE             33750000
         SPACE 2                                                        33800000
FLAG3    DC    X'00'               COMMUNICATIONS FLAGS                 33850000
U2       EQU   128                TELL UNIT2 ENTRY FOR SCAN OF CDES     33900000
UNIT3RET EQU   64                  IEE22110 RETURNING TO IEE21110       33950000
OPEN332  EQU   32                  OPEN FLAG                            34000000
DEVDEF   EQU   16                  DEVICE ADDRESS DEFAULTED             34050000
HEADOUTF EQU   8                   HEADING AND LABELS ARE OUT           34100000
OPEN34   EQU   4                   OPEN FLAG                            34150000
OPEN32   EQU   2                   OPEN FLAG                            34200000
OPEN31   EQU   1                   OPEN FLAG                            34250000
         SPACE 2                                                        34300000
*  FLAG4 BYTE IS USED FOR COMMUNICATIONS BETWEEN IEEUNIT3 AND THE       34350000
*  OTHER  D UNIT  MODULES.                                              34400000
FLAG4    DC    XL1'00'             COMMUNICATIONS BYTE                  34450000
EXITBIT  EQU   X'00'               RETURN TO CALLER           MD        34500000
MSG1     EQU   X'04'               ISSUE MESSAGE MSG1A        MD        34550000
MSG3     EQU   X'08'               ISSUE MESSAGE MSG3A        MD        34600000
MSG4     EQU   X'0C'               ISSUE MESSAGE MSG4A        MD        34650000
         SPACE 2                                                        34700000
FLAG5    DC    XL1'00'                                                  34750000
NODEF    EQU   X'80'               LINE DEFAULT NOT TAKEN               34800000
INITENT  EQU   X'40'               INITIAL ENTRY TO UNIT STATUS FOUR    34850000
INITUNT2 EQU   X'20'               INITIAL ENTRY TO UNIT STATUS TWO     34900000
CRTMSG2  EQU   X'10'               MSG2 WITH HEADINGS FOR DIDOCS        34950000
UN4BINLT EQU   X'08'               LASTBIN FLAG FOR UNIT4               35000000
DISPBIT  EQU   X'04'               VALID ADDRESS FOUND                  35050000
DISPEND  EQU   X'02'               END OF FRAME AND DISPLAY             35100000
OPEN51   EQU   X'01'               OPEN FLAG                            35150000
         SPACE 2                                                        35200000
         DS    0F                  FORCE FULL WORD FOR WTO              35250000
WTOSET   DS    XL1                 ZERO                                 35300000
TEXTLEN  DS    XL1                 OUTPUT LENGTH                        35350000
LENGTH   EQU   76                  FULL LINE                            35400000
MCSONE   DS    XL1                 MCS FLAGS PART ONE                   35450000
SETONE   EQU   X'E1'                QUEUE BY ID, ROUTINE + DESCRIPTOR   35500000
*                                  CODES EXIST, COMMAND RESPONSE, QUEUE 35550000
*                                  BY ID ONLY.                          35600000
MCSTWO   DS    XL1                 MCS FLAGS PART TWO                   35650000
SETTWO   EQU   X'40'               MLWTO                                35700000
         SPACE 1                                                        35750000
MSGT     DS    0C                  BEGIN TEXT LINE                      35800000
TEXT     DS    XL72                TEXT FIELD                           35850000
         ORG   TEXT                                                     35900000
TITLEID  DS    XL8                 MESSAGE ID                           35950000
TITLEDGH DS    XL3                 HOURS.                               36000000
TITLEDGM DS    XL3                 MINUTES.                             36050000
TITLEDGS DS    XL2                 SECONDS                              36100000
TITLENM  DS    XL11                DISPLAY NAME                         36150000
         ORG   TEXT                                                     36200000
UCBN1    DS    XL5                 UNIT ADDRESS                         36250000
MODL1    DS    XL5                 DEVICE TYPE                          36300000
USTAT1   DS    XL1                 STATUS (O,A,S,C,OFFLINE)             36350000
USTAT2   DS    XL4                 STATUS (-BSY,-MTP,-NRD)              36400000
USTAT3   DS    XL3                 STATUS (-R)                          36450000
VOLID1   DS    XL7                 VOLUME SERIAL NUMBER                 36500000
VOST1A   DS    XL4                 VOLUME STATE (PUB,PRIV,STRG)         36550000
VOST1B   DS    XL6                 VOLUME STATE (-REMOV,-RSDNT,-RSERV)  36600000
         ORG   TEXT+72            ORG FOR WTO TAIL                      36650000
         SPACE 2                                                        36700000
DESCODE  DS    XL2                 DESCRIPTOR CODES                     36750000
RTECODE  DS    XL2                 ROUTING CODES                        36800000
TYPEFLAG DS    XL2                 MESSAGE TYPES                        36850000
AID      DS    XL1                AREA ID FIELD                         36900000
LNUM     DS    XL1                NUMBER OF LINES                       36950000
         SPACE 2                                                        37000000
HOLD2    DS    F                   MLWTO ID/CONSOLE ID FOR WTO          37050000
NODEVICS DS    H                   NUMBER OF UNITS REQUESTED            37100000
NODEVDEF EQU   100                 DEFAULT                              37150000
         SPACE 4                                                        37200000
*  FLAG1 BYTE IS SET BY IEEUNIT1 TO REFLECT THE DEVICE TYPE(S)          37250000
*  REQUESTED BY THE D U  COMMAND.  THE BITS SET CORRESPOND TO THE BIT   37300000
*  SETTINGS IN BYTE 3 OF THE UCBTYP FIELD.                              37350000
         SPACE 2                                                        37400000
FLAG1    DC    X'00'               FLAG1 FIELD                          37450000
TATYPE   EQU   UCB3TAPE           TAPE DEVICES                          37500000
TPTYPE   EQU   UCB3COMM           TELECOMMUNICATIONS DEVICES            37550000
DATYPE   EQU   UCB3DACC           DIRECT ACCESS DEVICES                 37600000
GRTYPE   EQU   UCB3DISP            GRAPHIC DISPLAY DEVICES              37650000
URTYPE   EQU   UCB3UREC+UCB3CHAR        UNIT RECORD + CHAR RDR DEVICES  37700000
ALLTYPE  EQU   TATYPE+TPTYPE+DATYPE+GRTYPE+URTYPE     ALLDEVICE TYPES   37750000
         SPACE 2                                                        37800000
IDFLD    DS    XL1                AREA ID SAVE AREA                     37850000
WEND     EQU   *                   END OF WORK AREA                     37900000
WAL      EQU   WEND-WORKAREA       LENGTH OF WORK AREA                  37950000
         END                                                            38000000
./  ADD  SSI=70820493,NAME=IEE21110
         TITLE 'IEE21110  UNIT STATUS TWO, PART OF SVC 110'             00100000
IEE21110 CSECT                                                          00200000
*********************************************************************** 00300000
*                                                                     * 00400000
* STATUS                                                              * 00500000
*    CHANGE LEVEL=0 VS2 RELEASE 4                                     * 00600000
*     PTMS FIXED --ZM32568                                            * 00660000
*     APARS FIXED -- ZA09316,ZA11454,ZA13204,ZA17706                  * 00720000
*                                                                     * 00800000
* FUNCTION                                                            * 00900000
*    CREATE DISPLAY LINE ENTRIES                                      * 01000000
*    LOAD DEVICE NAME TABLE                                           * 01100000
*                                                                     * 01200000
* ENTRY POINTS                                                        * 01300000
*         IEE21110                                                    * 01400000
*                                                                     * 01500000
* INPUT                                                               * 01600000
*    REG 11 CONTAINS THE CSCB ADDRESS WHICH CONTAINS ALL OTHER PTRS   * 01700000
*                                                                     * 01800000
* OUTPUT                                                              * 01900000
*    DISPLAY LINE ENTRIES                                             * 02000000
*                                                                     * 02100000
* EXTERNAL REFERENCES                                                 * 02200000
*         SVC 8    (LOAD)                                             * 02300000
*                                                                     * 02400000
* EXITS,NORMAL                                                        * 02500000
*         IEE23110 TO ISSUE DISPLAY LINE BUILT                        * 02600000
*                                                                     * 02700000
* EXITS,ERROR                                                         * 02800000
*             NONE                                                    * 02900000
*                                                                     * 03000000
* TABLES/WORKAREAS                                                    * 03100000
*    CSCB                                                             * 03200000
*    XSA                                                              * 03300000
*    DEVICE NAME TABLE                                                * 03400000
*    WORKAREA                                                         * 03500000
*    UCB                                                              * 03600000
*                                                                     * 03700000
* ATTRIBUTES                                                          * 03800000
*    TYPE IV SVC, PRIVILEGED, RE-ENTRANT                         A36790 03900000
*                                                                     * 04000000
* CHARACTER CODE DEPENDENCY                                           * 04100000
*    NONE                                                             * 04200000
*                                                                     * 04300000
* NOTES                                                               * 04400000
*    NONE                                                             * 04500000
*                                                                     * 04600000
*********************************************************************** 04700000
         EJECT                                                          04800000
         BALR R12,0                                                     12200000
         USING *,R12                                                    12300000
         B     ICATCH              BRANCH AROUND EYECATCHER   MB YM1902 12400000
         DC    CL8'IEE21110'                                            12500000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY                   12600000
         DC    XL2'5043'           JULIAN DATE LAST CHANGE              12700000
         DC    S(*)                BASE DISPL. OF HERE                  12800000
ZAPAREA  DC    10CL4'ZAP '         PATCH AREA                           12900000
ICATCH   EQU   *                                              MB YM1902 13000000
         USING CSCB,R11                                                 13100000
         L     R10,XAL             OBTAIN WORKAREA ADDRESS              13200000
         USING WORKAREA,R10                                             13300000
         TM    FLAG5,INITUNT2      FIRST TIME IN                        13400000
         BO    LOADSTRT           YES, LOAD DEVICE NAME TABLE MB YM1902 13500000
         L     R13,SWORD+L8        RESTORE NAME TABLE ADRESS  MB YM1902 13600000
         B     SETEXT              GO SET UP TEXT             MB YM1902 13700000
LOADSTRT EQU   *                                                        13800000
         NI    FLAG5,L255-INITUNT2     TURN OFF FLAG                    13900000
         LOAD  EP=DEVNAMET         LOAD DEVICE NAME TABLE               14000000
         LR    R13,R0              GET DEVICE NAME TABLE ADDRESS        14100000
         SPACE 2                                                        14200000
*********************************************************************** 14300000
*                                                                     * 14400000
*     SCAN UCB'S BASED ON COMMAND INPUT, BUILD DISPLAY LINE           * 14500000
*     OBTAIN DATA FROM UCB AND DEVICE NAME TABLE                      * 14600000
*                                                                     * 14700000
*********************************************************************** 14800000
SETEXT   EQU   *                                                        14900000
         LA    R8,TEXT             ESTABLISH LINE BASE                  15000000
         USING TEXT,R8                                                  15100000
         USING UCB,R7                                                   15200000
         LH    R15,DEVNOLN         GET NUMBER OF DEVICES IN LINE        15300000
START    EQU   *                                                        15400000
         LA    R9,UCBADDRA         POINT TO ADDRESS LIST                15500000
SCAN1    EQU   *                                                        15600000
         LH    R7,ZERO(R9)         GET FIRST ADDRESS                    15700000
         SLL   R7,L16              CLEAR TOP                            15800000
         SRL   R7,L16              HALF OF REGISTER                     15900000
SCAN2    EQU   *                                                        16000000
         LH    R5,DEVSPRE          GET NUMBER ALREADY DONE              16100000
         LA    R5,ONE(R5)          BUMP BY THIS DEVICE                  16200000
         STH   R5,DEVSPRE          SAVE COUNT                           16300000
         MVC   UCBN1(L3),UCBNAME   MOVE UNIT ADDRESS TO LINE            16400000
         TM    UCBTBYT3,UCB3COMM   COMMUNICATION DEVICE TYEP            16500000
         BO    SCAN5               YES                                  16600000
         L     R2,ZERO(R13)        R2 = NO.DEVICE NAME TABLE ENTRIES    16700000
         LR    R14,R13             POINT TO TABLE                       16800000
         USING DNTMASK,R14                                              16900000
         LA    R14,L4(R14)         BUMP PAST NUMBER OF ENTRIES          17000000
SCAN3    CLC   UCBTYP+L2(L2),DNTUCBTP   MATCHING UCBTYPES               17100000
         BE    SCAN4               YES, MOVE TYPE                       17200000
         LA    R14,L12(R14)        BUMP TO NEXT ENTRY                   17300000
         BCT   R2,SCAN3            TRY AGAIN                            17400000
UNDMOVE  MVC   MODL1(L3),UND       UNDEFINED TYPE                       17500000
         B     SCAN7               PROCEED                              17600000
SCAN4    EQU   *                                                        17700000
         MVC   MODL1(L4),DNTTYPE   MOVE DEVICE TYPE TO LINE             17800000
         CLI   UCBTYP+L2,DATYPE    IS THIS A DA DEVICE         @ZA09316 17807000
         BNE   SCAN7                                           @ZA09316 17814000
         CLI   UCBTYP+L3,MOD11     IS THIS 3330 MOD11          @ZA09316 17821000
         BNE   SCAN4A                                          @ZA09316 17828000
         MVI   MODL1+L3,SUFFIX1    MARK WITH A 1               @ZA17706 17835000
         B     SCAN7                                           @ZA09316 17842000
SCAN4A   EQU   *                                               @ZA09316 17849000
         CLI   UCBTYP+L3,MOD1      IS THIS 3330 MOD1           @ZA09316 17856000
         BNE   SCAN7                                           @ZA09316 17863000
         TM    UCBTYP+L1,VIRTUAL   IS THIS MSS                 @ZA09316 17870000
         BNO   SCAN7                                           @ZA09316 17877000
         MVI   MODL1+L3,SUFFIXV    MARK WITH A V               @ZA17706 17884000
         B     SCAN7               PROCEED                              17900000
SCAN6    EQU   *                                                        18000000
         LA    R3,L5(R3)           BUMP TO NEXT ENTRY                   18100000
         BCT   R1,SCAN5A           LOOP CONTROL                         18200000
         B     UNDMOVE             NOT FOUND  UNDEFINED                 18300000
CTCMOVE  MVC   MODL1(L4),CTCID     CTC TYPE                 JE @ZM32568 18400000
         B     SCAN7               PROCEED                  JE @ZM32568 18500000
SCAN5    EQU   *                                                        18600000
         SR    R1,R1               CLEAR REGISTER                       18700000
         IC    R1,AAA              INSERT NUMBER OF ENTRIES             18800000
         LA    R3,AAA+ONE          POINT TO FIRST ENTRY                 18900000
SCAN5A   EQU   *                                                        19000000
         SR    R2,R2               CLEAR REGISTER                       19100000
         IC    R2,UCBTBYT4         GET UNIT TYPE              MH Y01572 19200000
         TM    UCBTBYT4,F0         ADAPTOR TYPE ALL ONES       @Z40XXJE 19300000
         BO    SCAN5B              YES,DON'T CLEAR HI NIMBLE   @Z40XXJE 19400000
         SLL   R2,L28              IGNORE ADAPTER             MH Y01572 19500000
         SRL   R2,L28                 TYPE                    MH Y01572 19600000
SCAN5B   DS    0H                                              @Z40XXJE 19700000
         CLI   UCBTBYT3,CTCTYPE    CHANNEL-CHANNEL ADAPTOR  JE @ZM32568 19800000
         BE    CTCMOVE             YES, MOVE IN ID          JE @ZM32568 19900000
         EX    R2,SCAN5TST         COMPARE                              20000000
         BNE   SCAN6               NOT EQUAL GET ANOTHER ENTRY          20100000
         MVC   MODL1(L4),ONE(R3)   MOVE DEVICE TYPE                     20200000
SCAN7    EQU   *                                                        20300000
         DROP  R14                                                      20400000
         TM    FLAG2,OFFLNS        OFFLINE DISPLAY                      20500000
         BO    SCANEND             YES, BUILD ANOTHER ENTRY             20600000
         TM    SRTESTAT,SRTEONLI   IS DEVICE ONLINE                     20700000
         BO    SCAN7A              CONTINUE TEST                        20800000
         TM    SRTESTAT,SRTEALOC   IS DEVICE ALLOCATED       ME SA52720 20900000
         BO    ALLOCATE            YES,  MUST BE T/P DEVICE  ME SA52720 21000000
         MVC   USTAT1(L7),OFFLIN    PUT OFFLINE INTO TEXT               21100000
         B     SCANEND             END OF SCAN                          21200000
SCAN7A   EQU   *                                                        21300000
         TM    SRTESTAT,USYSPCON   SYSRES OR CONSOLE                    21400000
         BNO   SCAN7C              NO                                   21500000
         TM    SRTESTAT,SRTEPRES   RESIDENT VOLUME                      21600000
         BNO   SCAN7B              NO, THEN CONSOLE                     21700000
         LA    R1,SYSRES           ADDRESS OF SYSRES                    21800000
MSTAT1   EQU   *                                                        21900000
         MVC   USTAT1(L1),ZERO(R1)      MOVE CHARACTER                  22000000
         B     SCAN7E              PROCEED                              22100000
SCAN7B   EQU   *                                                        22200000
         LA    R1,CONSOL           MOVE                                 22300000
         B     MSTAT1              CHARACTER                            22400000
SCAN7C   EQU   *                                                        22500000
         TM    SRTESTAT,USALLOC    ALLOCATED                            22600000
         BNO   SCAN7D              NO                                   22700000
ALLOCATE EQU   *                                             ME SA52720 22800000
         LA    R1,ALLOC            YES                                  22900000
         B     MSTAT1              MOVE CHARACTER                       23000000
SCAN7D   EQU   *                                                        23100000
         LA    R1,ONLINE           ASSUME ONLINE                        23200000
         B     MSTAT1              MOVE CHARACTER                       23300000
SCAN7F   EQU   *                                                        23400000
         TM    UCBTBYT3,USTAORDA   TAPE OR DASD                         23500000
         BZ    SCAN7H              NO, MOUNT NOT POSSIBLE               23600000
         TM    UCBTBYT3,UCB3DACC   DASD                                 23700000
         BNO   SCAN7G              NO, CHECK TAPE                       23800000
         TM    SRTEDMCT,USMNTPOS   MOUNT PENDING                        23900000
         BNO   SCAN7H              NO                                   24000000
SCAN7F1  LA    R1,MOUNT            YES                                  24100000
         B     MSTAT2              MOVE WORD                            24200000
SCAN7G   EQU   *                                                        24300000
         TM    UCBFL2,USNREADY     TAPE AND NOT READY                   24400000
         BNO   SCAN7H              NO                                   24500000
         TM    SRTEDMCT,USMNTPOS   MOUNT PENDING                        24600000
         BO    SCAN7F1             YES                                  24700000
SCAN7H   EQU   *                                                        24800000
         TM    UCBFL2,USNREADY     NOT READY                            24900000
         BNO   SCAN7I              NO                                   25000000
         LA    R1,NREADY           YES                                  25100000
         B     MSTAT2              MOVE WORD                            25200000
SCAN7E   EQU   *                                                        25300000
         TM    UCBFL2,USBUSY       DEVICE BUSY                          25400000
         BNO   SCAN7F              NO                                   25500000
         LA    R1,BUSY             YES                                  25600000
MSTAT2   EQU   *                                                        25700000
         MVC   USTAT2(L4),ZERO(R1)      MOVE WORD                       25800000
SCAN7I   EQU   *                                                        25900000
         LR    R5,R7               LOAD UCB ADDRESS                     26000000
         IOSGEN DETECTOR,UCB=(5)                               @ZA13204 26100000
         BZ    SCAN8               NOT RESERVED DASD                    26200000
         MVC   USTAT3(L2),RESR     MOVE WORD                            26300000
SCAN8    EQU   *                                                        26400000
         TM    UCBTBYT3,USTAORDA   TAPE OR DASD                         26500000
         BZ    SCANEND             NO                                   26600000
         TM    UCBTBYT3,UCB3TAPE   TAPE                                 26700000
         BNO   SCAN8A              NO                                   26800000
         TM    SRTEVOLI,FF         INTERNAL NUMBER                      26900000
         BO    SCAN9               YES, DO NOT USE                      27000000
SCAN8A   EQU   *                                                        27100000
         NC    SRTEVOLI(L6),SRTEVOLI    Q.   VOLUME SERIAL EQUAL ZERO   27200000
         BZ    SCAN9               YES  SKIP IT                         27300000
         MVC   VOLID1(L6),SRTEVOLI      MOVE SERIAL NUMBER              27400000
SCAN9    EQU   *                                                        27500000
         TM    SRTESTAB,SRTEBPRV   PRIVATE VOLUME                       27600000
         BNO   SCAN9A              NO                                   27700000
         LA    R1,PRIV             YES                                  27800000
MVSTAT1  EQU   *                                                        27900000
         MVC   VOST1A(L4),ZERO(R1)      MOVE WORD                       28000000
         B     SCAN9C              TEST FOR OTHER VOLUME STATES         28100000
SCAN9A   EQU   *                                                        28200000
         TM    SRTESTAB,SRTEBPUB   PUBLIC VOLUME                        28300000
         BNO   SCAN9B              NO                                   28400000
         LA    R1,PUB              YES                                  28500000
         B     MVSTAT1             MOVE WORD                            28600000
SCAN9B   EQU   *                                                        28700000
         TM    SRTESTAB,SRTEBSTR   STORAGE                              28800000
         BNO   SCAN9C              NO                                   28900000
         LA    R1,STRG             YES                                  29000000
         B     MVSTAT1             MOVE WORD                            29100000
SCAN9C   EQU   *                                                        29200000
         TM    SRTESTAT,SRTEPRES   PERM/RES VOLUME                      29300000
         BNO   SCAN9D              NO                                   29400000
         LA    R1,RESDNT           YES                                  29500000
MVSTAT2  EQU   *                                                        29600000
         MVC   VOST1B(L6),ZERO(R1)      MOVE WORD                       29700000
         B     SCANEND             DONE                                 29800000
SCAN9D   EQU   *                                                        29900000
         TM    SRTESTAT,SRTERESV   RESERVED VOLUME                      30000000
         BNO   SCAN9E              NO                                   30100000
         LA    R1,RESERV           YES                                  30200000
         B     MVSTAT2             MOVE WORD                            30300000
SCAN9E   EQU   *                                                        30400000
         LA    R1,REMOVE           MOVE DEFAULT                         30500000
         B     MVSTAT2             MOVE WORD                            30600000
         SPACE 2                                                        30700000
*********************************************************************** 30800000
*                                                                     * 30900000
*  DETERMINE IF LINE CAN BE WRITTEN OR SET UP FOR NEXT ENTRY          * 31000000
*                                                                     * 31100000
*********************************************************************** 31200000
SCANEND1 EQU   *                                                        31300000
         L     R15,SAVE+L8         GET DEVICE COUNT                     31400000
SCANEND  EQU   *                                                        31500000
         LA    R9,L2(R9)           POINT TO NEXT UCB ADDRESS            31600000
         CLC   ZERO(L2,R9),NOADDRES    ANY ADDRESS                      31700000
         BE    EXIT4               NO, GO TO IEEUNIT4                   31800000
         BCT   R15,TESTOFF         RUN OUT OF DEVICES                   31900000
         B EXIT4                   YES  RETURN TO IEEUNIT4              32000000
TESTOFF  EQU   *                                                        32100000
         DROP  R8                                                       32200000
         TM    FLAG2,OFFLNS        OFFLINE DISPLAY                      32300000
         BO    ADDOFF              YES                                  32400000
         LA    R8,DISP(R8)         BASE FOR SECOND HALF OF LINE         32500000
         B     SCAN1               BUILD SECOND HALF                    32600000
ADDOFF   EQU   *                                                        32700000
         LA    R8,DISPO(R8)        INCREMENT FOR OFFLINE DISPLAY        32800000
         B     SCAN1               BUILD NEXT PORTION OF LINE           32900000
EXIT4    EQU   *                                                        33000000
         MVI   XAX+4,X'F3'        SET NAME FOR EXIT TO UNIT4            33100000
XCTL     EQU   *                                                        33200000
         ST    R13,SWORD+L8        SAVE TABLE POINTER                   33300000
         LA    R15,XSA             POINT TO PARA LIST                   33400000
         XCTL  SF=(E,(R15))        TRANSFER CONTROL                     33500000
         EJECT                                                          33600000
*********************************************************************** 33700000
*                                                                     * 33800000
*     EXECUTED STATEMENTS                                             * 33900000
*                                                                     * 34000000
*********************************************************************** 34100000
SCAN5TST EQU   *                                                        34200000
         CLI   ZERO(R3),ZERO       USED BY SCAN5                        34300000
         SPACE 2                                                        34400000
*********************************************************************** 34500000
*                                                                     * 34600000
*     EQUATES                                                         * 34700000
*                                                                     * 34800000
*********************************************************************** 34900000
R0       EQU   0                   GENERAL REGISTER NOTATION            35000000
R1       EQU   1                   *                       *            35100000
R2       EQU   2                   *                       *            35200000
R3       EQU   3                   *                       *            35300000
R4       EQU   4                   *                       *            35400000
R5       EQU   5                   *                       *            35500000
R6       EQU   6                   *                       *            35600000
R7       EQU   7                   *                       *            35700000
R8       EQU   8                   *                       *            35800000
R9       EQU   9                   *                       *            35900000
R10      EQU   10                  *                       *            36000000
R11      EQU   11                  *                       *            36100000
R12      EQU   12                  *                       *            36200000
R13      EQU   13                  *                       *            36300000
R14      EQU   14                  *                       *            36400000
R15      EQU   15                  *                       *            36500000
         SPACE 3                                                        36600000
L1       EQU   1                   *         *             *            36700000
L2       EQU   2                   *         *             *            36800000
L3       EQU   3                   *         *             *            36900000
L4       EQU   4                   *         *             *            37000000
L5       EQU   5                   *         *             *            37100000
L6       EQU   6                   *         *             *            37200000
L7       EQU   7                   *         *             *            37300000
L8       EQU   8                   *         *             *            37400000
L12      EQU   12                  *         *             *            37500000
L16      EQU   16                  *         *             *            37600000
L24      EQU   24                  *         *             *     A36165 37700000
L28      EQU   28                  *         *             *  MH Y01572 37800000
L32      EQU   32                  *         *             *            37900000
L255     EQU   255                 *         *             *            38000000
ZERO     EQU   0                   *         *             *            38100000
ONE      EQU   1                   DISPLACEMENT OF ONE                  38200000
DISPO    EQU   10                  LENGTH OF OFFLINE DEVICE ENTRY       38300000
DISP     EQU   36                  TEXT+DISP IS SECOND HALF OF LINE     38400000
USYSPCON EQU   X'02'               SYSRES OR CONSOLE DEVICE             38500000
USALLOC  EQU   X'08'               ALLOCATED DEVICE MASK                38600000
USNREADY EQU   X'40'               NOT READY DEVICE MASK                38700000
USTAORDA EQU   X'A0'               TAPE OR DIRECT ACCESS DEVICE MASK    38800000
USMNTPOS EQU   X'80'               POSSIBLE MOUNT PENDING MASK          38900000
USBUSY   EQU   X'80'               DEVICE BUSY MASK                     39000000
FF       EQU   X'FF'               USED AS TERMINATOR                   39100000
F0       EQU   X'F0'               MASK FOR ADAPTOR TYPE       @Z40AKJE 39200000
         EJECT                                                          39300000
*********************************************************************** 39400000
*                                                                     * 39500000
*     CONSTANTS                                                       * 39600000
*                                                                     * 39700000
*********************************************************************** 39800000
         DS    0F                                                       39900000
NOADDRES DC    H'0'                USED TO VERIFY UCBARDRA ADDRESS      40000000
*                                                                       40100000
*                                  THE FOLLOWING CONSTANTS ARE USED     40200000
*                                  TO BUILD THE DISPLAY LINE            40300000
CONSOL   DC    C'C'                SYSTEM CONSOLE                       40400000
SYSRES   DC    C'S'                SYSRES DEVICE                        40500000
ONLINE   DC    C'O'                DEVICE IS ONLINE                     40600000
OFFLIN   DC    C'OFFLINE'          DEVICE IS OFFLINE                    40700000
ALLOC    DC    C'A'                DEVICE IS ALLOCATED                  40800000
NREADY   DC    C'-NRD'             DEVICE IS NOT READY                  40900000
BUSY     DC    C'-BSY'             DEVICE IS BUSY                       41000000
MOUNT    DC    C'-MTP'             DEVICE HAS MOUNT REQUEST OUTSTANDING 41100000
PUB      DC    C' PUB'             PUBLIC VOLUME                        41200000
PRIV     DC    C'PRIV'             PRIVATE VOLUME                       41300000
STRG     DC    C'STRG'             STORAGE VOLUME                       41400000
REMOVE   DC    C'/REMOV'           VOLUME IS REMOVEABLE                 41500000
RESDNT   DC    C'/RSDNT'           VOLUME IS RESIDENT                   41600000
RESERV   DC    C'/RSERV'           VOLUME IS RESERVED                   41700000
UND      DC    C'UND '             DEVICE TYPE IS UNDEFINED             41800000
RESR     DC    C'-R'               RESERVED SHARED DASD DEVICE          41900000
CTCID    DC    CL4'CTC '         CHANNEL-CHANNEL ADAPTOR ID JE @ZM32568 42000000
*                                                                       42100000
*                                  THE FOLLOWING TABLE IS USED TO       42200000
*                                  IDENTIFY T/P CONTROL UNITS BY        42300000
*                                  MATCHING WITH THE UNIT TYPE          42400000
*                                  FIELD OF THE UCB.                    42500000
*                                                                       42600000
AAA      DC    XL1'08'             NUMBER OF ENTRIES           @Z40XXJE 42700000
AAA1     DC    XL1'01'             UNIT TYPE X1               MH Y01572 42800000
         DC    C'2702'             DEVICE TYPE                MH Y01572 42900000
AAA2     DC    XL1'02'             UNIT TYPE X2               MH Y01572 43000000
         DC    C'2701'             DEVICE TYPE                MH Y01572 43100000
AAA3     DC    XL1'03'             UNIT TYPE X3               MH Y01572 43200000
         DC    C'2703'             DEVICE TYPE                MH Y01572 43300000
AAA4     DC    XL1'04'             UNIT TYPE X4               MH Y01572 43400000
         DC    C'2955'             DEVICE TYPE                MH Y01572 43500000
AAA5     DC    XL1'05'             UNIT TYPE X5               MH Y01572 43600000
         DC    C'3705'             DEVICE TYPE                MH Y01572 43700000
AAA6     DC    XL1'06'             UNIT TYPE X6               MH Y01572 43800000
         DC    C'UND '             DEVICE TYPE                MH Y01572 43900000
AAA7     DC    XL1'07'             UNIT TYPE X7               MH Y01572 44000000
         DC    C'UND '             DEVICE TYPE                MH Y01572 44100000
AAA8     DC    XL1'F1'             UNIT TYPE                   @Z40XXJE 44200000
         DC    CL4'3791'           DEVICE TYPE 3791 LOCAL      @Z40XXJE 44300000
         EJECT                                                          44400000
*********************************************************************** 44500000
*                                                                     * 44600000
*     DSECTS                                                          * 44700000
*                                                                     * 44800000
*********************************************************************** 44900000
UCB      DSECT                                                          45000000
         IEFUCBOB                                                       45100000
         EJECT                                                          45200000
CSCB     DSECT                                                          45300000
         IEECHAIN                                                       45400000
         ORG   CHAIN+L32                                                45500000
         IEEXSA                                                         45600000
         ORG   XSA+L24                                           A36165 45700000
         DS    0F                                                       45800000
WORKING  DS    5F                  WORKING STORAGE                      45900000
DEVNOLN  EQU   WORKING+L8          NUMBER OF DEVICES PER LINE           46000000
DEVSPRE  EQU   DEVNOLN+L2          NUMBER OF DEVICES DISPLAYED          46100000
LASTUCB  EQU   DEVSPRE+L3          STARTING UCB ADDRESS/BIN NUMBER      46200000
FROMID   EQU   LASTUCB+L4          REQUESTING CONSOLE ID                46300000
SAVE     DS    21F                 SAVE AREA BETWEEN MODULES            46400000
         ORG   SAVE+L12                                                 46500000
PACKWORD DS    F                   WORD USED FOR PACK INSTRUCTIONS      46600000
CVBWORD   DS   F                   WORD USED FOR CONVERT TO BINARY      46700000
         EJECT                                                          46800000
DNTMASK  DSECT                                                          46900000
*                                  DEVICE NAME TABLE ENTRY MASK         47000000
DNTTYPE  DS    XL8                 DEVICE TYPE IN EBCDIC                47100000
DNTJUNK  DS    XL2                 UNUSED BY THIS SUPPORT               47200000
DNTUCBTP DS    XL2                 FIELD MATCHED AGAINST UCB            47300000
         EJECT                                                          47400000
WORKAREA DSECT                                                          47500000
         SPACE 2                                                        47600000
         DS    0D                                                       47700000
UCBADDRA DS    7H                  UCB ADDRESS LIST                     47800000
UCBADDRB DS    H                   FROM UNIT4                           47900000
SWORD    DC    3F'0'               SAVE AREA ACROSS MODULES             48000000
UNIT1    DS    F                   HOLD ADDRESS ONE                     48100000
UNIT2    DS    F                   HOLD ADDRESS TWO                     48200000
UNIT3    DS    F                   HOLD ADDRESS THREE                   48300000
         SPACE 4                                                        48400000
FLAG2    DC    X'00'               COMMUNICATIONS BYTE                  48500000
ONLINS   EQU   128                 DISPLAY ONLINE DEVICES               48600000
OFFLNS   EQU   64                  DISPLAY OFFLINE DEVICES              48700000
ALLS     EQU   32                  DISPLAY OFFLINE + ONLINE DEVICES     48800000
SUFEXIST EQU   16                  REQUESTING CONSOLE IS A CRT DEVICE   48900000
SINGLE   EQU   8                   SINGLE DEVICE REQUEST                49000000
COREGOT  EQU   4                   GET REGION DONE                      49100000
OPEN22   EQU   2                   OPEN FLAG                            49200000
R13UCBNM EQU   1                   FLAG FOR COMPSET ROUTINE             49300000
         SPACE 2                                                        49400000
FLAG3    DC    X'00'               COMMUNICATIONS FLAGS                 49500000
U2       EQU   128                TELL UNIT2 ENTRY FOR SCAN OF CDES     49600000
UNIT3RET EQU   64                  IEE22110 RETURNING TO IEE21110       49700000
OPEN332  EQU   32                  OPEN FLAG                            49800000
DEVDEF   EQU   16                  DEVICE ADDRESS DEFAULTED             49900000
HEADOUTF EQU   8                   HEADING AND LABELS ARE OUT           50000000
OPEN34   EQU   4                   OPEN FLAG                            50100000
OPEN32   EQU   2                   OPEN FLAG                            50200000
OPEN31   EQU   1                   OPEN FLAG                            50300000
         SPACE 2                                                        50400000
*  FLAG4 BYTE IS USED FOR COMMUNICATIONS BETWEEN IEEUNIT3 AND THE       50500000
*  OTHER  D UNIT  MODULES.                                              50600000
FLAG4    DC    XL1'00'             COMMUNICATIONS BYTE        MB YM1902 50700000
EXITBIT  EQU   X'00'               RETURN TO CALLER           MD        50800000
MSG1     EQU   X'04'               ISSUE MESSAGE MSG1A        MD        50900000
MSG3     EQU   X'08'               ISSUE MESSAGE MSG3A        MD        51000000
MSG4     EQU   X'0C'               ISSUE MESSAGE MSG4A        MD        51100000
         SPACE 2                                                        51200000
FLAG5    DS    XL1                                                      51300000
NODEF    EQU   X'80'               LINE DEFAULT NOT TAKEN               51400000
INITENT  EQU   X'40'               INITIAL ENTRY TO IEEUNIT4            51500000
INITUNT2 EQU   X'20'               SET FOR INITIAL UNIT2 ENTRY          51600000
CRTMSG2  EQU   X'10'               MSG2 WITH HEADINGS FOR DIDOCS        51700000
UN4BINLT EQU   X'08'               LASTBIN FLAG FOR UNIT4               51800000
DISPBIT  EQU   X'04'               VALID ADDRESS FOUND                  51900000
DISPEND  EQU   X'02'               END OF FRAME AND DISPLAY             52000000
OPEN51   EQU   X'01'               OPEN FLAG                            52100000
         SPACE 2                                                        52200000
         DS    0F                  FORCE FULL WORD FOR WTO              52300000
WTOSET   DS    XL1                 ZERO                                 52400000
TEXTLEN  DS    XL1                 OUTPUT LENGTH                        52500000
LENGTH   EQU   76                  FULL LINE                            52600000
MCSONE   DS    XL1                 MCS FLAGS PART ONE                   52700000
SETONE   EQU   X'E1'               QUEUE BY ID, ROUTING AND DESCRIPTOR  52800000
*                                  CODES EXIST, COMMAND RESPONSE, QUEUE 52900000
*                                  BY ID ONLY                           53000000
MCSTWO   DS    XL1                 MCS FLAGS PART TWO                   53100000
SETTWO   EQU   X'40'               MLWTO                                53200000
         SPACE 1                                                        53300000
MSGT     DS    0C                  BEGIN TEXT LINE                      53400000
TEXT     DS    XL72                TEXT FIELD                           53500000
         ORG   TEXT                                                     53600000
TITLEID  DS    XL8                 MESSAGE ID                           53700000
TITLEDGH DS    XL3                 HOURS.                               53800000
TITLEDGM DS    XL3                 MINUTES.                             53900000
TITLEDGS DS    XL2                 SECONDS                              54000000
TITLENM  DS    XL11                DISPLAY NAME                         54100000
         ORG   TEXT                                                     54200000
UCBN1    DS    XL5                 UNIT ADDRESS                         54300000
MODL1    DS    XL5                 DEVICE TYPE                          54400000
USTAT1   DS    XL1                 STATUS (O,A,S,C,OFFLINE)             54500000
USTAT2   DS    XL4                 STATUS (-BSY,-MTP,-NRD)              54600000
USTAT3   DS    XL3                 STATUS (-R)                          54700000
VOLID1   DS    XL7                 VOLUME SERIAL NUMBER                 54800000
VOST1A   DS    XL4                 VOLUME STATE (PUB,PRIV,STRG)         54900000
VOST1B   DS    XL6                 VOLUME STATE (-REMOV,-RSDNT,-RSERV)  55000000
         ORG   TEXT+72            ORG FOR WTO TAIL                      55100000
DESCODE  DS    XL2                 DESCRIPTOR CODES                     55200000
RTECODE  DS    XL2                 ROUTING CODES                        55300000
TYPEFLAG DS    XL2                 MESSAGE TYPES                        55400000
AID      DS    XL1                AREA ID FIELD                         55500000
LNUM     DS    XL1                NUMBER OF LINES                       55600000
HOLD2    DS    F                   MLWTO ID AND CONSOLE ID              55700000
NODEVICS DS    H                   NUMBER OF UNITS REQUESTED            55800000
NODEVDEF EQU   100                 DEFAULT                              55900000
         SPACE 4                                                        56000000
*  FLAG1 BYTE IS SET BY IEEUNIT1 TO REFLECT THE DEVICE TYPE(S)          56100000
*  REQUESTED BY THE D U  COMMAND.  THE BITS SET CORRESPOND TO THE BIT   56200000
*  SETTINGS IN BYTE 3 OF THE UCBTYP FIELD.                              56300000
         SPACE 2                                                        56400000
FLAG1    DC    X'00'               FLAG1 FIELD                          56500000
TATYPE   EQU   UCB3TAPE           TAPE DEVICES                          56600000
TPTYPE   EQU   UCB3COMM           TELECOMMUNICATIONS DEVICES            56700000
DATYPE   EQU   UCB3DACC           DIRECT ACCESS DEVICES                 56800000
GRTYPE   EQU   UCB3DISP            GRAPHIC DISPLAY DEVICES              56900000
URTYPE   EQU   UCB3UREC+UCB3CHAR        UNIT RECORD + CHAR RDR DEVICES  57000000
ALLTYPE  EQU   TATYPE+TPTYPE+DATYPE+GRTYPE+URTYPE     ALLDEVICE TYPES   57100000
CTCTYPE  EQU   X'41'  CHANNEL-CHANNEL ADAPTOR TYPE          JE @ZM32568 57200000
MOD1     EQU   X'09'                                           @ZA09316 57300000
MOD11    EQU   X'0D'                                           @ZA09316 57320000
VIRTUAL  EQU   X'08'                                           @ZA09316 57340000
SUFFIX1  EQU   C'1'                                            @ZA09316 57360000
SUFFIXV  EQU   C'V'                                            @ZA09316 57380000
IDFLD    DS    XL1                AREA ID SAVE AREA                     57400000
WEND     EQU   *                   END OF WORK AREA                     57500000
WAL      EQU   WEND-WORKAREA       LENGTH OF WORK AREA                  57600000
         END                                                            57700000
./  ADD  SSI=31871468,NAME=IEE22110
         TITLE 'IEE22110  UNIT STATUS THREE,  PART OF SVC 110'          00050002
IEE22110 CSECT                                                          00100002
*D044000,050000,050500,051000,122500,123000,123500            MH Y01043 00100102
*C117500                                                      MH Y01044 00100402
*C 65500                                                     ME SA51384 00102002
*A 61100,65600                                               ME SA51384 00104002
*A 035600-035900                                              MB YM1902 00110002
*        THIS MODULE CREATED FOR RELEASE 21 OF OS/360            S21002 00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* STATUS                                                              * 00300002
*    CHANGE LEVEL=0                                                   * 00350002
*                                                                     * 00400002
* FUNCTION                                                            * 00450002
*    ISSUE ERROR MESSAGES                                             * 00500002
*    FREE WORKAREA                                                    * 00550002
*    DELETE DEVNAMET                                                  * 00600002
*    RETURN TO FIRST LOAD SVC 110 (IEE00110)                          * 00650002
*                                                                     * 00700002
* ENTRY POINTS                                                        * 00750002
*         IEE22110                                                    * 00800002
*                                                                     * 00850002
* INPUT                                                               * 00900002
*    REG 11 CONTAINS THE CSCB ADDRESS WHICH CONTAINS ALL OTHER PTRS   * 00950002
*                                                                     * 01000002
* OUTPUT                                                              * 01050002
*    DISPLAY LINE ENTRIES FOR DATA CELL BINS                          * 01100002
*    ERROR MESSAGES                                                   * 01150002
*                                                                     * 01200002
* EXTERNAL REFERENCES                                                 * 01250002
*         SVC 35   (WTO)                                              * 01300002
*         SVC 10   (FREEMAIN)                                         * 01350002
*         SVC 9    (DELETE)                                           * 01400002
*                                                                     * 01450002
* EXITS,NORMAL                                                        * 01500002
*         IEE00110 TO RETURN                                          * 01550002
*                                                                     * 01600002
* EXITS,ERROR                                                         * 01650002
*         NONE                                                        * 01700002
*                                                                     * 01750002
* TABLES/WORKAREAS                                                    * 01800002
*    CSCB                                                             * 01850002
*    XSA                                                              * 01900002
*    WORKAREA                                                         * 01950002
*    UCB                                                              * 02000002
*                                                                     * 02050002
* ATTRIBUTES                                                          * 02100002
*    TYPE IV SVC, PRIVILEGED, RE-ENTRANT                         A36790 02150002
*                                                                     * 02200002
* CHARACTER CODE DEPENDENCY                                           * 02250002
*    NONE                                                             * 02300002
*                                                                     * 02350002
* NOTES                                                               * 02400002
*    NONE                                                             * 02450002
*                                                                     * 02500002
*********************************************************************** 02550002
         EJECT                                                          02600002
*/*IEE22110: CHART */                                                   02650002
*/* E IEE22110 */                                                       02700002
*/* P SET BASES */                                                      02750002
*/*%RET: P SET RETURN TO UNIT 3 FLAG */                                 02800002
*/*%GETCODE: P GET BRANCH CODE */                                       02850002
*/* D (=0,PUTMSG0,=4,EXIT,=8.PUTMSG1,=12,PUTMSG3,=16,PUTMSG4) BRANCH    02900002
*/*TABLE */                                                             02950002
*/*PUTMSG0: P (,WTO) SET UP INSUFFICIENT STORAGE MSG */                 03000002
*/*PUTMSG1: P (,WTO) SET UP NO DEV WITH REQ ATTRIBUTES MSG */           03050002
*/*PUTMSG3:  P (,WTO) SET UP INVALID OPERAND MSG */                     03100002
*/*PUTMSG4: P (,WTO) SET UP DEVICE DOES NOT EXIST MSG */                03150002
*/*WTO: S WTO: ISSUE SVC 35 ON ERROR MSG */                             03200002
*/*EXIT: S DELETE:DEVNAMET */                                           03250002
*/*%FREE: S FREEMAIN:WORKAREA */                                        03300002
*/*OUT: R IEE00110 */                                                   03350002
*/*IEE23110: END */                                                     03400002
         EJECT                                                          03450002
         BALR  R12,0                                                    03500002
         USING *,R12                                                    03550002
         B     ICATCH              BRANCH AROUND EYECATCHER   MB YM1902 03560002
         DC    C'01 MODULE IGC22110, FICHE IEE22110  '        MB YM1902 03570002
ZAPAREA  DC    12C'ZAP'  RESERVED FOR FIELD MODIFICATION      MB YM1902 03580002
ICATCH   EQU   *                                              MB YM1902 03590002
         USING CSCB,R11                                                 03600002
         L     R10,XAL             GET POINTER TO WORKAREA              03650002
         USING WORKAREA,R10        ESTABLISH BASE                       03700002
         SPACE 2                                                        03750002
*********************************************************************** 03800002
*                                                                     * 03850002
*                  TEST REASON FOR ENTRY                                03900002
*                                                                     * 03950002
********************************************************************    04000002
         USING UCB,R7              ESTABLISH UCB BASE                   04050002
         SR    R2,R2                CLEAR REGISTER AND                  04100002
         IC    R2,FLAG4            GET BRANCH CODE                      04150002
         B     *+4(R2)            INDEX INTO BRANCH TABLE               04200002
         B     EXIT                GET OUT                              04250002
         B     PUTMSG1             PUT OUT MSG1A AND EXIT               04300002
         B     PUTMSG3             PUT OUT MSG3A AND EXIT               04350002
         SPACE 2                                                        04450002
*********************************************************************** 04500002
*                                                                     * 04550002
*     EXIT EFFECTING MODULES                                          * 04600002
*                                                                     * 04650002
*********************************************************************** 04700002
PUTMSG1  EQU   *                                                        04750002
         MVC   TEXT(MSG1ALGN),MSG1A     PUT MSG1A INTO WTO LIST         04800002
         B     WTO                 WRITE LINE                           04850002
PUTMSG3  EQU   *                                                        04900002
         MVC   TEXT(MSG3ALGN),MSG3A     PUT MSG3A INTO WTO TEXT         04950002
WTO      EQU   *                                                        05150002
         LA    R1,TEXT+L71         BEGIN SEARCH AT END OF TEXT FIELD    05200002
WTOLOOP  EQU   *         SEARCH BACK FOR LAST TEXT CHARACTER            05250002
         CLI   ZERO(R1),BLANK      Q.   IS THIS CHARACTER A BLANK       05300002
         BNE   HITEXT              NO   FOUND END - FINISH WTO          05350002
         BCT   R1,WTOLOOP          CHECK PREVIOUS ENTRY                 05400002
HITEXT   EQU   *                                                        05450002
         MVC   ONE(L4,R1),DCODE    MOVE WTO TAIL AFTER TEXT             05500002
         LA    R1,L5(R1)           INCREMENT 5 TO COMPUT LENGTH         05550002
         LA    R0,TEXT             POINT TO TEXT BEGINNING              05600002
         SR    R1,R0               COMPUTE WTO LENGTH                   05650002
         STH   R1,WTOSET           STORE LENGTH IN LIST                 05700002
         MVI   MCSONE,SETONE       SET MCS FLAG FIELD                   05750002
         MVI   MCSTWO,ZERO         ZERO OUT SECOND MCS BYTE             05800002
         SR    R0,R0               CLEAR REG FOR UCM ENTRY ID           05850002
         IC    R0,FROMID           PUT IN REQUESTOR'S ID                05900002
         LA    R1,WTOSET           POINT TO WTO LIST IN WORKAREA        05950002
         WTO   MF=(E,(1))          EXECUTE WTO LIST                     06000002
EXIT     EQU   *                                                        06050002
         DELETE EP=DEVNAMET        REMOVE SUPPORT FROM DNT USE COUNT    06100002
         LM    R3,R4,SWORD1        RESTORE REGS              ME SA51384 06110002
         LA    R1,SPN              WORK AREA SUBPOOL                    06150002
         SLL   R1,HIGH             SHIFT TO HIGH ORDER                  06200002
         LA    R0,WAL              LENGTH                               06250002
         OR    R0,R1               COMBINE IN REGISTER ZERO             06300002
         LR    R1,R10              CORE POINTER                         06350002
         FREEMAIN   R,LV=(0),A=(1)     FREE WORKAREA CORE               06400002
OUT      EQU   *                                                        06450002
         LR    R2,R11             SHIFT CSCB POINTER                    06500002
         LR    R13,R3             SET SAVE ADDRESS           ME SA51384 06550002
         LR    R14,R4             SET RETURN ADDRESS         ME SA51384 06560002
         MVC   XAX(L8),RETRNAME    GO BACK TO IGC00110                  06600002
XCTL     EQU   *                                                        06650002
         LA    R15,XSA             POINT TO PARA LIST                   06700002
         XCTL  SF=(E,(R15))        TRANSFER CONTROL                     06750002
         EJECT                                                          06800002
*********************************************************************** 06850002
*                                                                     * 06900002
*        EQUATE STATEMENTS                                            * 06950002
*                                                                     * 07000002
*********************************************************************** 07050002
R0       EQU   0                   GENERAL REGISTER NOTATION            07100002
R1       EQU   1                   *                       *            07150002
R2       EQU   2                   *                       *            07200002
R3       EQU   3                   *                       *            07250002
R4       EQU   4                   *                       *            07300002
R5       EQU   5                   *                       *            07350002
R6       EQU   6                   *                       *            07400002
R7       EQU   7                   *                       *            07450002
R8       EQU   8                   *                       *            07500002
R9       EQU   9                   *                       *            07550002
R10      EQU   10                  *                       *            07600002
R11      EQU   11                  *                       *            07650002
R12      EQU   12                  *                       *            07700002
R13      EQU   13                  *                       *            07750002
R14      EQU   14                  *                       *            07800002
R15      EQU   15                  *                       *            07850002
         SPACE 2                                                        07900002
L0       EQU   0                   THESE ARE LENGTHS AND DISPLACEMENTS  07950002
L1       EQU   1                   USED BY THIS MODULE               *  08000002
L2       EQU   2                   *                                 *  08050002
L3       EQU   3                   *                                 *  08100002
L4       EQU   4                   *                                 *  08150002
L5       EQU   5                   *                                 *  08200002
L6       EQU   6                   *                                 *  08250002
L7       EQU   7                   *                                 *  08300002
L8       EQU   8                   *                                 *  08350002
L9       EQU   9                   *                                 *  08400002
L10      EQU   10                  *                                 *  08450002
L11      EQU   11                  *                                 *  08500002
L12      EQU   12                  *                                 *  08550002
L13      EQU   13                  *                                 *  08600002
L14      EQU   14                  *                                 *  08650002
L15      EQU   15                  *                                 *  08700002
L16      EQU   16                  *                                 *  08750002
L24      EQU   24                  *                             A36165 08800002
L32      EQU   32                  *                                 *  08850002
L42      EQU   42                  *                                 *  08900002
L71      EQU   71                  *                                 *  08950002
SP       EQU   247                 SUBPOOL NUMBER FOR FREEMAIN          09000002
L255     EQU   255                 LENGTH OF 255                        09050002
ZERO     EQU   0                   *                                 *  09100002
ONE      EQU   1                   *                                 *  09150002
HIGH     EQU   24                  USED FOR SHIFTING IN REGISTERS       09200002
DISP     EQU   36                  TEXT+DISP=SECOND HALF OF LINE        09250002
SPN      EQU   255                 WORKAREA SUBPOOL                     09300002
USMOUNT  EQU   X'80'               MOUNT PENDING MASK                   09350002
USONL    EQU   X'80'               ONLINE STATUS MASK                   09400002
USALLOC  EQU   X'08'               ALLOCATED DEVICE MASK                09450002
CELLSTRG EQU   X'04'               STORAGE CELL MASK                    09500002
CELLPUB  EQU   X'08'               PUBLIC CELL MASK                     09550002
CELLPERM EQU   X'04'               PERMANENT CELL MASK                  09600002
CELLPRIV EQU   X'10'               PRIVATE CELL MASK                    09650002
CELLRESV EQU   X'20'               RESERVED CELL MASK                   09700002
BLANK    EQU   C' '                USED TO BLANK WORKAREAS              09750002
F0       EQU   C'0'                USED TO CLEAR EBCDIC ZONES           09800002
BINLAST  EQU   C'9'                LAST BIN NUMBER                      09850002
         EJECT                                                          09900002
*********************************************************************** 09950002
*                                                                     * 10000002
*     CONSTANTS                                                       * 10050002
*                                                                     * 10100002
*********************************************************************** 10150002
H4000    DC    H'4096'             REGION SIZE - 4K                     10200002
PUB      DC    C' PUB'             PUBLIC CELL                          10250002
PRIV     DC    C'PRIV'             PRIVATE CELL                         10300002
STRG     DC    C'STRG'             STORAGE CELL                         10350002
REMOVE   DC    C'/REMOV'           REMOVEABLE CELL                      10400002
RESDNT   DC    C'/RSDNT'           RESIDENT CELL                        10450002
RESERV   DC    C'/RSERV'           RESERVED CELL                        10500002
ONLINE   DC    C'O'                ONLINE DEVICE                        10550002
OFFLIN   DC    C'OFFLINE'          OFFLINE DEVICE                       10600002
ALLOC    DC    C'A'                ALLOCATED DEVICE                     10650002
MOUNT    DC    C'-MTP'             MOUNT REQUEST OUTSTANDING            10700002
*                                  THE FOLLOWING BIN NUMBERS ARE A      10750002
*                                  TABLE. DO NOT DISTURB THE ORDER.     10800002
BIN0     DC    C'0'                BIN NUMBER ZERO                      10850002
B1       DC    C'1'                BIN NUMBER ONE                       10900002
B2       DC    C'2'                BIN NUMBER TWO                       10950002
B3       DC    C'3'                BIN NUMBER THREE                     11000002
B4       DC    C'4'                BIN NUMBER FOUR                      11050002
B5       DC    C'5'                BIN NUMBER FIVE                      11100002
B6       DC    C'6'                BIN NUMBER SIX                       11150002
B7       DC    C'7'                BIN NUMBER SEVEN                     11200002
B8       DC    C'8'                BIN NUMBER EIGHT                     11250002
B9       DC    C'9'                BIN NUMBER NINE                      11300002
DCODE    DC    XL4'01000000'       DESCRIPTOR CODE 5                    11350002
RETRNAME DC    C'IGC00110'         FIRST LOAD SVC 110                   11400002
         EJECT                                                          11450002
*********************************************************************** 11500002
*                                                                     * 11550002
*     MESSAGES                                                        * 11600002
*                                                                     * 11650002
*********************************************************************** 11700002
MSG0A    DC    C'IEE931I INSUFFICIENT STORAGE FOR D U'        MH Y01044 11750002
MSG0ND   EQU   *                                                        11800002
MSG0LN   EQU   MSG0ND-MSG0A       MESSAGE LENGTH                        11850002
MSG1A    DC    C'IEE455I UNIT STATUS NO DEVICES WITH REQUESTED ATTRIBUTX11900002
               ES'                ERROR MESSAGE 1                       11950002
MSG1AEND EQU   *                   END OF MSG1A                         12000002
MSG1ALGN EQU   MSG1AEND-MSG1A      LENGTH OF MSG1A                      12050002
MSG3A    DC    C'IEE453I UNIT STATUS INVALID OPERAND RE-ENTER'    ERROR 12100002
MSG3AEND EQU   *                   END OF MSG3A                         12150002
MSG3ALGN EQU   MSG3AEND-MSG3A      LENGTH OF MSG3A                      12200002
         EJECT                                                          12400002
*********************************************************************** 12450002
*                                                                     * 12500002
*     DSECTS                                                          * 12550002
*                                                                     * 12600002
*********************************************************************** 12650002
CSCB     DSECT                                                          12700002
         IEECHAIN                                                       12750002
CSCBL    EQU   CHLAST-CHAIN        LENGTH OF CSCB                       12800002
         ORG   CHAIN+L32                                                12850002
         IEEXSA                                                         12900002
         ORG   XSA+L24                                           A36165 12950002
WORKING  DS    5F                  WORKING STORAGE                      13000002
DEVNOLN  EQU   WORKING+L8          NUMBER OF DEVICES PER LINE           13050002
DEVSPRE  EQU   DEVNOLN+L2          NUMBER OF DEVICES DISPLAYED          13100002
LASTUCB  EQU   DEVSPRE+L3          STARTING UCB ADDRESS/BIN NUMBER      13150002
FROMID   EQU   LASTUCB+L4          REQUESTING CONSOLE ID                13200002
SAVE     DS    21F                 SAVE AREA BETWEEN MODULES            13250002
         ORG   SAVE+L12                                                 13300002
PACKWORD DS    F                   WORD USED FOR PACKING                13350002
CVBWORD  DS    F                   WORD USED FOR CONVERSION TO BINARY   13400002
         EJECT                                                          13450002
UCB      DSECT                                                          13500002
         IEFUCBOB                                                       13550002
         EJECT                                                          13600002
         EJECT                                                          13650002
         SPACE 2                                                        13700002
WORKAREA DSECT                                                          13750002
         SPACE 2                                                        13800002
         DS    0D                                                       13850002
UCBADDRA DS    7H                  STORAGE FOR UCB ADDRESSES            13900002
UCBADDRB DS    H                   FOUND BY UNIT4                       13950002
SWORD    DS    0F                  SAVE AREA ACROSS MODULES             14000002
SWORD1   DS    F                   SAVE AREA POINTER (R13)              14050002
SWORD2   DS    F                   RETURN ADDRESS (R14)                 14100002
SWORD3   DS    F                   DEVICE NAME TABLE ADDRESS            14150002
UNIT1    DS    F                   HOLD ADDRESS ONE                     14200002
UNIT2    DS    F                   HOLD ADDRESS TWO                     14250002
UNIT3    DS    F                   HOLD ADDRESS THREE                   14300002
         SPACE 4                                                        14350002
FLAG2    DC    X'00'               COMMUNICATIONS BYTE                  14400002
ONLINS   EQU   128                 DISPLAY ONLINE DEVICES               14450002
OFFLNS   EQU   64                  DISPLAY OFFLINE DEVICES              14500002
ALLS     EQU   32                  DISPLAY OFFLINE + ONLINE DEVICES     14550002
SUFEXIST EQU   16                  REQUESTING CONSOLE IS A CRT DEVICE   14600002
SINGLE   EQU   8                   SINGLE DEVICE REQUEST                14650002
COREGOT  EQU   4                   CORE GOTTEN FOR DEVICE NAME TABLE    14700002
OPEN22   EQU   2                   OPEN FLAG                            14750002
R13UCBNM EQU   1                   FLAG FOR COMPSET ROUTINE             14800002
         SPACE 2                                                        14850002
FLAG3    DC    X'00'               COMMUNICATIONS FLAGS                 14900002
U2       EQU   128                TELL UNIT2 ENTRY FOR SCAN OF CDES     14950002
UNIT3RET EQU   64                  IEE22110 RETURNING TO IEE21110       15000002
OPEN332  EQU   32                  OPEN FLAG                            15050002
DEVDEF   EQU   16                  DEVICE ADDRESS DEFAULTED             15100002
HEADOUTF EQU   8                   HEADING AND LABELS ARE OUT           15150002
OPEN34   EQU   4                   OPEN FLAG                            15200002
OPEN32   EQU   2                   OPEN FLAG                            15250002
OPEN31   EQU   1                   OPEN FLAG                            15300002
         SPACE 2                                                        15350002
*  FLAG4 BYTE IS USED FOR COMMUNICATIONS BETWEEN IEEUNIT3 AND THE       15400002
*  OTHER  D UNIT  MODULES.                                              15450002
FLAG4    DC    XL1'00'             COMMUNICATIONS BYTE        MC        15500002
EXITBIT  EQU   X'00'               RETURN TO CALLER           MC        15550002
MSG1     EQU   X'04'               ISSUE MESSAGE MSG1A        MC        15600002
MSG3     EQU   X'08'               ISSUE MESSAGE MSG3A        MC        15650002
MSG4     EQU   X'0C'               ISSUE MESSAGE MSG4A        MC        15700002
         SPACE 2                                                        15900002
FLAG5    DS    XL1                                                      15950002
NODEF    EQU   X'80'               LINE DEFAULT NOT TAKEN               16000002
INITENT  EQU   X'40'               INITIAL ENTRY TO UNIT STATUS FOUR    16050002
INITUNT2 EQU   X'20'               INITIAL ENTRY TO UNIT STATUS TWO     16100002
CRTMSG2  EQU   X'10'               MSG2 WITH HEADINGS FOR DIDOCS        16150002
UN4BINLT EQU   X'08'               LASTBIN FLAG FOR UNIT4               16200002
DISPBIT  EQU   X'04'               VALID ADDRESS FOUND                  16250002
DISPEND  EQU   X'02'               END OF FRAME AND DISPLAY             16300002
OPEN51   EQU   X'01'               OPEN FLAG                            16350002
         DS    0F                  FORCE FULL WORD FOR WTO              16400002
WTOSET   DS    XL1                 ZERO                                 16450002
TEXTLEN  DS    XL1                 OUTPUT LENGTH                        16500002
LENGTH   EQU   76                  FULL LINE                            16550002
MCSONE   DS    XL1                 MCS FLAGS PART ONE                   16600002
SETONE   EQU   X'E1'                QUEUE BY ID, ROUTINE + DESCRIPTOR   16650002
*                                  CODES EXIST, COMMAND RESPONSE, QUEUE 16700002
*                                  BY ID ONLY.                          16750002
MCSTWO   DS    XL1                 MCS FLAGS PART TWO                   16800002
SETTWO   EQU   X'40'               MLWTO                                16850002
         SPACE 1                                                        16900002
MSGT     DS    0C                  BEGIN TEXT LINE                      16950002
TEXT     DS    XL72                TEXT FIELD                           17000002
         ORG   TEXT                                                     17050002
TITLEID  DS    XL8                 MESSAGE ID                           17100002
TITLEDGH DS    XL3                 HOURS.                               17150002
TITLEDGM DS    XL3                 MINUTES.                             17200002
TITLEDGS DS    XL2                 SECONDS                              17250002
TITLENM  DS    XL11                DISPLAY NAME                         17300002
         ORG   TEXT                                                     17350002
UCBN1    DS    XL5                 UNIT ADDRESS                         17400002
MODL1    DS    XL5                 DEVICE TYPE                          17450002
USTAT1   DS    XL1                 STATUS (O,A,S,C,OFFLINE)             17500002
USTAT2   DS    XL4                 STATUS (-BSY,-MTP,-NRD)              17550002
USTAT3   DS    XL3                 STATUS (-R)                          17600002
VOLID1   DS    XL7                 VOLUME SERIAL NUMBER                 17650002
VOST1A   DS    XL4                 VOLUME STATE (PUB,PRIV,STRG)         17700002
VOST1B   DS    XL6                 VOLUME STATE (-REMOV,-RSDNT,-RSERV)  17750002
         ORG   TEXT+72            ORG FOR WTO TAIL                      17800002
         SPACE 2                                                        17850002
DESCODE  DS    XL2                 DESCRIPTOR CODES                     17900002
RTECODE  DS    XL2                 ROUTING CODES                        17950002
TYPEFLAG DS    XL2                 MESSAGE TYPES                        18000002
AID      DS    XL1                AREA ID FIELD                         18050002
LNUM     DS    XL1                NUMBER OF LINES                       18100002
         SPACE 2                                                        18150002
HOLD2    DS    F                                                        18200002
NODEVICS DS    H                   NUMBER OF UNITS REQUESTED            18250002
NODEVDEF EQU   100                 DEFAULT                              18300002
         SPACE 4                                                        18350002
*  FLAG1 BYTE IS SET BY IEEUNIT1 TO REFLECT THE DEVICE TYPE(S)          18400002
*  REQUESTED BY THE D U  COMMAND.  THE BITS SET CORRESPOND TO THE BIT   18450002
*  SETTINGS IN BYTE 3 OF THE UCBTYP FIELD.                              18500002
         SPACE 2                                                        18550002
FLAG1    DC    X'00'               FLAG1 FIELD                          18600002
TATYPE   EQU   UCB3TAPE           TAPE DEVICES                          18650002
TPTYPE   EQU   UCB3COMM           TELECOMMUNICATIONS DEVICES            18700002
DATYPE   EQU   UCB3DACC           DIRECT ACCESS DEVICES                 18750002
GRTYPE   EQU   UCB3DISP            GRAPHIC DISPLAY DEVICES              18800002
URTYPE   EQU   UCB3UREC+UCB3CHAR        UNIT RECORD + CHAR RDR DEVICES  18850002
ALLTYPE  EQU   TATYPE+TPTYPE+DATYPE+GRTYPE+URTYPE     ALLDEVICE TYPES   18900002
         SPACE 2                                                        18950002
IDFLD    DS    XL1                AREA ID SAVE AREA                     19000002
WEND     EQU   *                   END OF WORK AREA                     19050002
WAL      EQU   WEND-WORKAREA       LENGTH OF WORK AREA                  19100002
      END                                                               19150002
./  ADD  SSI=73010241,NAME=IEE23110
         TITLE 'IEE23110  UNIT STATUS FOUR, PART OF SVC 110'            00050000
IEE23110 CSECT                                                          00100000
*********************************************************************** 00200000
*                                                                     * 00250000
* STATUS                                                              * 00300000
*    CHANGE LEVEL=0  VS 2 RELEASE 3                                     00350000
*                                                                       00360003
*  PTMS FIXED  @ZM30152,@ZM32568                                        00370033
*                                                                     * 00400000
* FUNCTION                                                            * 00450000
*    FIND VALID UCB'S TO SCAN                                         * 00500000
*    WRITE COMPLETED DISPLAY LINES                                    * 00550000
*                                                                     * 00600000
* ENTRY POINTS                                                        * 00650000
*         IEE23110                                                    * 00700000
*                                                                     * 00750000
* INPUT                                                               * 00800000
*    REG 11 CONTAINS THE CSCB ADDRESS WHICH CONTAINS ALL OTHER PTRS   * 00850000
*    REG 9  CONTAINS THE UCB ADDRESS FOUND BY IEE20110                X 00900000
*                                                                     * 00950000
* OUTPUT                                                              * 01000000
*    DISPLAY LINES ISSUED TO CONSOLE SUPPORT                          * 01050000
*                                                                     * 01100000
* EXTERNAL REFERENCES                                                 * 01150000
*         SVC 11   (TIME)                                               01200000
*         SVC 35   (WTO)                                              * 01250000
*                                                                     * 01300000
* EXITS,NORMAL                                                        * 01350000
*         IEE21110 TO BUILD DEVICE ENTRIES IN DISPLAY LINE            * 01400000
*         IEE22110 TO BUILD DATA CELL BIN ENTRIES IN DISPLAY LINE     * 01450000
*         IEE22110 TO RETURN WHEN DISPLAY COMPLETE                    * 01500000
*                                                                     * 01550000
* EXITS,ERROR                                                         * 01600000
*         IEE22110 TO ISSUE ERROR MESSAGES                            * 01650000
*                                                                     * 01700000
* TABLES/WORKAREAS                                                    * 01750000
*    CSCB                                                             * 01800000
*    XSA                                                              * 01850000
*    UCB                                                              * 01900000
*    WORKAREA                                                         * 01950000
*    CVT                                                              * 02000000
*                                                                     * 02050000
* ATTRIBUTES                                                          * 02100000
*    TYPE IV SVC, PRIVILEGED, RE-ENTRANT                         A36790 02150000
*                                                                     * 02200000
* CHARACTER CODE DEPENDENCY                                           * 02250000
*    NONE                                                             * 02300000
*                                                                     * 02350000
* NOTES                                                               * 02400000
*    NONE                                                             * 02450000
*                                                                     * 02500000
*********************************************************************** 02550000
         EJECT                                                          02600000
*/*IEE23110: CHART */                                                   02650000
*/*IEE23110: E IEE23110 */                                              02700000
*/* P ESTABLISH ADDRESSABILITY */                                       02750000
*/* D (NO,,YES,WTORTN) PUT OUT DATA CELL WTO ? */                       02800000
*/* D (NO,WTORTN,YES,) INITIAL ENTRY ? */                               02850000
*/* P TURN OFF INITIAL ENTRY FLAG */                                    02900000
*/* P CLEAR ADDRESS TABLE */                                            02950000
*/*NEWLINE: P POINT TO EBCDIC ADDRESS */                                03000000
*/* S COMPSET:GO CONVERT ADDRESS */                                     03050000
*/* P POINT TO UCB ADDRESS TABLE */                                     03100000
*/*DUMBHI: P DUMMY UP HIGH VALUE */                                     03150000
*/*VALIDCHK: D (NO,GETNEXT,YES,) CORRECT UCB TYPE ? */                  03200000
*/* D (NO,,YES,STORADDR) ALL STATUS WANTED ? */                         03250000
*/* D (NO,,YES,ONLINE) ONLINE REQUEST ? */                              03300000
*/* D (NO,STORADDR,YES,GETNEXT) IS DEVICE ONLINE OR ALLOC ? */  SA52720 03350016
*/**ONLINE: D (NO,,YES,STORADDR) IS DEVICE ONLINE ? */                  03400016
*/*GETNEXT: D (NO,BUMP,YES,EXMSG1) SINGLE DEVICE REQUEST ? */           03450000
*/*STORADDR: P INDICATE UCB FOUND */                                    03500000
*/* P HOLD POINTER TO CURRENT HIGH UCB */                               03550000
*/* P (,BUMP) HOLD CONVERTED ADDRESS */                                 03600000
*/*LOOP: P GET UCB ADDR FROM LOOK UP TABLE */                           03650000
*/* D (NO,UCB,YES,EOL) END OF TABLE ? */                                03700000
*/*BUMP: P (,LOOP) POINT TO NEXT UCB ADDRESS */                         03750000
*/*UCB: P LOCATE EBCDIC ADDR VALUE */                                   03800000
*/* S COMPSET:GO CONVERT ADDR */                                        03850000
*/* D (NO,,YES,BUMP) NEW LOWER THAN OLD LOW ? */                        03900000
*/* D (NO,VALIDCHK,YES,BUMP) HIGHER THAN OLD HIGH ? */                  03950000
*/*EOL: D (NO,NOADDR,YES,) ANY NEW HIGH STORED? */                      04000000
*/* P PUT HIGH VALUE INTO LOW */                                        04050000
*/* P RESET UCB FOUND BIT */                                            04100000
*/* D (NO,,YES,ENDSCN) NUM UCBS FOUND = NUM WANTED */                   04150000
*/*GETONE: P POINT TO UCB LOOK UP TABLE */                              04200000
*/* D (NO,LOOP,YES,) ENOUGH TO FILL ONE LINE ? */                       04250000
*/*EXIT: P SET EXIT TO IGC22110 */                                      04300000
*/* D (NO,XCTL,YES,) FINISH DATA CELL ? */                              04350000
*/* P (,EXUN3) POINT TO FIRST UCB ADDRESS */                            04400000
*/*NOADDR: D (NO,EXMSG1,YES,) ANY DISPLAY OUTPUT ? */                   04450000
*/* D (NO,SETND,YES,) LINE DEFAULT NOT TAKEN ? */                       04500000
*/* P (,SETND) TELL UNIT 3 TO PUT OUT MESSAGE */                        04550000
*/*ENDSCN: D (NO,,YES,EXIT) ENOUGH UNITS TO FILL LINE ? */              04600000
*/*SETND: P (,EXIT) TURN ON DISPLAY ENDED FLAG */                       04650000
*/*COMPSET: E COMPSET */                                                04700000
*/* P PREPARE TO LOOP THRU NUMBER */                                    04750000
*/*COMPSET2: D (NO,,YES,COMPSET5) IS THIS DIGIT NUMERIC ? */            04800000
*/* P ADD NINE (9) TO DIGIT */                                          04850000
*/*COMPSET3: P HOLD RESULTING DIGIT OF ZONE/DIGIT */                    04900000
*/* D (NO,COMPSET2,YES,) DONE THREE DIGITS ? */                         04950000
*/*COMPSET4: R BR 14 */                                                 05000000
*/*COMPSET5: P (,COMPSET3) HOLD DIGIT */                                05050000
*/*WTORTN: P PREPARE WTO PARM LIST */                                   05100000
*/* D (NO,,YES,SKIPHEAD) HAVE HEADINGS BEEN WRITTEN  ? */               05150000
*/* P INDICATE HEADINGS WRITTEN */                                      05200000
*/* P SAVE DEVICE OUTPUT AND BUILD HEADING */                           05250000
*/* S TIME SVC 11: GET TIME OF DAY */                                   05300000
*/*TIME: P CONVERT TIME FOR PRINT AND PUT IN MSG */                     05350000
*/* S WTO RTN:GO ISSUE HEADING LINE */                                  05400000
*/* P PICK UP NUMBER OF DEVICES PER LINE */                             05450000
*/* D (NO,CONT,YES,) OFFLINE DISPLAY ? */                               05500000
*/* P USE OFFLINE LABELS IN LABEL LINE */                               05550000
*/*CONT: P DECREMENT LABEL LENGTH */                                    05600000
*/*LABLOOP: P PICK UP FIRST ENTRY IN LINE */                            05650000
*/* D (NO,LABEND,YES,) ANY MORE ENTRIES ? */                            05700000
*/* P PUT CORRECT LABEL IN LINE */                                      05750000
*/* D (NO,LABLOOP,YES,) ALL REQUIRED LABELS IN LINE ? */                05800000
*/*LABEND: D (NO,LABENDMV,YES,) REQUEST FOR SINGLE DEVICE ? */          05850000
*/* D (NO,LABENDMV,YES,) 2321 DATA CELL ? */                            05900000
*/* P MOVE IN SECOND HALF LABEL LINE */                                 05950000
*/*LABENDMV: S WTORTN:GO ISSUE LABEL LINE */                            06000000
*/* P (,WTORTN) RESTORE DEVICE TEXT OUTPUT */                           06050000
*/*SKIPHEAD: P SET LINE TYPE TO DATA */                                 06100000
*/* D (NO,,YES,MSGOUT) DATA CELL IN PROCESS */                          06150000
*/* D (NO,,YES,SKIPFR) IS THIS END OF DISPLAY ? */                      06200000
*/* S WTO RTN: GO ISSUE DATA LINE */                                    06250000
*/* D (NO,NEWLINE,YES,) IS DATA CELL COMPLETE? */                       06300000
*/* P (,GETONE) UP DEVICE DONE COUNT BY 2 */                            06350000
*/*SKIPFR: D (NO,OSU,YES,) WAS LAST LINE AN END LINE ? */               06400000
*/* S WTO RTN:GO WRITE MESSAGE */                                       06450000
*/* P MOVE MSG TEXT INTO WTO PARM LIST */                               06500000
*/*OSU: P SET LINETYPE = DATA END */                                    06550000
*/* S WTO RTN:GO OUTPUT MESSAGE */                                      06600000
*/*EXIT3: P (,EXUN3A) SET EXIT TO IGC22110 */                           06650000
*/*MSGOUT: S WTO RTN: GO OUTPUT MESSAGE */                              06700000
*/*EXUN3: P INDICATE FINISH DATA CELL */                                06750000
*/*EXUN3A: P PUT EXIT NAME (IGC22110) IN XCTL LIST */                   06800000
*/*XCTL: R IGC22110 */                                                  06850000
*/*WTO: E WTO RTN */                                                    06900000
*/*WTOLOOP: P FIND END OF MESSAGE TEXT */                               06950000
*/*HITEXT: P TAG DESCRIPTOR CODES ON END OF MESSAGE */                  07000000
*/* P COMPUTE AND PUT LENGTH INTO WTO LIST */                           07050000
*/* S WTO SVC 35:OUTPUT MESSAGE TO OPERATOR */                          07100000
*/* P SAVE CONSOLE ID AND MESSAGE NUMBER */                             07150000
*/* P CLEAR TEXT LINE */                                                07200000
*/* R BR 14 */                                                          07250000
*/*EXMSG1: P (,EXUN3A) INDICATE MESSAGE FOR UNIT 3 TO WRITE */          07300000
*/*IEE23110: END */                                                     07350000
         EJECT                                                          07400000
         BALR  PBASE,R0            ESTABLISH BASE REGISTER              07450000
         USING *,PBASE             DECLARE PROGRAM BASE                 07500000
         B     ICATCH              BRANCH AROUND EYECATCHER   MB YM1902 07510000
         DC    C'01 MODULE IGC23110, FICHE IEE23110  '        MB YM1902 07520000
         DC    XL2'4211'           JULIAN DATE OF LAST CHANGE           07522000
         DC    CL8'&SYSDATE'       DATE OF LAST ASSEMBLY                07524000
         DC    S(*)                                                     07526000
ZAPAREA  DC    12C'ZAP'  RESERVED FOR FIELD MODIFICATION      MB YM1902 07530000
ICATCH   EQU   *                                              MB YM1902 07540000
         USING XSASET,XSABASE      DECLARE XSA BASE                     07550000
         L     WBASE,XAL           POINT TO WORK AREA                   07600000
         USING WORKAREA,WBASE      DECLARE WORK AREA BASE               07650000
         LH    R13,DEVSPRE         GET NUMBER ALREADY PUT OUT           07700000
         TM    FLAG5,INITENT       INITIAL ENTRY TO SET UP UCB TABLE    07750000
         BNO   WTORTN              NO ISSUE NORMAL WTO AND UPDATE TABLE 07800000
         SPACE 2                                                        07850000
*********************************************************************** 07900000
*                                                                     * 07950000
*  BUILD LIST OF VALID UCB ADDRESSES                                  * 08000000
*                                                                     * 08050000
*********************************************************************** 08100000
         NI    FLAG5,N255-INITENT   TURNOFF INITIAL ENTRY FLAG          08150000
         XC    UCBADDRA+N2(N12),UCBADDRA+N2 CLEAR TABLE                 08200000
         LR    R7,R9               GET STARTING UCB ADDRESS             08250000
NEWLINE  EQU   *                                                        08300000
         STH   R7,CURRENT         PUT VALUE INTO CURRENT WORD           08350000
         LA    R15,N13(R7)        GET PTR TO EBCICIC ADDRESS            08400000
         BAL   RETURN,COMPSET     GO CONVERT IT                         08450000
         ST    R8,LOW             SAVE CONVERTED VALUE                  08500000
         LH    ADDRPT,DEVNOLN      GET NUMBER OF DEVICES FOR LINE       08550000
         LA    ADDRPT,N1(ADDRPT)   KICK UP ADDRESS BY ONE               08600000
         LA    ADDR,UCBADDRA       POINT TO UCB ADDRESS TABLE           08650000
         LA    R3,CVT              POINT TO CVT ADDRESS                 08700000
         L     R3,ZERO(R3)         GET CVT ADDRESS                      08750000
         USING CVTDSECT,R3                                              08800000
         L     R3,CVTILK2         GET LOOK-UP TABLE ADDRESS             08850000
DUMBHI   EQU   *                                                        08900000
         MVI   HIGH+N2,N255       DUMMY UP HIGH VALUE                   08950000
VALIDCHK EQU   *                                                        09000000
         USING UCBDSECT,UCBADDR    DECLARE UCB ADDRESS                  09050000
         SR    WORK,WORK           CLEAR REGISTER                       09100000
         IC    WORK,UCBTBYT3       GET UCB TYPE                         09150000
         LA    POINT,FLAG1         POINT TO RIGHT FLAG BYTE             09200000
         CLI   UCBTBYT3,CTCTYPE    CHANNEL-CHANNEL ADAPTOR  JE @ZM32568 09210033
         BE    TSTFLG2             YES, GO TEST FLAG2       JE @ZM32568 09230033
         EX    WORK,TESTMASK       CHECK TYPE                           09250000
         BNO   BUMP                NO MATCH GET NEXT UCB      MH Y01043 09300032
TSTFLG2  TM    FLAG2,ALLS          ALL STATUS WANTED        JE @ZM32568 09350033
         BO    STORADDR            YES SAVE THIS ADDRESS                09400000
         TM    FLAG2,ONLINS        ONLINE REQUEST                       09450000
         BO    ONLINE              YES TEST UCB ONLINE                  09500000
*                                 NO, ASSUME OFFLINE REQUEST ME SA52720 09510016
         TM    SRTESTAT,SRTEONLI+SRTEALOC  IS DEVICE         ME SA52720 09550016
*                                  ONLINE OR ALLOCATED       ME SA52720 09560016
         BZ    STORADDR            NEITHER, MUST BE OFFLINE  ME SA52720 09600016
         B     BUMP                GET NEXT DEVICE           MH Y010430 09650032
ONLINE   EQU   *                                                        09800000
         TM    SRTESTAT,ONLINS     IS DEVICE ONLINE                     09850000
         BO    STORADDR            YES STORE ADDRESS                    09900000
         B     BUMP                 NOT ONLINE, BRANCH        MH Y01043 09950032
STORADDR EQU   *                                                        10150000
         OI    FLAG5,DISPBIT       TURN ON UCB FOUND BIT                10200000
         STH   R7,CURRENT          STORE POINTER TO CURRENT HIGH UCB    10250000
         ST    R8,HIGH             STORE CONVERTED DEVICE ADDRESS       10300000
         B     BUMP                GO GET ANOTHER                       10350000
LOOP     EQU   *                                                        10400000
         SR    R7,R7                   CLEAR REGISTER         JE YM6838 10410000
         ICM   R7,3,NO(R3)          GET UCB POINTER           JE YM6838 10420000
         BZ    BUMP                BRANCH IF ADDRESS NULL     JE YM6838 10422000
         CLM   R7,3,FOXFOX          END OF UCB TABLE           @Z30AAJE 10430000
         BE    EOL                 YES                        JE YM6838 10440000
         B     UCB                 GO LOOK AT UCB              @Z30AAJE 10490000
BUMP     EQU   *                   FALL THROUGH ON ZERO                 10650000
         LA    R3,N2(R3)          BUMP POINTER TO THE NEXT ADDRESS      10700000
         B     LOOP                  BY TWO AND GO TO GET NEXT          10750000
UCB      EQU   *                                                        10800000
         LA    R15,UCBNAME         POINT TO EBCIDIC ADDRESS VALUE       10850000
         BAL   RETURN,COMPSET      CONVERT ADDRESS FOUND BY 'LOOP'      10900000
         STC   R8,UNITADDA             STORE CONVERTED ADDRESSMH Y02139 10910003
         NI    UNITADDA,ZEROFOX        ZERO SUBCHANNEL PORTIONMH Y02139 10920003
         MVC   UNITADDB(L1),UCBUA      STORE HEX ADDRESS      MH Y02139 10922003
         NI    UNITADDB,ZEROFOX        ZERO SUBCHANNEL PORTIONMH Y02139 10924003
         CLC   UNITADDA(L1),UNITADDB   COMPARE ADDRESS        MH Y02139 10926003
         BNE   BUMP                NOT EQUAL, NOT BASE UCB    MG YM3885 10930000
         CL    R8,LOW              COMPARE AGAINST LOW VALUE            10950000
         BNH   BUMP                IF NEW VALUE LOW BRANCH              11000000
         CL    R8,HIGH             COMPARE AGAINST HIGH VALUE           11050000
         BH    BUMP                NEW VALUE HIGHER THAN OLD HIGH       11100000
         B     VALIDCHK           GO TO VALIDITY CHECK ROUTINE          11150000
EOL      EQU   *                                                        11200000
         CH    R13,NODEVICS        REQUEST SATISFIED          MG YM1826 11310000
         BNL   SETND               YES, HAVE ENOUGH           MG YM1826 11320000
         TM    FLAG5,DISPBIT       ANY UCB FOUND THIS PASS    MG YM1826 11330000
         BNO   NOADDR              NO, ALL HAVE BEEN FOUND    MG YM1826 11340000
         MVC   LOW+N2(L2),HIGH+N2     PUT HIGH VALUE INTO LOW           11350000
         MVC   NO(L2,ADDR),CURRENT MOVE UCB POINTER INTO SAVE LIST      11400000
         MVC   UCBADDRB(L4),CURRENT     SAVE LAST VALUE FOUND           11450000
         LA    ADDR,N2(ADDR)      BUMP POINTER                          11500000
         LA    R13,N1(R13)         BUMP NUMBER FOUND BY 1               11550000
         NI    FLAG5,N255-DISPBIT      TURN OFF UCB FOUND BIT           11600000
GETONE   EQU   *                                                        11750000
         LA    R3,CVT              POINT TO CVT ADDRESS                 11800000
         L     R3,ZERO(R3)         GET CVT ADDRESS                      11850000
         L     R3,CVTILK2         GET LOOKUP POINTER                    11900000
         MVI   HIGH+N2,N255       DUMMY UP HIGH UCB                     11950000
         BCT   ADDRPT,LOOP        COUNT NUMBER IN LINE                  12000000
EXIT     EQU   *                                                        12050000
         MVI   XAX+L4,F1           SECOND LOAD NAME                     12100000
         B     XCTL                EXIT                                 12150000
NOADDR   EQU   *                                                        12200000
         LTR   R13,R13             ANY DISPLAY                          12250000
         BZ    EXMSG1              ISSUE MESSAGE                        12300000
         TM    FLAG5,NODEF        TEST FOR DEFAULT                      12350000
         BNO   SETND              BRANCH TO SET END FLAG                12400000
         OI    FLAG5,CRTMSG2      TURN ON MESSAGE BIT FOR U3            12450000
SETND    EQU   *                                                        12700000
         OI    FLAG5,DISPEND      TURN ON DISPLAY FINISHED              12750000
         B     EXIT                BUILD LINE                           12800000
         SPACE 2                                                        12850000
*********************************************************************** 12900000
*                                                                     * 12950000
*  THIS ROUTINE CHANGES EBCDIC DEVICES TO BINARY.                     * 13000000
*  REG 15 POINTS TO THE NUMBER TO BE CONVERTED.                       * 13050000
*  THE CONVERTED NUMBER IS RETURNED IN REG 8.                         * 13100000
*  RETURN IS VIA BR 14.                                               * 13150000
*  REGS 8,9,4 AND 15 ARE DESTROYED                                    * 13200000
*                                                                     * 13250000
*********************************************************************** 13300000
COMPSET  EQU   *                                                        13350000
         SR    WORK,WORK          ZERO REGISTER                         13400000
         LA    WORK,L3(WORK)      INITIALIZE COUNTER                    13450000
         SR    TEXTPTR,TEXTPTR     CLEAR WORK REF                       13500000
COMPSET2 EQU   *                                                        13550000
         SR    R9,R9               CLEAR WORK REG                       13600000
         TM    N0(R15),F0          THIS DIGIT NUMERIC                   13650000
         BO    COMPSET5            YES HANDLE                           13700000
         IC    R9,N0(R15)          ISOLATE DIGIT                        13750000
         LA    R9,N9(R9)           UP BY NINE                           13800000
COMPSET3 EQU   *                                                        13850000
         SLL   R9,N28              SHIFT DIGIT TO                       13900000
         SLDL  TEXTPTR,N4          LOW ORDER NIBBLE OF REG 8            13950000
         LA    R15,N1(R15)         POINT TO NEXT DIGIT                  14000000
         BCT   WORK,COMPSET2           DO ALL DIGITS                    14050000
COMPSET4 EQU   *                                                        14100000
         BR    RETURN              RETURN TO CALLER                     14150000
COMPSET5 EQU   *                                                        14200000
         IC    R9,N0(R15)          ISOLATE CHARACTER                    14250000
         B     COMPSET3            CONVERT IT                           14300000
         SPACE 2                                                        14350000
*********************************************************************** 14400000
*                                                                     * 14450000
*  ISSUE WTO ON THE COMPLETED DISPLAY LINES                           * 14500000
*                                                                     * 14550000
*********************************************************************** 14600000
WTORTN   EQU   *                                                        14650000
         MVC   DESCODE(L4),DCODE   MOVE WTO TAIL                        14700000
         MVC   AID(L1),IDFLD      MOVE IN AREA ID                       14750000
         MVI   MCSONE,SETONE      SET FIRST BIT OF MCS FIELD            14800000
         MVI   MCSTWO,SETTWO      SET SECOND BIT OF MCS FLAGS           14850000
         MVI   LNUM,L1             RE/SET LINES IN LIST                 14900000
         MVI   TYPEFLAG+N1,ZERO    ZERO OUT LINE TYPE BYTE 2            14950000
         TM    FLAG3,HEADOUTF      Q.  HAVE HEADING LINE BEEN WRITTEN   15000000
         BO    SKIPHEAD            A. YES SKIP THEM                     15050000
         OI    FLAG3,HEADOUTF      INDICATE HEADING LINES OUT           15100000
         MVC   SAVE+N12(N72),TEXT  SAVE LINE BUILT BY IEEUNIT2/IEEUNIT3 15150000
         MVI   TEXT,BLANK          BLANK TEXT                           15200000
         MVC   TEXT+N1(L71),TEXT   LINE OUT                             15250000
         MVC   TEXT(HEADLGN),HEAD       MOVE HEADING INTO TEXT          15300000
         TIME  DEC                                                      15350000
TIME     EQU   *                                                        15400000
         ST    R0,WORKING          HOLD TIME                            15450000
         UNPK  WORKING(N8),WORKING(N4)   UNPACK TIME FOR PRINT          15500000
         MVC   TITLEDGH(N2),WORKING+N1      HH                          15550000
         MVC   TITLEDGM(N2),WORKING+N3      HH.MM                       15600000
         MVC   TITLEDGS(N2),WORKING+N5      HH.MM.SS                    15650000
         MVI   TYPEFLAG,ATE        SET CONTROL LINE TYPE                15700000
         BAL   RETURN,WTO          ISSUE WTO FOR HEADIND                15750000
         LH    WORK,DEVNOLN        GET NO. OF DEVICES PER LINE          15800000
         LA    TEXTPTR,TEXT        POINT TO TEXT LINE                   15850000
         LA    R15,UCBADDRA        POINT TO UCB ADDRESS LIST            15900000
         SR    POINT,POINT         ZERO REGISTER                        15950000
         LA    SCRATCH,LABELA      POINT TO CORRECT LABEL               16000000
         LA    POINT,LABALGN(POINT)     LENGTH OF LABEL FOR MOVE        16050000
         MVC   WORKING(N2),ONLGN   TEXT INCREMENT                       16100000
         TM    FLAG2,OFFLNS       TEST FOR OFFLINE                      16150000
         BNO   CONT               BRANCH IF NOT                         16200000
         LA    R5,LABOLGN         SET UP FOR OFFLINE DISPLAY            16250000
         MVC   WORKING(N2),OFFLGN      SET FOR OFFLGN HEADDER SPACING   16300000
CONT     EQU   *                                                        16350000
         BCTR  POINT,R0            DECREMENT LENGTH OF LABEL BY ONE     16400000
LABLOOP  EQU   *                                                        16450000
         LH    ADDR,N0(R15)        PICK UP UCB ADDRESS                  16500000
         N     ADDR,FOXAND         CLEAR HI ORDER 2 BYTES      @Z30AAJE 16510003
*                                                              @ZM30152 16520003
         LTR   ADDR,ADDR           Q. ZERO POINTER                      16550000
         BZ    LABEND              YES ISSUE LABEL LINE                 16600000
         EX    POINT,LABMOVE       PUT CORRECT LABEL IN LINE            16650000
         AH    TEXTPTR,WORKING     NO INCREMENT  TEXT POINTER           16700000
         LA    R15,N2(R15)         UP TO NEXT ENTRY IN LIST             16750000
         BCT   WORK,LABLOOP        DO ALL LABELS REQUIRED               16800000
LABEND   EQU   *                                                        16850000
         TM    FLAG2,SINGLE        SINGLE REQUEST                A35057 16900000
         BNO   LABENDMV            NO SKIP REQUEST               A35057 16950000
         TM    FLAG3,UNIT3RET      IF UNIT3 THEN SINGLE 2321 WHICH      17000000
         BNO   LABENDMV            REQUIRES A FULL LABEL, ELSE HALF.    17050000
         EX    POINT,LABMOVE       MOVE SECOND HALF OF LABEL LINE       17100000
LABENDMV EQU   *                                                        17150000
         MVI   TYPEFLAG,FORE       SET LABEL LINE TYPE                  17200000
         BAL   RETURN,WTO          WRITE LABEL LINE                     17250000
         MVC   TEXT(N72),SAVE+N12       RESTORE TEXT LINE               17300000
         B     WTORTN              RE-INITIALIZE WTO TAIL               17350000
SKIPHEAD EQU   *                                                        17400000
         MVI   TYPEFLAG,TWO        SET DATA LINE TYPE                   17450000
         TM    FLAG5,DISPEND       IS THIS END OF DISPLAY               17600000
         BO    SKIPFR              YES, ISSUE WTO AND EXIT              17650000
         BAL   RETURN,WTO          NO PUT OUT TEXT LINE                 17700000
         XC    UCBADDRA(N14),UCBADDRA  CLEAR TABLE                      17750000
         LH    UCBADDR,UCBADDRB    GET NEXT VALID UCB                   17800000
         N     UCBADDR,FOXAND      CLEAR HI ORDER 2 BYTES      @Z30AAJE 17810003
*                                                              @ZM30152 17820003
         B     NEWLINE             START NEW LINE                       17850000
SKIPFR   EQU   *                                                        17900000
         TM    FLAG5,CRTMSG2      SEE IF LAST STATUS LINE IS END LINE   17950000
         BNO   OSU                BRANCH IF NO ERROR MSG                18000000
         CLC   TEXT(N7),MSG2A     MSG2A IN TEXT AREA          MG YM1826 18010000
         BE    OSU                YES, SET END AND WRITE IT   MG YM1826 18020000
         BAL   RETURN,WTO         GO WRITE DATA LINE                    18050000
         MVC   TEXT(MSG2ALGN),MSG2A   MOVE TEXT IN FOR MSG2             18100000
         B     WTORTN             RE-INIT WTO PARAMETERS      MG YM1826 18110000
OSU      EQU   *                                                        18150000
         MVI   TYPEFLAG,THREE      SET DATA-END LINE TYPE               18200000
         BAL   RETURN,WTO         GO WRITE MSG2                         18250000
EXIT3    EQU   *                                                        18300000
         MVI   FLAG4,EXITBIT       GO TO THIRD LOAD AND EXIT            18350000
EXUN3A   EQU   *                                                        18650000
         MVI   XAX+L4,F2           THIRD LOAD NAME                      18700000
XCTL     EQU   *                                                        18750000
         LA    R15,XSA             POINT TO  PARA  LIST                 18800000
         XCTL  SF=(E,(R15))                                             18850000
         SPACE 2                                                        18900000
*********************************************************************** 18950000
*                                                                       19000000
*  ROUTINE ISSUES SVC 35 ON COMPLETED DISPLAY LINES                     19050000
*                                                                       19100000
*********************************************************************** 19150000
WTO      EQU   *                                                        19200000
         LA    ADDRPT,TEXT+L71     POINT TO SEARCH BEGIN                19250000
WTOLOOP  EQU   *         SEARCH BACK FOR LAST TEXT CHARACTER            19300000
         CLI   ZERO(ADDRPT),BLANK   IS THIS CARACTER A BLANK            19350000
         BNE   HITEXT              NO   FOUND END - FINISH WTO          19400000
         BCT   ADDRPT,WTOLOOP      GO BACK ONE                          19450000
HITEXT   EQU   *                                                        19500000
         MVC   ONE(N8,ADDRPT),DESCODE       BACK UP TAIL TO TEXT        19550000
         LA    ADDRPT,N5(ADDRPT)   UP LENGTH FOR SEARCH AND CODES       19600000
         LA    R0,TEXT             POINT TO TEXT BEGINNING              19650000
         SR    ADDRPT,R0           FIND LENGTH OF WTO                   19700000
         STH   ADDRPT,WTOSET       STORE LENGTH IN LIST                 19750000
         L     R0,HOLD2           PUT IN AREA  CONSOLE ID AND MLWTO ID  19800000
         LA    ADDRPT,WTOSET       POINT TO WTO LIST                    19850000
         WTO   MF=(E,(1))          EXECUTE WTO LIST                     19900000
         LTR   R15,R15             TEST RETURN CODE           MC YM3872 19910000
         BNZ   EXIT3               DISPLAY CANCELLED, EXIT    MC YM3872 19920000
         SLL   R1,N8               SHIFT TO HIGH ORDER BYTES            19950000
         IC    R1,HOLD2+N3         GET CONSOLE ID                       20000000
         ST    R1,HOLD2           STORE THEM BACK                       20050000
         MVI   TEXT,BLANK          BLANK TEXT AREA                      20100000
         MVC   TEXT+L1(L71),TEXT   PROPAGATE BLANKS                     20150000
         BR    14                  EXIT TO CALLER                       20200000
         SPACE 2                                                        20300000
EXMSG1   EQU   *                                                        20350000
         MVI   FLAG4,MSG1          IEEUNIT3 - WRITE MSG1A               20400000
         B     EXUN3A              GO TO IEEUNIT3                       20450000
         EJECT                                                          20500000
*********************************************************************** 20550000
*                                                                     * 20600000
*  EXECUTED INSTRUCTIONS                                              * 20650000
*                                                                     * 20700000
*********************************************************************** 20750000
TESTMASK EQU   *                                                        20760000
         TM    N0(POINT),N0        EXECUTED TEST UNDER MASK             20770000
LABMOVE  EQU   *                                                        20800000
         MVC   ZERO(ZERO,TEXTPTR),ZERO(SCRATCH)   LABEL MOVE            20852000
COMPUNIT EQU   *                                              MG YM3885 20860000
         CLI   UCBUA,N0            COMP DEV ADDR LESS CHANNEL MG YM3885 20870000
         SPACE 2                                                        20900000
*********************************************************************** 20950000
*                                                                     * 21000000
*                             EQUATES                                 * 21050000
*                                                                     * 21100000
*********************************************************************** 21150000
R0       EQU   0                   GENERAL REGISTER NOTATION            21200000
ADDRPT   EQU   1                   *                       *            21250000
ADDR     EQU   2                   *                       *            21300000
SCRATCH  EQU   3                   *                       *            21350000
R1       EQU   1                   *                       *            21400000
R3       EQU   3                   *                       *            21450000
WORK     EQU   4                   *                       *            21500000
R5       EQU   5                   *                       *            21550000
POINT    EQU   5                   *                       *            21600000
LINEOUT  EQU   6                   *                       *            21650000
R7       EQU   7                   *                       *            21700000
UCBADDR  EQU   7                   *                       *            21750000
R8       EQU   8                   *                       *            21800000
TEXTPTR  EQU   8                   *                       *            21850000
OUTWTO   EQU   7                   *                       *            21900000
R9       EQU   9                   *                       *            21950000
WBASE    EQU   10                  *                       *            22000000
XSABASE  EQU   11                  *                       *            22050000
PBASE    EQU   12                  *                       *            22100000
R13      EQU   13                  *                       *            22150000
RETURN   EQU   14                  *                       *            22200000
R15      EQU   15                  *                       *            22250000
         SPACE 2                                                        22300000
NO       EQU   0                   LENGTHS AND DISPLACEMENTS            22350000
N0       EQU   0                   *          *            *            22400000
N1       EQU   1                   *          *            *            22450000
N2       EQU   2                   *          *            *            22500000
N3       EQU   3                   *          *            *            22550000
N4       EQU   4                   *          *            *            22600000
N5       EQU   5                   *          *            *            22650000
N6       EQU   6                   *          *            *            22700000
N7       EQU   7                   *          *            *            22750000
N8       EQU   8                   *          *            *            22800000
N9       EQU   9                   *          *            *            22850000
N12      EQU   12                  *          *            *            22900000
N13      EQU   13                  *          *            *            22950000
N14      EQU   14                  *          *            *            23000000
N28      EQU   28                  *          *            *            23050000
N72      EQU   72                  *          *            *            23100000
N255     EQU   255                 *          *            *            23150000
L1       EQU   1                   *          *            *            23200000
L3       EQU   3                   *          *            *            23250000
L4       EQU   4                   *          *            *            23300000
L2       EQU   2                   *          *            *            23350000
L8       EQU   8                   *          *            *            23400000
L12      EQU   12                  *          *            *            23450000
L24      EQU   24                  *          *            *     A36165 23500000
L32      EQU   32                  *          *            *            23550000
L71      EQU   71                  *          *            *            23600000
ATE      EQU   X'80'               CONTROL LINE                         23650000
FORE     EQU   X'40'               LABEL LINE                           23700000
THREE    EQU   X'30'               DATA END LINE                        23750000
TWO      EQU   X'20'               DATA LINE                            23800000
ZERO     EQU   0                   *          *            *            23850000
ONE      EQU   1                   *          *            *            23900000
CVT      EQU   16                  ADDRESS OF CVT POINTER               23950000
F0       EQU   C'0'                EBCDIC ZERO                          24000000
F1       EQU   C'1'                EBCDIC 1                             24050000
F2       EQU   C'2'                EBCDIC 2                             24100000
BLANK    EQU   C' '                BLANK                                24150000
ZEROFOX  EQU   X'0F'               MASK TO ZERO SUBCHANNEL    MH Y02139 24160003
XFF      EQU   X'FF'               UCB LOOKUP TABLE STOPPER   JE YM6838 24170000
         EJECT                                                          24200000
*********************************************************************** 24250000
*                                                                     * 24300000
*     MESSAGES                                                        * 24350000
*                                                                     * 24400000
*********************************************************************** 24450000
MSG2A    DC    C'IEE452I UNIT STATUS NUMBER OF UNITS REQUESTED EXCEEDS X24500000
               NUMBER AVAILABLE'        ERROR MESSAGE 2                 24550000
MSG2AEND EQU   *                   END PF MSG2A                         24600000
MSG2ALGN EQU   MSG2AEND-MSG2A      LENGTH OF MSG2A                      24650000
HEAD     DC    C'IEE450I   .  .   UNIT STATUS'                          24700000
HEADEND  EQU   *                   END OF HEADING LINE                  24750000
HEADLGN  EQU   HEADEND-HEAD                                             24800000
*              THE FIRST NINE BYTES OF LABELA ARE ALSO USED FOR LABELO  24850000
LABELO   EQU   *                  MUST IMMEDIATELY PRECEED LABELA       24900000
LABELA   DC    C'UNIT TYPE STATUS  VOLSER VOLSTATE'                     24950000
LABAEND  EQU   *                   END OF LABELA                        25000000
LABALGN  EQU   LABAEND-LABELA      LENGTH OF LABELA                     25050000
LABOLGN  EQU   9                  LENGTH FOR OFFLINE LABEL              25100000
         EJECT                                                          25150000
*********************************************************************** 25200000
*                                                                     * 25250000
*                             CONSTANTS                               * 25300000
*                                                                     * 25350000
*********************************************************************** 25400000
ONLGN    DC    H'36'               FIRST HALF OF ONLINE LINE LENGTH     25450000
OFFLGN   DC    H'10'               LENGTH OF ONE OFFLINE ENTRY          25500000
         DS    0F                                                       25500403
FOXAND   DC    XL4'0000FFFF'       ANDING MASK                 @Z30AAJE 25502003
*                                                              @ZM30152 25504003
FOXFOX   DC    XL2'FFFF'           END OF UCB TABLE            @Z30AAJE 25510000
DCODE    DC    XL4'09800000'       DESCRIPTOR CODES 5,8,9 AND           25550000
*                                  ROUTING CODES (0)                    25600000
         EJECT                                                          25650000
*********************************************************************   25700000
*                                                                     * 25750000
*        DSECTS                                                       * 25800000
*                                                                     * 25850000
*********************************************************************   25900000
CVTDSECT DSECT                                                          25950000
         CVT                                                            26000000
         EJECT                                                          26050000
UCBDSECT DSECT                                                          26100000
         IEFUCBOB                                                       26150000
         EJECT                                                          26200000
XSASET   DSECT                                                          26250000
         IEECHAIN                                                       26300000
         ORG   CHAIN+L32                                                26350000
         IEEXSA                                                         26400000
         ORG   XSA+L24                                           A36165 26450000
WORKING  DS    5F                  WORKING STORAGE                      26500000
DEVNOLN  EQU   WORKING+L8          NUMBER OF DEVICES PER LINE           26550000
DEVSPRE  EQU   DEVNOLN+L2          NUMBER OF DEVICES DISPLAYED          26600000
LASTUCB  EQU   DEVSPRE+L3          STARTING UCB ADDRESS/BIN NUMBER      26650000
FROMID   EQU   LASTUCB+L4          REQUESTING CONSOLE ID                26700000
SAVE     DS    21F                 SAVE AREA BETWEEN MODULES            26750000
UNITADDA DS    C                   DEVICE ADDRESS FROM EBCDIC MH Y02139 26760003
UNITADDB DS    C                   DEVICE ADDRESS FROM HEX    MH Y02139 26770003
         ORG   SAVE+L12                                                 26800000
PACKWORD DS    F                                                        26850000
CVBWORD   DS   F                                                        26900000
         EJECT                                                          26950000
WORKAREA DSECT                                                          27000000
         SPACE 2                                                        27050000
         DS    0D                                                       27100000
UCBADDRA DS    7H                  STORAGE FOR UCB ADDRESSES            27150000
UCBADDRB DS    H                   FOUND BY UNIT4                       27200000
SWORD    DC    3F'0'               SAVE AREA ACROSS MODULES             27250000
UNIT1    DS    F                   HOLD ADDRESS ONE                     27300000
UNIT2    DS    F                   HOLD ADDRESS TWO                     27350000
UNIT3    DS    F                   HOLD ADDRESS THREE                   27400000
         SPACE 4                                                        27450000
FLAG2    DC    X'00'               COMMUNICATIONS BYTE                  27500000
ONLINS   EQU   128                 DISPLAY ONLINE DEVICES               27550000
OFFLNS   EQU   64                  DISPLAY OFFLINE DEVICES              27600000
ALLS     EQU   32                  DISPLAY OFFLINE + ONLINE DEVICES     27650000
SUFEXIST EQU   16                  REQUESTING CONSOLE IS A CRT DEVICE   27700000
SINGLE   EQU   8                   SINGLE DEVICE REQUEST                27750000
COREGOT  EQU   4                   CORE GOTTEN FOR REGION               27800000
OPEN22   EQU   2                   OPEN FLAG                            27850000
R13UCBNM EQU   1                   FLAG FOR COMPSET ROUTINE             27900000
         SPACE 2                                                        27950000
FLAG3    DC    X'00'               COMMUNICATIONS FLAGS                 28000000
U2       EQU   128                 SCAN CDE'S FOR DEVNAMET              28050000
UNIT3RET EQU   64                  IEE22110 RETURNING TO IEE21110       28100000
OPEN332  EQU   32                  OPEN FLAG                            28150000
DEVDEF   EQU   16                  DEVICE ADDRESS DEFAULTED             28200000
HEADOUTF EQU   8                   HEADING AND LABELS ARE OUT           28250000
OPEN34   EQU   4                   OPEN FLAG                            28300000
OPEN32   EQU   2                   OPEN FLAG                            28350000
OPEN31   EQU   1                   OPEN FLAG                            28400000
         SPACE 2                                                        28450000
*  FLAG4 BYTE IS USED FOR COMMUNICATIONS BETWEEN IEEUNIT3 AND THE       28500000
*  OTHER  D UNIT  MODULES.                                              28550000
FLAG4    DC    XL1'00'             COMMUNICATIONS BYTE        MC        28600000
EXITBIT  EQU   X'00'               RETURN TO CALLER           MC        28650000
MSG1     EQU   X'04'               ISSUE MESSAGE MSG1A        MC        28700000
MSG3     EQU   X'08'               ISSUE MESSAGE MSG3A        MC        28750000
MSG4     EQU   X'0C'               ISSUE MESSAGE MSG4A        MC        28800000
         SPACE 2                                                        29000000
FLAG5    DS    XL1                                                      29050000
NODEF    EQU   X'80'               LINE DEFAULT NOT TAKEN               29100000
INITENT  EQU   X'40'               INITIAL ENTRY TO UNIT STATUS FOUR    29150000
INITUNT2 EQU   X'20'               INITIAL ENTRY TO UNIT STATUS TWO     29200000
CRTMSG2  EQU   X'10'               MSG2 WITH HEADINGS FOR DIDOCS        29250000
UN4BINLT EQU   X'08'               LASTBIN FLAG FOR UNIT4               29300000
DISPBIT  EQU   X'04'               VALID ADDRESS FOUND                  29350000
DISPEND  EQU   X'02'               END OF FRAME AND DISPLAY             29400000
OPEN51   EQU   X'01'               OPEN FLAG                            29450000
         SPACE 2                                                        29500000
         DS    0F                  FORCE FULL WORD FOR WTO              29550000
WTOSET   DS    XL1                 ZERO                                 29600000
TEXTLEN  DS    XL1                 OUTPUT LENGTH                        29650000
LENGTH   EQU   76                  FULL LINE                            29700000
MCSONE   DS    XL1                 MCS FLAGS PART ONE                   29750000
SETONE   EQU   X'E1'               QUEUE BY ID, ROUTING + DESCRIPTOR    29800000
*                                  CODES EXIST, COMMAND RESPONSE, QUEUE 29850000
*                                  BY ID ONLY.                          29900000
MCSTWO   DS    XL1                 MCS FLAGS PART TWO                   29950000
SETTWO   EQU   X'40'               MLWTO                                30000000
         SPACE 1                                                        30050000
MSGT     DS    0C                  BEGIN TEXT LINE                      30100000
TEXT     DS    XL72                TEXT FIELD                           30150000
         ORG   TEXT                                                     30200000
TITLEID  DS    XL8                 MESSAGE ID NUMBER                    30250000
TITLEDGH DS    XL3                 HOURS.                               30300000
TITLEDGM DS    XL3                 MINUTES.                             30350000
TITLEDGS DS    XL2                 SECONDS                              30400000
TITLENM  DS    XL11               NAME OF DISPLAY                       30450000
         ORG   TEXT                                                     30500000
UCBN1    DS    XL5                 UNIT ADDRESS                         30550000
MODL1    DS    XL5                 DEVICE TYPE                          30600000
USTAT1   DS    XL1                 STATUS (O,A,S,C,OFFLINE)             30650000
USTAT2   DS    XL4                 STATUS (-BSY,-MTP,-NRD)              30700000
USTAT3   DS    XL3                 STATUS (-R)                          30750000
VOLID1   DS    XL7                 VOLUME SERIAL NUMBER                 30800000
VOST1A   DS    XL4                 VOLUME STATE (PUB,PRIV,STRG)         30850000
VOST1B   DS    XL6                 VOLUME STATE (-REMOV,-RSDNT,-RSERV)  30900000
         SPACE 2                                                        30950000
         ORG   TEXT+72            ORG FOR WTO TAIL                      31000000
DESCODE  DS    XL2                 DESCRIPTOR CODES                     31050000
RTECODE  DS    XL2                 ROUTING CODES                        31100000
TYPEFLAG DS    XL2                 MESSAGE TYPES                        31150000
AID      DS    XL1                AREA ID FIELD                         31200000
LNUM     DS    XL1                NUMBER OF LINES                       31250000
         SPACE 2                                                        31300000
HOLD2    DS    F                   MLWTO ID/ CONSOLE ID FOR WTO         31350000
NODEVICS DS    H                   NUMBER OF UNITS REQUESTED            31400000
NODEVDEF EQU   100                 DEFAULT                              31450000
         SPACE 2                                                        31500000
         SPACE 4                                                        31550000
*  FLAG1 BYTE IS SET BY IEEUNIT1 TO REFLECT THE DEVICE TYPE(S)          31600000
*  REQUESTED BY THE D U  COMMAND.  THE BITS SET CORRESPOND TO THE BIT   31650000
*  SETTINGS IN BYTE 3 OF THE UCBTYP FIELD.                              31700000
         SPACE 2                                                        31750000
FLAG1    DC    X'00'               FLAG1 FIELD                          31800000
TATYPE   EQU   UCB3TAPE           TAPE DEVICES                          31850000
TPTYPE   EQU   UCB3COMM           TELECOMMUNICATIONS DEVICES            31900000
DATYPE   EQU   UCB3DACC           DIRECT ACCESS DEVICES                 31950000
GRTYPE   EQU   UCB3DISP            GRAPHIC DISPLAY DEVICES              32000000
URTYPE   EQU   UCB3UREC+UCB3CHAR        UNIT RECORD + CHAR RDR DEVICES  32050000
ALLTYPE  EQU   TATYPE+TPTYPE+DATYPE+GRTYPE+URTYPE     ALLDEVICE TYPES   32100000
CTCTYPE  EQU   X'41'           CHANNEL-CHANNEL ADAPTOR TYPE JE @ZM32568 32110033
         SPACE 2                                                        32150000
IDFLD    DS    XL1                AREA ID SAVE AREA                     32200000
WEND     EQU   *                   END OF WORK AREA                     32250000
WAL      EQU   WEND-WORKAREA       LENGTH OF WORK AREA                  32300000
LOW      EQU   UNIT1                                                    32350000
CURRENT  EQU   UNIT2                                                    32400000
HIGH     EQU   UNIT3                                                    32450000
         END                                                            32500000
./  ADD  SSI=62730416,NAME=IEE40110
         TITLE 'IEE40110  IGC40110   DISPLAY PFK'                       00050000
IEE40110 CSECT                                                          00100000
* /* START OF SPECIFICATIONS ****                                       00150000
*02*  PROCESSOR = ASSEMBLER;                                            00200000
**** END OF SPECIFICATIONS ***/                                         00300000
         EJECT                                                          00400000
* STATUS                                                                00600000
*    CHANGE LEVEL 0                                                     00630000
*    CREATED FOR RELEASE 21, LINE ITEM S21003.                          00660000
*                                                                       00690000
* APARS FIXED ZA14044                                                   00720000
*                                                                       00750000
* FUNCTION                                                              00800000
*    THIS ROUTINE PROVIDES A DISPLAY SHOWING THE CURRENT DEFINITIONS    00850000
*    OF ALL PFKS WHICH WERE ALLOCATED AT SYSGEN IN RESPONSE TO AN       00900000
*    OPERATOR COMMAND OF 'D PFK'                                        00950000
*                                                                       01000000
* ENTRY POINTS                                                          01050000
*         IEE40110 FOR ALL FUNCTIONS                                    01100000
*         ENTERED FROM IGC00110 (IEE00110).                             01150000
*                                                                       01200000
* OPERATION                                                             01250000
*    IF THE PFK AREA DOES NOT EXIST AN INFORMATION MESSAGE IS SENT      01300000
*    TO THE OPERATOR.  IF THE AREA DOES EXIST THE KEYS ARE              01350000
*    EXAMINED ONE AT A TIME, FORMATTED AND WRITTEN TO THE SCREEN        01400000
*    USING THE MULTIPLE LINE FACILITY OF WTO.                           01450000
*                                                                       01500000
* INPUT                                                                 01550000
*    A CSCB CONTAINING THE OPERATOR COMMAND (WHICH IS NOT SCANNED,      01600000
*    BUT IS OVERLAYED AND USED AS A WORKAREA) AND THE PFK AREA          01650000
*    POINTED TO BY THE RESIDENT DCM.                                    01700000
*                                                                       01750000
* OUTPUT                                                                01800000
*    MESSAGE IEE724I WHICH CONSISTS OF UP TO 26 LINES OF PFK            01850000
*    DEFINITIONS.                                                       01900000
*    MESSAGE IEE720I IF THE DEVICE HAS NO PFKS ALLOCATED.               01950000
*    MESSAGE IEE921I IF MCS IS NOT IN THE SYSTEM.                       02000000
*                                                                       02050000
* EXTERNAL REFERENCES                                                   02100000
*         MACROS USED: TIME, WTO, XCTL.                                 02150000
*                                                                       02200000
* EXITS, NORMAL                                                         02250000
*         IGC00110 VIA XCTL WHEN WORK IS COMPLETE.                      02300000
*                                                                       02350000
* EXITS, ERROR                                                          02400000
*         NONE.                                                         02450000
*                                                                       02500000
* TABLES/WORK AREAS                                                     02550000
*    THE CSCB POINTED TO BY REGISTER 2. (SEE DSECT AT END OF            02600000
*    LISTING).  THE PFK AREA POINTED TO BY THE RESIDENT DCM             02650000
*    FOR THE REQUESTING CONSOLE.                                        02700000
*                                                                       02750000
* ATTRIBUTES                                                            02800000
*    REFRESHABLE, PRIVILEGED, TYPE 4 SVC.                               02850000
*                                                                       02900000
* CHARACTER CODE DEPENDENCY                                             02950000
*    THE EQUATE 'ZONE' MUST REFLECT THE ZONE OF DECIMAL DIGITS.         03000000
*                                                                       03050000
* NOTES                                                                 03100000
*    THE FOLLOWING FLAG BITS ARE USED:                                  03150000
*       THE ACTION COLUMN INDICATES WHETHER THE BIT IS TURNED ON, OFF   03200000
*       OR JUST TESTED BY THIS MODULE.                                  03250000
*                                                                       03300000
*         NAME         ACTION                 FUNCTION                  03350000
*       UCMMODE                                                         03400000
*        UCMMCS      TEST          MCS IS IN SYSTEM                     03450000
*       PFK AREA                                                        03500000
*        DCMPFKCN    TEST          KEY IS CONVERSATIONAL MODE           03550000
*        DCMPFKDF    TEST          KEY IS DEFINED                       03600000
*        DCMPFKKY    TEST          KEY IS A LIST OF KEYS                03650000
*                                                                       03700000
*********************************************************************** 03750000
  EJECT                                                                 03800000
*          REGISTER EQUATES                                             03840000
CLOCK    EQU   0                   VALUE RETURNED BY TIME MACRO         03880000
WTOPT    EQU   0                   POINTER TO WTO TEXT                  03920000
PARM1    EQU   1                   XSA POINTER ON ENTRY                 03960000
WTOIDOUT EQU   1                   MLWTO ID FROM SVC 34                 04000000
CSCB     EQU   2                   POINTER TO CSCB                      04060000
UCMBASE  EQU   3                   UCM BASE REGISTER (TEMPORARY)        04120000
DCMBASE  EQU   3                   DCM BASE REGISTER                    04200000
RET      EQU   3                   SUBROUTINE RETURN REGISTER           04250000
POINT    EQU   4                   CHAINING POINTER (VARIABLE)          04300000
BACKSCAN EQU   4                   USED TO FIND LAST TEXT CHAR          04350000
WORK5    EQU   5                   WORK REGISTER                        04400000
APFK     EQU   6                   POINTER TO PFK AREA                  04450000
INSCAN   EQU   7                   SCANS LIST OF KEYS IN AREA           04500000
ID       EQU   8                   CONSOLE ID                           04550000
COUNT    EQU   9                   LOOP CONTROL                         04600000
OUTSCAN  EQU   10                  OUTPUT PTR FOR LIST OF KEYS          04650000
XSAREG   EQU   11                  XSA BASE REGISTER                    04700000
PROGBASE EQU   12                  PROGRAM BASE REGISTER                04750000
SAVEAREA EQU   13                  PTR TO MAINLINE SAVE AREA            04800000
RETURN   EQU   14                  RETURN REGISTER                      04850000
ENTRY    EQU   15                  ENTRY POINT REGISTER                 04900000
COMPARE  EQU   15                  COMPARE REG FOR LINE LENGTH          04950000
         EJECT                                                          05000000
         BALR  PROGBASE,N0         SET BASE ADDRESS                     05050000
         USING *,PROGBASE          AND TELL ASSEMBLER                   05100000
         USING CSCBSECT,CSCB                                            05150000
* NOTE  CSCB ADDRESS WAS PASSED IN REG 2                                05200000
         B     ICATCH              BRANCH AROUND EYECATCHER             05250000
         DC    C'   MODULE IGC40110, FICHE IEE40110  '   EYECATCHER AND 05300000
ZAPAREA  DC    12C'ZAP'               RESERVED FOR FIELD MODIFICATIONS  05350000
ICATCH   LR    XSAREG,PARM1        SAVE XSA POINTER                     05400000
         USING PSXA,XSAREG                                              05450000
* NOTE  XSA ADDRESS WAS PASSED IN REG 1                                 05500000
         STM   SAVEAREA,WTOIDOUT,CSCBSAVE    SAVE REGS                  05550000
         NI    FLAGS,N0            ZERO FLAG BYTE                       05600000
         SR    WORK5,WORK5         CLEAR WORK                           05650000
         SR    ID,ID                  REGISTERS                         05700000
         SPACE 5                                                        05750000
*****************************************************************       05800000
         L     POINT,CVTADDR       GET CVT POINTER                      05860000
         USING CVTDSECT,POINT                                           05920000
         L     POINT,CVTCUCB       GET UCM POINTER                      06000000
         DROP  POINT                                                    06050000
         IC    ID,CHUCMP           GET CONSOLE ID                       06100000
         LR    WORK5,ID                                                 06150000
         LR    WTOPT,ID            POINT WTO TO CONSOLE                 06200000
         BCTR  WORK5,N0            SUBTRACT ONE FOR LATER MULTIPLY      06250000
         USING UCM,POINT                                                06300000
         MVC   PREFIX,HEADER       MOVE PREFIX INTO WORKAREA            06350000
         MVI   LINTYPE,NONE        SET UP FOR STANDARD WTO              06400000
         EJECT                                                          06600000
*****************************************************************       06800000
         LM    UCMBASE,POINT,UCMVEA YES, GET ENTRY AND LENGTH POINTERS  06850000
         DROP  POINT                                                    06900000
         MR    POINT,POINT         INDEX TO CORRECT CONSOLE             06950000
* NOTE  THIS MULTIPLIES POINT (LENGTH) BY WORK5 (ID) TO                 07000000
*       OBTAIN INDEX IN WORK5.                                          07050000
         AR    UCMBASE,WORK5       PLUS ENTRY EQUAL UCM ENTRY           07100000
         USING UCMLIST,UCMBASE                                          07150000
         SPACE 5                                                        07200000
*****************************************************************       07260000
         NC    UCMXB,UCMXB         IS THIS A GRAPHICS CONSOLE           07320000
         BZ    MSG1                 NO, ISSUE MESSAGE                   07400000
         SPACE 5                                                        07460000
*****************************************************************       07520000
         L     DCMBASE,UCMXB        YES, LOAD RESIDENT DCM POINTER      07600000
         DROP  UCMBASE                                                  07650000
         USING RESDCM,DCMBASE                                           07700000
         L     APFK,DCMADPFK       POINT TO PFK AREA                    07750000
         LTR   APFK,APFK           ARE ANY KEYS ALLOCATED               07800000
         BZ    MSG1                 NO, ISSUE MESSAGE                   07850000
         DROP  DCMBASE                                                  07900000
         SH    APFK,PFKLGTH        BACK UP 1 PSEUDO AREA                07950000
         MVC   TEXT(L'MSGID),MSGID MOVE IN MESSAGE ID                   08000000
         EJECT                                                          08060000
*****************************************************************       08120000
         TIME  DEC                 GET TIME                             08200000
* NOTE  TIME RETURNED IN REG 0 AS PACKED DECIMAL                        08260000
         SPACE 5                                                        08320000
*****************************************************************       08400000
         ST    CLOCK,TEXT+N8       STORE PACKED DECIMAL TIME            08450000
         UNPK  TEXT+N10(N7),TEXT+N8(N4) UNPACK IT                       08500000
         MVI   TEXT+N16,BLANK      BLANK FRACTIONAL SECONDS             08550000
         MVC   TEXT+N9(N4),TEXT+N10     SHIFT HOURS LEFT                08600000
         MVC   TEXT+N8(N2),TEXT+N9 SHIFT MINUTES LEFT                   08650000
         MVI   TEXT+N10,PERIOD     ADD IN                               08700000
         MVI   TEXT+N13,PERIOD        PUNCTUATION                       08750000
         MVC   TEXT+N19(L'CONTROL),CONTROL    MOVE IN CONTROL LINE TEXT 08800000
         MVI   LINTYPE,CTRLINE     SET LINE TYPE FLAG                   08850000
         LR    WTOPT,ID            REFRESH ID POINTER                   08900000
         SPACE 5                                                        08950000
*****************************************************************       09000000
         BAL   RET,SUBROUT         GO TO WRITE THE CONTROL LINE         09060000
         SPACE 5                                                        09120000
*****************************************************************       09200000
         MVC   TEXT(L'TITLE),TITLE MOVE IN TITLE LINE                   09260000
         MVI   LINTYPE,TITLINE       SET LINE TYPE FLAG                 09320000
         SPACE 5                                                        09400000
*****************************************************************       09460000
LOOP     CLI   PFKLGN(APFK),STOPPER     IS NEXT KEY A STOPPER           09520000
* NOTE  IT CANNOT BE ON FIRST PASS                                      09600000
         BE    ENDFLAG              YES, GO TO MARK LAST LINE           09660000
         SPACE 5                                                        09720000
*****************************************************************       09800000
         BAL   RET,SUBROUT         WRITE NEXT LINE                      09850000
         MVI   LINTYPE,DATA        SET LINE TYPE TO DATA LINE           09900000
         SPACE 5                                                        09950000
*****************************************************************       10000000
         LA    APFK,PFKLGN(APFK)   POINT TO NEXT KEY                    10060000
         SPACE 5                                                        10120000
*****************************************************************       10200000
         SR    WORK5,WORK5         CLEAR REGISTER                       10260000
         IC    WORK5,N0(APFK)      GET KEY NUMBER                       10320000
         CVD   WORK5,PACK          CONVERT TO DECIMAL                   10400000
         UNPK  PACK,CVBIN          UNPACK IT                            10450000
         OI    PACK+N3,ZONE        INSERT EBCDIC ZONE                   10500000
         MVC   TEXT+N2(N2),PACK+N2 MOVE KEY NUMBER TO LINE              10550000
         SPACE 5                                                        10600000
*****************************************************************       10660000
         TM    N1(APFK),DCMPFKDF   IS KEY DEFINED                       10720000
         BNO   NOTDEF               NO, MOVE IN MESSAGE                 10800000
         EJECT                                                          10860000
*****************************************************************       10920000
         TM    N1(APFK),DCMPFKCN   IS KEY CONVERSATIONAL                11000000
         BO    CONVERS              YES, GO TO INDICATE SO              11060000
         SPACE 5                                                        11120000
*****************************************************************       11200000
         MVC   TEXT+N7(L'NO),NO     NO, INDICATE SO                     11250000
         B     TESTYPE             GO SEE IF KEY IS A LIST              11300000
         SPACE 5                                                        11350000
*****************************************************************       11400000
CONVERS  MVC   TEXT+N7(L'YES),YES  INDICATE CONV MODE                   11460000
         SPACE 5                                                        11520000
*****************************************************************       11600000
TESTYPE  TM    N1(APFK),DCMPFKKY   IS THIS A LIST OF KEYS               11660000
         BO    KEYLIST              YES, GO TO FORMAT IT                11720000
         SPACE 5                                                        11800000
*****************************************************************       11860000
TEXTCOM  EQU   *                                                        11920000
         CLC   TEXT+N13(PFKLIN/2),PFKLIN/2+N2(APFK)                     12000000
*                                  IS SECOND HALF LINE BLANK            12050000
         MVC   TEXT+N13(PFKLIN/2),N2(APFK) MOVE FIRST 1/2 LINE ANYWAY   12100000
         EJECT                                                          12150000
*****************************************************************       12200000
         BE    LOOP                 YES, GET NEXT KEY                   12260000
         SPACE 5                                                        12320000
*****************************************************************       12400000
         BAL   RET,SUBROUT         GO TO WRITE LINE                     12460000
         SPACE 5                                                        12520000
*****************************************************************       12600000
         MVC   TEXT+N13(PFKLIN/2),PFKLIN/2+N2(APFK)   MOVE IN 2ND LINE  12660000
         B     LOOP                GO TO NEXT TEST                      12720000
         SPACE 5                                                        12800000
*****************************************************************       12860000
KEYLIST  EQU   *                                                        12920000
         LA    INSCAN,N2(APFK)     POINT TO FIRST KEY IN LIST           13000000
         SR    COUNT,COUNT         CLEAR LOOP CONTROL REG               13050000
         LA    COUNT,TEXT+PFKLIN/2+N10    SET COUNT FOR END OF LINE     13100000
         SPACE 5                                                        13150000
*****************************************************************       13200000
SECLINE  LA    OUTSCAN,TEXT+N13    POINT TO TEXT AREA OF LINE           13260000
         EJECT                                                          13320000
*****************************************************************       13400000
NEXTKEY  SR    WORK5,WORK5         CLEAR REGISTER                       13460000
         IC    WORK5,N0(INSCAN)    GET KEY NUMBER                       13520000
         CVD   WORK5,PACK          CONVERT TO DECIMAL                   13600000
         UNPK  PACK,CVBIN          UNPACK IT                            13650000
         OI    PACK+N3,ZONE        ADD EBCDIC ZONE                      13700000
         CLI   PACK+N2,ZERO        IS FIRST DIGIT ZERO                  13750000
         BE    ONEDIG               YES, SKIP FIRST DIGIT               13800000
         MVC   N0(N1,OUTSCAN),PACK+N2   MOVE FIRST DIGIT                13850000
         LA    OUTSCAN,N1(OUTSCAN) BUMP OUTPUT POINTER                  13900000
ONEDIG   EQU   *                                                        13950000
         MVC   N0(N1,OUTSCAN),PACK+N3   MOVE SECOND DIGIT               14000000
         MVI   N1(OUTSCAN),COMMA   MOVE IN COMMA                        14050000
         LA    OUTSCAN,N2(OUTSCAN) BUMP OUTPUT POINTER                  14100000
         LA    INSCAN,N2(INSCAN)   BUMP INPUT POINTER                   14150000
         SPACE 5                                                        14200000
*****************************************************************       14260000
ENDLIST  CLI   N0(INSCAN),STOPLIST IS THIS END OF LIST                  14320000
         BE    CLEARCOM             YES, GO ON TO NEXT KEY              14400000
         SPACE 5                                                        14460000
*****************************************************************       14520000
         CR    COUNT,OUTSCAN       IS THIS END OF DISPLAY LINE          14600000
         BNL   NEXTKEY              NO, GET NEXT KEY                    14660000
         SPACE 5                                                        14720000
*****************************************************************       14800000
         BAL   RET,SUBROUT          YES, WRITE THIS LINE OUT            14850000
         B     SECLINE             GO TO FORMAT SECOND LINE             14900000
         EJECT                                                          14950000
*****************************************************************       15000000
CLEARCOM EQU   *                                                        15060000
         SH    OUTSCAN,H1          POINT TO LAST COMMA                  15120000
         MVI   N0(OUTSCAN),BLANK   BLANK IT OUT                         15200000
         B     LOOP                GO ON TO NEXT KEY                    15260000
         SPACE 5                                                        15320000
*****************************************************************       15400000
NOTDEF   EQU   *                                                        15450000
         MVC   TEXT+N14(L'UNDEF),UNDEF   MOVE IN UNDEFINED MESSAGE      15500000
         B     LOOP                GO ON TO NEXT KEY                    15550000
         EJECT                                                          15600000
***********SUBROUTINE TO WRITE EACH LINE ************                   15700000
*****************************************************************       15800000
SUBROUT  LA    BACKSCAN,SUFF       PT TO END OF TEXT                    15850000
         BCTR  BACKSCAN,N0         POINT TO LAST CHARACTER              15900000
X        CLI   N0(BACKSCAN),BLANK  IS IT BLANK                          15950000
         BNE   NONBLANK             NO, MARK LOCATION                   16000000
* NOTE  THE FOLLOWING INSTRUCTION DOES NOT PROVIDE LOOP CONTROL         16050000
         BCT   BACKSCAN,X           YES, POINT TO NEXT CHAR             16100000
         SPACE 5                                                        16150000
*****************************************************************       16200000
NONBLANK MVC   N1(L'SUFFIX,BACKSCAN),SUFFIX  MOVE IN SUFFIX FLAGS       16260000
         SPACE 5                                                        16320000
*****************************************************************       16400000
         TM    FLAGS,FLAGA         IS THIS A REGULAR WTO                16460000
         BNO   MLWTO                NO, DON'T CHANGE PREFIX             16520000
         SPACE 5                                                        16600000
*****************************************************************       16660000
         MVC   PREFIX+N2(N2),ORDWTO      YES, ALTER PREFIX              16720000
         SPACE 5                                                        16800000
*****************************************************************       16860000
MLWTO    MVC   N5(N1,BACKSCAN),LINTYPE  MARK LINE TYPE AS REQUIRED      16920000
         EJECT                                                          17000000
*****************************************************************       17060000
         LA    COMPARE,PREFIX      PT TO START OF PARAMETER LIST        17120000
         SR    BACKSCAN,COMPARE   DETERMINE TOTAL LENGTH MINUS ONE      17200000
         LA    BACKSCAN,N1(BACKSCAN)    ADD ONE FOR TRUE LENGTH         17250000
         STC   BACKSCAN,PREFIX+N1  STORE IN HEADER                      17300000
         SPACE 5                                                        17350000
*****************************************************************       17400000
         WTO   MF=(E,PREFIX)                                            17440000
         LTR   ENTRY,ENTRY         TEST RETURN CODE           MC YM3872 17480000
         BNZ   EXIT                DISPLAY CANCELLED, EXIT    MC YM3872 17520000
* NOTE  WTO MESG ID IS RETURNED IN REG 1, BUT MUST BE PASSED            17560000
*          BACK WITH CONSOLE ID IN REG 0                                17600000
         SPACE 5                                                        17660000
*****************************************************************       17720000
         LR    WTOPT,WTOIDOUT      MOVE WTO ID FOR NEXT LINE            17800000
         SLL   WTOPT,N8            ALIGN WTO ID IN REG                  17850000
         IC    WTOPT,CHUCMP        INSERT CONSOLE ID                    17900000
         SPACE 5                                                        17950000
*****************************************************************       18000000
         MVI   TEXT,BLANK          BLANK THE                            18060000
         MVC   TEXT+N1(N70),TEXT      TEXT AREA                         18120000
         SPACE 5                                                        18200000
*****************************************************************       18260000
         BR    RET                 RETURN TO CALLER                     18320000
*************END OF SUBROUTINE*****************                         18400000
         EJECT                                                          18460000
*****************************************************************       18520000
ENDFLAG  EQU   *                                                        18600000
         MVI   LINTYPE,DTEND       SET LINE TYPE TO DATA-END            18660000
         SPACE 5                                                        18720000
*****************************************************************       18800000
         BAL   RET,SUBROUT         GO TO WRITE LINE                     18860000
         SPACE 5                                                        18920000
*****************************************************************       19000000
EXIT     LM    SAVEAREA,WTOIDOUT,CSCBSAVE    RETORE SAVED REGS          19050000
         MVI   XAX+N3,ZERO         POINT TO FIRST LOAD OF SVC 110       19100000
         XCTL  SF=(E,(XSAREG))     RETURN TO IT TO FREE CSCB AND EXIT   19150000
         SPACE 5                                                        19200000
*****************************************************************       19400000
SETA     OI    FLAGS,FLAGA         INDICATE NORMAL WTO                  19600000
         BAL   RET,SUBROUT         GO TO WRITE LINE                     19650000
         B     EXIT                RETURN TO CALLER                     19700000
         EJECT                                                          19750000
*****************************************************************       19800000
MSG1     EQU   *                                                        19860000
         MVC   TEXT(L'NALLOC),NALLOC    MOVE IN MESSAGE                 19920000
         B     SETA                SET NORMAL LINE FLAG                 20000000
         EJECT                                                          20050000
*************      CONSTANTS                                            20100000
CONTROL  DC    C'PFK DEFINITION'   CONTROL LINE TEXT                    20150000
HEADER   DC    X'0000E140'         LINE LENGTH AND MCS FLAGS            20200000
H1       DC    H'1'                ONE                                  20250000
MSGID    DC    C'IEE724I'          MESSAGE IDENTIFIER                   20300000
NALLOC   DC    C'IEE720I NO PFK ALLOCATION'                             20350000
NO       DC    C'NO'               KEY NOT CONVERSATIONAL MODE          20400000
ORDWTO   DC    X'6100'             FLAGS FOR STANDARD WTO               20460000
PFKLGTH  DC    H'110'              LENGTH OF PFK AREA                   20520000
SUFFIX   DC    X'098000000000E901' MLWTO CONTROL                        20600000
TITLE    DC    C' KEY#  CONV   DEFINITION...' TITLE TEXT       @ZA14044 20650000
UNDEF    DC    C'NOT DEFINED'      KEY IS NOT DEFINED                   20700000
YES      DC    C'YES'              KEY IS CONVERSATIONAL MODE           20750000
         EJECT                                                          20800000
***********      EQUATES                                                20850000
BLANK    EQU   C' '                BLANK CHARACTER                      20900000
COMMA    EQU   C','                COMMA CHARACTER                      20950000
CTRLINE  EQU   X'80'               CONTROL LINE TYPE FLAG               21000000
CVTADDR  EQU   16                  CVT POINTER ADDRESS                  21050000
DATA     EQU   X'20'               DATA LINE TYPE FLAG                  21100000
DTEND    EQU   X'30'               DATA-END LINE TYPE FLAG              21150000
MVCLN    EQU   256                 LENGTH OF EACH MOVE TO COPY PFK AREA 21200000
NONE     EQU   X'00'               NULL LINE TYPE                       21250000
N0       EQU   0                   NUMBER                               21300000
N1       EQU   1                   NUMBER                               21350000
N2       EQU   2                   NUMBER                               21400000
N3       EQU   3                   NUMBER                               21450000
N4       EQU   4                   NUMBER                               21500000
N5       EQU   5                   NUMBER                               21550000
N6       EQU   6                   NUMBER                               21600000
N7       EQU   7                   NUMBER                               21650000
N8       EQU   8                   NUMBER                               21700000
N9       EQU   9                   NUMBER                               21750000
N10      EQU   10                  NUMBER                               21800000
N11      EQU   11                  NUMBER                               21850000
N12      EQU   12                  NUMBER                               21900000
N13      EQU   13                  NUMBER                               21950000
N14      EQU   14                  NUMBER                               22000000
N15      EQU   15                  NUMBER                               22050000
N16      EQU   16                  NUMBER                               22100000
N19      EQU   19                  NUMBER                               22150000
N70      EQU   70                  NUMBER                               22200000
ONEBYTE  EQU   8                   NUMBER OF BITS IN BYTE               22250000
PERIOD   EQU   C'.'                PERIOD CHARACTER                     22300000
PFKLGN   EQU   110                 LENGTH OF PFK AREA                   22350000
PFKLIN   EQU   PFKLGN-2            LENGTH OF PFK TEXT                   22400000
STOPLIST EQU   X'61'               STOPPER FOR LIST OF KEYS             22450000
STOPPER  EQU   X'64'               FLAG TO SHOW END OF LIST OF KEYS     22500000
TITLINE  EQU   X'40'               TITLE LINE TYPE FLAG                 22550000
ZERO     EQU   C'0'                CHARACTER ZERO                       22600000
ZONE     EQU   X'F0'               EBCDIC ZONE                          22620000
DCMPFKDF EQU   X'80'                KEY HAS BEEN DEFINED                22640000
DCMPFKCN EQU   X'20'                KEY IS CONVERSATIONAL               22660000
DCMPFKKY EQU   X'08'                KEY IS A LIST OF KEYS               22680000
         TITLE 'IEE40110  IGC40110  DISPLAY PFK  CXSA'                  22700000
PSXA     DSECT                                                          22720000
         IEEXSA                                                         22800000
         TITLE 'IEE40110  IGC40110   DISPLAY PFK   COMMUNICATIONS VECTO*22850000
               R TABLE'                                                 22900000
CVTDSECT DSECT                                                          22950000
         CVT                                                            23000000
         TITLE 'IEE40110  IGC40110   DISPLAY PFK   RESIDENT DISPLAY CON*23050000
               TROL MODULE'                                             23100000
RESDCM   DSECT                                                          23150000
         IEECRDCM                                                       23200000
         TITLE 'IEE40110  IGC40110   DISPLAY PFK   TRANSIENT DISPLAY CO*23250000
               NTROL MODULE'                                            23300000
DCMSECT  DSECT                                                          23350000
         IEECDCM                                                        23400000
         TITLE 'IEE40110  IGC40110   DISPLAY PFK   UNIT CONTROL MODULE' 23460000
         IEECUCM FORMAT=NEW                                             23520000
         TITLE 'IEE40110  IGC40110   DISPLAY PFK   CSCB (USED AS WORKSP*23600000
               ACE)'                                                    23650000
CSCBSECT DSECT                                                          23700000
         IEECHAIN                                                       23750000
* NOTE  THE FOLLOWING PORTION SHOWS HOW THIS MODULE MAKES USE           23800000
*       OF THE CSCB AS A WORK AREA.                                     23850000
         ORG   CHBUF               START MODULE WORKAREA ON D/W         23900000
FLAGS    DC    X'00'               NOT USED                             23950000
FLAGA    EQU   X'80'               USE REGULAR WTO                      24000000
LINTYPE  DC    X'00'               LINE TYPE                            24050000
OP       DS    14C                 INCOMING COMMAND OPERAND             24100000
PREFIX   DC    X'00000000'         WTO LINE LENGTH AND MCS FLAGS        24150000
TEXT     DC    71C' '              TEXT OF OUTPUT LINE                  24200000
SUFF     DC    X'000000000000'     MLWTO CONTROL AREA                   24250000
         DS    3C                  UNUSED                               24300000
CSCBSAVE DS    5F                  REGISTER SAVE AREA                   24350000
         ORG   CHPEND              ALIGN TO D/W PAST CONSOLE ID         24400000
PACK     DC    F'0'                AREA TO PLACE NUMBER FOR PACKING     24450000
CVBIN    DC    F'0'                AREA FOR CONVERSION TO BINARY        24500000
         END   IEE40110                                                 24550000
