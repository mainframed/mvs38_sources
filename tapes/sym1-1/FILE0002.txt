./  ADD  SSI=73070004,NAME=IFBDCB01
 TITLE 'IFBDCB00,IFBDCB00,RESIDENT DEB AND DCB FOR SER'                 01000001
*STATUS: CHANGE LEVEL 000                                               02000001
*FUNCTION/OPERATION: RESIDENT DCB AND DEB CONTROL BLOCKS FOR USE      * 03000001
*   BY THE SER MODULES.                                               * 04000001
*                                                                     * 05000001
*ENTRY POINTS: NONE.                                                  * 06000001
*                                                                     * 07000001
*INPUT: NONE.                                                         * 08000001
*                                                                     * 09000001
*OUTPUT: NONE.                                                        * 10000001
*                                                                     * 11000001
*EXTERNAL ROUTINES: NONE.                                             * 12000001
*                                                                     * 13000001
*EXITS - NORMAL: NONE.                                                * 14000001
*                                                                     * 15000001
*EXITS - ERROR: NONE.                                                 * 16000001
*                                                                     * 17000001
*TABLES/ WORK AREAS:  NONE.                                           * 18000001
*                                                                     * 19000001
*ATTRIBUTES: NONE.                                                    * 20000001
*                                                                     * 21000001
*NOTES: THIS MODULES RESIDES PERMANENTLY IN THE NUCLEUS AND IS        * 22000001
*   INITIALIZED BY THE NUCLEUS INITIALIZATION PROGRAM (NIP)           * 23000001
*   AT LOAD TIME.                                                     * 24000001
         EJECT                                                          25000001
*                                                                     * 26000001
*                                                                     * 27000001
*********************************************************************** 28000001
*                                                                     * 29000001
*        THE FOLLOWING DEB AND DCB RESIDE PERMANENTLY IN THE NUCLEUS  * 30000001
*        AND WILL BE COMPLETED BY NIP.  THEY ARE FOR USE ONLY BY      * 31000001
*        THE SER ROUTINES.                                            * 32000001
*                                                                     * 33000001
*********************************************************************** 34000001
IFBDCB00 START 0                                                        35000001
         SPACE 2                                                        36000001
         ENTRY IFBDCB                                                   37000001
         ENTRY IFBDEB                                                   38000001
         EXTRN IFBACTA                                             000E 41000001
         SPACE 2                                                        43000001
         DS    0F                                                       44000001
         DC    AL4(0)              SPARE POINTER                YM4034P 45000002
         DC    AL4(0)              SPARE POINTER                YM4035P 46000002
         DC    AL4(IFBACTA)             POINTER TO CHAN TYPE TABLE 000E 47000001
IFBDEB   DC    1F'0'                    START OF DEB                    48000001
IFBDCB   DC    AL4(0)              SPARE POINTER                YM4034P 49000002
         DC    4F'0'                   OVERLAYED DCB                    50000001
         DC    X'0F'                    DEB ID FIELD                    51000001
         DC    AL3(IFBDCB)              ADDRESS OF DCB                  52000001
         DC    5F'0'                                                    53000001
         DC    AL4(IFBDEB)              ADDRESS OF SER DEB              54000001
         DC    X'01'                    FLAG                            55000001
         DC    XL3'0'                                                   56000001
         DC    2F'0'                                                    57000001
         SPACE 2                                               @YA00000 57100003
*********************************************************************** 57200003
*                                                                     * 57300003
*        THE FOLLOWING ADDED TO SUPPORT DISPLAY EXCEPTION MONITORING  * 57400003
*        FACILITY (DEMF)                                              * 57500003
*        MVS 3.7 VERSION                                              * 57600003
*                                                                     * 57700003
*********************************************************************** 57800003
         SPACE 2                                               @YA00000 57900003
         ORG   IFBDCB00+356        DEMF ORIGIN +89 FULL WORDS. @YA00000 58000003
IFBBUFP  DC    1F'0'               DEMF BUFFER POINTER         @YA00000 58100003
IFBASCBP DC    1F'0'               DEMF BNGLOGR ASCB POINTER (MVS)      58200003
         DC    4F'0'               DEMF RESERVED               @YA00000 58300003
IFBFLGS1 DC    X'00'               DEMF FLAGS1                 @YA00000 58400003
IFBFLGS2 DC    X'00'               DEMF FLAGS2                 @YA00000 58500003
IFBFLGS3 DC    X'00'               DEMF FLAGS3                 @YA00000 58600003
IFBFLGS4 DC    X'00'               DEMF FLAGS4                 @YA00000 58700003
         END                                                            59000001
./  ADD  SSI=33540211,NAME=IFBDCB02
*STATUS: CHANGE LEVEL 000                                               01000001
*FUNCTION/OPERATION: RESIDENT DCB AND DEB CONTROL BLOCKS FOR USE      * 02000001
*   BY THE SER MODULES.                                               * 03000001
*                                                                     * 04000001
*ENTRY POINTS: NONE.                                                  * 05000001
*                                                                     * 06000001
*INPUT: NONE.                                                         * 07000001
*                                                                     * 08000001
*OUTPUT: NONE.                                                        * 09000001
*                                                                     * 10000001
*EXTERNAL ROUTINES: NONE.                                             * 11000001
*                                                                     * 12000001
*EXITS - NORMAL: NONE.                                                * 13000001
*                                                                     * 14000001
*TABLES/ WORK AREAS: NONE.                                            * 15000001
*                                                                     * 16000001
*ATTRIBUTES: NONE.                                                    * 17000001
*                                                                     * 18000001
*NOTES: THIS MODULE RESIDES PERMANENTLY IN THE NUCLEUS AND IS         * 19000001
*   INITIALIZED BY THE NUCLEUS INITIALIZATION PROGRAM (NIP)           * 20000001
*   AT LOAD TIME.                                                     * 21000001
         EJECT                                                          22000001
*                                                                     * 23000001
*                                                                     * 24000001
*********************************************************************** 25000001
*                                                                     * 26000001
*        THE FOLLOWING DEB AND DCB RESIDE PERMANENTLY IN THE NUCLEUS  * 27000001
*        AND WILL BE COMPLETED BY NIP. THEY ARE FOR USE ONLY BY       * 28000001
*        THE SER ROUTINES.                                            * 29000001
*                                                                     * 30000001
*********************************************************************** 31000001
IFBDCB00 START 0                                                        32000001
         SPACE 1                                                        33000001
         ENTRY IFBDCB                                                   34000001
         ENTRY IFBDEB                                                   35000001
         EXTRN IFBACTA                                                  38000001
         SPACE 1                                                        40000001
         DS    0F                                                       41000001
         DC    AL4(0)              SPARE POINTER                YM4034P 42000002
         DC    AL4(0)              SPARE POINTER                YM4035P 43000002
         DC    AL4(IFBACTA)             POINTER TO CHAN TYPE TABLE      44000001
IFBDEB   DC    1F'0'                    START OF DEB                    45000001
IFBDCB   DC    AL4(0)              SPARE POINTER                YM4034P 46000002
         DC    4F'0'                    OVERLAYED DCB                   47000001
         DC    X'0F'                    DEB ID FIELD                    48000001
         DC    AL3(IFBDCB)              ADDRESS OF DCB                  49000001
         DC    5F'0'                                                    50000001
         DC    AL4(IFBDEB)              ADDRESS OF SER DEB              51000001
         DC    X'03'                    FLAG                            52000001
         DC    XL3'0'                                                   53000001
         DC    2F'0'                                                    54000001
         END                                                            56000001
./  ADD  SSI=80870569,NAME=IFBOBR00
 TITLE 'IFBOBR00 - IGE0025F/IGE0625F - OBR/MDR RECORDER'                00070002
         EJECT                                                          11550002
*STATUS: CHANGE LEVEL 000 (MODULE SUPPORT CODE Y02021)                * 11690002
*FUNCTION:                                                            * 11760002
*        THE OBR/MDR MODULE FORMATS RECORDS ON A PERMANENT I/O        * 11830002
*        DEVICE ERROR (LONG OBR), ON A STATISTICS COUNTER OVERFLOW    * 11900002
*        CONDITION (SHORT OBR), OR A MISCELLANEOUS DATA RECORDING     * 11970002
*        (MDR).  IF PROCESSING AN OBR RECORDING, LONG OR SHORT,       * 12040002
*        OBR/MDR WILL INTERROGATE THE DEFERRED INCIDENT RECORDING     * 12110002
*        QUEUE (PAGING DATA SET ERROR RECORDINGS), AND WILL FORMAT    * 12180002
*        ANY THAT ARE PRESENT.                                        * 12250002
*        THE RECORDING TO SYS1.LOGREC IS TEMPORARILY QUEUED BY THE    * 12320002
*        RECORDING REQUEST ROUTINE OF THE ASYNCHRONOUS RECORDING      * 12390002
*        FACILITY VIA THE RECORD MACRO.  THE ACTUAL RECORDING OF THE  * 12460002
*        RECORD IS DONE BY SVC76 VIA THE RECORDING TASK ROUTINE OF    * 12530002
*        THE ASYNCHRONOUS RECORDING FACILITY.                         * 12600002
*        OBR/MDR IS CALLED BY IBM SUPPLIED ERROR RECOVERY PROCEDURE   * 12670002
*        ROUTINES.  WORK STORAGE IS OBTAINED VIA THE GETMAIN MACRO.   * 12740002
*        AN ESTAE EXIT IS ESTABLISHED IF THE GETMAIN IS SUCCESSFUL.   * 12810002
*        THE ESTAE EXIT IS USED TO FREEMAIN IF A PROGRAM CHECK OCCURS * 12880002
*        WITHIN OBR/MDR.                                              * 12950002
*        THE TYPE OF RECORD TO BE PROCESSED (OBR OR MDR) IS           * 13020002
*        DETERMINED BY THE EWAMDR FLAG OF EWAFLG2.                    * 13090002
*        IF OBR, THE RECORD IS FORMATTED, AND QUEUED VIA THE RECORD   * 13160002
*        MACRO.                                                       * 13230002
*        IF MDR, THE RECORD IS COMPLETED, AND QUEUED VIA THE RECORD   * 13300002
*        MACRO.  MDR RECORDS MAY BE PARTIALLY PREFORMATTED DEPENDING  * 13370002
*        UPON THE DEVICE TYPE OR ACCESS METHOD IN USE.                * 13440002
*                                                                     * 13510002
*                                                                     * 13580002
*ENTRY POINT:                                                         * 13650002
*        CONTROL IS PASSED TO THE FIRST EXECUTABLE STATEMENT OF THIS  * 13720002
*        MODULE FROM THE ERP THROUGH A SPECIAL XCTL INTERFACE.        * 13790002
*                                                                     * 13860002
*                                                                     * 13930002
*INPUT:                                                               * 14000002
*        IOSB POINTER IN REGISTER 1.                                  * 14070002
*                                                                     * 14140002
*                                                                     * 14210002
*OUTPUT:                                                              * 14280002
*        SYS1.LOGREC RECORDING VIA THE RECORD MACRO.                  * 14350002
*                                                                     * 14420002
*                                                                     * 14490002
*EXTERNAL REFERENCES:                                                 * 14560002
*        RECORDING REQUEST ROUTINE, IO CORE MANAGER, ESTAE, GETMAIN.  * 14630002
*                                                                     * 14700002
*                                                                     * 14770002
*EXITS,NORMAL: OBR                                                    * 14840002
*              1. IF DDR IS REQUESTED OR ERROR WAS A TCAM EOD, THE    * 14910002
*              BINARY EQUIVALENT OF THE MODULE NAME IS LOADED INTO    * 14980002
*              REGISTER 13, AND OBR/MDR BRANCHES TO THE SPECIAL ERROR * 15050002
*              XCTL ROUTINE.                                          * 15120002
*              2. ISSUES SVC15 FOLLOWED BY SVC3.                      * 15190002
*                                                                     * 15260002
*              MDR                                                    * 15330002
*              1. PLACES 'TPR' IN EBCDIC IN THE FIRST 3 BYTES OF THE  * 15400002
*              BUFFER.  PLACES X'00' IN FOURTH BYTE OF THE BUFFER TO  * 15470002
*              INDICATE SUCCESS.                                      * 15540002
*                 A. ISSUES SVC15 FOLLOWED BY SVC3, OR:               * 15610002
*                 B. XCTL'S TO CALLING ROUTINE.                         15680002
*                                                                     * 15750002
*                                                                     * 15820002
*EXITS,ERROR:  OBR                                                    * 15890002
*              1. NO SPECIAL ERROR EXITS.                             * 15960002
*              MDR                                                    * 16030002
*              1. PLACES ERROR CODE IN FOURTH BYTE OF BUFFER.         * 16100002
*                   X'0F' - SIZE OF FIELD 24 BYTES OR LESS.           * 16170002
*                   X'FF' - UNSUCCESSFUL RECORDING.                   * 16240002
*                 A. ISSUES SVC15 FOLLOWED BY SVC3.                   * 16310002
*                 B. XCTL'S TO CALLING ROUTINE.                       * 16380002
*                                                                     * 16450002
*                                                                     * 16520002
*TABLES/WORK AREAS:                                                   * 16590002
*              OBR: GETMAIN AREA IS USED TO BUILD RECORD.             * 16660002
*                                                                     * 16730002
*              MDR: FOR 2715 AND 3270 (BTAM ACCESS METHOD) THE RECORD * 16800002
*              IS FORMATTED IN THE GETMAIN AREA.  ALL OTHER DEVICES   * 16870002
*              THE HEADER IS COMPLETED IN THE PREFORMATTED RECORD     * 16940002
*              BUFFER PROVIDED BY THE CALLING ROUTINE.                * 17010002
*ATTRIBUTES: REENTRANT, PRIVILEGED, NON-RESIDENT, ENABLED             * 17080002
*                                                                       17150002
*CHARACTER CODE DEPENDENCY: THIS MODULE IS CHARACTER CODE DEPENDENT   * 17220002
*                            AND MUST BE REASSEMBLED IF MODE CHANGED  * 17290002
*                            FROM EBCDIC.                             * 17360002
*                                                                     * 17430002
* NOTES  - NOT APPLICABLE                                               17500002
         EJECT                                                          17570002
*                        LONG OBR RECORD                              * 17640002
*    ****************************************************************** 17710002
*    * CLASS  * SYS.  *                              *                * 17780002
* +0 *SOURCE  * RELE- *   S W I T C H E S            *   SPARES       * 17850002
*    *        *  ASE  *                              *                * 17920002
*    ****************************************************************** 17990002
*    *                               *                                * 18060002
* +8 *          DATE                 *         TIME                   * 18130002
*    *                               *                                * 18200002
*    ****************************************************************** 18270002
*    *        *                      *     CPU       *                * 18340002
* +16*  NOT   *   CPU SERIAL NO.     *   IDENTITY    *   NOT USED     * 18410002
*    *  USED  *                      *               *                * 18480002
*    ****************************************************************** 18550002
*    *                                                                * 18620002
* +24*                   JOB IDENTITY                                 * 18690002
*    *                                                                * 18760002
*    ****************************************************************** 18830002
*    *                                                                * 18900002
* +32*                        FAILING CCW                             * 18970002
*    *                                                                * 19040002
*    ****************************************************************** 19110002
*    *                                                                * 19180002
* +40*                      CHANNEL STATUS WORD                       * 19250002
*    *                                                                * 19320002
*    ****************************************************************** 19390002
*    * DEVICE *                *                                      * 19460002
* +48* DENP.  *SECONDARY       *              DEVICE TYPE             * 19530002
*    * DATA   *   CUA          *                                      * 19600002
*    ****************************************************************** 19670002
*    * SDR    *                *               *                      * 19740002
* +56* BYTE   *PRIMARY         *      I/O      *     SENCE BYTE       * 19810002
*    * CNT.   *  CUA           *     RETRIES   *        COUNT         * 19880002
*    ****************************************************************** 19950002
*    *                                                                * 20020002
* +64*                        DEVICE                                  * 20090002
*    *                                                                * 20160002
*    *                                                                * 20230002
*    /                                                                / 20300002
* +72/                     DEPENDENT                                  / 20370002
*    *                                                                * 20440002
*    **                                                               * 20510002
*    *                                                                * 20580002
* +80*                      INFORMATION                               * 20650002
*    *                                                                * 20720002
*    ****************************************************************** 20790002
*    *                                                                * 20860002
* +88*                   STATISTICS COUNTER AREA                      * 20930002
*    *                                                                * 21000002
*    ****************************************************************** 21070002
*    *   STATISTICS   *         STATISTICS COUNTER AREA               * 21140002
* +96*   CNTR. AREA   *            (IF MORE THAN 10 BYTES)            * 21210002
*    *     (CONT.)    *                                               * 21280002
*    ****************************************************************** 21350002
*    *                               *                                * 21420002
*+104*   STATISTICS COUNTER AREA     *       SENSE BYTE DATA          * 21490002
*    *          (CONTINUE)           *         (VARIABLE ON DEVICE)   * 21560002
*    *********************************                                * 21630002
*    *                                                                * 21700002
*    /                                                                / 21770002
*    /                                                                / 21840002
*    *                                                                * 21910002
*    ****************************************************************** 21980002
       EJECT                                                            22050002
*                         OBR SHORT RECORD                            * 22120002
*     ***************************************************************** 22190002
*     * CLASS * SYSTEM *                             *                * 22260002
* +0  *-------*RELEASE *  S W I T C H E S            *                * 22330002
*     *SOURCE *        *                             *                * 22400002
*     ***************************************************************** 22470002
*     *                               *                               * 22540002
* +8  *           DATE                *           TIME                * 22610002
*     *                               *                               * 22680002
*     ***************************************************************** 22750002
*     *       *                       *               *               * 22820002
* +16 *  NOT  *  CPU SERIAL NUMBER    *  CPU IDENTITY *   NOT USED    * 22890002
*     *  USED *                       *               *               * 22960002
*     ***************************************************************** 23030002
*     *                               *  SDR   *                      * 23100002
* +24 *        DEVICE TYPE            * LENDTH *   CHANNEL UNIT       * 23170002
*     *                               *        *            ADDRESS   * 23240002
*     ***************************************************************** 23310002
*     *                                                               * 23380002
* +32 /             STATISTIC COUNTER AREA                            / 23450002
*     /                                                               / 23520002
*     *               (10 OR 20 BYTES)                                * 23590002
*     *                                                               * 23660002
*     ***************************************************************** 23730002
         EJECT                                                          23800002
*                        T TYPE NON-STANDARD RECORD                   * 23870002
*                          FOTMATTED BY - MDR                         * 23940002
*********************************************************************** 24010002
*       *  CLASS/ * SYS./ *             * REC. *                      * 24080002
*  +0   *   SOURCE* REL-  *  SWITCHES   *  ID  *   SPARES             * 24150002
*       *   (91)  *  EASE *             *      *                      * 24220002
*       *************************************************************** 24290002
*       *                               *                             * 24360002
*  +8   *           DATE                *         TIME                * 24430002
*       *                               *                             * 24500002
*       *************************************************************** 24570002
*       *  NOT    *      CPU            *   CPU      *   NOT          * 24640002
*  +16  *   USED  *      SERIAL         *  IDENTITY  *     USED       * 24710002
*       *         *        NUMBER       *            *                * 24780002
*       *************************************************************** 24850002
*       *                                                             * 24920002
*  +24  *        DEVICE DEPENDENT DATA  --- VARIABLE                  * 24990002
*       *                                                             * 25060002
*********************************************************************** 25130002
       EJECT                                                            25200002
*                                                                       25270002
*      THE FOLLOWING EQUATES ARE FOR GENERAL PURPOSE REGISTERS          25340002
*                                                                       25410002
ZEROREG  EQU   0                       REGISTER  0 USED FOR ADDR'BITITY 25480002
R0PARM   EQU   0                       REGISTER  0 PARAMETER            25550002
R1PARM   EQU   1                       REGISTER  1 PARAMETER            25620002
R2CVTBAS EQU   2                       REGISTER  2 CVT BASE             25690002
R3CBASE  EQU   3                       REGISTER  3 CSECT BASE           25760002
R4UCB    EQU   4                       REGISTER  4 UCB POINTER          25830002
R5WORK   EQU   5                       REGISTER  5 WORK REG             25900002
R6WORK   EQU   6                       REGISTER  6 WORK REG             25970002
R7WORK   EQU   7                       REGISTER  7 WORK REG             26040002
R8RECADR EQU   8                       REGISTER  8 ADDR OF MDR RECORD   26110002
R8WORK   EQU   8                       REGISTER  8 WORK REG - ADDR OF   26180002
*                                                   SDR AREA OF RECORD  26250002
*                                                   PASSED FROM 1STLOAD 26320002
R9LOGBAS EQU   9                       REGISTER  9 DSECT BASE           26390002
R10SIZE  EQU   10                      REGISTER 10 RECORD SIZE          26460002
R10WORK  EQU   10                      REGISTER 10 WORK REG             26530002
R11BUFSV EQU   11                      REGISTER 11 MDR BUFFER ADDRESS   26600002
R11CNTRL EQU   11                      REGISTER 11 CONTROL BAL          26670002
R11WORK  EQU   11                      REGISTER 11 WORK REG             26740002
R12IOB   EQU   12                      REGISTER 12 ADDR OF IOB          26810002
R13PARM  EQU   13                      REGISTER 13 PARM TO XCTL         26880002
R14EXIT  EQU   14                      REGISTER 14 EXIT ADDR            26950002
R14LINK  EQU   14                       LINK REGISTER            Y02021 27020002
R15CODE  EQU   15                      REGISTER 15 COND CODE            27090002
*                                                                       27160002
*      THE FOLLOWING EQUATES ARE FOR ABSOLUTE VALUES,CONDITION CODE     27230002
*        SETTINGS, AND SVC NUMBERS                                      27300002
*                                                                       27370002
ADDONE   EQU   1                       TO ADD ONE TO ANY COUNT          27440002
HALFBYTE EQU   4                       NUM OF BITS IN HALF A BYTE       27510002
MAKBIN   EQU   9                       NUM TO MAKE BINARY REPRESENTAION 27580002
*                                       OF HEX ALPHABETICS(EG.C1+9=CA)  27650002
ENDREG   EQU   20                      NUM OF BITS TO SHIFT CUA TO LOW  27720002
*                                       ORDER BYTES OF REG              27790002
*                                       ARE 'ON'                        27860002
EQUAL    EQU   8                       EQUAL CONDITION CODE             27930002
TCRECLEN EQU   82                      LEN OF A TCAM RECORD             28000002
*                                       ONLY 4 BITS IN A REG            28070002
NXTSDRST EQU   256                     NUM OF BYTES IN A STAT TAB SECTN 28140002
TCAMREC  EQU   X'34'                   RECORD CLASS/SOURCE - TCAM       28210002
ATCMEXT1 EQU   X'28'                   STCAM ERP CODE          @Y30APDZ 28220003
ATCMEXT2 EQU   X'6A'                    ATCAMERP CODE          @Y30APDZ 28230003
ATCAMREC EQU   X'36'                    RECORD CLASS/COURSE - VTAM      28240003
EXIT     EQU   3                       SVC NUM TO RETURN TO SUPERVISOR  28280002
ERREXCP  EQU   15                      SVC NUM TO FREE AN RQE           28350002
         EJECT                                                          28420002
*      THE FOLLOWING EQUATES ARE FOR LENGTHS & DISPLACEMENTS            28490002
*                                                                       28560002
ZERO     EQU   0                       DIS OF ZERO                      28630002
TWO      EQU   2                       DIS OF TWO                       28700002
*                                       AND WORD CONTAINING ADDR OF SNS 28770002
*                                       TCAM FLAGS                      28840002
*                                       FLAG BYTE & ADDR OF CCH REC BUF 28910002
SIZE     EQU   2                       DIS TO SIZE OF RECORD   Z16953VM 28980030
*                                      IN CCH BUFFER RECORD    Z16953VM 29080030
ONE      EQU   1                       LENGHT OF ONE                    29190002
THREE    EQU   3                       LENGHT OF THREE                  29260002
CUA      EQU   3                       LENGHT OF CUA                    29330002
FOUR     EQU   4                       LENGHT OF FOUR                   29400002
SIX      EQU   6                       FOR PACKING PCCA CPUID  Z15459VM 29405030
FIVE     EQU   5                        LENGTH OF FIVE         @G30HIMD 29410002
SEVEN    EQU   7                                               @Z40RSVS 29420004
HEX00    EQU   X'00'                                           @Z40RSVS 29440004
EIGHT    EQU   X'08'                    MASK                     Y02021 29470002
HEXDF     EQU   X'DF'                                          @AZ08966 29490003
HEXC0    EQU   X'C0'                                           @AZ08966 29510003
TWELVE   EQU   12                      CONSTANT OF 12          @YM6451P 29540002
SIXTEEN  EQU   16                      CONSTANT OF 16          @YM6451P 29610002
TWENTY6  EQU   26                      FOR SSL ALL BUT 4 BITS  Z15459VM 29630030
TWENTY8  EQU   28                       & MULTIPLYING BY 4.    Z15459VM 29650030
OLDSDR   EQU   10                      LENGTH OF OLD STAT TAB ENTRY     29680002
NXTSTAD  EQU   2                       LENGTH OF UCB ADDRESSES          29750002
DEVTYPE  EQU   2                       LENGTH OF DEV CLASS FLD IN UCB   29820002
HDR      EQU   32                       LENGTH OF SHORT RE HDR   X03127 29890002
*                                       OF EXPANDED SENSE DATA          29960002
*                                       MAGNETIC TAPE EXTENSION         30030002
*                                       UCB EXTENSION                   30100002
SNB040   EQU   4                       DIS TO 4TH SENSE BYTE            30170002
SNB020   EQU   2                   DIS TO 2ND SENSE BYTE       @Z40RSVS 30190004
EMULATE  EQU   X'08'               DEVICE EMULATION ACTIVE     @Z40RSVS 30210004
*                                       ZEUS IN THE ERP WORK AREA       30240002
SNSBYT   EQU   1                       LENGTH OF ONE SENSE BYTE         30310002
RELLN    EQU   2                       LENGTH OF REL # IN CVT           30380002
CSWLEN   EQU   7                       LENGTH OF THE CSW                30450002
DBLWRD   EQU   8                       LENGTH OF 2 FULL WORDS           30520002
JOBLEN   EQU   8                       LENGTH OF JOB NAME FROM TIOT     30590002
CCWLEN   EQU   8                       LENGTH OF A CCW                  30660002
THREEDBL EQU   24                      LENGTH OF THREE DOUBLE WORDS     30730002
FOURDBL  EQU   32                      LENGTH OF 4 DOUBLE WDS  @YM6451P 30800002
FIVEDBL  EQU   40                       LENGTH OF 5 DOUBLE WDS  YM5956P 30830002
SAVLEN   EQU   72                       LENGTH OF SAVE REG AREA         30870002
LOGLEN   EQU   256                     LENGTH OF LOG DSECT - WORK AREA  30940002
INCOM    EQU   X'40'                   BIT IN SW1 FLD=SHORT 3670 REC    31010002
FOX      EQU   X'0F'                   INSTRUCTION MASK        @YM6451P 31080002
VS2IND   EQU   X'80'                    VS2 SYSTEM RELEASE IND.  Y02021 31150002
TPEREC   EQU   X'91'                   RECORD CLASS & SOURCE - MDR      31220002
LOGCLR   EQU   X'FE'                    CLEAR IOSLOG FLAG      @YM2957P 31310002
HEX20    EQU   X'20'                    160 BYTE INDICATOR     @YM2957P 31320002
TPERRUNG EQU   X'FE'                   MDR RUNNING FLAG                 31360002
IOBERCCW EQU   40                      DIS IN IOB=ADDR OF BUFF-2715     31430002
SUCCESS  EQU   3                       DIS IN BUFFER=SUCCESS SYM RETRND 31500002
RELEN    EQU   2                       LENGTH OF REL # IN CVT PREFIX    31570002
MSG      EQU   3                       LENGTH OF 'TPR' SUCCESS MSG      31640002
MDRINFO  EQU   6                       LENGTH OF INFO DESCRIBING THE RC 31710002
REMHDR   EQU   18                      LENGTH OF THE HEADER REC MINUS 6 31780002
REMAINDR EQU   214                     LENGTH OF THE BODY OF THE REC    31850002
         EJECT                                                          31920002
*                                                                       31990002
*      THE FOLLOWING EQUATES ARE FOR ABSOLUTE VALUES,COND CODE          32060002
*        SETTINGS,AND SVC NUMBERS                                       32130002
*                                                                       32200002
HALFREG  EQU   16                      NUM OF BITS IN HALF A REGISTER   32270002
OK       EQU   X'00'                   SUCCESS SYMBOL=REC WRITTEN OK    32340002
TOSMALL  EQU   X'0F'                   SUCCESS SYMBOL=REC LENGTH <24    32410002
NOTSUC   EQU   X'FF'                   SUCCESS SYMBOL=REC NOT WRITTEN   32480002
ID3670   EQU   X'06'                   RECORD ID FOR A 3670             32550002
ID2715   EQU   X'08'                   RECORD ID FOR A 2715             32620002
         EJECT                                                          32690002
*                                                                       32760002
*      THE FOLLOWING EQUATES ARE FOR BIT AND MASK SETTINGS              32830002
*                                                                       32900002
OBRREC   EQU   X'30'                   UNIT CHECK - OBR RECORD TYPE     32970002
TEMPERR  EQU   X'40'                   BIT IN RECORD TO SIG A TEMP ERR  33040002
TIMEBIT  EQU   X'08'                   BIT IN REC TO SIG THAT THE TIME  33110002
*                                       MACRO WAS USED                  33180002
TCAMEXT1 EQU   X'2F'                   TCAM ERP SUFFIX - EXIT ROUTINE   33250002
TCAMEXT2 EQU   X'30'                   TCAM ERP SUFFIX - EXIT ROUTINE   33320002
TCAMEXT3 EQU   X'31'                   TCAM ERP SUFFIX - EXIT ROUTINE   33390002
HIGHBIT  EQU   X'07'                   BITS TO SAVE ONLY THE PHYSICAL   33460002
*                                       UNIT ADDR IN MERLIN SENSE BYTE  33530002
MERZEUS  EQU   X'01'                   BIT IN INTERNAL FLAGS FOR MER/ZU 33600002
TEMPSHRT EQU   X'60'                   BITS IN RECORD TO SIGNIFY A      33670002
*                                       TEMPORARY ERROR & A SHORT REC   33740002
SAVEUNIT EQU   X'0F'                   MASK TO SAVE UNIT ADDR           33810002
SAVECHAN EQU   X'F8'                   MASK TO SAVE CHANNEL ADDR + HIGH 33880002
*                                       ORDER BIT OF UNIT ADDR   S99204 33950002
NOTVALID EQU   X'0F'                   INVALID SENSE FOR 2314           34020002
NUMERIC  EQU   X'F0'                   MASK IN BYTE IF A NUMBER (FO-F9) 34090002
NOSDR    EQU   X'08'                   INTERNAL SW IF NO SDR INFO       34160002
*                                       IS NEEDED FOR THIS DEVICE       34230002
TCAMFLG  EQU   X'0F'                   BITS APPENDED TO ERPFLG IN REC   34300002
CLROPT   EQU   X'80'                   BIT IN STAT TAB=DO NOT CLEAR     34370002
*                                       OPTION LIMIT BYTE               34440002
SHORT    EQU   X'20'                   BIT IN SW FLD OF REC=SHORT OBR   34510002
         EJECT                                                          34580002
*                                                                       34650002
*      THE FOLLOWING EQUATES ARE FOR DEVICE CLASSES AND TYPES           34720002
*                                                                       34790002
DASD     EQU   X'20'                   DIRECT ACCESS DEV CLASS          34860002
         SPACE                                                          34930002
DA23051  EQU   X'06'                   UNIT TYPE - 2305-1 (ZEUS)        35000002
DA23052  EQU   X'07'                   UNIT TYPE - 2305-2 (ZEUS)        35070002
DA2314   EQU   X'08'                    UNIT TYPE - 2314/2319           35140003
DA3330   EQU   X'09'                                           @AZ08966 35170003
DA3340   EQU   X'0A'                   UNIT TYPE - 3340 WINCHSR XL03130 35210002
DA3350   EQU   X'0B'               UNIT TYPE - 3350            @Z40RSVS 35230004
HC0      EQU   X'C0'               MASK FOR CU ADDR            @Z40RSVS 35250004
         SPACE                                                          35280002
T3400    EQU   X'03'                   UNIT TYPE - 3400(ASPEN)          35350002
         SPACE                                                          35420002
UR3505   EQU   X'06'                   UNIT TYPE - 3505 - REDLAKE       35490002
UR3211   EQU   X'09'                   UNIT TYPE - 3211                 35560002
UR3525   EQU   X'0C'                   UNIT TYPE - 3525 - PIKLAKE       35630002
UR3838   EQU   X'4C'                   GUSHER-3838 DEVICE CODE @ZA26472 35660030
UR3886   EQU   X'17'                    UNIT TYPE-3886-SHARK     X03127 35700002
UR3850   EQU   X'42'                    UNIT TYPE-3850-SS/1     Y30LPDG 35720003
UR3895   EQU   X'19'                    UNIT TYPE-3895-MOHAWK  @G30HIMD 35730002
UR3540   EQU   X'44'                    UNIT TYPE-3540-ERIC     Y30OPDP 35740003
ARGO     EQU   X'0E'               UNIT TYPE-3800-ARGO         @Z402IVS 35750000
ARGERADR EQU   36                  3800 BUFFER ADDRESS         @Z402IVS 35760000
         EJECT                                                          35770002
IGE0025F CSECT                                                          35840002
         USING LOGDSECT,R9LOGBAS                                        35910002
LOGDSECT DSECT                                                          35980002
         SPACE                                                          36050002
*      STANDARD RECORD HEADER AREA                                      36120002
BLDAREA  DS    CL144                   RECORD FORMAT AREA               36190002
RECINFO  EQU   BLDAREA+24              RECORD INFO                      36260002
CLASRC   EQU   BLDAREA                 CLASS/SOURCE                     36330002
FLG1EWA  EQU   CLASRC                   PLACE FOR EWA FLAG              36360003
SYSREL   EQU   BLDAREA+1               SYS REL NUM                      36400002
SWITCHES EQU   BLDAREA+2               RECORD INDEPENDENT SWITCHES      36470002
SW1      EQU   BLDAREA+3               RECORD                           36540002
SW2      EQU   BLDAREA+4                      DEPENDENT                 36610002
SW3      EQU   BLDAREA+5                                SWITCHES        36680002
DATE     EQU   BLDAREA+8               DATE                             36750002
TIME     EQU   BLDAREA+12              TIME                             36820002
CPUSER   EQU   BLDAREA+16              CPU SERIAL NUMBER                36890002
CPUMOD   EQU   BLDAREA+20              CPU MODEL NUMBER                 36960002
         SPACE                                                          37030002
*       SHORT OBR RECORD FIELDS                                         37100002
SDEVTYP  EQU   BLDAREA+24              DEVICE TYPE                      37170002
SSDRCNT  EQU   BLDAREA+28              # OF SDR BYTES                   37240002
SCUA     EQU   BLDAREA+29              CHANNEL UNIT ADDRESS             37310002
SSDR     EQU   BLDAREA+32              SDR DATA - STAT COUNTERS         37380002
         SPACE                                                          37450002
*      FULL OBR RECORD FIELDS - UNIT CHECK                              37520002
JOBID    EQU   BLDAREA+24              JOB NAME                         37590002
FAILCCW  EQU   BLDAREA+32              FAILING CCW                      37660002
CSW      EQU   BLDAREA+40              CHANNEL STATUS WORD FIELD        37730002
CSW1     EQU   BLDAREA+41              CHANNEL STATUS WORD FIELD + 1    37800002
DEVDEPC  EQU   BLDAREA+48              # OF DBL WRDS IN DEV DEP DATA AR 37870002
SECUA    EQU   BLDAREA+49              SECONDARY/LOGICAL CHAN UNIT ADDR 37940002
SECUA0C  EQU   BLDAREA+50              CHANNEL PORTION OF SEC/LOG CUA   38010002
DEVTYP   EQU   BLDAREA+52              DEVICE TYPE                      38080002
SDRCNT   EQU   BLDAREA+56              # OF SDR BYTES                   38150002
PCUA     EQU   BLDAREA+57              PRIMARY CHAN UNIT ADDR           38220002
PCUA0C   EQU   BLDAREA+58              CHANNEL PORTION OF PRIM/PHYSICAL 38290002
PCUAUA   EQU   BLDAREA+59              UNIT ADDR PORTION OF PRIM/PHYS   38360002
IORETRY  EQU   BLDAREA+60              # OF I/O RETRIES(DOS ONLY)       38430002
SENSCNT  EQU   BLDAREA+62              # OF BYTES OF                    38500002
SENSCNT1 EQU   BLDAREA+63                             SENSE DATA        38570002
         SPACE                                                          38640002
*        DEVICE DEPENDENT DATA AREA - DIRECT ACCESS - 3 DOUBLE WORDS    38710002
VOLABEL  EQU   BLDAREA+64              VOLUME ID                        38780002
LASTSK   EQU   BLDAREA+72              LAST SEEK ADDRESS                38850002
HOMADDR  EQU   BLDAREA+80              HOME ADDRESS READ                38920002
SDR      EQU   BLDAREA+88              SDR WORK AREA - STAT COUNTERS    38990002
         SPACE                                                          39060002
*        DEVICE DEPENDENT DATA AREA - 3211 PRINTER - 1 DOUBLE WORD      39130002
IDTYPE  EQU    BLDAREA+64              CORRELATION NUMBER               39200002
         EJECT                                                          39270002
*        DEVICE DEPENDENT DATA AREA - 3400 TAPE - ASPEN - 3 DBL WORDS   39340002
AVOLABEL EQU   BLDAREA+64              VOLUME LABEL                     39410002
ADEVDPDT EQU   BLDAREA+72              SPECIAL IN-CORE CNTRS FOR 3400'S 39480002
         SPACE                                                          39550002
*        DEVICE DEPENDENT DATA AREA - TCAM OBR                          39620002
TSIOCNT  EQU   BLDAREA+64              # OF START I/O INST              39690002
TTEMPERR EQU   BLDAREA+66              # OF TEMPORARY ERRORS            39760002
TMASK    EQU   BLDAREA+67              LINE MASK                        39830002
TOP1     EQU   BLDAREA+68              TCAM OP                          39900002
TOP2     EQU   BLDAREA+69                      CODES                    39970002
TFLAGS   EQU   BLDAREA+70              FLAG BYTE                        40040002
TGRAPHIC EQU   BLDAREA+71              GRAPHIC CHARACTER -FROM LCBSENS1 40110002
TTERMNAM EQU   BLDAREA+72              TERMINAL NAME                    40180002
TSENSE0  EQU   BLDAREA+80              SENCE BYTE ZERO - FROM LCBSENS0  40250002
TSENSE1  EQU   BLDAREA+81              SENCE BYTE ONE - FROM LCBSNSV    40320002
*      AREA USED FOR CHANNEL ERROR MESSAGE                              40390002
MSGAREA  EQU   BLDAREA+16              CHANNEL ERROR MSG                40460002
MSGCUA   EQU   MSGAREA+38              CUA PORTION OF MSG               40530002
MSGCUA1  EQU   MSGCUA+1                 CUA OFFSET IN MSG        XM0462 40600002
CUAVAL   EQU   1                        CUA UNIT ADDR VALID      XM0462 40670002
MSGBLAME EQU   MSGAREA+51              BLAME FIELD PORTION OF MSG       40740002
MSGOPCD  EQU   MSGAREA+56              FAILING OP CODE PORTION OF MSG   40810002
MSGSTAT  EQU   MSGAREA+59              FAILING DEV/CHAN STATUS          40880002
MSGTIME  EQU   MSGAREA+63              TIME STAMP                       40950002
         SPACE                                                          41020002
*      THE FOLLOWING ARE USED AS WORK AREAS FOR INITIALIZING THE MSG    41090002
UNPKAREA EQU   MSGAREA+79              UNPACK WORK AREA                 41160002
STAT     EQU   UNPKAREA-1              PACKED STATUS                    41230002
OPCD     EQU   UNPKAREA-2              PACKED OP CODE                   41300002
UNPKOPCD EQU   UNPKAREA                UNPACKED OP CODE POSITION        41370002
UNPKSTAT EQU   UNPKAREA+2              UNPACKED STATUS POSITION         41440002
UNPKCUA   EQU  UNPKAREA+3              UNPACK CUA AREA                  41510002
         SPACE                                                          41580002
*      THE FOLLOWING MSG AREAS ARE USED TO FORMAT THE TIME STAMP        41650002
TIMEAREA EQU   MSGTIME                 TIME WORK AREA                   41720002
*              UNPACKED TIME =   HHMMSSTH                               41790002
UNPKHH   EQU   TIMEAREA+3              UNPACKED HOURS - HH              41860002
UNPKMM   EQU   TIMEAREA+5              UNPACKED MINUTES - MM            41930002
UNPKSS   EQU   TIMEAREA+7              UNPACKED SECONDS - SS            42000002
UNPKTEN  EQU   TIMEAREA+9              UNPACKED TENTHS OF A SECOND - T  42070002
UNPKHUN  EQU   TIMEAREA+10             UNPACKED HUNDREDS OF A SECOND -H 42140002
*              FORMATED TIME = HH.MM.SS                                 42210002
FORHH    EQU   TIMEAREA+1              FORMATED HOURS - HH              42280002
FRSTDOT  EQU   TIMEAREA+3              FIRST PERIOD - AFTER HH          42350002
FORMM    EQU   TIMEAREA+4              FORMATED MINUTES - MM            42420002
SECDOT   EQU   TIMEAREA+6              SECOND PERIOD - AFTER MM         42490002
FORSS    EQU   TIMEAREA+7              FORMATED SECONDS - SS            42560002
         SPACE 2                                                        42630002
SAVEREGS DS    CL20                     SAVE AREA                Y02021 42700002
WORKAREA EQU   SAVEREGS                 WORK AREA                Y02021 42770002
STAELIST DS    CL16                     STAE LIST AREA           Y02021 42840002
ESTAPARM DS    2F                       STAE PARAM LIST AREA     Y02021 42910002
         DS    CL50                     ALIGHNMENT                      42980002
FLAGS    DS    CL1'0'                   INTERNAL FLAGS                  43050002
*        MRRLIN/ZEUS     -  X'01'                                       43120002
*        CCH MESSAGE     -   X'02'                                      43190002
*        BYPASS WRITTING REC-X'04'     FOR 2ND LOAD                     43260002
*        BYPASS SDR INFO    -X'08'     FOR 2ND LOAD                     43330002
INTSW    DS    CL1                      INTERNAL SWITCH          Y02021 43400002
GOTCORE  EQU   X'01'                    GETMAIN OK IND           Y02021 43470002
TCAMTYPE EQU   X'04'                    TCAM RECORDING           Y02021 43610002
MDRTYPE  EQU   X'08'                    MDR RECORDING            Y02021 43680002
CLRDIR   EQU   X'FD'                    CLEAR DIR BIT            Y02021 43750002
IOSBADDR DS    CL4                      IOSB POINTER             Y02021 43820002
OBRECB   DS    CL4                      SAVE                            43890002
REG2715  EQU   OBRECB                   2715 SAVE AREA                  43960002
BINXCTL  DS    CL3                      SPECIAL XCTL SAVE AREA          44030002
         DS    CL1                      SPARE                    Y02021 44100002
SAVEPTR  DS    CL4                      POINTER TO REG SAVE AREA Y02021 44170002
REGSAVE  DS    CL72                     STANDARD REG SAVE AREA @YM2957P 44240002
WRK1AREA EQU   REGSAVE                  MDR WORK AREA            Y02021 44310002
         EJECT                                                          44380002
         USING MDRBUFFR,R8RECADR                                        44450002
MDRBUFFR DSECT                                                          44520002
         SPACE                                                          44590002
BUFFER   DS    CL238                   BUFFER LENGTH           @YM6451P 44660002
*      THE FOLLOWING FIELDS ARE COMMON TO ALL MDR BUFFERS - SIX BYTES   44730002
BUFSIZE  EQU   BUFFER                  SIZE OF THIS RECORD              44800002
BUFSUBID EQU   BUFFER+2                VARIABLE SUB ID                  44870002
BUFXCTL  EQU   BUFFER+3                SPECIAL XCTL INFO                44940002
BUFRECID EQU   BUFFER+5                ID OF DEVICE FOR WHICH RECORD    45010002
*                                       WILL BE GENERATED               45080002
*      THE FOLLOWING FIELDS ARE AVAILABLE IN A FORMATTED BUFFER         45150002
EXTRA18  EQU   BUFFER+6                18 BYTES OF ZEROS-FOR HEADER     45220002
FBUFBODY EQU   BUFFER+24               BODY OF RECORD IN FORMATTED BUFF 45290002
         SPACE                                                          45360002
*      THE FOLLOWING HEADER WILL BE PUT IN THE FIRST 24 BYTES OF BUFFER 45430002
MCLASRC  EQU   BUFFER                   RECORD CLASS AND SOURCE  Y02021 45500002
MSYSREL  EQU   BUFFER+1                 SYSTEM RELEASE           Y02021 45570002
MSWITCHS EQU   BUFFER+2                 SWITCHES                 Y02021 45640002
MSW1     EQU   BUFFER+3                 SWITCH FLD               Y02021 45710002
MRECID   EQU   BUFFER+4                 RECORD ID                Y02021 45780002
MSUBID   EQU   BUFFER+5                 VAR SUBID FIELD LENGTH   Y02021 45850002
SPARE    EQU   BUFFER+6                SPARE FIELD                      45920002
MDATE    EQU   BUFFER+8                 DATE                     Y02021 45990002
MTIME    EQU   BUFFER+12                TIME                     Y02021 46060002
MCPUSER  EQU   BUFFER+16                CPU SERIAL #             Y02021 46130002
MCPUMOD  EQU   BUFFER+20                CPU MODEL #              Y02021 46200002
BUFINFO  EQU   BUFFER+24               DEVICE DEPENDENT BODY OF RECORD  46270002
*      THE FOLLOWING FIELD IS AVAILABLE FOR A NON-FORMATTED BUFFER      46340002
*        IE-2715,3270(BTAM)                                             46410002
BUFBODY  EQU   BUFFER+6                BODY OF RECORD                   46480002
         SPACE                                                          46550002
       EJECT                                                            46620002
         USING CVTMAP,R2CVTBAS                                   Y02021 46690002
         CVT   DSECT=YES,LIST=YES                                       46760030
         EJECT                                                          46830002
         USING UCBOB,R4UCB                                       Y02021 46900002
         USING UCBUCS,R6WORK                                            46970002
         USING UCBCMEXT,R10WORK                                @YM00142 47000002
         IEFUCBOB LIST=YES,PREFIX=YES                                   47040002
         EJECT                                                          47110002
         IECDIOCM                                                       47180002
         EJECT                                                          47250002
         IHASRB                                                         47320002
         EJECT                                                          47390002
         IHAPSA                                                         47460002
         EJECT                                                          47530002
         USING IOSB,R12IOB                                              47600002
         IECDIOSB                                                       47670002
         EJECT                                                          47740002
         USING EWA,R1PARM                                               47810002
         IECDERWA  (ALL)                                        YM7629P 47950002
         EJECT                                                          48020002
         USING ASCB,R5WORK                                       Y02021 48090002
         IHAASCB                                                        48160002
         EJECT                                                          48230002
IGE0025F CSECT                                                          48300002
*********************************************************************** 48370002
*                                                                     * 48440002
*****    ENTRY  TO  OUTBOARD  RECORDER  (OBR)  ROUTINE            ***** 48510002
*                                                                     * 48580002
*                        XCTL LOAD NAME - 025F                        * 48650002
*                                                                     * 48720002
*********************************************************************** 48790002
         SPACE 2                                                        48860002
         SPACE 2                                               @Y17CSWT 48930003
**** MODULE DISTRIBUTION LIBRARY ID AND CREATION DATE.         @Y17CSWT 48940003
         USING *,15                                            @Y17CSWT 48950003
OBRSTART BAL   R3CBASE,OBRSTL2        INIT BASE REG & BRANCH   @Y17CSWT 48960003
         USING *,R3CBASE                AROUND ID & DATE       @Y17CSWT 48970003
         DROP  15                      DROP TEMP BASE REG      @Y17CSWT 48980003
         DC    AL1(OBRSTL2-OBRSTL1)    LENGTH OF MOD ID & DATE @Y17CSWT 48990003
OBRSTL1  DC    CL8'IFBOBR00'           MODULE ID               @Y17CSWT 49000003
         DC    C'&SYSDATE'             DATE OF COMPILATION     @Y17CSWT 49010003
OBRSTL2  DS    0H                      CONTINUE PROCESSING     @Y17CSWT 49020003
         SPACE 2                                               @Y17CSWT 49030003
         USING OBRPGMCK,R15CODE                                         49070002
         L     R2CVTBAS,CVTPTR         LOAD CVT POINTER                 49140002
         LR    R12IOB,R1PARM            GET IOSB POINTER         Y02021 49210002
         GETMAIN RC,LV=328,SP=255                                Y02021 49420002
         LR    R9LOGBAS,R1PARM          GET WORK AREA POINTER    Y02021 49490002
         LR    R1PARM,R12IOB            RESTORE REG 1            Y02021 49560002
         LTR   R15CODE,R15CODE          TEST FOR RETURN CODE     Y02021 49630002
         BZ    YESGET              YES,GETMAIN IS GOOD         @ZA02772 49700003
         TM    IOSPKEY,IOSIDR      NO, DIR RECORDING?          @ZA02772 49710003
         BO    NOMAIN1             YES,EXIT--IOSB/SRB/EWA CANNOT BE     49720003
**                                 FREED                       @ZA02772 49730003
         TM    CVTOPTA,CVTNIP      NIP RUNNING?                @ZA02772 49740003
         BO    NOMAIN              FREE IOSB                   @ZA02772 49750003
*                                                                       49770002
**     TEST FOR MDR RECORD OR GO CHECK FOR TCAM EOD RTN OR DDR          49840002
*                                                                       49910002
         L     R1PARM,IOSERP            GET EWA ADDRESS          Y02021 49980002
         L     R4UCB,IOSUCB             GET UCB ADDRESS          Y02021 50050002
         TM    EWAFLG2,EWAMDR           TEST FOR MDR             Y02021 50120002
         BZ    TCREC1                   NO-GO TEST FOR TCAM      Y02021 50190002
         B     MDR1                     BRANCH TO SPECIAL ENTRY  Y02021 50260002
         SPACE 1                                                        50330002
YESGET   TM    CVTOPTA,CVTNIP      NIP RUNNING?                @ZA02772 50340003
         BZ    CLRMAIN             YES,GO PROCESS              @ZA02772 50350003
         TM    IOSPKEY,IOSIDR      DIR RECORDING?              @ZA02772 50360003
         BO    DIRTST              YES, GO DELETE IOSB/SRB/EWA @ZA02772 50370003
         B     NOMAIN              NO, GO FREE IOSB            @ZA02772 50380003
CLRMAIN  XC    BLDAREA(LOGLEN),BLDAREA  CLEAR GOTTEN CORE        Y02021 50400002
         XC    REGSAVE(SAVLEN),REGSAVE  CLEAR GOTTEN CORE        Y02021 50470002
         ST    R1PARM,IOSBADDR          SAVE IOSB POINTER        Y02021 50540002
         MVC   STAELIST(SIXTEEN),ESTALIST    GET LIST TO MAIN    Y02021 50610002
         LA    R5WORK,ESTAPARM          GET PARAM LIST ADDR      Y02021 50680002
         STM   R2CVTBAS,R12IOB,ESTAPARM SAVE REGISTERS FOR ESTAE Y02021 50750002
         LA    R1PARM,STAELIST          GET STAE LIST ADDR       Y02021 50820002
         L     R6WORK,PGMCKADD          GET ESTAE RTN ADDR       Y02021 50890002
         ESTAE (6),PARAM=(5),MF=(E,(1))                                 50960002
         L     R1PARM,IOSERP            GET EWA ADDRESS          Y02021 51030002
DIRENTRY L     R4UCB,IOSUCB             GET UCB ADDRESS          Y02021 51100002
         SR    R15CODE,R15CODE          CLEAR CODE REG           Y02021 51170002
         TM    EWAFLG2,EWAMDR           TEST FOR MDR             Y02021 51240002
         BO    MDR                      YES - BRANCH             Y02021 51310002
*                                                                       51380002
**     ROUTINE TO BUILD THE RECORD HEADER - FIRST 24 BYTES              51450002
*                                                                       51520002
         TM    IOSFLB,IOSSDR       NO OBR RECORDING?           @Z402IVS 51540000
         BO    DIRTST              YES,EXIT                    @Z402IVS 51560000
         MVI   CLASRC,OBRREC           SET RECORD TYPE - CLASS/SOURCE   51590002
         TM    IOSFLA,IOSEX+IOSERR PERMANENT ERROR?            @ZA06044 51660003
         BM    SETREL              YES, BYPASS SETTING TEMP FLAG        51730003
         OI    SW1,TEMPERR             SET TEMPERARY ERROR SW    A44509 51800002
         SPACE                                                          51870002
SETREL   LR    R11WORK,R2CVTBAS        LOAD CVT ADDR                    51940002
         SH    R11WORK,CONST4          SUBTRACT TO ADDR OF REL #        52010002
         PACK  WORKAREA(DBLWRD),ZERO(RELLN,R11WORK)   PACK REL #        52080002
         CVB   R11WORK,WORKAREA         CONVERT REL # TO BINARY  Y02021 52150002
         STC   R11WORK,SYSREL          STORE REL # IN REC               52220002
         OI    SYSREL,VS2IND            SET VS2 IND IN RECORD    Y02021 52290002
         TIME  DEC                     GET TIME AND DATE                52360002
         ST    R0PARM,TIME             STORE TIME IN REC                52430002
         ST    R1PARM,DATE             STORE DATE IN REC                52500002
         MVI   SWITCHES,TIMEBIT        SET'TIME MACRO USED' SW IN REC   52570002
         EJECT                                                 Z15459VM 52640030
*                                                              Z15459VM 52670030
**** OBTAIN CPUID OF MACHINE ON WHICH ERROR OCCURED.           Z15459VM 52700030
*                                                              Z15459VM 52730030
         LA    R4UCB,CPUSER            R4=@ CPUID FIELD IN OBR Z15459VM 52760030
         BAL   R6WORK,CPUIDRTE         OBTAIN CPUID FOR ERP CPUZ15459VM 52790030
         SPACE                                                          52850002
         MVC   SECUA0C(TWO),UCBCHA      MOVE SEC/ALT CUA TO REC  Y02021 52920002
         MVC   DEVTYP(FOUR),UCBTYP      MOVE DEV TYPE TO REC     Y02021 52990002
         SPACE 2                                                        53060002
*                                                                       53130002
*      FIND PRIMARY/PHYSICAL CHANNEL UNIT ADDRESS OF FAILING DEVICE     53200002
*                                                                       53270002
         MVC   PCUA0C(TWO),EWACHA  MOVE IN EWA CUA             @ZA03185 53280003
         OC    PCUA0C(TWO),PCUA0C  IS IT ZERO?                 @ZA03185 53290003
         BNZ   EWACUA              NO, EXIT                    @ZA03185 53300003
         LA    R5WORK,CUA              LOAD NUM OF CHAR IN A CUA        53340002
         L     R6WORK,UCBNAME-ONE       LOAD NUM OF CHAR IN CUA  Y02021 53410002
LABL1    STC   R6WORK,SAVEREGS         STORE CHAR OF CUA                53480002
         TM    SAVEREGS,NUMERIC        IS IT NUMERIC                    53550002
         BO    LABL2                   YES - BR TO CONTINUE             53620002
         LA    R6WORK,MAKBIN(R6WORK)   ADD 9 TO LOW ORDER BITS OF BYTE  53690002
LABL2    SRDL  R6WORK,HALFBYTE         SHIFT 4 LOW ORDER BITS TO NXT RG 53760002
         SRL   R6WORK,HALFBYTE         SHIFT OUT UNWANTED BITS          53830002
         BCT   R5WORK,LABL1            BR IF THERE ARE MORE CHAR'S      53900002
         SRL   R7WORK,ENDREG           SHIFT BINARY CUA TO LOW ORDER    53970002
         STH   R7WORK,PCUA0C           STORE PRIM/PHY CUA IN REC        54040002
         SPACE                                                          54110002
         EJECT                                                          54180030
*                                                                       54210030
*      THE FOLLOWING CHECKS FOR TCAM AND IF A FULL OBR RECORD IS NEEDED 54250002
*                                                                       54320002
EWACUA   EQU   *                                               @ZA03185 54330003
         L     R10WORK,UCBEXTPT         UCB EXTENSION POINTER  @YM00142 54350002
         CLI   UCBETI,TCAMEXT1          WAS A TCAM ERP USED      Y02021 54390002
         BL    TCAM1                   TEST FOR ATCAM CODE     @Y30APDZ 54460003
         CLI   UCBETI,TCAMEXT3          WAS A TCAM ERP USED 3705 Y02021 54670002
         BH    TCAM2                    TEST FOR ATCAM  ODE    @Y30APDZ 54740003
TCREC    MVI   CLASRC,TCAMREC          SET REC TYPE CLASS/SOURCE - TCAM 54810002
         TM    EWTCFLG,EWTCOVF+EWTCEOD  TEST FOR OVRFLO OR EOD   Y02021 54880002
         BZ    FULLREC                 NO - BR TO MAKE A FULL OBR REC   54950002
         B     TAMOFL                  YES - BR TO INIT TCAM ONLY FLDS  55020002
TCAM1    CLI   UCBETI,ATCMEXT1          WAS AN ATCAM ERP USED  @Y30APDZ 55025003
         BE    ATCMREC                  YES, PUT IN NEW CLASS REC       55030003
TCAM2    CLI   UCBETI,ATCMEXT2         WAS AN ATCAM ERP USED   @Y30APDZ 55035003
         BNE   TSTPERM                 NO, GO ON PROCESSING    @Y30APDZ 55040003
ATCMREC  MVI   CLASRC,ATCAMREC         PUT IN ATCAM CLASS REC ID        55045003
         TM    EWAFLG3,X'01'           PERM ERROR              @Y30APDZ 55050003
         BO    FULLREC                 YES                     @Y30APDZ 55055003
         TM    EWTCFLG,EWTCOVF+EWTCEOD  OVERFLOW-EOD           @Y30APDZ 55060003
         BNZ   TAMOFL                  YES                     @Y30APDZ 55065003
         OI    EWTCFLG,EWTCOVF         TURN ON OVERFLOW        @Y30APDZ 55070003
         B     TAMOFL                                          @Y30APDZ 55075003
         SPACE                                                          55090002
*      A CHECK IS MADE FOR A FULL OBR RECORD IF ONE OF THE FOLLOWING:   55160030
*        .PERMANENT ERROR,I.E.,IOSEX | IOSERR(EXCLUSIVE OR)             55170030
*        .LONG OBR REQUESTED,I.E. IOSLOG BIT ON.                        55180030
*        .ROTATIONAL POSITION SENSING (RPS) DEVICE.(3800 NOT SUPPORTED) 55190030
*        .COUNTER OVERFLOW FOR VARIABLE LENGTH SDR DEVICE.              55200030
*                                                                       55210030
TSTPERM  TM    IOSFLA,IOSEX+IOSERR     PERMANENT ERROR?        @ZA06044 55220030
         BM    FULLREC             YES, OUTPUT FULL RECORD     @ZA06044 55230003
         TM    IOSFLB,IOSLOG           LONG OBR REQUESTED?     Z12990VM 55250003
         BO    FULLREC                 YES-CREATE LONG OBR     Z12990VM 55270003
         CLI   UCBTBYT3,UCB3UREC   IS THIS A UNIT RECORD DEV?  @Z402IVS 55274000
         BNE   TSTPERM1            NO-BYPASS 3800 CHECK        Z12032VM 55278000
         CLI   UCBTBYT4,UCB3800    IS IT A 3800 DEVICE?        @Z402IVS 55282000
         BE    FULLREC             YES,GO TEST FOR FULL RECORD @Z402IVS 55286000
         B     TSTOVFL             NO-BYPASS DASD/RPS CHECK    Z12032VM 55290000
TSTPERM1 EQU   *                   CONTINUE W DASD/RPS CHK     Z12032VM 55294000
         CLI   UCBTBYT3,UCB3DACC     IS IT DASD?               @AZ07944 55300003
         BNE   TSTOVFL               NO TEST CNTR. OVFL.       @AZ07944 55310003
         TM    UCBTBYT2,UCBRPS       IS IT RPS?                @AZ07944 55320003
         BO    FULLREC               YES FULL OBR              @AZ07944 55330003
TSTOVFL  TM    EWAFLG2,EWACOVF       TEST FOR CNTR. OVFL.      @AZ07944 55340003
         BZ    TERM                    NO CHECK FOR TCAM       @Z40RSVS 55370003
         TM    UCBFL5,UCBVSDR           CHECK FOR VAR LENGTH SDR Y02021 55440002
         BZ    SHOBR                   NO - BR TO PROCESS A SHORT OBR   55510002
         OI    SW1,TEMPERR             SET TEMP ERROR SW FOR NEW DEVICE 55580002
         EJECT                                                          55610030
*                                                                       55650002
*      ROUTINE TO FIND THE FAILING JOD IDENTITY                         55720002
*                                                                       55790002
FULLREC  TM    IOSPKEY,IOSIDR      TEST FOR FULL RECORD        @ZA02772 55860003
         BZ    FULLRECA                 NO-BRANCH AROUND         Y02021 55930002
         MVC   JOBID(JOBLEN),DIRJOB     PUT IN DIR JOB           Y02021 56000002
         B     SETPTR                   CONTINUE                 Y02021 56070002
         SPACE 1                                                        56140002
FULLRECA L     R5WORK,CVTTCBP           GET TABLE POINTER        Y02021 56210002
         L     R5WORK,TWELVE(R5WORK)    GET CURRENT ASCB PTR     Y02021 56280002
         L     R5WORK,ASCBJBNI          GET PTR TO JOB ID        Y02021 56350002
         LTR   R5WORK,R5WORK            TEST FOR ADDRESS         Y02021 56370002
         BZ    SETPTR                   NO JOBNAME IF ZERO       Y02021 56390002
         MVC   JOBID(JOBLEN),ZERO(R5WORK)    MOVE JOB NAME TO RE Y02021 56420002
         SPACE                                                          56490002
SETPTR   LA    R8WORK,VOLABEL          LOAD ADDR OF DEVICE DEPENDENT    56560002
         SPACE                                                          56630002
*                                                                       56700002
*      ROUTINE TO DETERMINE DEVICE TYPE OF FAILING UNIT                 56770002
*                                                                       56840002
         CLI   UCBTBYT3,UCB3UREC        TEST FOR UNIT RECORD     Y02021 56910002
         BE    CK3505                  YES - BR TO CK TYPE              56980002
         CLI   UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02021 57050002
         BE    TAPES                   YES - BR TO CK TYPE              57120002
         CLI   UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS   Y02021 57190002
         BNE   CCWCSW                  NO - BR TO GET CCW/CCW-NO DDD    57260002
         L     R5WORK,EWADCNT           GET POINTER TO DEV DEP   Y02021 57330002
         LA    R5WORK,FIVEDBL(R5WORK)   POINTER TO DA SENSE     YM5956P 57400002
         SPACE                                                          57470002
         CLI   UCBTBYT4,DA2314          TEST FOR 2314            Y02021 57540002
         BH    MERL                    NO - BUT ITS 370 DA I/O          57610002
         BL    MOVESEEK                NO - BR TO MOVE SEEK ADDR        57680002
*                                      YES - THIS IS A 2314             57750002
         MVC   OBRECB(SNSBYT),SNB040(R5WORK) GET SENSE BYTE 4    Y02021 57820002
*                                                      BYTE(CONTAINS    57890002
*                                                      PHY UNIT ADDR)   57960002
         B     PHYSDEV                 BRANCH AROUND 3330 CODE          58030002
OI       OI    OBRECB,HEX00        EXECUTED INSTRUCTION        @Z40RSVS 58060004
         SPACE                                                          58100002
*                                       I/O AND NO STAT CNTRS   XL03130 58170002
MERL     OI    FLAGS,MERZEUS+NOSDR     SET FLAG FOR 2ND LOAD= 370 DA    58240002
         CLI   UCBTBYT4,DA3350     TEST FOR                    @Z40RSVS 58260004
         BE    MOVESEEK            YES - BR - PHY CUA OK       @Z40RSVS 58280004
         CLI   UCBTBYT4,DA3340          TEST FOR WINCHESTER      Y02021 58310002
         BE    WIN                 YES                         @AZ08966 58380003
         MVC   OBRECB(SNSBYT),SNB040(R5WORK) GET SENSE BYTE 4    Y02021 58450002
         TM    SNB020(R5WORK),EMULATE EMULATION ACTIVE ?       @Z40RSVS 58520004
         BNO   NOEMU               NO, DONT CONVERT SNSB 4     @Z40RSVS 58523004
         CLI   UCBTBYT4,DA3330      3330?                      @AZ08966 58526003
         BNE   MOVESEEK                                        @AZ08966 58529003
         NI    PCUAUA,HEXDF              MASK OFF BIT 2        @AZ08966 58532003
         B     MOVESEEK                                        @AZ08966 58535003
WIN      TM    SNB020(R5WORK),EMULATE    IS IT 3344?           @AZ08966 58538003
         BNO   MOVESEEK                  UA OK FOR 3340        @AZ08966 58541003
         SR    R6WORK,R6WORK             3344 NEEDS SPCL CONV  @AZ08966 58544003
         IC    R6WORK,SNB040(R5WORK)     PICKUP SENSE BYTE 4   @AZ08966 58547003
         SRDL  R6WORK,THREE               MOVE STRING AND      @AZ08966 58550003
         SRL   R6WORK,THREE               DEVISE CODE TO       @AZ08966 58553003
         SLDL  R6WORK,THREE               BITS 3 TO 7.         @AZ08966 58556003
         NI    PCUAUA,HEXC0          STRIP BITS 2 TO 7         @AZ08966 58559003
         STC   R6WORK,OBRECB             SAVE STRING DEV CODE  @AZ08966 58562003
         OC    PCUAUA(ONE),OBRECB        MOVE STRING DEV CODE  @AZ08966 58565003
         B     MOVESEEK                                        @AZ08966 58568003
         SPACE 2                                                        58577004
NOEMU    NI    OBRECB,HIGHBIT      AND OUT 5 HIGH ORDER BITS   @Z40RSVS 58580004
         SPACE                                                          58590002
PHYSDEV  BAL   R11CNTRL,SETPHYUN       BRANCH TO PUT PHYSICAL/PRIMARY   58660002
*                                       UNIT ADDR IN RECORD             58730002
MOVESEEK MVC   IORETRY(TWO),EWACNTR1    MOVE RETRY COUNT         Y02021 58800002
*                                                                       58870002
*      THE FOLLOWING CHECKS FOR PARTICULAR DEVICES(2305,2321,ETC),      58940002
*        FINDS THERE VOL SERS,AND PUTS IT IN THE RECORD                 59010002
*                                                                       59080002
         CLI   UCBTBYT4,DA23051         TEST FOR 2305-1          Y02021 59150002
         BE    ZVOL                    YES - BR TO GET VOL SER          59220002
         CLI   UCBTBYT4,DA23052         TEST FOR 2305-2          Y02021 59290002
         BNE   ASPTAP                   NO-GO MOVE DEV DEP       Y02021 59360002
ZVOL     OI    FLAGS,MERZEUS+NOSDR      SET FLAGS                Y02021 59430002
         B     ASPTAP                   NO-GO MOVE DEV DEP       Y02021 59500002
         EJECT                                                          59570002
*                                                                       59640002
*      THE FOLLOWING CHECKS FOR 3400 TAPES AND MOVES VOL SER'S TO REC   59710002
*                                                                       59780002
TAPES    CLI   UCBTBYT4,T3400           TEST FOR ASPEN           Y02021 59850002
         BE    ASPTAP                  YES - BR TO GET DEV DEP DATA     59920002
         LA    R8WORK,DBLWRD(R8WORK)   BUMP POINTER TO SDR AREA FOR 2ND 59990002
         MVI   DEVDEPC,ONE             SET LEN OF DEV DEP AREA IN REC   60060002
         SPACE                                                          60130002
VOLID    BAL   R14LINK,GETDEVD          GET DEV DEP DATA         Y02021 60200002
         B     CCWCSW                  BRANCH TO GET FAILING CCW & CSW  60270002
         SPACE                                                          60340002
ASPTAP   LA    R8WORK,THREEDBL(R8WORK)  BUMP COUNTER FOR DEV DEP Y02021 60410002
         MVI   DEVDEPC,THREE           PUT DBL WRD SIZE OF DEV DEP AREA 60480002
         B     VOLID                   BRANCH TO GET VOL SER OF TAPE    60550002
         SPACE 3                                                        60620002
*                                                                       60690002
*      ROUTINE TO INITIALIZE FIELDS FOR A SHORT OBR RECORD --- STAT     60760002
*        COUNTER OVERFLOW ON A DEVICE WITHOUT VARIABLE LENGTH STATS     60830002
*                                                                       60900002
SHOBR    MVC   SDEVTYP(FOUR),UCBTYP     GET DEV TYPE FLD TO RE   Y02021 60970002
         OI    SW1,TEMPSHRT            SET SW FOR TEMP ERR/SHORT RECORD 61040002
         CLC   TY2314(DEVTYPE),UCBTBYT3 TEST FOR 2314            Y02021 61110002
         BNE   MOVCUA                  NO - BR TO MOVE CUA              61180002
         L     R5WORK,EWADCNT           GET POINTER TO DEV DEP   Y02021 61250002
         LA    R5WORK,FOURDBL(R5WORK)   GET POINTER TO SENSE     Y02021 61320002
         MVC   OBRECB(SNSBYT),FOUR(R5WORK)   GET 4TH SNS BYTE    Y02021 61390002
         BAL   R11CNTRL,SETPHYUN       BR TO DETERMINE PHYSICAL CUA     61460002
         SPACE                                                          61530002
MOVCUA   MVC   SCUA(CUA),PCUA          MOVE PHYSICAL CUA TO PROPER      61600002
*                                       PLACE FOR SHORT RECORD          61670002
         LA    R8WORK,SSDR             LOAD ADDR OF SDR AREA FOR        61740002
*                                       2ND LOAD                        61810002
         B     OBR1                     BRANCH TO COMPLETE       Y02021 61880002
*                                                                       61950002
*      PICK UP DEVICE DEPENDENT DATA                                    62020002
*                                                                       62090002
GETDEVD  CLI   EWADCNT,ZERO            CHECK FOR ZERO COUNT    @YM6451P 62160002
         BCR   EIGHT,R14LINK           YES-RETURN              @YM6451P 62180002
         IC    R5WORK,EWADCNT          GET COUNT               @YM6451P 62200002
         BCTR  R5WORK,ZERO              DECREMENT FOR EXECUTE    Y02021 62230002
         L     R6WORK,EWADCNT           GET POINTER TO DATA      Y02021 62300002
         EX    R5WORK,MOVEDEVD          MOVE DATA                Y02021 62370002
         BR    R14LINK                  RETURN                   Y02021 62440002
         SPACE 1                                                        62510002
MOVEDEVD MVC   IDTYPE(ZERO),ZERO(R6WORK)    MOVE DEV DEP DATA    Y02021 62580002
         SPACE 1                                                        62650002
         EJECT                                                          62720002
*                                                                       62790002
*      THE FOLLOWING CHECKS FOR CERTAIN UNIT RECORD DEVICES IF:         62860002
*        3505,3525 = SET FLAG FOR 125F FOR NO SDR CNTRS                 62930002
*        3211 = MAINTAIN COUNTER TO RELATE 'T' TYPE ERRORS TO OBR REC'S 63000002
*                                                                       63070002
CK3505   CLI   UCBTBYT4,UR3505          TEST FOR 3505-REDLAKE    Y02021 63140002
         BE    SETFLG                  YES - BR TO SET FLG              63210002
         CLI   UCBTBYT4,UR3850          TES FOR 3850(OAK,SS/1)  Y30LPDG 63230003
         BE    SETFLG                   YES--BR                 Y30LPDG 63250003
         CLI   UCBTBYT4,UR3895          TEST FOR 3895          @G30HIMD 63260002
         BE    SETFLG                   YES BRANCH             @G30HIMD 63270002
         CLI   UCBTBYT4,UR3525          TEST FOR 3525-PIKLAKE    Y02021 63280002
         BNE   CK3211                  NO - BR AROUND SETTING FLG       63350002
SETFLG   OI    FLAGS,NOSDR             SET FLAG FOR 2ND LOAD-NO STAT    63420002
*                                       COUNTERS FOR THIS DEVICE        63490002
CK3211   L     R6WORK,UCBXTADR          ADDR OF UCB UCS EXT.     Y02021 63560002
         CLI   UCBTBYT4,UR3211          TEST FOR 3211            Y02021 63630002
         BE    ROUT3211                 YES BRANCH               X03127 63700002
         CLI   UCBTBYT4,UR3540          TEST FOR 3540           Y30OPDP 63720003
         BE    ROUT3540                                         Y30OPDP 63740003
         CLI   UCBTBYT4,UR3886          TEST FOR 3886            Y02021 63770002
         BE    ROUT3540                 YES BRANCH             @G30HIMD 63790002
         CLI   UCBTBYT4,UR3895          TEST FOR 3895          @G30HIMD 63810002
         BNE   CCWCSW                   NO- GET CCW AND CSW      X03127 63840002
         BAL   R14LINK,GETDEVD          GET DEV DEP DATA       @G30HIMD 63850002
         LA    R8WORK,FIVEDBL(R8WORK)   BUMP PTR TO SDR AREA   @G30HIMD 63860002
         MVI   DEVDEPC,FIVE             SET LENGTH TO 5 DBLWDS @G30HIMD 63870002
         B     CCWCSW                   THEN GET CCW AND CSW   @G30HIMD 63880002
ROUT3540 BAL   R14LINK,GETDEVD          GET DEV DEP DATA        Y30OPDP 63910003
         B     INDVDPCT                 BR TO INC DEV DEP COUNT  X03127 63980002
ROUT3211 XR    R5WORK,R5WORK            CLEAR REG                X03127 64050002
         IC    R5WORK,UCBERCNT          GET ERR CNT FROM EXT     Y02021 64120002
         STC   R5WORK,IDTYPE           STORE ERR CNT IN REC             64190002
         LA    R5WORK,ADDONE(R5WORK)   UPDATE ERR CNT(CORRELATION #)    64260002
         STC   R5WORK,UCBERCNT          STORE ERR CNT IN EXT     Y02021 64330002
         SPACE                                                          64400002
INDVDPCT LA    R8WORK,DBLWRD(R8WORK)    BUMP PTR TO SDR AREA     X03127 64470002
         MVI   DEVDEPC,ONE             SET LENGTH IN DOUBLE WORDS OF    64540002
*                                       THE DEVICE DEPENDENT DATA AREA  64610002
         EJECT                                                          64680002
*                                                                       64750002
*      ROUTINE TO FIND CSW AND FAILING CCW FOR ALL DEVICES              64820002
*                                                                       64890002
CCWCSW   CLI   UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS  YM5956P 64960002
         BNE   CCWCSW1                  NO-BRANCH AROUND        YM5956P 65040002
         L     R5WORK,EWADCNT           GET DEV DEP POINTER     YM5956P 65120002
         MVC   FAILCCW(CCWLEN),FOURDBL(R5WORK) GET FAILING CCW  YM5956P 65200002
         MVC   CSW1(CSWLEN),THREEDBL+ONE(R5WORK)  GET CSW TO RE  Y02021 65310002
         B     OBR1                     GO COMPLET RECORD        Y02021 65380002
         SPACE 1                                                        65450002
CCWCSW1  CLI   IOSCOD,IOSINTC           TEST FOR INTERCEPT      YM5956P 65470002
         BE    CSWMOVE                  YES-GET CSW             YM5956P 65490002
CCWCSW2  L     R5WORK,IOSVST            GET CHAN PROG START    @YM2957P 65520002
         SPACE                                                          65590002
TESTTCAM CLI   CLASRC,TCAMREC          IS THIS A TCAM RECORD            65660002
         BE    MVCSWCCW                YES-GET CSW,CCW         @ZA28495 65730030
         CLI   CLASRC,ATCAMREC         VTAM RECORD?            @ZA28495 65760030
         BNE   CSWTEST            NO - BR AROUND FURTHER TESTS @ZA28495 65790030
MVCSWCCW MVC   CSW1(CSWLEN),EWTCCSW     GET TCAM CSW          @ZA28495  65800030
         MVC   FAILCCW(CCWLEN),EWTCCCW  GET TCAM CCW             Y02021 65870002
         B     TAMOFL                   GO COMPLETE RECORD       Y02021 65940002
         SPACE                                                          66010002
CSWTEST  CLC   ZEROS(THREE),IOSCSW      CHECK IF CCW ADD ZERO   YM5956P 66080002
         BE    CCWMOVE                 YES - BR TO MOVE 1ST CCW IN THE  66780002
*                                       CHAN PGM CHAIN-NOT THE FAILING  66850002
         L     R5WORK,IOSCC             LOAD CMD ADD FROM CSW    Y02021 66920002
CSWTEST2 LA    R7WORK,CCWLEN            LOAD LENGTH OF A CCW     Y02021 66990002
         SR    R5WORK,R7WORK           SUBTRACT TO ADDR OF FAILING CCW  67060002
         SPACE                                                          67130002
CCWMOVE  MVC   FAILCCW(CCWLEN),ZERO(R5WORK) MOVE FAILING CCW TO RECORD  67200002
CSWMOVE  MVC   CSW1(CSWLEN),IOSCSW      MOVE CSW TO RECORD       Y02021 67410002
         EJECT                                                          67480002
TAMOFL   CLI   CLASRC,TCAMREC          IS THIS A TCAM OBR               67550002
         BE    TAMOFL1                 YES                     @Y30APDZ 67620003
         CLI   CLASRC,ATCAMREC         VTAM RECORD?            @Y30APDZ 67625003
         BNE   OBR1                    NO                      @Y30APDZ 67630003
*                                      TEST REMOVED   @ZA28495@Y30APDZ  67635030
         BAL   R14LINK,GETDEVD         GET DEVICE DEP DATA     @Y30APDZ 67645003
         MVI   DEVDEPC,TWO             DEVICE DEP DATA         @Y30APDZ 67650003
         TM    EWTCFLG,EWTCOVF+EWTCEOD  TEST FOR EOD OR OVERFLOW        67655003
         BNZ   WRTTCAM                 BRANCH IF ONES OR MIZED @Y30APDZ 67660003
         MVC   TSENSE0(TWO),EWTCSNL     MOVE IN SENSE          @Y30APDZ 67665003
         B     WRTTCAM                 GO WRITE                @Y30APDZ 67670003
TAMOFL1  EQU   *                                               @Y30APDZ 67675003
         BAL   R14LINK,GETDEVD          GET DEV DEP DATA         Y02021 67690002
         OI    TFLAGS,TCAMFLG           SET TCAM FLAG FOR EREP   Y02021 67760002
         OI    INTSW,TCAMTYPE           SET TCAM TYPE RECORD     Y02021 67830002
         MVI   DEVDEPC,TWO             DBL WRD LEN OF DEV DEP DATA AREA 67900002
         TM    EWTCFLG,EWTCOVF+EWTCEOD  TEST FOR EOD OR OVERFLOW Y02021 67970002
         BNZ   WRTTCAM                  BRANCH IF ONES OR MIXED  Y02021 68040002
         MVC   TSENSE0(TWO),EWTCSNL     MOVE IN SENSE          @YM2957P 68110002
         SPACE                                                          68180002
*                                                                       68250002
*       WRITE TCAM RECORD ON LOGREC                                     68320002
*                                                                       68390002
WRTTCAM  LA    R0PARM,TCRECLEN          LOAD LENGTH OF RECORD    Y02021 68460002
         B     SETADR                   BRANCH TO WRITE RECORD   Y02021 68530002
*                                       TO SYS1.LOGREC                  68600002
*                                                                       68670002
*      ROUTINE TO PUT PHYSICAL/PRIMARY CUA IN OBR RECORD                68740002
*                                                                       68810002
SETPHYUN NI    OBRECB,SAVEUNIT         SAVE UNIT ADDR IN WORK AREA      68880002
         NI    PCUAUA,SAVECHAN         SAVE CHANNEL ADDR AND HIGH ORDER 68950002
*                                       BIT OF UNIT ADDR IN PCUA S99204 69020002
         CLI   OBRECB,NOTVALID         IS SENSE INFO VALID - 2314       69090002
         BCR   EQUAL,R11CNTRL          NOT VALID - RETURN               69160002
         OC    PCUAUA(ONE),OBRECB      INSERT PHYSICAL UNIT ADDR IN REC 69230002
         BR    R11CNTRL                RETURN TO CALLING ROUTINE        69300002
         EJECT                                                          69370002
OBR1     TM    FLAGS,NOSDR              ANY STAT COUNTERS?       Y02021 69440002
         BO    SENSE                   NO - GO GET SENSE DATA           69510002
         SPACE 2                                                        69580002
*                                                                       69650002
****     ROUTINE TO CHECK,RECORD, AND CLEAR STATISTICS TABLE       **** 69720002
****             FOR THE FAILING DEVICE                            **** 69790002
*                                                                       69860002
         L     R10WORK,UCBEXTPT         UCB EXTENSION POINTER  @YM00142 69890002
         XR    R7WORK,R7WORK           CLEAR REG                        69930002
         IC    R7WORK,UCBSTI            INSERT STAT TAB OFFSET   Y02021 70000002
         SPACE 1                                                        70070002
         CLC   TY2314(DEVTYPE),UCBTBYT3 TEST FOR 23214           Y02021 70140002
         BNE   NOT2314                  NO-BRANCH                Y02021 70210002
         LA    R5WORK,OLDSDR            GET COUNT                Y02021 70280002
         B     NEWSTAT2                 GO COMPLETE RECORD       Y02021 70350002
         SPACE                                                          70420002
NOT2314  L     R5WORK,CVTSTB           LOAD ADDR OF STAT TAB            70490002
LOOP1    CLM   R4UCB,X'3',ZERO(R5WORK)  IS DEV IN THIS SEC OF STATS     70560003
         BL    LOOP2                   YES - INCR ADJUSTED CORRECTLY    70630002
         LA    R5WORK,NXTSTAD(R5WORK)  LOAD ADDR OF FIRST UCB IN THE    70700002
*                                       NEXT STAT TAB SECTION           70770002
         LA    R7WORK,NXTSDRST(R7WORK) BUMP OFFSET PAST THIS SECTION    70840002
         B     LOOP1                   BRANCH BACK TO COMPARE ADDRESSES 70910002
LOOP2    MH    R7WORK,MULTICON         MULTIPLY OFFSET BY 10            70980002
         AL    R7WORK,CVTSTB           ADD ADDR OF STAT TABS TO OFFSET  71050002
         SPACE                                                          71120002
         TM    UCBFL5,UCBVSDR           DOES THIS DEV HAVE VAR   Y02021 71190002
*                                       LENGTH SDR'S                    71260002
         BO    NEWSTAT                 YES - PROCESS NEW STATS          71330002
         MVC   ZERO(OLDSDR,R8WORK),ZERO(R7WORK)  MOVE STAT CTRS TO REC  71400002
         XC    ZERO(OLDSDR,R7WORK),ZERO(R7WORK)  CLEAR STAT CTRS        71470002
         LA    R5WORK,OLDSDR            GET COUNT OF 10          X03127 71540002
         B     NEWSTAT2                 BRANCH TO HANDLE RECORD  X03127 71610002
         SPACE                                                          71680002
NEWSTAT  IC    R5WORK,ZERO(R7WORK)      GET FLAGS BYTE           X03127 71750002
         N     R5WORK,MASK              SAVE LOW ORDER COUNT     X03127 71820002
         MH    R5WORK,MULTICON          MULTIPLY BY 10           X03127 71890002
         AH    R5WORK,MULTICON          ADD 10                   X03127 71960002
         LR    R6WORK,R5WORK            SAVE COUNT               X03127 72030002
         BCTR  R5WORK,ZERO              REDUCE COUNT BY 1        X03127 72100002
         EX    R5WORK,MOVESTAT          MOVE STAT CTRS TO RECORD X03127 72170002
         BCTR  R5WORK,ZERO              REDUCE COUNT BY 1        X03127 72240002
         BCTR  R5WORK,ZERO              REDUCE COUNT BY 1        X03127 72310002
         EX    R5WORK,CLRSTAT           CLEAR STATS FROM +2      X03127 72380002
         TM    ZERO(R7WORK),CLROPT      TEST CLEARING CE MODE    X03127 72450002
         BO    NEWSTAT1                 NO-BRANCH AROUND         X03127 72520002
         MVI   ONE(R7WORK),ZERO         CLR CE MODE BYTE         X03127 72590002
NEWSTAT1 LR    R5WORK,R6WORK            GET COUNT OF STATS       X03127 72660002
NEWSTAT2 TM    SW1,SHORT                TEST FOR SHORT RECORD    X03127 72730002
         BO    NEWSTAT3                 YES-BRANCH AROUND        X03127 72800002
         LA    R8WORK,ZERO(R5WORK,R8WORK)   BUMP POINTER         X03127 72870002
         STC   R5WORK,SDRCNT            GET CNT TO LONG RECORD   X03127 72940002
         B     SENSE                    CONT. BUILDING RECORD    X03127 73010002
         SPACE                                                          73080002
NEWSTAT3 STC   R5WORK,SSDRCNT           GET COUNT IN SHORT RE    X03127 73150002
         LA    R0PARM,HDR(R5WORK)       GET COUNT OF SHORT RE    X03127 73220002
         SPACE                                                          73290002
SETADR   LA    R1PARM,BLDAREA          LOAD ADDRESS OF RECORD           73360002
SETADRA  LA    R13PARM,REGSAVE          POINTER TO SAVE AREA     Y02021 73430002
         SPACE                                                          73500002
       RECORD TYPE=LOGREC,DATAADR=(1),LENGTH=(0),BUFFER=YES,RCVRY=ESTAE 73640002
         ESTAE 0                                               @ZA06003 73670004
DIRTST   TM    IOSPKEY,IOSIDR      TEST FOR DIR RECORD         @ZA02772 73710003
         BZ    TERM                                            @ZA02772 74010003
         BAL   R6WORK,FREEIOSB     GO FREE IOSB/SRB/EWA        @ZA02772 74310003
         BAL   R14LINK,FREECORA    GO FREE GOTTEN CORE         @ZA02772 74610003
         SVC   EXIT                RETURN TO SUPERVISOR        @ZA02772 74910003
**                                                             @ZA02772 75210003
*                                                                       76020002
*      FREE IOSB AND EWA                                                76090002
*                                                                       76160002
FREEIOSB L     R7WORK,IOSSRB       GET SRB PTR                 @ZA02772 76230003
         MVC   ZERO(FOUR,R7WORK),IOSERP PUT EWA PTR IN CHAIN FLD        76300003
         LR    R1PARM,R7WORK       GET SRB POINTER             @ZA02772 76370003
         SPACE 1                                               @YM2957P 76452002
*     GET LOCAL LOCK TO PROTECT FRR STACK FOR CORE MGR         @YM2957P 76458002
*        REGS 11-14 ARE DESTROYED BY SETLOCK                   @YM2957P 76464002
*                                                              @YM2957P 76470002
         SPACE 1                                               @YM2957P 76476002
GETLOCK  SETLOCK   OBTAIN,TYPE=LOCAL,MODE=UNCOND,              @YM2957PX76482002
               RELATED=(IECVSMGR,IGE0025F(FREELOCK))           @YM2957P 76488002
         SPACE 1                                               @YM2957P 76494002
         USING IOCOM,R5WORK                                    @ZA02772 76500003
         L     R5WORK,CVTIXAVL          GET IOS TABLE PTR        Y02021 76510002
         L     R15CODE,IOCORMGT         GET IO CORE MGT PTR      Y02021 76580002
         LA    R11WORK,HEX20            INDICATE 160 BYTES     @YM2957P 76650002
         LA    R13PARM,REGSAVE          SAVE AREA POINTER        Y02021 76720002
         BAL   R14LINK,FOUR(R15CODE)    LINK TO CORE MGR         Y02021 76790002
         SPACE 1                                               @YM2957P 76810002
FREELOCK SETLOCK   RELEASE,TYPE=LOCAL,                         @YM2957PX76820002
               RELATED=(IECVSMGR,IGE0025F(GETLOCK))            @YM2957P 76830002
         SPACE 1                                               @YM2957P 76840002
         BR    R6WORK              RETURN                      @ZA02772 76850003
         DROP  R5WORK                                          @ZA02772 77550003
         SPACE 2                                                        78260002
         EJECT                                                          78330002
*                                                                       78400002
****     ROUTINE TO PUT SENSE BYTES OF FAILING UNIT IN RECORD      **** 78470002
*                                                                       78540002
SENSE    MVI   SENSCNT,ZERO             INITIALIZE COUNT TO ZERO Y02021 78610002
         L     R10WORK,UCBEXTPT         UCB EXTENSION POINTER  @YM00142 78640002
         SR    R6WORK,R6WORK            CLEAR WORK REG           Y02021 78680002
         IC    R6WORK,UCBSNSCT          GET SENSE COUNT          Y02021 78750002
         CLI   UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS   Y02021 78820002
         BE    DASNS                    YES-BRANCH TO HANDLE     Y02021 78890002
         LA    R5WORK,EWAIERP           GET PTR TO SENSE         Y02021 78960002
         B     DASNS1                   BRANCH TO COMPLETE       Y02021 79030002
         SPACE                                                          79100002
DASNS    L     R5WORK,EWADCNT           GET PTR TO DEV DEP       Y02021 79170002
         LA    R5WORK,FIVEDBL(R5WORK)   GET POINTER TO SENSE    YM5956P 79240002
DASNS1   LTR   R6WORK,R6WORK            TEST FOR ANY COUNT       Y02021 79310002
         BZ    SVCPRE                   YES-NO SENSE             Y02021 79380002
         STH   R6WORK,SENSCNT           COUNT TO RECORD          Y02021 79450002
         BCTR  R6WORK,ZERO              DECREMENT COUNT FOR MOVE Y02021 79520002
         EX    R6WORK,MOVESENS         MOVE SENSE BYTES TO RECORD       79590002
         SPACE                                                          79660002
SVCPRE   SR    R8WORK,R9LOGBAS          LENGTH OF RE LESS SENSE  Y02021 79730002
         AH    R8WORK,SENSCNT          ADD LENGTH OF SENSE              79800002
         LR    R0PARM,R8WORK           LOAD LENGTH OF RECORD            79870002
         B     SETADR                   BRANCH TO RECORD REC     Y02021 79940002
*                                                                       80010002
***      ROUTINE TO FREE GOTTEN CORE                                    80080002
*                                                                       80150002
         SPACE                                                          80220002
FREECORE L     R12IOB,IOSBADDR          GET ORIGINAL IOSB PTR    Y02021 80290002
FREECORA LR    R6WORK,R14LINK           SAVE RETURN REG          Y02021 80360002
         LR    R1PARM,R9LOGBAS          POINTER TO GOTTEN CORE   Y02021 80430002
         SPACE                                                          80500002
         FREEMAIN  RC,A=(1),LV=328,SP=255                        Y02021 80570002
         LR    R14LINK,R6WORK           RESTORE RETURN REG       Y02021 80640002
         BR    R14LINK                 RETURN TO CALLER.Z15459VM Y02021 80710030
         SPACE                                                          80716030
*                                                              Z15459VM 80722030
**** ROUTINE TO OBTAIN CPUID DIGITS FROM PCCA ENTRY, FOR CPU   Z15459VM 80728030
**** ON WHICH ERROR OCCURED.                                   Z15459VM 80734030
*                                                              Z15459VM 80740030
CPUIDRTE EQU   *                                               Z15459VM 80746030
         L     R1PARM,IOSERP           SET R1= @EWA            Z15459VM 80752030
         IC    R7WORK,EWACPU           STO CCA OFFSET          Z15459VM 80758030
         SLL   R7WORK,TWENTY8          MASK OUT ALL BUT LO 4   Z15459VM 80764030
         SRL   R7WORK,TWENTY6            BITS & MULT BY 4      Z15459VM 80770030
         L     R5WORK,CVTPCCAT     R5= @ PHYSICAL CCA VECT TBL Z15459VM 80776030
         L     R5WORK,ZERO(R7WORK,R5WORK) R5= @ PCCA ENTRY     Z15459VM 80782030
         PACK  ZERO(FOUR,R4UCB),SIX(SIX,R5WORK) PACK PCCA CPUIDZ15459VM 80788030
         L     R5WORK,ZERO(ZERO,R4UCB) R5= PACKED CPUID        Z15459VM 80794030
         SRL   R5WORK,FOUR             SHIFT OUT SIGN BITS     Z15459VM 80800030
         STIDP ZERO(R4UCB)             STO CPUID THIS CPU      Z15459VM 80806030
         STCM  R5WORK,X'7',ONE(R4UCB)  STO CPUID DIGITS ERP CPUZ15459VM 80812030
         L     R4UCB,IOSUCB            RESET R4 TO UCB         Z15459VM 80818030
         BR    R6WORK                  RETURN TO OBR/MDR STIPD Z15459VM 80824030
         EJECT                                                          80830030
*        HOUSEKEEPING - FREE CORE - TEST FOR PROPER EXIT       @YM6451P 80850002
         SPACE                                                          80920002
TERM     BAL   R14LINK,FREECORE    GO FREE GOTTEN CORE         @ZA02772 80990003
         TM    IOSFLB,IOSSDR       NO OBR RECORDING?           @Z402IVS 81060000
         BO    NOMAIN              YES,EXIT                    @Z402IVS 81130000
*                                                                       81200002
*        TEST FOR RETURN TO EOD MODULE                                  81270002
*                                                                       81340002
         L     R4UCB,IOSUCB             GET ORIG UCB ADDR        Y02021 81410002
         L     R1PARM,IOSERP            GET ORIG EWA ADDR        Y02021 81480002
TCREC1   L     R10WORK,UCBEXTPT         UCB EXTENSION POINTER  @YM00142 81550002
         NI    IOSFLB,LOGCLR            CLEAR IOSLOG FLAG      @YM2957P 81560002
         CLI   UCBETI,TCAMEXT1          WAS TCAM ERP USED        Y02021 81580002
         BE    TCREC2                   YES-GO TEST FOR EOD      Y02021 81620002
         CLI   UCBETI,TCAMEXT3          WAS A TCAM ERP USED 3705 Y02021 81830002
         BNE   DDRTEST                  NO-CONTINUE              Y02021 81900002
TCREC2   TM    EWTCFLG,EWTCEOD          TCAM EOD RECORD          Y02021 81970002
         BZ    DDRTEST                  NO-GO TEST FOR DDR       Y02021 82040002
         LR    R1PARM,R12IOB            IOSB TO REG 1            Y02021 82110002
         LH    R13PARM,EODMOD           GET MODULE NAME IN REG   Y02021 82180002
         B     EXIT1                    GO XCTL TO MODULE        Y02021 82250002
         EJECT                                                 @AZ09708 82320003
*        THE FOLLOWING ROUTINE CHECKS TO SEE IF THE DYNAMIC    @AZ09708 82330003
*        DEVICE REALLOCATION ROUTINE(DDR) IS TO BE INVOKED     @AZ09708 82340003
*        OR IF THE OTHER EXITS TO THE SVC, ETC ARE TO BE DONE  @AZ09708 82350003
*                                                              @AZ09708 82360003
DDRTEST  EQU   *                                               @AZ09708 82370003
         CLI   UCBTBYT3,UCB3UREC       UNIT RECORD DEVICE?     @ZA26472 82370430
         BNE   NOTUREC                 NO BYPASS UNIT RECORD   @ZA26472 82370830
         CLI   UCBTBYT4,UR3838         3838 DEVICE?            @ZA26472 82371230
         BE    NOMAIN                  YES-NO DDR SWAP.        @ZA26472 82371630
         CLC   UCBTBYT3(DEVTYPE),UR3800  ARGONAUT?    Z12990VM @Z402IVS 82373000
         BE    NOMAIN                  YES-NO DDR SWAP.        @ZA26472 82376030
         B     DDRIN1                  CHECK FOR PERMANENT ERR @ZA26472 82377030
NOTUREC  EQU   *                                               @ZA26472 82378030
         CLI   UCBTBYT3,UCB3DACC        DASD DEVICE            @AZ09708 82380003
         BNE   DDRIN1                   NO-BYPASS EMULATION CHK@AZ09708 82390003
         CLI   UCBTBYT4,DA2314          2314/2319 DEVICE       @AZ09708 82400003
         BE    DDRIN1                   YES-BYPASS EMULATION CK@AZ09708 82410003
         TM    EWDSNS2,EWD24            DEV. EMULATION ACTIVE  @AZ08966 82420003
         BO    NOMAIN                 YES, DON'T SWAP                   82464004
         CLC   UCBTBYT3(DEVTYPE),UR3350 DEVICE 3350?           @Z40RSVS 82466004
         BE    NOMAIN              YES, STD EXIT               @Z40RSVS 82472004
DDRIN1   EQU   *                                               @AZ09708 82502003
         TM    IOSFLA,IOSEX+IOSERR     TEST PERM ERR OR ERP CNTL        82550003
         BNM   NOMAIN              EXIT TO SUPERVISOR          @ZA02799 82560003
DDRIN    EQU   *                                               Z12032VM 82630003
         CLI   UCBTBYT3,UCB3DACC                               Z12032VM 82636003
         BNE   DDRIN2                                          Z12032VM 82642003
         TM    UCBSTAB,UCBPGFL                                 Z12032VM 82648003
         BO    NOMAIN                                          Z12032VM 82654003
DDRIN2   EQU   *                                               Z12032VM 82660003
         TM    CVTOPTA,CVTDDR          IS DDR IN THIS SYSTEM            82670002
         BO    DDREXIT                 YES - BR TO EXIT TO DDR          82740002
         SPACE                                                          82810002
*        THE FOLLOWING IS THE STANDARD EXIT - RETURN TO SUPERVISOR      82880002
         SPACE                                                          82950002
NOMAIN   LR    R1PARM,R12IOB             GET IOSB ADDR TO REG 1@AZ08966 83020003
         SVC   ERREXCP                   FREE IOSB             @AZ08966 83050003
NOMAIN1  SVC   EXIT                RETURN TO SUPERVISOR        @ZA02772 83090003
         SPACE                                                          83160002
*        THE FOLLOWING SETS PARAMETERS FOR EXIT TO DDR                  83230002
         SPACE                                                          83300002
DDREXIT  EQU   *                   Z12032VM                    Z12032VM 83370003
         LR    R1PARM,R12IOB                                   Z12032VM 83390003
         LH    R13PARM,DDRMOD                                  Z12032VM 83410003
         B     EXIT1                    GO TO DDR                Y02021 83440002
         SPACE                                                          83510002
         EJECT                                                          83580002
*******************************************************************     83650002
*                                                                 *     83720002
*****    ENTRY TO THE NON-STANDARD T TYPE RECORDER ROUTINE        ***** 83790002
*                                                                 *     83860002
*                                                                 *     83930002
*******************************************************************     84000002
         SPACE                                                          84070002
MDR      MVI   IOSBADDR,TPERRUNG        SET MDR IN-PROGRESS IND  Y02021 84140002
         SPACE                                                          84210002
*                                                                       84280002
*      ROUTINE TO DETERMINE IF THIS RECORD HAS A FORMATED BUFFER        84350002
*                                                                       84420002
*      MDR1 ENTRY IS FROM AN UNSUCCESSFUL GETMAIN                       84490002
*                                                                       84560002
MDR1     TM    UCBTBYT3,UCB3TAPE+UCB3COMM+UCB3DISP                      84630003
         BNZ   ADDRIOB       LOG BIT NOT ON - BRANCH TO                 84670003
*                            GET BUFFER ADDRESS                         84710003
*                                      YES - ITS A BUFFERED LOG DEVICE  84770002
         CLI   UCBTBYT3,DASD            TEST FOR DIRECT ACCESS   Y02021 84840002
         BE    DABUFPTR                 YES-GO CHK UNIT TYPE     Y02021 84910002
         CLI   UCBTBYT4,UR3895          IS THIS A 3895?        @G30HIMD 84930002
         BE    DABUFPTR                 YES,BRANCH             @G30HIMD 84950002
*                                      NO - THEN ITS A 3211 PRINTER     84980002
*      UNIT RECORD DEVICE,CHARACTER READER,FUTURE OTHER                 85010030
         L     R6WORK,UCBXTADR          GET PRT TO UCS EXT       Y02021 85050002
         CLI   UCBTBYT4,ARGO       3800?                       @Z402IVS 85070000
         BE    BUF3800             YES, GO                     @Z402IVS 85090000
         L     R8RECADR,UCBERADR        LOAD BUFFER ADDR         Y02021 85120002
         B     SAVEADR                 BRANCH TO FORMAT RECORD          85190002
BUF3800  L     R8RECADR,ARGERADR(R6WORK) LOAD BUFFER ADDRESS   @Z402IVS 85210000
         B     SAVEADR             BRANCH TO FORMAT RECORD     @Z402IVS 85230000
         SPACE                                                          85260002
DABUFPTR L     R8RECADR,EWADCNT         GET PTR TO BUFFER        Y02021 85330002
         B     SAVEADR                 BRANCH TO FORMAT RECORD          85400002
         EJECT                                                          85470030
*                                                                       85480030
*      DEVICE CLASSES:TAPE,COMMUNIC,DISPLAY OR CHAN TO CHAN ADAPTER.    85490030
*                                                                       85500030
ADDRIOB  L     R8RECADR,EWTCBUFF        LOAD BUFFER ADDR         Y02021 85540002
*                                      NOTE: IF TCAM IS THE ACCESS      85610002
*                                       METHOD THIS IS A FORMATED BUFF  85680002
*                                       IF NOT-ITS A NON FORMATED BUFF  85750002
         L     R10WORK,UCBEXTPT         UCB EXTENSION POINTER  @YM00142 85780002
         CLI   UCBETI,TCAMEXT1          IS IT TCAM               Y02021 85820002
*                                    TP=X'2F',X'30',X'31'      Z16952VM 85890030
         BL    NOTFORM                 NOT TP-UNFORMATTED BUF  Z16952VM 85990030
         CLI   UCBETI,TCAMEXT3          IS IT TCAM               Y02021 86100002
         BH    NOTFORM                 NOT TP-UNFORMATTED BUF  Z16952VM 86170030
SAVEID   LR    R11BUFSV,R8RECADR       SAVE RECORD/BUFFER ADDR          86240002
         B     SAVEXCTL                BR TO BYPASS SUB ID ZEROING      86310002
*                                                                       86380002
*      THE FOLLOWING CODE HANDLES NON-FORMATTED BUFFER-RECORD IS        86450002
*      FORMATTED IN THE GETMAIN AREA                                    86520002
*      TAPE,COMMUNIC OR DISPLAY,BUT NOT TCAM                            86590030
*                                                                       86620030
NOTFORM  LR    R11BUFSV,R8RECADR        SAVE BUFFER ADDR         Y02021 86660002
*                                                                       86940002
*      THE FOLLOWING TEST IS FOR UNSUCCESSFUL GETMAIN                   87010002
*                                                                       87080002
         LTR   R15CODE,R15CODE          TEST FOR COMPLETION CODE Y02021 87150002
         BNZ   SAVEXCTL                 YES-GO TEST FOR XCTL     Y02021 87220002
         MVC   BLDAREA(MDRINFO),BUFFER  MOVE FIRST 6 BYTES       Y02021 87240002
         SR    R10SIZE,R10SIZE          CLEAR REGISTER         @YM6451P 87260002
         LH    R10SIZE,BUFSIZE          GET BUFFER SIZE        @YM6451P 87267002
         SH    R10SIZE,CONST7           ADJUST COUNT BY 7      @YM6451P 87274002
         EX    R10SIZE,MOVEBUFF         MOVE REST OF BUFFER    @YM6451P 87281002
         LR    R8RECADR,R9LOGBAS        USE GOTTEN CORE TO       Y02021 87290002
*                                       FORMAT THE HEADER               87360002
         LH    R10SIZE,BUFSIZE         LOAD SIZE OF BUFF                87430002
         LA    R10SIZE,REMHDR(R10SIZE) ADD 18 FOR HEADER                87500002
         STH   R10SIZE,BUFSIZE         STORE BACK UPDATED SIZE          87570002
         SPACE                                                          87640002
         CLI   BUFRECID,ID2715         IS THIS A 2715                   87710002
         BE    CLRSUBID                YES - BR TO CLEAR SUB ID         87780002
         B     SAVEXCTL                NO - BRANCH-DONT CLEAR SUB ID    87850002
         SPACE 2                                                        87920002
SAVEADR  LR    R11BUFSV,R8RECADR       SAVE RECORD/BUFFER ADDRESS       87990002
CLRSUBID MVI   BUFSUBID,ZERO           CLEAR VARIABLE SUB ID            88060002
SAVEXCTL LTR   R15CODE,R15CODE          TEST FOR COMPLETION CODE Y02021 88130002
         BZ    SAVXCTL1                 NO-BRANCH AROUND         Y02021 88200002
         ICM   R13PARM,THREE,BUFXCTL    GET XCTL NAME IN REG 13  Y02021 88270002
         ICM   R12IOB,EIGHT,MDRINPRG    SET MDR IN PROG IND      Y02021 88340002
         MVI   SUCCESS(R11BUFSV),NOTSUC MARK NOT SUCCESSFUL      Y02021 88410002
         B     TERM1A                   GO FINISH TERM TESTS     Y02021 88480002
SAVXCTL1 MVC   BINXCTL(TWO),BUFXCTL     MOVE XCTL INFO TO RECORD Y02021 88550002
         SPACE                                                          88620002
*                                                                       88690002
*      ROUTINE TO SAVE AND CHECK RECORD SIZE                            88760002
*                                                                       88830002
         LH    R10SIZE,BUFSIZE         LOAD AND SAVE SIZE OF RECORD     88900002
         CLC   BUFSIZE(SIZE),HDRLEN    IS RECORD SIZE GREATER THEN 24   88970002
         BH    INITHDR                 YES- BR TO FORMAT HEADER         89040002
         SPACE                                                          89110002
         MVI   SUCCESS(R11BUFSV),TOSMALL    PUT SUCCESS SYMBOL IN BUFF  89180002
         B     TERM1                   BRANCH TO TERMINATE              89250002
         EJECT                                                          89320002
*                                                                       89390002
*      ROUTINE TO INITIALIZE THE MDR HEADER RECORD                      89460002
*                                                                       89530002
INITHDR  MVC   MRECID(ONE),BUFRECID     MOVE RECORD ID TO RE     Y02021 89600002
         MVC   MSUBID(ONE),BUFSUBID     MOVE SUB ID TO RE        Y02021 89670002
         XC    MSWITCHS(TWO),MSWITCHS   CLEAR SWITCH FIELD       Y02021 89740002
         XC    SPARE(TWO),SPARE        CLEAR UNUSED SPACE               89810002
         SPACE                                                          89880002
         MVI   MCLASRC,TPEREC           SET RECORD CLS AND SRC   Y02021 89950002
         SPACE                                                          90020002
         LR    R5WORK,R2CVTBAS         LOAD CVT ADDR                    90090002
         SH    R5WORK,CONST4           SUBTRACT TO ADDR OF REL #        90160002
         PACK  WRK1AREA(DBLWRD),ZERO(RELEN,R5WORK)    PACK REL #        90230002
         CVB   R6WORK,WRK1AREA          CONVERT REL # TO BINARY  Y02021 90300002
         STC   R6WORK,MSYSREL           STORE REL # IN RECORD    Y02021 90370002
         OI    MSYSREL,VS2IND           SET VS2 RELEASE IND      Y02021 90440002
         SPACE                                                          90510030
**** OBTAIN CPUID OF MACHINE ON WHICH ERROR OCCURED.           Z15459VM 90560030
         LA    R4UCB,WRK1AREA          R4=@ WRKAREA IN MDR     Z15459VM 90610030
         BAL   R6WORK,CPUIDRTE         OBTAIN CPUID FOR ERP CPUZ15459VM 90660030
         MVC   MCPUSER(DBLWRD),WRK1AREA  STO IN CPUID AREA/MDR Z15459VM 90710030
         SPACE                                                          90790002
         CLI   MRECID,ID3670            TEST FOR 3670            Y02021 90860002
         BNE   SETIME                  NO - BR TO CONTINUE              90930002
         CH    R10SIZE,MIN3670         IS REC SIZE LESS THEN NORMAL     91000002
         BNL   SETIME                  NO - BR TO CONTINUE              91070002
         OI    MSW1,INCOM               SET SHORT RECORD SW      Y02021 91140002
         SPACE                                                          91210002
SETIME   TIME  DEC                     GET TIME AND DATE                91280002
         ST    R0PARM,MTIME             STORE TIME IN REC        Y02021 91350002
         ST    R1PARM,MDATE             STORE DATE IN REC        Y02021 91420002
         OI    MSWITCHS,TIMEBIT         SET TIME MACRO SW        Y02021 91490002
         SPACE                                                          91560002
*                                                                       91630002
*      ROUTINE TO WRITE RECORD TO SYS1.LOGREC                           91700002
*                                                                       91770002
         LR    R0PARM,R10SIZE           GET COUNT                Y02021 91840002
         LR    R1PARM,R8RECADR         LOAD ADDR OF RECORD              91910002
         LA    R13PARM,REGSAVE          LOAD SAVE AREA ADDR      Y02021 91980002
       RECORD TYPE=LOGREC,DATAADR=(1),LENGTH=(0),BUFFER=YES,RCVRY=ESTAE 92050002
         LTR   R15CODE,R15CODE         WAS RECORD WRITTEN               92120002
         BZ    RECOK                   YES - BR TO INSERT SUCCESS SYM   92190002
         SPACE                                                          92260002
         MVI   SUCCESS(R11BUFSV),NOTSUC PUT SUCCESS SYMBOL IN BUFF      92330002
         B     TERM1                   BR TO TERMINATE                  92400002
         SPACE                                                          92470002
RECOK    MVC   ZERO(MSG,R11BUFSV),TPR  MOVE 'TPR' TO BUFFER             92540002
         MVI   SUCCESS(R11BUFSV),OK    PUT SUCCESS SYMBOL IN BUFF       92610002
         EJECT                                                          92680002
*                                                                       92750002
*      ROUTINE TO TERMINATE - EXIT TO ERROR XCTL ROUTINE OR SUPERVISOR  92820002
*                                                                       92890002
TERM1    ESTAE 0                                               @ZA06003 92960004
         XR    R13PARM,R13PARM     CLEAR R13                   @ZA06003 93010004
         ICM   R13PARM,THREE,BINXCTL LOAD XCTL MOD NAME        @ZA02772 93060003
TERM1A   DS    0H                                              @ZA02772 93160003
         LTR   R13PARM,R13PARM         IS THERE XCTL INFO               93310002
         BZ    EXIT3                   NO - BR TO EXIT TO SUPERVISOR    93380002
         CLI   SUCCESS(R11BUFSV),NOTSUC UNSUCCESSFUL RECDG?    @ZA02772 93390003
         BE    EXIT1               YES, BYPASS FREE CORE       @ZA02772 93400003
         BAL   R14LINK,FREECORE    GO FREE GOTTEN CORE         @ZA02772 93410003
         LR    R1PARM,R12IOB       GET IOSB ADDR               @ZA02772 93420003
         SPACE                                                          93450002
*        EXIT TO SPECIAL XCTL ROUTINE                                   93520002
EXIT1    L     R14EXIT,CVTXTLER         LOAD ADDR OF ERR XCTL RT Y02021 93590002
         BR    R14EXIT                 BR TO SPECIAL XCTL ENTRY         93660002
         SPACE                                                          93730002
**       FREE IOSB AND RETURN TO SUPERVISOR                    @ZA02772 93800003
EXIT3    TM    IOSPKEY,IOSIDR      DIR RECORDING?              @ZA02772 93820003
         BO    EXIT4               YES, GO TO SPECIAL EXIT     @ZA02772 93840003
         BAL   R14LINK,FREECORE    GO FREE GOTTEN CORE         @ZA02772 93860003
         LR    R1PARM,R12IOB       GET IOSB ADDR               @ZA02772 93880003
         LA    R1PARM,ZERO(R1PARM) CLEAR HIGH ORDER BYTE OF RQE ADDR    93900003
         SVC   ERREXCP                  FREE IOSB                Y02021 93940002
         SVC   EXIT                    EXIT TO SUPERVISOR               94010002
         SPACE 1                                               @ZA02772 94018003
**       DIR EXIT ROUTINE                                      @ZA02772 94026003
EXIT4    EQU   *                                       @ZA26915@ZA02772 94034030
         CLI   SUCCESS(R11BUFSV),NOTSUC  UNSUCCESS?    @ZA26915@ZA02772 94039030
         BE    EXIT5                   YES-BYPSSFREEMN @ZA26915@ZA02772 94044030
         BAL   R6WORK,FREEIOSB       FREE IOSB/SRB/EWA @ZA26915@ZA02772 94049030
         BAL   R14LINK,FREECORE    GO FREE GOTTEN CORE @ZA26915@ZA02772 94054030
         SVC   EXIT                    RETURN TO SVC   @ZA26915@ZA02772 94059030
EXIT5    EQU   *                                       @ZA26915@ZA02772 94064030
         BAL   R6WORK,FREEIOSB       FREE IOSB/SRB/EWA @ZA26915@ZA02772 94069030
         SVC   EXIT                    RETURN TO SVC   @ZA26915@ZA02772 94074030
         SPACE 1                                                        94080002
MIN3670  DC    H'37'                   MINIMUM RECORD SIZE FOR 3670     94150002
HDRLEN   DC    H'24'                   BYTES IN A MDR RECORD HEADER     94220002
TPR      DC    C'TPR'                  CHARACTERS PLACED IN BUFFER      94290002
*                                       IF RECORD WAS WRITTEN           94360002
MDRINPRG DC    X'FE'                    MDR IN PROGRESS IND      Y02021 94390002
CONST4   DC    H'4'                    CONSTANT OF FOUR                 94430002
CONST7   DC    H'7'                     BUFFER COUNT ADJUST    @YM6451P 94460002
TY2314   DC    X'2008'                 2314 DEVICE CLASS AND TYPE CODE  94500002
UR3800   DC    X'080E'             ARGONAUT-3800               @Z402IVS 94520000
UR3350   DC    X'200B'             3350                        @Z40RSVS 94550004
ZEROS    DC    X'000000'               CONSTANT OF ZEROS                94570002
         SPACE                                                          94640002
*      THE FOLLOWING INSTRUCTIONS ARE EXECUTED BY EXECUTE -EX-          94710002
         SPACE                                                          94780002
MOVESENS MVC   ZERO(ZERO,R8WORK),ZERO(R5WORK)    MOVE SENSE TO RECORD   94850002
         SPACE                                                          94920002
MOVESTAT MVC   ZERO(ZERO,R8WORK),ZERO(R7WORK)    MOVE STATS TO REX03127 94990002
         SPACE                                                          95060002
CLRSTAT  XC    TWO(ZERO,R7WORK),TWO(R7WORK)  CLEAR STAT COUNTERS X03127 95130002
         SPACE                                                          95200002
MOVEBUFF MVC   RECINFO(ZERO),BUFBODY    MOVE REMAINDER OF BFR  @YM6451P 95220002
         SPACE 1                                               @YM6451P 95240002
         DS    0H                                                       95270002
DDRMOD   DC    XL2'19C9'               BINARY EQUIV OF DDR MOD NAME     95340002
EODMOD   DC    XL2'2357'               BINARY EQUIV OF EOD MOD NAME     95410002
MULTICON DC    H'10'                   LENGTH OF NORM STAT COUNTER      95480002
         SPACE 3                                                        95550002
MASK     DC    F'15'                   STAT TABLE COUNT MASK   @YM6451P 95620002
DIRJOB   DC    C'PAGE ERR'             JOB NAME FOR DIR        @YM6451P 95690002
         SPACE 1                                                        95760002
ESTALIST ESTAE MF=L                                                     95830002
PGMCKADD DC    A(OBRPGMCK)              ESTAE ENTRY POINT        Y02021 95900002
         SPACE 1                                                        95970002
         EJECT                                                          96040002
*                                                                       96110002
****   WARNING-DO NOT PUT ANY CODE BEYOND THIS POINT                    96180002
*                                                                       96250002
*                                                                       96320002
***      STAE EXIT ROUTINE TO FREE CORE                                 96390002
*                                                                       96460002
         SPACE                                                          96530002
OBRPGMCK C     R0PARM,STAETEST          TEST FOR WORK AREA       Y02021 96600002
         BE    GETREGS                  NO-USE REG 2             Y02021 96670002
         L     R2CVTBAS,ZERO(R1PARM)    GET POINTER INTO REG 2   Y02021 96740002
GETREGS  LM    R2CVTBAS,R12IOB,ZERO(R2CVTBAS)     GET REGS       Y02021 96810002
         L     R13PARM,FRECORAD         GET BRANCH ADDRESS       Y02021 96880002
         BR    R13PARM                  BRANCH TO FREE CORE      Y02021 96950002
*                                       R14 CONTAINS RETURN ADDR Y02021 97020002
FRECORAD DC    A(FREECORA)             PTR TO FREE CORE RTN    @YM6451P 97090002
STAETEST DC    A(12)                    STAE STORAGE TEST        Y02021 97160002
PTCHAREA DC    30F'0'                  PGM PATCH AREA                   97230002
PATCHEND EQU   *                                                Z40HIVS 97260003
         END                                                            97300002
./  ADD  SSI=73080141,NAME=IFBSVC76
 TITLE 'IFBSVC76 - IGC0007F - SVC 76 LOGREC RECORDER'                   00060002
* /* START OF SPECIFICATIONS******************************************* 00120002
*                                                                     * 00180002
*01* MODULE-NAME - IGC0007F                                           * 00240002
*                                                                     * 00300002
*01* DESCRIPTIVE-NAME - 1.IFBSTAT 2.SYS1.LOGREC RECORDER              * 00360002
*                                                                     * 00420002
*01* COPYRIGHT -N/A                                                   * 00480002
*                                                                     * 00540002
*01* STATUS - VERSION 000 MODULE SUPPORT CODE Y02021                  * 00600002
*                                                                     * 00660002
*01* CHANGE-ACTIVITY - MODULE REPLACED COMPLETELY                     * 00720002
*                                                                     * 00780002
*02*     A - ALL NEW LINES ADDED                                      * 00840002
*                                                                     * 00900002
*02*     D - ALL PREVIOUS LINES DELETED                               * 00960002
*                                                                     * 01020002
*02*     C - NO LINES CHANGED                                         * 01080002
*                                                                     * 01140002
*                                                                     * 01200002
*01* FUNCTION - THE SYS1.LOGREC RECORDER IS THE SVC ROUTINE IFBSTAT,  * 01260002
*               INVOKED BY ISSUING SVC76. ITS FUNCTION PROVIDES A     * 01300002
*               METHOD OF RECORDING TO THE SYS1.LOGREC DATA SET.      * 01340002
*                                                                     * 01380002
* FUNCTION 1 - RECORD PREFORMATTED RECORD.                            * 01420002
*                                                                     * 01460002
*                                                                     * 01500002
* FUNCTION 2 - THIS PROVIDES A METHOD WHEREBY THE INTERNAL            * 01560002
*              STATISTICAL DATA, MAINTAINED BY THE IOS ERROR          * 01620002
*              ROUTINES, CAN BE RECORDED ON THE SYS1.LOGREC DATA SET. * 01680002
*                                                                     * 01740002
*                A.ALL STATISTICAL DATA WILL BE RECORDED ON           * 01800002
*                  THE SYS1.LOGREC DATA SET, IF THE INPUT PARA-       * 01860002
*                  METER  IS 0 (HALT - END OF DAY),OR 4(IFCEREPO)     * 01920002
*                                                                     * 01980002
*                B.EXTRACTING CVTILK2 FROM THE CVT YIELDS A LIST OF   * 02040002
*                  UCB POINTERS. EACH UCB IS ACCESSED, AND ITS        * 02100002
*                  UCBSTI FIELD MULTIPLIED BY TEN AND ADDED TO THE    * 02160002
*                  CONTENTS OF THE CVTSTB FIELD IN THE CVT. THE       * 02220002
*                  EIGHT BYTES AT THE CALCULATED FIELD ARE CHECKED    * 02280002
*                  FOR ZERO. A ZERO FIELD CAUSES NO FURTHER ACTION    * 02340002
*                  TO BE TAKEN FOR THIS STATISTICAL FIELD. A NON ZERO * 02400002
*                  FIELD IS SAVED IN GOTTEN CORE AND THE              * 02460002
*                  STATISTICAL COUNTER IS CLEARED.                    * 02520002
*                                                                     * 02580002
*                C.A. SHORT OBR RECORD IS FORMATTED TO INCLUDE THE    * 02640002
*                  STATISTICAL DATA AREA.                             * 02700002
*                                                                     * 02760002
*                D.THE SHORT OBR RECORD IS THEN WRITTEN TO THE SYS1.  * 02820002
*                  LOGREC DATA SET.  THIS PROCESS IS                  * 02880002
*                  REPEATED EACH TIME A STATISTICAL FIELD IS FOUND    * 02940002
*                  TO BE NON ZERO.                                    * 03000002
*                                                                     * 03060002
*               E.FUNCTION 3 WILL BE GIVEN CONTROL IN LINE IF IT      * 03120002
*                  IS TO BE PERFORMED. IF FUNCTION 3 IS NOT TO BE     * 03180002
*                  PERFORMED THEN EXIT IS MADE VIA REGISTER 14.       * 03240002
*                                                                     * 03300002
* FUNCTION 3 - THIS FUNCTION CAN BE EITHER EXCLUSIVE OF FUNCTION 2    * 03360002
*              IF THE INPUT PARAMETER IS 8 (IPL - VIA MASTER          * 03420002
*              SCHEDULER),OR IN ADDITION TO FUNCT. 2 IF THE INPUT     * 03480002
*              PARAMETER IS 0 (HALT - END OF DAY).                    * 03540002
*                                                                     * 03600002
*              TO CONTINUE THE IPL OR EOD RECORD PROCESSING           * 03660002
*              WHEN IT WAS DETERMINED THAT SUCH A                     * 03760002
*              RECORD WAS TO BE PLACED ON SYS1.LOGREC.                * 04020002
*                                                                     * 04080002
*                A.VIA A WTOR,INFORMATION IS GATHERED FROM            * 04140002
*                  THE OPERATOR TO ASSIST IN FORMULATING AN           * 04200002
*                  IPL RECORD. IF AN EOD IS THE TYPE REQUIRED         * 04260002
*                  CONSTRUCTION OF THE RECORD IS PERFORMED            * 04320002
*                  WITHOUT THE AID OF THE OPERATOR. THE               * 04380002
*                  OPERATOR'S REPLY TO THE SYSTEM IS CHECKED          * 04440002
*                  AND IF FOUND TO BE INVALID A MESSAGE IS            * 04500002
*                  ISSUED TO THAT EFFECT, AND THE INITIAL WTOR        * 04560002
*                  IS REISSUED.                                       * 04620002
*                                                                     * 04680002
*                B.AFTER CONSTRUCTION OF THE RECORD(EOD OR IPL)       * 04740002
*                  IS COMPLETED, CONTROL IS PASSED TO FUNCTION 1      * 04800002
*                  FOR RECORDING OF THE RECORD.                       * 04860002
*                  OF THE RECORD.                                     * 04920002
*                                                                     * 04980002
*01* NOTES -                                                          * 05400002
*                                                                     * 05460002
*02*     CHARACTER-CODE DEPENDENCIES - MUST BE REASSEMBLED IF MODE    * 05520002
*        CHANGED FROM EBCDIC.                                         * 05580002
*                                                                     * 05640002
*02*     DEPENDENCIES - N/A                                           * 05700002
*                                                                     * 05760002
*02*     RESTRICTIONS - NONE                                          * 05820002
*                                                                     * 05880002
*02*     REGISTER-CONVENTIONS - ALL REGISTERS EQUATED TO SYMBOLS      * 05940002
*        SEE REG EQUATES AT FRONT OF LISTING                          * 06000002
*        R0, R1 INPUT PARAMETER REGISTERS                             * 06030002
*        REG.2   CVT POINTER REG.                                     * 06060002
*        REG.3   BASE REG.                                            * 06120002
*        REG.4-13 WORK REGS.                                          * 06180002
*        REG.14  RETURN REG.                                          * 06240002
*        REG.15  RETURN CODE REG.                                     * 06300002
*                                                                     * 06360002
*02*     PATCH-LABEL - PTCHAREA, 10 WORDS RESERVED FOR PTCHAREA       * 06420002
*                                                                     * 06480002
*01* MODULE-TYPE - PROCEDURE,  TRANSIENT SVC                          * 06540002
*                                                                     * 06600002
*02*     PROCESSOR - ASSEMBLER XF                                     * 06660002
*                                                                     * 06720002
*02*     MODULE-SIZE - 1 PAGEABLE MODULE                              * 06780002
*                                                                     * 06840002
*02*     ATTRIBUTES - PROTECT KEY ZERO, REENTRANT                     * 06900002
*                                                                     * 06960002
*01* ENTRY-POINT - IGC0007F                                           * 07020002
*                                                                     * 07080002
*02*     PURPOSE - TO RECORD TO SYS1.LOGREC DATA SET                  * 07140002
*                                                                     * 07200002
*02*     PURPOSE - TO WRITE MESSAGES TO OPERATOR.                     * 07260002
*                                                                     * 07320002
*02*     LINKAGE - INVOKED BY ISSUING SVC 76.                         * 07380002
*                                                                     * 07440002
*02*     INPUT - PREFORMATTED SYS1.LOGREC RECORDING                   * 07500002
*        REG.0 - TWOS COMPLEMENT OF NUMBER OF BYTES TO BE RECORDED    * 07560002
*        REG.1 - ADDRESS OF DATA TO BE RECORDED                       * 07620002
*                                                                     * 07680002
*        INPUT - SYS1.LOGREC RECORDINGS FORMATTED BY SVC76            * 07740002
*              REGISTER 0= 0 - ENTRY IS VIA HALT END OF DAY           * 07860002
*              REGISTER 0= 4 - ENTRY IS VIA IFCEREPO UTILITY          * 07920002
*              REGISTER 0= 8 - ENTRY IS VIA MASTER SCHEDULER(IPL)     * 07980002
*              REGISTER 0= C - ENTRY IS FOR OUTAGE                    * 08380002
*                                                                     * 08820002
*02*     OUTPUT - INPUT TO SYS1.LOGREC DATA SET                       * 08880002
*                                                                     * 08940002
*02*     OUTPUT - MESSAGES TO OPERATOR  HH-HOUR, MM-MINUTE, SS-SECOND * 09240002
*        IFB030I SYS1.LOGREC I/O ACCESS ERROR,HH.MM.SS                * 09300002
*        IFB040I SYS1.LOGREC AREA IS FULL,HH.MM.SS                    * 09360002
*        IFB050I SYS1.LOGREC FORMAT ERROR,HH.MM.SS                    * 09420002
*        IFB060E SYS1.LOGREC NEAR FULL                                * 09480002
*                                                                     * 09540002
*02*     EXIT-NORMAL - (1) INSTRUCTION FOLLOWING THE SVC CALL         * 09600002
*        REG.15 - ZERO                                                * 09660002
*                                                                     * 09720002
*02*     EXIT-ERROR - (1) INSTRUCTION FOLLOWING THE SVC CALL          * 09780002
*        REG.15 - EIGHT   - CORE NOT AVAILABLE (NO RECORDING ATTEMPTED) 09840002
*        REG.15 - TWELVE - NO SPACE AVAILABLE (NORECORDING ATTEMPTED) * 09900002
*                        - RECORD OVERRIDE SWITCH SET            Y02021 09960002
*        REG.15 - SIXTEEN - PERM I/O ERROR                            * 09990002
*                         - FORMAT ERROR (HEADER RECORD)              * 10000002
*                                                                     * 10020002
*01* EXTERNAL-REFERENCES -                                            * 10080002
*                                                                     * 10140002
*02*     ROUTINES - SVC 00,SVC 07                                     * 10200002
*02*     ROUTINES - SVC 35                                            * 10260002
*                                                                     * 10320002
*02*     DATA-SETS - SYS1.LOGREC                                      * 10380002
*                                                                     * 10440002
*02*     DATA-AREAS - INPUT DATA AREA,CVT,LOGDCB,WORK AREA            * 10500002
*02*     DATA-AREAS - WORK AREA AQUIRED BY LOGREC RECORDER            * 10560002
*                                                                     * 10620002
* EXTERNAL REFERENCES -                                               * 10680002
*              CVTILK2 - ADDRESS OF THE TWO BYTE UCB POINTERS         * 10740002
*              CVTSTB - BASE ADDRESS VALUE OF STATISTICAL DATA        * 10800002
*              STATAB - ONE BYTE STATISTICAL DATA AREA INDEX IN UCB   * 10860002
*              CVTPTR - ADDRESS OF CVT                                * 10920002
*                                                                     * 10980002
*01* TABLES/WORK AREAS - 380 BYTES OBTAINED FROM SP-245 BY RECORDER   * 11100002
* TABLES/WORK AREAS -                                                 * 11160002
*              CVT, UCB'S, SER DCB, STATAB                            * 11220002
*                                                                     * 11280002
*                                                                     * 11340002
*01* MACROS - GETMAIN,ENQ,DEQ,FREEMAIN,WAIT                           * 11400002
*01* MACROS - TIME,FREEMAIN                                           * 11460002
*                                                                     * 11520002
**** END OF SPECIFICATIONS *********************************/           11580002
       EJECT                                                            11640002
*                        HEADER  RECORD  AREA                         * 11700002
*       *************************************************************** 11760002
*       *              *                                *     HIGH    * 11820002
*  +0   *  F F F F     *          LOW EXTENT            *   EXTENT    * 11880002
*       *              *            (CCHH)              *      (CC)   * 11940002
*       *************************************************************** 12000002
*       * HIGH EXTENT  *       *         RECORD ENTRY AREA ADDRESS    * 12060002
*  +8   *   (CONT.)    * SPARE *                (BBCCHHR)             * 12120002
*       *    (HH)      *       *                                      * 12180002
*       *************************************************************** 12240002
*       *  REC. ENTRY  *  REMAINING     *  TOTAL BYTES  *  ADDRESS OF * 12300002
*  +16  * AREA ADDR.   *   BYTES ON     *      ON       *  LAST RECORD* 12360002
*       *    (CONT.)   *     TRACK      *    TRACK      *    WRITTEN  * 12420002
*       *************************************************************** 12480002
*       *           ADDRESS OF LAST RECORD       * TRACKS      * EARLY* 12540002
*  +24  *                WRITTEN (CONT.)         *    PER      * WARN.* 12600002
*       *                                        * CYLINDER    *  CNT.* 12660002
*       *************************************************************** 12720002
*       * EARLY * DEV- *     EARLY WARNING              * EARLY*  CK. * 12780002
*  +32  * WARN. *  ICE *               MESSAGE TRACK    * WARN.* BYTE * 12840002
*       * CNT.  * CODE *                                * SWT. * (FF) * 12900002
*       *************************************************************** 12960002
         EJECT                                                          13020002
*                        OBR RECORD - SHORT FORM              *         13080002
*     *********************************************************         13140002
*     * REC  * OP   *                           * REC  *      *         13200002
* +0  * TYPE * SYS  *         SWITCHES          * CNT  *SPARE *         13260002
*     *      *      *                           *      *      *         13320002
*     *********************************************************         13380002
*     *                           *                           *         13440002
* +8  *           DATE            *         TIME              *         13500002
*     *                           *                           *         13560002
*     *********************************************************         13620002
*     *      *      CPU           *   MODEL     *    MAX      *         13680002
* +16 * RSVD *      SERIAL        *   NUMBER    *    MCEL     *         13740002
*     *      *      NUMBER        *             *    LENGTH   *         13800002
*     *********************************************************         13860002
*     *                           *       *                   *         13920002
* +24 *        DEVICE TYPE        *  SOR  *        CUA        *         13980002
*     *                           * COUNT *                   *         14040002
*     *********************************************************         14100002
*     *                                                       *         14160002
* +32 *               STATISTICAL  DATA  AREA   (10 BYTES)    *         14220002
*     *                                                       *         14280002
*     *********************************************************         14340002
*     *               *                                       *         14400002
* +40 *               *       (20 BYTES)                      *         14460002
*     *               *                                       *         14520002
*     *********************************************************         14580002
*     *                           *                                     14640002
* +48 *                           *                                     14700002
*     *                           *                                     14760002
*     *****************************                                     14820002
         EJECT                                                          14880002
*                             IPL RECORD FORMAT                         14940002
*     *********************************************************         15000002
*     * REC  * OP   *                           * REC  *      *         15060002
* +0  * TYPE * SYS  *         SWITCHES          * CNT  *SPARE *         15120002
*     *      *      *                           *      *      *         15180002
*     *********************************************************         15240002
*     *                           *                           *         15300002
* +8  *           DATE            *         TIME              *         15360002
*     *                           *                           *         15420002
*     *********************************************************         15480002
*     *      *      CPU           *   MODEL     *    MAX      *         15540002
* +16 * RSVD *      SERIAL        *   NUMBER    *    MCEL     *         15600002
*     *      *      NUMBER        *             *    LENGTH   *         15660002
*     *********************************************************         15720002
*     *SUB-   *  CHANNEL UNIT      *   REASON     *  CHANNEL  *         15780002
* +24 *SYSTEM *   ADDRESS OF       *    FOR       *    MAP    *         15840002
*     *  ID   *  FAILING DEVICE    *    IPL       *           *         15900002
*     *********************************************************         15960002
*     *                                                       *         16020002
* +32 *            CHANNEL    TYPE    ASSIGNMENT              *         16080002
*     *                                                       *         16140002
*     *********************************************************         16200002
*     *                            *                          *         16260002
* +40 *        HIGHEST  ADDRESS    *      EXPANSION  BYTES    *         16320002
*     *             AT  IPL        *                          *         16380002
*     *********************************************************         16440002
*     *                                                       *         16450002
* +48 *                       TIME STAMP                      *         16460002
*     *                                                       *         16470002
*     *********************************************************         16480002
         EJECT                                                          16500002
*                             EOD RECORD FORMAT                         16560002
*     *********************************************************         16620002
*     * REC  * OP   *                           * REC  *      *         16680002
* +0  * TYPE * SYS  *         SWITCHES          * CNT  *SPARE *         16740002
*     *      *      *                           *      *      *         16800002
*     *********************************************************         16860002
*     *                           *                           *         16920002
* +8  *           DATE            *         TIME              *         16980002
*     *                           *                           *         17040002
*     *********************************************************         17100002
*     *      *      CPU           *   MODEL     *    MAX      *         17160002
* +16 * RSVD *      SERIAL        *   NUMBER    *    MCEL     *         17220002
*     *      *      NUMBER        *             *    LENGTH   *         17280002
*     *********************************************************         17340002
         EJECT                                                          17400002
*                                                                       17460002
**       THE FOLLOWING ARE REGISTER EQUATES                          ** 17520002
*                                                                       17580002
ZEROREG  EQU   0                       REGISTER 0  USED IN ADDR'BILITY  17640002
R0PARM   EQU   0                       REGISTER 0                       17700002
R1PARM   EQU   1                       REGISTER 1                       17760002
R1LINK   EQU   1                       REGISTER 1                       17820002
R2CVTBAS EQU   2                       REGISTER 2                       17880002
R2WRKBAS EQU   2                       REGISTER  2 ADDR OF GOTTEN CORE  17940002
R3CBASE  EQU   3                       REGISTER 3 CSECT BASE            18000002
R4WORK   EQU   4                       REGISTER 4                       18060002
R5WORK   EQU   5                       REGISTER 5                       18120002
R6WORK   EQU   6                       REGISTER 6                       18180002
R6LINK   EQU   6                       REGISTER  6 INTERNAL LINKAGE     18240002
R7WORK   EQU   7                       REGISTER 7                       18300002
R8WORK   EQU   8                       REGISTER 8                       18360002
R9WORK   EQU   9                       REGISTER 9                       18420002
R9LINK   EQU   9                       REGISTER  9 INTERNAL LINKAGE     18480002
R9LOGBAS EQU   9                       REGISTER 9 LOG DSECT BASE        18540002
R10SIZE  EQU   10                      REGISTER 10 RECORD SIZE          18600002
R10WORK  EQU   10                       REGISTER 10 WORK REG     Y02021 18660002
R11CNTRL EQU   11                      REGISTER 11 CONTROL BCT LOOPS    18720002
R11RECAD EQU   11                      REGISTER 11 RECORD ADDR          18780002
R12WORK  EQU   12                      REGISTER 12 WORK REG             18840002
R12MSGCD EQU   12                      REGISTER 12 CODE PASSED TO MSG   18900002
R13RETAD EQU   13                      REGISTER 13 RETURN ADDR          18960002
R14RETRN EQU   14                      REGISTER 14 RETURN TO CALLER     19020002
R14UCBPT EQU   14                      REGISTER 14 TEMP  UCB POINTER    19080002
R15CODE  EQU   15                      REGISTER 15 CONDITION CODE       19140002
*                                                                       19200002
**       THE FOLLOWING ARE DISPLACEMENT AND LENGTH EQUATES           ** 19260002
*                                                                       19320002
ZERO     EQU   0                       DIS OF ZERO                      19380002
FRSTWRD  EQU   0                       FIRST FULL WORD IN A TABLE       19440002
SECDWRD  EQU   4                       SECOND FULL WORD IN A TABLE      19500002
THRDWRD  EQU   8                       THIRD  FULL WORD IN A TABLE      19560002
FORTHWRD EQU   12                      FOURTH FULL WORD IN A TABLE      19620002
RBEXSAVE EQU   96                      DIS TO SVRB EXTENSION            19680002
IOBECBPT EQU   4                       DIS TO ADDR OF ECB IN THE IOB    19800002
IOBSTART EQU   16                      DIS TO ADDR OF CHAN PGM IN IOB   19860002
IOBDCBPT EQU   20                      DIS TO ADDR OF DCB IN THE IOB    19920002
DCBDEBAD EQU   44                      DIS TO ADDR OF DEB IN THE DCB    19980002
DCBFLAG  EQU   48                      DIS TO SPECIAL FLD IN LOG DCB    20040002
EODCB    EQU   60                      DIS TO EXTENSION OF LOGREC DCB   20100002
DEBUCBAD EQU   32                      DIS TO UCB ADDR IN DEB           20160002
DEBBCH   EQU   36                      DIS TO BBCCHH OF BEGINNING OF    20220002
*                                       LOGREC DATA SET IN DEB          20280002
UCBUNTYP EQU   19                      DIS TO UNIT TYPE IN UCB          20340002
OPSYSVS  EQU   1                       DIS TO SYS REL # IN RECORD       20400002
         EJECT                                                          20460002
ONE      EQU   1                       LENGTH OF ONE                    20520002
TWO      EQU   2                       LENGTH OF 2                      20580002
THREE    EQU   3                        LENGTH OF 3            @YM6452P 20610002
FOUR     EQU   4                       LENGTH OF 4                      20640002
FIVE     EQU   5                        COUNT OF FIVE          @YM2951P 20670002
SIXTEEN  EQU   16                       LENGTH OF SIXTEEN        YM5198 20680002
ECBLEN   EQU   4                       LENGTH OF ECB                    20700002
EIGHT    EQU   8                       LENGTH OF 8 BITS                 20760002
GETTABLN EQU   16                      LENGTH OF GETMAIN TABLE          20820002
WCFLDLEN EQU   256                     LENGTH OF LOG DSECT              20880002
CHANPGLN EQU   56                      LENGTH OF CHANNEL PROGRAM        20940002
KEYDTALN EQU   3                       LENGTH OF KEYLEN & DATALEN FLDS  21000002
CCHH     EQU   4                       LENGTH OF CCHH    FIELD          21060002
CCHHR    EQU   5                       LENGTH OF CCHHR FIELD            21120002
BBCCHH   EQU   6                       LENGTH OF BBCCHH  FIELD          21180002
BBCCHHR  EQU   7                       LENGTH OF BBCCHHR FIELD          21240002
NAMELN   EQU   8                       LENGTH OF MODULE NAME            21300002
XCTLLST  EQU   16                      LENGTH OF XCTL LIST AREA         21360002
SUBPLNM  EQU   245                     SUBPOOL VALUE                    21420002
HH       EQU   2                       LENGTH OF UNPACKED HOURS         21480002
MM       EQU   2                       LENGTH OF UNPACKED MINUTES       21540002
PACKTIME EQU   4                       LENGTH OF PACKED TIME - HHMMSSTH 21600002
UNPKTIME EQU   7                       LENGTH OF UNPACKED TIME -HHMMSST 21660002
HHMMSS   EQU   8                       LENGTH OF FORMATED TIME-HH.MM.SS 21720002
MSG1LEN  EQU   63                      LENGTH OF I/O ERROR MESSZ08973JW 21780003
MSG2LEN  EQU   49                      LENGTH OF LOG FULL MSG           21840002
MSG5LEN  EQU   49                      LENGTH OF FORMAT ERROR MSG       21900002
MSG6LEN  EQU   37                      LENGTH OF EARLY WARNING MSG      21960002
HDR      EQU   32                       LENGTH OF SHORT RE HDR   X03127 22020002
C8       EQU   8                                               @YL02021 22025002
C10      EQU   10                                              @YL02021 22030002
C28      EQU   28                       ENQ LIST COUNT         @YM6451P 22032002
C40      EQU   40                                              @YL02021 22035002
REC2     EQU   2                                               @YL02021 22040002
C4       EQU   4                                               @YL02021 22045002
L40      EQU   40                       LENGTH OF OUTAGE REC   @YL02021 22050002
C12      EQU   X'0C'                                           @YL02021 22055002
OUTFLAG  EQU   X'80'                                           @YL02021 22060002
OUTTYPE  EQU   X'83'                                           @YL02021 22065002
X80      EQU   X'80'                                           @YL02021 22070002
         EJECT                                                          22080002
INCRDIS  EQU   3                       DIS TO REFRESH NUM IN CVTRELNM   22140002
RELLN    EQU   2                       LENGTH OF THE RELEASE NUMBER     22200002
WORD     EQU   4                       LENGTH OF A FULL WORD            22260002
TABENTRY EQU   3                       LENGTH OF 1 ENTRY IN THE VALID   22320002
*                                       SUB SYS ID TABLE                22380002
REPLYLEN EQU   5                       LENGTH OF REPLY FROM WTOR        22440002
REASONLN EQU   2                       LENGTH OF REASON PORTION OF REPY 22500002
IDLEN    EQU   2                       LENGTH OF SUB SYS ID IN REPLY    22560002
CHASTBLN EQU   8                       LENGTH OF CHANNEL ASSIGNMENT TAB 22620002
EODSIZE  EQU   24                      LENGTH OF AN EOD RECORD          22680002
IPLSIZE  EQU   56                                              @YL02021 22740002
ERRMSGLN EQU   40                      LENGTH OF THE INVALID REPLY MSG  22800002
IMSGSIZE EQU   54                      LENGTH OF WTOR MSG               22860002
ELEVEN   EQU   11                                               YM4105P 22870002
ONE24    EQU   124                      ADDITIONAL GETMAIN       YM5198 22880002
GETLNGTH EQU   380                      GETMAIN SIZE             YM5198 22900002
STORSIZE EQU   256                     LENGTH OF GOTTEN CORE     Y02021 22920002
NXTSTATA EQU   2                       DIS TO ADDR OF NEXT STAT TAB     22980002
*                                       SECTION                         23040002
NXTUCBAD EQU   2                       DIS TO THE ADDR OF THE NEXT UCB  23100002
UCBFL5   EQU   1                       DIS TO FLAG BYTE IN UCB          23160002
SRTESTAT EQU   3                       DIS TO STATUS BYTE IN UCB        23220002
UCBSTI   EQU   9                       DIS TO INCREMENT IN UCB WHICH,   23280002
*                                       WHEN MULTI. BY 10 BECOMES INDEX 23340002
*                                       INTO STAT TAB FOR THAT DEVICE.  23400002
UCBNAME  EQU   12                      DIS TO WORD CONTAINING CUA IN    23460002
*                                       EBCDIC IN THE UCB               23520002
UCBTYP   EQU   16                      DIS TO DEVICE TYPE FIELD IN UCB  23580002
UCBDEVCL EQU   18                      DIS TO DEVICE CLASS IN UCB       23640002
DEVTPE   EQU   2                       LENGTH OF DEVICE TYPE FLD IN UCB 23700002
WORKLEN  EQU   8                       LENGTH OF WORK AREA              23760002
SDRDATA  EQU   8                       LENGTH OF COUNTERS IN A 10 BYTE  23820002
*                                       STAT TAB                        23880002
SDRLEN   EQU   10                      LENGTH OF NORMAL STAT FIELD      23940002
NEWSDRDT EQU   18                      LENGTH OF STAT COUNTERS IN A     24000002
*                                       20 BYTE STAT FLD                24060002
NEWSDRLN EQU   20                      LENGTH OF A 20 BYTE STAT FIELD   24120002
BLDLST   EQU   18                      LENGTH OF BLDL LIST              24180002
RECLNW10 EQU   42                      LENGTH OF RECORD WITH A 10 BYTE  24240002
*                                       STAT FIELD                      24300002
RECLNW20 EQU   52                      LENGTH OF RECORD WITH A 20 BYTE  24360002
*                                       STAT FIELD                      24420002
         SPACE                                                          24480002
**       THE FOLLOWING EQUATES ARE FOR CCW COMMANDS                  ** 24540002
*                                                                       24600002
*                                                                       24660002
WRTDATA  EQU   X'05'                   WRITE DATA COMMAND CODE          24720002
READ     EQU   X'06'                   READ DATA COMM CODE              24780002
TRANCHAN EQU   X'08'                   TRANSFER IN CHANNEL COMM CODE    24840002
WRTCTKYD EQU   X'1D'                   WRITE COUNT,KEY,&DATA COMMAND    24900002
SRCHID   EQU   X'31'                   SEARCH ON ID EQUAL  COMM CODE    24960002
RECZERO  EQU   0                       SEEK ADDR OF ZERO                25020002
RECRDONE EQU   X'01'                   FIRST RECORD ON THE TRACK        25080002
LSTREC   EQU   X'FF'                   LAST RECORD ON THE TRACK         25140002
         EJECT                                                          25200002
*                                                                       25260002
**       THE FOLLOWING EQUATES ARE FOR BIT AND MASK POSITIONS        ** 25320002
*                                                                       25380002
EXTDCB   EQU   X'01'                   TEST BIT FOR EXTENDED DCB        25440002
WRTEWMSG EQU   X'01'                   BIT IN FLAGS TO WRITE EARLY WRN  25500002
IOERR    EQU   X'02'                   BIT TO SIGNIFY AN IO ACCESS ERR  25560002
BADHDR   EQU   X'04'                   BIT TO SIGNIFY HDR REC IS INVALD 25620002
EOEXTFLG EQU   X'08'                   BIT TO SIGNIFY LOGREC IS FULL    25680002
SUPINCLN EQU   X'20'                   'SILI' BIT IN CCW TO SUPRESS     25740002
*                                       INCORRECT LENGTH                25800002
VS2IND   EQU   X'80'                    VS2 RELEASE INDICATOR    Y02021 25860002
AOSFLG   EQU   X'40'                   INDICATE AOS IN REL NO.          25920002
EOFFLG   EQU   X'80'                   FLAG TO SIGNIFY THAT THE RECORD  25980002
*                                       WRITTEN IS NOT ON THE LAST TRK  26040002
*                                       OF THE DATA SET.                26100002
EWMSGISU EQU   X'80'                   BIT IN HDR TO SIGNIFY THAT THE   26160002
*                                       EARLY WARNING MSG HAS BEEN ISUD 26220002
IOBFLAG1 EQU   X'42'                   FLAGS IN IOB TO SIGNIFY COMM     26280002
*                                       CHANING AND UNRELATED RECORDS   26340002
IOBSENS1 EQU   2                        LOCATION OF SENSE BYTES         26360002
IOBSTAT1 EQU   12                       LOCATION OF STATUS BYTE         26380002
GOODHDR  EQU   X'FF'                   CONTENTS OF CHK BYT IN A GOOD HD 26400002
*                                                                       26460002
TIMEBIT  EQU   X'08'                   BIT IN RECORD TO SIGNIFY THAT    26520002
*                                       THE TIME MACRO WAS USED         26580002
IPLTYPE     EQU   X'50'                IPL RECORD TYPE                  26640002
EODREC   EQU   X'80'                   EOD RECORD TYPE                  26700002
OFF      EQU   X'00'                   USED TO CLEAR A BYTE             26760002
OFFENQ   EQU   X'FD'                    TURN ENQ IND OFF        YM6767P 26820002
SDR20BYT EQU   X'01'                   BIT IN STAT TO SIGNIFY THAT THIS 27000002
*                                       IS A 20 BYTE STAT TAB           27060002
UCBNEWST EQU   X'10'                   BIT IN UCB FLAG BYTE TO SIGNIFY  27120002
*                                       A NEW TYPE STATISTICS TABLE     27180002
EODSHORT EQU   X'A0'                   BITS IN UNIT CHECK RECORD TO     27240002
*                                       SIGNIFY A SHORT REC & SDR DUMP  27300002
NOCLR    EQU   X'80'                   BIT IN STAT TO SIGNIFY NOT TO    27360002
*                                       CLEAR THE OPTION BYTE(BYTE TWO) 27420002
ONLINE   EQU   X'80'                   BIT IN UCB STATUS BYTE FOR ONLIN 27480002
OBRREC   EQU   X'30'                   UNIT CHECK - OBR RECORD TYPE     27540002
NUMARC   EQU   X'F0'                   BITS TO SIGNIFY A NUMERIC DIGIT  27600002
CLRUNIT  EQU   X'F0'                   BITS TO CLEAR UNIT ADDR FROM REC 27660002
HEX13    EQU   X'13'                    MCH RE TYPE            @YM2951P 27690002
FOX      EQU   X'0F'                                            YM4105P 27700002
HEX14    EQU   X'14'                                           @YM2953P 27710002
         EJECT                                                          27720002
**       THE FOLLOWING EQUATES ARE FOR CONDITION CODE SETTINGS       ** 27780002
*                                                                       27840002
EXTENTNG EQU   X'42'                   ECB COMP CODE - NOT WITHIN EXTNT 27900002
INTCEPT  EQU   X'44'                   ECB COMP CODE - INTERCEPT        27960002
NORMAL   EQU   X'7F'                   ECB COMP CODE - NORMAL COMPLETON 28020002
WILLFIT  EQU   1                       RESULT OF SUBT WAS NOT ZERO      28080002
NOTLST   EQU   1                       REC WRITTEN WAS NOT ON LAST TRK  28140002
RUNNING  EQU   1                       CONDITION IF OBR IS RUNNING      28200002
EODS     EQU   4                       AN END OF LOGREC DATA SET COND   28260002
UNEQUAL  EQU   7                       AN UNEQUAL COMPARE               28320002
EQUAL    EQU   8                       BRANCH IF CONDITION IS EQUAL     28380002
STRNOTAV EQU   8                       COND CODE FOR STOR NOT AVAIL     28440002
ZEROLENG EQU   8                                                        28500002
LOGFULL  EQU   0                       CODE TO MSG MOD FOR LOGREC FULL  28560002
LOGFORER EQU   4                       CODE TO MSG MOD FOR HDR REC INCR 28620002
LOGIOERR EQU   8                       CODE TO MSG MOD FOR LOGREC IO ER 28680002
LOGNRFUL EQU   12                      CODE TO MSG MOD FOR EARLY WARN   28740002
EXCP     EQU   0                       EXCP SVC NUM                     28800002
GETMAIN  EQU   4                       GETMAIN SVC NUM                  28860002
XCTLNO7  EQU   7                       XCTL SVC NUM                     28920002
DEQUEUE  EQU   48                      DEQUEUE SVC NUM                  28980002
ENQUEUE  EQU   56                      ENQUEUE SVC NUM                  29040002
         EJECT                                                          29100002
         SPACE                                                          29160002
LOGRECFL EQU   12                      LOG FULL CONDITION CODE          29220002
IOERROR  EQU   16                      I/O ERROR CONDITION CODE         29280002
         SPACE                                                          29340002
WTO      EQU   35                      WRITE TO OPERATOR SVC NUM        29400002
         SPACE                                                          29460002
NXTOFF   EQU   1                       NUMBER ADDED TO STAT OFFSET TO   29520002
*                                       GET TO NEXT STAT TAB            29580002
CUANUM   EQU   3                       NUMBER OF DIGITS IN A CUA        29640002
DEVNUM   EQU   8                       NUMBER OF BFRD LOG DEVS @G30HIMD 29700002
SDRREC   EQU   4                       INPUT PARM FROM EREP             29760002
IPLREC   EQU   8                       INPUT PARM FROM SCHED FOR IPL RC 29820002
UNITS    EQU   8                       MAXIMUM NUM OF ADDRESSABLE       29880002
*                                       DRIVES ON A BANK OF 2314'S      29940002
ASPNPARM EQU   51                      PARM PASSED TO SVC91 FOR AN      30000002
*                                       ASPEN TAPE DEVICE        PT0878 30060002
EODPARM  EQU   32                      PARM PASSED TO LOAD 3(IFBSTAT1)  30120002
*                                       FOR EOD SERVICE.                30180002
IPLPARM  EQU   56                      PARM PASSED TO LOAD 3(IFBSTAT1)  30240002
*                                       FOR IPL SERVICE.                30300002
NXTSDRST EQU   256                     NUM OF BYTES IN A STAT TAB SECT  30360002
MAKBIN   EQU   9                       ADDED TO LOW ORDER 4 BITS OF AN  30420002
*                                       ALFABETIC DIGIT OF A CUA TO     30480002
*                                       MAKE A BINARY REPRESENTATION OF 30540002
*                                       THAT DIGIT.  EX. IF 9 IS ADDED  30600002
*                                       TO C1(A) IT WILL MAKE CA. THE   30660002
*                                       BINARY 'A' IS USED FOR THE      30720002
*                                       EBCDIC 'C1'.                    30780002
TOEND    EQU   20                      NUM OF BITS TO MOVE A CUA FROM   30840002
*                                       THE HIGH TO THE LOW ORDER BITS  30900002
*                                       OF A REGISTER.                  30960002
MINUS    EQU   4                       A MINUS CONDITION                31020002
BLDL     EQU   18                      BLDL SVC NUM                     31080002
IFBSTAT  EQU   76                      LOGREC RECORDER SVC NUM          31140002
VOLSTAT  EQU   91                      READ BUFFERED LOG SVC NUM        31200002
         EJECT                                                          31260002
U        EQU   C'U'                    DEFAULT REPLY FOR IPL MSG        31320002
DOT      EQU   C'.'                    CHARACTER TO SEPERATE HH,MM,SS   31380002
BLANK    EQU   C' '                    BLANK CHARACTER                  31440002
REASONUM EQU   13                      NUM OF POSSIBLE REASON CODES     31500002
IDNUM    EQU   14                      NUM OF POSSIBLE SUB SYS ID'S     31560002
WTOR     EQU   35                      WRITE TO OPERATR W/REPLY SVC NUM 31620002
         EJECT                                                          31680002
*                                                                       31740002
IGC0007F CSECT                                                          31800002
         USING LOGDSECT,R9LOGBAS                                        31860002
LOGDSECT DSECT                                                          31920002
WCFIELD  DS    CL2                 UNUSED                               31980002
CTFIELD  DS    CL10               RECORD ENTRY TP ERROR                 32040002
CTFLDID  EQU   CTFIELD            COUNT FIELD ID-CCHHR                  32100002
CTFLD4D  EQU   CTFIELD+4                                                32160002
CTFLDKEY EQU   CTFIELD+5          COUNT FIELD KEY LENGTH                32220002
CTFLDDL  EQU   CTFIELD+6          COUNT FIELD DATA LENGTH               32280002
         DS    0H                                                       32340002
BUFFAREA DS    CL10               27 PLANT CNTRL MPXOR                  32400002
RECSIZE  EQU   BUFFAREA           SIZE OF RECORD                        32460002
         DS    0D                                                       32520002
CCWAREA  DS    CL56                CHANNEL PROGRAM                      32580002
MSGAREA  EQU   CCWAREA                                                  32640002
XCTL     EQU   CCWAREA                                                  32700002
CCW8     EQU   CCWAREA+8                                                32760002
XCTLNAME EQU   XCTL+8                  NAME FIELD IN XCTL LIST          32820002
CCW16    EQU   CCWAREA+16                                               32880002
CCW24    EQU   CCWAREA+24                                               32940002
CCW32    EQU   CCWAREA+32                                               33000002
CCW40    EQU   CCWAREA+40                                               33060002
CCW44    EQU   CCWAREA+44                                               33120002
CCW48    EQU   CCWAREA+48                                               33180002
CCW54    EQU   CCWAREA+54                                               33240002
EWMTIME  EQU   MSGAREA+34              TIME PORTION OF EARLY WARNIG MSG 33300002
FULLTIME EQU   MSGAREA+37              TIME PORTION OF LOG FULL MSG     33360002
FORMTIME EQU   MSGAREA+37              TIME PORTION OF FORMAT ERR MSG   33420002
SENSBYT1 EQU   MSGAREA+41               SNS CHAR 1             @YM6452P 33480002
SENSBYT2 EQU   MSGAREA+42               SNS CHAR 2             @YM6452P 33486002
SENSBYT3 EQU   MSGAREA+43               SNS CHAR 3             @YM6452P 33492002
SENSBYT4 EQU   MSGAREA+44               SNS CHAR 4             @YM6452P 33498002
STATBYT1 EQU   MSGAREA+46               STATUS CHAR 1          @YM6452P 33504002
STATBYT2 EQU   MSGAREA+47               STATUS CHAR 2          @YM6452P 33510002
STATBYT3 EQU   MSGAREA+48               STATUS CHAR 3          @YM6452P 33516002
STATBYT4 EQU   MSGAREA+49               STATUS CHAR 4          @YM6452P 33522002
IOERTIME EQU   MSGAREA+51               TIME PORTION OF I/O ERR         33528002
         SPACE                                                          33540002
         DS    CL5                      SPARE                  @YM6452P 33600002
         DS    0D                                                       33660002
TPRIOB   DS    CL32                IOB FLAG                             33720002
TIMEAREA EQU   TPRIOB                  WORK AREA FOR CONVERTING TIME    33780002
UNPKHH   EQU   TIMEAREA+3              UNPACKED HOURS - HH              33840002
UNPKMM   EQU   TIMEAREA+5              UNPACKED MINUTES - MM            33900002
UNPKSS   EQU   TIMEAREA+7              UNPACKED SECONDS - SS            33960002
UNPKTEN  EQU   TIMEAREA+9              UNPACKED TENTHS OF A SECOND - T  34020002
UNPKHUN  EQU   TIMEAREA+10             UNPACKED HUNDREDS OF A SECOND -H 34080002
FORHH    EQU   TIMEAREA+1              FORMATTED HOURS - HH             34140002
FRSTDOT  EQU   TIMEAREA+3              FIRST DELIMETER - AFTER HH       34200002
FORMM    EQU   TIMEAREA+4              FORMATTED MINUTES - MM           34260002
SECDOT   EQU   TIMEAREA+6              SECOND DELIMETER - AFTER MM      34320002
FORSS    EQU   TIMEAREA+7              FORMATTED SECONDS - SS           34380002
         SPACE                                                          34440002
EXCPSEEK DS    CL8                SEEK ADDRESS FOR EXCP OF HD REC       34500002
SAVETIME EQU   EXCPSEEK                SAVE TIME AFTER TIME MACRO INST  34560002
EXCPSEK1 EQU   EXCPSEEK+1                                               34620002
EXCPSEK3 EQU   EXCPSEEK+3                                               34680002
EXCPSEK7 EQU   EXCPSEEK+7                                               34740002
INPUPARM DS    1H                       RECORD TYPE            @YM6451P 34800002
         DS    1H                       SPARE                  @YM6451P 34830002
SEEKADR  DS    CL7                BBCCHHR USED FOR RD/WR                34860002
SEEKADR2 EQU   SEEKADR+2                                                34920002
SEEKADR6 EQU   SEEKADR+6                                                34980002
FLAGS    DS    CL1                INTERNAL 27 PLANT CTRL MPXOR          35040002
HDRREC   DS    CL40                     HEADER RECORD                   35100002
HDRID    EQU   HDRREC+0                                                 35160002
LOWLIMIT EQU   HDRREC+2                                                 35220002
UPLIMIT  EQU   HDRREC+6                                                 35280002
TMESTMP  EQU   HDRREC+8                 OUTAGE TIME STAMP      @YM6451P 35310002
SPARE    EQU   HDRREC+10                                                35340002
RESTART  EQU   HDRREC+11                                                35400002
BYTSREM  EQU   HDRREC+18                                                35460002
TRKCAP   EQU   HDRREC+20                                                35520002
LASTTTR  EQU   HDRREC+22                                                35580002
LASTTR2  EQU   HDRREC+24                                                35640002
LASTTR4  EQU   HDRREC+26                                                35700002
LASTTR6  EQU   HDRREC+28                                                35760002
TRKSPER  EQU   HDRREC+29                                                35820002
TRKSPER1 EQU   HDRREC+30                                                35880002
EWMCNT   EQU   HDRREC+31                                                35940002
EWMTRK   EQU   HDRREC+34                                                36000002
EWMSW    EQU   HDRREC+38                                                36060002
SFTYBYTS EQU   HDRREC+39                                                36120002
         DS    0F                                                       36180002
TPRECB   DS    CL4                 ECB FLAG                             36240002
         DS    0D                                                       36300002
SAVEREGS DS    CL48                     REGISTER SAVE AREA     @YM2951P 36360002
         DS    3F                       SPARE                  @YM6451P 36390002
RETURNAD DS    1F                       SAVE R14 AREA            Y02021 36420002
SHORTRTN DS    1F                       SHORT RE RETURN ADDR   @YM2953P 36425002
INTSW    DS    CL1                      INTERNAL SWITCH        @YM2951P 36430002
SHTSW    EQU   X'01'                    SHORT RE INDICATOR     @YM2951P 36440002
ENQIND   EQU   X'02'                    ENQUEUE IND FOR STAE     YM5198 36445002
SHTCLR   EQU   X'FE'                    CLEAR SHORT RE IND     @YM2951P 36450002
         ORG   WCFIELD                                           Y02021 36480002
CCWAREA2 DS    3D                       TO HOLD RECORD CCW'S            36540002
CONVERT  EQU   CCWAREA2                 AREA TO ISSUE CVB FROM          36600002
WTOAREA  EQU   CCWAREA2                 WTO MESSAGE AREA                36660002
WTOREPLY EQU   CCWAREA2                 TO HOLD REPLY OF WTOR           36720002
SUBIDRPL EQU   WTOREPLY+3              SUB-SYSTEM ID PORTION OF REPLY   36780002
WTORAREA EQU   CCWAREA2+8               WTOR MESSAGE AREA               36840002
WTORLGTH EQU   WTORAREA                 LENGTH OF WTOR REPLY            36900002
WTORADDR EQU   WTORAREA                 ADDR OF WTOR REPLY BUFFER       36960002
WTORECB  EQU   WTORAREA+4               ADDR OF WTOR ECB                37020002
WTORMESS EQU   WTORAREA+8               BASIC STRUCTURE OF WTOR         37080002
         DS    1D                       ALIGNMENT                       37140002
WRTCCW   DS    4D                       WRITE CHANNEL COMMAND WORDS     37200002
         DS    1D                       ALIGNMENT                       37260002
         SPACE                                                          37320002
         ORG   WCFIELD+296                                     @YM2953P 37380002
RECORD   DS    8D                                              @YM2953P 37410002
CLASRC   EQU   RECORD                                                   37440002
OPSYS    EQU   RECORD+1                                                 37500002
SW1      EQU   RECORD+2                                                 37560002
SW2      EQU   RECORD+3                                                 37620002
INCREL   EQU   RECORD+5                                                 37740002
DATE     EQU   RECORD+8                                                 37800002
TIME     EQU   RECORD+12                                                37860002
CPUSER   EQU   RECORD+16                                                37920002
CPUSER1  EQU   RECORD+17                                                37980002
CPUMODEL EQU   RECORD+20                                                38040002
CPUID    EQU   RECORD+20                                                38100002
SUBSYSID EQU   RECORD+24                                                38160002
DEVTYP   EQU   RECORD+24                                                38220002
REASON   EQU   RECORD+28                                                38280002
SDRCNT   EQU   RECORD+28                                                38340002
CHANMAP  EQU   RECORD+30                                                38400002
CUA      EQU   RECORD+30                                                38460002
UCUA     EQU   RECORD+31                                                38520002
CHANASSN EQU   RECORD+32                                                38580002
SDR      EQU   RECORD+32                                                38640002
HIGHADDR EQU   RECORD+40                                                38700002
SPARE2   EQU   RECORD+44                                       @YL02021 38720002
OUTAGE   EQU   RECORD+48                                       @YL02021 38740002
OUTSAVE  EQU   RECORD+56                OUTAGE SAVE AREA         YM5198 38745002
STAELIST DS    CL16                     STAE LIST SAVE AREA      YM5198 38750002
ESTAPARM DS    CL4                      REG SAVE AREA FOR STAE   YM5198 38755002
         SPACE                                                          38760002
WORKECB  EQU   RECORD                                           YM2958P 38820002
         ORG   WCFIELD+120                                     @YM2953P 38880002
EXSTAT   DS    6F                       ADDITIONAL STAT AREA     Y02021 38940002
         ORG   SHORTRTN+4                                      @YM2953P 38970002
         DS    0D                                              @YM2953P 38980002
WORKIOB  DS    2F                       WORK AREA              @YM6451P 39000002
ENQLSTDS DS    1F                       ENQ LIST AREA          @YM6451P 39100002
QPTR     DS    1F                       QNAME POINTER          @YM6451P 39200002
RPTR     DS    1F                       RNAME POINTER          @YM6451P 39300002
QNM      DS    2F                       QNAME AREA             @YM6451P 39400002
RNM      DS    2F                       RNAME AREA             @YM6451P 39500002
         EJECT                                                          39660002
         USING CVTMAP,R2CVTBAS                                   Y02021 39720002
         CVT   DSECT=YES                                       @YM2951P 39780002
         EJECT                                                          39840002
IGC0007F CSECT                                                          39900002
         EJECT                                                          39960002
*******************************************************************     40020002
*********************************************************************** 40080002
*                                                                     * 40140002
*                                                                 *     40200002
****           LOGREC RECORDER SECTION                          YM2952P 40260002
*                                                                     * 40320002
*                                                                 *     40380002
*                                                                 *     40440002
*********************************************************************** 40500002
*******************************************************************     40560002
         BALR  R3CBASE,ZEROREG         SET UP BASE REGISTER             40620002
         USING *,R3CBASE                                                40680002
         USING PGMCKENT,R5WORK          ESTAE BASE              YM6801P 40710002
WRTREC   L     R2CVTBAS,CVTPTR         LOAD CVT POINTER          Y02021 40740002
XWRKA    LR    R11RECAD,R1PARM         SAVE ADDR OF RECORD              40800002
         LR    R10SIZE,R0PARM          SAVE SIZE OF RECORD              40860002
*                                      NOTE: REG 5 HAS ADDR OF SVRB     40920002
*                                            UPON ENTRY TO SVC 76       40980002
         LA    R5WORK,RBEXSAVE(R5WORK) ADDR OF SVRB EXTENSION           41040002
         MVC   ZERO(GETTABLN,R5WORK),MAINTAB  MOVE GETMAIN TAB TO SVRB  41100002
         LR    R1PARM,R5WORK                  ADDR OF GETMAIN TABLE     41160002
         LA    R5WORK,FORTHWRD(R5WORK)        ADDR OF GOTTEN CORE       41220002
         ST    R5WORK,SECDWRD(R1PARM)         STORE IN TABLE            41280002
         LR    R5WORK,R1PARM                  RESTORE REG 5             41340002
         SVC   GETMAIN                        ISSUE SVC TO GET CORE     41400002
         LTR   R15CODE,R15CODE         CHK FOR SUCCESSFUL GETMAIN       41460002
         BZ    STGAVAIL                 YES,CONTINUE RECORDING          41520002
         LA    R15CODE,STRNOTAV        NO, SET CONDITION CODE           41580002
         BR    R14RETRN                RETURN TO CALLER                 41640002
STGAVAIL L     R9LOGBAS,FORTHWRD(R5WORK)      SET BASE OF WORK STG      41700002
         XC    WCFIELD(WCFLDLEN),WCFIELD      CLEAR GOTTEN STORAGE      41760002
         XC    WCFIELD+STORSIZE(ONE24),WCFIELD+STORSIZE  CLEAR @YM6451P 41790002
         ST    R14RETRN,RETURNAD        SAVE RETURN ADDRESS      Y02021 41820002
         MVC   STAELIST(SIXTEEN),ESTALIST    GET LIST TO MAIN    YM5198 41828002
         LA    R5WORK,ESTAPARM          GET PARAM LIST ADDR      YM5198 41836002
         STM   R9LOGBAS,R9LOGBAS,ESTAPARM    SAVE GETMAIN PTR    YM5198 41844002
         LA    R1PARM,STAELIST          GET STAE LIST ADDR       YM5198 41852002
         L     R6WORK,PGMCKADD          GET ESTAE RTN ADDR       YM5198 41860002
         ESTAE (6),PARAM=(5),MF=(E,(1))                          YM5198 41868002
         LR    R0PARM,R10SIZE           GET RECORD SIZE          Y02021 41880002
         LR    R1PARM,R11RECAD          GET RECORD ADDR          Y02021 41940002
         LTR   R0PARM,R0PARM           TEST REG 0 FOR A MINUS           42000002
         BNM   STATUP                   NO-GO TO STAT UPDATE RTN Y02021 42060002
         SPACE 1                                               @YM2953P 42120002
*     SAVE R14 IN CASE ENTRY IS FOR A SHORT RE FROM THIS MODULE         42130002
*     INPUTS FOR SHORT OBR ARE R0 AND R1 AT THIS POINT         @YM6451P 42135002
         SPACE 1                                               @YM2953P 42140002
WRTSTAT  ST    R14RETRN,SHORTRTN        SAVE SHORT RETURN ADDR @YM2953P 42150002
         LPR   R0PARM,R0PARM            SET RE SIZE POSITIVE   @YM2953P 42160002
         LR    R10SIZE,R0PARM           GET RECORD SIZE        @YM2951P 42180002
*     GET POINTER IN R11 IN CASE OF SHORT OBR                  @YM2953P 42187002
         SPACE 1                                               @YM2953P 42194002
         LR    R11RECAD,R1PARM          GET RECORD ADDR IN REG 11       42201002
         TM    TWO(R11RECAD),TIMEBIT    TEST FOR TIME MACRO     YM4105P 42208002
         BZ    NOTIME                   NO-BRANCH AROUND        YM4105P 42215002
         OI    ELEVEN(R11RECAD),FOX     YES-PUT X'0F' IN DATE   YM4105P 42222002
NOTIME   EQU   *                                                YM4105P 42229002
         EJECT                                                          42240002
*********************************************************************** 42300002
*     THIS CODE RESOLVES ADCONS IN GETMAIN AREA AND ISSUES ENQ        * 42360002
*********************************************************************** 42420002
         LA    R1PARM,ENQLSTDS          ADDR OF FIRST WORD      YM3795P 42480002
         MVC   ENQLSTDS(C28),NQCON      MOVE ENQ TO GETMAIN    @YM6451P 42540002
         LA    R8WORK,QNM               GET ADDR OF QNAME      @YM6451P 42600002
         ST    R8WORK,QPTR              POINTER IN LIST        @YM6451P 42660002
         LA    R8WORK,RNM               GET ADDR OF RNAME      @YM6451P 42720002
         ST    R8WORK,RPTR              POINTER TO LIST        @YM6451P 42780002
         SVC   ENQUEUE                       ISSUE ENQUEUE              42840002
         OI    INTSW,ENQIND             ENQUEUE INDICATED        YM5198 42870002
*                                                                       42900002
*     THIS CODE RESOLVES ABSOLUTE MEMORY ADDRESS REFERENCES             42960002
*     WHICH WILL NOT BE RESOLVED BY THE LOADER.                         43020002
*                                                                       43080002
         MVC   CCWAREA(CHANPGLN),HDRCCW MOVE CHANNEL PROGRAM            43140002
         LA    R8WORK,CCWAREA          FETCH ADR OF 1ST CCW IN CHAIN    43200002
         ST    R8WORK,CCW8             STORE ADR OF 1ST CCW IN CHAIN    43260002
         MVI   CCW8,TRANCHAN           SET COMMAND CODE IN CCW          43320002
         LA    R8WORK,SEEKADR2         RESOLVE SEEK ADDR                43380002
         ST    R8WORK,CCWAREA          STORE BACK FIRST CCW             43440002
         MVI   CCWAREA,SRCHID          SET COMMAND CODE IN CCW          43500002
         LA    R8WORK,HDRREC           RESOLVE HEADER RECD ADDR         43560002
         ST    R8WORK,CCW16            STORE HEADER RECD ADDR           43620002
         MVI   CCW16,READ              SET COMMAND CODE IN CCW          43680002
         EJECT                                                          43740002
*           PROGRAM  SETUP TO FETCH HEADER RECORD                       43800002
*                                                                       43860002
         L     R5WORK,CVTDCB           LOAD ADDR OF LOGREC DCB          43920002
         ST    R5WORK,TPRIOB+IOBDCBPT  STORE DCB ADDR IN IOB            43980002
         L     R5WORK,DCBDEBAD(R5WORK) LOAD ADDR OF LOGREC DEB          44040002
         MVC   SEEKADR(BBCCHH),DEBBCH(R5WORK) MOVE BBCCHH FROM DEB      44100002
         MVI   SEEKADR6,RECRDONE       SET SEARCH FIELD ID TO ONE       44160002
*                                       FOR REWRITE OF RECORD           44220002
         LA    R6WORK,TPRECB           LOAD ECB ADDR                    44280002
         ST    R6WORK,TPRIOB+IOBECBPT  STORE ECB ADDR IN IOB            44340002
         LA    R6WORK,CCWAREA          LOAD ADDR OF CCW'S               44400002
         ST    R6WORK,TPRIOB+IOBSTART  STORE ADDR OF CHANNEL PGM IN IOB 44460002
         MVI   TPRIOB,IOBFLAG1         SET FLAG1 FIELD IN IOB           44520002
         MVC   EXCPSEK1(BBCCHH),SEEKADR PLACE SEEK ADDR FOLLOWING IOB   44580002
         C     R10SIZE,OUTIND           Q/ IS IT OUTAGE REC    @YL02021 44600002
         BE    OUTROUT                  YES--BR                @YL02021 44620002
         BAL   R5WORK,ERR3B            GET HEADER RECORD                44640002
         CLI   SFTYBYTS,GOODHDR        COMPARE CHECK BYTE IN HDR TO     44700002
*                                       SEE IF THIS IS A VALID HDR REC  44760002
         BC    UNEQUAL,ERROR2          BRANCH IF NOT A GOOD HEADER REC  44820002
*                                                                       44880002
***      ROUTINE TO PICK UP BUFFER & SET UP RECORD       *****          44940002
*                                                                       45000002
         STH   R10SIZE,CCW54           STORE COUNT IN CCW               45060002
         STH   R10SIZE,CTFLDDL         SAVE RECORD SIZE                 45120002
         ST    R11RECAD,CCW48          RECORD ADDR TO CCW               45180002
         EJECT                                                          45360002
*                                                                       45420002
*                                                                       45480002
*****  ROUTINE TO DETERMINE IF ENOUGH BYTES REMAINING ON TRACK          45540002
*                                                                       45600002
         L     R5WORK,CVTDCB           LOAD ADDR OF LOGREC DCB          45660002
         L     R5WORK,DCBDEBAD(R5WORK) LOAD ADDR OF LOGREC DEB          45720002
         L     R6WORK,DEBUCBAD(R5WORK) LOAD ADDR OF LOGREC UCB FROM DEB 45780002
         SLR   R7WORK,R7WORK           CLEAR REGISTER                   45840002
         IC    R7WORK,UCBUNTYP(R6WORK) EXTRACT UNIT TYPE FROM UCB       45900002
         SLL   R7WORK,ONE              MULTI. UNIT TYPE BY 2 FOR INDEX  45960002
         LH    R5WORK,SUBCONST(R7WORK) LOAD SUB CONST FOR LOGREC DEVICE 46020002
         SR    R1LINK,R1LINK            CLEAR R1               @YM8213P 46080002
         ICM   R1LINK,THREE,CTFLDDL     GET SIZE OF RECORD     @YM8213P 46110002
         AR    R5WORK,R1LINK           ADD SIZE TO CONSTANT             46140002
         CLC   UPLIMIT(CCHH),LASTTR2    LAST TRACK?             YA04218 46141002
         BNE   CAPTRK                   BR IF NOT EQUAL         YA04218 46142002
         CLI   UCBUNTYP(R6WORK),UNEQUAL  2305-II                YA04218 46143002
         BC    UNEQUAL,CAPTRK           BR IF NO                YA04218 46144002
         AH    R5WORK,SUBCONST(R7WORK)  ADD SUBTR               YA04218 46145002
         LA    R5WORK,ONE(R5WORK)            CONST              YA04218 46146002
CAPTRK   EQU   *                                                YA04218 46147002
         CH    R5WORK,TRKCAP            LENGTH EXCEED CAPACITY?         46150002
         LA    R8WORK,LOGRECFL          SET UP CODE            @YM6451P 46160002
         BH    RTRN                     YES-RETURN             @YM7630P 46170002
         MVC   EXCPSEK7(ONE),LASTTR6    SET ID IN IOB SEEK FIELD        46200002
TPR50    LH    R6WORK,BYTSREM          NO OF BYTES REMAINING ON TRACK   46260002
         SLR   R6WORK,R5WORK           SUBTRACT BYTES NEEDED FOR THIS   46320002
*                                       RECORD FROM BYTES REMAINING     46380002
         BC    WILLFIT,TPR53           BR IF REC WILL FIT ON TRACK      46440002
*                                                                       46500002
*        CODE TO CHECK IF THERE IS ANOTHER TRACK AVAIL ON THIS CYLINDER 46560002
*                                                                       46620002
         LH    R6WORK,LASTTR4          LOAD LAST USED HEAD POSITION     46680002
         AL    R6WORK,CONST1           ADD ONE TO HEAD POSITION         46740002
         SLR   R7WORK,R7WORK           CLEAR REGISTER                   46800002
         IC    R7WORK,TRKSPER          INSERT FIRST BYT OF TRKS PER CYL 46860002
         SLL   R7WORK,EIGHT            SHIFT LEFT ONE BYTE              46920002
         IC    R7WORK,TRKSPER1         INSERT 2ND BYTE OF TRKS PER CYL  46980002
         CLR   R7WORK,R6WORK           COMP HD CT TO TRACKS PER CYL     47040002
         BL    TPR52                    BR IF END OF CYLINDER           47100002
*                                                                       47160002
*        CODE TO START WRITTING ON NEW TRACK                            47220002
*                                                                       47280002
TPR51    STH   R6WORK,LASTTR4          UPDATE HEAD CT IN HEADER REC     47340002
         MVI   EXCPSEK7,RECZERO        SET SEEK FIELD IN IOB TO ZERO    47400002
         MVI   LASTTR6,RECZERO         SET LAST REC ENTRY ID TO ZERO    47460002
         MVC   BYTSREM(TWO),TRKCAP      SET REMG BYTES ON TRK TO MAX    47520002
         B     TPR50                    REPEAT                          47580002
*                                                                       47640002
*        CODE TO START WRITTING ON A NEW CYLINDER                       47700002
*                                                                       47760002
TPR52    SLR   R6WORK,R6WORK           CLEAR REG.(NEW TRACK NUM.)       47820002
         LH    R7WORK,LASTTR2          LOAD LAST USED CYLINDER POSITION 47880002
         AL    R7WORK,CONST1           ADD ONE TO UPDATE CYL COUNT      47940002
         STH   R7WORK,LASTTR2          STORE UPDATED CYLINDER COUNT     48000002
         B     TPR51                    REPEAT                          48060002
         EJECT                                                          48120002
*                                                                       48180002
*        CODE TO CHECK AND UPDATE HEADER RECORD                         48240002
*                                                                       48300002
TPR53    STH   R6WORK,BYTSREM          UPDATE BYTES REMG COUNT IN HDR   48360002
         CLC   UPLIMIT(CCHH),LASTTR2   COMP CCHH WITH LST CCHH IN DS    48420002
         BC    EODS,ERROR1             CURRENT CCHH IS ABOVE EXTENT     48480002
         BC    EQUAL,HERE               BR-DONT SET HD SWITCH READ      48540002
         MVI   FLAGS,EOFFLG            SET FLAG FOR NOT LAST TRACK      48600002
HERE     SLR   R5WORK,R5WORK           CLEAR REGISTER                   48660002
         IC    R5WORK,LASTTR6          LOAD ID OF LAST ID WRITTEN       48720002
         AL    R5WORK,CONST1           ADD ONE TO ID                    48780002
         STC   R5WORK,LASTTR6          UPDATE LAST ID WRITTEN IN HDR    48840002
         MVC   CTFLDID(CCHHR),LASTTR2  SET UP COUNT FIELD ID FOR REC    48900002
*                                                                       48960002
***    THIS CODE RESOLVES ABSOLUTE MEMORY ADDRESS REFERENCES            49020002
*          WHICH WILL NOT BE RESOLVED BY THE LOADER                     49080002
*                                                                       49140002
         LA    R1LINK,CCW24            RESOLVE ADDR OF 1ST WRT CCW      49200002
         ST    R1LINK,CCW32            STORE ADDR                       49260002
         MVI   CCW32,TRANCHAN          RESTORE COMMAND CODE             49320002
         LA    R1LINK,EXCPSEK3         RESOLVE SEEK ADDR IN CCW         49380002
         ST    R1LINK,CCW24            STORE ADDR                       49440002
         MVI   CCW24,SRCHID            RESTORE COMMAND CODE             49500002
         LA    R1LINK,CTFIELD          RESOLVE ADDR OF CCHHR,KEY,AND    49560002
*                                       DATA LENGTH AREA                49620002
         ST    R1LINK,CCW40            STORE ADDR                       49680002
         MVI   CCW40,WRTCTKYD          RESTORE COMMAND CODE             49740002
*                                                                       49800002
****   ROUTINE TO SETUP AND WRITE THE COMPLETED RECORD ENTRY            49860002
*                                                                       49920002
         LA    R5WORK,CCW24            ADDR OF 1ST CCW IN WRITE CHAIN   49980002
         ST    R5WORK,TPRIOB+IOBSTART STORE CHAN PGM ADDR IN IOB        50040002
         MVC   EXCPSEK1(BBCCHH),LASTTTR PLACE SEEK ADDR FOLLOWING IOB   50100002
         BAL   R5WORK,ERR3B            BRANCH TO EXCP TO WRITE RECORD   50160002
         EJECT                                                          50220002
*                                                                     * 50280002
****   ROUTINE TO SETUP AND WRITE AN END OF FILE IF THIS IS THE    **** 50340002
****     FIRST RECORD WRITTEN OR THIS RECORD WAS WRITTEN ON THE    **** 50400002
****     LAST TRACK OF THE LOGREC DATA SET                         **** 50460002
*                                                                     * 50520002
         TM    FLAGS,EOFFLG            WAS RECORD WRITTEN ON LAST TRACK 50580002
         BC    NOTLST,SWITCH           BRANCH IF RECORD WAS NOT WRITTEN 50640002
*                                       ON THE LAST TRK(HEAD SWTNG REQ) 50700002
         MVC   EXCPSEK1(BBCCHHR),LASTTTR  MOVE SEEK ADDR TO IOB         50760002
         MVI   CTFLD4D,LSTREC          SET SEARCH ID TO END OF LAST TRK 50820002
         B     WRTEOF        ...   BR TO TERMINATION                    50880002
SWITCH   CLC   EXCPSEK1(BBCCHHR),RESTART  IS THIS THE FIRST RECORD      50940002
*                                          WRITTEN ON LOGREC            51000002
         BNE   EWMSG                    NO- EOF HAS BEEN WRITTEN        51060002
         XC    EXCPSEK3(CCHHR),EXCPSEK3  Y E S  CLEAR SEEK ADDR         51120002
         MVC   EXCPSEK3(CCHH),UPLIMIT  MOVE THE LAST CCHH OF THE LOGREC 51180002
*                                       DATA SET TO THE IOB SEEK FLD    51240002
         MVI   CTFLD4D,RECRDONE        SET ID TO BEGINNING OF TRACK     51300002
WRTEOF   MVC   CTFLDID(CCHH),EXCPSEK3  MOVE CCHH TO EOF RECORD          51360002
         XC    CTFLDKEY(KEYDTALN),CTFLDKEY  CLEAR RECORD COUNT FIELD    51420002
         MVI   CCW44,SUPINCLN          RESTORE 'SILI' BIT IN CCW        51480002
         BAL   R5WORK,ERR3B            BRANCH TO  EXCP TO WRITE EOF     51540002
         EJECT                                                          51600002
*****  ROUTINE TO WRITE HEADER RECORD BACK TO SYS RES                   51660002
*                                                                       51720002
EWMSG    CLI   ZERO(R11RECAD),HEX13     TEST FOR MCH RECORD    @YM2951P 51780002
         BNE   EWMSGA                   NO-BRANCH AROUND       @YM2951P 51800002
         TM    FIVE(R11RECAD),GOODHDR   TEST FOR CLOBBER BIT   @YM2951P 51820002
         LA    R15CODE,LOGRECFL         SET RETURN CODE          Y02021 51840002
         BNZ   RTRN                     YES-RETURN               Y02021 51900002
EWMSGA   TM    EWMSW,EWMSGISU           TEST FOR MSG           @YM2951P 51960002
         BO    BYEWM                    YES-BYPASS CK FOR EWM           52020002
         CLC   LASTTR2(CCHH),EWMTRK    CK IF 90% TRK HAS BEEN REACHED   52080002
         BL    BYEWM                    NO-BYPASS                       52140002
         BH    WMSG                    TRK EXCEEDED GO WRT MSG          52200002
         CLC   BYTSREM(TWO),EWMCNT      CK 90% BYTE COUNT REACHED       52260002
         BH    BYEWM                    NO-BYPASS                       52320002
WMSG     OI    EWMSW,EWMSGISU          SET EWM ISSUED SWITCH IN HDR     52380002
         OI    FLAGS,WRTEWMSG          SET EWM NEEDED SWITCH IN FLAGS   52440002
BYEWM    DS    0C                                                       52500002
         MVI   CCW16,WRTDATA           CMD CODE FOR REWRITE OF HDR      52560002
         LA    R5WORK,CCWAREA          RESOLVE CCW ADDR'S               52620002
         ST    R5WORK,TPRIOB+IOBSTART  STORE CCW ADDR IN IOB            52680002
         MVC   EXCPSEK1(BBCCHHR),SEEKADR  PLACE SEEK ADDR FOLLOWING IOB 52740002
         BAL   R5WORK,ERR3B            BRANCH TO EXCP TO REWRITE HDR    52800002
         SR    R15CODE,R15CODE         SET ZERO CONDITION CODE          52860002
RTRN     LA    R1PARM,ENQLSTDS          ADDR OF FIRST WORD     @YM2951P 52920002
         SVC   DEQUEUE                       ISSUE DEQUEUE              52980002
         NI    INTSW,OFFENQ             TURN OFF ENQ IND        YM6767P 53010002
*                                                                       53040002
****   THE FOLLOWING TESTS AND BRANCHES ARE FOR EXITS REQUIRING         53100002
****     A MESSAGE TO BE WRITTEN TO THE OPERATOR CONSOLE.               53160002
*                                                                       53220002
         TM    FLAGS,EOEXTFLG          TEST FOR END OF DATA SET ERROR   53280002
         BO    ERROR1A                 BR TO SET CODE FOR ERROR MSG     53340002
         TM    FLAGS,BADHDR            TEST FOR BAD HDR REC ERROR       53400002
         BO    ERROR2A                 BR TO SET CODE FOR ERROR MSG     53460002
         TM    FLAGS,IOERR             TEST FOR AN IO ERROR             53520002
         BO    ERROR4A                 BR TO SET CODE FOR ERROR MSG     53580002
         TM    FLAGS,WRTEWMSG          TEST FOR EWM SWITCH              53640002
         BO    MSGEW                   BR TO SET CODE FOR WARNING MSG   53700002
         TM    INTSW,SHTSW              TEST FOR SHORT RE      @YM2951P 53710002
         BZ    EXIT                     NO-BRANCH              @YM2951P 53720002
         NI    INTSW,SHTCLR             YES-CLE AR SWITCH      @YM2951P 53730002
         L     R14RETRN,SHORTRTN        GET SHORT RETURN ADDR  @YM2953P 53735002
         BR    R14RETRN                 GO CHECK FOR MORE      @YM2951P 53740002
EXIT     EQU   *                                                 Y02021 53760002
OUT      SR    R8WORK,R8WORK            CLEAR CODE REG           Y02021 53820002
RTRNM    ESTAE 0                                               @ZA06003 53880004
         LR    R1PARM,R9LOGBAS                                 @ZA06003 53910004
         L     R14RETRN,RETURNAD        GET RETURN POINTER       Y02021 53940002
         FREEMAIN  R,LV=GETLNGTH,SP=SUBPLNM,A=(1)              @YM2953P 54000002
         LR    R15CODE,R8WORK           GET RETURN CODE          Y02021 54060002
         BR    R14RETRN                RETURN TO CALLER                 54120002
         EJECT                                                          54180002
*                                                                       54240002
****       EXCP AND CHECK COMPLETION  CODE IN ECB        ****           54300002
*                                                                       54360002
ERR3B    XC    TPRECB(ECBLEN),TPRECB   CLEAR ECB                        54420002
         LA    R1LINK,TPRIOB           LOAD ADDR OF IOB                 54480002
         SVC   EXCP                     SUPERVISOR CALL TO EXCP         54540002
         WAIT  ONE,ECB=TPRECB                                           54600002
         CLI   TPRECB,INTCEPT           COMP COMPLETION CODE IN ECB     54660002
         BC    EQUAL,ERR3B             BR TO TRY EXCP AGAIN             54720002
         CLI   TPRECB,NORMAL            COMPARE COMPLETION CODE IN ECB  54780002
         BCR   EQUAL,R5WORK            RETURN  IF COMPLETED OK          54840002
         CLI   TPRECB,EXTENTNG          COMP COMPLETION CODE IN ECB     54900002
         BC    EQUAL,ERROR1            BR IF NOT WITHIN EXTENT          54960002
         B     ERROR4                   BRANCH I/O FAILURE              55020002
*                                                                       55080002
***    THE FOLLOWING CODE SETS CONDITION CODES FOR THE MESSAGE MODULE   55140002
*                                                                       55200002
ERROR1A  LA    R12MSGCD,LOGFULL        SET REG 12 TO MSG CODE           55260002
         B     EXITMSG                  EXIT TO MESSAGE MODULE          55320002
ERROR2A  LA    R12MSGCD,LOGFORER       SET REG 12 TO MSG CODE           55380002
         B     EXITMSG                  EXIT TO MESSAGE MODULE          55440002
ERROR4A  LA    R12MSGCD,LOGIOERR       SET REG 12 TO MSG CODE           55500002
         B     EXITMSG                  EXIT TO MESSAGE MODULE          55560002
MSGEW    LA    R12MSGCD,LOGNRFUL       SET REG 12 TO MSG CODE           55620002
EXITMSG  L     R13RETAD,RETURNAD        GET RETURN ADDR IN 13  @YM2951P 55680002
         B     MESS                     BRANCH TO MSG FUNCTION   Y02021 55740002
*    SET UP FOR MESSAGE                                        @YM6451P 55800002
ERROR1   OI    FLAGS,EOEXTFLG          SET FLAG FOR END OF EXTENT ERROR 55860002
         B     RTRN                    BR TO DEQ                        55920002
ERROR2   OI    FLAGS,BADHDR            SET FLAG FOR INCORRECT HDR REC   55980002
         B     RTRN                    BR TO DEQ                        56040002
ERROR4   OI    FLAGS,IOERR             SET FLAG FOR AN IO ERROR         56100002
         B     RTRN                    BR TO DEQ                        56160002
*                                                                       56220002
OUTROUT  MVI   SEEKADR6,TWO             SET TO WRITE 2ND REC   @YL02021 56230002
         MVC   HDRREC(L40),ZERO(R11RECAD) SET TO WRITE OUTAGE  @YL02021 56240002
         B     BYEWM                    BR TO WRITE RECORD     @YL02021 56250002
         EJECT                                                          56280002
*********************************************************************** 56340002
*                                                                     * 56400002
****           STATISTICS UPDATE SECTION                        YM2952P 56460002
*                                                                     * 56520002
*********************************************************************** 56580002
         SPACE 2                                                        56640002
STATUP   LR    R7WORK,R0PARM            INPUT PARM TO REG 7      Y02021 56700002
         SPACE 1                                                        56820002
*****    SAVE  INPUT  PARAMETER  AND  TEST  SAME                        56880002
*                                      NOTE: REGISTER 7 HAS THE INPUT   56940002
*                                            PARAMETER PASSED FROM      57000002
*                                            IFBSTAT UPON ENTRY.        57060002
         STH   R7WORK,INPUPARM         SAVE INPUT PARAMETER             57120002
         LTR   R7WORK,R7WORK           TEST SIGN OF INPUT PARM          57180002
         BZ    SVC76                    ENTRY WAS FOR EOD SERVICE       57240002
         CLI   INPUPARM+ONE,SDRREC     TEST IF INPUT PARM IS 4          57300002
         BE    SVC76                    ENTRY WAS FOR SDR SERVICE       57360002
         CLI   INPUPARM+ONE,IPLREC     TEST IF INPUT PARM IS 8          57420002
         BE    WTIPLEOD                 ENTRY FOR  RDE SERVICE          57480002
         CLI   INPUPARM+ONE,C12         Q/IS REQUEST FOR OUTAGE         57500002
         BE    OUTFLG                   BR TO TURN ON FLAG     @YL02021 57520002
         B     EXIT                     EXIT INPUT PARM IS WRONG        57540002
         SPACE 1                                                        57600002
         SPACE 1                                                        57660002
*      LOAD FIRST UCB ADDRESS FROM THE UCB ADDRESS LIST PORTION         57720002
*        OF THE UCB LOOKUP TABLE                                        57780002
         SPACE                                                          57840002
SVC76    L     R4WORK,CVTILK2          LOAD ADDR OF TWO BYTE UCB PTRS   57900002
         EJECT                                                          57960002
*****    TEST  ALL  MAIN  STORAGE  STAT  TABLES  FOR  ZERO              58020002
         SR    R5WORK,R5WORK        CLEAR REGISTER                      58050003
         SPACE 1                                                        58080002
STATLKUP ICM   R5WORK,X'3',ZERO(R4WORK) LOAD ADDR OF UCB       @ZM0949I 58180003
         LA    R4WORK,NXTUCBAD(R4WORK) UPDATE UCB ADDRESS POINTER       58200002
         BZ    STATLKUP                 BRANCH-UCB ADDR IS ZERO         58380002
         CLM   R5WORK,X'3',FOXES   TEST FOR END OF UCB ADDR LIST        58400003
         BE    WTIPLEOD             YES,BRANCH                          58420003
         XR    R6WORK,R6WORK           CLEAR REGISTER                   58440002
         L     R8WORK,HEX14(R5WORK)     GET UCB EXTENSION PTR  @YM5028P 58500002
         IC    R6WORK,ONE(R8WORK)       GET STATAB INDEX       @YM5028P 58530002
         SPACE                                                          58560002
         CLC   TYASPN(DEVTPE),UCBDEVCL(R5WORK) TEST FOR ASPEN    YM3420 58620002
         BNE   TESTOAK             NO, CHK. MSS                @ZA04252 59040003
         LA    R1PARM,ASPNPARM         SET PARM FOR SVC91        PT0878 59100002
         B     ISNEWDEV                BRANCH TO READ BUF LOG    PT0878 59160002
TESTOAK  CLC   SS1(DEVTPE),UCBDEVCL(R5WORK) TEST FOR OAK       @ZA04252 59170003
         BNE   MERLZ               NO, CHK. MERLIN-ZEUS        @ZA04252 59180003
         SR    R1PARM,R1PARM       CLEAR REG 1                 @ZA04252 59190003
         ICM   R1PARM,X'3',FOXES   LOAD CODE FOR SS1           @ZA04252 59200003
         B     ISNEWDEV            GO FOR BUFFERED LOG         @ZA04252 59210003
MERLZ    LA    R10WORK,DEVNUM           NUM OF BUF LOG DEVICES   Y02021 59220002
         LA    R8WORK,NEWDEVTB         LOAD ADDR OF DEVICE TABLE        59280002
CHECKNEW CLC   ZERO(DEVTPE,R8WORK),UCBDEVCL(R5WORK)   IS THIS A BUFFERD 59340002
*                                                      LOG DEVICE       59400002
         BE    ISNEWDEV                YES BRANCH TO READ BUF LOG       59460002
         LA    R8WORK,DEVTPE(R8WORK)   LOAD ADDR OF NXT DEV TYPE CODE   59520002
         BCT   R10WORK,CHECKNEW         BRANCH IF MORE           Y02021 59580002
ALSOSDR  EQU   *                                               @SKINNER 59610004
         SPACE                                                          59640002
         LTR   R6WORK,R6WORK            TEST FOR ZERO STATAB     YM3420 59700002
         BZ    STATLKUP                 YES-GET NEXT             YM3420 59730002
         L     R7WORK,CVTSTB           LOAD ADDR OF STAT TABS           59760002
LOOP1    CLM   R5WORK,X'3',ZERO(R7WORK)   IS DEVICE IN THIS SEC OF      59820003
*                                       STAT TAB'S                      59880002
         BL    LOOP3                    OK-BRANCH                YM3420 59940002
         LA    R7WORK,NXTSTATA(R7WORK) LOAD ADDR OF THE FIRST UCB IN    60000002
*                                       THE NEXT STAT TAB SECTION       60060002
         LA    R6WORK,NXTSDRST(R6WORK) BUMP STAT TAB OFFSET PAST THIS   60120002
*                                       SECTION                         60180002
         B     LOOP1                    LOOP TO CHECK THIS SECT.        60240002
         EJECT                                                          60300002
ISNEWDEV TM    SRTESTAT(R5WORK),ONLINE IS THIS DEVICE ONLINE            60360002
         BZ    STATLKUP                NO, GO LOOK AT NEXT UCB          60420002
         LNR   R0PARM,R5WORK           PREPARE TO PASS ADDRESS OF       60480002
*                                       UCB TO SVC91                    60540002
         SVC   VOLSTAT                 ISSUE VOLUME STATUS SVC          60600002
         SR    R1PARM,R1PARM           CLEAR SVC91 PARM                 60660002
         CLC   UCBDEVCL(TWO,R5WORK),UR3800                     @SKINNER 60680004
         BE    ALSOSDR                                         @SKINNER 60700004
         B     STATLKUP                BRANCH TO CONTINUE STAT LOOKUP   60720002
         SPACE                                                          60780002
LOOP3    MH    R6WORK,MULTICON          MULTIPLY BY TEN        @YM6451P 60840002
         AL    R6WORK,CVTSTB           ADD ADDR OF STAT TABS TO OFFSET  61020002
         TM    UCBFL5(R5WORK),UCBNEWST TEST FOR NEW TYPE STAT           61080002
         BO    NEWSTAT                  BR-NEWSTAT                      61140002
         NC    ZERO(SDRDATA,R6WORK),ZERO(R6WORK) CHK FOR ZERO STAT FLD  61200002
         BNZ   STATMOVE                 BR-STAT FIELD NOT ZERO          61260002
*                                                                       61320002
         B     STATLKUP                 GO CHECK FOR MORE      @YM2953P 61720002
         SPACE                                                          62220002
NEWSTAT  IC    R8WORK,ZERO(R6WORK)      GET FLAGS BYTE           X03127 62280002
         N     R8WORK,MASK              SAVE LOW ORDER COUNT     X03127 62340002
         MH    R8WORK,MULTICON          MULTIPLY BY 10           X03127 62400002
         AH    R8WORK,MULTICON          ADD 10                   X03127 62460002
         LR    R12WORK,R8WORK           SAVE COUNT               X03127 62520002
         BCTR  R8WORK,ZERO              REDUCE COUNT BY 1        X03127 62580002
         TM    ZERO(R6WORK),NOCLR       TEST CLEAR OPTION BYTE   X03127 62640002
         BO    NEWSTAT1                 ONE-DO NOT TEST BYTE 1   X03127 62700002
         NC    ONE(ONE,R6WORK),ONE(R6WORK)   CHECK FOR STAT CNT  X03127 62760002
         BNZ   NEWSTAT2                 YES-GO COMPLETE RE       X03127 62820002
NEWSTAT1 BCTR  R8WORK,ZERO              DECREMENT COUNT          X03127 62880002
         BCTR  R8WORK,ZERO              DECREMENT COUNT          X03127 62940002
         EX    R8WORK,TSTSTAT           TEST FOR ANY COUNT       X03127 63000002
         BZ    STATLKUP                 ZERO-CHECK NEXT STAT     Y02021 63060002
         LA    R8WORK,TWO(R8WORK)       BUMP COUNT TWO           X03127 63120002
NEWSTAT2 EX    R8WORK,MOVESTAT          MOVE STATS TO RE         X03127 63180002
         BCTR  R8WORK,ZERO              DECREMENT COUNT          X03127 63240002
         BCTR  R8WORK,ZERO              DECREMENT COUNT          X03127 63300002
         EX    R8WORK,CLRSTAT           CLEAR STAT ENTRY         X03127 63360002
         STC   R12WORK,SDRCNT           STORE CNT IN RECORD      X03127 63420002
         B     EODOBR                   GO COMPLETE              X03127 63480002
         SPACE                                                          63540002
CLRSTAT  XC    TWO(ZERO,R6WORK),TWO(R6WORK)  CLEAR STATS         X03127 63600002
         SPACE                                                          63660002
MOVESTAT MVC   SDR(ZERO),ZERO(R6WORK)   MOVE STATS TO RECORD     X03127 63720002
         SPACE                                                          63780002
TSTSTAT  NC    TWO(ZERO,R6WORK),TWO(R6WORK)  TEST STATS          X03127 63840002
         SPACE                                                          63900002
         EJECT                                                          63960002
STATMOVE MVC   SDR(SDRLEN),ZERO(R6WORK) MOVE STAT COUNTERS TO RECORD    64020002
         XC    ZERO(SDRDATA,R6WORK),ZERO(R6WORK) CLR STAT COUNTERS      64080002
CNTSDR   MVI   SDRCNT,SDRLEN           SET SDR COUNT IN RECORD TO 10    64140002
EODOBR   TM    ZERO(R6WORK),NOCLR      TEST CLEAR OPTION BIT            64200002
         BO    NCLROPT                  NO-BYPASS CLR OPT BYTE          64260002
         MVI   ONE(R6WORK),OFF         CLEAR OPTION BYTE                64320002
NCLROPT  DS    0C                                                       64380002
*****    CONSTRUCT OBR/EOD RECORD                                       64440002
         MVI   CLASRC,OBRREC           SET RECORD TYPE - CLASS & SOURCE 64500002
         OI    SW2,EODSHORT            SET SWITCH FIELD IN RECORD       64560002
         L     R12WORK,CVTPTR          LOAD CVT POINTER                 64620002
         SH    R12WORK,CONST4          SUBTRACT TO POINT TO REL NUM     64680002
         PACK  WORKIOB(WORKLEN),ZERO(RELLN,R12WORK)  PACK RELEASE NUM   64740002
         CVB   R12WORK,WORKIOB         CONVERT REL # TO BINARY          64800002
         STC   R12WORK,OPSYS           STORE SYS REL NUM IN RECORD      64860002
         OI    OPSYS,VS2IND             INDICATE VS2           @YM6451P 64920002
         TIME  DEC                     GET TIME                         64980002
         ST    R0PARM,TIME             STORE CURRENT TIME IN RECORD     65040002
         ST    R1PARM,DATE              GET DATE IN RECORD     @YM6451P 65100002
         OI    SW1,TIMEBIT              SET TIME MACRO USED    @YM6451P 65130002
         STIDP CPUSER                  STORE CPU ID IN RECORD           65160002
         MVC   DEVTYP(WORD),UCBTYP(R5WORK)  MOVE DEV TYP FLD TO RECORD  65220002
*                                                                       65280002
*      THE FOLLOWING ROUTINE EXTRACTS THE EBCDIC CUA FROM THE           65340002
*        UCB,CONVERTS IT TO BINARY, AND STORES IT IN THE RECORD         65400002
*                                                                       65460002
         LA    R11CNTRL,CUANUM         LOAD NUM OF DIGITS IN A CUA      65520002
         L     R6WORK,UCBNAME(R5WORK)   LOAD PRI CUA             Y02021 65580002
LABL1    STC   R6WORK,WORKIOB           STORE LOW ORDER BYTE     Y02021 65640002
         TM    WORKIOB,NUMARC          IS DIGIT NUMERIC                 65700002
         BO    LABL2                   YES- USE LOW 4 BITS              65760002
         LA    R6WORK,MAKBIN(R6WORK)    NO-ADD 9 TO LOW ORDER   YM2952P 65820002
LABL2    SRDL  R6WORK,FOUR              SHIFT BIN DIG TO REG 7   Y02021 65880002
         SRL   R6WORK,FOUR              SHIFT OUT SIGN           Y02021 65940002
         BCT   R11CNTRL,LABL1          BRANCH IF THERE ARE MORE DIGITS  66000002
         SRL   R7WORK,TOEND             SHIFT CUA TO LOW ORDER   Y02021 66060002
         STH   R7WORK,CUA               STORE CUA IN RECORD      Y02021 66120002
         OI    INTSW,SHTSW              SET SHORT SWITCH       @YM2951P 66870002
         SPACE 1                                                        66900002
         SR    R1PARM,R1PARM            CLEAR PARM REG           X03127 66960002
         IC    R1PARM,SDRCNT            GET STAT LENGTH          X03127 67020002
         LA    R0PARM,HDR(R1PARM)       GET RECORD COUNT         X03127 67080002
RECSET   LA    R1PARM,RECORD           LOAD ADDRESS OF RECORD           67140002
         LNR   R0PARM,R0PARM           LOAD NEG LENGTH OF RECORD        67200002
         STM   R4WORK,R15CODE,SAVEREGS  SAVE REGISTERS         @YM2951P 67260002
         BAL   R14RETRN,WRTSTAT         GO WRITE RECORD          Y02021 67320002
         LM    R4WORK,R15CODE,SAVEREGS  RESTORE REGISTERS      @YM2951P 67380002
         B     STATLKUP                 CHECK NEXT STAT          Y02021 67440002
         SPACE 2                                                        67500002
WTIPLEOD CLI   INPUPARM+ONE,SDRREC      TEST IF INPUT PARM IS 4         67560002
         BE    EXIT                     EXIT INPUT WAS FROM EREP        67620002
         BH    FIFTY                    BR INPUT PARM IS 8 (IPL)        67680002
         MVI   INPUPARM+ONE,EODPARM    SET PARM FOR EOD SERVICE         67740002
         B     MAKEREC                  GO RECORD RECORD         Y02021 67800002
OUTFLG   OI    INPUPARM,OUTFLAG         TURN ON OUTAGE FLAG    @YL02021 67810002
         MVI   INPUPARM+ONE,EODPARM     SET PARM FOR EOD SERVICE        67820002
         XC    RECORD(C40),RECORD       CLEAR REC AREA FOR OUTAGE       67830002
         B     MAKEREC                  GO RECORD              @YL02021 67840002
FIFTY    MVI   INPUPARM+ONE,IPLPARM    SET PARM FOR IPL SERVICE         67860002
*                                                              @YM6451P 67920002
*****    TEST FOR IPL OR EOD                                   @YM6451P 68420002
*                                                              @YM6451P 68920002
IPLEOD   CLI   INPUPARM+ONE,EODPARM     IS ENTRY FOR EOD         Y02021 69540002
         BE    MAKEREC                 YES - BRANCH                     69600002
         BAL   R6WORK,RDOUTREC          READ OUTAGE REC & SAVE TIME     69630002
         MVC   WRTCCW(BLDLST),RDELST    MOVE BLDL LIST           Y02021 69660002
         LA    R0PARM,WRTCCW           LOAD ADDR OF BLDL LIST           69720002
         L     R1PARM,CVTLINK          LOAD ADDR OF LINKLIB DCB         69780002
         SVC   BLDL                    ISSUE BLDL TO SEE IF 'RDE'       69840002
*                                       IS IN THE SYSTEM                69900002
         LTR   R15CODE,R15CODE         IS MODULE PRESENT                69960002
         BZ    REISSUE                  YES-GO PUT OUT MESSAGE   Y02021 70020002
         SR    R5WORK,R5WORK            CLEAR REG 5            @YM6451P 70050002
         B     REPLYOK                  GO CONSTRUCT IPL RECORD         70080002
*****    PERFORM  INFORMATION  GATHERING  ROUTINE  FOR  RECORD          70140002
         SPACE                                                          70200002
REISSUE  MVC   WTORMESS(IMSGSIZE),INFOMSG        MOVE MESSAGE           70260002
         LA    R4WORK,WTOREPLY         LOAD ADDR OF REPLY AREA          70320002
         ST    R4WORK,WTORADDR         STORE ADDR IN WTOR STRUCTURE     70380002
         MVI   WTORLGTH,REPLYLEN       STORE LENGTH OF REPLY            70440002
         LA    R4WORK,WORKECB          LOAD ADDR OF ECB                 70500002
         ST    R4WORK,WTORECB          STORE ADDR IN WTOR STRUCTURE     70560002
         XC    WORKECB,WORKECB         CLEAR ECB                        70620002
         LA    R1PARM,WTORAREA         LOAD ADDR OF WTOR STRUCTURE      70680002
         SVC   WTOR                     WRITE OPERATOR WITH REPLY       70740002
         WAIT  ONE,ECB=WORKECB         WAIT FOR WTOR COMPLETION         70800002
         SPACE                                                          70860002
         LA    R11CNTRL,REASONUM       SET UP FOR LOOP CONTROL          70920002
         LA    R5WORK,REPLYNM          LOAD ADDR OF REASON CODE TABLE   70980002
RECHECK1 CLC   WTOREPLY(REASONLN),ZERO(R5WORK)   IS THIS A VALID REPLY  71040002
         BE    SECONDHF                YES - CHECK 2ND HALF OF REPLY    71100002
         LA    R5WORK,REASONLN(R5WORK) BUMP POINTER TO NEXT VALID REPLY 71160002
         BCT   R11CNTRL,RECHECK1       BRANCH IF THERE ARE MORE         71220002
         CLI   WTOREPLY,U               DID OPERATOR REPLY 'U'          71280002
         BNE   INFORM                        NO--INFORM OPERATOR        71340002
         XC    RECORD(IPLSIZE),RECORD  YES - CLEAR RECORD AREA          71400002
         MVC   REASON(REASONLN),DEFAULT MOVE DEFAULT CODE TO RECORD     71460002
         B     CONSTHDR                      BR TO CONSTRUCT HEADER     71520002
         SPACE                                                          71580002
*****    INFORM  OPERATOR  AND  REISSUE  WTOR  ROUTINE                  71640002
INFORM   MVC   WTOAREA(ERRMSGLN),ERRMSG3         MOVE IN ERROR MESSAGE  71700002
         LA    R1PARM,WTOAREA          LOAD ADDR OF MESSAGE             71760002
         SVC   WTO                      WRITE TO OPERATOR               71820002
         B     REISSUE                  BR-TO REISSUE WTOR              71880002
         EJECT                                                          71940002
SECONDHF LA    R11CNTRL,IDNUM          SET UP FOR LOOP CONTROL          72000002
         LA    R5WORK,REPLY00          LOAD ADDR OF VALID SUB ID TABLE  72060002
RECHECK2 CLC   SUBIDRPL(IDLEN),ZERO(R5WORK)      IS THIS A VALID REPLY  72120002
         BE    REPLYOK                  BR-TWO VALID REPLIES            72180002
         LA    R5WORK,TABENTRY(R5WORK) BUMP POINTER TO NEXT VALID SUBID 72240002
         BCT   R11CNTRL,RECHECK2       BRANCH IF THERE ARE MORE         72300002
         B     INFORM                   BR-NO MATCH ON 2ND HALF         72360002
         SPACE                                                          72420002
*****    CONSTRUCT IPL OR EOD RECORD FOR SYS1.LOGREC                    72480002
REPLYOK  XC    RECORD(IPLSIZE),RECORD  CLEAR RECORD AREA                72540002
         MVC   REASON(REASONLN),WTOREPLY MOVE IPL REASON TO RECORD      72600002
         MVC   SUBSYSID(ONE),IDLEN(R5WORK)       MOVE SUB ID TO RECORD  72660002
         B     CONSTHDR                 BR.TO CONSTRUCT HEADER          72720002
RDOUTREC MVC   CCWAREA(CHANPGLN),HDRCCW      MOVE CHAN PROGRAM @YL02021 72721002
         LA    R8WORK,CCWAREA                ADDR OF 1ST       @YL02021 72722002
         ST    R8WORK,CCW8                     CCW IN CHAIN    @YL02021 72723002
         MVI   CCW8,TRANCHAN                 SET COMMAND CODE IN CCW    72724002
         LA    R8WORK,SEEKADR2               RESOLVE SEEK ADDR @YL02021 72725002
         ST    R8WORK,CCWAREA                STORE IN 1ST CCW  @YL02021 72726002
         MVI   CCWAREA,SRCHID                SET COMMAND CODE  @YL02021 72727002
         LA    R8WORK,HDRREC                 HDR REC ADDR      @YL02021 72728002
         ST    R8WORK,CCW16                   TO CCW           @YL02021 72729002
         MVI   CCW16,READ                    SET READ OP       @YL02021 72730002
         L     R8WORK,CVTDCB                 ADDR OF SER DCB   @YL02021 72731002
         ST    R8WORK,TPRIOB+IOBDCBPT         TO IOB           @YL02021 72732002
         L     R8WORK,DCBDEBAD(R8WORK)       ADDR OF DEB       @YL02021 72733002
         MVC   SEEKADR(BBCCHH),DEBBCH(R8WORK) MOVE BBCCHH FROM DEB      72734002
         MVI   SEEKADR6,REC2                 SET SRCH ID TO 2  @YL02021 72735002
         LA    R8WORK,TPRECB                 ECB ADDR          @YL02021 72736002
         ST    R8WORK,TPRIOB+IOBECBPT         TO IOB           @YL02021 72737002
         LA    R8WORK,CCWAREA           ADDR OF CCW'S          @YL02021 72738002
         ST    R8WORK,TPRIOB+IOBSTART    TO IOB                @YL02021 72739002
         MVI   TPRIOB,IOBFLAG1          SET FLAG1 FIELD IN IOB @YL02021 72740002
         MVC   EXCPSEK1(BBCCHH),SEEKADR  SET SEEK ADDR         @YL02021 72741002
READREC  XC    TPRECB(ECBLEN),TPRECB    CLEAR ECB              @YL02021 72742002
         LA    R1LINK,TPRIOB            ADDR OF IOB            @YL02021 72743002
         SVC   EXCP                     EXCP                   @YL02021 72744002
         WAIT  ONE,ECB=TPRECB           WAIT                   @YL02021 72745002
         CLI   TPRECB,INTCEPT           Q/ INTERCEPT           @YL02021 72746002
         BE    READREC                  YES -READ AGAIN        @YL02021 72747002
         CLI    TPRECB,NORMAL           Q/ READ OK             @YL02021 72748002
         BE    MOVETIME                 YES                    @YL02021 72749002
         BR    R6WORK                   RETURN                 @YL02021 72750002
MOVETIME MVC   OUTSAVE(C8),TMESTMP      SAVE OUTAGE INFO       @YM6451P 72751002
         BR    R6WORK                   RETURN                 @YL02021 72752002
         EJECT                                                          72780002
MAKEREC  XC    RECORD(EODSIZE),RECORD  CLEAR RECORD AREA                72840002
         SPACE                                                          72900002
CONSTHDR STIDP CPUSER                  STORE CPU ID & MODEL IN RECORD   72960002
         SPACE                                                          73020002
         LR    R4WORK,R2CVTBAS         LOAD ADDR OF CVT                 73080002
         SH    R4WORK,CONST4           SUBTRACT TO FIND REL # ADDR      73140002
         MVC   INCREL(ONE),INCRDIS(R4WORK)       MOVE INCREMENTAL REL   73200002
*                                                 NUMBER TO RECORD      73260002
         PACK  CONVERT,ZERO(RELLN,R4WORK)        PACK REL NUM           73320002
         CVB   R4WORK,CONVERT          CONVERT REL NUM TO BINARY        73380002
         XC    CONVERT(EIGHT),CONVERT   CLEAR WORK AREA         YM2955P 73410002
         STC   R4WORK,OPSYS            STORE REL NUM IN RECORD          73440002
         OI    OPSYS,VS2IND             INDICATE VS2           @YM6451P 73470002
         SPACE                                                          73500002
         TIME  DEC                     ISSUE TIME MACRO                 73560002
         ST    R0PARM,TIME             STORE TIME OF DAY IN RECORD      73620002
         ST    R1PARM,DATE             STORE DATE IN RECORD             73680002
         OI    SW1,TIMEBIT             SET TIME MACRO USED SWITCH       73740002
         SPACE                                                          73800002
         CLI   INPUPARM+ONE,EODPARM    IS THIS AN EOD RECORD            73860002
         BE    PREPARE                  BR-EOD IS HEADER ONLY REC       73920002
         MVC   HIGHADDR(WORD),CVTMZ00            MOVE HIGHEST STOR ADD  73980002
         SPACE                                                          74040002
         L     R4WORK,CVTDCB            GET ADDR OF LOGREC DCB   Y02021 74100002
         SH    R4WORK,CONST8           SUB TO PTR TO CHAN ASSN TAB ADDR 74160002
         L     R4WORK,ZERO(R4WORK)     LOAD ADDR OF CHAN ASSIGNMENT TAB 74220002
         MVC   CHANASSN(CHASTBLN),ZERO(R4WORK)   MOVE CHANNEL ASSIGNMNT 74280002
*                                                 TABLE TO RECORD       74340002
         MVC   OUTAGE(C8),OUTSAVE       FETCH OUTAGE           @YM6451P 74370002
OUTON    OI    SW2,OUTFLAG              TURN ON OUTAGE IND     @YM6452P 74380002
         SPACE                                                          74400002
         OI    CLASRC,IPLTYPE          SET RECORD TYPE - CLASS & SOUR   74460002
         LA    R0PARM,IPLSIZE          LOAD RECORD LENGTH               74520002
         B     IPL                     BRANCH TO ISSUE SVC76            74580002
         SPACE                                                          74640002
PREPARE  OI    CLASRC,EODREC           SET RECORD TYPE - CLASS & SOURCE 74700002
         LA    R0PARM,EODSIZE          LOAD RECORD LENGTH               74760002
         SPACE                                                          74820002
IPL      LA    R1PARM,RECORD           LOAD ADDR OF RECORD              74880002
         TM    INPUPARM,X80                  Q/ REQ TO WRITE OUTAGE     74900002
         BO    OUTAGEWT                      YES- BR           @YL02021 74920002
LOADNEG  LNR   R0PARM,R0PARM                 LOAD NEG(-) LENGTH         74940002
         B     WRTSTAT                  GO WRITE RECORD          Y02021 75000002
OUTAGEWT L     R0PARM,OUTIND            INDICATE OUTAGE        @YM6451P 75010002
         MVI   CLASRC,OUTTYPE                INDICATE OUTAGE REQUEST    75030002
         B     LOADNEG                       BR TO WRITE       @YL02021 75040002
OUTIND   DC    F'1'                                            @YL02021 75050002
         EJECT                                                          75060002
*********************************************************************** 75120002
*                                                                     * 75180002
****           MESSAGE SECTION                                  YM2952P 75240002
*                                                                     * 75300002
*********************************************************************** 75360002
MESS     LR    R14RETRN,R13RETAD       LOAD RETURN ADDRESS              75420002
         TM    CVTOPTA,CVTNIP          IS NIP IN PROCESS                75480002
         BO    OUT                     YES - NO WTO'S - RETURN          75540002
         LA    R5WORK,INDEX(R12MSGCD)  SET UP REG FOR BRACH TABLE ENTRY 75600002
         BR    R5WORK                  BRANCH INTO BRANCH TABLE         75660002
         SPACE                                                          75720002
INDEX    B     ERROR1M                  ERROR                           75780002
         B     ERROR2M                   MSG                            75840002
         B     ERROR4M                    BRANCH                        75900002
         B     MSGEWM                      TABLE                        75960002
*                                                                       76020002
*                                                                       76080002
GETIME   TIME DEC                            GET TIME                   76140002
         SPACE                                                          76200002
         ST    R0PARM,SAVETIME         SAVE TIME                        76260002
         UNPK  UNPKHH(UNPKTIME),SAVETIME(PACKTIME)    UNPACK THE TIME   76320002
         SPACE                                                          76380002
         MVC   FORHH(HH),UNPKHH        MOVE HOURS - HH                  76440002
         MVI   FRSTDOT,DOT             INSERT DELIMETER AFTER HH        76500002
         SPACE                                                          76560002
         MVC   FORMM(MM),UNPKMM        MOVE MINUTES - MM                76620002
         MVI   SECDOT,DOT              INSERT DELIMETER AFTER MM        76680002
*                                      SECONDS ARE ALREADY IN POSITION  76740002
         MVI   UNPKTEN,BLANK           BLANK OUT TENTHS OF A SECOND     76800002
         BR    R6LINK                  RETURN TO CALLING ROUTINE        76860002
*                                                                       76920002
*                                                                       76980002
ERROR1M  MVC   MSGAREA(MSG2LEN),ERRMSG2 MOVE LOG FULL MSG               77040002
         BAL   R6LINK,GETIME           BRANCH TO GET TIME               77100002
         MVC   FULLTIME(HHMMSS),FORHH  MOVE TIME TO MSG                 77160002
         LA    R1PARM,MSGAREA          LOAD ADDR OF MSG                 77220002
         SVC   WTO                     ISSUE WRITE TO OPERATOR          77280002
         LA    R8WORK,LOGRECFL         SAVE LOG FULL COND CODE          77340002
         B     RTRNM                   BRANCH TO FREEMAIN AND RETURN    77400002
         SPACE 2                                                        77460002
ERROR2M  MVC   MSGAREA(MSG5LEN),ERRMSG5          MOVE FORMAT ERR MSG    77520002
         BAL   R6LINK,GETIME           BRANCH TO GET TIME               77580002
         MVC   FORMTIME(HHMMSS),FORHH  MOVE TIME TO MSG                 77640002
         B     ERREXIT1                BRANCH TO WTO                    77700002
         SPACE 2                                                        77760002
ERROR4M  MVC   MSGAREA(MSG1LEN),ERRMSG1          MOVE I/O ERR MSG       77820002
         SR    R5WORK,R5WORK            CLEAR R5               @YM6452P 77822002
         LH    R5WORK,TPRIOB+IOBSENS1   LOAD SENSE BYTES       @YM6452P 77824002
         SLL   R5WORK,FOUR              SHIFT LEFT 4 BITS      @YM6452P 77826002
         STC   R5WORK,SENSBYT3          STORE CHAR             @YM6452P 77828002
         SRL   R5WORK,EIGHT             SHIFT OUT END CHAR     @YM6452P 77830002
         STC   R5WORK,SENSBYT2          STORE CHAR             @YM6452P 77832002
         SRL   R5WORK,EIGHT             SHIFT OUT END CHAR     @YM6452P 77834002
         STC   R5WORK,SENSBYT1          STORE CHAR             @YM6452P 77836002
         OI    SENSBYT3,FOX             PUT IN 'F'             @YM6452P 77838002
         UNPK  SENSBYT1(FOUR),SENSBYT1(THREE) CHG SENSE TO NOS.         77840002
         TR    SENSBYT1(FOUR),CONVT     CHANGE NOS. TO CHARS   @YM6452P 77842002
         LH    R5WORK,TPRIOB+IOBSTAT1   LOAD STATUS BYTES      @YM6452P 77844002
         SLL   R5WORK,FOUR              SHIFT LEFT 4 BITS      @YM6452P 77846002
         STC   R5WORK,STATBYT3          STORE CHAR             @YM6452P 77848002
         SRL   R5WORK,EIGHT             SHIFT OUT END CHAR     @YM6452P 77850002
         STC   R5WORK,STATBYT2          STORE                  @YM6452P 77852002
         SRL   R5WORK,EIGHT             SHIFT OUT END CHAR     @YM6452P 77854002
         STC   R5WORK,STATBYT1          STORE                  @YM6452P 77856002
         OI    STATBYT3,FOX             PUT IN 'F'             @YM6452P 77858002
         UNPK  STATBYT1(FOUR),STATBYT1(THREE) CHG STATUS TO NOS         77860002
         TR    STATBYT1(FOUR),CONVT     CHANGE TO CHAR         @YM6452P 77862002
         BAL   R6LINK,GETIME           BRANCH TO GET TIME               77880002
         MVC   IOERTIME(HHMMSS),FORHH  MOVE TIME TO MSG                 77940002
         SPACE                                                          78000002
ERREXIT1 LA    R1PARM,MSGAREA          LOAD ADDRESS OF MSG              78060002
         SVC   WTO                     ISSUE WRITE TO OPERATOR          78120002
         LA    R8WORK,IOERROR          SAVE I/O ERR COND CODE           78180002
         B     RTRNM                   BRANCH TO FREEMAIN AND RETURN    78240002
         SPACE 2                                                        78300002
MSGEWM   MVC   MSGAREA(MSG6LEN),ERRMSG6          MOVE EARLY WARNING MSG 78360002
         LA    R1PARM,MSGAREA          LOAD ADDRESS OF MSG              78420002
         SVC   WTO                     ISSUE WRITE TO OPERATOR          78480002
         SPACE 1                                               @YM2953P 78486002
*    CLEAR WRTEWMSG FLAG TO PREVENT DUP MSG IN CASE OF SHORT RE         78492002
         SPACE 1                                               @YM2953P 78498002
         NI    FLAGS,SHTCLR             CLEAR WRTEWMSG FLAG    @YM2953P 78504002
         TM    INTSW,SHTSW              TEST FOR SHORT RE      @YM2953P 78510002
         BZ    OUT                      NO-RETURN TO CALLER    @YM2953P 78516002
         NI    INTSW,SHTCLR             CLEAR SHORT RE INDICATOR        78522002
         L     R14RETRN,SHORTRTN        GET SHORT RE RETURN ADDR        78528002
         BR    R14RETRN                 GO CHECK FOR MORE      @YM2953P 78534002
         EJECT                                                          78540002
*                                                                       78600002
*****     CONSTANTS AND CCW'S                                           78660002
*                                                                       78720002
*                                                                       78780002
HDRCCW   CCW   49,0,X'40',5        SEARCH ON ID                         78840002
TIC      CCW   8,0,X'40',1         TRANSFER IN CHANNEL                  78900002
TIC2     CCW   6,0,X'00',40             READ HDR RECORD                 78960002
         SPACE 2                                                        79020002
WTCCW    CCW   49,0,X'40',5        SEARCH ON ID EQUAL                   79080002
         CCW   8,0,X'40',1         TRANSFER IN CHANNEL                  79140002
         CCW   29,0,X'80',8             WRT CKD 8 BYTES DATA CHAINED    79200002
         CCW   29,0,X'20',0        TO RECORD ENTRY                      79260002
         DS    0F                                                       79320002
CONST1   DC    XL4'1'                   CONSTANT OF ONE                 79440002
SUBCONST DC    XL2'10'                  TABLE OF SUBTRACTION CONSTANTS  79500002
         DC    AL2(085)                 2311    SUBTRACT CONSTANT       79560002
         DC    AL2(133)                 2301    SUBTRACT CONSTANT       79620002
         DC    AL2(108)                 2303    SUBTRACT CONSTANT       79680002
         DC    AL2(085)                 2302    SUBTRACT CONSTANT       79740002
         DC    AL2(107)                 2321    SUBTRACT CONSTANT       79800002
         DC    AL2(432)                 2305-I  SUBTRACT CONSTANT       79860002
         DC    AL2(198)                 2305-II SUBTRACT CONSTANT       79920002
         DC    AL2(122)                 2314    SUBTRACT CONSTANT       79980002
         DC    AL2(135)                 3330    SUBTRACT CONSTANT       80040002
         DC    AL2(167)                3340    SUBTRACT CONST   XL03130 80100002
         DC    AL2(183)            3350 SUBTRACT CONST         @Z40RIVS 80160004
         DC    AL2(000)                DUMMY   SUBTRACT CONST   XL03145 80220002
         DC    AL2(135)                3330-1  SUBTRACT CONST   XL03145 80280002
NQCON     DC    X'C0084000'                                             80340003
         DC    2F'0'                    POINTER AREA           @YM6451P 80370002
RESID    DC    CL8'LOGREC  '                                            80400002
LOGREC   DC    CL8'RECORDER'                                            80460002
MAINTAB  DC    F'380'                   GETMAIN LENGTH           YM5198 80520002
         DC    F'0'                          ADDR OF ADDR LIST          80580002
         DC    X'20'                         E C MODE                   80640002
         DC    X'F5'                         SUBPOOL VALUE  245         80700002
         DC    F'0'                          ADDR OF GOTTEN CORE        80760002
         SPACE 1                                                        81000002
         DS    0F                                                       81060002
MULTICON DC    H'10'                   CONSTANT WHICH IS MULTIPLIED     81120002
*                                       TO OFFSET TO BECOME INDEX TO    81180002
*                                       STAT TABS                       81240002
FOXES    DC    X'FFFF'                                         @ZA04259 81270004
MASK     DC    F'15'                                             X03127 81300002
CONST4   DC    H'4'                    CONSTANT OF FOUR                 81420002
         SPACE                                                          81480002
*      THE FOLLOWING TABLE CONTAINS THE DEVICE TYPE CODES FOR THOSE     81540002
*        DEVICES HAVING BUFFERED LOGS                                   81600002
         SPACE                                                          81660002
NEWDEVTB DC    X'2006'                 ZEUS MOD 1 2305-1 DEVICE         81720002
         DC    X'2007'                 ZEUS MOD 2 2305-2 DEVICE         81780002
         DC    X'2009'                 MERLIN     3330   DEVICE         81900002
         DC    X'200A'                 WINCHESTER 3340   DEVICE XL03130 81960002
         DC    X'200B'             3350 DEVICE                 @Z40RIVS 81990004
         DC    X'200D'                 ICEBERG   3330-11 DEVICE XL03145 82020002
         DC    X'0819'                 MOHAWK-3895             @G30HIMD 82025002
UR3800   DC    X'080E'                                         @SKINNER 82030004
         SPACE 1                                               @YM2953P 82040002
SS1      DC    X'0842'             MSS                         @ZA04252 82060003
         SPACE                                                          82080002
TYASPN   DC    X'8003'                 ASPEN   3420/3410 DEVICE  PT0878 82140002
         SPACE                                                          82200002
RECNO    DC    X'080706050403020100'    2314 PHYS CONV TABLR            82260002
RDELST   DC    H'1'                                                     82320002
         DC    H'14'                                                    82380002
         DC    CL8'IFCRDE03'                                            82440002
         DC    XL6'00'                                                  82500002
         SPACE                                                          82560002
         SPACE                                                          82620002
*****    LIST  MESSAGES  TO  OPERATOR                                   82680002
ERRMSG3  DC    AL2(MSGEND3-*)                                           82740002
         DC    B'1000000000000000'      MCSFLAG FIELD                   82800002
         DC    C'IFB020I INVALID REPLY TO IFB010D'                      82860002
MSGEND3  EQU   *                                                        82920002
         DC    B'0001000000000000'      DESCRIPTOR CODE                 82980002
         DC    B'0100000000000000'      ROUTING CODE                    83040002
INFOMSG  DC    AL2(MSGEND4-*)                                           83100002
         DC    B'1000000000000000'      MCSFLAG FIELD                   83160002
         DC    C'IFB010D ENTER ''IPL REASON,SUBSYSTEM ID'' '            83220002
         DC    C'OR ''U'''                                              83280002
MSGEND4  EQU   *                                                        83340002
         DC    B'0100000000000000'      DESCRIPTOR CODE                 83400002
         DC    B'1000000000000000'      ROUTING CODE                    83460002
         EJECT                                                          83520002
* THE FOLLOWING IS A MATRIX OF VALID WTOR REASON REPLIES                83580002
REPLYNM  DC    C'NM'                    NORMAL                          83640002
REPLYUN  DC    C'UN'                    UNKNOWN                         83700002
REPLYIE  DC    C'IE'                    IBM HDW OR TYPE1 CODE           83760002
REPLYIM  DC    C'IM'                    SAME AS IE ACTION TAKEN         83820002
REPLYOP  DC    C'OP'                    OPERATIONAL PROBLEM             83880002
REPLYEN  DC    C'EN'                    ENVIRONMENTAL                   83940002
REPLYCE  DC    C'CE'                    CE/SE HAS SYSTEM CONTROL        84000002
REPLYUP  DC    C'UP'                    USER PROGRAM                    84060002
REPLYPP  DC    C'ME'                    MEDIA                           84120002
         DC    X'0000000000000000'      RESERVED FOR MORE REASONS       84180002
         SPACE 2                                                        84240002
* THE FOLLOWING IS A MATRIX OF VALID WTOR SUBSYSTEM ID  REPLIES         84300002
REPLY00  DC    C'00'                    NOT KNOWN                       84360002
         DC    X'00'                                                    84420002
REPLY10  DC    C'10'                    PROCESSOR SUBSYSTEM             84480002
         DC    X'10'                                                    84540002
REPLY20  DC    C'20'                    DASD                            84600002
         DC    X'20'                                                    84660002
REPLY30  DC    C'30'                    DISK                            84720002
         DC    X'30'                                                    84780002
REPLY40  DC    C'40'                    TAPE                            84840002
         DC    X'40'                                                    84900002
REPLY50  DC    C'50'                    CARD MACHINE/PRINTER            84960002
         DC    X'50'                                                    85020002
REPLY51  DC    C'51'                              AUX CARD MACH/PRINTER 85080002
         DC    X'51'                                                    85140002
REPLY52  DC    C'52'                    PRINTER                         85200002
         DC    X'52'                                                    85260002
REPLY60  DC    C'60'                    DRUM                            85320002
         DC    X'60'                                                    85380002
REPLY70  DC    C'70'                    TELEPROCESSING                  85440002
         DC    X'70'                                                    85500002
REPLY80  DC    C'80'                    GRAPHICS                        85560002
         DC    X'80'                                                    85620002
REPLY90  DC    C'90'                    IBM PROGRAM                     85680002
         DC    X'90'                                                    85740002
REPLY91  DC    C'91'                    IBM PROGRAMING PRODUCT          85800002
         DC    X'91'                                                    85860002
REPLY92  DC    C'92'                                                    85920002
         DC    X'92'                                                    85980002
         DC    X'000000000000000000'                                    86040002
         SPACE                                                          86100002
DEFAULT  DC    C'DF'                                                    86160002
         EJECT                                                          86220002
CONST8   DC    H'8'                    CONSTANT OF 8                    86280002
         SPACE                                                          86340002
         SPACE                                                          86400002
*                                                                       86460002
*                                                                       86520002
****     LIST MESSAGES TO OPERATOR     ****                             86580002
*                                                                       86640002
ERRMSG1  DC    AL2(MSGEND1-*)                                           86700002
         DC    B'1000000000000000'      MCSFLAG FIELD                   86760002
         DC    C'IFB030I SYS1.LOGREC I/O ACCESS '              @YM6452P 86820002
         DC    C'ERROR,SENS,STAT,HH.MM.SS'                     @YM6452P 86850002
MSGEND1  EQU   *                                                        86880002
         DC    B'0001000000000000'      DESCRIPTOR CODE                 86940002
         DC    B'1000000000000000'      ROUTING CODE                    87000002
         SPACE                                                          87060002
ERRMSG2  DC    AL2(MSGEND2-*)                                           87120002
         DC    B'1000000000000000'      MCSFLAG FIELD                   87180002
         DC    C'IFB040I SYS1.LOGREC AREA IS FULL,HH.MM.SS'             87240002
MSGEND2  EQU   *                                                        87300002
         DC    B'0001000000000000'      DESCRIPTOR CODE                 87360002
         DC    B'1000000000000000'      ROUTING CODE                    87420002
         SPACE                                                          87480002
ERRMSG5  DC    AL2(MSGEND5-*)                                           87540002
         DC    B'1000000000000000'      MCSFLAG FIELD                   87600002
         DC    C'IFB050I SYS1.LOGREC FORMAT ERROR,HH.MM.SS'             87660002
MSGEND5  EQU   *                                                        87720002
         DC    B'0001000000000000'      DESCRIPTOR CODE                 87780002
         DC    B'1000000000000000'      ROUTING CODE                    87840002
         SPACE                                                          87900002
ERRMSG6  DC    AL2(MSGEND6-*)                                           87960002
         DC    B'1000000000000000'      MCSFLAG FIELD                   88020002
         DC    C'IFB060E SYS1.LOGREC NEAR FULL'                         88080002
MSGEND6  EQU   *                                                        88140002
         DC    B'0010000000000000'      DESCRIPTOR CODE                 88200002
         DC    B'1000000000000000'      ROUTINE CODE                    88260002
CONVT    EQU   *-C'0'                   CONVERSION TABLE ORIGIN         88280002
         DC    C'0123456789ABCDEF'      CONVERSION TABLE       @YM6452P 88300002
         EJECT                                                          88320002
ESTALIST ESTAE MF=L                                              YM5198 88322002
PGMCKADD DC    A(PGMCKENT)              ESTAE ENTRY POINT        YM5198 88324002
*                                                              @YM6451P 88326002
*                                                              @YM6451P 88328002
****     KEEP THIS THE LAST CODE IN MODULE                     @YM6451P 88330002
*                                                              @YM6451P 88332002
*                                                              @YM6451P 88334002
****     STAE EXIT ROUTINE TO DEQUEUE AND FREE MAIN            @YM6451P 88336002
*                                                              @YM6451P 88338002
*                                                              @YM6451P 88340002
PGMCKENT LR    R5WORK,R15CODE           SET BASE                YM6801P 88342002
         C     R0PARM,STAETEST          TEST FOR WORK AREA      YM6801P 88343002
         BE    GETREGS                  NO-USE REG 2             YM5198 88344002
         L     R2CVTBAS,ZERO(R1PARM)    GET POINTER IN 2         YM5198 88346002
GETREGS  LM    R9LOGBAS,R9LOGBAS,ZERO(R2CVTBAS)   GET REGISTER   YM5198 88348002
         TM    INTSW,ENQIND             TEST FOR ENQUEUE         YM5198 88350002
         BZ    NOENQ                    NO-DO NOT DEQUEUE        YM5198 88352002
         LA    R1PARM,ENQLSTDS          ADDR OF ENQ LIST         YM5198 88354002
         SVC   DEQUEUE                  ISSUE DEQUEUE            YM5198 88356002
NOENQ    LR    R1PARM,R9LOGBAS          GET PTR TO WORK AREA     YM5198 88358002
         FREEMAIN  R,LV=GETLNGTH,SP=SUBPLNM,A=(1)                YM5198 88360002
         BR    R14RETRN                 RETURN TO RTM            YM5198 88362002
         SPACE 1                                               @YM6451P 88364002
STAETEST DC    A(12)                    STAE STORAGE TEST        YM5198 88366002
PTCHAREA DC    12F'0'                  PATCH AREA                       88380002
         SPACE                                                          88440002
         END                                                            88500002
./  ADD  SSI=81661015,NAME=IFCDIP00
         TITLE 'IFCDIP00- SYS1.LOGREC INITIALIZATION                   *00001000
                        '                                               00002000
IFCDIP00 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IFCDIP00  78.167'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  ST    @14,12(,@13)                                        0001 00010000
         STM   @00,@12,20(@13)                                     0001 00011000
         BALR  @10,0                                               0001 00012000
@PSTART  LA    @11,4095(,@10)                                      0001 00013000
         LA    @12,4095(,@11)                                      0001 00014000
         USING @PSTART,@10                                         0001 00015000
         USING @PSTART+4095,@11                                    0001 00016000
         USING @PSTART+8190,@12                                    0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LA    @14,@SA00001                                        0001 00019000
         ST    @14,8(,@13)                                         0001 00020000
         LR    @13,@14                                             0001 00021000
WORK1    EQU   2                                                        00022000
WORK2    EQU   3                                                        00023000
WORK3    EQU   4                                                        00024000
WORK4    EQU   5                                                        00025000
WORK6    EQU   6                                                        00026000
DEVTABLE EQU   7                                                        00027000
DEBSTR   EQU   38                       START OF EXTENT - DEB OFFSET    00028000
DEBEND   EQU   42                       END OF EXTENT - DEB OFFSET      00029000
DEBNMTRK EQU   46                       NUMBER OF TRACK - DEB OFFSET    00030000
DEBEXT   EQU   36                      OFFSET OF EXTENT IN DEB          00031000
DCBDEBAD EQU   44                      OFFSET FOR DCB DEB POINTER       00032000
*  EQUATE TABLE                                                         00033000
L0       EQU   0                        * THIS                          00034000
L1       EQU   1                        *  SET                          00035000
L2       EQU   2                        *   OF                          00036000
L3       EQU   3                        *    EQUATES                    00037000
L4       EQU   4                        *     IS                        00038000
L5       EQU   5                        *      FOR                      00039000
L6       EQU   6                        *       OFFSETS                 00040000
L7       EQU   7                        *        AND                    00041000
L8       EQU   8                        *         DISPLACEMENTS         00042000
L9       EQU   9                        *          AND                  00043000
L14      EQU   14                       *           LENGTHS             00044000
L40      EQU   40                                                       00045000
*RCODE = 0; /*INITIALIZE RETURN CODE TO SUCCESSFULL          @G51DGVS*/ 00046000
         SLR   @15,@15                                             0069 00047000
         ST    @15,RCODE                                           0069 00048000
*PTRSPOT = R1; /*ESTABLISH ADDRESSABILITY TO PARM FIELD      @G51DGVS*/ 00049000
         ST    R1,PTRSPOT                                          0070 00050000
*IF PARMLEN ¬= ZERO THEN /*IF PARM FIELD EXISTS              @G51DGVS*/ 00051000
         L     @14,PTRSPOT                                         0071 00052000
         L     @14,LISTPTR(,@14)                                   0071 00053000
         LH    @09,PARMLEN(,@14)                                   0071 00054000
         CR    @09,@15                                             0071 00055000
         BE    @RF00071                                            0071 00056000
*  DO;                                                     /*@G51DGVS*/ 00057000
*    IF PARMLEN = SIX THEN  /*IF PARAMETER PROPER LENGTH THEN*/    0073 00058000
         C     @09,@CF00068                                        0073 00059000
         BNE   @RF00073                                            0073 00060000
*     DO;                                                  /*@G51DGVS*/ 00061000
*      IF INARG = FRAMES THEN  /*IF PARAMETER IS FRAMES      @G51DGVS*/ 00062000
         CLC   INARG(6,@14),@CC00069                               0075 00063000
         BNE   @RF00075                                            0075 00064000
*        FRAMEYES = ON;                                    /*@G51DGVS*/ 00065000
         OI    FRAMEYES,B'10000000'                                0076 00066000
*      ELSE /*PARM IS IN BUT NOT FRAMES                      @G51DGVS*/ 00067000
*       DO;                                                /*@G51DGVS*/ 00068000
         B     @RC00075                                            0077 00069000
@RF00075 DS    0H                                                  0078 00070000
*        CALL ERRMSG(11);                                  /*@G51DGVS*/ 00071000
         LA    @01,@AL00078                                        0078 00072000
         BAL   @14,ERRMSG                                          0078 00073000
*        RCODE = SIXTEEN;                                  /*@G51DGVS*/ 00074000
         MVC   RCODE(4),@CF00075                                   0079 00075000
*       END;                                               /*@G51DGVS*/ 00076000
*     END;                                                 /*@G51DGVS*/ 00077000
*    ELSE /*NOT PROPER LENGTH                                @G51DGVS*/ 00078000
*     DO;                                                  /*@G51DGVS*/ 00079000
         B     @RC00073                                            0082 00080000
@RF00073 DS    0H                                                  0083 00081000
*      CALL ERRMSG(11); /*ISSUE IMPROPER PARM FIELD MESSAGE  @G51DGVS*/ 00082000
         LA    @01,@AL00083                                        0083 00083000
         BAL   @14,ERRMSG                                          0083 00084000
*      RCODE = SIXTEEN;                                    /*@G51DGVS*/ 00085000
         MVC   RCODE(4),@CF00075                                   0084 00086000
*     END;                                                 /*@G51DGVS*/ 00087000
*  END;                                                    /*@G51DGVS*/ 00088000
@RC00073 DS    0H                                                  0087 00089000
*IF RCODE = SUCCESS THEN                                           0087 00090000
@RF00071 L     @15,RCODE                                           0087 00091000
         LTR   @15,@15                                             0087 00092000
         BNZ   @RF00087                                            0087 00093000
*DO;                                                       /*@G51DGVS*/ 00094000
*GEN(OPEN (DIPDCB,OUTPUT)); /*OPEN SYS1.LOGREC               @G51DGVS*/ 00095000
         OPEN (DIPDCB,OUTPUT)                                           00096000
*IF (DIPDCBFL & OPENOK) = OPENOK THEN /*IF SUCCESSFULL OPEN  @G51DGVS*/ 00097000
         MVC   @TS00001(1),DIPDCBFL                                0090 00098000
         NI    @TS00001,X'10'                                      0090 00099000
         CLI   @TS00001,X'10'                                      0090 00100000
         BNE   @RF00090                                            0090 00101000
*  DO;                                                     /*@G51DGVS*/ 00102000
*    GEN(ENQ (RESID,LOGRECA,E,8,SYSTEM)); /*ENQUEUE SYS1.LOGREC. */     00103000
         ENQ (RESID,LOGRECA,E,8,SYSTEM)                                 00104000
*    /*LOCK OUT ALL OTHER USERS IN THE SYSTEM                @G51DGVS*/ 00105000
*    CALL OLDDIP; /*CREATE HEADER RECORD AND TIME STAMP      @G51DGVS*/ 00106000
         BAL   @14,OLDDIP                                          0093 00107000
*    IF RCODE = SUCCESS &  /*IF SUCCESSFULLY WROTE HEADER, TIME STAMP*/ 00108000
*       FRAMEYES = ON THEN /*IF USER SPECIFIES WRITE FRAMES  @G51DGVS*/ 00109000
         L     @15,RCODE                                           0094 00110000
         LTR   @15,@15                                             0094 00111000
         BNZ   @RF00094                                            0094 00112000
         TM    FRAMEYES,B'10000000'                                0094 00113000
         BNO   @RF00094                                            0094 00114000
*     DO;                                                  /*@VS48735*/ 00115000
*      CALL NEWDIP; /*WRITE FRAMES TO SYS1.LOGREC            @G51DGVS*/ 00116000
         BAL   @14,NEWDIP                                          0096 00117000
*      IF RCODE = FOUR THEN                                        0097 00118000
         CLC   RCODE(4),@CF00073                                   0097 00119000
         BNE   @RF00097                                            0097 00120000
*        RCODE = SUCCESS;                                  /*@VS48735*/ 00121000
         SLR   @15,@15                                             0098 00122000
         ST    @15,RCODE                                           0098 00123000
*     END;                                                 /*@VS48735*/ 00124000
@RF00097 DS    0H                                                  0100 00125000
*    GEN(DEQ (RESID,LOGRECA,8,SYSTEM)); /*OTHER USERS ALLOWED LOGREC*/  00126000
@RF00094 DS    0H                                                  0100 00127000
         DEQ (RESID,LOGRECA,8,SYSTEM)                                   00128000
*    IF RCODE > TWELVE | FRAMEYES = NO THEN                        0101 00129000
         L     @15,RCODE                                           0101 00130000
         C     @15,@CF00034                                        0101 00131000
         BH    @RT00101                                            0101 00132000
         TM    FRAMEYES,B'10000000'                                0101 00133000
         BNZ   @RF00101                                            0101 00134000
@RT00101 DS    0H                                                  0102 00135000
*      DO;                                                 /*@G51DGVS*/ 00136000
*        RESPECIFY (R6,R7) RESTRICTED;                     /*@G51DGVS*/ 00137000
*        GENERATE;                                         /*@G51DGVS*/ 00138000
         L     DEVTABLE,DEVSTORE   GET DEVICE TABLE ENTRY ADDRESS       00139000
         L     WORK6,DEBADR        GET DATA EXTENT BLOCK ADDRESS        00140000
         MVC   FDAD(L4),DEBEND(WORK6) SET HIGH EXTENT FOR EOF           00141000
         MVC   TRBAL(L2),BT(DEVTABLE) SET TRACK BALANCE FOR EOF         00142000
*        RESPECIFY (R6,R7) UNRESTRICTED;                   /*@G51DGVS*/ 00143000
*      END;                                                /*@G51DGVS*/ 00144000
*    GEN(CLOSE (DIPDCB,DISP));                             /*@G51DGVS*/ 00145000
@RF00101 DS    0H                                                  0107 00146000
         CLOSE (DIPDCB,DISP)                                            00147000
*    IF RCODE < SIXTEEN THEN /*IF LOGREC HAS BEEN INITIALIZED*/    0108 00148000
         L     @15,RCODE                                           0108 00149000
         C     @15,@CF00075                                        0108 00150000
         BNL   @RF00108                                            0108 00151000
*      CALL ERRMSG(1); /*ISSUE END OF JOB MESSAGE            @G51DGVS*/ 00152000
         LA    @01,@AL00109                                        0109 00153000
         BAL   @14,ERRMSG                                          0109 00154000
*  END;                                                    /*@G51DGVS*/ 00155000
*ELSE  /*UNSUCCESSFULL OPEN OF SYS1.LOGREC                   @G51DGVS*/ 00156000
*  DO;                                                     /*@G51DGVS*/ 00157000
         B     @RC00090                                            0111 00158000
@RF00090 DS    0H                                                  0112 00159000
*    CALL ERRMSG(2);                                       /*@G51DGVS*/ 00160000
         LA    @01,@AL00112                                        0112 00161000
         BAL   @14,ERRMSG                                          0112 00162000
*    RCODE = SIXTEEN;                                      /*@G51DGVS*/ 00163000
         MVC   RCODE(4),@CF00075                                   0113 00164000
*  END;                                                    /*@G51DGVS*/ 00165000
*END;                                                      /*@G51DGVS*/ 00166000
@RC00090 DS    0H                                                  0116 00167000
*R15 = RCODE;                                              /*@G51DGVS*/ 00168000
@RF00087 L     R15,RCODE                                           0116 00169000
*OLDDIP: PROC; /*BUILD AND WRITE TIME STAMP RECORDS TO LOGREC, FIRST*/  00170000
         B     @PB00002                                            0117 00171000
OLDDIP   STM   @14,@12,@SA00002                                    0117 00172000
*              /*READ OF SRF                                 @G51DGVS*/ 00173000
*CALL BUILDHDR; /*FORMAT SYS1.LOGREC HEADER FROM CONTROL BLOCK INFO*/   00174000
         BAL   @14,BUILDHDR                                        0118 00175000
*IF RCODE = SUCCESS THEN /*IF VALID SYSTEM RESIDENCE DEVICE  @G51DGVS*/ 00176000
         L     @15,RCODE                                           0119 00177000
         LTR   @15,@15                                             0119 00178000
         BNZ   @RF00119                                            0119 00179000
*  CALL WRITELOG(40,WRITEPTR); /*WRITE HEADER TO LOGREC      @G51DGVS*/ 00180000
         LA    @01,@AL00120                                        0120 00181000
         BAL   @14,WRITELOG                                        0120 00182000
*IF RCODE = SUCCESS THEN                                           0121 00183000
@RF00119 L     @15,RCODE                                           0121 00184000
         LTR   @15,@15                                             0121 00185000
         BNZ   @RF00121                                            0121 00186000
*  DO;                                                     /*@G51DGVS*/ 00187000
*    BUF240 = (BUF240 && BUF240); /*CONSTRUCT TIME STAMP RECORD OF  */  00188000
         XC    BUF240(40),BUF240                                   0123 00189000
*                                 /*HEX ZEROS VIA EXCLUSIVE OR      */  00190000
*    CALL WRITELOG(40,WRITEPTR); /*WRITE TIME STAMP TO SYS1.LOGREC*/    00191000
         LA    @01,@AL00124                                        0124 00192000
         BAL   @14,WRITELOG                                        0124 00193000
*    IF RCODE = SUCCESS THEN                                       0125 00194000
         L     @15,RCODE                                           0125 00195000
         LTR   @15,@15                                             0125 00196000
         BNZ   @RF00125                                            0125 00197000
*      DO;                                                 /*@G51DGVS*/ 00198000
*        IF FRAMEYES = ON THEN /*IF FRAMES TO BE WRITTEN TO LOGREC*/    00199000
         TM    FRAMEYES,B'10000000'                                0127 00200000
         BNO   @RF00127                                            0127 00201000
*                              /*FOR A MERIDIAN LIKE CPU WITH AN  */    00202000
*          DO;                 /*ACCESSIBLE SRF              @G51DGVS*/ 00203000
*            CALL OPENSRF;         /*OPEN SYSTEM REFERENCE FILE   */    00204000
         BAL   @14,OPENSRF                                         0129 00205000
*            IF RCODE = SUCCESS THEN                               0130 00206000
         L     @15,RCODE                                           0130 00207000
         LTR   @15,@15                                             0130 00208000
         BNZ   @RF00130                                            0130 00209000
*              DO;                                         /*@G51DGVS*/ 00210000
*                CALL GETSER; /*RETRIEVE CPU SERIAL NUMBER   @G51DGVS*/ 00211000
         BAL   @14,GETSER                                          0132 00212000
*                CALL BUILDFRH; /*BUILD CONSTANT PART OF FRAME HEADER*/ 00213000
         BAL   @14,BUILDFRH                                        0133 00214000
*                CALL VERBPROC;            /* PERFORM VERBAGE        */ 00215000
         BAL   @14,VERBPROC                                        0134 00216000
*                CALL READSRF; /*READ FRAME TEXT ACROSS SYSTEM  */ 0135 00217000
         BAL   @14,READSRF                                         0135 00218000
*                               /*REFERENCE FILE INTERFACE. SET  */     00219000
*                               /*RETURN CODE IF EOF OR FAILURE. */     00220000
*                IF RCODE ¬= SUCCESS THEN /*IF NOT RETRIEVE FRAME*/     00221000
         L     @15,RCODE                                           0136 00222000
         LTR   @15,@15                                             0136 00223000
         BZ    @RF00136                                            0136 00224000
*                  DO;                                     /*@G51DGVS*/ 00225000
*                    IF RCODE = FOUR THEN /*IF EOF ON 1ST READ*/   0138 00226000
         C     @15,@CF00073                                        0138 00227000
         BNE   @RF00138                                            0138 00228000
*                      CALL ERRMSG(10);                    /*@G51DGVS*/ 00229000
         LA    @01,@AL00139                                        0139 00230000
         BAL   @14,ERRMSG                                          0139 00231000
*                    ELSE  /*LEGITIMATE READ ERROR           @G51DGVS*/ 00232000
*                      CALL ERRMSG(7);                     /*@G51DGVS*/ 00233000
         B     @RC00138                                            0140 00234000
@RF00138 LA    @01,@AL00140                                        0140 00235000
         BAL   @14,ERRMSG                                          0140 00236000
*                    RCODE = TWELVE; /*INDICATE NO FRAMES RETRIEVED */  00237000
@RC00138 MVC   RCODE(4),@CF00034                                   0141 00238000
*                  END;                                    /*@G51DGVS*/ 00239000
*                ELSE /*SUCCESSFUL READ OF A FRAME           @G51DGVS*/ 00240000
*                  DO;                                     /*@G51DGVS*/ 00241000
         B     @RC00136                                            0143 00242000
@RF00136 DS    0H                                                  0144 00243000
*                    READPTR = (READPTR && WRITEPTR);/*SHIFT READ,WRTE* 00244000
         L     @15,WRITEPTR                                        0144 00245000
         L     @14,READPTR                                         0144 00246000
         XR    @14,@15                                             0144 00247000
         ST    @14,READPTR                                         0144 00248000
*                    WRITEPTR = (WRITEPTR && READPTR);/*BUFFERS VIA 3*/ 00249000
         XR    @15,@14                                             0145 00250000
         ST    @15,WRITEPTR                                        0145 00251000
*                    READPTR = (READPTR && WRITEPTR); /*EXCLUSIVE ORS*/ 00252000
         XR    @14,@15                                             0146 00253000
         ST    @14,READPTR                                         0146 00254000
*                    RECCNT = 1; /*FIRST FRAME OF THE SET    @G51DGVS*/ 00255000
         MVI   RECCNT,X'01'                                        0147 00256000
*                    SEQCNT = 1; /*FIRST FRAME FOR 50 FRAME LIMIT CK*/  00257000
         MVI   SEQCNT,X'01'                                        0148 00258000
*                  END;                                    /*@G51DGVS*/ 00259000
*              END;                                        /*@G51DGVS*/ 00260000
*            ELSE /*SRF COULD NOT BE OPENED                  @G51DGVS*/ 00261000
*                CALL ERRMSG(6); /*SRF CANNOT BE OPENED      @G51DGVS*/ 00262000
         B     @RC00130                                            0151 00263000
@RF00130 LA    @01,@AL00151                                        0151 00264000
         BAL   @14,ERRMSG                                          0151 00265000
*          END;                                            /*@G51DGVS*/ 00266000
*      END;                                                /*@G51DGVS*/ 00267000
*    ELSE /*ERROR WRITING TIME STAMP RECORD                  @G51DGVS*/ 00268000
*      CALL ERRMSG(3);                                     /*@G51DGVS*/ 00269000
         B     @RC00125                                            0154 00270000
@RF00125 LA    @01,@AL00154                                        0154 00271000
         BAL   @14,ERRMSG                                          0154 00272000
*  END;                                                    /*@G51DGVS*/ 00273000
*ELSE /*ERROR WRITING HEADER RECORD                          @G51DGVS*/ 00274000
*  CALL ERRMSG(3);                                         /*@G51DGVS*/ 00275000
         B     @RC00121                                            0156 00276000
@RF00121 LA    @01,@AL00156                                        0156 00277000
         BAL   @14,ERRMSG                                          0156 00278000
*END; /*END OF PROC OLDDIP                                   @G51DGVS*/ 00279000
@EL00002 DS    0H                                                  0157 00280000
@EF00002 DS    0H                                                  0157 00281000
@ER00002 LM    @14,@12,@SA00002                                    0157 00282000
         BR    @14                                                 0157 00283000
         EJECT                                                          00284000
*NEWDIP: PROC; /*READ THE SRF TO GET FRAME TEXT, CONSTRUCT FRAME */     00285000
NEWDIP   STM   @14,@12,@SA00003                                    0158 00286000
*              /*RECORDS, WRITE THE RECORDS TO SYS1.LOGREC, AND  */     00287000
*              /*REWRITE THE SYS1.LOGREC HEADER TO REFLECT FRAMES*/     00288000
*        DO WHILE RCODE = SUCCESS; /*DO WHILE NOT EOF OR READ ERROR */  00289000
         B     @DE00159                                            0159 00290000
@DL00159 DS    0H                                                  0160 00291000
*                               /*OR WRITE ERROR.            @G51DGVS*/ 00292000
*          CALL READSRF; /*READ FRAME ACROSS SYSTEM REFERENCE FILE  */  00293000
         BAL   @14,READSRF                                         0160 00294000
*                        /*AND IDENTIFY END OF FILE AND ERROR CONDIT*/  00295000
*          IF RCODE ¬= SUCCESS THEN    /*IF SUCCESSFUL READ  @G51DGVS*/ 00296000
         L     @15,RCODE                                           0161 00297000
         SLR   @14,@14                                             0161 00298000
         CR    @15,@14                                             0161 00299000
         BE    @RF00161                                            0161 00300000
*            DO;                                           /*@G51DGVS*/ 00301000
*              RECNLST = OFF;/*INDICATE RECORD IN BUFFER IS LAST OF ST* 00302000
         NI    RECNLST,B'01111111'                                 0163 00303000
*              IF RCODE = FOUR &  /*IF END OF FILE           @G51DGVS*/ 00304000
*                 FRAMTYPS = MCF THEN /*HAVE BEEN READING MCH FRMS*/    00305000
         C     @15,@CF00073                                        0164 00306000
         BNE   @RF00164                                            0164 00307000
         CLI   FRAMTYPS,X'02'                                      0164 00308000
         BNE   @RF00164                                            0164 00309000
*                  DO;                                     /*@G51DGVS*/ 00310000
*                    FRAMTYPS = CCF; /*SET UP TO READ CCF FRAMES  */    00311000
         MVI   FRAMTYPS,X'01'                                      0166 00312000
*                    RCODE = SUCCESS; /*INDICATE SUCCESS, NOT COMPLETE* 00313000
         ST    @14,RCODE                                           0167 00314000
*                    SEQCNT = ZERO; /*RESET PHYSICAL SEQUENCE NUMBER  * 00315000
         MVI   SEQCNT,X'00'                                        0168 00316000
*                                   /*FOR NEXT SET OF FRAMES @G51DGVS*/ 00317000
*                    CALL VERBPROC;        /* PERFORM VERBAGE        */ 00318000
         BAL   @14,VERBPROC                                        0169 00319000
*                    CALL READSRF; /*READ SRF TO RESET SEQUENCING*/     00320000
         BAL   @14,READSRF                                         0170 00321000
*                    IF RCODE = FOUR THEN /*IF EOF, NO CCF FRAMES*/     00322000
         CLC   RCODE(4),@CF00073                                   0171 00323000
         BNE   @RF00171                                            0171 00324000
*                      DO;   /*RCODE ALREADY SET TO 8 IF HARD ERROR*/   00325000
*                        CALL ERRMSG(10); /*MISSING FRAME SET MESSAGE*/ 00326000
         LA    @01,@AL00173                                        0173 00327000
         BAL   @14,ERRMSG                                          0173 00328000
*                        RCODE = EIGHT; /*INDICATE MISSING FRAMES*/     00329000
         MVC   RCODE(4),@CF00063                                   0174 00330000
*                      END;                                /*@G51DGVS*/ 00331000
*                  END;                                    /*@G51DGVS*/ 00332000
*            END;                                          /*@G51DGVS*/ 00333000
*          ELSE  /*IF SUCCESSFUL READ                        @G51DGVS*/ 00334000
*            IF RECCNT = MAXFRM THEN /*IF FRAME JUST READ IS ONE TOO*/  00335000
         B     @RC00161                                            0178 00336000
@RF00161 CLI   RECCNT,50                                           0178 00337000
         BNE   @RF00178                                            0178 00338000
*              DO;                   /*MANY FOR EREP1 THEN   @G51DGVS*/ 00339000
*                CALL ERRMSG(8); /*MAXIMUM FRAME NUMBER EXCEEDED MESS*/ 00340000
         LA    @01,@AL00180                                        0180 00341000
         BAL   @14,ERRMSG                                          0180 00342000
*                RCODE = EIGHT; /*INDICATE LOST FRAMES       @G51DGVS*/ 00343000
         MVC   RCODE(4),@CF00063                                   0181 00344000
*                RECNLST = OFF; /*SET LAST FRAME SWITCH ON.  @G51DGVS*/ 00345000
         NI    RECNLST,B'01111111'                                 0182 00346000
*                IF FRAMTYPS = MCF THEN /*IF CHANNEL FRAMES LEFT    */  00347000
         CLI   FRAMTYPS,X'02'                                      0183 00348000
         BNE   @RF00183                                            0183 00349000
*                  DO;                                     /*@G51DGVS*/ 00350000
*                    RCODE = ZERO; /*CONTINUE IN LOOP        @G51DGVS*/ 00351000
         SLR   @15,@15                                             0185 00352000
         ST    @15,RCODE                                           0185 00353000
*                    FRAMLOST = ON; /*INDICATE FRAMES LOST WITHOUT*/    00354000
         OI    FRAMLOST,B'01000000'                                0186 00355000
*                     /*USING RETURN CODE AND EXITING LOOP   @G51DGVS*/ 00356000
*                    SEQCNT = ZERO; /*RESET FOR CHANNEL FRAMES*/   0187 00357000
         MVI   SEQCNT,X'00'                                        0187 00358000
*                    FRAMTYPS = CCF; /*PREPARE TO READ CHANNEL FRMS */  00359000
         MVI   FRAMTYPS,X'01'                                      0188 00360000
*                    CALL VERBPROC;        /* PERFORM VERBAGE        */ 00361000
         BAL   @14,VERBPROC                                        0189 00362000
*                    CALL READSRF; /*READ FRAME OVERLAY TOO MANY FRAME* 00363000
         BAL   @14,READSRF                                         0190 00364000
*                    IF RCODE = FOUR THEN /*IF END OF FILE ON 1ST */    00365000
         CLC   RCODE(4),@CF00073                                   0191 00366000
         BNE   @RF00191                                            0191 00367000
*                      DO;                /*CCH FRAME READ THEN*/  0192 00368000
*                        CALL ERRMSG(10); /*ISSUE MISSING SET MESSAGE*/ 00369000
         LA    @01,@AL00193                                        0193 00370000
         BAL   @14,ERRMSG                                          0193 00371000
*                        RCODE = EIGHT; /*INDICATE MISSING FRAMES AND*/ 00372000
         MVC   RCODE(4),@CF00063                                   0194 00373000
*                                       /*EXIT THE LOOP      @G51DGVS*/ 00374000
*                      END;                                /*@G51DGVS*/ 00375000
*                  END;                                    /*@G51DGVS*/ 00376000
*                ELSE /*NO MORE MACHINE FRAMES MUST BE READ  @G51DGVS*/ 00377000
*                  RCODE = EIGHT; /*DONT ALLOW FRAME JUST READ OR ANY*/ 00378000
         B     @RC00183                                            0197 00379000
@RF00183 MVC   RCODE(4),@CF00063                                   0197 00380000
*              END;               /*FURTHER FRAMES TO BE READ        */ 00381000
@RC00183 DS    0H                                                  0199 00382000
*          RECHDR = RECBUILD; /*MOVE BUILT HEADER TO BUFFER  @G51DGVS*/ 00383000
@RF00178 DS    0H                                                  0199 00384000
@RC00161 L     @01,WRITEPTR                                        0199 00385000
         MVC   RECHDR(24,@01),RECBUILD                             0199 00386000
*          RECCNT = SEQCNT + 1; /*UP INDEX FOR NEXT RECORD   @G51DGVS*/ 00387000
         SLR   @01,@01                                             0200 00388000
         IC    @01,SEQCNT                                          0200 00389000
         LA    @01,1(,@01)                                         0200 00390000
         STC   @01,RECCNT                                          0200 00391000
*          SEQCNT = SEQCNT + 1; /*UP RUNNING SEQUENCE NUMBER OF RECRD*/ 00392000
         STC   @01,SEQCNT                                          0201 00393000
*          RECNLST = ON; /*RESET LAST REC. SWITCH FOR NEXT RECORD*/     00394000
         OI    RECNLST,B'10000000'                                 0202 00395000
*          IF FRAMTYPS = CCF THEN /*IF NOW READING CHANNEL FRAMES   */  00396000
         CLI   FRAMTYPS,X'01'                                      0203 00397000
         BNE   @RF00203                                            0203 00398000
*            RECTYPE = 'B0'X;     /*THEN SET RECORD TYPE TO CCF FOR */  00399000
         MVI   RECTYPE,X'B0'                                       0204 00400000
*                                 /*FRAME WRITTEN NEXT LOOP ITERATION*/ 00401000
*          CALL WRITELOG(1944,WRITEPTR); /*WRITE PREVIOUS FRAME TO LG*/ 00402000
@RF00203 LA    @01,@AL00205                                        0205 00403000
         BAL   @14,WRITELOG                                        0205 00404000
*                               /*NOTE ITS LOCATION AND CHECK FOR   */  00405000
*                               /*OVERFLOW OF THE EXTENT.    @G51DGVS*/ 00406000
*                               /*COUNT SUCCESSFUL WRITES OF FRAMES */  00407000
*          IF RCODE = SUCCESS THEN                                 0206 00408000
         L     @15,RCODE                                           0206 00409000
         LTR   @15,@15                                             0206 00410000
         BNZ   @RF00206                                            0206 00411000
*            ONEFRAME = ON;                                /*@VS48735*/ 00412000
         OI    ONEFRAME,B'00100000'                                0207 00413000
*          READPTR = (READPTR && WRITEPTR); /*SWITCH READ,WRITE*/  0208 00414000
@RF00206 L     @15,WRITEPTR                                        0208 00415000
         L     @14,READPTR                                         0208 00416000
         XR    @14,@15                                             0208 00417000
         ST    @14,READPTR                                         0208 00418000
*          WRITEPTR = (WRITEPTR && READPTR); /*BUFFERS VIA THREE*/ 0209 00419000
         XR    @15,@14                                             0209 00420000
         ST    @15,WRITEPTR                                        0209 00421000
*          READPTR = (READPTR && WRITEPTR); /*EXCLUSIVE ORS  @G51DGVS*/ 00422000
         XR    @14,@15                                             0210 00423000
         ST    @14,READPTR                                         0210 00424000
*         END; /*END OF READ, WRITE LOOP                     @G51DGVS*/ 00425000
@DE00159 L     @15,RCODE                                           0211 00426000
         LTR   @15,@15                                             0211 00427000
         BZ    @DL00159                                            0211 00428000
*  CALL CLOSESRF; /*DISABLE AND CLOSE SRF                    @G51DGVS*/ 00429000
         BAL   @14,CLOSESRF                                        0212 00430000
*  IF FRAMLOST = ON THEN /*IF FRAMES LOST BUT RCODE NOT SET  @G51DGVS*/ 00431000
         TM    FRAMLOST,B'01000000'                                0213 00432000
         BNO   @RF00213                                            0213 00433000
*    RCODE = EIGHT; /*USE RCODE TO PASS RETURN CODE TO USER  @G51DGVS*/ 00434000
         MVC   RCODE(4),@CF00063                                   0214 00435000
*  IF RCODE = EIGHT &   /*IF SOME FRAMES LOST                @G51DGVS*/ 00436000
*     ONEFRAME = NO THEN /*IF NO FRAMES SUCCESSFULLY WRITTEN @G51DGVS*/ 00437000
@RF00213 CLC   RCODE(4),@CF00063                                   0215 00438000
         BNE   @RF00215                                            0215 00439000
         TM    ONEFRAME,B'00100000'                                0215 00440000
         BNZ   @RF00215                                            0215 00441000
*    RCODE = TWELVE;      /*INDICATE NO FRAMES WRITTEN       @G51DGVS*/ 00442000
         MVC   RCODE(4),@CF00034                                   0216 00443000
*  IF FRAMEYES = YES &  /*IF FRAMES TO BE WRITTEN            @G51DGVS*/ 00444000
*     RCODE < TWELVE THEN /*IF AT LEAST ONE FRAME WRITTEN SUCCESSFULLY* 00445000
@RF00215 TM    FRAMEYES,B'10000000'                                0217 00446000
         BNO   @RF00217                                            0217 00447000
         L     @15,RCODE                                           0217 00448000
         C     @15,@CF00034                                        0217 00449000
         BNL   @RF00217                                            0217 00450000
*    DO;                                                   /*@G51DGVS*/ 00451000
*     RESPECIFY (R6,R7) RESTRICTED;                        /*@G51DGVS*/ 00452000
*     GENERATE;                                            /*@G51DGVS*/ 00453000
         L     DEVTABLE,DEVSTORE GET DEVICE TABLE ENTRY ADDR.           00454000
         L     WORK6,DEBADR      GET DATA EXTENT BLOCK ADDRESS          00455000
         MVC   FDAD(L4),DEBEND(WORK6) SET HIGH EXTENT FOR EOF           00456000
         MVC   TRBAL(L2),BT(DEVTABLE) SET TRACK BALANCE FOR EOF         00457000
         CLOSE (DIPDCB,REREAD)     CLOSE LOGREC FOR NORMAL WRITING      00458000
         OPEN  (DIPDCB,UPDAT)    OPEN LOGREC TO REWRITE THE HEADER      00459000
         READ  LISTDECB,SF,DIPDCB,HDRSAVE,40,,,,MF=E                    00460000
         CHECK LISTDECB                                                 00461000
*     RESPECIFY (R6,R7) UNRESTRICTED;                      /*@G51DGVS*/ 00462000
*     CALL REDOHDR; /*RECREATE LOGREC HEADER TO REFLECT FRAMES*/   0222 00463000
         BAL   @14,REDOHDR                                         0222 00464000
*     GENERATE;                                            /*@G51DGVS*/ 00465000
         WRITE LISTDECB,SF,DIPDCB,HDRSAVE,40,,,,MF=E                    00466000
         CHECK LISTDECB                                                 00467000
*    END;                                                  /*@G51DGVS*/ 00468000
*END; /*END OF NEWDIP PROC                                   @G51DGVS*/ 00469000
@EL00003 DS    0H                                                  0225 00470000
@EF00003 DS    0H                                                  0225 00471000
@ER00003 LM    @14,@12,@SA00003                                    0225 00472000
         BR    @14                                                 0225 00473000
*BUILDHDR: PROC; /*FORMAT SYS1.LOGREC HEADER FROM INFO IN SYSTEM */     00474000
BUILDHDR STM   @14,@12,@SA00004                                    0226 00475000
*                /*CONTROL BLOCKS AND INTERNAL TABLES        @G51DGVS*/ 00476000
*  CALL GETDEV; /*FIND ENTRY IN INTERNAL DEVICE TABLE FOR SYSRES*/ 0227 00477000
         BAL   @14,GETDEV                                          0227 00478000
*               /*FORMAT HEADER RECORD FIELDS BUILT FROM DEVTABLE*/     00479000
*               /*AND THE DATA EXTENT BLOCK                  @G51DGVS*/ 00480000
*  CALL RECSTRT; /*CALCULATE START OF RECORD ENTRY AREA AND THE   */    00481000
         BAL   @14,RECSTRT                                         0228 00482000
*                /*FULL POINT OF SYS1.LOGREC                 @G51DGVS*/ 00483000
*  GENERATE REFS(BUF240);                                  /*@G51DGVS*/ 00484000
         MVC   BUF240(40),HDRSAVE      MOVE HEADER TO INITIAL WRITE BF  00485000
*END;                                                      /*@G51DGVS*/ 00486000
@EL00004 DS    0H                                                  0230 00487000
@EF00004 DS    0H                                                  0230 00488000
@ER00004 LM    @14,@12,@SA00004                                    0230 00489000
         BR    @14                                                 0230 00490000
*WRITELOG: PROC(INPARM,WHERE);                             /*@G51DGVS*/ 00491000
WRITELOG STM   @14,@12,@SA00005                                    0231 00492000
         MVC   @PC00005(8),0(@01)                                  0231 00493000
*                /*WRITE A RECORD TO SYS1.LOGREC USING BSAM. @G51DGVS*/ 00494000
*                /*RETRIEVE THE ADDRESS OF THE RECORD USING NOTE   */   00495000
*                /*CHECK TO SEE IF SYS1.LOGREC EXTENT HAS OVERFLOWED*/  00496000
*                /*SET RETURN CODE IF WRITE ERROR OR OVERFLOW EXTENT*/  00497000
*DCL INPARM FIXED(31); /*LENGTH OF RECORD TO BE WRITTEN      @G51DGVS*/ 00498000
*DCL WHERE  PTR(31);  /*WHERE RECORD IS                      @G51DGVS*/ 00499000
*RESPECIFY (R1,R2,R3) RESTRICTED;                          /*@G51DGVS*/ 00500000
*R2 = WHERE;  /*ADDRESS OF RECORD TO BE WRITTEN PUT IN REG2  @G51DGVS*/ 00501000
         L     @15,@PC00005+4                                      0235 00502000
         L     R2,WHERE(,@15)                                      0235 00503000
*R3 = INPARM; /*LENGTH OF RECORD TO BE WRITTEN               @G51DGVS*/ 00504000
         L     @15,@PC00005                                        0236 00505000
         L     R3,INPARM(,@15)                                     0236 00506000
*GENERATE;                                                 /*@G51DGVS*/ 00507000
DWRITE   WRITE DIPDECB,SF,DIPDCB,(2),(3)                                00508000
         CHECK DIPDECB                                                  00509000
         NOTE  DIPDCB                   RETRIEVE TTR OF RECORD WRITTEN  00510000
*TTRSAVE = R1;     /*STORE RELATIVE DIRECT ACCESS LOCATION FROM NOTE*/  00511000
         ST    R1,TTRSAVE                                          0238 00512000
*RESPECIFY (R1,R2,R3) UNRESTRICTED;                        /*@G51DGVS*/ 00513000
*IF FRAMEYES = ON &   /*IF FRAMES, CHECK TO SEE IF ENOUGH ROOM ON */    00514000
*   TTRSAVE = MAXTTR THEN /*ON LOGREC FOR NEXT WRITE. ASSUME AT   */    00515000
         TM    FRAMEYES,B'10000000'                                0240 00516000
         BNO   @RF00240                                            0240 00517000
         L     @15,TTRSAVE                                         0240 00518000
         C     @15,MAXTTR                                          0240 00519000
         BNE   @RF00240                                            0240 00520000
*                         /*LEAST ONE TRACK FOR HEADER AND TIME STMP*/  00521000
*  DO;                                                     /*@G51DGVS*/ 00522000
*    CALL ERRMSG(4); /*NOT ENOUGH ROOM FOR FRAMES            @G51DGVS*/ 00523000
         LA    @01,@AL00242                                        0242 00524000
         BAL   @14,ERRMSG                                          0242 00525000
*    RCODE = SIXTEEN; /*NO ROOM FOR ERROR RECORDS SO BETTER ABORT*/     00526000
         MVC   RCODE(4),@CF00075                                   0243 00527000
*  END;                                                    /*@G51DGVS*/ 00528000
*ELSE IF FRAMEYES = ON THEN /*IF SUCCESSFUL WRITE OF A FRAME THEN*/     00529000
         B     @RC00240                                            0245 00530000
@RF00240 TM    FRAMEYES,B'10000000'                                0245 00531000
         BNO   @RF00245                                            0245 00532000
*  ONEFRAME = ON; /*AT LEAST ONE FRAME ON LOGREC SUCCESSFULLY*/    0246 00533000
         OI    ONEFRAME,B'00100000'                                0246 00534000
*GOTO ENDOPROC; /*BOUNCE AROUND THE NON=SYNCHRONOUS ERROR EXIT*/   0247 00535000
         B     ENDOPROC                                            0247 00536000
*LOGERR:; /*NON-STRUCTURED ASYNCHRONOUS ERROR EXIT           @G51DGVS*/ 00537000
LOGERR   DS    0H                                                  0249 00538000
*IF TTRSAVE < THIRD THEN /*IF WRITING HEADER                 @G51DGVS*/ 00539000
         L     @15,TTRSAVE                                         0249 00540000
         C     @15,THIRD                                           0249 00541000
         BNL   @RF00249                                            0249 00542000
*  DO;                                                     /*@G51DGVS*/ 00543000
*    CALL ERRMSG(3);                                       /*@G51DGVS*/ 00544000
         LA    @01,@AL00251                                        0251 00545000
         BAL   @14,ERRMSG                                          0251 00546000
*    RCODE = 16;                                           /*@G51DGVS*/ 00547000
         MVC   RCODE(4),@CF00075                                   0252 00548000
*  END;                                                    /*@G51DGVS*/ 00549000
*ELSE /*ATTEMPTING TO WRITE FRAME                            @G51DGVS*/ 00550000
*  DO;                                                     /*@G51DGVS*/ 00551000
         B     @RC00249                                            0254 00552000
@RF00249 DS    0H                                                  0255 00553000
*    CALL ERRMSG(5);                                       /*@G51DGVS*/ 00554000
         LA    @01,@AL00255                                        0255 00555000
         BAL   @14,ERRMSG                                          0255 00556000
*    RCODE = 8;                                            /*@G51DGVS*/ 00557000
         MVC   RCODE(4),@CF00063                                   0256 00558000
*  END;                                                    /*@G51DGVS*/ 00559000
*ENDOPROC:;                                                /*@G51DGVS*/ 00560000
*END; /*END OF WRITE TO LOGREC PROC                          @G51DGVS*/ 00561000
@EL00005 DS    0H                                                  0259 00562000
@EF00005 DS    0H                                                  0259 00563000
@ER00005 LM    @14,@12,@SA00005                                    0259 00564000
         BR    @14                                                 0259 00565000
         EJECT                                                          00566000
*READSRF: PROC; /*READ SRF, IDENTIFY END OF FILE AND ERROR CONDITIONS*/ 00567000
READSRF  STM   @14,@12,@SA00006                                    0260 00568000
*IF RCODE = SUCCESS THEN DO;                               /*@VS48735*/ 00569000
         SLR   @15,@15                                             0261 00570000
         C     @15,RCODE                                           0261 00571000
         BNE   @RF00261                                            0261 00572000
* SRFIOBCC = ADDR(RDVERB); /*SET ADDRESS OF FUNCTION SELECT CCW     */  00573000
         LA    @14,RDVERB                                          0263 00574000
         ST    @14,SRFIOBCC                                        0263 00575000
* SRFECB = ZERO; /*CLEAR THE EVENT CONTROL BLOCK             @G51DGVS*/ 00576000
         ST    @15,SRFECB                                          0264 00577000
* RDADR  = READPTR + 24; /*PUT ADDR.OF READ BUFF.INTO CHANNEL PROGFRAM* 00578000
         L     @01,READPTR                                         0265 00579000
         LA    @01,24(,@01)                                        0265 00580000
         STCM  @01,7,RDADR                                         0265 00581000
* DO UNTIL POST ¬= INTERCPT;/*DO UNTIL REQUEST NOT INTERCEPTED-44*/     00582000
@DL00266 DS    0H                                                  0267 00583000
*   GENERATE REFS(SRFECB,SRFIOB);                          /*@G51DGVS*/ 00584000
         EXCP  SRFIOB      ISSUE SVC 0                                  00585000
         WAIT  ECB=SRFECB  WAIT UNTIL FRAME HAS BEEN READ               00586000
* END;                                                     /*@G51DGVS*/ 00587000
@DE00266 CLI   POST,X'44'                                          0268 00588000
         BE    @DL00266                                            0268 00589000
* IF POST ¬= OKAY THEN /*EITHER ERROR OR END OF FILE         @G51DGVS*/ 00590000
         CLI   POST,X'7F'                                          0269 00591000
         BE    @RF00269                                            0269 00592000
*   DO;                                                    /*@G51DGVS*/ 00593000
*     IF POST = EOFMAYBE THEN /*IF POST NON HARD ERROR       @G51DGVS*/ 00594000
         CLI   POST,X'41'                                          0271 00595000
         BNE   @RF00271                                            0271 00596000
*       DO;                                                /*@G51DGVS*/ 00597000
*         IF CHANEND = ON & /*IF CHANNEL END                 @G51DGVS*/ 00598000
*            DEVEND  = ON & /*IF DEVICE END                  @G51DGVS*/ 00599000
*            UNITEXCP = ON & /*IF UNIT EXCEPTION             @G51DGVS*/ 00600000
*            UNCHK = OFF THEN /*IF NOT A UNIT CHECK          @G51DGVS*/ 00601000
         TM    CHANEND,B'00001101'                                 0273 00602000
         BNO   @RF00273                                            0273 00603000
         TM    UNCHK,B'00000010'                                   0273 00604000
         BNZ   @RF00273                                            0273 00605000
*            RCODE = FOUR; /*LEGITIMATE END OF FILE          @G51DGVS*/ 00606000
         MVC   RCODE(4),@CF00073                                   0274 00607000
*         ELSE /*ILLEGITIMATE                                @G51DGVS*/ 00608000
*           DO;                                            /*@G51DGVS*/ 00609000
         B     @RC00273                                            0275 00610000
@RF00273 DS    0H                                                  0276 00611000
*             RCODE = EIGHT; /*UNSUCCESSFUL FRAME READ       @G51DGVS*/ 00612000
         MVC   RCODE(4),@CF00063                                   0276 00613000
*             CALL ERRMSG(7);                              /*@G51DGVS*/ 00614000
         LA    @01,@AL00277                                        0277 00615000
         BAL   @14,ERRMSG                                          0277 00616000
*           END;                                           /*@G51DGVS*/ 00617000
*       END;                                               /*@G51DGVS*/ 00618000
*     ELSE /*HARD ERROR BY DEFAULT                           @G51DGVS*/ 00619000
*       DO;                                                /*@G51DGVS*/ 00620000
         B     @RC00271                                            0280 00621000
@RF00271 DS    0H                                                  0281 00622000
*         RCODE = EIGHT;                                   /*@G51DGVS*/ 00623000
         MVC   RCODE(4),@CF00063                                   0281 00624000
*         CALL ERRMSG(7);                                  /*@G51DGVS*/ 00625000
         LA    @01,@AL00282                                        0282 00626000
         BAL   @14,ERRMSG                                          0282 00627000
*       END;                                               /*@G51DGVS*/ 00628000
*   END;                                                   /*@G51DGVS*/ 00629000
*END;                                      /* END OF READ    @VS48735*/ 00630000
*END; /*END OF PROC READSRF                                  @G51DGVS*/ 00631000
@EL00006 DS    0H                                                  0286 00632000
@EF00006 DS    0H                                                  0286 00633000
@ER00006 LM    @14,@12,@SA00006                                    0286 00634000
         BR    @14                                                 0286 00635000
*VERBPROC:  PROC;         /* PERFORM VERBAGE CCW AND TEST FOR ERROR */  00636000
VERBPROC STM   @14,@12,@SA00007                                    0287 00637000
*IF FRAMTYPS = CCF THEN                                            0288 00638000
         CLI   FRAMTYPS,X'01'                                      0288 00639000
         BNE   @RF00288                                            0288 00640000
*  SRFIOBF1 = '02'X;                                       /*@VS48735*/ 00641000
         MVI   SRFIOBF1,X'02'                                      0289 00642000
*SRFIOBCC = ADDR(VERBAGE);         /* SET ADDR OF VERBAGE CCW        */ 00643000
@RF00288 LA    @15,VERBAGE                                         0290 00644000
         ST    @15,SRFIOBCC                                        0290 00645000
*SRFECB = ZERO;                    /* CLEAR EVENT CTRL BLOCK @VS48735*/ 00646000
         SLR   @15,@15                                             0291 00647000
         ST    @15,SRFECB                                          0291 00648000
*DO UNTIL POST ¬= INTERCPT;        /* LOOP UNTIL REQUEST NOT INTRCPTD*/ 00649000
@DL00292 DS    0H                                                  0293 00650000
*  GENERATE REFS(SRFECB,SRFIOB);                           /*@VS48735*/ 00651000
         EXCP  SRFIOB              ISSUE EXCP                           00652000
         WAIT  ECB=SRFECB          WAIT UNTIL ECB IS POSTED             00653000
*END;                                                      /*@VS48735*/ 00654000
@DE00292 CLI   POST,X'44'                                          0294 00655000
         BE    @DL00292                                            0294 00656000
*IF POST ¬= OKAY THEN              /* IF FRAME READ FAILED   @VS48735*/ 00657000
         CLI   POST,X'7F'                                          0295 00658000
         BE    @RF00295                                            0295 00659000
*  DO;                                                     /*@VS48735*/ 00660000
*    CALL ERRMSG(12);                                      /*@VS48735*/ 00661000
         LA    @01,@AL00297                                        0297 00662000
         BAL   @14,ERRMSG                                          0297 00663000
*    RCODE = EIGHT;                                        /*@VS48735*/ 00664000
         MVC   RCODE(4),@CF00063                                   0298 00665000
*  END;                                                    /*@VS48735*/ 00666000
*END;                              /* END OF VERBPROC PROC   @VS48735*/ 00667000
@EL00007 DS    0H                                                  0300 00668000
@EF00007 DS    0H                                                  0300 00669000
@ER00007 LM    @14,@12,@SA00007                                    0300 00670000
         BR    @14                                                 0300 00671000
*ERRMSG: PROC(MSGNO); /*WRITE TO THE OPERATOR ERROR MESSAGES AND*/ 0301 00672000
ERRMSG   STM   @14,@12,@SA00008                                    0301 00673000
         MVC   @PC00008(4),0(@01)                                  0301 00674000
*                     /*END OF JOB TEXT                      @G51DGVS*/ 00675000
*DCL MSGNO FIXED(31); /*MESSAGE NUMBER PASSED TO THIS PROC   @G51DGVS*/ 00676000
*IF MSGNO = 1 THEN                                                 0303 00677000
         L     @15,@PC00008                                        0303 00678000
         CLC   MSGNO(4,@15),@CF00054                               0303 00679000
         BNE   @RF00303                                            0303 00680000
*  DO;                                                     /*@G51DGVS*/ 00681000
*    CALL BUILDTXT; /*MODIFY WTO MESSAGE TEXT                @G51DGVS*/ 00682000
         BAL   @14,BUILDTXT                                        0305 00683000
*    GENERATE;                                             /*@G51DGVS*/ 00684000
* MSG ALIGNMENT=         *+19   *+26 *+31       *+42       *+53         00685000
         CNOP  0,4                      ALIGN MODIFIED TEXT             00686000
COMPLETE WTO   'IFC001I  D=XXXX N=0Y F=CCCCHHHH L=CCCCHHHH S=CCCCHHHH02X00687000
                DIP COMPLETE',ROUTCDE=(1),DESC=(6)                      00688000
*  END; /*END OF GENERATING MESSAGE 1                        @G51DGVS*/ 00689000
*ELSE /*NOT MESSAGE ONE                                      @G51DGVS*/ 00690000
*  DO;                                                     /*@G51DGVS*/ 00691000
         B     @RC00303                                            0308 00692000
@RF00303 DS    0H                                                  0309 00693000
*    IF MSGNO = 2 THEN                                             0309 00694000
         L     @15,@PC00008                                        0309 00695000
         CLC   MSGNO(4,@15),@CF00098                               0309 00696000
         BNE   @RF00309                                            0309 00697000
*      DO;                                                 /*@G51DGVS*/ 00698000
*        GENERATE;                                         /*@G51DGVS*/ 00699000
         WTO   'IFC002I SYS1.LOGREC CANNOT BE OPENED',ROUTCDE=(1),     X00700000
               DESC=(6)                                                 00701000
*      END;                                                /*@G51DGVS*/ 00702000
*    ELSE /*NOT 1 NOR 2                                      @G51DGVS*/ 00703000
*      DO;                                                 /*@G51DGVS*/ 00704000
         B     @RC00309                                            0313 00705000
@RF00309 DS    0H                                                  0314 00706000
*        IF MSGNO = 3 THEN                                         0314 00707000
         L     @15,@PC00008                                        0314 00708000
         CLC   MSGNO(4,@15),@CF00095                               0314 00709000
         BNE   @RF00314                                            0314 00710000
*          DO;                                             /*@G51DGVS*/ 00711000
*            RCODE = SIXTEEN; /*PREVENT FURTHER PROCESSING   @G51DGVS*/ 00712000
         MVC   RCODE(4),@CF00075                                   0316 00713000
*            GENERATE;                                     /*@G51DGVS*/ 00714000
         WTO   'IFC003I SYS1.LOGREC HEADER WRITE ERROR',ROUTCDE=(1),   X00715000
               DESC=(6)                                                 00716000
*          END;                                            /*@G51DGVS*/ 00717000
*        ELSE /*NOT 1,2,3                                    @G51DGVS*/ 00718000
*          DO;                                             /*@G51DGVS*/ 00719000
         B     @RC00314                                            0319 00720000
@RF00314 DS    0H                                                  0320 00721000
*            IF MSGNO = 5 THEN                                     0320 00722000
         L     @15,@PC00008                                        0320 00723000
         CLC   MSGNO(4,@15),@CF00244                               0320 00724000
         BNE   @RF00320                                            0320 00725000
*              DO;                                         /*@G51DGVS*/ 00726000
*              GENERATE;                                   /*@G51DGVS*/ 00727000
         WTO   'IFC005I SYS1.LOGREC FRAME WRITE ERROR',ROUTCDE=(1),    X00728000
               DESC=(6)                                                 00729000
*              END;                                        /*@G51DGVS*/ 00730000
*            ELSE /*NOT 1,2,3,5                              @G51DGVS*/ 00731000
*              DO;                                         /*@G51DGVS*/ 00732000
         B     @RC00320                                            0324 00733000
@RF00320 DS    0H                                                  0325 00734000
*                IF MSGNO = 4 THEN                                 0325 00735000
         L     @15,@PC00008                                        0325 00736000
         CLC   MSGNO(4,@15),@CF00073                               0325 00737000
         BNE   @RF00325                                            0325 00738000
*                  DO;                                     /*@G51DGVS*/ 00739000
*                    GENERATE;                             /*@G51DGVS*/ 00740000
         WTO   'IFC004I SYS1.LOGREC ALLOCATION TOO SMALL FOR FRAMES',  X00741000
               ROUTCDE=(1),DESC=(6)                                     00742000
*                  END;                                    /*@G51DGVS*/ 00743000
*                ELSE /*NOT 1,2,3,4,5                        @G51DGVS*/ 00744000
*                  DO;                                     /*@G51DGVS*/ 00745000
         B     @RC00325                                            0329 00746000
@RF00325 DS    0H                                                  0330 00747000
*                    IF MSGNO = 6 THEN                             0330 00748000
         L     @15,@PC00008                                        0330 00749000
         CLC   MSGNO(4,@15),@CF00068                               0330 00750000
         BNE   @RF00330                                            0330 00751000
*                      DO;                                 /*@G51DGVS*/ 00752000
*                      GENERATE;                           /*@G51DGVS*/ 00753000
         WTO   'IFC006I SRF CANNOT BE OPENED',ROUTCDE=(1),DESC=(6)      00754000
*                      END;                                /*@G51DGVS*/ 00755000
*                    ELSE /*NOT 1,2,3,4,5, OR 6              @G51DGVS*/ 00756000
*                      DO;                                 /*@G51DGVS*/ 00757000
         B     @RC00330                                            0334 00758000
@RF00330 DS    0H                                                  0335 00759000
*                        IF MSGNO = 7 THEN                         0335 00760000
         L     @15,@PC00008                                        0335 00761000
         CLC   MSGNO(4,@15),@CF00241                               0335 00762000
         BNE   @RF00335                                            0335 00763000
*                          DO;                             /*@G51DGVS*/ 00764000
*                            CALL FILLMESS; /*FILL IN SPECIFICS OF MES* 00765000
         BAL   @14,FILLMESS                                        0337 00766000
*                            GENERATE;                     /*@G51DGVS*/ 00767000
SRFWTO   WTO   'IFC007I SRF READ ERROR SENSE=SSSS,CSW=CCCCCCCCCCCCCC,DDX00768000
               =FRAME   ',ROUTCDE=(1),DESC=(6)                          00769000
*                          END;                            /*@G51DGVS*/ 00770000
*                        ELSE /*NOT 1,2,3,4,5,6,7            @G51DGVS*/ 00771000
*                          DO;                             /*@G51DGVS*/ 00772000
         B     @RC00335                                            0340 00773000
@RF00335 DS    0H                                                  0341 00774000
*                            IF MSGNO = 8 THEN                     0341 00775000
         L     @15,@PC00008                                        0341 00776000
         CLC   MSGNO(4,@15),@CF00063                               0341 00777000
         BNE   @RF00341                                            0341 00778000
*                              DO;                         /*@G51DGVS*/ 00779000
*                              GENERATE;                   /*@G51DGVS*/ 00780000
         WTO   'IFC008I MORE THAN 50 FRAMES IN SET',ROUTCDE=(1),       *00781000
               DESC=(6)                                                 00782000
*                              END;                        /*@G51DGVS*/ 00783000
*                            ELSE /*NOT 1,2,3,4,5,6,7,8      @G51DGVS*/ 00784000
*                              DO;                         /*@G51DGVS*/ 00785000
         B     @RC00341                                            0345 00786000
@RF00341 DS    0H                                                  0346 00787000
*                                IF MSGNO = 9 THEN                 0346 00788000
         L     @15,@PC00008                                        0346 00789000
         CLC   MSGNO(4,@15),@CF00296                               0346 00790000
         BNE   @RF00346                                            0346 00791000
*                                  DO;                     /*@G51DGVS*/ 00792000
*                                  RCODE = SIXTEEN; /*ABORT  @G51DGVS*/ 00793000
         MVC   RCODE(4),@CF00075                                   0348 00794000
*                                  GENERATE;               /*@G51DGVS*/ 00795000
         WTO   'IFC009I INVALID SYSTEM RESIDENCE DEVICE',ROUTCDE=(1),  X00796000
               DESC=(6)                                                 00797000
*                                  END;                    /*@G51DGVS*/ 00798000
*                                ELSE /*NOT 1,2,3,4,5,6,7,8,9*/    0351 00799000
*                                  DO;                     /*@G51DGVS*/ 00800000
         B     @RC00346                                            0351 00801000
@RF00346 DS    0H                                                  0352 00802000
*                                    IF MSGNO = 10 THEN            0352 00803000
         L     @15,@PC00008                                        0352 00804000
         CLC   MSGNO(4,@15),@CF00032                               0352 00805000
         BNE   @RF00352                                            0352 00806000
*                                      DO;                 /*@G51DGVS*/ 00807000
*                                      GENERATE;           /*@G51DGVS*/ 00808000
         WTO   'IFC155I FRAME SET MISSING',ROUTCDE=(1),DESC=(6)         00809000
*                                      END;                /*@G51DGVS*/ 00810000
*                                    ELSE IF MSGNO = 11 THEN       0356 00811000
         B     @RC00352                                            0356 00812000
@RF00352 L     @15,@PC00008                                        0356 00813000
         CLC   MSGNO(4,@15),@CF00033                               0356 00814000
         BNE   @RF00356                                            0356 00815000
*                                      DO;                 /*@G51DGVS*/ 00816000
*                                      GENERATE;           /*@G51DGVS*/ 00817000
         WTO   'IFC156I INVALID PARM FIELD',ROUTCDE=(1),DESC=(6)        00818000
*                                      END;                /*@G51DGVS*/ 00819000
*                                  END;                    /*@G51DGVS*/ 00820000
@RF00356 DS    0H                                                  0360 00821000
@RC00352 DS    0H                                                  0361 00822000
*                              END;                        /*@G51DGVS*/ 00823000
@RC00346 DS    0H                                                  0362 00824000
*                          END;                            /*@G51DGVS*/ 00825000
@RC00341 DS    0H                                                  0363 00826000
*                      END;                                /*@G51DGVS*/ 00827000
@RC00335 DS    0H                                                  0364 00828000
*                  END;                                    /*@G51DGVS*/ 00829000
@RC00330 DS    0H                                                  0365 00830000
*              END;                                        /*@G51DGVS*/ 00831000
@RC00325 DS    0H                                                  0366 00832000
*          END;                                            /*@G51DGVS*/ 00833000
@RC00320 DS    0H                                                  0367 00834000
*      END;                                                /*@G51DGVS*/ 00835000
@RC00314 DS    0H                                                  0368 00836000
*   END;                                                   /*@G51DGVS*/ 00837000
@RC00309 DS    0H                                                  0369 00838000
* IF MSGNO = TWELVE THEN                                           0369 00839000
@RC00303 L     @15,@PC00008                                        0369 00840000
         CLC   MSGNO(4,@15),@CF00034                               0369 00841000
         BNE   @RF00369                                            0369 00842000
*   DO;                                                    /*@G51DGVS*/ 00843000
*     GENERATE;                                            /*@G51DGVS*/ 00844000
         WTO   'IFC157I VERBAGE FAILURE',ROUTCDE=(1),DESC=(6)           00845000
*   END;                                                   /*@G51DGVS*/ 00846000
*END; /*END OF PROC ERRMSG                                   @G51DGVS*/ 00847000
@EL00008 DS    0H                                                  0373 00848000
@EF00008 DS    0H                                                  0373 00849000
@ER00008 LM    @14,@12,@SA00008                                    0373 00850000
         BR    @14                                                 0373 00851000
*FILLMESS: PROC; /*INSERT SENSE BYTES, CSW, AND DDNAME INTO  @G51DGVS*/ 00852000
FILLMESS STM   @14,@12,@SA00009                                    0374 00853000
*                /*ERROR MESSAGE NUMBER SEVEN                @G51DGVS*/ 00854000
*RESPECIFY (R2,R3,R5) RESTRICTED;                          /*@G51DGVS*/ 00855000
*R5 = ADDR(SRFIOBS1); /*ADDRESS OF SENSE BYTE ONE FROM IOB   @G51DGVS*/ 00856000
         LA    R5,SRFIOBS1                                         0376 00857000
*R2 = ADDR(DSENSE);   /*LOCATION TO BE PLACED IN GENERATED WTO*/   0377 00858000
         LA    R2,DSENSE                                           0377 00859000
*R3 = FOUR;           /*NUMBER OF PRINTABLE CHARACTERS       @G51DGVS*/ 00860000
         LA    R3,4                                                0378 00861000
*CALL UNPACK;            /*ROUTINE TO CONVERT TO PRINTABLE CHARACTERS*/ 00862000
         BAL   @14,UNPACK                                          0379 00863000
*R5 = ADDR(SRFIOBCS); /*ADDRESS OF LOW ORDER 7 BYTES OF CSW  @G51DGVS*/ 00864000
         LA    R5,SRFIOBCS                                         0380 00865000
*R2 = ADDR(DCSW);     /*LOCATION TO BE PLACED IN GENERATED WTO*/   0381 00866000
         LA    R2,DCSW                                             0381 00867000
*R3 = EIGHT;          /*NUMBER OF PRINTABLE CHARACTERS       @G51DGVS*/ 00868000
         LA    R3,8                                                0382 00869000
*CALL UNPACK;            /*CONVERT                           @G51DGVS*/ 00870000
         BAL   @14,UNPACK                                          0383 00871000
*R5 = ADDR(SRFIOBCS) + 4; /* ADDR OF LAST THREE BYTES OF CSW @G51DGVS*/ 00872000
         LA    R5,SRFIOBCS                                         0384 00873000
         AL    R5,@CF00073                                         0384 00874000
*R2 = ADDR(DCSW2);    /*WHERE PLACED IN WTO MESSAGE          @G51DGVS*/ 00875000
         LA    R2,DCSW2                                            0385 00876000
*R3 = SIX;          /*3 BYTES LEFT TO BE CONVERTED           @G51DGVS*/ 00877000
         LA    R3,6                                                0386 00878000
*CALL UNPACK;           /*CONVERT                            @G51DGVS*/ 00879000
         BAL   @14,UNPACK                                          0387 00880000
*RESPECIFY (R2,R3,R5) UNRESTRICTED;                        /*@G51DGVS*/ 00881000
*END;  /*END OF PROC FILLMESS                                @G51DGVS*/ 00882000
@EL00009 DS    0H                                                  0389 00883000
@EF00009 DS    0H                                                  0389 00884000
@ER00009 LM    @14,@12,@SA00009                                    0389 00885000
         BR    @14                                                 0389 00886000
*GETSER: PROC; /*RETRIEVE AND FORMAT CPU SERIAL NUMBER AND CPU VERSION* 00887000
GETSER   STM   @14,@12,@SA00010                                    0390 00888000
*GENERATE REFS(STCPUID);                                   /*@G51DGVS*/ 00889000
         MODESET MODE=SUP     CHANGE FROM PROBLEM TO SUPERVISOR STATE   00890000
*                             MUST BE AUTHORIZED PROGRAM                00891000
         STIDP STCPUID        ISSUE STORE CPU-ID                        00892000
         MODESET MODE=PROB    CHANGE BACK TO PROBLEM PROGRAM STATE      00893000
*END; /*END OF PROC GETSER                                   @G51DGVS*/ 00894000
@EL00010 DS    0H                                                  0392 00895000
@EF00010 DS    0H                                                  0392 00896000
@ER00010 LM    @14,@12,@SA00010                                    0392 00897000
         BR    @14                                                 0392 00898000
*OPENSRF: PROC; /*ISSUE OPEN AND ENABLE FOR SRF              @G51DGVS*/ 00899000
OPENSRF  STM   @14,@12,@SA00011                                    0393 00900000
*GEN(OI   SRFDCB+49,X'0C'   SET IFLAGS);                   /*@ZA32455*/ 00901000
         OI   SRFDCB+49,X'0C'   SET IFLAGS                              00902000
*GEN(OPEN (SRFDCB,INPUT)); /*ISSUE OPEN MACRO                @G51DGVS*/ 00903000
         OPEN (SRFDCB,INPUT)                                            00904000
*IF (SRFDCBFL & OPENOK) ¬= OPENOK THEN /*IF OPEN WAS NOT SUCCESSFUL*/   00905000
         MVC   @TS00001(1),SRFDCBFL                                0396 00906000
         NI    @TS00001,X'10'                                      0396 00907000
         CLI   @TS00001,X'10'                                      0396 00908000
         BE    @RF00396                                            0396 00909000
*  RCODE = TWELVE; /*INDICATE NO FRAMES CAN BE RETRIEVED     @G51DGVS*/ 00910000
         MVC   RCODE(4),@CF00034                                   0397 00911000
*ELSE /*SUCCESSFUL OPEN                                      @G51DGVS*/ 00912000
* DO;                                                      /*@G51DGVS*/ 00913000
         B     @RC00396                                            0398 00914000
@RF00396 DS    0H                                                  0399 00915000
*   /*POST IS INITIALIZED TO 00                              @G51DGVS*/ 00916000
*   /*SRFIOBF1 INDICATING NEITHER COMMAND NOR DATA CHAINING IS ZERO*/   00917000
*   /*SRFIOBCC POINTS TO THE ENABLE CHANNEL PROGRAM          @G51DGVS*/ 00918000
*   DO UNTIL POST ¬= INTERCPT; /*LOOP UNTIL IO REQUEST HAS NOT BEEN*/   00919000
@DL00399 DS    0H                                                  0400 00920000
*                              /*INTERCEPTED                 @G51DGVS*/ 00921000
*     GENERATE REFS(SRFIOB,SRFECB);                        /*@G51DGVS*/ 00922000
         EXCP  SRFIOB         ISSUE SVC 0                               00923000
         WAIT  ECB=SRFECB     WAIT UNTIL ENABLE HAS BEEN SUCCESSFUL     00924000
*   END;                                                   /*@G51DGVS*/ 00925000
@DE00399 CLI   POST,X'44'                                          0401 00926000
         BE    @DL00399                                            0401 00927000
*   IF POST ¬= OKAY THEN  /*IF POST NOT 7F THEN ENABLE FAILED*/    0402 00928000
         CLI   POST,X'7F'                                          0402 00929000
         BE    @RF00402                                            0402 00930000
*     RCODE = TWELVE;                                      /*@G51DGVS*/ 00931000
         MVC   RCODE(4),@CF00034                                   0403 00932000
* END;                                                     /*@G51DGVS*/ 00933000
*END; /*END OF PROC OPENSRF                                  @G51DGVS*/ 00934000
@EL00011 DS    0H                                                  0405 00935000
@EF00011 DS    0H                                                  0405 00936000
@ER00011 LM    @14,@12,@SA00011                                    0405 00937000
         BR    @14                                                 0405 00938000
*CLOSESRF: PROC; /*DISABLE AND CLOSE THE SRF                 @G51DGVS*/ 00939000
CLOSESRF STM   @14,@12,@SA00012                                    0406 00940000
*    SRFIOBF1 = '00'X; /*SPECIFY TYPE OF CHANNEL PROGRAM IN IOB*/  0407 00941000
         MVI   SRFIOBF1,X'00'                                      0407 00942000
*    SRFIOBCC = ADDR(DISABLE); /*LOCATE CHANNEL PROGRAM FOR IOB*/  0408 00943000
         LA    @15,DISABLE                                         0408 00944000
         ST    @15,SRFIOBCC                                        0408 00945000
*    SRFECB = ZERO; /*ZERO EVENT CONTROL BLOCK               @G51DGVS*/ 00946000
         SLR   @15,@15                                             0409 00947000
         ST    @15,SRFECB                                          0409 00948000
*    DO UNTIL POST ¬= INTERCPT; /*LOOP UNTIL IO REQUEST HAS NOT BEEN*/  00949000
@DL00410 DS    0H                                                  0411 00950000
*                            /*INTERCEPTED                   @G51DGVS*/ 00951000
*      GENERATE REFS(SRFIOB,SRFECB);                       /*@G51DGVS*/ 00952000
         EXCP  SRFIOB    ISSUE SVC 0                                    00953000
         WAIT  ECB=SRFECB  WAIT UNTIL DISABLE IS SUCCESSFULL. DONT      00954000
*                          CHECK IF FAILS WHO CARES                     00955000
*    END;                                                  /*@G51DGVS*/ 00956000
@DE00410 CLI   POST,X'44'                                          0412 00957000
         BE    @DL00410                                            0412 00958000
*    GEN(CLOSE (SRFDCB,LEAVE)); /*CLOSE SRF DEVICE           @G51DGVS*/ 00959000
         CLOSE (SRFDCB,LEAVE)                                           00960000
*   END; /*END OF PROC CLOSESRF                              @G51DGVS*/ 00961000
@EL00012 DS    0H                                                  0414 00962000
@EF00012 DS    0H                                                  0414 00963000
@ER00012 LM    @14,@12,@SA00012                                    0414 00964000
         BR    @14                                                 0414 00965000
*BUILDFRH: PROC; /*BUILD CONSTANT PORTION OF FRAME HEADER    @G51DGVS*/ 00966000
BUILDFRH STM   @14,@12,@SA00013                                    0415 00967000
*RESPECIFY (R0,R1) RESTRICTED;                             /*@G51DGVS*/ 00968000
*PACK(HOLD,CVTRELNO); /*PACK EBCDIC RELEASE NUMBER           @G51DGVS*/ 00969000
         LA    @15,16                                              0417 00970000
         L     @15,CVTBASE(,@15)                                   0417 00971000
         AL    @15,@CF00358                                        0417 00972000
         PACK  HOLD(8),CVTRELNO-2(2,@15)                           0417 00973000
*CVB(RECSYSS,HOLD); /*PLACE BINARY RELEASE IN THE HEADING    @G51DGVS*/ 00974000
         CVB   @15,HOLD                                            0418 00975000
         STC   @15,RECSYSS                                         0418 00976000
*GENERATE;                                                 /*@G51DGVS*/ 00977000
         TIME  DEC                     ISSUE TIME MACRO                 00978000
*        RECTIME = R0; /*GET HH MM SS TH TIME                @G51DGVS*/ 00979000
         STCM  R0,15,RECTIME                                       0420 00980000
*        RECDAT  = R1; /*GET 00YYDDDC FROM TIME MACRO        @G51DGVS*/ 00981000
         STCM  R1,15,RECDAT                                        0421 00982000
*RESPECIFY (R0,R1) UNRESTRICTED;                           /*@G51DGVS*/ 00983000
*        IF (CVTDCB & '22'X) = '22'X THEN /*IF VS1 AND DYN.ADR.TRANS*/  00984000
         LA    @01,16                                              0423 00985000
         L     @01,CVTBASE(,@01)                                   0423 00986000
         MVC   @TS00001(1),CVTDCB(@01)                             0423 00987000
         NI    @TS00001,X'22'                                      0423 00988000
         CLI   @TS00001,X'22'                                      0423 00989000
         BNE   @RF00423                                            0423 00990000
*          RECSYS = (RECSYS | '40'X);  /*SET VS1 BITS ON     @G51DGVS*/ 00991000
         OI    RECSYS,X'40'                                        0424 00992000
*        IF (CVTDCB & '12'X) = '12'X |    /*IF MVS OR SVS AND DY.ADR*/  00993000
*           (CVTDCB & '11'X) = '11'X THEN /*IF MVS           @G51DGVS*/ 00994000
@RF00423 LA    @01,16                                              0425 00995000
         L     @15,CVTBASE(,@01)                                   0425 00996000
         MVC   @TS00001(1),CVTDCB(@15)                             0425 00997000
         NI    @TS00001,X'12'                                      0425 00998000
         CLI   @TS00001,X'12'                                      0425 00999000
         BE    @RT00425                                            0425 01000000
         MVC   @TS00001(1),CVTDCB(@15)                             0425 01001000
         NI    @TS00001,X'11'                                      0425 01002000
         CLI   @TS00001,X'11'                                      0425 01003000
         BNE   @RF00425                                            0425 01004000
@RT00425 DS    0H                                                  0426 01005000
*          RECSYS = (RECSYS | '80'X);  /*SET VS2 BITS ON     @G51DGVS*/ 01006000
         OI    RECSYS,X'80'                                        0426 01007000
*        RECCPU = STCPUID; /*PUT CPU VERSION, CPU MODEL ,CPU SERIAL, */ 01008000
@RF00425 MVC   RECCPU(8),STCPUID                                   0427 01009000
*                         /*AND MAXIMUM EXTENDED LOGOUT LENGTH IN HDR*/ 01010000
*END; /*END OF PROC BUILDFRH                                 @G51DGVS*/ 01011000
@EL00013 DS    0H                                                  0428 01012000
@EF00013 DS    0H                                                  0428 01013000
@ER00013 LM    @14,@12,@SA00013                                    0428 01014000
         BR    @14                                                 0428 01015000
*REDOHDR:PROC; /*RECREATE HEADER TO REFLECT FRAMES           @G51DGVS*/ 01016000
REDOHDR  STM   @14,@12,@SA00014                                    0429 01017000
*RESPECIFY (R0,R1,R2,R3,R14,R15) RESTRICTED;               /*@G51DGVS*/ 01018000
*R0 = TTRSAVE; /*LOAD ADDRESS OF LAST WRITTEN RECORD         @G51DGVS*/ 01019000
         L     R0,TTRSAVE                                          0431 01020000
*R2 = ADDR(MBBCCHHR); /*PASS CORE LOCATION FOR ABSOLUTE ADDRESS*/  0432 01021000
         LA    R2,MBBCCHHR                                         0432 01022000
*R15 = CVTPCNVT; /*LOAD ADDRESS OF CONVERSION ROUTINE        @G51DGVS*/ 01023000
         LA    @09,16                                              0433 01024000
         L     @09,CVTBASE(,@09)                                   0433 01025000
         L     R15,CVTPCNVT(,@09)                                  0433 01026000
*GENERATE;                                                 /*@G51DGVS*/ 01027000
         LA    1,DIPDCB   PUT SERERDS DCB ADDRESS IN REG 1              01028000
         L     1,DCBDEBAD(1) LOAD DATA EXTENT BLOCK ADDRESS FROM DCB    01029000
         LA    3,MYSAVE   ADDRESS MYSAVE WITHOUT NORMAL BASE REGISTER   01030000
         STM   9,13,0(3)  SAVE REGISTERS USED BY CONVERSION ROUTINE     01031000
         BALR  14,15      LINK TO RELATIVE TO ABSOLUTE D.A. CONV. ROUT. 01032000
         LM    9,13,0(3)  RESTORE DIP REGISTERS                         01033000
*RESPECIFY (R0,R1,R2,R3,R14,R15) UNRESTRICTED;             /*@G51DGVS*/ 01034000
*GENERATE REFS(BBCCHHR);                                   /*@G51DGVS*/ 01035000
         MVC   RESTAREA(L7),BBCCHHR   RESTART ADDRESS IN HEADER         01036000
         MVC   LASTREU(L7),RESTAREA  LAST RECORD WRITTEN LOCATION       01037000
         MVC   BYTREM(L2),ARBSMALL   BYTES REMAINING ON LAST FRAME TRK  01038000
         OI    SWITCHES,HDFRSW       SET FRAMES EXIST SWITCH            01039000
*END; /*END OF PROC REDOHDR                                  @G51DGVS*/ 01040000
@EL00014 DS    0H                                                  0437 01041000
@EF00014 DS    0H                                                  0437 01042000
@ER00014 LM    @14,@12,@SA00014                                    0437 01043000
         BR    @14                                                 0437 01044000
*GETDEV: PROC;                                             /*@G51DGVS*/ 01045000
GETDEV   STM   @14,@12,@SA00015                                    0438 01046000
*RESPECIFY (R2,R4,R5,R6,R7) RESTRICTED;                    /*@G51DGVS*/ 01047000
*GENERATE REFS(BADRES,ENDGETDV);                           /*@G51DGVS*/ 01048000
*****************************************************************       01049000
*  THIS SECTION OBTAINS TABLE DATA CORRESPONDING TO THE         *       01050000
*  SPECIFIED DEVICE CODE. DEVICE CODE IS OBTAINED FROM THE      *       01051000
*  DCB FIELD DCBDEVT (DCB+17).                                  *       01052000
*****************************************************************       01053000
         MVC   DEVTYPE(L1),DCBDEVT      DEVICE TYPE CODE                01054000
         LA    WORK1,DEVTAB             DEVICE DATA TABLE               01055000
SEARCH   CLC   DEVTYPE(L1),L0(WORK1)    LOOK FOR ENTRY FOR DEVICE       01056000
         BE    SRCHFIN                  BR--SEARCH SUCCESSFUL           01057000
         LA    WORK1,L14(WORK1)         UPDATE FOR NEXT DEVICE          01058000
         CLI   L0(WORK1),CB            IS THIS THE END OF THE TABLE     01059000
         BE    BADRES                   BR--IMPROPER DEVICE             01060000
         B     SEARCH                   NEXT ENTRY                      01061000
SRCHFIN  NI    DEVTYPE,DEVMASK          AND OUT HIGH DIGITS             01062000
         LR    DEVTABLE,WORK1           DEVICE TABLE REGISTER           01063000
*********************************************************************** 01064000
*   THIS SECTION FORMATS HEADER RECORD INFORMATION RETRIEVED FROM     * 01065000
*   DEVTABLE AND THE DEB FOR SYS1.LOGREC                              * 01066000
*********************************************************************** 01067000
         LA    WORK1,DIPDCB             DCB ADDRESS                     01068000
         L     WORK6,DCBDEBAD(WORK1)    DEB ADDRESS                     01069000
BLDHDR   MVC   EXTENT(L8),DEBSTR(WORK6) EXTENT OF SYS1.LOGREC           01070000
         MVC   BUFFER(L2),DEBNMTRK(WORK6) TOTAL TRACKS IN EXTENT        01071000
*********************************************************************** 01072000
*THIS CODE ADDED TO ENSURE THAT DO NOT ATTEMPT TO WRITE PAST            01073000
*SYS1.LOGREC EXTENT WHEN WRITING FRAMES TO SYS1.LOGREC                  01074000
         XR    WORK3,WORK3                                              01075000
         LH    WORK4,BT(DEVTABLE)      LOAD BYTES PER TRACK,SYSRES      01076000
         D     WORK3,BYTPFRM    DIVIDE BY BYTES PER FRAME PLUS IRG      01077000
         LH    WORK3,DEBNMTRK(WORK6)   GET TOTAL TRACKS IN LOGREC       01078000
         BCTR  WORK3,0         CHANGE TO RELATIVE TRACK NUMBER          01079000
         BCTR  WORK3,0         MAKE ROOM FOR DUMMY END OF FILE          01080000
         SLL   WORK3,16        MOVE TO HIGH ORDER HALF WORD IN REG      01081000
         SLL   WORK4,8         MOVE FRAMES PER TRACK TO REL. R LOC.     01082000
         OR    WORK3,WORK4     ASSEMBLE MAXIMUM TTR0 IN WORK3           01083000
         ST    WORK3,MAXTTR    SAVE FOR COMPARE WHILE WRITING           01084000
*CODE ABOVE CREATES ARTIFICIAL TTR0 FOR COMPARE TO NOTE RESULT          01085000
         MVC   TRKPERCY(L2),TC(DEVTABLE) TRACKS/CYLINDER                01086000
         MVC   BYTREM(L2),BTFT(DEVTABLE) BYTES REMAINING ON TRACK       01087000
         MVC   BYTONTRK(L2),BT(DEVTABLE) TOTAL BYTES ON TRACK           01088000
         MVC   DEVCODE(L1),DEVTYPE      DEVICE CODE                     01089000
         MVI   CHKBYTE,CB               CHECK BYTE                      01090000
         MVI   MSGCNT,HEX00      LOGREC FULL MSG COUNT                  01091000
         ST    DEVTABLE,DEVSTORE SAVE DEVICE TABLE ENTRY ADDRESS        01092000
         ST    WORK6,DEBADR      SAVE DATA EXTENT BLOCK ADDRESS         01093000
         B     ENDGETDV          GO TO END OF THE PROC                  01094000
*BADRES:;                                                  /*@G51DGVS*/ 01095000
BADRES   DS    0H                                                  0442 01096000
*        CALL ERRMSG(9);   /* IDENTIFY ILLEGAL SYSRES DEVICE @G51DGVS*/ 01097000
         LA    @01,@AL00442                                        0442 01098000
         BAL   @14,ERRMSG                                          0442 01099000
*        RCODE = SIXTEEN; /*DONT FORMAT SYS1.LOGREC          @G51DGVS*/ 01100000
         MVC   RCODE(4),@CF00075                                   0443 01101000
*ENDGETDV:;                                                /*@G51DGVS*/ 01102000
*RESPECIFY (R2,R4,R5,R6,R7) UNRESTRICTED;                  /*@G51DGVS*/ 01103000
*END; /*END OF PROC GETDEV                                   @G51DGVS*/ 01104000
@EL00015 DS    0H                                                  0446 01105000
@EF00015 DS    0H                                                  0446 01106000
@ER00015 LM    @14,@12,@SA00015                                    0446 01107000
         BR    @14                                                 0446 01108000
         EJECT                                                          01109000
*RECSTRT: PROC;                                            /*@G51DGVS*/ 01110000
RECSTRT  STM   @14,@12,@SA00016                                    0447 01111000
*RESPECIFY (R2,R3,R4,R6,R7) RESTRICTED;                    /*@G51DGVS*/ 01112000
*GENERATE;                                                 /*@G51DGVS*/ 01113000
*********************************************************************** 01114000
*   THIS SECTION WILL COMPUTE THE START OF THE RECORD ENTRY AREA -    * 01115000
*   ALWAYS LOCATED AFTER THE HEADER RECORD. ALSO CALCULATION    *       01116000
*   OF THE 90 PERCENT FULL POINT OF THE DATA SET.               *       01117000
*********************************************************************** 01118000
         L     DEVTABLE,DEVSTORE        GET DEVICE TABLE ENTRY ADDR.    01119000
         L     WORK6,DEBADR             GET DATA EXTENT BLOCK ADDR.     01120000
         MVC   RESTARCC(L4),EXTENT      MOVE LOW EXT INTO RESTART       01121000
         MVI   RESTARID,L2              ID OF TWO-HEADER RECORD-        01122000
         MVC   LASTREU(L7),RESTAREA     MAKE LAST USED THE SAME         01123000
         LH    WORK1,BT90P(DEVTABLE)    GET 90 PERCENT POINT            01124000
         MH    WORK1,BUFFER             MULTIPLY TO GET 90 PER          01125000
         LH    WORK2,BT(DEVTABLE)       BYTES/TRACK                     01126000
         XR    WORK3,WORK3              CLEAR REG                       01127000
UPDA     CLR   WORK1,WORK2              COMPARE BYTES/TRK WITH          01128000
*                                        90 PERCENT POINT               01129000
         BL    UPDAT                    BRANCH--90 PERCENT LOWER        01130000
         SR    WORK1,WORK2              SUBT BYTES                      01131000
         LA    WORK3,L1(WORK3)          DEVELOP TTR-90 PER TRK          01132000
         B     UPDA                     AGAIN                           01133000
UPDAT    SR    WORK2,WORK1              SUBTRACT FROM MAXIMUM           01134000
         STH   WORK2,BUFFER             SAVE REMAINDER BYTES            01135000
         MVC   EWMC(L2),BUFFER          EARLY WARN MESSAGE COUNT        01136000
         LH    WORK1,TC(DEVTABLE)       TRACKS/CYLINDER                 01137000
         LH    WORK2,EXTENTLH           LOW EXTENT                      01138000
         AR    WORK2,WORK3              ACTUAL TRK ADDRESS              01139000
         LA    WORK1,L1(WORK1)          ADD ONE FOR HIGH TRK ADR        01140000
         XR    WORK3,WORK3              CLEAR REG                       01141000
UPDATE   CLR   WORK2,WORK1              COMPARE TRKS/CYL WITH           01142000
*                                        90 PERCENT TRACK               01143000
         BL    UPDATE1                  BRANCH--90 PERCENT LOW          01144000
         SR    WORK2,WORK1              SUBT TRACKS                     01145000
         LA    WORK3,L1(WORK3)          DEVELOP CYLINDER INCR           01146000
         B     UPDATE                   CONTINUE                        01147000
UPDATE1  STH   WORK2,BUFFERTA           SAVE TRACK ADDRESS              01148000
         LH    WORK2,EXTENT             STARTING CYLINDER ADR           01149000
         AR    WORK2,WORK3              ADD IN CYLINDER INCREMENT       01150000
         STH   WORK2,BUFFER             STORE IT                        01151000
         MVC   EWMT(L4),BUFFER          MOVE IT TO 90 PERCENT           01152000
*                                        TRACK POINTER FIELD            01153000
         MVI   SWITCHES,L0              CLEAR SWITCH AREA               01154000
*RESPECIFY (R2,R3,R4,R6,R7) UNRESTRICTED;                  /*@G51DGVS*/ 01155000
*END; /*END OF PROC RECSTRT                                  @G51DGVS*/ 01156000
@EL00016 DS    0H                                                  0451 01157000
@EF00016 DS    0H                                                  0451 01158000
@ER00016 LM    @14,@12,@SA00016                                    0451 01159000
         BR    @14                                                 0451 01160000
         EJECT                                                          01161000
*BUILDTXT: PROC;                                           /*@G51DGVS*/ 01162000
BUILDTXT STM   @14,@12,@SA00017                                    0452 01163000
*RESPECIFY (R2,R3,R5,R7) RESTRICTED;                       /*@G51DGVS*/ 01164000
*GENERATE;                                                 /*@G51DGVS*/ 01165000
*********************************************************************** 01166000
* CONVERT HEADER RECORD INFORMATION TO EBCDIC                         * 01167000
* PLACE EBCDIC IN WTO END OF JOB MESSAGE                              * 01168000
*********************************************************************** 01169000
         L     WORK4,EXTENT             LOW EXTENT                      01170000
         LA    WORK1,F                  IMAGE AREA                      01171000
         LA    WORK2,L8                 NUMBER OF CHAR TO CONVERT       01172000
*        CALL  UNPACK;                  /*CONVERT TO PRINTABLE*/   0455 01173000
         BAL   @14,UNPACK                                          0455 01174000
*GENERATE;                                                 /*@G51DGVS*/ 01175000
         LA    WORK2,L8                 NUMBER OF CHAR TO CONVERT       01176000
         L     WORK4,EXTENTHI           HIGH EXTENT                     01177000
         LA    WORK1,L                  IMAGE AREA                      01178000
*        CALL  UNPACK;                  /*CONVERT TO PRINTABLE*/   0457 01179000
         BAL   @14,UNPACK                                          0457 01180000
*GENERATE;                                                 /*@G51DGVS*/ 01181000
         ICM   WORK4,15,RESTAREA+2         RESTART AREA IN HEADER       01182000
         LA    WORK2,L8                 MAKE CCHH PRINTABLE             01183000
         LA    WORK1,S                  LOCATION IN MESSAGE             01184000
*        CALL  UNPACK;                  /*CONVERT TO PRINTABLE*/   0459 01185000
         BAL   @14,UNPACK                                          0459 01186000
*GENERATE;                                                 /*@G51DGVS*/ 01187000
         ICM   WORK4,15,RESTAREA+6         RESTART RECORD ADDR. IN HDR  01188000
         LA    WORK2,L2                 RECORD ADDRESS IS 2 PRINT DIG.  01189000
         LA    WORK1,S+8                WHERE TO PUT IN MESSAGE         01190000
*        CALL  UNPACK;                  /*CONVERT TO PRINTABLE*/   0461 01191000
         BAL   @14,UNPACK                                          0461 01192000
*GENERATE;                                                 /*@G51DGVS*/ 01193000
         L     DEVTABLE,DEVSTORE        LOAD ENTRY ADDRESS OF SYSRES    01194000
         MVC   D(L4),DN(DEVTABLE)       DEVICE NAME                     01195000
         MVC   N(L1),PDC(DEVTABLE)      DEVICE CODE                     01196000
D        EQU   COMPLETE+19              DEVICE NAME                     01197000
N        EQU   COMPLETE+27              DEVICE TYPE CODE                01198000
F        EQU   COMPLETE+31              FIRST TRACK ADDRESS             01199000
L        EQU   COMPLETE+42              LAST TRACK ADDRESS              01200000
S        EQU   COMPLETE+53              RECORD START ADDRESS+ID         01201000
*END; /*END OF PROC BUILDPROC                                @G51DGVS*/ 01202000
@EL00017 DS    0H                                                  0463 01203000
@EF00017 DS    0H                                                  0463 01204000
@ER00017 LM    @14,@12,@SA00017                                    0463 01205000
         BR    @14                                                 0463 01206000
*UNPACK: PROC;                                             /*@G51DGVS*/ 01207000
UNPACK   STM   @14,@12,@SA00018                                    0464 01208000
*RESPECIFY (R4) RESTRICTED;                                /*@G51DGVS*/ 01209000
*GENERATE;                                                 /*@G51DGVS*/ 01210000
*********************************************************************** 01211000
*                                                                       01212000
***      ROUTINE TO UNPACK CHARACTERS FOR PRINT                         01213000
*                                                                       01214000
*        WORK1 -   ADDRESS OF CONVERTED CHARACTERS                    * 01215000
*        WORK4 -   CONTAINS CHARACTERS TO BE CONVERTED                * 01216000
*        WORK2 -   CONTAINS NUMBER OF PRINTABLE CHARACTERS TO BE      * 01217000
*                  CREATED                                            * 01218000
*********************************************************************** 01219000
UNPACK1  XR    WORK3,WORK3              CLEAR REG                       01220000
         SLDL  WORK3,L4                 POSITION                        01221000
         IC    WORK3,TABLE(WORK3)       PRINTABLE CHARACTER             01222000
         STC   WORK3,L0(WORK1)          STORE IT                        01223000
         LA    WORK1,L1(WORK1)          UPDATE                          01224000
         BCT   WORK2,UNPACK1            NEXT                            01225000
*RESPECIFY (R2,R3,R4,R5) UNRESTRICTED;                     /*@G51DGVS*/ 01226000
*END; /*END OF UNPACK PROC                                   @G51DGVS*/ 01227000
@EL00018 DS    0H                                                  0468 01228000
@EF00018 DS    0H                                                  0468 01229000
@ER00018 LM    @14,@12,@SA00018                                    0468 01230000
         BR    @14                                                 0468 01231000
@PB00018 DS    0H                                                  0469 01232000
*GENERATE DATA DEFS(DSENSE,DCSW,DCSW2,DIPDCBFL,SRFDCB,SRFDCBFL,    0469 01233000
*                   TTRSAVE,MAXTTR,THIRD);                 /*@VS48735*/ 01234000
*RESPECIFY (R2,R3,R4,R7) UNRESTRICTED;                     /*@G51DGVS*/ 01235000
*END; /*END OF EXTERNAL PROC IFCDIP00                        @G51DGVS*/ 01236000
@EL00001 L     @13,4(,@13)                                         0471 01237000
@EF00001 DS    0H                                                  0471 01238000
@ER00001 L     @14,12(,@13)                                        0471 01239000
         LM    @00,@12,20(@13)                                     0471 01240000
         BR    @14                                                 0471 01241000
@DATA    DS    0H                                                       01242000
         DS    0F                                                       01243000
@AL00078 EQU   *                       LIST WITH   1 ARGUMENT(S)        01244000
@AL00083 DC    A(@CF00033)             LIST WITH   1 ARGUMENT(S)        01245000
@AL00109 DC    A(@CF00054)             LIST WITH   1 ARGUMENT(S)        01246000
@AL00112 DC    A(@CF00098)             LIST WITH   1 ARGUMENT(S)        01247000
@AL00120 EQU   *                       LIST WITH   2 ARGUMENT(S)        01248000
@AL00124 DC    A(@CF00195)             LIST WITH   2 ARGUMENT(S)        01249000
         DC    A(WRITEPTR)                                              01250000
@AL00139 EQU   *                       LIST WITH   1 ARGUMENT(S)        01251000
@AL00173 EQU   *                       LIST WITH   1 ARGUMENT(S)        01252000
@AL00193 DC    A(@CF00032)             LIST WITH   1 ARGUMENT(S)        01253000
@AL00140 EQU   *                       LIST WITH   1 ARGUMENT(S)        01254000
@AL00277 EQU   *                       LIST WITH   1 ARGUMENT(S)        01255000
@AL00282 DC    A(@CF00241)             LIST WITH   1 ARGUMENT(S)        01256000
@AL00151 DC    A(@CF00068)             LIST WITH   1 ARGUMENT(S)        01257000
@AL00154 EQU   *                       LIST WITH   1 ARGUMENT(S)        01258000
@AL00156 EQU   *                       LIST WITH   1 ARGUMENT(S)        01259000
@AL00251 DC    A(@CF00095)             LIST WITH   1 ARGUMENT(S)        01260000
@AL00180 DC    A(@CF00063)             LIST WITH   1 ARGUMENT(S)        01261000
@AL00205 DC    A(@CF00192)             LIST WITH   2 ARGUMENT(S)        01262000
         DC    A(WRITEPTR)                                              01263000
@AL00242 DC    A(@CF00073)             LIST WITH   1 ARGUMENT(S)        01264000
@AL00255 DC    A(@CF00244)             LIST WITH   1 ARGUMENT(S)        01265000
@AL00297 DC    A(@CF00034)             LIST WITH   1 ARGUMENT(S)        01266000
@AL00442 DC    A(@CF00296)             LIST WITH   1 ARGUMENT(S)        01267000
         DS    0F                                                       01268000
@SA00001 DS    18F                                                      01269000
@SA00008 DS    15F                                                      01270000
@PC00008 DS    1F                                                       01271000
@SA00002 DS    15F                                                      01272000
@SA00003 DS    15F                                                      01273000
@SA00004 DS    15F                                                      01274000
@SA00005 DS    15F                                                      01275000
@PC00005 DS    2F                                                       01276000
@SA00011 DS    15F                                                      01277000
@SA00010 DS    15F                                                      01278000
@SA00013 DS    15F                                                      01279000
@SA00007 DS    15F                                                      01280000
@SA00006 DS    15F                                                      01281000
@SA00012 DS    15F                                                      01282000
@SA00014 DS    15F                                                      01283000
@SA00015 DS    15F                                                      01284000
@SA00016 DS    15F                                                      01285000
@SA00017 DS    15F                                                      01286000
@SA00009 DS    15F                                                      01287000
@SA00018 DS    15F                                                      01288000
         DS    0F                                                       01289000
@CF00054 DC    F'1'                                                     01290000
@CF00098 DC    F'2'                                                     01291000
@CF00095 DC    F'3'                                                     01292000
@CF00073 DC    F'4'                                                     01293000
@CF00244 DC    F'5'                                                     01294000
@CF00068 DC    F'6'                                                     01295000
@CF00241 DC    F'7'                                                     01296000
@CF00063 DC    F'8'                                                     01297000
@CF00296 DC    F'9'                                                     01298000
@CF00032 DC    F'10'                                                    01299000
@CF00033 DC    F'11'                                                    01300000
@CF00034 DC    F'12'                                                    01301000
@CF00075 DC    F'16'                                                    01302000
@CF00195 DC    F'40'                                                    01303000
@CF00192 DC    F'1944'                                                  01304000
@CF00358 DC    F'-4'                                                    01305000
         DS    0D                                                       01306000
RCODE    DC    F'0'                                                     01307000
PTRSPOT  DC    A(0)                                                     01308000
READPTR  DC    AL4(BUF1)                                                01309000
WRITEPTR DC    AL4(BUF2)                                                01310000
SEQCNT   DC    AL1(0)                                                   01311000
         DS    CL7                                                      01312000
SRFECB   DC    F'0'                                                     01313000
         ORG   SRFECB                                                   01314000
POST     DS    CL1                                                      01315000
@NM00001 DS    CL3                                                      01316000
         ORG   SRFECB+4                                                 01317000
@TS00001 DS    CL1                                                      01318000
@CC00069 DC    C'FRAMES'                                                01319000
LOGRECA  DC    CL8'RECORDER'                                            01320000
RESID    DC    CL8'LOGREC'                                              01321000
         DS    CL5                                                      01322000
ENABLE   DS    CL8                                                      01323000
         ORG   ENABLE                                                   01324000
ENABLECC DC    X'A3'                                                    01325000
ENABLE00 DC    X'000000'                                                01326000
ENABLFLG DC    X'2000'                                                  01327000
ENABLCNT DC    H'1'                                                     01328000
         ORG   ENABLE+8                                                 01329000
DISABLE  DS    CL8                                                      01330000
         ORG   DISABLE                                                  01331000
DISABCC  DC    X'C3'                                                    01332000
DISAB00  DC    X'000000'                                                01333000
DISAFLG  DC    X'2000'                                                  01334000
DISACNT  DC    H'1'                                                     01335000
         ORG   DISABLE+8                                                01336000
RDCPUID  DS    CL8                                                      01337000
         ORG   RDCPUID                                                  01338000
CPUCC    DC    X'FE'                                                    01339000
CPUADR   DC    AL3(STCPUID)                                             01340000
CPUFLGS  DC    X'2000'                                                  01341000
CPUCNT   DC    H'8'                                                     01342000
         ORG   RDCPUID+8                                                01343000
STCPUID  DS    CL8                                                      01344000
         ORG   STCPUID                                                  01345000
STCPUVER DC    X'00'                                                    01346000
STCPUSER DC    X'000000'                                                01347000
STCPUMOD DC    X'0000'                                                  01348000
STCPUMCL DC    X'0000'                                                  01349000
         ORG   STCPUID+8                                                01350000
VERBAGE  DS    CL8                                                      01351000
         ORG   VERBAGE                                                  01352000
VERBCC   DC    X'69'                                                    01353000
VERBADR  DC    AL3(FRAMTYPS)                                            01354000
VERBFLG  DC    X'2000'                                                  01355000
VERBCNT  DC    H'1'                                                     01356000
         ORG   VERBAGE+8                                                01357000
FRAMTYPS DC    X'02'                                                    01358000
         DS    CL7                                                      01359000
RDVERB   DS    CL8                                                      01360000
         ORG   RDVERB                                                   01361000
RDCC     DC    X'32'                                                    01362000
RDADR    DC    AL3(0)                                                   01363000
RDFLG    DC    X'2000'                                                  01364000
RDCNT    DC    H'1920'                                                  01365000
         ORG   RDVERB+8                                                 01366000
SWITCH   DC    X'0000'                                                  01367000
         ORG   SWITCH                                                   01368000
FRAMEYES DS    BL1                                                      01369000
FRAMLOST EQU   SWITCH+0                                                 01370000
ONEFRAME EQU   SWITCH+0                                                 01371000
         ORG   SWITCH+2                                                 01372000
         DS    CL6                                                      01373000
SRFIOB   DS    CL32                                                     01374000
         ORG   SRFIOB                                                   01375000
SRFIOBF1 DC    X'00'                                                    01376000
SRFIOBF2 DC    X'00'                                                    01377000
SRFIOBS1 DC    X'00'                                                    01378000
SRFIOBS2 DC    X'00'                                                    01379000
SRFIOBEC DC    AL4(SRFECB)                                              01380000
         ORG   SRFIOBEC                                                 01381000
SRFIOBCO DS    CL1                                                      01382000
         ORG   SRFIOB+8                                                 01383000
SRFIOBF3 DC    X'00'                                                    01384000
SRFIOBCS DS    CL7                                                      01385000
         ORG   SRFIOBCS                                                 01386000
CCWADR   DC    X'000000'                                                01387000
CSWSTAT  DC    X'0000'                                                  01388000
         ORG   CSWSTAT                                                  01389000
ATTENTIN DS    BL1                                                      01390000
STATMOD  EQU   CSWSTAT+0                                                01391000
CUEND    EQU   CSWSTAT+0                                                01392000
BUSY     EQU   CSWSTAT+0                                                01393000
CHANEND  EQU   CSWSTAT+0                                                01394000
DEVEND   EQU   CSWSTAT+0                                                01395000
UNCHK    EQU   CSWSTAT+0                                                01396000
UNITEXCP EQU   CSWSTAT+0                                                01397000
PCI      DS    BL1                                                      01398000
ILC      EQU   CSWSTAT+1                                                01399000
PROGCHK  EQU   CSWSTAT+1                                                01400000
PROTEXP  EQU   CSWSTAT+1                                                01401000
CHANDCK  EQU   CSWSTAT+1                                                01402000
CHANCCK  EQU   CSWSTAT+1                                                01403000
INTCONCK EQU   CSWSTAT+1                                                01404000
CHAINCK  EQU   CSWSTAT+1                                                01405000
         ORG   SRFIOBCS+5                                               01406000
BYTCNT   DC    X'0000'                                                  01407000
         ORG   SRFIOB+16                                                01408000
SRFIOBCC DC    AL4(ENABLE)                                              01409000
         ORG   SRFIOBCC                                                 01410000
SRFIOBSI DS    CL1                                                      01411000
         ORG   SRFIOB+20                                                01412000
SRFIOBDC DC    AL4(SRFDCB)                                              01413000
         ORG   SRFIOBDC                                                 01414000
SRFIOBRS DS    CL1                                                      01415000
         ORG   SRFIOB+24                                                01416000
SRFIOBRA DC    A(0)                                                     01417000
         ORG   SRFIOBRA                                                 01418000
SRFIOBRM DS    CL1                                                      01419000
         ORG   SRFIOB+28                                                01420000
SRFIOBBC DC    X'0000'                                                  01421000
SRFIOBNR DC    H'0'                                                     01422000
         ORG   SRFIOB+32                                                01423000
BUF1     DS    CL1944                                                   01424000
BUF2     DS    CL1944                                                   01425000
         ORG   BUF2                                                     01426000
BUF240   DS    CL40                                                     01427000
         ORG   BUF2+1944                                                01428000
RECBUILD DS    CL24                                                     01429000
         ORG   RECBUILD                                                 01430000
RECTYPE  DC    X'A0'                                                    01431000
RECSYS   DC    X'00'                                                    01432000
RECSW0   DC    X'8800'                                                  01433000
         ORG   RECSW0                                                   01434000
RECNLST  DS    BL1                                                      01435000
RECTOD   EQU   RECSW0+0                                                 01436000
RECTRU   EQU   RECSW0+0                                                 01437000
@NM00002 EQU   RECSW0+0                                                 01438000
RECTIM   EQU   RECSW0+0                                                 01439000
@NM00003 EQU   RECSW0+0                                                 01440000
RECMP    EQU   RECSW0+1                                                 01441000
RECCP    EQU   RECSW0+1                                                 01442000
@NM00004 EQU   RECSW0+1                                                 01443000
         ORG   RECBUILD+4                                               01444000
@NM00005 DC    X'0000'                                                  01445000
RECCNT   DC    AL1(0)                                                   01446000
@NM00006 DC    X'00'                                                    01447000
RECDAT   DC    X'00000000'                                              01448000
RECTIME  DC    X'00000000'                                              01449000
RECCPU   DC    X'0000000000000000'                                      01450000
         ORG   RECBUILD+24                                              01451000
HOLD     DC    X'0000000000000000'                                      01452000
MBBCCHHR DS    CL8                                                      01453000
         ORG   MBBCCHHR                                                 01454000
M        DS    CL1                                                      01455000
BBCCHHR  DS    CL7                                                      01456000
         ORG   BBCCHHR                                                  01457000
BB       DS    CL2                                                      01458000
CCHHR    DS    CL5                                                      01459000
         ORG   MBBCCHHR+8                                               01460000
IFCDIP00 CSECT                                                          01461000
*********************************************************************** 01462000
*   DEVICE TABLE - THIS TABLE CONTAINS DATA PERTAINING TO THE         * 01463000
*   DEVICES CURRENTLY SUPPORTED AS SYSTEM RESIDENCE DEVICES.          * 01464000
*********************************************************************** 01465000
         DS    0D                                                       01466000
* TABLE ENTRY - 2311 DISK STORAGE DRIVE                                 01467000
DEVTAB   DC    X'21'                    DEVICE CODE                     01468000
         DC    C'1'                     PRINTABLE DEVICE CODE           01469000
         DC    AL2(3419)                BYTES/TRACK-FIRST TRACK         01470000
         DC    AL2(3625)                BYTES/TRACK                     01471000
         DC    AL2(9)                   TRACKS/CYLINDER                 01472000
         DC    AL2(3263)                BYTES/TRACK-90 PERCENT          01473000
         DC    C'2311'                  DEVICE NAME                     01474000
         SPACE 1                                                        01475000
* TABLE ENTRY - 2301 PARALLEL FILE                                      01476000
         DC    X'22'                    DEVICE CODE                     01477000
         DC    C'2'                     PRINTABLE DEVICE CODE           01478000
         DC    AL2(20137)               BYTES/TRACK-FIRST TRACK         01479000
         DC    AL2(20483)               BYTES/TRACK                     01480000
         DC    AL2(199)                 TRACKS/CYLINDER                 01481000
         DC    AL2(18385)               BYTES/TRACK-90 PERCENT          01482000
         DC    C'2301'                  DEVICE NAME                     01483000
         SPACE 1                                                        01484000
* TABLE ENTRY - 2303 SERIAL DRUM                                        01485000
         DC    X'23'                    DEVICE CODE                     01486000
         DC    C'3'                     PRINTABLE DEVICE CODE           01487000
         DC    AL2(4596)                BYTES/TRACK-FIRST TRACK         01488000
         DC    AL2(4892)                BYTES/TRACK                     01489000
         DC    AL2(9)                   TRACKS/CYLINDER                 01490000
         DC    AL2(4403)                BYTES/TRACK-90 PERCENT          01491000
         DC    C'2303'                  DEVICE NAME                     01492000
         SPACE 1                                                        01493000
* TABLE ENTRY - 2302 DISK STORAGE                                       01494000
         DC    X'24'                    DEVICE CODE                     01495000
         DC    C'4'                     PRINTABLE DEVICE CODE           01496000
         DC    AL2(4778)                BYTES/TRACK-FIRST TRACK         01497000
         DC    AL2(4984)                BYTES/TRACK                     01498000
         DC    AL2(45)                  TRACKS/CYLINDER                 01499000
         DC    AL2(4486)                BYTES/TRACK-90 PERCENT          01500000
         DC    C'2302'                  DEVICE NAME                     01501000
         SPACE 1                                                        01502000
* TABLE ENTRY - 2305 DRUM (ZEUS) MODEL 1                                01503000
         DC    X'26'                    DEVICE CODE                     01504000
         DC    C'6'                     PRINTABLE DEVICE CODE           01505000
         DC    AL2(13192)               BYTES/TRACK-FIRST TRACK         01506000
         DC    AL2(14136)               BYTES/TRACK     XA01893/YA01527 01507000
         DC    AL2(7)                   TRACKS/CYLINDER XA01893/YA01527 01508000
         DC    AL2(13194)               BYTES/TRACK-90  XA01893/YA01527 01509000
         DC    C'2305'                  DEVICE NAME                     01510000
         SPACE 1                                                        01511000
* TABLE ENTRY - 2305 DRUM (ZEUS) MODEL 2                                01512000
         DC    X'27'                    DEVICE CODE                     01513000
         DC    C'7'                     PRINTABLE DEVICE CODE           01514000
         DC    AL2(14184)               BYTES/TRACK-FIRST TRACK         01515000
         DC    AL2(14660)               BYTES/TRACK     XA01893/YA01527 01516000
         DC    AL2(7)                   TRACKS/CYLINDER XA01893/YA01527 01517000
         DC    AL2(12723)               BYTES/TRACK-90  XA01893/YA01527 01518000
         DC    C'2305'                  DEVICE NAME                     01519000
         SPACE 1                                                        01520000
* TABLE ENTRY - 2314 DISK                                               01521000
         DC    X'28'                    DEVICE CODE                     01522000
         DC    C'8'                     PRINTABLE DEVICE CODE           01523000
         DC    AL2(7008)                BYTES/TRACK-FIRST TRACK         01524000
         DC    AL2(7294)                BYTES/TRACK                     01525000
         DC    AL2(19)                  TRACKS/CYLINDER                 01526000
         DC    AL2(6565)                BYTES/TRACK-90 PERCENT          01527000
         DC    C'2314'                  DEVICE NAME                     01528000
         SPACE 1                                                        01529000
* TABLE ENTRY - 3330 DISK (MERLIN)                                      01530000
         DC    X'29'                   DEVICE CODE                      01531000
         DC    C'9'                    PRINTABLE DEVICE CODE            01532000
         DC    AL2(12680)               BYTES/TRACK-FIRST TRACK         01533000
         DC    AL2(13030)              BYTES/TRACK                      01534000
         DC    AL2(18)                 TRACK/CYLINDER                   01535000
         DC    AL2(11727)              BYTES/TRACK-90 PERCENT           01536000
         DC    C'3330'                 DEVICE NAME                      01537000
         SPACE                                                          01538000
* TABLE ENTRY - 3340 DISK (WINCHESTER)                                  01539000
         DC    X'2A'                   DEVICE CODE              XL03130 01540000
         DC    C'A'                    PRINTABLE DEVICE CODE    XL03130 01541000
         DC    AL2(7954)                BYTES/TRACK-FIRST TRACK         01542000
         DC    AL2(8368)               BYTES/TRACK              XL03130 01543000
         DC    AL2(11)                 TRACK/CYLINDER           XL03130 01544000
         DC    AL2(7531)               BYTES/TRACK-90 PERCENT   XL03130 01545000
         DC    C'3340'                 DEVICE NAME              XL03130 01546000
         SPACE 1                                                        01547000
** TABLE ENTRY - 3350 DISK(MADRID)                                      01548000
         DC    X'2B'               DEVICE CODE                          01549000
         DC    C'B'                PRINTABLE DEVICE CODE                01550000
         DC    AL2(18800)          BYTES/TRACK-FIRST TRACK              01551000
         DC    AL2(19069)          BYTES/TRACK                          01552000
         DC    AL2(29)             TRACKS/CYLINDER             X14318CG 01553000
         DC    AL2(17162)          BYTES/TRACK-90                       01554000
         DC    C'3350'             DEVICE NAME                          01555000
         SPACE                                                          01556000
* TABLE ENTRY - 3330-1 DISK (ICEBERG)                                   01557000
         DC    X'2D'                   DEVICE CODE              XL03145 01558000
         DC    C'D'                    PRINTABLE DEVICE CODE    XL03145 01559000
         DC    AL2(12680)               BYTES/TRACK-FIRST TRACK         01560000
         DC    AL2(13030)              BYTES/TRACK              XL03145 01561000
         DC    AL2(18)                 TRACK/CYLINDER           XL03145 01562000
         DC    AL2(11727)              BYTES/TRACK-90 PERCENT   XL03145 01563000
         DC    C'3330'                 DEVICE NAME              XL03145 01564000
         SPACE                                                          01565000
         DC    X'FF'                   TERMINATE TABLE                  01566000
         SPACE                                                          01567000
*                                                                       01568000
DC       EQU   0                        DEVICE CODE OFFSET              01569000
PDC      EQU   1                        PRINTABLE DEVICE CODE OFF       01570000
BTFT     EQU   2                        BYTES/TRK-FIRST TRK OFFSE       01571000
BT       EQU   4                        BYTES/TRACK OFFSET              01572000
TC       EQU   6                        TRACK/CYLINDER OFFSET           01573000
BT90P    EQU   8                        90 PERCENT BYTES/TRK OFFS       01574000
DN       EQU   10                       DEVICE NAME OFFSET              01575000
CB       EQU   X'FF'                    CHECK BYTE VALUE                01576000
HEX00    EQU   X'00'                                                    01577000
HDFRSW   EQU   X'20'                    FRAMES EXIST SWITCH             01578000
*********************************************************************** 01579000
*    THIS IS THE WRITE AREA FOR THE HEADER RECORD. THE BREAK-   *       01580000
*    DOWN IS DESCRIBED BELOW.                                   *       01581000
*********************************************************************** 01582000
         DS    0F                                                       01583000
         DC    X'0000'                  POSITION                        01584000
HDRSAVE DC    X'FFFF'                  RECORD ID                        01585000
         DC    5XL8'0'                  BUFFER                          01586000
*                                                                       01587000
EXTENT   EQU   HDRSAVE+2               LOW AND HIGH EXTENT              01588000
MSGCNT   EQU   HDRSAVE+10       COUNT OF LOGREC FULL MSG      @XA07072  01589000
RESTAREA EQU   HDRSAVE+11              RE START AREA-BBCCHHR            01590000
BYTREM   EQU   HDRSAVE+18              BYTES REMAINING ON TRACK         01591000
BYTONTRK EQU   HDRSAVE+20              TOTAL BYTES ON TRACK             01592000
LASTREU  EQU   HDRSAVE+22              LAST RE USED-BBCCHHR             01593000
TRKPERCY EQU   HDRSAVE+29              TRACKS/CYLINDER                  01594000
EWMC     EQU   HDRSAVE+31              90 PERCENT TRACK COUNT           01595000
DEVCODE  EQU   HDRSAVE+33              DEVICE CODE                      01596000
EWMT     EQU   HDRSAVE+34              90 PERCENT TRACK-CCHH            01597000
SWITCHES EQU   HDRSAVE+38              SWITCHES                         01598000
CHKBYTE  EQU   HDRSAVE+39              CHECK BYTE-'FF'                  01599000
*                                                                       01600000
EXTENTLH EQU   EXTENT+2                 LOW EXTENT HEAD ADDRESS         01601000
EXTENTHI EQU   EXTENT+4                 HIGH EXTENT                     01602000
RESTARCC EQU   RESTAREA+2               CCHH AREA OF HEADER             01603000
RESTARID EQU   RESTAREA+6               ID AREA OF HEADER               01604000
DSENSE   EQU   SRFWTO+37              WTO SENSE CHARACTERS              01605000
DCSW     EQU   SRFWTO+46              1ST 8 BYTES CSW                   01606000
DCSW2    EQU   SRFWTO+54              LAST 6 BYTES CSW                  01607000
*****************************************************************       01608000
*                                                               *       01609000
*        DCB FOR THE SYS1.LOGREC DATA SET                       *       01610000
*                                                               *       01611000
*****************************************************************       01612000
DIPDCB   DCB   DDNAME=SERERDS,                                         X01613000
               DSORG=PS,                                               X01614000
               MACRF=(RP,WP),                                          X01615000
               RECFM=U,                                                X01616000
               BLKSIZE=1944,                                           X01617000
               DEVD=DA,                                                X01618000
               SYNAD=LOGERR                                             01619000
*******************************************************************     01620000
*                                                                 *     01621000
*      DCB FOR READING THE SYSTEM REFERENCE FILE                  *     01622000
*                                                                 *     01623000
*******************************************************************     01624000
SRFDCB   DCB   MACRF=(E),       EXCP MACRO USED                        X01625000
               IOBAD=SRFIOB,    INPUT OUTPUT BLOCK ADDRESS             X01626000
               DSORG=PS,        ORGANIZATION IS PHYSICAL SEQUENTIAL    X01627000
               DEVD=DA,         MOST GENERALIZED DCB USED FOR SAFETY   X01628000
               RECFM=U,         UNDEFINED RECORDS                      X01629000
               DDNAME=FRAMES    DATA DEFINITION NAME FROM DD CARD       01630000
               WRITE            LISTDECB,SF,DIPDCB,HDRSAVE,40,,,,MF=L   01631000
FDAD     EQU   DIPDCB+8                 FIRST AVAILABLE ADDRESS         01632000
DCBDEVT  EQU   DIPDCB+17                DEVICE TYPE FIELD               01633000
DEVMASK  EQU   X'0F'                    DEVICE TYPE MASK                01634000
TRBAL    EQU   DIPDCB+18                TRACK BALANCE ON TRACK          01635000
DIPDCBFL EQU   DIPDCB+48                FLAG FIELD                      01636000
SRFDCBFL EQU   SRFDCB+48                FLAG FIELD FOR SRF DCB          01637000
OPEN     EQU   X'10'                    DCB OPEN FLAG                   01638000
BUFFER   DS    1F                       TEMP WORK AREA                  01639000
BUFFERTA EQU   BUFFER+2                 TEMP STORAGE -TRACK ADDR        01640000
PASS     DC    X'00'                    RECORD CONTROL                  01641000
DIPKEY   DC    X'FFFF'                  KEY FOR HEADER                  01642000
DEVTYPE  DC    X'00'                    DEVICE TYPE STORAGE             01643000
TABLE    DC    C'0123456789ABCDEF'      CONVERSION TABLE                01644000
BYTPFRM  DC    F'2500'      BYTES IN FRAME PLUS EST.MAX.IRG.            01645000
DEVSTORE DC    F'0'         DEVICE TABLE ENTRY ADDRESS                  01646000
DEBADR   DC    F'0'         DATA EXTENT BLOCK ADDRESS                   01647000
ARBSMALL DC    X'0014'      BYTES REMAINING SO NO RECORD WILL FIT       01648000
TTRSAVE  DC    F'0'                                                     01649000
TTRLST   DC    F'0'         TTR OF LAST FRAME                           01650000
MYSAVE   DS    5F           PROTECT SELF FROM TRACK CONVERSION ROUTINE  01651000
HDRSAV   DC    X'00000100'  TTR OF HEADER RECORD BY DEFINITION          01652000
MAXTTR   DC    X'00000000'  PLACE MAXIMUM RELATIVE LOCATION OF LOGREC   01653000
THIRD    DC    X'00000200'  TTR BEFORE 1ST FRAME. USED TO DETERMINE     01654000
*                           WHICH ERROR MESSAGE TO ISSUE. IF WRITE      01655000
*                           FAILS, NOTE WILL NOT BE EXECUTED AND TTR    01656000
*                           IN TTRSAVE WILL BE TTR FOR LAST RECORD OR   01657000
*                           ZERO IF HEADER WRITE FAIL.                  01658000
PTCHAREA DC    20F'0'                                                   01659000
PATCHLOC DC    S(PTCHAREA)  BASE DISPLACEMENT LOCATION OF PATCH AREA    01660000
RELREC   EQU   TTRSAVE+2                                                01661000
         ORG   DIPDCB                                                   01662000
FAK1     DS    62C                                                      01663000
DIPBLKSI DS    H            BLOCK SIZE OF RECORD IN DCB                 01664000
FAK2     DS    18C                                                      01665000
DIPLRECL DS    H            LOGICAL RECORD LENGTH IN DCB                01666000
IFCDIP00 CSECT                                                          01667000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       01668000
@01      EQU   01                                                       01669000
@02      EQU   02                                                       01670000
@03      EQU   03                                                       01671000
@04      EQU   04                                                       01672000
@05      EQU   05                                                       01673000
@06      EQU   06                                                       01674000
@07      EQU   07                                                       01675000
@08      EQU   08                                                       01676000
@09      EQU   09                                                       01677000
@10      EQU   10                                                       01678000
@11      EQU   11                                                       01679000
@12      EQU   12                                                       01680000
@13      EQU   13                                                       01681000
@14      EQU   14                                                       01682000
@15      EQU   15                                                       01683000
R0       EQU   @00                                                      01684000
R1       EQU   @01                                                      01685000
R2       EQU   @02                                                      01686000
R3       EQU   @03                                                      01687000
R4       EQU   @04                                                      01688000
R5       EQU   @05                                                      01689000
R6       EQU   @06                                                      01690000
R7       EQU   @07                                                      01691000
R14      EQU   @14                                                      01692000
R15      EQU   @15                                                      01693000
R10      EQU   @10                                                      01694000
R11      EQU   @11                                                      01695000
R12      EQU   @12                                                      01696000
R13      EQU   @13                                                      01697000
R8       EQU   @08                                                      01698000
R9       EQU   @09                                                      01699000
PARAMS   EQU   0                                                        01700000
PARMLEN  EQU   PARAMS                                                   01701000
INARG    EQU   PARAMS+2                                                 01702000
LISTPTR  EQU   0                                                        01703000
RECORD   EQU   0                                                        01704000
RECHDR   EQU   RECORD                                                   01705000
CVTBASE  EQU   0                                                        01706000
CVTOVL   EQU   0                                                        01707000
CVTRELNO EQU   CVTOVL+2                                                 01708000
CVTOVLL  EQU   0                                                        01709000
CVTPCNVT EQU   CVTOVLL+28                                               01710000
CVTDCB   EQU   CVTOVLL+116                                              01711000
INPARM   EQU   0                                                        01712000
WHERE    EQU   0                                                        01713000
MSGNO    EQU   0                                                        01714000
RECSYSS  EQU   RECSYS                                                   01715000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    01716000
@NM00008 EQU   CVTOVLL+32                                               01717000
@NM00007 EQU   CVTOVLL                                                  01718000
CVTMODEL EQU   CVTOVL                                                   01719000
RECFRAME EQU   RECORD+24                                                01720000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      01721000
@RC00075 EQU   @RC00073                                                 01722000
@RF00108 EQU   @RC00090                                                 01723000
@RC00121 EQU   @EL00002                                                 01724000
@RF00164 EQU   @RC00161                                                 01725000
@RF00171 EQU   @RC00161                                                 01726000
@RF00191 EQU   @RC00183                                                 01727000
@RF00217 EQU   @EL00003                                                 01728000
@RC00249 EQU   @EL00005                                                 01729000
ENDOPROC EQU   @EL00005                                                 01730000
@RF00261 EQU   @EL00006                                                 01731000
@RF00269 EQU   @EL00006                                                 01732000
@RC00271 EQU   @EL00006                                                 01733000
@RF00295 EQU   @EL00007                                                 01734000
@RF00369 EQU   @EL00008                                                 01735000
@RC00396 EQU   @EL00011                                                 01736000
@RF00402 EQU   @EL00011                                                 01737000
ENDGETDV EQU   @EL00015                                                 01738000
@PB00017 EQU   @PB00018                                                 01739000
@RC00125 EQU   @RC00121                                                 01740000
@RF00245 EQU   ENDOPROC                                                 01741000
@RC00240 EQU   ENDOPROC                                                 01742000
@RC00273 EQU   @RC00271                                                 01743000
@PB00016 EQU   @PB00017                                                 01744000
@RF00127 EQU   @RC00125                                                 01745000
@RC00130 EQU   @RC00125                                                 01746000
@PB00015 EQU   @PB00016                                                 01747000
@RC00136 EQU   @RC00130                                                 01748000
@PB00014 EQU   @PB00015                                                 01749000
@PB00013 EQU   @PB00014                                                 01750000
@PB00012 EQU   @PB00013                                                 01751000
@PB00011 EQU   @PB00012                                                 01752000
@PB00010 EQU   @PB00011                                                 01753000
@PB00009 EQU   @PB00010                                                 01754000
@PB00008 EQU   @PB00009                                                 01755000
@PB00007 EQU   @PB00008                                                 01756000
@PB00006 EQU   @PB00007                                                 01757000
@PB00005 EQU   @PB00006                                                 01758000
@PB00004 EQU   @PB00005                                                 01759000
@PB00003 EQU   @PB00004                                                 01760000
@PB00002 EQU   @PB00003                                                 01761000
@ENDDATA EQU   *                                                        01762000
         END   IFCDIP00                                                 01763000
