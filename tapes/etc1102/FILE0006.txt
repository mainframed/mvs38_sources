./  ADD  SSI=72440426,NAME=IGG02036
         TITLE 'SECOND LOAD OF LINE CLOSE - IGG02036'                   00005008
IGG02036 CSECT                                                          00010008
*A-000000-999999                                               @X31X8T0 00015008
         SPACE 3                                                        00020008
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903 00025008
******************** MICROFICHE FLAGS *********************** SUPT CODE 00030008
*C279000,506500                                                  A49239 00035008
*A221000,506000                                                  A41030 00040008
*C098000                                                         A49219 00045008
*A083100-083700                                                  S22025 00050008
*D506500,541000                                                  S22025 00055008
*A002000                                                         S21903 00060008
*C003000,081000,540000-548000                                    S21903 00065008
*A175000,531000                                                 SA60820 00070008
*D221300-221600                                                 SA60820 00075008
*A079000,334000,405000,536000,549000,551000                      X01004 00080008
*C187000,301000-307000,317600,320000-324000,326000,374000-380000,X01004 00085008
*C477000-488000,507000,539000                                    X01004 00090008
*D329000,422000-475000                                           X01004 00095008
*A097000,128000,374483,534000                                    Y01004 00100008
*A376720,376920,377920,539000,559400                             X02004 00105008
*C079500,375120-375160,375240-375280,375360,375520-375560,       X02004 00110008
*C376480,379240-379360                                           X02004 00115008
*A374210,374270,376150,379320,507800                             Y05330 00120008
*C378240                                                         Y05330 00125008
*D110000,261000,507150,513000,515000,523000                      Y01948 00130008
*A376360,376390,378040,507880                                   OY00465 00135008
*D378280-378360                                                 OY00465 00140008
*C379640-379720                                                 OY00451 00145008
*D507100                                                        OY00451 00150008
*A303000                                                        SA65392 00155008
*C261500                                                        SA65392 00160008
*D522000,532000                                                 SA65392 00165008
*A261800-261900,534500                                          SA64788 00170008
*A261000,514000                                                 SA62357 00175008
*C261000,263000                                                 SA62357 00180008
*D264000-279000,290000,523000                                   SA62357 00185008
*A380500,559600                                                 OX02223 00190008
*A 374780,507450                                                OY00530 00195008
*C375300                                                        OY03847 00200008
*D375450-375650,379960-380200                                   OY03847 00205008
*A317600                                                        OY03895 00210008
*A377036,377054                                                 OY00512 00215008
*A514100,514200                                                 OY03305 00220008
*C262000-280000,157700                                          OY03305 00225008
*D376360                                                        OY00541 00250905
*A376370,379720                                                 OY00541 00251005
*C379660,379840                                                 OY00541 00251105
*A379920                                                        OY00532 00251205
*A380500,559600                                                 OX02223 00253854
*C090000,128000,137000-138000,212350,333000,376060-376090,376150 Y02027 00253906
*C376160,376270,376300,418200,428000-432000                      Y02027 00254006
*D507840,37770-377790,543000-549200                              Y02027 00254106
*A019200-019800,042000,089200,089500,090700-092100,138200,148300 Y02027 00254206
*A148600,212320,332100-332500,334050-334150,376100,376155,380750 Y02027 00254306
*A402300-403000,418820,118320,471000,554300                      Y02027 00254406
*A402300-403000,418820,418320,471000,554300                      Y02027 00254506
*C160000,161000,222000,261500-261000,280000,317300,318000        Y02027 00254606
*C354000,355000,376270,514500                                    Y02027 00254706
*D516000,520000,521000                                           Y02027 00254806
*A222050,262100-262700,549700-549900                             Y02027 00254906
*C321000-321300,325500-326100                                    Y02027 00255006
*D322000-322400,334200-334600                                    Y02027 00255106
*C301600                                                       @ZA01133 00255661
*A537500                                                       @ZA01133 00256161
*A377960,378040                                                @YA03928 00257161
*A549000,549200                                                @SA70907 00257261
*C216000,537000,377780                                         @SA70907 00257361
*D217000-226000,527500,535000-536000,542500-547000             @SA70907 00257461
*D376160,379326-379353                                           X03039 00273808
*C004000,105000-106000,146000,150000,378240,379760-379800      @Z30X8TM 00281808
*C379880,507250                                                @Z30X8TM 00287808
*D379323,542500,549600                                         @Z30X8TM 00293808
*A301400,374870,514100                                         @XA03965 00296809
*C375800,551300                                                @ZA06161 00297009
*C159000                                                       @OY11974 00297191
*C537500                                                       @OZ24288 00297300
*                                                              @G36XRTP 00297600
*A379880                                                       @G36XRTP 00298100
*C105000,379440,379520,379560,507250                           @G36XRTP 00298600
*D379926-379942                                                @G36XRTP 00299100
         SPACE 3                                                        00300022
*********************************************************************** 00310022
*                                                                     * 00320022
*MODULE-NAME = IGG02036    (TCAM,TERMINATION)                  @G36XRTP 00330000
*                                                                S21903 00340022
*DESCRIPTIVE-NAME = SECOND LOAD OF LINE CLOSE                    S21903 00350022
*                                                                S21903 00360022
*COPYRIGHTS = 'NONE'                                             S21903 00370022
*                                                                S21903 00380022
*STATUS = VERSION 10.0                                         @G36XRTP 00400000
*                                                                     * 00500020
*FUNCTION - OPERATION                                                 * 00600020
*   IGG02036 EXAMINES THE TCB DEB CHAIN TO DETERMINE IF THERE         * 00700020
*   ARE ADDITIONAL TCAM LINE GROUP OR MESSAGE QUEUES DCB'S TO         * 00800020
*   BE CLOSED, IF THERE ARE NONE THE ADDRESS OF THE TCAM              * 00900020
*   DISPATCHER IS ZEROED IN THE CVT, ANY LINE BUFFERS AND/OR          * 01000020
*   CORE QUEUE DATA SETS ARE FREED UP ALONG WITH ANY LINE             * 01100020
*   CROSS REFERENCE TABLE.  I/O OPERATIONS ARE PURGED ON ALL          * 01200020
*   THE LINES AND THE LINES ARE DISABLED.  THE ERROR TAB AND          * 01300020
*   ATTENTION TAB FIELDS IN THE UCBS FOR THESE LINES WILL BE          * 01400020
*   RESET AND ALL LINE CONTROL BLOCKS FOR THIS DCB WILL BE            * 01500020
*   FREED UP.  IF THERE IS A LINE CROSS REFERENCE TABLE, THE          * 01600020
*   ENTRIES USED BY THESE LINES WILL BE RE-INITIALIZED AND            * 01700020
*   CAN BE USED AGAIN.                                                * 01800020
*                                                                     * 01900020
*   MODIFICATIONS TO THE DCB ARE MADE TO THE COPY OF THE         Y02027 01920006
*   DCB SINCE COMMON CLOSE WILL OVERLAY THE REAL DCB WITH        Y02027 01940006
*   THE COPY OF THE DCB.                                         Y02027 01960006
*                                                                     * 01980006
*INPUT - THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT AS FOLLOWS        * 02000020
*   5 -  THE ADDRESS OF THE WTG TABLE PREFIX                     Y02027 02100006
*   6 -  THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        * 02300020
*   7 -  THE ADDRESS OF THE COPY OF THE CURRENT DCB              Y02027 02400006
*   8 -  THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO          * 02600020
*        TABLE                                                        * 02700020
*                                                                     * 02800020
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG02036 VIA AN            * 02900020
*   XCTL FROM THE CLOSE EXECUTOR IGG02035 OR IT MAY BE RE-ENTERED     * 03000020
*   FROM THE RELOOP PORTION OF THIS EXECUOTR IF IT IS DETERMINED      * 03100020
*   THAT THERE IS ANOTHER DATA CONTROL BLOCK TO BE CLOSED. THE   Y02027 03200006
*   MODULE RECEIVES CONTROL FROM IGG02035 IN PROTECT KEY 0       Y02027 03250006
*                                                                     * 03300020
*OUTPUT - REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT            * 03400020
*   ENTRIES IN THE WHERE-TO-GO TABLE PREFIX AND THE WHERE-       Y02027 03500006
*   TO-GO TABLE RESPECITIVELY.                                   Y02027 03600006
*                                                                     * 03700020
*EXTERNAL ROUTINES - NONE                                             * 03800020
*                                                                     * 03900020
*EXITS - NORMAL                                                       * 04000020
*   THIS ROUTINE EXITS VIA AN XCTL TO THE EXECUTOR IDENTIFIED         * 04100020
*   BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE.              * 04200020
*   THE EXIT IS MADE IN THE PROTECT KEY OF DATA MANAGEMENT.      Y02027 04250006
*                                                                     * 04300020
*TABLES - WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE             * 04400020
*   ID AND TTR OF THE CLOSE EXECUTORS, AND THE WHERE-TO-         Y02027 04500006
*   GO TABLE PREFIX CONTAINS THE ADDRESS OF A COPY OF            Y02027 04550006
*   EACH DCB SPECIFIED IN THE CLOSE MACRO INSTRUCTION            Y02027 04600006
*   SPECIFIED IN THE CLOSE MACRO INSTRUCTION.                         * 04700020
*                                                                     * 04800020
*ATTRIBUTES - THIS ROUITNE IS EXECUTED IN THE TRANSIENT AREA AS       * 04900020
*   ENABLED, PRIVILEGED, AND RE-ENTRANT.                              * 05000020
*********************************************************************** 05020052
*********************************************************************** 05050022
         EJECT                                                          05100020
* REGISTER USAGE                                                        05200020
*                                                                       05300020
RE       EQU   0                        WORK REGISTER                   05400020
RF       EQU   1                        WORK REGISTER                   05500020
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      05600020
RTIOT    EQU   3                        ADDRESS OF THE TIOT             05700020
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        05800020
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       05900020
*                                         DCB PARAMETER LIST            06000020
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO          06100020
*                                         TABLE                         06200020
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY IN     06300020
*                                         DCB PARAMETER LIST            06400020
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY IN     06500020
*                                         IN WTG TABLE                  06600020
RAVT     EQU   9                        ADDRESS OF THE AVT              06700020
RUCB     EQU   10                       ADDRESS OF THE CURRENT UCB      06800020
RDEB     EQU   11                       BASE OF THIS ROUTINE            06900020
RBASE    EQU   12                       WORK REGISTER                   07000020
RC       EQU   13                       WORK REGISTER                   07100020
RD       EQU   14                       WORK REGISTER                   07200020
RJ       EQU   15                       WORK REGISTER                   07300020
*                                                                       07400020
         USING IEDQDEB+36,RDEB          DEB DSECT                       07500020
         USING IEDQTCB,RD               TCB DSECT                       07600020
         USING IHADCB,RDCB                                              07700020
         USING IEDQLCB,RCORE            LCB DSECT                       07800020
         USING IEDQAVTD,RAVT                                            07900020
         USING IEDQTNTD,RUCB                                     X02004 07950005
*                                                                       08000020
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY S21903 08100022
         USING *,RBASE                                                  08200020
         SPACE 2                                                        08250006
IGG02036 IEDHJN START                                            Y02027 08300006
         SPACE 2                                                        08350006
         SR    RTIOT,RTIOT              CLEAR A COUNT REGISTER          08400020
         EJECT                                                          08500020
RESTART  EQU   *                                                        08600020
         LA    RTIOT,ONE(RTIOT)         INCREMENT THE COUNT OF THE      08700020
*                                         PASSES THRU THIS MODULE       08800020
         L     RJ,FOUR(RWTGC)           ADDR OF OPEN WORK AREA   Y02027 08900006
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 08930006
         L     RDCB,DXUDCBAD            GET CURRENT DCB ADDRESS  Y02027 08960006
         L     RF,CVTPTR                LOAD ADDRESS OF CVT      Y02027 09000006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 09050006
         L     RF,CVTAQAVT              GET TCX ADDRESS          Y02027 09100006
         USING IEDQTCX,RF               TCX ADDRESSABILITY       Y02027 09200006
         L     RAVT,TCXAVT              GET THE AVT ADDRESS      Y02027 09300006
         L     RDEB,DCBDEBAD            GET THE DEB ADDRESS      Y02027 09500006
         L     RD,DEBTCBAD              GET THE TCB ADDRESS      Y02027 09700006
         L     RDEB,TCBDEB              LOAD THE ADDRESS OF THE         09900020
*                                         FIRST DEB ON THE CHAIN        10000020
         SR    RUCB,RUCB                CLEAR A COUNT REGISTER          10100020
CLRDEBAD EQU   *                                                        10200020
         L     RC,DEBDCBAD              LOAD THE ADDRESS OF THE DCB     10300020
*                                         FOR THIS DEB                  10400020
         TM    DSORG(RC),LINEDCB+DISKDCB+DCB3705    LINE GRP   @G36XRTP 10500000
*                                       OR MSG Q OR                     10600000
*                                       CHECKPOINT DCB           S22024 10700022
         BZ    LASTEST                  NO, BRANCH               S22024 10800022
         LA    RUCB,ONE(RUCB)           INCREMENT THE COUNT OF DEBS     11100020
*                                         ON THE CHAIN                  11200020
LASTEST  EQU   *                                                        11300020
         L     RDEB,FOUR(RDEB)          GET NEXT DEB ADDRESS     S22024 11400022
         LA    RDEB,AVTEZERO(RDEB)      CLEAR HIGH ORDER BYTE    S22024 11500022
         LTR   RDEB,RDEB                ANY MORE DEBS IN CHAIN   S22024 11600022
         BNZ   CLRDEBAD                 YES, CHECK THEM          S22024 11700022
         CR    RTIOT,RUCB               COMPARE THE NUMBER OF PASSES    12100020
*                                         THROUGH THIS MODULE WITH      12200020
*                                         THE NUMBER OF DEBS ON THE     12300020
*                                         TCB CHAIN                     12400020
         BE    LASTIME                  IF EQUAL, DO THE FINAL          12500020
*                                         OPERATIONS                    12600020
SETDEB   EQU   *                                                        12700020
         L     RDEB,DCBDEBAD            RESTORE THE DEB ADDRESS  Y02027 12800006
         LA    RC,SETLCB                SET A BRANCH ADDRESS            12950020
         EJECT                                                          13000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     13100020
*                                                                 *     13200020
*              PURGE I/O ON ALL THE LINES                         *     13300020
*                                                                 *     13400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     13500020
PURGELIN EQU   *                                                        13600020
         L     RF,CVTPTR                LOAD ADDRESS OF CVT      Y02027 13700006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 13750006
         MVC   DEBEXSCL+1(THREE),CVTXAPG+1 MOVE IN THE ADDR OF   Y02027 13800006
*                                         IOS APPENDAGES                13900020
         L     RF,4(RWTGC)              LOAD THE ADDRESS OF THE         14000020
*                                         OPEN WORK AREA                14100020
         ST    RDEB,0(RF)               STORE DEB ADDRESS IN            14200020
*                                         PARAMETER LIST                14300020
         MVI   0(RF),OPTION             MOVE IN THE OPTION BYTE         14400020
         XC    FOUR(EIGHT,RF),FOUR(RF)  CLEAR FOR PURGE                 14500020
         PURGE (1)                      PURGE I/O ON ALL LINES @Z30X8TM 14600008
*                                                                       14700020
         LA    RE,ONE                   LOAD THE WAIT COUNT             14800020
         L     RF,4(RWTGC)              LOAD THE ADDRESS OF THE  Y02027 14830006
*                                       OPEN WORK AREA           Y02027 14860006
         LA    RF,FOUR(RF)              GET ECB ADDRESS                 14900020
         WAIT  ECB=(1)                  WAIT FOR PURGE         @Z30X8TM 15000008
*                                                                       15100020
         BR    RC                       BR ON PRE-SET REGISTER   S22024 15150022
         EJECT                                                          15200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15300020
*                                                                 *     15400020
*    DISABLE ALL LINES UNLESS A TYPE III ADAPTER OR 3705         S22024 15500022
*                                                                 *     15600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15700020
SETLCB   EQU   *                                                        15750020
         TM    DCBDSORG+ONE,DCB3705     IS THIS A 3705 DCB       S22024 15760022
         BO    OUT                      YES, SKIP DISABLE       OY03305 15770005
         SR    RC,RC                    CLEAR FOR LINE COUNT            15800020
         SR    RF,RF                    CLEAR                  @OY11974 15900091
         IC    RC,DEBNMEXT              NUMBER OF LINES        @OY11974 15910091
SCAN     EQU   *                                               @OY11974 15920091
         L     RUCB,DEBUCBAD(RF)        UCB POINTER            @OY11974 15930091
         LTR   RUCB,RUCB                IS IT DUMMY            @OY11974 15940091
         BNZ   CONT                     BR, NO                 @OY11974 15950091
         LA    RF,FOUR(RF)              INCREMENT INDEX        @OY11974 15960091
         BCT   RC,SCAN                  CHECK NEXT LINE        @OY11974 15970091
         B     OUT                      ALL LINES DUMMY        @OY11974 15980091
CONT     EQU   *                                               @OY11974 15990091
         TM    UCBUNTYP-UCBOB(RUCB),TYPE3 IS THIS AN IBM TERMINALY02027 16000006
*                                       ADAPTER , TYPE III       Y02027 16100006
         BZ    OUT                      YES, BRANCH                     16200020
         L     RCORE,DCBIOBAD           LOAD THE ADDRESS OF THE LCB     16300020
*                                         AREA                          16400020
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        16500020
*                                         THE IOB                       16600020
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF THE     16700020
*                                         LCB AREA                      16800020
         SR    RUCB,RUCB                CLEAR AN INDEX REGISTER         16850020
         SR    RD,RD                    CLEAR A SIZE REGISTER           16900020
         IC    RD,DCBEIOBX              GET THE SIZE OF AN LCB          17000020
         IC    RC,DEBNMEXT              LOAD THE NUMBER OF LINES        17100020
*                                                                       17200020
LOOP     EQU   *                                                        17300020
         AR    RCORE,RD                 ACCESS THE BEGINNING OF THE     17400020
*                                         FIRST/NEXT LCB                17500020
         MVI   LCBCPA+20,POST           POST LCB FOR DUMMY LINE SA60820 17510022
         L     RJ,DEBUCBAD(RUCB)        LOAD THE UCB ADDRESS            17520020
         LTR   RJ,RJ                    IS THIS A DUMMY LINE            17540020
         BZ    LOOP01                   YES, BRANCH                     17560020
         MVC   LCBCPA(8),DISABLE        SET A DISABLE COMMAND           17600020
*                                         CHANNEL PROGRAM AREA          17700020
         XC    LCBCPA+20(FOUR),LCBCPA+20 CLEAR FOR DISABLE              17800020
         LA    RF,LCBCPA+20             GET ECB ADDRESS FOR IOS         17900020
         ST    RF,LCBECBCC              STORE THE ECB ADDRESS IN        18000020
*                                         THE LCB                       18100020
         LA    RF,LCBCPA                GET ADDRESS OF CHANNEL          18200020
*                                         PROGRAM AREA                  18300020
         ST    RF,LCBSIOCC              STORE IN FIRST CCW POINTER      18400020
         LA    RF,LCBFLAG1              LOAD THE ADDRESS OF THE IOS     18500020
*                                         FLAG BYTES                    18600020
         EXCPVR (1),SUBSYS              DISABLE THE LINE         X01004 18700005
LOOP01   EQU   *                                                        18730020
         LA    RUCB,FOUR(RUCB)          INCREMENT THE INDEX             18760020
         BCT   RC,LOOP                    BRANCH IF THERE ARE MORE      18800020
*                                         LINES TO DISABLE              18900020
         EJECT                                                          19000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19100020
*                                                                 *     19200020
*        WAIT FOR THE DISABLE COMMANDS TO COMPLETE                *     19300020
*                                                                 *     19400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19500020
         L     RCORE,DCBIOBAD           LOAD THE BEGINNING ADDRESS      19600020
*                                         OF THE LCB AREA               19700020
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        19800020
*                                         THE IOB                       19900020
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF         20000020
*                                         THE LCB AREA                  20100020
         IC    RC,DEBNMEXT              GET NUMBER OF LINES             20200020
         TIME  BIN                      GET TIME FOR COMPARE       0616 20300020
         L     RJ,FOUR(RWTGC)           LOAD THE ADDRESS OF THE         20320020
*                                         OPEN WORK AREA                20340020
         ST    RTIOT,0(RJ)              SAVE REG3 IN WORK AREA   S22024 20360022
         LR    RTIOT,RE                 SAVE THE ORIGINAL TIME          20380020
WAITLOOP EQU   *                                                        20500020
         AR    RCORE,RD                 ACCESS THE FIRST/NEXT LCB       20600020
TESTPCD  EQU   *                                                   0616 20700020
         TM    LCBCPA+20,X'40'          CHECK ECB FOR COMPLETION   0616 20800020
         BZ    TESTDLAY                 BRANCH IF NOT COMPLETE     0616 20900020
BCT      EQU   *                                                        21000020
         BCT   RC,WAITLOOP              LOOP FOR NEXT WAIT              21100020
         LA    RC,OUT                   SET A BRANCH ADDRESS            21210020
         L     RJ,FOUR(RWTGC)           GET THE ADDRESS OF THE OPEN     21220020
*                                         WORK AREA                     21230020
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 21233006
         L     RDCB,DXUDCBAD            RESTORE THE DCB ADDRESS  Y02027 21236006
         L     RTIOT,0(RJ)              RESTORE REGISTER 3              21240020
         B     PURGELIN                 PURGE I/O ON ALL LINES          21250020
TESTDLAY EQU   *                                                   0616 21400020
         LTR   RDCB,RDCB                CHECK FOR DELAY DONE       0616 21500020
         BZ    BCT                      BR YES, CHECK NEXT LINE@SA70907 21600061
         TIME  BIN                      GET CURRENT TIME           0616 22700020
         LTR   RTIOT,RTIOT              TEST THE ORIGINAL TIME          22800020
         BNM   COMPUTE                  BRANCH IF NOT NEGATIVE     0616 22900020
         LTR   RE,RE                    CHECK CURRENT TIME         0616 23000020
         BM    COMPUTE                  BRANCH IF MINUS            0616 23100020
         LCR   RTIOT,RTIOT              COMPLIMENT THE ORIGINAL TIME    23120020
         ALR   RE,RTIOT                 ADD THE TIMES                   23140020
         LCR   RTIOT,RTIOT              RESTORE THE ORIGINAL TIME       23160020
         B     COMPARE2                 SKIP SUBTRACT              0617 23500020
COMPUTE  EQU   *                                                   0616 23600020
         SLR   RE,RTIOT                 SUBTRACT THE TIMES IF THEY      23660020
*                                         ARE POSITIVE                  23720020
COMPARE2 EQU   *                                                   0617 23800020
         CH    RE,LIMIT                 CHECK FOR 28 SECOND LIMIT  0616 23900020
         BL    TESTPCD                  BRANCH IF NOT REACHED      0616 24000020
         SR    RDCB,RDCB                CLEAR REG TO INDICATE DELAY0616 24100020
         B     TESTPCD                  CHECK ECB AGAIN            0616 24200020
         EJECT                                                          24300020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     24400020
*                                                                 *     24500020
*        THIS SECTION OF CODE RESETS THE ERROR TAB AND            *     24600020
*        ATTENTION TAB FIELDS IN THE UCBS FOR ALL LINES           *     24700020
*                  IN THIS LINE GROUP                             *     24800020
*                                                                 *     24900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     25000020
OUT      EQU   *                                                   0616 25100020
         SR    RE,RE                    CLEAR FOR A LINE COUNT          25200020
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES IN      25300020
*                                         THIS LINE GROUP               25400020
         SR    RD,RD                    CLEAR AN INDEX REGISTER         25500020
GETADDR  EQU   *                                                        25600020
         L     RF,DEBUCBAD(RD)          LOAD THE ADDRESS OF THE         25700020
*                                         FIRST/NEXT UCB                25800020
         LTR   RF,RF                    IS THIS A // DD DUMMY ENTRY     25900020
         BZ    NEXTUCB                  YES, BRANCH                     26000020
         SR    RCORE,RCORE              CLEAR IC REGISTER       SA62357 26110052
         IC    RCORE,DEBNMEXT           NUMBER OF EXTENTS       SA62357 26120052
         SLL   RCORE,TWO                TIMES FOUR              SA62357 26130052
         LA    RCORE,DEBUCBAD(RCORE)    POINT TO ACCESS METHOD  SA62357 26140052
         NI    ONE(RF),XFB              GUARANTEE UCBNALOC BIT  SA64788 26180054
*                                         SET BY TOTE IS OFF    SA64788 26190054
         L     RJ,UCBEXTPT-UCBOB(,RF)   POINT TO UCB EXTENSION   Y02027 26195006
         MVC   UCBETI-UCBCMEXT(ONE,RJ),FOUR(RCORE) RESTORE       Y02027 26200006
*                                       ERRTAB OF REPRESENTATIVE Y02027 26500006
*                                       UCB                      Y02027 26800006
         MVC   UCBATI-UCBCMEXT(ONE,RJ),FIVE(RCORE) RESTORE ATTN  Y02027 27100006
*                                       TAB                      Y02027 27400006
NEXTUCB  EQU   *                                                        28100020
         LA    RD,FOUR(RD)              INCREMENT THE UCB INDEX         28200020
         BCT   RE,GETADDR               RESET THE NEXT LINE             28300020
         EJECT                                                          28400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28500020
*                                                                 *     28600020
*        FREEMAIN ALL OF THE LCB'S                                *     28700020
*                                                                 *     28800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28900020
TYPEIII  EQU   *                                                        29000020
         L     RCORE,DCBIOBAD           LOAD THE BEGINNING ADDRESS      29100020
*                                         OF THE LCB AREA               29200020
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        29300020
*                                         THE IOB                       29400020
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF         29500020
*                                         THE LCB AREA                  29600020
         SR    RD,RD                    CLEAR A SIZE REGISTER           29700020
         IC    RD,DCBEIOBX              GET THE SIZE OF AN LCB          29800020
         AR    RCORE,RD                 GET THE ADDRESS OF THE          29900020
*                                         FIRST LCB                     30000020
         LR    RF,RD                    COPY SIZE OF AN LCB      X01004 30050005
         IC    RD,DEBNMEXT              NUMBER OF LINE GROUPS    X01004 30100005
         TM    DCBDSRG2,DCBDSGTR        IS THIS A 3705 LCB      SA65392 30120005
         BO    LCB3705A                 YES,SKIP THRESHOLD CODE SA65392 30140005
         MVC   AVTDOUBL(1),LCBRSKEY     SAVE LINE SCHEDULER'S  @XA03965 30146009
*                                       DISP CODE              @XA03965 30152009
         AH    RF,THRESHL               ADD LENGTH OF          @ZA01133 30160061
*                                         THRESHHOLD VALUES     SA65392 30220005
LCB3705A EQU   *                                                SA65392 30260005
         MR    RE,RD                    GET TOTAL LCB AREA SIZE  X01004 30300005
         LA    RJ,DEBUCBAD              LOAD A POINTER TO THE UCB       30800020
*                                         ADDRESSES                     30900020
GETUCBAD EQU   *                                                        31000020
         L     RC,0(RJ)                 LOAD A UCB ADDRESS              31100020
         LA    RC,0(RC)                 CLEAR THE HIGH ORDER BYTE       31200020
         LTR   RC,RC                    IS THIS A VALID ADDRESS         31300020
         BNZ   DIALTEST                 YES, BRANCH                     31400020
         LA    RJ,FOUR(RJ)              INCREMENT THE UCB POINTER       31500020
         B     GETUCBAD                 GET THE NEXT UCB ADDRESS        31600020
DIALTEST EQU   *                                                        31700020
         TM    UCBDVCLS-UCBOB(RC),GRAPHICS IS THIS A GRAPHICS DEVY02027 31730006
         BO    FREE2260                 YES-BR TO UNFIX 2260 RTN X01004 31760005
         TM    DCBDSORG+ONE,DCB3705     IS THIS A 3705 DCB      OY03895 31770005
         BO    FREE2260                 YES, BRANCH             OY03895 31780005
         TM    UCBTBYT2-UCBOB(RC),DIAL  IS THIS A DIAL LINE      Y02027 31800006
         BZ    COPYSIZE                 NO, BRANCH                      31900020
         LA    RC,EIGHT(RF)             ADD 8 BYTES FOR DIAL-OUT X01004 32000005
*                                        CALL QUEUE              X01004 32020005
         SR    RF,RF                                             X01004 32040005
         IC    RF,AVTSCBSZ              SIZE OF AN SCB           X01004 32060005
         MR    RE,RD                    TOTAL SCB AREA           X01004 32080005
         ST    RF,LCBCPA                SAVE LENGTH OF SCB AREA  Y02027 32100006
         L     RJ,LCBMSGFM              ADDRESS OF SCB'S         Y02027 32110006
         BAL   RD,FREEPG                FREE SCB AREA            Y02027 32120006
         L     RE,LCBCPA                GET LENGTH OF SCB AREA   Y02027 32130006
         L     RF,LCBMSGFM              ADDRESS OF SCB'S         X01004 32140005
         ICM   RE,HI,SP250              SET SUBPOOL FOR FREEMAIN X01004 32160005
         FREEMAIN R,LV=(0),A=(1)                                 X01004 32180005
         LA    RE,EIGHT                                          X01004 32260005
         SR    RCORE,RE                 ADJ STRT OF LCB FOR DIAL X01004 32280005
COPYSIZ1 EQU   *                                                 X01004 32300005
         LR    RF,RC                    COPY LENGTH OF LCB AREA  X01004 32350005
COPYSIZE EQU   *                                                        32500020
         LR    RC,RF                    SAVE LCB LENGTH          Y02027 32550006
         LR    RJ,RCORE                 ADDRESS OF LCB'S         Y02027 32560006
         BAL   RD,FREEPG                FREE LCB AREA            Y02027 32570006
         LR    RE,RC                    LENGTH OF LCB AREA       Y02027 32600006
         ICM   RE,HI,SP250              SET SUBPOOL FOR FREEMAIN X01004 32650005
         LR    RF,RCORE                 COPY THE LCB AREA STARTING      32700020
*                                         ADDRESS                       32800020
*                                         FOR PROBLEM PROGRAM MODE      33000020
*                                                                       33100020
         FREEMAIN  R,LV=(0),A=(1)                                       33200020
         SPACE 2                                                 Y02027 33210006
*        CLEAR THE DCB FIELDS IN THE COPY OF THE DCB.            Y02027 33220006
         DROP  RDCB                     DROP RDCB AS DCB BASE    Y02027 33230006
         USING IHADCB,RF                ADDR OF COPY OF THE DCB  Y02027 33240006
         L     RF,ZERO(RPARC)           POINT TO COPY OF DCB     Y02027 33250006
         STCM  RAVT,AD,DCBIOBAA         RESTORE AVT ADDR IN DCB  Y02027 33300006
         XC    DCBEIOBX(1),DCBEIOBX     CLEAR SIZE OF LCB               33400020
         DROP  RF                       DROP RF AS DCB BASE      Y02027 33405006
         USING IHADCB,RDCB              ADDR THE REAL DCB        Y02027 33410006
         SPACE 2                                                 Y02027 33415006
         EJECT                                                          33500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     33600020
*                                                                 *     33700020
*        THIS SECTION OF CODE REMOVES AN ENTRY FROM THE           *     33800020
*        CROSS REFERENCE TABLE AND MAKES THE SPACE IT             *     33900020
*        FORMERLY OCCUPIED AVAILABLE TO SUBSEQUENT OPENS          *     34000020
*                                                                 *     34100020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     34200020
         NC    AVTCRSRF(4),AVTCRSRF     DO WE HAVE A CROSS              34300020
*                                         REFERENCE TABLE               34400020
         BZ    ENDLOAD                  NO, BRANCH                      34500020
         SR    RE,RE                    CLEAR FOR A LINE COUNT          34600020
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES IN      34700020
*                                         THIS LINE GROUP               34800020
         SR    RD,RD                    CLEAR FOR THE UCB INDEX         34900020
CROSSREF EQU   *                                                        35000020
         L     RJ,DEBUCBAD(RD)          LOAD THE ADDRESS OF THE         35100020
*                                         FIRST/NEXT UCB IN THIS        35200020
*                                         LINE GROUP                    35300020
         L     RJ,UCBNAME-ONE-UCBOB(,RJ) LOAD THE UCB NAME       Y02027 35400006
*                                       FROM THE UCB             Y02027 35500006
         L     RF,AVTCRSRF              LOAD THE ADDRESS OF THE         35600020
*                                         CROSS REFERENCE TABLE         35700020
         LA    RC,EIGHT(RF)             LOAD THE ADDRESS OF THE         35800020
*                                         FIRST ENTRY IN THE TABLE      35900020
COMPUCB  EQU   *                                                        36000020
         C     RJ,0(RC)                 ARE THE UCB NAMES THE SAME      36100020
         BNE   CHKNEXT                  NO, BRANCH                      36200020
         XC    0(CRSFSIZE,RC),0(RC)     YES, CLEAR ALL INFORMATION      36300020
*                                         FROM THIS ENTRY               36400020
         MVC   ONE(THREE,RC),ONE(RF)    MOVE THE ADDRESS OF THE         36500020
*                                         NEXT AVAILABLE ENTRY INTO     36600020
*                                         THE ENTRY CHAIN               36700020
         ST    RC,0(RF)                 MAKE THIS ENTRY THE NEXT        36800020
*                                         AVAILABLE ENTRY IN THE        36900020
*                                         CROSS REFERENCE TABLE         37000020
NEXTENTY EQU   *                                                        37100020
         LA    RD,FOUR(RD)              INCREMENT THE UCB POINTER       37200020
         BCT   RE,CROSSREF              DECREMENT THE LINE COUNT        37300020
ENDLOAD  EQU   *                                                 X01004 37400005
         SR    RCORE,RCORE                                       X01004 37403005
         IC    RCORE,DCBILCT            NUM OF INVITATION LISTS  X01004 37406005
         LA    RF,DEBPRFIX              LENGTH OF DEB PREFIX     X01004 37409005
         SR    RDEB,RF                  ADJ DEB BASE TO PREFIX   X01004 37412005
         DROP  RDEB                                              X01004 37415005
         USING IEDQDEB,RDEB                                      X01004 37418005
         L     RJ,DEBCEA                ADDRESS OF LINE END APP. X02004 37421005
         TM    DCBDSORG+ONE,DCB3705     3705 DCB                 Y05330 37421605
         BNO   NOT3705                  NO, BRANCH               Y05330 37422205
         SH    RJ,AVTHA4                ADJUST START ADDRESS     Y05330 37422805
NOT3705  EQU   *                        SET TO PAGE FREE APPEND. Y05330 37423405
         BAL   RD,FREEPG3               UNFIX PAGES OCCUPIED BY  X02004 37424005
*                                        LINE END APPENDAGE      X01004 37427005
         TM    DCBDSORG+ONE,DCB3705     3705 DCB                 Y05330 37428005
         BO    FREEDCB                  YES, FREE DCB AND DEB    Y05330 37429005
INVFREE  EQU   *                                                 X01004 37430005
         LR    RD,RCORE                 GET INVITATION LISTS YET X01004 37433005
*                                        TO FREE                 X01004 37436005
         BCTR  RD,ZERO                  SUBTRACT ONE             X01004 37439005
         AR    RD,RD                    CONVERT BYTE INDEX TO    X01004 37442005
         AR    RD,RD                     FOUR BYTE INDEX         X01004 37445005
         L     RUCB,DCBINVLI(RD)        ADDRESS OF INVITATION    X01004 37448005
*                                         LIST                   X01004 37451005
         SR    RC,RC                                             X01004 37454005
         SR    RF,RF                                             X01004 37457005
         IC    RC,0(RUCB)               GET NUMBER OF ENTRIES    X01004 37460005
         IC    RF,TWO(RUCB)             GET LENGTH OF EACH ENTRY X01004 37463005
         MR    RE,RC                    GET LENGTH OF LIST       X01004 37466005
         AR    RC,RC                    MULTIPY NUM OF ENTRIES   X01004 37469005
*                                       BY TWO TO GET SIZE OF           37472005
*                                         INVITATION LIST PREFIX X01004 37475005
         AR    RF,RC                    SET LENGTH TO FIX        X01004 37478005
         LA    RF,INVSIZE(RF)           INCREMENT SIZE TO       OY00530 37478354
*                                       INCLUDE DOUBLE WORD     OY00530 37478654
*                                       CONTROL FIELD AND       OY00530 37478954
*                                       DELIMITER               OY00530 37479254
         TM    STATUS(RUCB),INVEOT      WAS EOT SPECIFIED ON    OY00530 37479554
*                                       INVLIST MACRO           OY00530 37479854
         BZ    INVADDR                  NO, BRANCH              OY00530 37480154
         LA    RF,ONE(RF)               ADD 1 TO SIZE - FOR EOT OY00530 37480454
INVADDR  EQU   *                                                OY00530 37480754
         SR    RUCB,RC                  GET ADDRESS OF PREFIX    X01004 37481005
         LR    RJ,RUCB                  ADDRESS TO FIX           X01004 37484005
         BAL   RD,FREEPG                UNFIX INVITATION LIST    X01004 37487005
         LR    RD,RCORE                 GET NO. OF INVLISTS YET@XA03965 37487109
*                                       TO BE FREED            @XA03965 37487209
         BCTR  RD,ZERO                  SUBTRACT ONE           @XA03965 37487309
         AR    RD,RD                    CONVERT BYTE INDEX TO  @XA03965 37487409
         AR    RD,RD                    FOUR-BYTE INDEX        @XA03965 37487509
         L     RUCB,DCBINVLI(RD)        INVLIST ADDRESS        @XA03965 37487609
         CLI   AVTDOUBL,BUFKEY          BUFF TERM LINE?        @XA03965 37487709
         BE    NOCPUID                  BRANCH IF YES          @XA03965 37487809
         CLI   FIVE(RUCB),ZERO          CPUID ADDRESS HERE     @XA03965 37487909
         BE    NOCPUID                  BRANCH IF NO           @XA03965 37488009
         L     RJ,FOUR(,RUCB)           CPUID ADDRESS          @XA03965 37488109
         SR    RF,RF                    CLEAR FOR INSERT       @XA03965 37488209
         IC    RF,ZERO(,RJ)             NO. OF CHARS IN CPUID  @XA03965 37488309
         LA    RF,ONE(,RF)              ADD ONE FOR PREFIX     @XA03965 37488409
         BAL   RD,FREEPG                UNFIX CPUID            @XA03965 37488509
NOCPUID  EQU   *                                               @XA03965 37488609
         BCT   RCORE,INVFREE            RELEASE NEXT LIST        X01004 37490005
         L     RJ,DEBSIOA               ADDRESS OF START I/O APP X02004 37500005
         BAL   RD,FREEPG3               UNFIX APPENDAGE          X02004 37505005
         ICM   RF,AD,DCBSCTAD           ADDRESS OF SCT           X01004 37510005
         ICM   RF,HI,DEBEOEA+THREE      LENGTH OF SCT            X02004 37515005
         BAL   RD,FREEPG1               UNFIX SCT                X01004 37520005
         TM    DCBPCI,PCI               PCI PRESENT              X01004 37525005
         BO    FREEDCB                  NO, BRANCH              OY03847 37530005
         L     RJ,DEBPCIA               ADDRESS OF PCI           X02004 37535005
         BAL   RD,FREEPG3               UNFIX PCI APPENDAGE      X02004 37540005
FREEDCB  EQU   *                                                 X01004 37570005
         LR    RJ,RDCB                  DCB ADDRESS              X01004 37575005
         SR    RF,RF                    CLEAR REG              @ZA06161 37580009
         IC    RF,DCBILCT               NUMBER OF ELEMENTS IN  @ZA06161 37581009
*                                        INVITATION LIST       @ZA06161 37582009
         SLL   RF,TWO                   INVITATION LIST LENGTH @ZA06161 37583009
         LA    RF,DCBEND(0,RF)          LENGTH OF DCB          @ZA06161 37584009
         BAL   RD,FREEPG                FREE DCB                 X01004 37585005
         LR    RF,RDEB                  COPY DEB ADDRESS         Y01004 37590005
         ICM   RF,HI,DEBLNGTH           DOUBLE WORD LENGTH OF DEBY01004 37600005
         BAL   RD,FREEPG1               PAGE FREE THE DEB        Y01004 37603005
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 37606006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 37607006
         TM    CVTTCMFG,LASTDCB         LAST TCAM DCB CLOSED     Y02027 37609006
         BNO   ENDLOAD1                 NO, BRANCH               X01004 37612005
         L     RJ,CVTAQAVT              ADDRESS OF TCX           Y02027 37615006
         USING IEDQTCX,RJ               TCX ADDRESSABILITY       Y02027 37615506
         SR    RCORE,RCORE              CLEAR FOR INSERT         X02004 37624005
         IC    RCORE,TCXTOTE            NUMBER OF TOTE ENTRIES   Y02027 37627006
         LM    RE,RF,TCXBUFA            ADDR AND LENGTH OF I/O   Y02027 37630006
*                                       TRACE, BUFFERS AND CPB'S X01004 37633005
         LR    RJ,RE                    COPY ADDRESS OF BUFFERS OY00541 37638005
         BAL   RD,FREEPG                UNFIX BFRS-TRACE AND CPB X01004 37639005
         L     RUCB,AVTRNMPT            ADDRESS OF TERMINAL NAME X02004 37642005
*                                         TABLE (TNT)            X01004 37645005
         SR    RF,RF                    CLEAR REG FOR INSERT     X01004 37648005
         IC    RF,TNTENLEN              LENGTH OF ENTRY          X01004 37651005
         LA    RE,THREE                                          X01004 37654005
         AR    RF,RE                    BUMP FOR TNT POINTERS    X01004 37657005
         LR    RJ,RF                    SAVE ENTRY LENGTH        X02004 37660005
         MH    RF,TNTLEN                MULTIPLY LENGTH OF ENTRY X01004 37663005
*                                         BY NUMBER OF ENTRIES   X01004 37666005
         LA    RF,TNTOFF(RF)            ADD TO LENGTH THE CORDE  X01004 37669005
*                                         BEFORE THE FIRST ENTRY X01004 37672005
         LR    RD,RCORE                 NUMBER OF TOTE ENTRIES   X02004 37675005
         MR    RD,RD                    ENTRIES TO FIX FOR TOTE  X02004 37700005
         AR    RF,RJ                    ADD TOTE TO TNT LENGTH   X02004 37703005
         LTR   RJ,RJ                    ANY TOTE ENTRIES        OY00512 37703605
         BNZ   TOTEYES                  YES, BRANCH             OY00512 37704205
         LA    RF,ONE(RF)               ADJUST TERM TABLE OFFSETOY00512 37704805
TOTEYES  EQU   *                                                OY00512 37705405
         LR    RJ,RUCB                  COPY TNT START ADDRESS   X02004 37706005
         AR    RF,RE                    ROUND TO WORD BOUNDARY   X01004 37710005
         SRL   RF,2                     SHIFT OUT 2 LO-ORD BITS  X01004 37715005
         SLL   RF,2                     SHIFT BACK               X01004 37720005
         LA    RCORE,0(RF,RJ)                                    X01004 37723005
         ICM   RCORE,ALL,0(RCORE)       GET ADDRESS OF TERMINAL  X01004 37726005
*                                         TABLE                  X01004 37730005
         BAL   RD,FREEPG                UNFIX TNT                X01004 37735005
         L     RF,0(RCORE)              ADDRESS OF END OF THE    X01004 37740005
*                                       TERMINAL TABLE AND QCBS  X01004 37743005
         LR    RUCB,RF                  SAVE ADDRESS OF SCBS     X01004 37746005
         SR    RF,RCORE                 GET LENGTH OF TERM TABLE X01004 37750005
         LR    RJ,RCORE                 ADDR OF TERMINAL TABLE   X01004 37755005
         L     RCORE,FOUR(RCORE)        ADDRESS OF THE NUMBER OF X01004 37760005
*                                         ENTRIES IN DEVICE      X01004 37764005
*                                         CHARACTERISTICS TABLE  X01004 37768005
         BAL   RD,FREEPG                UNFIX TERMINAL TABLE AND X01004 37772005
*                                         QUEUE CONTROL BLOCKS   X01004 37776005
         LH    RF,0(RCORE)              NUMBER OF ENTRIES IN     X01004 37780005
*                                         DEVICE CHARACTERISTICS X01004 37784005
*                                         TABLE                  X01004 37788005
         SLL   RF,TWO                  MULTIPLY BY 4 TO GET      X01004 37792005
*                                         LENGTH OF DCT          X01004 37796005
         LTR   RF,RF                    NO DEV CHAR TABLE      @YA03928 37797061
         BZ    NODEVC                   BRANCH IF YES          @YA03928 37798061
         L     RJ,AVTCSTCS              ADDRESS OF DCT           X01004 37800005
         BAL   RD,FREEPG                UNFIX DCT                X01004 37804005
NODEVC   EQU   *                                               @YA03928 37806061
         LR    RJ,RUCB                  ADDRESS OF SCBS          X01004 37808005
         LH    RF,TWO(RCORE)            SCB LGTH IN DOUBLEWORDS  X01004 37812005
         BAL   RD,FREEPG2               UNFIX SCB'S              X01004 37816005
         TM    AVTSCOPT,AVTCMBUF        COMMON BUFFER USED       X02004 37820005
         BZ    CKTSO                    NO, CHECK FOR TSO      @Z30X8TM 37824008
         L     RUCB,AVTCBQCB            ADDRESS OF MASTER QCB    X02004 37840005
         USING IEDCMB,RUCB                                       X02004 37844005
         L     RCORE,CMBFIRST-ONE       ADDRESS OF FIRST PREFIX  X02004 37848005
         LR    RJ,RUCB                  ADDR. OF QCB, STCB'S AND X02004 37852005
*                                       PREFIXES FOR COMMBUF     X02004 37856005
         L     RF,CMBLAST-ONE           ADDRESS OF LAST PREFIX   X02004 37860005
         LA    RF,PRELNG(,RF)           ADDR. END OF LAST PREFIX X02004 37864005
         SR    RF,RJ                    LENGTH OF QCB'S, ETC.    X02004 37868005
         BAL   RD,FREEPG                FREE COMMBUF CNTRL BLOCKSX02004 37872005
         LH    RTIOT,CMBDAREA           NUMBER OF DATA AREAS     X02004 37876005
         N     RTIOT,AVTCLRHI           FORCE POSITIVE           X02004 37880005
COMLOOP  EQU   *                                                 X02004 37884005
         LA    RE,EIGHT                 CONSTANT TO LOCATE IDA   X02004 37888005
         SR    RJ,RJ                    CLEAR FOR ICM            X02004 37892005
         ICM   RJ,AD,ONE(RCORE)         ADDRESS OF DATA AREA     X02004 37896005
         SR    RJ,RE                    ADJUST TO IDA LIST PTR   X02004 37900005
         L     RF,FOUR(RJ)              TOTAL LENGTH TO FIX      X02004 37904005
         TM    ZERO(RJ),CCWIDA          IDA TO BE USED           X02004 37908005
         BNO   COMLOOP2                 NO, FIX BUFFER           X02004 37912005
         L     RJ,ZERO(RJ)              ADDRESS OF IDA LIST      X02004 37916005
COMLOOP2 EQU   *                                                 X02004 37920005
         BAL   RD,FREEPG                FREE COMMBUF DATA AREA   X02004 37924005
         LA    RCORE,PRELNG(RCORE)      BUMP TO NEXT PREFIX      X02004 37928005
         BCT   RTIOT,COMLOOP            FIX NEXT DATA AREA       X02004 37932005
CKTSO    EQU   *                        CHECK PRESENCE OF TSO    X02004 37936005
         TM    AVTBIT1,AVTTSON          TSO OR MIXED ENVIOR.     X01004 37940005
         BZ    FREEPOOL                 NO, BRANCH             @G36XRTP 37944000
         ICM   RJ,ALL,AVTTSOPT          ADDR. OF TSINPUT QCB     X02004 37948005
         BZ    FREEPOOL                 BRANCH IF IT'S ZERO    @G36XRTP 37952000
         LA    RF,TSILEN                LENGTH TO FREE         @G36XRTP 37956000
         BAL   RD,FREEPG                PAGE FREE TSINPUT QCB    X02004 37960005
         L     RJ,AVTKA02               ADDRESS OF IEDQKA02     OY00451 37964005
         LTR   RF,RJ                    IS KA IN THE SYSTEM     OY00541 37966005
         BZ    NOKA                     NO, SKIP PAGE FREE      OY00541 37967005
         SH    RF,AVTHA4                ADJUST TO LENGTH        OY00451 37968005
         L     RF,ZERO(RF)              LENGTH TO PAGE FREE     OY00451 37970005
         BAL   RD,FREEPG                UNFIX IEDQKA02          OY00451 37972005
NOKA     EQU   *                                                OY00541 37974005
         LA    RF,AYZLNG                LENGTH OF IEDAYZ       @Z30X8TM 37976008
         L     RJ,AVTTSOPT              ADDRESS OF IEDAYZ      @Z30X8TM 37980008
         ICM   RJ,ALL,TSISCHED-IEDQTSI(RJ)  ADDRESS OF IEDAYZ   OY00541 37984005
         BZ    FREEPOOL                 SKIP PAGEFREE IF NO AYZ@G36XRTU 37986000
         BAL   RD,FREEPG                PAGE FREE IEDAYZ         X01004 37988008
         EJECT                                                          37988100
************************************************************** @G36XRTP 37988200
*        FREEMAIN STORAGE FOR POOLED CONTROL BLOCKS            @G36XRTP 37988300
*               ( PLCB, SAT, SIB, RVT, NAT )                   @G36XRTP 37988400
************************************************************** @G36XRTP 37988500
FREEPOOL EQU   *                                               @G36XRTP 37988600
         ICM   RJ,ALL,AVTSAVTP          GET SAVT ADDRESS       @G36XRTP 37988700
         BZ    NOSAVT                   NO SAVT, SKIP FREEMAIN @G36XRTP 37988800
*                                       FOR POOL AND SAVT      @G36XRTP 37988900
         BM    FREEPLCB                 FREE PLCB'S AND SAVT   @G36XRTP 37989000
         LA    RF,SAVTVMSZ              SIZE OF SAVT IF VM     @G36XRTP 37989100
*                                       ONLY                   @G36XRTP 37989200
         B     FREEAVT                  FREE SAVT ONLY         @G36XRTP 37989300
FREEPLCB EQU   *                                               @G36XRTP 37989400
         L     RF,SAVTPOOL-IEDNSVTD(RJ) GET CONTROL BLOCK      @G36XRTP 37989500
*                                       POOL ADDRESS           @G36XRTP 37989600
         LH    RE,SAVTPLSZ-IEDNSVTD(RJ) GET NUMBER OF DOUBLE   @G36XRTP 37989700
*                                       WORDS IN POOL          @G36XRTP 37989800
         N     RE,AVTCLRHI              CLEAR HIGH ORDER       @G36XRTP 37989900
*                                       HALF-WORD              @G36XRTP 37990000
         SLL   RE,THREE                 MULTIPLY BY 8 FOR      @G36XRTP 37990100
*                                       NUMBER OF BYTES        @G36XRTP 37990200
         ICM   RE,HI,SP250              SUBPOOL 250            @G36XRTP 37990300
         FREEMAIN R,LV=(0),A=(1)        FREE CTL BLK POOL      @G36XRTP 37990400
         LA    RF,SAVTSIZE              GET LENGTH OF SAVT     @G36XRTP 37990500
FREEAVT  EQU   *                                                 X01004 37992005
         ICM   RJ,ALL,AVTSAVTP          GET SAVT ADDRESS       @G36XRYP 37992300
         BAL   RD,FREEPG                UNFIX SECONDARY AVT     OY00532 37994405
NOSAVT   EQU   *                                                OY00532 37995005
         LR    RJ,RAVT                  ADDRESS OF AVT           X01004 38030005
         LA    RF,AVTLNG                LENGTH TO UNFIX          X01004 38040005
         BAL   RD,FREEPG                UNFIX AVT                X01004 38050005
         EJECT                                                          38054806
ENDLOAD1 EQU   *                                                 X01004 38060005
         L     RJ,FOUR(RWTGC)           ADDRESS OF NEXT ENTRY    X01004 38070005
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 38075006
         XC    ZERO(FOUR,RWTGC),ZERO(RWTGC)  CLOSE COMPLETE      X01004 38080005
RELOOP   EQU   *                                                        38100020
         LA    RWTGC,EIGHT(RWTGC)       BUMP   CURRENT WTG POINTER      38200020
         LA    RPARC,FOUR(RPARC)        LOAD THE POINTER TO THE NEXT    38300020
*                                         ENTRY IN THE DCB              38400020
*                                         PARAMETER LIST                38500020
         CLC   0(2,RWTGC),AMIDCNST      IS THIS EXECUTOR REQUIRED       38600020
*                                         AGAIN                         38700020
         BE    RESTART                  YES, BRANCH TO BEGINNING        38800020
         CLC   0(2,RWTGC),CLOSEIDL      THIS CODE IS USED TO            38900020
         BL    RELOOP                   DETERMINE WHICH OF THE          39000020
         CLC   0(2,RWTGC),CLOSEIDH      CLOSE EXECUTORS TO GIVE         39100020
         BH    RELOOP                   CONTROL TO                      39200020
         LR    RPARC,RPAR               INITIALIZE CURRENT DCB REG      39300020
         LA    RWTGC,32(RWTG)             AND WTG REGISTER              39400020
ZCHECK   EQU   *                                                        39500020
         CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETED         39600020
         BNE   XCTLRTNE                 NO, THEN BRANCH          S22024 39700022
         LA    RWTGC,EIGHT(RWTGC)       BUMP POINTER TO TEST FOR        39800020
         LA    RPARC,FOUR(RPARC)          COMPLETION OF THE NEXT        39900020
*                                         ENTRY                         40000020
         B     ZCHECK                   TEST THE NEXT ENTRY      S22024 40100022
XCTLRTNE EQU   *                                                  *     40200020
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02027 40230006
         SPACE 2                                                        40260006
         LA    RJ,DXCCW12               LOAD THE ADDRESS OF THE  Y02027 40300006
*                                         LAST DOUBLE WORD IN THE       40400020
*                                         OPEN WORK AREA                40500020
         OI    TWOTWO(RWTG),NORLD       RESET LENGTH INDICATORS  X01004 40530005
         MVC   TWOFIV(TWO,RWTG),TWOSEV(RWTG) FOR NEXT LOAD TO 1K X01004 40560005
         MVC   6(TWO,RWTG),0(RWTGC)     MOVE ID TO NAME FIELD     *     40600020
         MVC   14(THREE,RWTG),TWO(RWTGC) MOVE TTR TO WTG TABLE          40700020
         XCTL  DE=(RWTG),SF=(E,(15))    TRANSFER CONTROL          *     40800020
         EJECT                                                          40900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41000020
*                                                                 *     41100020
*        THIS SECTION OF CODE REMOVES THE AVT ADDRESS FROM        *     41200020
*        THE DISPATCHER PREFIX, AND FREEMAINS ANY LINE BUFFERS    *     41300020
*        AND/OR USER REQUESTED CROSS REFERENCE TABLE AFTER        *     41400020
*        DETERMINING THAT THERE ARE NO MORE DCB'S TO BE CLOSED    *     41500020
*                                                                 *     41600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41700020
LASTIME  EQU   *                                                        41800020
         L     RF,CVTPTR                GET CVT ADDRESS          Y02027 41820006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 41826006
         OI    CVTTCMFG,LASTDCB         INDICATE THAT THE TCAM   Y02027 41832006
*                                         POINTER IN THE CVT IS TO      41840020
*                                         BE CLEARED                    41860020
         B     SETDEB                   RETURN                   X01004 42200005
FREE2260 EQU   *                                                 X01004 42400005
         LR    RC,RF                    SAVE LCB SIZE            X01004 42600005
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 42800006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 42900006
         L     RF,CVTAQAVT              ADDRESS OF TCX           Y02027 43000006
         USING IEDQTCX,RF               TCX ADDRESSABILITY       Y02027 43100006
         L     RF,TCXATTEN              ADDR OF 2260 ATTEN RTN   Y02027 43200006
         BAL   RD,FREEPG1               UNFIX 2260 ROUTINE       X01004 43400005
         B     COPYSIZ1                 GO FREE LCB              X01004 43600005
FREEPG3  EQU   *                        FREE PAGE ENTRY FOR APP. X02004 43800005
         SH    RJ,AVTHA4                ADJUST TO LOAD START     X02004 44000005
         L     RF,ZERO(RJ)              LENGTH OF MODULE         X02004 44200005
         B     FREEPG                   PAGE FREE MODULE CORE    X02004 44400005
FREEPG1  EQU   *                                                 X01004 44600005
         LR    RJ,RF                    COPY ADDRESS TO UNFIX    X01004 44800005
         SRL   RF,HIGHBYTE              GET NUM OF DOUBLE-WORDS  X01004 45000005
FREEPG2  EQU   *                                                 X01004 45200005
         SLL   RF,THREE                 CONVERT TO BYTE LENGTH   X01004 45400005
FREEPG   EQU   *                                                 X01004 45600005
         LR    RE,RJ                    SAVE START ADDRESS       Y02027 45800006
         LA    RJ,ZERO(RF,RJ)           BUMP TO END ADDR + 1     Y02027 46200006
         LR    RF,RE                    SET START ADDRESS        Y02027 46600006
         PGFREE R,A=(1),EA=(15)         ISSUE PAGE FREE          Y02027 47000006
         BR    RD                       RETURN TO CALLER         X01004 47400005
         EJECT                                                          48900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     49000020
*                                                                 *     49100020
*        THIS SECTION OF CODE INCREMENTS THE CROSS REFERENCE      *     49200020
*        TABLE ENTRY POINTER AND CHECKS TO SEE IF WE HAVE         *     49300020
*              PASSED THE LAST POSSIBLE ENTRY                     *     49400020
*                                                                 *     49500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     49600020
*                                                                       49700020
CHKNEXT  EQU   *                                                        49800020
         LA    RC,CRSFSIZE(RC)          INCREMENT THE CROSS             49900020
*                                         REFERENCE POINTER             50000020
         C     RC,FOUR(RF)              HAVE WE PASSED THE LAST         50100020
*                                         ENTRY IN THE TABLE            50200020
         BH    NEXTENTY                 YES, BRANCH                     50300020
         B     COMPUCB                  CHECK THE NEXT ENTRY IN THE     50400020
*                                         TABLE                         50500020
         EJECT                                                          50600020
AVTLNG   EQU   X'500'                   AVT LENGTH TO FREE       X01004 50720005
AYZLNG   EQU   X'AF4'                   LENGTH OF IEDAYZ       @Z30X8TU 50725000
AD       EQU   7                        ICM/STCM MASK            X01004 50730005
HI       EQU   8                        ICM/STCM MASK            X01004 50735005
HIGHBYTE EQU   24                       SHIFT TO HIGH-ORDER BYTE X01004 50740005
SIXTEN   EQU   16                       OFFSET OF 16             X01004 50745005
INVSIZE  EQU   9                        CONTROL WORDS SIZE (8) +OY00530 50745654
*                                       DELIMITER SIZE (1)      OY00530 50746254
STATUS   EQU   3                        OFFSET OF STATUS BYTE INOY00530 50746854
*                                       INVITATION LIST CONTROL OY00530 50747454
*                                       WORD                    OY00530 50748054
INVEOT   EQU   X'80'                    EOT WAS SPECIFIED ON    OY00530 50748654
*                                       INVLIST MACRO           OY00530 50749254
ALL      EQU   15                       ICM/STCM MASK            X01004 50750005
ZERO     EQU   0                        OFFSET OF 0              X01004 50755005
TWOTWO   EQU   22                       OFFSET OF 22             X01004 50760005
NORLD    EQU   1                        NO RLD IN NEXT MOD.      X01004 50765005
TWOFIV   EQU   25                       OFFSET OF 25             X01004 50770005
TWOSEV   EQU   27                       OFFSET OF 27             X01004 50775005
PCI      EQU   X'0C'                    DCB PCI FLAGS            X01004 50780005
LCB3705  EQU   184                      PLCB SIZE                Y05330 50788005
ONE      EQU   1                        VALUE 1                  S22024 50800022
WAIT     EQU   1                        SVC WAIT                        50900020
TWO      EQU   2                        VALUE TWO                S22024 51000022
THREE    EQU   3                        VALUE THREE              S22024 51100022
FOUR     EQU   4                        VALUE FOUR               S22024 51200022
EIGHT    EQU   8                        VALUE EIGHT              S22024 51400022
FIVE     EQU   5                        VALUE 5                 OY03305 51410005
BUFKEY   EQU   X'1A'                    BUFF TERM SCHED CODE   @XA03965 51430009
TYPE3    EQU   X'70'                    IBM TERM ADAPTER 3       Y02027 51450006
CRSFSIZE EQU   16                       CROSS REFERENCE POINTER  S22024 51700022
PURGE    EQU   16                       SVC PURGE                       51800020
IOSUPAPP EQU   21                       IOS APPENDAGE            S22024 52400022
DSORG    EQU   27                       DCB DSORG OFFSET         S22024 52500022
IOBPTR   EQU   32                       OFFSET TO THE IOB               52600020
DEBPRFIX EQU   36                       LENGTH OF THE DEB PREFIX        52700020
OPTION   EQU   160                      OPTION                   S22024 52810022
GRAPHICS EQU   X'10'                    GRAPHICS DEVICE          S22024 52870022
LASTDCB  EQU   X'0F'                    LAST DCB                 S22024 52930022
DISKDCB  EQU   X'20'                    DISK DCB TYPE            S22024 52990022
LINEDCB  EQU   X'40'                    LINE DCB TYPE            S22024 53050022
POST     EQU   X'40'                    POST FLAG FOR LCB POST  SA60820 53150022
DCB3705  EQU   X'04'                    DSORG = TR               S22024 53150122
DIAL     EQU   X'90'                    DIAL DEVICE              S22024 53300022
XFB      EQU   X'FB'                    USED TO TURN OFF UCB BITSA64788 53410054
LIMIT    DC    H'500'                   5 SECOND DELAY         @SA70907 53700061
THRESHL  DC    H'12'                    LEN THRESH ERRMSG AREA @OZ24288 53750000
         DS    0F                                                       53800020
SP250    DC    X'FA'                    SUBPOOL 250              X01004 53900005
CCWIDA   EQU   4                        INDIRECT ADDRESSING FLAG X02004 53930005
PRELNG   EQU   12                       LENGTH OF COMMBUF PREFIX X02004 53960005
DISABLE  DC    X'2F00000020000001'      DISABLE CCW              S21903 54000022
CLOSEIDL DC    C'0B'                    ID OF LAST CLOSE MODULES S21903 54100022
CLOSEIDH DC    C'0G'                    ID OF LAST CLOSE MODULES S21903 54200022
AMIDCNST DC    C'36'                    ID FOR THIS EXECUTOR     Y02027 54220006
         EJECT                                                          54970006
UCB      DSECT                                                          54980006
         IEFUCBOB                                                       54990006
         EJECT                                                          55000020
         DCBD  DSORG=TX                                                 55100020
DCBEND   EQU   DCBINVLI-IHADCB          END OF DCB             @ZA06161 55130009
         TTNTD                                                   X01004 55160005
         EJECT                                                          55200020
         TDEBD                                                          55300020
         EJECT                                                          55400020
         TTCXD                                                   Y02027 55430006
         EJECT                                                          55460006
         TTCBD                                                          55500020
         EJECT                                                          55600020
FORCORE  DSECT                                                          55630006
         IECDSECT                                                       55660006
         TAVTD                                                          55700020
         EJECT                                                          55800020
         TLCBD                                                          55900020
         EJECT                                                          55920005
         TTSID                                                   X01004 55940005
         EJECT                                                   Y02027 55945006
CVTD     DSECT                          CVT DSECT                Y02027 55950006
         CVT                            CVT                      Y02027 55955006
         IEDCMB                                                  X02004 55960005
         END                                                            56000020
./  ADD  SSI=72080163,NAME=IGG02041
2041     TITLE 'IGG02041-CLOSE CHECKPOINT DATA SET'                     00000110
IGG02041 CSECT                                                          00000210
         SPACE 3                                                        00000310
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903 00000410
******************** MICROFICHE FLAGS *********************** SUPT CODE 00000510
*C384000                                                         A49219 00000610
*D416000-424000                                                  A49219 00000710
*C324000                                                         S22025 00000810
*C332000                                                         A49219 00000910
*A004000                                                         S21903 00001010
*D772000                                                         S21903 00001110
*C020000,304000-320000,520000,664000,                            S21903 00001210
*C700000-704000,744000-764000,808000-812000,82400                S21903 00001310
*C696000                                                        SA57360 00001410
*C028000,304000,312000-320000,520000,664000,744000-752000        S22024 00001510
*C760000-764000,808000-812000,824000                             S22024 00001610
*A344000,348800,358000,541000,568000,616000                      S22024 00001710
*A384000,721000                                                  Y01004 00001810
*C028000,080000,088000,136000-140000,312000-340000,376000-386000 Y02027 00001910
*C432000,502000,504000,676000,714000                             Y02027 00002010
*A248000,252000,276000,280000,296800-299200,433000,434000,593000 Y02027 00002110
*A594000,673600-675200,688200,714200-715600                      Y02027 00002210
*A813000                                                         Y02027 00002310
*A449000,450000                                                 OY03902 00011810
*                                                              @G36XRTP 00211810
*A349600,351200                                                @G36XRTP 00411810
*C544000                                                       @G36XRTP 00611810
*D356000,360000-372000,520000,540000-542000,548000-550000      @G36XRTP 00811810
*THIS IS A DUMMY APAR TO CORRECT FICHE FLAGGING PROBLEM        @OZ19773 00861810
         SPACE 3                                                        01120010
*********************************************************************** 01200010
*                                                                     * 01600010
*MODULE-NAME = IGG02041      (TCAM,TERMINATION)                @G36XRTP 02000010
*                                                                S21903 02080010
*DESCRIPTIVE-NAME = CLOSE CHECKPOINT DATA SET                    S21903 02160010
*                                                                S21903 02240010
*COPYRIGHTS = 'NONE'                                             S21903 02320010
*                                                                     * 02400010
*STATUS = VERSION 10.0                                         @G36XRTP 02800010
*                                                                     * 03200010
*FUNCTION:THIS MODULE CLOSES THE CHECKPOINT DCB. IF THIS IS A         * 03600010
*   NORMAL CLOSEDOWN, AN INDICATION IS SET IN THE CHECKPOINT          * 04000010
*   CONTROL RECORD,AND THE RECORD IS WRITTEN ON DISK. THE CHECK-      * 04400010
*    POINT WORK AREA IS FREED VIA FREEMAIN.                           * 04800010
*                                                                     * 05200010
*ENTRY POINT:                                                         * 05600010
*                                                                     * 06000010
*        IGG02041                                                     * 06400010
*                                                                     * 06800010
*INPUT:REGISTERS 5,6,7,8 CONTAIN THE FOLLOWING VALUES:                * 07200010
*                                                                     * 07600010
*   5-ADDRESS OF THE PREFIX OF THE WHERE-TO-GO TABLE             Y02027 08000010
*   6-ADDRESS OF BEGINNING OF WHERE-TO-GO TABLE                       * 08400010
*   7-ADDRESS OF THE CURRENT ENTRY IN THE WTG TABLE PREFIX       Y02027 08800010
*   8-ADDRESS OF CURRENT ENTRY IN WHERE-TO-GO TABLE                   * 09200010
*                                                                     * 09600010
*   CHECKPOINT WORK AREA                                              * 10000010
*                                                                     * 10400010
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG02041 VIA AN       Y02027 10450010
*   XCTL FROM THE CLOSE EXECUTOR IGG02030 OR IT MAY BE REENTERED Y02027 10500010
*   FROM THE RELOOP PORTION OF THIS EXECUTOR IF IT IS DETERMINED Y02027 10550010
*   THAT THERE IS ANOTHER DATA CONTROL BLOCK TO BE CLOSED.       Y02027 10600010
*   IF ENTRY IS AT IGG02041, THEN A MODESET IS ISSUED FOR THE    Y02027 10650010
*   PROTECT KEY OF 0.                                            Y02027 10700010
*OUTPUT:REGISTERS 5 AND 6 ARE SAME AS INPUT. REGISTERS 7 AND 8 ARE    * 10800010
*   UPDATED TO THE NEXT ENTRIES.                                      * 11200010
*                                                                     * 11600010
*EXTERNAL ROUTINES:                                                   * 12000010
*                                                                     * 12400010
*        'IECPCNVT'-CONVERTS RELATIVE TRACK ADDRESS TO ACTUAL ADDR    * 12800010
*                                                                     * 13200010
*EXITS - NORMAL                                                  Y02027 13600010
*   THIS MODULE WILL XCTL TO THE NEXT NON-ZERO ENTRY IN          Y02027 13800010
*   THE WHERE-TO-GO TABLE. THE EXIT IS MADE IN THE KEY OF        Y02027 14000010
*   DATA MANAGEMENT.                                             Y02027 14200010
*                                                                     * 14400010
*EXITS-ERROR:THIS MODULE ISSUES AN ERROR MESSAGE VIA WTO AND XCTLS    * 14800010
*   TO THE NEXT ENTRY IN THE WHERE-TO-GO TABLE. THE ONLY ERROR        * 15200010
*   RECOGNIZED IS A DISK ERROR WHILE WRITING THE CONTROL RECORD.      * 15600010
*                                                                     * 16000010
*TABLES/WORK AREAS:                                                   * 16400010
*                                                                     * 16800010
*    CVT                                                              * 17200010
*   AVT (AVTCKGET,AVTCPRCD,AVTNCKPR,AVTGETMN)                         * 17600010
*   CHECKPOINT WORK AREA                                              * 18000010
*                                                                     * 18400010
*ATTRIBUTES:REENTERABLE                                               * 18800010
*                                                                     * 19200010
*NOTES:THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL REPRE-   * 19600010
*   SENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT TO    * 20000010
*   THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED SO    * 20400010
*   THAT REDEFINITION OF 'CHARACTER' CONSTANTS,BY REASSEMBLY, WILL    * 20800010
*   RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.               * 21200010
*                                                                     * 21600010
*********************************************************************** 22000010
         EJECT                                                          22400010
*REGISTER ASSIGNMENTS                                                   22800010
         SPACE                                                          23200010
R0       EQU   0                        REG ZERO                 S22024 23600010
R1       EQU   1                        PARM REG                 S22024 24000010
R2       EQU   2                        ADDRESS OF CHECKPT WRK AREA     24400010
RDCB     EQU   3                        THE DCB BASE REGISTER    Y02027 24800010
RCORE    EQU   4                        OPEN WORK AREA BASE REG  Y02027 25200010
R5       EQU   5                        ADDR OF 1ST DCB PARAMETER       25600010
R6       EQU   6                        BEGINNING OF WHERE-TO-GO TB     26000010
R7       EQU   7                        ADDR OF CURRENT DCB PARM        26400010
R8       EQU   8                        ADDR-CURRENT WHERETOGO ENTY     26800010
RAVT     EQU   9                        ADDRESS OF AVT                  27200010
RTCB     EQU   10                       TCB BASE REGISTER        Y02027 27600010
RDEB     EQU   11                       THE DEB BASE REGISTER    Y02027 28000010
R12      EQU   12                       BASE REG                        28400010
R13      EQU   13                       REG 13                   S22024 28800010
R14      EQU   14                       REG 14                   S22024 29200010
R15      EQU   15                       REG 15                   S22024 29600010
         SPACE 2                                                        29640010
         USING IEDQCKPD,R2              THE CHECKPOINT WORK AREA Y02027 29680010
         USING IEDQTCX,R1               TCAM CVT EXTENSION DSECT Y02027 29720010
         USING IHADCB,RDCB              THE DCB DSECT            Y02027 29760010
         USING FORCORE,RCORE            THE OPEN WORK AREA DSECT Y02027 29800010
         USING IEDQAVTD,RAVT            THE AVT DSECT            Y02027 29840010
         USING DEBNMSUB,RDEB            THE DEB DSECT            Y02027 29880010
         USING IEDQTCB,RTCB             TCB DSECT                Y02027 29920010
         SPACE 3                                                        30000010
         BALR  R12,0                    ESTABLISH ADDRESSABILITY S22024 30400010
         USING *,R12                                             S21903 30800010
         SPACE 2                                                        31200010
IGG02041 IEDHJN START                                            Y02027 31400010
         SPACE 2                                                        31600010
         L     RCORE,FOUR(R8)           GET THE ADDRESS OF THE   Y02027 31800010
*                                         OPEN WORK AREA         Y02027 32000010
         L     RDCB,DXUDCBAD            ADDRESS OF CURRENT DCB   Y02027 32200010
         SPACE 2                                                        32400010
         MODESET EXTKEY=SUPR            GET INTO KEY 0           Y02027 32600010
         SPACE 2                                                        32800010
         SPACE 2                                                        33400010
         L     R1,CVT                   GET THE CVT ADDRESS      Y02027 33600010
         L     R1,AVTCVTPT(R1)          GET THE TCX ADDRESS      Y02027 33800010
         L     RAVT,TCXAVT              GET THE AVT ADDRESS      Y02027 34000010
         L     R2,DCBIOBAD              GET CHECKPOINT WORKAREA  S22024 34880010
*                                        ADDRESS                 S22024 34960010
         LTR   R2,R2                    IS THERE A CKPT        @G36XRTP 34980010
*                                       WORKAREA               @G36XRTP 35000010
         BZ    QL725                    NO, BRANCH             @G36XRTP 35020010
         TM    DCBOPTCD,CKP3705         3705 CHECKPOINT DCB      S22024 35040010
         BO    QL705                    YES, BRANCH              S22024 35120010
         TM    AVTCKFLG,AVTCKTAC        TCAM CKPT ACTIVE       @G36XRTP 35130010
         BNO   QL720                    NO, BRANCH TO FREE     @G36XRTP 35140010
*                                       WORKAREA, TCAM CKPT    @G36XRTP 35150010
*                                       ABENDED OR THERE WAS   @G36XRTP 35160010
*                                       OPEN ERROR             @G36XRTP 35170010
         SPACE                                                          35200010
QL705    EQU   *                                                 S22024 35800010
         L     RDEB,DCBDEBAD            GET THE DEB ADDRESS      Y02027 37600010
         L     RTCB,DEBTCBAD            GET THE TCB ADDRESS      Y02027 38100010
         TM    TCBFLGS,ABEND            IS ABEND IN PROGRESS     Y02027 38600010
         BO    QL720                    BRANCH IF ABNORMAL TERMINT      39200010
         SPACE 3                                                        39600010
*SET NORMAL COMPLETION BIT IN CHECKPOINT CONTROL RECORD AND WRITE       40000010
*THE RECORD                                                             40400010
         SPACE 1                                                        40500010
         USING DXDEB,RDEB               DEB DSECT                Y02027 40600010
         SPACE                                                          40800010
         OI    CKPFLAGS,CKPNORML        SET NORMAL CLOSE BIT            41200010
         MVI   CKPIOM,0                 PUT EXTENT IN IOB               42800010
         MVC   CKPIOBB(SIX),DXDEBBIN    MOVE BIN, CYLINDER, AND  Y02027 43200010
*                                         TRACK ADDRESSES INTO   Y02027 43300010
*                                         CHECKPOINT WORK AREA   Y02027 43400010
         MVI   CKPIOR,1                 RECORD NO.                      43600010
         LA    R13,CKPCNTLR             ADDRESS OF CONTROL RCD          44000010
         ST    R13,CKPRW                PUT ADDR INTO CCW               44400010
         MVI   CKPRW,CKPWRITE           COMMAND CODE FOR WRITE DATA     44800010
         MVI   CKPRW+SX,ZRO            CLEAR COUNT              OY03902 44900010
         MVC   CKPRW+SEV(ONE),CKPCRLEN CONTROL REC COUNT        OY03902 45000010
         MVI   CKPSECTR,AVTEZERO        SET SECTOR ID TO 0  0430 S21101 45200010
         SPACE                                                          46000010
         EXCP  CKPIOB                   WRITE CONTROL RCD               46400010
         SPACE                                                          46800010
         WAIT  ECB=CKPECB               WAIT FOR I/O                    47200010
         SPACE                                                          47600010
         TM    CKPIOECB,X'7F'           CHECK FOR DISK ERROR            48000010
         BO    QL720                    BRANCH IF NO ERROR              48400010
         SPACE 3                                                        48800010
*NOTIFY CONSOLE OF DISK ERROR VIA WTO                                   49200010
         SPACE                                                          49600010
         MVC   CKPMSG(QL7MSGL),QL7MSG   MOVE ERROR MESSAGE       S22024 50000010
         L     RTCB,AVTTCB              GET TCB ADDRESS          Y02027 50200010
         L     R13,TCBTIO               GET TIOT ADDRESS         Y02027 50400010
         AH    R13,DCBTIOT              GET TIOE ADDRESS         S22024 50600010
         MVC   CKPMSG+DDNAME(DDL),TIOEDDNM(R13) MOVE DDNAME TO   S22024 50800010
*                                        MESSAGE                 S22024 51000010
         LA    R1,CKPMSG                ADDR OF MSG                     51200010
         WTO   MF=(E,(1)),ROUTCDE=11,DESC=4                             51600010
         B     QL720                    BRANCH                   S22024 52000010
         SPACE 3                                                        52400010
*FREE CHECKPOINT WORK AREA AND DELETE DISK END ROUTINE,LOADED BY        52800010
*CHECKPOINT OPEN.                                                       53200010
         SPACE                                                          53600010
QL720    EQU   *                                                        55600010
         LH    R13,CKPWKALN             LENGTH OF CKPT WORK AREA        56000010
         SPACE                                                          56400010
         FREEMAIN E,LV=(R13),A=DCBIOBAD,MF=(E,AVTGETMN),SP=250   S22024 56800010
QL725    EQU   *                                               @G36XRTU 56850010
         TM    DCBOPTCD,CKP3705         3705 CHECKPOINT DCB      S22024 56900010
         BO    QL730                    YES, BYPASS DELETE       S22024 57000010
         SPACE                                                          57200010
         DELETE EP=IGG019RA                                             58000010
         EJECT                                                          58400010
*SET UP FOR XCTL TO NEXT CLOSE MODULE                                   58800010
         SPACE 2                                                        59000010
QL730    EQU   *                                                        59200010
         L     R15,4(R8)                GET ADDRESS OF OPEN      Y02027 59300010
*                                       WORK AREA                Y02027 59400010
         XC    0(2,R8),0(R8)            CLEAR TO INDICATE COMPLETE      59600010
QL735    EQU   *                                                        60000010
         LA    R8,8(R8)                 UPDATA CURRENT WHERETOGO        60400010
         LA    R7,4(0,R7)               UPDATE CURRENT DCB PARM         60800010
         CLC   ZERO(TWO,R8),AMIDCNST    IS THIS EXECUTOR NEEDED  Y02027 61200010
         BE    START                    YES, RETURN TO PROCESS ITY02027 61600010
         CLC   0(2,R8),QL70B            CHECK FOR END OF WTG TABLE      62000010
         BL    QL735                    BRANCH IF NOT END               62400010
         CLC   0(2,R8),QL70G            COMPARE FOR END OF WTG TABLE    62800010
         BH    QL735                    BRANCH IF NOT END               63200010
         LR    R7,R5                    RESET PARM LIST ADDR            63600010
         LA    R8,32(0,R6)              RESET WTG TABLE ADDR            64000010
QL740    EQU   *                                                        64400010
         CLI   0(R8),0                  CHECK FOR 0 ENTRY               64800010
         BNE   QL750                    BRANCH IF NOT 0                 65200010
         LA    R8,8(0,R8)               ADDR OF NEXT WTG ENTRY          65600010
         LA    R7,4(0,R7)               ADDR OF NEXT DCB                66000010
         B     QL740                    TEST NEXT ENTRY          S22024 66400010
         SPACE                                                          66800010
QL750    EQU   *                                                        67200010
         SPACE 1                                                        67280010
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02027 67360010
         SPACE 2                                                        67440010
XCTLRTNE EQU   *                                                 Y02027 67520010
         LA    R15,DXCCW12-FORCORE(R15) XCTL PARM LIST           Y02027 67600010
         MVC   6(2,R6),0(R8)            PUT EXECUTOR ID IN PARM         68000010
         MVC   14(3,R6),2(R8)           PUT TTR IN WTG TABLE            68400010
         XCTL  DE=(R6),SF=(E,(15))                                      68800010
         EJECT                                                   Y02027 68810010
*CHECKPOINT DISK ERROR WTO MESSAGE                               Y02027 68820010
         SPACE 3                                                        69200010
QL7MSG   WTO   'IED087I CHECKPOINT DISK ERROR-CONTROL RECORD-XXXXXXXX',*69400010
               ROUTCDE=(2,11),DESC=4,MF=L                       SA57360 69600010
QL7MSGL  EQU   *-QL7MSG                 SIZE OF MESSAGE          S22024 69660010
DDNAME   EQU   49                       OFFSET TO DDNAME IN MSG  S22024 69720010
TIOEDDNM EQU   4                        DDNAME IN TIOE           S22024 69840010
DDL      EQU   8                        LENGTH OF DDNAME         S22024 69900010
CKP3705  EQU   X'10'                    OPTCD=I 3705 CHECKPOINT  S22024 70000010
QL70B    DC    C'0B'                    LOWEST POSSIBLE ID FOR END      70800010
QL70G    DC    C'0G'                    HIGHEST POSSIBLE ID FOR END     71200010
ZRO      EQU   0                        NUMERIC ZERO            OY03902 71220010
ONE      EQU   1                       LENGTH                   OY03902 71240010
SX       EQU   6                        NUMERIC SIX             OY03902 71260010
SEV      EQU   7                       DISPLACEMENT             OY03902 71280010
FOUR     EQU   4                        CONSTANT                 Y01004 71300010
ZERO     EQU   0                        NUMERIC 0                Y02027 71400010
TWO      EQU   2                        NUMERIC 2                Y02027 71420010
FIVE     EQU   5                        OFFSET                   Y02027 71440010
SIX      EQU   6                        NUMERIC 6                Y02027 71460010
CVT      EQU   16                       CVT DISPLACEMENT         Y02027 71480010
ABEND    EQU   X'80'                    ABEND INDICATOR IN TCB   Y02027 71500010
AMIDCNST DC    C'41'                    ID FOR THIS EXECUTOR     Y02027 71560010
         SPACE 3                                                        71600010
*XCTL TABLE-ROUNDS OUT LENGTH TO 1024 BYTES                             72000010
         SPACE                                                          72400010
NENT     EQU   1                        VALUE 1                  S22024 72800010
LENGTH   EQU   NENT*6+6                 LENGTH                   S22024 73200010
NODBWDS  EQU   (LENGTH+7)/8             LENGTH                   S22024 73600010
ORGIDTTR EQU   1024-NODBWDS*8           ADDRESS                  S22024 74000010
         ORG   IGG02041+ORGIDTTR        EXTEND TO FULL SIZE      S22024 74400010
IDEND    DC    X'0000'                  END OF NAMELIST          S22024 75200010
         CNOP  4,8                                               S21903 75600010
LOADID   DC    C'020'                   CLOSE ID                 S22024 76000010
         DC    YL1(X'80'-NODBWDS)       ADJUST MODULE LENGTH     S22024 76400010
         SPACE 3                                                        76800010
         TAVTD                                                          77600010
         TCKPD 3330                     MERLIN VERSION      0430 S21101 78000010
         DCBD  DSORG=TQ                                                 78400010
         SPACE 3                                                        78800010
         EJECT                                                          79200010
         TDEBD                                                   Y02027 79900010
         EJECT                                                          80600010
         TTCXD                                                   Y02027 81300010
         EJECT                                                          82000010
FORCORE  DSECT                                                          82700010
         IECDSECT                                                       83400010
         EJECT                                                          84100010
         TTCBD                                                   Y02027 84800010
         EJECT                                                          85500010
         END                                                            86800010
./  ADD  SSI=80800078,NAME=IGG02046
2046     TITLE '''IGG02046'' - TCAM/SAM CLOSE EXECUTOR'                 00100020
IGG02046 CSECT                                                          00200020
         SPACE 3                                                SA62364 00200151
*CHANGE-ACTIVITY = AS FOLLOWS:                                  SA21903 00200351
**************************** MICROFICHE FLAGS *************** SUPT CODE 00200651
*C212000                                                        SA55923 00201051
*A094300                                                         S22025 00201151
*A246000,538000                                                 SA53606 00201251
*A094000,334000,491000,510600,511500                             A47157 00201351
*D522000                                                         A47157 00201451
*A073000,074000,076000,078000,080000,082000,084000,089000,106000 CLUP21 00201551
*A112000,149000,165000,192000,196000,239000,268000,314000,317000 CLUP21 00201651
*A321000,357000,361000,369000,372000,491000                      CLUP21 00201751
*C094000,108000,129300-129600,130900,157000,194000-195000,237000 CLUP21 00201851
*C256000,316000,319000,324000,352000,359000-360000,371000,433000 CLUP21 00201951
*D138000,141000-143000,153000-155000,169000-171000,188000,224700 CLUP21 00202051
*D241000-243000,271000,273000-274000,299000,325000-328000        CLUP21 00202151
*D346000-349000,384000-385000,445000-449000,470000,471400-475000 CLUP21 00202251
*D491000,494000,497000,505000,508000-509000,511000               CLUP21 00202351
*A221000,227000                                                  A44869 00202451
*D470000,471400,236000-238000                                    CLUP21 00202551
*C224000                                                         CLUP21 00202651
*A136000                                                         A41028 00202751
*C231000,471700                                                  A41028 00202851
*D134000                                                         A41028 00202951
*C212000,213000,215000,216000                                    S21903 00203051
*C161000,254000,307000,391000-394000,427000,434000,437000,454000,S21903 00203151
*C468000,469000,471000,511500,511800,516000,517000               S21903 00203251
*D203000,211000,217000,221000                                  S21903   00203351
*D353300-353600                                                 SA51076 00203451
*D324000                                                        SA50090 00203551
*A224500                                                        SA59162 00203651
*D291000                                                        SA59162 00203751
*C148000                                                        SA60335 00203851
*D165000-187000                                                 SA60335 00203951
*A203500                                                        SA62364 00204051
*C006400,012000-024000,054000,085000,116000-268650,294000        Y02027 00204306
*C297000,397000,398000,451000,477500,498000-500100,511100        Y02027 00204606
*A073700,084200,297300-299700,313020-313800,374000-386000        Y02027 00204906
*A399000-411000,438160-438880,447000,456060,470000-475000,480500 Y02027 00205206
*A523300-523600,537030-538800                                    Y02027 00205506
*D050000,055000-056000,073000,074000-074500,078500,080500,082500 Y02027 00205806
*D084500,089500,096000-099000,104000,303000-308000,397500        Y02027 00206106
*D412000-414000,451090-456000,456200-461750,465000,476000,479500 Y02027 00206406
*D484000,486000,489000,491000,491060,491120,491200,491400,491600 Y02027 00206706
*D503000-506000,509500,511200-517000,525000-536000               Y02027 00207006
*A230000                                                        SA66366 00234054
*A120300,397500,510000                                          SA66747 00264054
*A042400-042800,166200-166800,182500,186300-186600,268900-268930,X01004 00294305
*A288500,289200,295500,305400-305800,477500,479500,481500,       X01004 00294605
*A482200-482600,509700                                           X01004 00294905
*C166000,181000-182000,183000,185000-186000,279000-280000,       X01004 00295205
*C283000-284000,289000,296000-297000,305000,306000,309000-310000 X01004 00295505
*D043000,172000-173000,184000,189000,281000,291000,298000        X01004 00295805
*A042100-042300,121060-121800,129500,129700-129900,130100,153000,Y01004 00296105
*A201800,202600,206100-206200,218100-218200,220500-221000,221500,Y01004 00296405
*A224200,294500,397500,451100-451910,452100,453800,454400-454900,Y01004 00296705
*A455100-458200,483500,491020-491110                             Y01004 00297005
*C024000,042000,108500,120000,136000,148000,158000,201000,       Y01004 00297305
*C204000-206000,220000,227200-227800,294000,307000,312000-313000,Y01004 00297605
*C397000,451000,452000,454000,455000                             Y01004 00297905
*D025000,105000,129300,129600,130000,130600,135000,136500,       Y01004 00298205
*D149000-152000,156000-157000,159000-165000,202000,216000-217500,Y01004 00298505
*D221200-221400,221600-221800,235000-264000,314000-369000,       Y01004 00298805
*D374000-396000,399000-411000,453000,469300-471200               Y01004 00299105
*A459050-459150                                                  X02004 00299405
*D461600-461700                                                  X02004 00299705
*A174030-174150,153050                                         @ZA00234 00299861
*D186220,186280                                                @ZA00234 00299961
*A103000,140200,190500,475000,522000                           @ZA01439 00300061
*D171200                                                       @ZA01439 00300161
*D179500-180000,182500-183000                                  @ZA00234 00300261
*A153000                                                       @ZA00234 00300561
*C146000                                                       @ZA00234 00300861
*A184350,186500                                                @ZA01567 00301161
*A161000,173000,185200,502000,537550,538800                    @ZA02601 00311161
*C137000-140264,140600,145600-159000,168000-169000             @ZA02601 00321161
*C174030-174150,385000                                         @ZA02601 00331161
*C386000,438160-438880                                         @ZA02601 00341161
*D179000,184200-184390,187200,188500-190900                    @ZA02601 00351161
*D118000                                                       @ZA02601 00361161
*C385000                                                       @ZA02601 00371161
*D120000,116000,438160-438660                                  @ZA04027 00371681
*C156400-156600,386000-402000                                  @ZA04027 00372181
*A192000                                                       @ZA04027 00372681
*C151000                                                       @ZA05047 00372781
*D193400                                                       @OZ07799 00372881
*A438000                                                       @OZ07799 00372981
*C174000                                                       @OZ07798 00373081
*C148600-148800                                                @OZ07819 00373181
*A156400                                                       @OZ07819 00373281
*D161000,438300-438500,410000                                  @OZ07819 00373381
*C313180                                PECB DSECT CHG         @OZ07830 00373481
*A149600,150000,151600,152200,468000                           @OZ17630 00373581
*D140280-140840                                                @OZ19756 00379500
*A148000                                                       @OZ19756 00385500
*C008200,171400,171600                                         @Z40X9TG 00391500
*C313240-313260                                                @OY16374 00392500
*D313320-313340                                                @OY16374 00393500
*A411000                                                       @OZ18749 00394500
*D148600-148800,438100-438700                                  @OZ18749 00395500
*                                       PECB DSECT CHG         @OZ18744 00395686
*********************************************************************** 00400020
*                                                                     * 00500020
*TITLE: 'IGG02046' TCAM APPLICATION PROGRAM CLOSE EXECUTOR            * 00600020
*                                                                     * 00610051
*DESCRIPTIVE NAME = TCAM APPL PROG CLOSE EXECUTOR                     * 00640006
*                                                                     * 00670051
*  DESCRIPTIVE NAME = TCAM APPLICATION PROGRAM CLOSE EXECUTOR ( LOAD 1  00700051
*                                                                     * 00730051
*  COPYRIGHT = 'NONE'                                                 * 00760051
*                                                                     * 00790051
*  STATUS CHANGE LEVEL 5                                              * 00820051
*                                                                     * 00900020
*FUNCTION: THIS MODULE DEACTIVATES A DATA TRANSFER COMMUNICATION LINK * 01000020
*   BETWEEN AN APPLICATION PROGRAM AND THE MCP.  IT EXECUTES IN       * 01100020
*   SUPERVISOR MODE AND, FOR THE MOST PART, IN KEY 5.                 * 01200006
*                                                                     * 01270006
*   IF CLOSE WAS ENTERED FOR ABEND, THE PEB IS INVALIDATED SO NO      * 01340006
*   MCP ROUTINE WILL POST BACK TO THE APPLICATION PROGRAM             * 01410006
*                                                                     * 01480006
*   IF THE MCP IS ACTIVE, OPEN SETS UP TO GIVE CONTROL TO THE         * 01550006
*   OPEN/CLOSE SUBTASK IN THE MCP.  ONCE PER CLOSE, CORE IS           * 01620006
*   GOTTEN FOR AN RCB. THE RCB IS INITIALIZE WITH INFORMATION         * 01690006
*   NEEDED BY IEDQEU.  FOR INPUT DCB, IF THE ERB IS BUSY, A WAIT      * 01760006
*   IS ISSUED. (WHEN ERB IS FREED,THE RCB WILL BE POSTED TO EU.)      * 01830006
*   AN SVC 102 IS ISSUED WITH POST CODE IN PARMLIST. IT IS            * 01900006
*   FOLLOWED BY A WAIT FOR IEDQEU.                                    * 01970006
*   UPON RETURN, ACCESS METHOD MODULES ARE DELETED AND CORE FOR       * 02040006
*   PECB AND LOCATE MODE WORK AREA IS FREED.                          * 02110006
*                                                                     * 02180006
*   ON A CLOSEDOWN, THE OPERATOR CONTROL ECB IS POSTED COMPLETE.      * 02250006
*                                                                     * 02320006
*   BEFORE THE EXECUTOR XCTLS TO THE NEXT ENTRY IN THE WHERE-TO       * 02390006
*   GO TABLE, THE CORE FOR THE RCB IS FREED.                          * 02460006
*                                                                     * 02600020
*ENTRY POINT:                                                         * 02700020
*        IGG02046                                                     * 02800020
*                                                                     * 02900020
*INPUT: REGISTERS 5,6,7 AND 8 CONTAIN THE FOLLOWING VALUES:           * 03000020
*   5 - ADDRESS OF FIRST ENTRY IN DCB PARAMETER LIST                  * 03100020
*   6 - ADDRESS OF BEGINNING OF WHERE-TO-GO TABLE                     * 03200020
*   7 - ADDRESS OF CURRENT ENTRY IN DCB PARAMETER LIST                * 03300020
*   8 - ADDRESS OF CURRENT ENTRY IN WHERE-TO-GO TABLE                 * 03400020
*                                                                     * 03500020
*OUTPUT: REGISTERS 5,6,7 AND 8 CONTAIN THE FOLLOWING VALUES:          * 03600020
*   5 - SEE 'INPUT'                                                   * 03700020
*   6 - SEE 'INPUT'                                                   * 03800020
*   7 - ADDRESS OF NEXT ENTRY IN DCB PARAMETER LIST                   * 03900020
*   8 - ADDRESS OF NEXT ENTRY IN WHERE-TO-GO TABLE                    * 04000020
*                                                                     * 04100020
*EXTERNAL ROUTINES: DEBCHK -- SVC 117                                 * 04200005
*                   DELETE -- SVC 9                                   * 04210005
*                   WAIT -- SVC 1                                     * 04220005
*                   XCTL -- SVC 7                                     * 04230005
*                   IEDQEB -- AQCTL SVC 102 ROUTINE -- TO TPOST A     * 04240005
*   SPECIAL ELEMENT TO THE OPEN/CLOSE SUBTASK.                        * 04250005
*                                                                     * 04260005
*EXITS-NORMAL: THIS MODULE XCTLS TO NEXT ENTRY IN WTG TABLE           * 04400020
*                                                                     * 04500020
*EXITS-ERROR                                                          * 04600020
*                                                                     * 04700020
*TABLES/WORK AREAS:                                                   * 04800020
*   CVT                                                               * 04900020
*   DCB                                                               * 05100020
*   TCB                                                               * 05200020
*   DEB                                                               * 05300020
*                                                                     * 05400006
*   OPEN/CLOSE WORK AREA                                              * 05700020
*                                                                     * 05800020
*ATTRIBUTES -- REUSABLE,REENTERANT.                                   * 05900051
*                                                                     * 06000020
*NOTES: THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL         * 06100020
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 06200020
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 06300020
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 06400020
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 06500020
*                                                                     * 06600020
*********************************************************************** 06700020
         EJECT                                                          06800020
*                                                                     * 06900020
*              S Y M B O L I C    R E G I S T E R S                   * 07000020
*                                                                     * 07100020
RZERO    EQU   0                        GENERAL WORK REGISTER           07200020
RPARM    EQU   1                                                        07350022
RCORE    EQU   2                        DCB WORK AREA.           Y02027 07370006
RPEWA    EQU   3                        PROCESS ENTRY WORKAREA          07500020
RPENTRY  EQU   4                        PROCESS ENTRY                   07600020
RMACR    EQU   4                        ADDRESS OF APPROPRIATE BYTE     07630022
*                                       IN DCBMACR FIELD                07660022
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       07700020
*                                       DCB PARAMETER LIST              07800020
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO          07900020
*                                       (WTG) TABLE                     08000020
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY        08100020
*                                       IN DCB PARAMETER LIST           08200020
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY        08300020
*                                       IN WHERE-TO-GO TABLE            08400020
RTCB     EQU   9                        TCB BASE REG.            Y02027 08420006
RTCX     EQU   9                        TCX ADDR                 Y02027 08510006
RDCB     EQU   10                       DATA CONTROL BLOCK              08600020
RDEB     EQU   11                       DATA EXTENT BLOCK               08700020
RBASE    EQU   12                       CSECT BASE REGISTER             08800020
RWORK    EQU   13                       ACCESS METHOD WORKAREA          08900020
RETURN   EQU   14                       RETURN ADDRESS                  09000020
RENTRY   EQU   15                       COMPLETION CODE REGISTER        09100020
         SPACE 3                                                        09200022
         BALR  RBASE,RZERO              ESTABLISH                       09300020
         USING *,RBASE                  ADDRESSIBILITY           CLUP21 09400022
IGG02046 IEDHJN BYPASS                  BRANCH AROUND ID AND DATES22025 09430022
         SPACE 3                                                        09460022
         USING IHADCB,RDCB              DATA CONTROL BLOCK              09500020
         USING IEDQPEWA,RPEWA           PROCESS ENTRY WORKAREA          10000020
         USING IEDQDEB,RDEB             DATA EXTENT BLOCK               10100020
         USING FORCORE,RCORE            DATA CONTROL BLOCK WORKAREA     10200020
         USING IEDQTCB,RTCB             TASK CONTROL BLOCK              10300020
         USING PSA,RZERO                PSA                    @ZA01439 10400061
         EJECT                                                          10600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 10650022
*                                                                     * 10700020
* THE FOLLOWING SECTION OF CODE IS EXECUTED FOR EACH DCB BEING   CLUP21 10800022
* CLOSED.  IT INITIALIZES CONTROL BLOCK BASE REGISTERS.          Y01004 10850005
*                                                                     * 10900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 11500022
START    EQU   *                                                 Y02027 11650006
         L     RCORE,FOUR(,RWTGC)       ADDRESS OF OPEN WORKAREA.       11700005
         L     RDCB,DXUDCBAD            ADDR OF REAL DCB         Y02027 11900006
         DEBCHK  (RDCB),TYPE=VERIFY,AM=TCAMAP  VALIDATE DEB      Y02027 12100006
         LR    RDEB,RPARM               LOAD DEB BASE REG.       Y02027 12200006
         L     RDCB,ZERO(,RPARC)        LOAD COPIED DCB ADDR.    Y02027 12300006
         TM    DEBPCBAD-ONE,FLGU        IS RECFM DEFAULT VALUE.  Y02027 12400006
         BNO   NOCLEAR                  RECFM IS NOT DEFUALT.    Y02027 12500006
         MVI   DCBRECFM,NULL            SET RECFM TO UNSPECIFIED.Y02027 12600006
NOCLEAR  EQU   *                                                 Y02027 12700006
         MODESET  EXTKEY=ZERO                                           13550006
         XC    DXCCW1,DXCCW1            CLEAR ECB.               Y02027 13600006
         ICM   RPEWA,AD,DEBPEWA         LOAD PEWA ADDRESS      @ZA02601 13700061
         BZ    NOEU                     BRANCH, NO PEWA        @ZA02601 13800061
         EJECT                                                   Y02027 14100006
*****************************************************************Y02027 14200006
***** SET UP RCB FOR IEDQEU(MCP MEMORY) AND POST RCB TO          Y02027 14300006
******   DISABLED READY QUEUE.                                   Y02027 14400006
*****************************************************************Y02027 14500006
         L     RTCX,CVTPTR              LOAD CVT PTR             Y02027 14530006
         ICM   RTCX,ALL,CVTAQAVT-CVT(RTCX) IS MCP ACTIVE       @ZA02601 14560061
         BZ    NOEU                     NO, BYPASS POST TO MCP @ZA02601 14580061
         TM    TCXFLAG1-IEDQTCX(RTCX),TCXMCPCD MCP TERMINATING @ZA02601 14600061
         BO    NOEU                     YES, BYPASS POST TO MCP@ZA02601 14620061
         L     RENTRY,PSAAOLD           ADDRESS OLD ASCB PTR   @ZA02601 14640061
         CLC   ASCBASID-ASCB(TWO,RENTRY),TCXASID-IEDQTCX(RTCX) @ZA02601 14660061
*                                       IS APPL A SUBTASK      @ZA02601 14680061
*                                       OF MCP                 @ZA02601 14700061
         BNE   MCPOK                    BR, NOT IN SAME MEMORY @ZA02601 14720061
         L     RENTRY,TCXTCB-IEDQTCX(RTCX) GET MCP TCB ADDRESS @ZA02601 14740061
         TM    TCBFLGS-IEDQTCB(RENTRY),TERM IS MCP TERMINATING @ZA02601 14760061
         BM    NOEU                     YES, BYPASS POST TO MCP@ZA02601 14780061
MCPOK    EQU   *                                               @ZA02601 14800061
***************** IF APPL PROG IS ABENDING INVALIDATE          @OZ19756 14801000
********       PEB TO PREVENT CROSS MEMORY POST                @OZ19756 14802000
         L     RTCB,DEBTCBAD-ONE        LOAD TCB ADDR          @OZ19756 14803000
         TM    TCBFLGS,ABND             IS APPL PROG ABENDING  @OZ19756 14804000
         BNO   NOTABEND                 BR NO                  @OZ19756 14805000
         ICM   RPARM,AD,DEBPEBAD        GET PEB ADDR           @OZ19756 14806000
         BZ    NOEU                     BR IF NO PEB           @OZ19756 14807000
         MVI   PEBASCB-IEDQPEB(RPARM),FF INVALIDATE THE PEB    @OZ19756 14808000
NOTABEND EQU   *                                               @OZ19756 14809000
         L     RTCX,CVTPTR              GET CVT PTR            @OZ19756 14810000
         ICM   RTCX,ALL,CVTAQAVT-CVT(RTCX)  GET TCX PTR        @OZ19756 14811000
         BZ    NOEU                     MCP NOT ACTIVE IF 0    @OZ19756 14812000
         ICM   RZERO,AD,TCXOCQ-IEDQTCX+ONE(RTCX) GET QCB ADDR  @ZA02601 14820061
         BZ    NOEU                     NO INTERFACE FOR APPL  @ZA02601 14840061
         LA    RPARM,TCXAIBC-IEDQTCX(RTCX) TCX AIB PTR         @ZA02601 14900061
AIBGET   EQU   *                                               @ZA02601 14920061
         ICM   RPARM,AD,AIBCHAIN-IEDQAIB(RPARM) ANY AIB'S AVAIL@ZA02601 14940061
         BNZ   GOTAIBS                  YES, GET ONE           @ZA02601 14960061
         LH    RZERO,TCXSZAIB-IEDQTCX(RTCX)   GET SIZE OF AIB  @OZ17630 14965081
         CH    RZERO,FOURK              SIZE GREATER THAN 4K   @OZ17630 14970081
         BH    GETCORE                  YES, BRANCH            @OZ17630 14975081
         LA    RZERO,HPAGE              2K VALUE               @ZA02601 14980061
         AR    RZERO,RZERO              DOUBLE TO PAGE SIZE    @ZA02601 15000061
GETCORE  EQU   *                                               @OZ17630 15010081
         LR    RCORE,RPARC              SAVE REG ACROSS GETMAIN@ZA02601 15020061
         ICM   RMACR,AD,DEBTCBAD        TCB ADDR FOR GETMAIN   @ZA02601 15040061
         L     RPARC,PSAAOLD            ASCB ADDR FOR GETMAIN  @ZA02601 15060061
*                                       GETMAIN CSA KEY6       @ZA02601 15080061
         MODESET   EXTKEY=TCAM          GET IN KEY 6           @ZA05047 15100081
         GETMAIN RU,LV=(0),SP=CSA,BNDRY=PAGE                   @ZA05047 15106081
         MODESET   EXTKEY=ZERO          GO BACK TO KEY 0       @ZA05047 15112081
         LR    RPARC,RCORE              RESTORE RPARC          @ZA02601 15120061
         L     RCORE,FOUR(,RWTGC)       RESTORE ADDR OF WRKAREA@ZA02601 15140061
         LH    RETURN,TCXSZAIB-IEDQTCX(RTCX) SIZE OF AIB       @ZA02601 15160061
         CH    RETURN,FOURK             SIZE GREATER THAN 4K   @OZ17630 15163081
         BNH   SMALLAIB                 NO, BRANCH             @OZ17630 15166081
         LR    RENTRY,RPARM             GET ADDR OF ONLY AIB   @OZ17630 15169081
         B     CLRBYTE                  BRANCH TO CLEAR BYTE   @OZ17630 15172081
SMALLAIB EQU   *                                               @OZ17630 15175081
         LA    RENTRY,HPAGE             2K VALUE               @ZA02601 15180061
         LA    RENTRY,HPAGE(RENTRY,RPARM) ADDR OF END OF AIBS  @ZA02601 15200061
         SR    RENTRY,RETURN            ADDR OF LAST AIB       @ZA02601 15220061
CLRBYTE  EQU   *                                               @OZ17630 15230081
         LA    RZERO,ZERO(RPARM)        CLEAR HI ORDER BYTE    @ZA02601 15240061
         B     BXLE                     BRANCH TO INITIALIZE   @ZA02601 15260061
CHAINAIB EQU   *                                               @ZA02601 15280061
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(RPARM) STORE AIB PTR @ZA02601 15300061
         LR    RPARM,RZERO              SAVE CURRENT PTR       @ZA02601 15320061
BXLE     EQU   *                                               @ZA02601 15340061
         BXLE  RZERO,RETURN,CHAINAIB    LOOP THRU NEW CORE     @ZA02601 15360061
*                                       TILL ALL AIBS LINKED   @ZA02601 15380061
         LR    RENTRY,RPARM             LAST AIB PTR           @ZA02601 15400061
         N     RPARM,CLRLOW             START OF GOTTEN CORE   @ZA02601 15420061
         L     RZERO,TCXAIBC-IEDQTCX(RTCX) GET CURRENT AIB PTR @ZA02601 15440061
AIBLOOP  EQU   *                                               @ZA02601 15460061
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(RENTRY) LINK AIBS    @ZA02601 15480061
         CS    RZERO,RPARM,TCXAIBC-IEDQTCX(RTCX) CHAIN AIBS    @ZA02601 15500061
         BNE   AIBLOOP                  RETRY IF CS FAILED     @ZA02601 15520061
GOTAIBS  EQU   *                                               @ZA02601 15540061
         TS    AIBSTATE-IEDQAIB(RPARM)  ALLOCATE AIB           @ZA02601 15560061
         BNZ   AIBGET                   IN USE, RETRY          @ZA02601 15580061
         MVC   AIBECBA-IEDQAIB(FOUR,RPARM),CLOS SET ID FOR     @ZA02601 15600061
*                                       FAILURE                @ZA02601 15620061
         ST    RPARM,DXCCW12            SAVE AIB ADDR          @ZA04027 15640081
HAVEAIB  EQU   *                                               @OZ07819 15740081
         LA    RPARM,AIBKEY-IEDQAIB(RPARM)  BUMP TO RCB        @ZA04027 15840081
         XC    ZERO(RCBSIZE,RPARM),ZERO(RPARM) CLEAR RCB       @ZA02601 16150061
         USING IEDQRECB,RPARM           SET UP RCB BASE.         Y02027 16200006
         MVI   RECBKEY,ZERO             SET KEY FOR CLOSE.       Y02027 16300006
         MVI   RECBPRI,CLOSEPRI         SET CLOSE PRIORITY.      Y02027 16400006
         MVC   RECBQCBA(3),TCXOCQ-IEDQTCX+ONE(RTCB) MOVE QCB ADDRY02027 16500006
         MVC   RCBTCB+ONE(THREE),DEBTCBAD MOVE TCB ADDR TO RCB.  Y02027 16600006
         MVC   RCBDCBMA,DCBMACRF        MOVE MACRF TO RCB.       Y02027 16700006
         L     RENTRY,DEBTCBAD-ONE      APPL TCB ADDR          @ZA02601 16800061
         MVC   RCBTCBFL,TCBFLGS-IEDQTCB(RENTRY) MOVE TCB FLAGS @ZA02601 16900061
         LA    RZERO,DXCCW1             LOAD CLOSE ECB ADDR.     Y02027 17000006
         ST    RZERO,RCBPECB            STORE ECB ADDR IN RCB.   Y02027 17100006
         L     RPEWA,PSAAOLD            GET PTR TO CURRENT ASCB@Z40X9TG 17108000
         LA    RPEWA,ZERO(,RPEWA)       CLEAR HIGH BYTE        @Z40X9TG 17116000
         ST    RPEWA,RCBASCB            SET ASCB IN RCB        @Z40X9TG 17124000
         MVC   RCBASID+TWO(TWO),ASCBASID-ASCB(RPEWA) SET       @Z40X9TG 17132000
*                                       ASID                   @Z40X9TG 17140000
         ICM   RPEWA,AD,DEBPEWA         LOAD PEWA ADDR.          Y02027 17200006
         ST    RPEWA,RCBDSNM            PASS PEWA ADDR. IN RCB.  Y02027 17300006
         STM   RDCB,RENTRY,RCBSAVE      SAVE REGS OVER SETLOCKS@ZA02601 17303061
LOCALGET SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA02601X17306061
               RELATED=(PEBPEWA,IEDQEU(LOCALREL),IEDQOT01(LOCALREL),IGGX17309061
               02046(LOCALREL))                                @ZA02601 17312061
CMSGET   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                  @ZA02601X17315061
               RELATED=(PEBPEWA,IEDQEU(CMSREL),IEDQOT01(CMSREL),IGG0204X17318061
               6(CMSREL))                                      @ZA02601 17321061
         LM    RDCB,RENTRY,RCBSAVE      RESTORE REGS           @ZA02601 17322061
         LA    RMACR,TCXPEWAC-IEDQTCX-PEWALINK+IEDQPEWA(RTCX)  @ZA02601 17324061
*                                       FIRST PEWA ADDRESS     @ZA02601 17327061
         LA    RPEWA,ZERO(RPEWA)        CLEAR HIGH BYTE        @ZA02601 17330061
LOOPPEWA EQU   *                                               @ZA02601 17333061
         ICM   RMACR,ALL,PEWALINK-IEDQPEWA(RMACR) GET PEWA     @ZA02601 17336061
         BZ    ENDPEWA                  END OF CHAIN           @ZA02601 17339061
         CR    RMACR,RPEWA              PEWA IN CHAIN          @ZA02601 17342061
         BNE   LOOPPEWA                 NO, CHECK NEXT PEWA    @ZA02601 17345061
ENDPEWA  EQU   *                                               @ZA02601 17348061
CMSREL   SETLOCK RELEASE,TYPE=CMS,                             @ZA02601X17351061
               RELATED=(PEBPEWA,IEDQEU(CMSGET),IEDQOT01(CMSGET),IGG0204X17354061
               6(CMSGET))                                      @ZA02601 17357061
LOCALREL SETLOCK RELEASE,TYPE=LOCAL,                           @ZA02601X17360061
               RELATED=(PEBPEWA,IEDQEU(LOCALGET),IEDQOT01(LOCALGET),IGGX17363061
               02046(LOCALGET))                                @ZA02601 17366061
         LM    RDCB,RENTRY,RCBSAVE      RETORE REGS            @ZA02601 17369061
         LTR   RMACR,RMACR              PEWA FOUND IN CHAIN    @ZA02601 17372061
         BZ    NOEU                     NO, BYPASS POST TO MCP @ZA02601 17375061
         ST    RPARM,PEWARCB            SAVE RCB ADDR IN PEWA  @OZ07798 17400081
         TM    PEWAFLG,CFLG             ALREADY REQUESTED CLOSE@ZA02601 17403061
         BO    NOEU                     YES, BYPASS POST TO MCP@ZA02601 17433061
         OI    PEWAFLG,CFLG             SET CLOSE FLAG         @ZA02601 17463061
         CLI   DCBMACRF,ZERO            TEST FOR OUTPUT.         Y02027 17500006
         BE    ERBFREED                 BRANCH IF OUTPUT.        Y02027 17600006
         TM    PEWAFLG,ERBBUSY          TEST FOR ERB BEING BUSY. Y02027 17700006
         BNO   ERBFREED                 BRANCH IF ERB NOT BUSY.  Y02027 17800006
         B     WAITX                    GO WAIT FOR EU.          Y02027 18100006
ERBFREED EQU   *                                                 Y02027 18200006
*              PUT RCB ON ASYCHRONOUS READY QUEUE TO ACTIVATE    Y02027 18400006
*              IEDQEU SUBTASK IN MCP                             Y02027 18410006
         L     RENTRY,TCXREADY-IEDQTCX(RTCX)  FIRST ELEMENT      Y02027 18440006
POSTLOOP STCM  RENTRY,AD,RECBLINK-IEDQRECB(RPARM) POINT NEW      Y02027 18450006
*                                       ELEMENT TO FIRST ELEMENT Y02027 18460006
         CS    RENTRY,RPARM,TCXREADY-IEDQTCX(RTCX) CURRENT       Y02027 18470006
*                                       ELEMENT UPDATED?         Y02027 18480006
         BNE   POSTLOOP                 BRANCH IF YES, TRY AGAIN Y02027 18490006
*                                       NO, ASYCN READY QUEUE    Y02027 18500006
*                                       UPDATED WITH ELEMENT     Y02027 18510006
*                                                                Y02027 18520006
         TS    RCBERR                   SET QEU POSTED         @ZA02601 18525061
*              POST MCP ECB COMPLETE                             Y02027 18530006
*                                                                Y02027 18540006
         L     RENTRY,TCXAVT-IEDQTCX(RTCX)  GET AVT ADDRESS      Y02027 18550006
         LA    RENTRY,AVTOSECB-IEDQAVTD(RENTRY) MCP-ECB ADDRESS  Y02027 18560006
         ST    RENTRY,DXCCW2            STORE IN PARAMETER LIST  Y02027 18570006
         L     RENTRY,CVTPTR            ADDRESS OF CVT           Y02027 18580006
         LA    RENTRY,CVTBRET-CVT(RENTRY) ERROR ADDRESS          Y02027 18590006
         ST    RENTRY,DXCCW2+EIGHT      AND STORE IN LIST        Y02027 18600006
         MVC   DXCCW2+FOUR(4),TCXASCB-IEDQTCX(RTCX) STORE ADDRESSY02027 18610006
*                                       OF ASCB IN LIST          Y02027 18620006
         SR    RZERO,RZERO              ZERO COMPLETION CODE     Y02027 18630006
         LA    RPARM,DXCCW2             ADDRESS OF LIST          Y02027 18640006
         POST  ,(0),MF=(E,(1))                                          18650006
WAITX    EQU   *                                                 Y02027 18800006
         MODESET   EXTKEY=ZERO                                 @ZA02601 18850061
         L     RTCB,DEBTCBAD-ONE  RELOAD TCB ADDR                Y02027 19100006
         WAIT  ECB=DXCCW1               WAIT ON EU               Y02027 19200006
         L     RPEWA,DXCCW12            AIB ADDR               @ZA04027 19220081
         LA    RPARM,AIBKEY-IEDQAIB     RCB OFFSET             @ZA04027 19240081
         AR    RPARM,RPEWA              BUMP TO RCB            @ZA04027 19260081
         MVC   DXCCW1+FIVE(3),RCBPEBAD   ASCB ADDR OF MCP      @ZA04027 19280081
         MVC   DXCCW1(1),RCBAVTBT       AVTBIT1 FROM EU        @ZA04027 19300081
         MVC   DXCCW1+ONE(3),RCBOPECB   MOVE ECB ADDR          @ZA04027 19320081
NOEU     EQU   *                        MCP ABENDING             Y02027 19400006
         EJECT                                                          26400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 26500022
*                                                                     * 26600020
* DETERMINE LOAD MODULES TO BE DELETED AND DELETE THEM                * 26700020
*                                                                     * 26800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 26830022
DELETE1  EQU   *                                                 Y02027 26860006
         NI    DEBDCBAD-ONE,FF-DEBID    CLEAR TCAM DEB I.D.      Y02027 26865006
         LA    RPEWA,DELE               RPEWA = ADDRESS OF SUB-  X01004 26870005
*                                       ROUTINE TO DELETE MODULES.      26880005
         CLI   DCBMACRF,OUT             IS THIS AN OUTPUT DCB           26900020
         BE    OUTDCB                   BRANCH IF YES                   27000020
         LA    RMACR,DCBMACRF           ADDRESS OF INPUT DCB            27500020
*                                       INSTRUCTION REFERENCE           27600020
         MVI   MNAME+SEVEN,RG           GET/READ MODULE ID.             28300005
         BALR  RETURN,RPEWA             DELETE GET/READ ROUTINE. X01004 28400005
         TM    0(RMACR),READFLG         BSAM LEVEL                      28500020
         BZ    POINT                    BRANCH IF NO                    28600020
CHECK    EQU   *                                                        28700020
         MVI   MNAME+SEVEN,RL           CHECK MODULE ID.                28800005
         XC    DCBCHECK+ONE(THREE),DCBCHECK+ONE  REMOVE CHECK    X01004 28850005
*                                       ROUTINE'S ENTRY POINT    X01004 28900005
*                                       ADDRESS FROM DCB.        X01004 28950005
         BALR  RETURN,RPEWA             DELETE CHECK ROUTINE     X02004 29000005
POINT    EQU   *                                                        29200020
         TM    0(RMACR),POINTFLG        POINT(RETRIEVE) SPECIFIED       29300020
         BZ    FREEWA                   BRANCH IF NO             Y02027 29400006
         MVI   MNAME+SEVEN,RM           POINT MODULE ID.                29500005
         XC    DCBPOINT(FOUR),DCBPOINT  REMOVE POINT ROUTINE'S   X01004 29550005
*                                       ADDRESS FROM DCB.        X01004 29600005
         BALR  RETURN,RPEWA             DELETE POINT MODULE      Y02027 29700006
         B     FREEWA                   BRANCH TO FREE STORAGE   Y02027 29730006
*****************************************************************CLUP21 29760006
*                                                                     * 29790006
* DELETE SPECIFIED ACCESS METHOD MODULE                          CLUP21 29820006
*                                                                     * 29850006
*****************************************************************CLUP21 29880006
DELE     EQU   *                                                        29910006
         DELETE EPLOC=MNAME                                      CLUP21 29940006
         BR RETURN                      RETURN TO CALLER         CLUP21 29970006
OUTDCB   EQU   *                                                        30000020
         LA    RMACR,DCBMACRF+ONE       ADDRESS OF OUTPUT DCB.          30100005
*                                       INSTRUCTION REFERENCE           30200020
         MVI   MNAME+SEVEN,RI           PUT/WRITE MODULE ID.            30900005
         BALR  RETURN,RPEWA             DELETE PUT/WRITE ROUTINE.X01004 31000005
         TM    0(RMACR),WRITEFLG        BSAM DCB                        31100020
         BNZ   CHECK                    BRANCH IF YES TO DELETE  Y01004 31200005
*                                       CHECK ROUTINE.           Y01004 31300005
*****************************************************************CLUP21 31302006
*                                                                CLUP21 31304006
* FREE DYNAMICALLY ALLOCATED MAIN STORAGE AND CLEAN UP THE DEB   CLUP21 31306006
*                                                                CLUP21 31308006
*****************************************************************CLUP21 31310006
FREEWA   EQU   *                                                        31312006
         XC    DCBREAD+1(3),DCBREAD+1                                   31314006
         L     RZERO,DCBPECB            ADDRESS OF PECB          Y02027 31316006
         LA    RPENTRY,PECBSIZE         SIZE OF PECB             Y02027 31318006
         BAL   RETURN,BLDLIST           FREE ACCESS METHOD WORKAREA     31322006
         ICM   RZERO,AD,DEBLCMWA        GET LOCATE MODE W/A    @OY16374 31324000
         BZ    FREEDEB                  BR, NOT LOCATE MODE    @OY16374 31326000
         LH    RPENTRY,DEBSOWA          SIZE OF LOCATE MODE      Y02027 31328006
*                                       WORKAREA                 Y02027 31330006
         BAL   RETURN,BLDLIST           FREE LOCATE MODE WORKAREA       31336006
FREEDEB  EQU   *                                                        31338006
         MVI   DEBTAMID,NULL                                     CLUP21 31342006
         XC    DEBLCMWA(3),DEBLCMWA                                     31344006
         XC    DEBPCBAD(3),DEBPCBAD     ZERO PCB PTR IN DEB      Y02027 31344506
         XC    DEBPEBAD(3),DEBPEBAD     ZERO PEB ADDR IN DEB     Y02027 31345006
         XC    DEBPEWA(3),DEBPEWA       ZERO PEWA ADDR IN DEB    Y02027 31345506
         B     EXITTST                  PREPARE TO EXIT                 31346006
*****************************************************************CLUP21 31348006
*                                                                CLUP21 31350006
* THIS SUBROUTINE SETS UP A PARAMETER LIST TO BE USED FOR        CLUP21 31352006
*  DEALLOCATION OF MAIN STORAGE ALLOCATED AT OPEN TIME           CLUP21 31354006
*                                                                CLUP21 31356006
*****************************************************************CLUP21 31358006
BLDLIST  EQU   *                                                        31360006
         LR    RPARM,RZERO              FREEMAIN ARB ADDRESS     Y02027 31362006
         LA    RPARM,0(0,RPARM)         CLEAR HIGH ORDER BYTE    Y02027 31364006
         LTR   RPARM,RPARM              AREA TO BE FREED         Y02027 31366006
         BCR   8,RETURN                 EXIT IF NO                      31368006
         LA    RZERO,0(0,RPENTRY)       FREEMAIN WORKAREA SIZE   Y02027 31370006
         O     RZERO,POOL               SET SUBPOOL VALUE IN REG        31372006
         L     RTCB,DEBTCBAD-ONE        GET TCB ADDRESS          Y02027 31372606
         MODESET  EXTKEY=RBT234,WORKREG=4                               31373206
         FREEMAIN R,LV=(0),A=(1)                                        31374006
         MODESET  EXTKEY=ZERO                                           31379006
         BR    RETURN                   RETURN TO CALLER                31380006
         EJECT                                                          31400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 36950022
*                                                                     * 37000020
* SET UP TO TRANSFER CONTROL TO THE NEXT LOAD OF OPEN            CLUP21 37100022
*                                                                     * 37200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 37250022
EXITTST  EQU   *                                                        37300020
         MODESET  KEYADDR=DXUKEY,WORKREG=15                      Y02027 37400006
*   RDCB=COPIED DCB, RENTRY=REAL DCB, RWORK=LEN OF PREFIX        Y02027 37500006
         L     RENTRY,DXUDCBAD          LOAD REAL DCB ADDR       Y02027 37600006
         SR    RWORK,RWORK              ZERO REG                 Y02027 37700006
         IC    RWORK,DXUDCBPL+ONE       LEN OF NULL PREFIX       Y02027 37800006
         LA    RENTRY,ZERO(RWORK,RENTRY) PT PAST NULL PREFIX REALY02027 37900006
         AH    RDCB,DXUDCBPL            PT PAST NULL PREFIX COPY Y02027 38000006
         IC    RWORK,DXUDCBML+ONE       LEN OF DCB TO MOVE       Y02027 38100006
         BCTR  RWORK,ZERO               DEC FOR MOVE             Y02027 38200006
         EX    RWORK,DCBMOVE            MOVE COPIED DCB TO REAL  Y02027 38300006
         SH    RDCB,DXUDCBPL            POINT TO PREFIX          Y02027 38400006
         MODESET  EXTKEY=ZERO                                  @ZA02601 38500061
         TM    DXCCW1,AVTCLOSN          IS IT CLOSEDOWN        @ZA04027 38600081
         BNO   NOTCLSDN                 BR, NO                 @ZA04027 39100081
         MVI   DXCCW1,ZERO              RESET FLAGS            @ZA04027 39600081
         L     RENTRY,CVTPTR            LOAD CVT ADDR            Y02027 40300006
         LA    RENTRY,CVTBRET-CVT(,RENTRY) LOAD ADDR OF BR 14    Y02027 40400006
         ST    RENTRY,DXCCW2            STORE ERRET ADDR IN LIST Y02027 40500006
         SR    RZERO,RZERO              CLEAR RETURN CODE.       Y02027 40600006
         LA    RPARM,DXCCW1             LOAD ADDR OF PARM LIST   Y02027 40700006
         POST ,(0),MF=(E,(1))           POST OP CTL CCOMPETE.    Y02027 40800006
NOTCLSDN EQU   *                                                 Y02027 40900006
         XC    NULL(TWO,RWTGC),NULL(RWTGC) CLEAR ID FOR THIS DCB.Y02027 41100006
         ICM   RENTRY,ALL,DXCCW12       AIB TO FREE?           @OZ18749 41150000
         BZ    NOAIB                    BR NO                  @OZ18749 41200000
         MVI   AIBSTATE-IEDQAIB(RENTRY),AIBFREE  FREE AIB      @OZ18749 41250000
NOAIB    EQU   *                                               @OZ18749 41300000
LOOP     EQU   *                                                        41500020
         LA    RWTGC,EIGHT(RWTGC)       BUMP TO NEXT ENTRY IN           41600020
*                                       WTG TABLE                       41700020
         LA    RPARC,FOUR(RPARC)        BUMP TO NEXT ENTRY IN           41800020
*                                       DCB LIST                        41900020
         CLC   NULL(TWO,RWTGC),MODID    ANOTHER TCAM DCB TO CLOSE       42000020
         BE    START                    BRANCH IF YES TO RESTART        42100020
*                                       THIS EXECUTOR                   42200020
         CLC   NULL(TWO,RWTGC),OSID     END OF WTG TABLE                42300020
         BL      LOOP                   BRANCH IF NO                    42400020
*                                                                       42500020
         CLC   NULL(TWO,RWTGC),OSIDH                                    42600005
         BH    LOOP                     CHECK NEXT ENTRY         S21903 42700022
         LR    RPARC,RPAR               RESET POINTER TO BEGINNING      42800020
*                                       OF DCB PARAMETER LIST           42900020
         LA    RWTGC,C32(RWTG)          RESET POINTER TO BEGINNING      43000020
*                                       OF WTG TABLE                    43100020
LABEL    EQU   *                                                        43200020
         CLI   0(RWTGC),NULL            THIS DCB PROCESSED       CLUP21 43300022
         BNE   XCTLRTN                  GO TO RETURN             S21903 43400022
         LA    RWTGC,EIGHT(,RWTGC)                                      43500005
         LA    RPARC,FOUR(,RPARC)                                       43600005
         B     LABEL                    GO TO CHECK NEXT DCB     S21903 43700022
XCTLRTN  EQU   *                                                        43800020
         LA    RENTRY,DXCCW12           GET ADDRESS OF A WORKAREA       43900020
*                                       FOR USE BY XCTL SVC             44000020
         MVC   SIX(TWO,RWTG),NULL(RWTGC) MOVE EXECUTOR ID TO THE        44100020
*                                       PARAMETER LIST                  44200020
         MVC   C14(THREE,RWTG),TWO(RWTGC) MOVE THE TTR TO THE           44300020
*                                       PARAMETER LIST                  44400020
         MODESET   EXTKEY=DATAMGT       BACK TO KEY 5            Y02027 44700006
         XCTL  DE=(RWTG),SF=(E,(15))                                    45000020
DCBMOVE  MVC   ZERO(ZERO,RENTRY),ZERO(RDCB)  MOVE COPIED DCB     Y02027 45106006
*                                       TO REAL DCB              Y02027 45606006
         EJECT                                                          46180005
*                                                                     * 46200020
*              C O N S T A N T S    A N D    E Q U A T E S            * 46300020
*                                                                     * 46400020
MODID    DC    C'46'                    ID OF THIS CLOSE EXECUTOR       46600020
OSID     DC    C'0B'                    ID OF O/S CLOSE EXECUTOR        46700020
OSIDH    DC    C'0G'                    CONSTANT                 S21903 46800022
FOURK    DC    H'4096'                  LENGTH OF A PAGE       @OZ17630 46850081
MNAME    DC    CL8'IGG019R '            CONSTANT                 S21903 46900022
KEY5     DC    X'50'                    KEY 5.                   Y02027 47000006
KEY6     DC    X'60'                    KEY 6.                   Y02027 47100006
SPCSANFP DC    AL1(241)                 USER KEY IN CSA,NOT FTCHPY02027 47200006
         DS    0F                       BOUNDARY ALINEMENT FOR          47300006
*                                       NEXT INSTRUCTION-POOL           47400006
POOL     DC    X'FB000000'              SUBPOOL 251              Y02027 47500006
TERM     EQU   X'C0'                    TCB TERMINATE FLAGS    @ZA01439 47600061
NULL     EQU   0                                                        47700020
ONE      EQU   1                        DISPLACEMENT             Y02027 47750006
TWO      EQU   2                                                        47800020
EIGHT    EQU   8                                                        47900020
FOUR     EQU   4                                                        48000020
NINE     EQU   9                        DISPLACEMENT             Y02027 48050006
C32      EQU   32                                                       48100020
FIVE     EQU   5                                                 X01004 48150005
SIX      EQU   6                                                        48200020
SEVEN    EQU   7                        3-BYTE ICM/STCM MASK.    X01004 48220005
ELEVEN   EQU   11                                                X01004 48240005
TWELVE   EQU   12                                                X01004 48260005
C14      EQU   14                                                       48300020
ALL      EQU   15                       MASK TO ICM/STCM 4 BYTES Y01004 48350005
RG       EQU   C'G'                                                     48500020
RL       EQU   C'L'                                                     48700020
RM       EQU   C'M'                                                     48800020
RI       EQU   C'I'                                                     49000020
POINTFLG EQU   X'04'                    DCBMACR FLAG (POINT)            49200020
LOCMFLG  EQU   X'08'                    DCBMACR FLAG (LOCATE MODE)      49300020
OUT      EQU   X'00'                    DCBMACR FLAG(PUT OR WRITE)      49600020
MOVER    EQU   X'8C'                    AQCTL ACTION CODE FOR-   Y02027 49800006
*                                       POST TO DISABLED QUEUE.  Y02027 49830006
FLGU     EQU   X'80'                    RECFM NOT SPECIFIED      Y02027 49860006
FF       EQU   X'FF'                    ALL BITS ON.             Y02027 49890006
DEBID    EQU   X'0F'                    TCAM DEB IDENTIFIER.     Y02027 49920006
ZERO     EQU   0                        CONSTANT OF ZERO.        Y02027 49950006
AD       EQU   7                        ICM MASK FOR ADDRS.      Y02027 49980006
FREETYPE EQU   X'20'                    FREEMAIN TYPE INDICATOR. Y02027 50010006
ABND     EQU   X'80'                    TCB FLAG FOR ABEND              50100020
THREE    EQU   3                                                        50200020
CSA      EQU   231                      COMMON SUBPOOL         @ZA02601 50270061
HPAGE    EQU   2048                     HALF PAGE SIZE         @ZA02601 50340061
KEY6X    EQU   6                        KEY 6                  @ZA02601 50410061
CLRLOW   DS    0F                       MASK USED TO           @ZA02601 50480061
         DC    X'FFFFF000'              CLEAR 3 LOW BYTES      @ZA02601 50550061
CLOS     DC    C'CLOS'                  CLOSE ID               @ZA02601 50620061
READFLG  EQU   X'20'                                                    50700020
CLOSEPRI EQU   X'C0'                    CLOSE ELEMENT PRIORITY.  X01004 50970005
WRITEFLG EQU   READFLG                                                  51000020
         EJECT                                                          51100022
LAST     EQU   *                        END OF CODE/CONSTANTS    A47157 51105022
         DC    XL50'00'                           PATCH AREA.    Y02027 51110006
         EJECT                                                          51800020
*                                                                     * 51900020
*                   D  S  E  C  T  S                                  * 52000020
*                                                                     * 52100020
         IHAPSA                                                  Y02027 52200006
          IHAASCB                                              @ZA01439 52230061
          EJECT                                                         52260061
         DCBD  DSORG=PS                 DATA CONTROL BLOCK              52300020
DCBPECB  EQU   DCBIOBAD                                          Y02027 52330006
         TPECBD                                                  Y02027 52360006
         TAVTD                          ADDRESS VECTOR TABLE            52400020
         TTCBD                          TASK CONTROL BLOCK              52600020
FORCORE  DSECT                                                          52700020
         IECDSECT                                                       52800020
         TDEBAPD                                                        53200020
         TPEWAD                                                         53500020
         TRECBD                                                         53700020
*****************************************************************Y02027 53703006
*****    RCB EXTENSION FOR TCAM APPLICATION OPEN/CLOSE.          Y02027 53706006
*****************************************************************Y02027 53709006
RCBPECB  DS    F                        APPLIC. PGM PECB ADDR.   Y02027 53712006
RCBASCB  DS    F                        APPLIC. PGM ASCB ADDR.   Y02027 53715006
RCBERRET DS    0F                       ERROR RTN ADDR           Y02027 53716006
RCBASID  DS    F                        APPLIC. PGM ASID ADDR.   Y02027 53718006
RCBTCB   DS    F                        APPLIC. PGM TCB ADDR.    Y02027 53721006
RCBDCBMA DS    H                        DCBMACRF FROM APPLIC.    Y02027 53724006
RCBTCBFL DS    0X                       APPLIC. TCB FLAGS.       Y02027 53727006
RCBDCBDS DS    H                        DCBDSORG FROM APPLIC.    Y02027 53730006
RCBDSNM  DS    CL8                      PROCESS QUEUE NAME.      Y02027 53733006
RCBDEBAD DS    F                        DEB ADDR FOR APPLIC. DCB.Y02027 53736006
RCBDCBBU DS    H                        DCBBUFL FROM APPLIC.     Y02027 53739006
RCBDCBLR DS    H                        DCBLRECL FROM APPLIC.    Y02027 53742006
RCBDCBOP DS    X                        DCBOPTCD FROM APPLIC.    Y02027 53745006
RCBDCBRF DS    X                        DCBRECFM FROM APPLICATIONY02027 53748006
RCBDCBF1 DS    X                        DCBFLAG1 FROM APPLICATIONY02027 53751006
RCBERR   DS    X                        ERROR INDICATOR          Y02027 53754006
RCBJOBNM DS    CL8                      JOBNAME                  Y02027 53755006
RCBSAVE  DS    18F                      SAVE AREA FOR IEDQEU   @ZA02601 53756061
RCBEND   DS    0X                       END OF DSECT.            Y02027 53757006
         ORG   RCBTCB                                                   53760006
RCBDEBTA DS    H                        OFFSET IN T.T. FOR ENTRY.Y02027 53763006
RCBOPECB DS    0AL3                     OPCTL ECB ADDRESS        Y02027 53766006
RCBDEBPW DS    AL3                      ADDR. OF PEWA.           Y02027 53769006
RCBDEBPC DS    AL3                      ADDR. OF PCB.            Y02027 53772006
         DS    2F                       QNAME                    Y02027 53775006
RCBSQ    DS    0X                       SECURE QUEUE FLAG        Y02027 53776006
RCBAVTBT DS    X                        AVTBIT1 ON RETURN FROM EUY02027 53777006
RCBPEBAD DS    AL3                      ADDR OF PEB IN CSA.      Y02027 53778006
RCBSIZE  EQU   RCBEND-RECBKEY           SIZE OF DSECT.           Y02027 53784006
         TPRIOR                                                         53800020
         IHARB                                                   Y02027 53820006
         TPEBD                                                   Y02027 53850006
         TTCXD                                                   Y02027 53860006
CVT      DSECT                                                   Y02027 53870006
         CVT                                                     Y02027 53880006
         EJECT                                                 @ZA02601 53886061
         TAIBD                                                 @ZA02601 53892061
         END                                                            53900020
